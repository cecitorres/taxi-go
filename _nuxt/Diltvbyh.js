import script from"./DemzLx96.js";import script$1 from"./D8rQSKC7.js";import script$2 from"./0_cm5SMt.js";import{l as useRuntimeConfig,_ as _export_sfc,r as ref,o as onMounted,v as createElementBlock,x as createBaseVNode,z as createVNode,A as withCtx,N as Fragment,t as openBlock,B as createTextVNode,y as toDisplayString,O as unref,C as pushScopeId,D as popScopeId}from"./B81XN9vr.js";import"./Cxf85yvG.js";import"./6KpKXU1m.js";import"./CSWJY2Jm.js";import"./D_BeqAwX.js";import"./BfZAennO.js";import"./D4hwEI8P.js";import"./BhLEAuUf.js";import"./X7Jn45L5.js";import"./C9Qgv8sD.js";import"./6hVnIiUq.js";import"./CJwWEvUe.js";const FARES={DAY:{BASE:8.78,RATE_PER_KM:5.22,TIME_RATE:1.04},NIGHT:{BASE:10.53,RATE_PER_KM:6.27,TIME_RATE:1.25}},calculateTaxiFare=(E,A,R,F,G)=>{const H=A+E*R,$=Math.ceil(G/45)*F;return H+$},getTaxiFare=(E,A)=>{const R=calculateTaxiFare(E,FARES.DAY.BASE,FARES.DAY.RATE_PER_KM,FARES.DAY.TIME_RATE,A),F=calculateTaxiFare(E,FARES.NIGHT.BASE,FARES.NIGHT.RATE_PER_KM,FARES.NIGHT.TIME_RATE,A);return console.log("getTaxiFare",R,F),[R.toFixed(2),F.toFixed(2)]},memoize=(E,A,R)=>{let F,G,H,$=!1;const M=async()=>{G||(G=E());try{F=await G,H=!0,$=!1}finally{G=void 0}return F};return A===void 0?async ye=>((!H||ye!=null&&ye.forceRefresh)&&(F=await M()),F):async ye=>((!H||ye!=null&&ye.forceRefresh)&&(F=await M()),$?F:R&&!R(F)?($=!0,F):(A(F)&&await M(),F))},getHttpHandlerExtensionConfiguration=E=>{let A=E.httpHandler;return{setHttpHandler(R){A=R},httpHandler(){return A},updateHttpClientConfig(R,F){A.updateHttpClientConfig(R,F)},httpHandlerConfigs(){return A.httpHandlerConfigs()}}},resolveHttpHandlerRuntimeConfig=E=>({httpHandler:E.httpHandler()});var HttpAuthLocation;(function(E){E.HEADER="header",E.QUERY="query"})(HttpAuthLocation||(HttpAuthLocation={}));var HttpApiKeyAuthLocation;(function(E){E.HEADER="header",E.QUERY="query"})(HttpApiKeyAuthLocation||(HttpApiKeyAuthLocation={}));var EndpointURLScheme;(function(E){E.HTTP="http",E.HTTPS="https"})(EndpointURLScheme||(EndpointURLScheme={}));var AlgorithmId;(function(E){E.MD5="md5",E.CRC32="crc32",E.CRC32C="crc32c",E.SHA1="sha1",E.SHA256="sha256"})(AlgorithmId||(AlgorithmId={}));var FieldPosition;(function(E){E[E.HEADER=0]="HEADER",E[E.TRAILER=1]="TRAILER"})(FieldPosition||(FieldPosition={}));const SMITHY_CONTEXT_KEY="__smithy_context";var IniSectionType;(function(E){E.PROFILE="profile",E.SSO_SESSION="sso-session",E.SERVICES="services"})(IniSectionType||(IniSectionType={}));var RequestHandlerProtocol;(function(E){E.HTTP_0_9="http/0.9",E.HTTP_1_0="http/1.0",E.TDS_8_0="tds/8.0"})(RequestHandlerProtocol||(RequestHandlerProtocol={}));class HttpRequest{constructor(A){this.method=A.method||"GET",this.hostname=A.hostname||"localhost",this.port=A.port,this.query=A.query||{},this.headers=A.headers||{},this.body=A.body,this.protocol=A.protocol?A.protocol.slice(-1)!==":"?`${A.protocol}:`:A.protocol:"https:",this.path=A.path?A.path.charAt(0)!=="/"?`/${A.path}`:A.path:"/",this.username=A.username,this.password=A.password,this.fragment=A.fragment}static isInstance(A){if(!A)return!1;const R=A;return"method"in R&&"protocol"in R&&"hostname"in R&&"path"in R&&typeof R.query=="object"&&typeof R.headers=="object"}clone(){const A=new HttpRequest({...this,headers:{...this.headers}});return A.query&&(A.query=cloneQuery$1(A.query)),A}}function cloneQuery$1(E){return Object.keys(E).reduce((A,R)=>{const F=E[R];return{...A,[R]:Array.isArray(F)?[...F]:F}},{})}class HttpResponse{constructor(A){this.statusCode=A.statusCode,this.reason=A.reason,this.headers=A.headers||{},this.body=A.body}static isInstance(A){if(!A)return!1;const R=A;return typeof R.statusCode=="number"&&typeof R.headers=="object"}}function isValidHostname(E){return/^[a-z0-9][a-z0-9\.\-]*[a-z0-9]$/.test(E)}const escapeUri=E=>encodeURIComponent(E).replace(/[!'()*]/g,hexEncode),hexEncode=E=>`%${E.charCodeAt(0).toString(16).toUpperCase()}`;function buildQueryString(E){const A=[];for(let R of Object.keys(E).sort()){const F=E[R];if(R=escapeUri(R),Array.isArray(F))for(let G=0,H=F.length;G<H;G++)A.push(`${R}=${escapeUri(F[G])}`);else{let G=R;(F||typeof F=="string")&&(G+=`=${escapeUri(F)}`),A.push(G)}}return A.join("&")}function requestTimeout(E=0){return new Promise((A,R)=>{E&&setTimeout(()=>{const F=new Error(`Request did not complete within ${E} ms`);F.name="TimeoutError",R(F)},E)})}const keepAliveSupport={supported:typeof Request<"u"&&"keepalive"in new Request("https://[::1]")};class FetchHttpHandler{static create(A){return typeof(A==null?void 0:A.handle)=="function"?A:new FetchHttpHandler(A)}constructor(A){typeof A=="function"?this.configProvider=A().then(R=>R||{}):(this.config=A??{},this.configProvider=Promise.resolve(this.config))}destroy(){}async handle(A,{abortSignal:R}={}){this.config||(this.config=await this.configProvider);const F=this.config.requestTimeout,G=this.config.keepAlive===!0;if(R!=null&&R.aborted){const Xe=new Error("Request aborted");return Xe.name="AbortError",Promise.reject(Xe)}let H=A.path;const $=buildQueryString(A.query||{});$&&(H+=`?${$}`),A.fragment&&(H+=`#${A.fragment}`);let M="";if(A.username!=null||A.password!=null){const Xe=A.username??"",ht=A.password??"";M=`${Xe}:${ht}@`}const{port:ye,method:oe}=A,Ee=`${A.protocol}//${M}${A.hostname}${ye?`:${ye}`:""}${H}`,ce={body:oe==="GET"||oe==="HEAD"?void 0:A.body,headers:new Headers(A.headers),method:oe};typeof AbortController<"u"&&(ce.signal=R),keepAliveSupport.supported&&(ce.keepalive=G);const $e=new Request(Ee,ce),Ge=[fetch($e).then(Xe=>{const ht=Xe.headers,yt={};for(const Ft of ht.entries())yt[Ft[0]]=Ft[1];return Xe.body!=null?{response:new HttpResponse({headers:yt,reason:Xe.statusText,statusCode:Xe.status,body:Xe.body})}:Xe.blob().then(Ft=>({response:new HttpResponse({headers:yt,reason:Xe.statusText,statusCode:Xe.status,body:Ft})}))}),requestTimeout(F)];return R&&Ge.push(new Promise((Xe,ht)=>{R.onabort=()=>{const yt=new Error("Request aborted");yt.name="AbortError",ht(yt)}})),Promise.race(Ge)}updateHttpClientConfig(A,R){this.config=void 0,this.configProvider=this.configProvider.then(F=>(F[A]=R,F))}httpHandlerConfigs(){return this.config??{}}}const alphabetByEncoding={},alphabetByValue=new Array(64);for(let E=0,A=65,R=90;E+A<=R;E++){const F=String.fromCharCode(E+A);alphabetByEncoding[F]=E,alphabetByValue[E]=F}for(let E=0,A=97,R=122;E+A<=R;E++){const F=String.fromCharCode(E+A),G=E+26;alphabetByEncoding[F]=G,alphabetByValue[G]=F}for(let E=0;E<10;E++){alphabetByEncoding[E.toString(10)]=E+52;const A=E.toString(10),R=E+52;alphabetByEncoding[A]=R,alphabetByValue[R]=A}alphabetByEncoding["+"]=62;alphabetByValue[62]="+";alphabetByEncoding["/"]=63;alphabetByValue[63]="/";const bitsPerLetter=6,bitsPerByte=8,maxLetterValue=63,fromBase64=E=>{let A=E.length/4*3;E.slice(-2)==="=="?A-=2:E.slice(-1)==="="&&A--;const R=new ArrayBuffer(A),F=new DataView(R);for(let G=0;G<E.length;G+=4){let H=0,$=0;for(let oe=G,Ee=G+3;oe<=Ee;oe++)if(E[oe]!=="="){if(!(E[oe]in alphabetByEncoding))throw new TypeError(`Invalid character ${E[oe]} in base64 string.`);H|=alphabetByEncoding[E[oe]]<<(Ee-oe)*bitsPerLetter,$+=bitsPerLetter}else H>>=bitsPerLetter;const M=G/4*3;H>>=$%bitsPerByte;const ye=Math.floor($/bitsPerByte);for(let oe=0;oe<ye;oe++){const Ee=(ye-oe-1)*bitsPerByte;F.setUint8(M+oe,(H&255<<Ee)>>Ee)}}return new Uint8Array(R)},fromUtf8$3=E=>new TextEncoder().encode(E),toUint8Array=E=>typeof E=="string"?fromUtf8$3(E):ArrayBuffer.isView(E)?new Uint8Array(E.buffer,E.byteOffset,E.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(E),toUtf8$3=E=>{if(typeof E=="string")return E;if(typeof E!="object"||typeof E.byteOffset!="number"||typeof E.byteLength!="number")throw new Error("@smithy/util-utf8: toUtf8 encoder function only accepts string | Uint8Array.");return new TextDecoder("utf-8").decode(E)};function toBase64(E){let A;typeof E=="string"?A=fromUtf8$3(E):A=E;const R=typeof A=="object"&&typeof A.length=="number",F=typeof A=="object"&&typeof A.byteOffset=="number"&&typeof A.byteLength=="number";if(!R&&!F)throw new Error("@smithy/util-base64: toBase64 encoder function only accepts string | Uint8Array.");let G="";for(let H=0;H<A.length;H+=3){let $=0,M=0;for(let oe=H,Ee=Math.min(H+3,A.length);oe<Ee;oe++)$|=A[oe]<<(Ee-oe-1)*bitsPerByte,M+=bitsPerByte;const ye=Math.ceil(M/bitsPerLetter);$<<=ye*bitsPerLetter-M;for(let oe=1;oe<=ye;oe++){const Ee=(ye-oe)*bitsPerLetter;G+=alphabetByValue[($&maxLetterValue<<Ee)>>Ee]}G+="==".slice(0,4-ye)}return G}const streamCollector=E=>typeof Blob=="function"&&E instanceof Blob?collectBlob(E):collectStream(E);async function collectBlob(E){const A=await readToBase64(E),R=fromBase64(A);return new Uint8Array(R)}async function collectStream(E){let A=new Uint8Array(0);const R=E.getReader();let F=!1;for(;!F;){const{done:G,value:H}=await R.read();if(H){const $=A;A=new Uint8Array($.length+H.length),A.set($),A.set(H,$.length)}F=G}return A}function readToBase64(E){return new Promise((A,R)=>{const F=new FileReader;F.onloadend=()=>{if(F.readyState!==2)return R(new Error("Reader aborted too early"));const G=F.result??"",H=G.indexOf(","),$=H>-1?H+1:G.length;A(G.substring($))},F.onabort=()=>R(new Error("Read aborted")),F.onerror=()=>R(F.error),F.readAsDataURL(E)})}class NoOpLogger{trace(){}debug(){}info(){}warn(){}error(){}}const getAllAliases=(E,A)=>{const R=[];if(E&&R.push(E),A)for(const F of A)R.push(F);return R},getMiddlewareNameWithAliases=(E,A)=>`${E||"anonymous"}${A&&A.length>0?` (a.k.a. ${A.join(",")})`:""}`,constructStack=()=>{let E=[],A=[],R=!1;const F=new Set,G=we=>we.sort((ce,$e)=>stepWeights[$e.step]-stepWeights[ce.step]||priorityWeights[$e.priority||"normal"]-priorityWeights[ce.priority||"normal"]),H=we=>{let ce=!1;const $e=Ge=>{const Xe=getAllAliases(Ge.name,Ge.aliases);if(Xe.includes(we)){ce=!0;for(const ht of Xe)F.delete(ht);return!1}return!0};return E=E.filter($e),A=A.filter($e),ce},$=we=>{let ce=!1;const $e=Ge=>{if(Ge.middleware===we){ce=!0;for(const Xe of getAllAliases(Ge.name,Ge.aliases))F.delete(Xe);return!1}return!0};return E=E.filter($e),A=A.filter($e),ce},M=we=>{var ce;return E.forEach($e=>{we.add($e.middleware,{...$e})}),A.forEach($e=>{we.addRelativeTo($e.middleware,{...$e})}),(ce=we.identifyOnResolve)==null||ce.call(we,Ee.identifyOnResolve()),we},ye=we=>{const ce=[];return we.before.forEach($e=>{$e.before.length===0&&$e.after.length===0?ce.push($e):ce.push(...ye($e))}),ce.push(we),we.after.reverse().forEach($e=>{$e.before.length===0&&$e.after.length===0?ce.push($e):ce.push(...ye($e))}),ce},oe=(we=!1)=>{const ce=[],$e=[],Ge={};return E.forEach(ht=>{const yt={...ht,before:[],after:[]};for(const $t of getAllAliases(yt.name,yt.aliases))Ge[$t]=yt;ce.push(yt)}),A.forEach(ht=>{const yt={...ht,before:[],after:[]};for(const $t of getAllAliases(yt.name,yt.aliases))Ge[$t]=yt;$e.push(yt)}),$e.forEach(ht=>{if(ht.toMiddleware){const yt=Ge[ht.toMiddleware];if(yt===void 0){if(we)return;throw new Error(`${ht.toMiddleware} is not found when adding ${getMiddlewareNameWithAliases(ht.name,ht.aliases)} middleware ${ht.relation} ${ht.toMiddleware}`)}ht.relation==="after"&&yt.after.push(ht),ht.relation==="before"&&yt.before.push(ht)}}),G(ce).map(ye).reduce((ht,yt)=>(ht.push(...yt),ht),[])},Ee={add:(we,ce={})=>{const{name:$e,override:Ge,aliases:Xe}=ce,ht={step:"initialize",priority:"normal",middleware:we,...ce},yt=getAllAliases($e,Xe);if(yt.length>0){if(yt.some($t=>F.has($t))){if(!Ge)throw new Error(`Duplicate middleware name '${getMiddlewareNameWithAliases($e,Xe)}'`);for(const $t of yt){const Ft=E.findIndex(Ci=>{var ir;return Ci.name===$t||((ir=Ci.aliases)==null?void 0:ir.some(Pi=>Pi===$t))});if(Ft===-1)continue;const Nt=E[Ft];if(Nt.step!==ht.step||ht.priority!==Nt.priority)throw new Error(`"${getMiddlewareNameWithAliases(Nt.name,Nt.aliases)}" middleware with ${Nt.priority} priority in ${Nt.step} step cannot be overridden by "${getMiddlewareNameWithAliases($e,Xe)}" middleware with ${ht.priority} priority in ${ht.step} step.`);E.splice(Ft,1)}}for(const $t of yt)F.add($t)}E.push(ht)},addRelativeTo:(we,ce)=>{const{name:$e,override:Ge,aliases:Xe}=ce,ht={middleware:we,...ce},yt=getAllAliases($e,Xe);if(yt.length>0){if(yt.some($t=>F.has($t))){if(!Ge)throw new Error(`Duplicate middleware name '${getMiddlewareNameWithAliases($e,Xe)}'`);for(const $t of yt){const Ft=A.findIndex(Ci=>{var ir;return Ci.name===$t||((ir=Ci.aliases)==null?void 0:ir.some(Pi=>Pi===$t))});if(Ft===-1)continue;const Nt=A[Ft];if(Nt.toMiddleware!==ht.toMiddleware||Nt.relation!==ht.relation)throw new Error(`"${getMiddlewareNameWithAliases(Nt.name,Nt.aliases)}" middleware ${Nt.relation} "${Nt.toMiddleware}" middleware cannot be overridden by "${getMiddlewareNameWithAliases($e,Xe)}" middleware ${ht.relation} "${ht.toMiddleware}" middleware.`);A.splice(Ft,1)}}for(const $t of yt)F.add($t)}A.push(ht)},clone:()=>M(constructStack()),use:we=>{we.applyToStack(Ee)},remove:we=>typeof we=="string"?H(we):$(we),removeByTag:we=>{let ce=!1;const $e=Ge=>{const{tags:Xe,name:ht,aliases:yt}=Ge;if(Xe&&Xe.includes(we)){const $t=getAllAliases(ht,yt);for(const Ft of $t)F.delete(Ft);return ce=!0,!1}return!0};return E=E.filter($e),A=A.filter($e),ce},concat:we=>{var $e;const ce=M(constructStack());return ce.use(we),ce.identifyOnResolve(R||ce.identifyOnResolve()||((($e=we.identifyOnResolve)==null?void 0:$e.call(we))??!1)),ce},applyToStack:M,identify:()=>oe(!0).map(we=>{const ce=we.step??we.relation+" "+we.toMiddleware;return getMiddlewareNameWithAliases(we.name,we.aliases)+" - "+ce}),identifyOnResolve(we){return typeof we=="boolean"&&(R=we),R},resolve:(we,ce)=>{for(const $e of oe().map(Ge=>Ge.middleware).reverse())we=$e(we,ce);return R&&console.log(Ee.identify()),we}};return Ee},stepWeights={initialize:5,serialize:4,build:3,finalizeRequest:2,deserialize:1},priorityWeights={high:3,normal:2,low:1};class Client{constructor(A){this.middlewareStack=constructStack(),this.config=A}send(A,R,F){const G=typeof R!="function"?R:void 0,H=typeof R=="function"?R:F,$=A.resolveMiddleware(this.middlewareStack,this.config,G);if(H)$(A).then(M=>H(null,M.output),M=>H(M)).catch(()=>{});else return $(A).then(M=>M.output)}destroy(){this.config.requestHandler.destroy&&this.config.requestHandler.destroy()}}function transformToString(E,A="utf-8"){return A==="base64"?toBase64(E):toUtf8$3(E)}function transformFromString(E,A){return A==="base64"?Uint8ArrayBlobAdapter.mutate(fromBase64(E)):Uint8ArrayBlobAdapter.mutate(fromUtf8$3(E))}class Uint8ArrayBlobAdapter extends Uint8Array{static fromString(A,R="utf-8"){switch(typeof A){case"string":return transformFromString(A,R);default:throw new Error(`Unsupported conversion from ${typeof A} to Uint8ArrayBlobAdapter.`)}}static mutate(A){return Object.setPrototypeOf(A,Uint8ArrayBlobAdapter.prototype),A}transformToString(A="utf-8"){return transformToString(this,A)}}const SHORT_TO_HEX={},HEX_TO_SHORT={};for(let E=0;E<256;E++){let A=E.toString(16).toLowerCase();A.length===1&&(A=`0${A}`),SHORT_TO_HEX[E]=A,HEX_TO_SHORT[A]=E}function fromHex(E){if(E.length%2!==0)throw new Error("Hex encoded strings must have an even number length");const A=new Uint8Array(E.length/2);for(let R=0;R<E.length;R+=2){const F=E.slice(R,R+2).toLowerCase();if(F in HEX_TO_SHORT)A[R/2]=HEX_TO_SHORT[F];else throw new Error(`Cannot decode unrecognized sequence ${F} as hexadecimal`)}return A}function toHex(E){let A="";for(let R=0;R<E.byteLength;R++)A+=SHORT_TO_HEX[E[R]];return A}const collectBody=async(E=new Uint8Array,A)=>{if(E instanceof Uint8Array)return Uint8ArrayBlobAdapter.mutate(E);if(!E)return Uint8ArrayBlobAdapter.mutate(new Uint8Array);const R=A.streamCollector(E);return Uint8ArrayBlobAdapter.mutate(await R)};class Command{constructor(){this.middlewareStack=constructStack()}static classBuilder(){return new ClassBuilder}resolveMiddlewareWithContext(A,R,F,{middlewareFn:G,clientName:H,commandName:$,inputFilterSensitiveLog:M,outputFilterSensitiveLog:ye,smithyContext:oe,additionalContext:Ee,CommandCtor:we}){for(const ht of G.bind(this)(we,A,R,F))this.middlewareStack.use(ht);const ce=A.concat(this.middlewareStack),{logger:$e}=R,Ge={logger:$e,clientName:H,commandName:$,inputFilterSensitiveLog:M,outputFilterSensitiveLog:ye,[SMITHY_CONTEXT_KEY]:{...oe},...Ee},{requestHandler:Xe}=R;return ce.resolve(ht=>Xe.handle(ht.request,F||{}),Ge)}}class ClassBuilder{constructor(){this._init=()=>{},this._ep={},this._middlewareFn=()=>[],this._commandName="",this._clientName="",this._additionalContext={},this._smithyContext={},this._inputFilterSensitiveLog=A=>A,this._outputFilterSensitiveLog=A=>A,this._serializer=null,this._deserializer=null}init(A){this._init=A}ep(A){return this._ep=A,this}m(A){return this._middlewareFn=A,this}s(A,R,F={}){return this._smithyContext={service:A,operation:R,...F},this}c(A={}){return this._additionalContext=A,this}n(A,R){return this._clientName=A,this._commandName=R,this}f(A=F=>F,R=F=>F){return this._inputFilterSensitiveLog=A,this._outputFilterSensitiveLog=R,this}ser(A){return this._serializer=A,this}de(A){return this._deserializer=A,this}build(){const A=this;let R;return R=class extends Command{static getEndpointParameterInstructions(){return A._ep}constructor(...[F]){super(),this.serialize=A._serializer,this.deserialize=A._deserializer,this.input=F??{},A._init(this)}resolveMiddleware(F,G,H){return this.resolveMiddlewareWithContext(F,G,H,{CommandCtor:R,middlewareFn:A._middlewareFn,clientName:A._clientName,commandName:A._commandName,inputFilterSensitiveLog:A._inputFilterSensitiveLog,outputFilterSensitiveLog:A._outputFilterSensitiveLog,smithyContext:A._smithyContext,additionalContext:A._additionalContext})}}}}const SENSITIVE_STRING="***SensitiveInformation***",expectBoolean=E=>{if(E!=null){if(typeof E=="number"){if((E===0||E===1)&&logger.warn(stackTraceWarning(`Expected boolean, got ${typeof E}: ${E}`)),E===0)return!1;if(E===1)return!0}if(typeof E=="string"){const A=E.toLowerCase();if((A==="false"||A==="true")&&logger.warn(stackTraceWarning(`Expected boolean, got ${typeof E}: ${E}`)),A==="false")return!1;if(A==="true")return!0}if(typeof E=="boolean")return E;throw new TypeError(`Expected boolean, got ${typeof E}: ${E}`)}},expectNumber=E=>{if(E!=null){if(typeof E=="string"){const A=parseFloat(E);if(!Number.isNaN(A))return String(A)!==String(E)&&logger.warn(stackTraceWarning(`Expected number but observed string: ${E}`)),A}if(typeof E=="number")return E;throw new TypeError(`Expected number, got ${typeof E}: ${E}`)}},expectLong=E=>{if(E!=null){if(Number.isInteger(E)&&!Number.isNaN(E))return E;throw new TypeError(`Expected integer, got ${typeof E}: ${E}`)}},expectInt32=E=>expectSizedInt(E,32),expectSizedInt=(E,A)=>{const R=expectLong(E);if(R!==void 0&&castInt(R,A)!==R)throw new TypeError(`Expected ${A}-bit integer, got ${E}`);return R},castInt=(E,A)=>{switch(A){case 32:return Int32Array.of(E)[0];case 16:return Int16Array.of(E)[0];case 8:return Int8Array.of(E)[0]}},expectNonNull=(E,A)=>{if(E==null)throw A?new TypeError(`Expected a non-null value for ${A}`):new TypeError("Expected a non-null value");return E},expectObject=E=>{if(E==null)return;if(typeof E=="object"&&!Array.isArray(E))return E;const A=Array.isArray(E)?"array":typeof E;throw new TypeError(`Expected object, got ${A}: ${E}`)},expectString=E=>{if(E!=null){if(typeof E=="string")return E;if(["boolean","number","bigint"].includes(typeof E))return logger.warn(stackTraceWarning(`Expected string, got ${typeof E}: ${E}`)),String(E);throw new TypeError(`Expected string, got ${typeof E}: ${E}`)}},limitedParseDouble=E=>typeof E=="string"?parseFloatString(E):expectNumber(E),parseFloatString=E=>{switch(E){case"NaN":return NaN;case"Infinity":return 1/0;case"-Infinity":return-1/0;default:throw new Error(`Unable to parse float value: ${E}`)}},stackTraceWarning=E=>String(new TypeError(E).stack||E).split(`
`).slice(0,5).filter(A=>!A.includes("stackTraceWarning")).join(`
`),logger={warn:console.warn};class ServiceException extends Error{constructor(A){super(A.message),Object.setPrototypeOf(this,ServiceException.prototype),this.name=A.name,this.$fault=A.$fault,this.$metadata=A.$metadata}}const decorateServiceException=(E,A={})=>{Object.entries(A).filter(([,F])=>F!==void 0).forEach(([F,G])=>{(E[F]==null||E[F]==="")&&(E[F]=G)});const R=E.message||E.Message||"UnknownError";return E.message=R,delete E.Message,E},throwDefaultError$1=({output:E,parsedBody:A,exceptionCtor:R,errorCode:F})=>{const G=deserializeMetadata$1(E),H=G.httpStatusCode?G.httpStatusCode+"":void 0,$=new R({name:(A==null?void 0:A.code)||(A==null?void 0:A.Code)||F||H||"UnknownError",$fault:"client",$metadata:G});throw decorateServiceException($,A)},withBaseException=E=>({output:A,parsedBody:R,errorCode:F})=>{throwDefaultError$1({output:A,parsedBody:R,exceptionCtor:E,errorCode:F})},deserializeMetadata$1=E=>({httpStatusCode:E.statusCode,requestId:E.headers["x-amzn-requestid"]??E.headers["x-amzn-request-id"]??E.headers["x-amz-request-id"],extendedRequestId:E.headers["x-amz-id-2"],cfId:E.headers["x-amz-cf-id"]}),loadConfigsForDefaultMode=E=>{switch(E){case"standard":return{retryMode:"standard",connectionTimeout:3100};case"in-region":return{retryMode:"standard",connectionTimeout:1100};case"cross-region":return{retryMode:"standard",connectionTimeout:3100};case"mobile":return{retryMode:"standard",connectionTimeout:3e4};default:return{}}},getChecksumConfiguration=E=>{const A=[];for(const R in AlgorithmId){const F=AlgorithmId[R];E[F]!==void 0&&A.push({algorithmId:()=>F,checksumConstructor:()=>E[F]})}return{_checksumAlgorithms:A,addChecksumAlgorithm(R){this._checksumAlgorithms.push(R)},checksumAlgorithms(){return this._checksumAlgorithms}}},resolveChecksumRuntimeConfig=E=>{const A={};return E.checksumAlgorithms().forEach(R=>{A[R.algorithmId()]=R.checksumConstructor()}),A},getRetryConfiguration=E=>{let A=E.retryStrategy;return{setRetryStrategy(R){A=R},retryStrategy(){return A}}},resolveRetryRuntimeConfig=E=>{const A={};return A.retryStrategy=E.retryStrategy(),A},getDefaultExtensionConfiguration=E=>({...getChecksumConfiguration(E),...getRetryConfiguration(E)}),resolveDefaultRuntimeConfig=E=>({...resolveChecksumRuntimeConfig(E),...resolveRetryRuntimeConfig(E)});function extendedEncodeURIComponent(E){return encodeURIComponent(E).replace(/[!'()*]/g,function(A){return"%"+A.charCodeAt(0).toString(16).toUpperCase()})}const StringWrapper=function(){const E=Object.getPrototypeOf(this).constructor,A=Function.bind.apply(String,[null,...arguments]),R=new A;return Object.setPrototypeOf(R,E.prototype),R};StringWrapper.prototype=Object.create(String.prototype,{constructor:{value:StringWrapper,enumerable:!1,writable:!0,configurable:!0}});Object.setPrototypeOf(StringWrapper,String);function map(E,A,R){let F,G,H;if(typeof A>"u"&&typeof R>"u")F={},H=E;else{if(F=E,typeof A=="function")return G=A,H=R,mapWithFilter(F,G,H);H=A}for(const $ of Object.keys(H)){if(!Array.isArray(H[$])){F[$]=H[$];continue}applyInstruction(F,null,H,$)}return F}const take=(E,A)=>{const R={};for(const F in A)applyInstruction(R,E,A,F);return R},mapWithFilter=(E,A,R)=>map(E,Object.entries(R).reduce((F,[G,H])=>(Array.isArray(H)?F[G]=H:typeof H=="function"?F[G]=[A,H()]:F[G]=[A,H],F),{})),applyInstruction=(E,A,R,F)=>{if(A!==null){let $=R[F];typeof $=="function"&&($=[,$]);const[M=nonNullish,ye=pass,oe=F]=$;(typeof M=="function"&&M(A[oe])||typeof M!="function"&&M)&&(E[F]=ye(A[oe]));return}let[G,H]=R[F];if(typeof H=="function"){let $;const M=G===void 0&&($=H())!=null,ye=typeof G=="function"&&!!G(void 0)||typeof G!="function"&&!!G;M?E[F]=$:ye&&(E[F]=H())}else{const $=G===void 0&&H!=null,M=typeof G=="function"&&!!G(H)||typeof G!="function"&&!!G;($||M)&&(E[F]=H)}},nonNullish=E=>E!=null,pass=E=>E,resolvedPath=(E,A,R,F,G,H)=>{if(A!=null&&A[R]!==void 0){const $=F();if($.length<=0)throw new Error("Empty value provided for input HTTP label: "+R+".");E=E.replace(G,H?$.split("/").map(M=>extendedEncodeURIComponent(M)).join("/"):extendedEncodeURIComponent($))}else throw new Error("No value provided for input HTTP label: "+R+".");return E},serializeFloat=E=>{if(E!==E)return"NaN";switch(E){case 1/0:return"Infinity";case-1/0:return"-Infinity";default:return E}},_json=E=>{if(E==null)return{};if(Array.isArray(E))return E.filter(A=>A!=null).map(_json);if(typeof E=="object"){const A={};for(const R of Object.keys(E))E[R]!=null&&(A[R]=_json(E[R]));return A}return E};var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(E){return E&&E.__esModule&&Object.prototype.hasOwnProperty.call(E,"default")?E.default:E}function getAugmentedNamespace(E){if(E.__esModule)return E;var A=E.default;if(typeof A=="function"){var R=function F(){return this instanceof F?Reflect.construct(A,arguments,this.constructor):A.apply(this,arguments)};R.prototype=A.prototype}else R={};return Object.defineProperty(R,"__esModule",{value:!0}),Object.keys(E).forEach(function(F){var G=Object.getOwnPropertyDescriptor(E,F);Object.defineProperty(R,F,G.get?G:{enumerable:!0,get:function(){return E[F]}})}),R}const fromUtf8$2=E=>{const A=[];for(let R=0,F=E.length;R<F;R++){const G=E.charCodeAt(R);if(G<128)A.push(G);else if(G<2048)A.push(G>>6|192,G&63|128);else if(R+1<E.length&&(G&64512)===55296&&(E.charCodeAt(R+1)&64512)===56320){const H=65536+((G&1023)<<10)+(E.charCodeAt(++R)&1023);A.push(H>>18|240,H>>12&63|128,H>>6&63|128,H&63|128)}else A.push(G>>12|224,G>>6&63|128,G&63|128)}return Uint8Array.from(A)},toUtf8$2=E=>{let A="";for(let R=0,F=E.length;R<F;R++){const G=E[R];if(G<128)A+=String.fromCharCode(G);else if(192<=G&&G<224){const H=E[++R];A+=String.fromCharCode((G&31)<<6|H&63)}else if(240<=G&&G<365){const $="%"+[G,E[++R],E[++R],E[++R]].map(M=>M.toString(16)).join("%");A+=decodeURIComponent($)}else A+=String.fromCharCode((G&15)<<12|(E[++R]&63)<<6|E[++R]&63)}return A};function fromUtf8$1(E){return new TextEncoder().encode(E)}function toUtf8$1(E){return new TextDecoder("utf-8").decode(E)}const fromUtf8=E=>typeof TextEncoder=="function"?fromUtf8$1(E):fromUtf8$2(E),toUtf8=E=>typeof TextDecoder=="function"?toUtf8$1(E):toUtf8$2(E),distEs$1=Object.freeze(Object.defineProperty({__proto__:null,fromUtf8,toUtf8},Symbol.toStringTag,{value:"Module"})),require$$2=getAugmentedNamespace(distEs$1),fallbackWindow={};function locateWindow(){return typeof window<"u"?window:typeof self<"u"?self:fallbackWindow}const distEs=Object.freeze(Object.defineProperty({__proto__:null,locateWindow},Symbol.toStringTag,{value:"Module"})),require$$5=getAugmentedNamespace(distEs),BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"};class Utils{static getFirstMatch(A,R){const F=R.match(A);return F&&F.length>0&&F[1]||""}static getSecondMatch(A,R){const F=R.match(A);return F&&F.length>1&&F[2]||""}static matchAndReturnConst(A,R,F){if(A.test(R))return F}static getWindowsVersionName(A){switch(A){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}}static getMacOSVersionName(A){const R=A.split(".").splice(0,2).map(F=>parseInt(F,10)||0);if(R.push(0),R[0]===10)switch(R[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}}static getAndroidVersionName(A){const R=A.split(".").splice(0,2).map(F=>parseInt(F,10)||0);if(R.push(0),!(R[0]===1&&R[1]<5)){if(R[0]===1&&R[1]<6)return"Cupcake";if(R[0]===1&&R[1]>=6)return"Donut";if(R[0]===2&&R[1]<2)return"Eclair";if(R[0]===2&&R[1]===2)return"Froyo";if(R[0]===2&&R[1]>2)return"Gingerbread";if(R[0]===3)return"Honeycomb";if(R[0]===4&&R[1]<1)return"Ice Cream Sandwich";if(R[0]===4&&R[1]<4)return"Jelly Bean";if(R[0]===4&&R[1]>=4)return"KitKat";if(R[0]===5)return"Lollipop";if(R[0]===6)return"Marshmallow";if(R[0]===7)return"Nougat";if(R[0]===8)return"Oreo";if(R[0]===9)return"Pie"}}static getVersionPrecision(A){return A.split(".").length}static compareVersions(A,R,F=!1){const G=Utils.getVersionPrecision(A),H=Utils.getVersionPrecision(R);let $=Math.max(G,H),M=0;const ye=Utils.map([A,R],oe=>{const Ee=$-Utils.getVersionPrecision(oe),we=oe+new Array(Ee+1).join(".0");return Utils.map(we.split("."),ce=>new Array(20-ce.length).join("0")+ce).reverse()});for(F&&(M=$-Math.min(G,H)),$-=1;$>=M;){if(ye[0][$]>ye[1][$])return 1;if(ye[0][$]===ye[1][$]){if($===M)return 0;$-=1}else if(ye[0][$]<ye[1][$])return-1}}static map(A,R){const F=[];let G;if(Array.prototype.map)return Array.prototype.map.call(A,R);for(G=0;G<A.length;G+=1)F.push(R(A[G]));return F}static find(A,R){let F,G;if(Array.prototype.find)return Array.prototype.find.call(A,R);for(F=0,G=A.length;F<G;F+=1){const H=A[F];if(R(H,F))return H}}static assign(A,...R){const F=A;let G,H;if(Object.assign)return Object.assign(A,...R);for(G=0,H=R.length;G<H;G+=1){const $=R[G];typeof $=="object"&&$!==null&&Object.keys($).forEach(ye=>{F[ye]=$[ye]})}return A}static getBrowserAlias(A){return BROWSER_ALIASES_MAP[A]}static getBrowserTypeByAlias(A){return BROWSER_MAP[A]||""}}const commonVersionIdentifier=/version\/(\d+(\.?_?\d+)+)/i,browsersList=[{test:[/googlebot/i],describe(E){const A={name:"Googlebot"},R=Utils.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,E)||Utils.getFirstMatch(commonVersionIdentifier,E);return R&&(A.version=R),A}},{test:[/opera/i],describe(E){const A={name:"Opera"},R=Utils.getFirstMatch(commonVersionIdentifier,E)||Utils.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,E);return R&&(A.version=R),A}},{test:[/opr\/|opios/i],describe(E){const A={name:"Opera"},R=Utils.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,E)||Utils.getFirstMatch(commonVersionIdentifier,E);return R&&(A.version=R),A}},{test:[/SamsungBrowser/i],describe(E){const A={name:"Samsung Internet for Android"},R=Utils.getFirstMatch(commonVersionIdentifier,E)||Utils.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,E);return R&&(A.version=R),A}},{test:[/Whale/i],describe(E){const A={name:"NAVER Whale Browser"},R=Utils.getFirstMatch(commonVersionIdentifier,E)||Utils.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,E);return R&&(A.version=R),A}},{test:[/MZBrowser/i],describe(E){const A={name:"MZ Browser"},R=Utils.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,E)||Utils.getFirstMatch(commonVersionIdentifier,E);return R&&(A.version=R),A}},{test:[/focus/i],describe(E){const A={name:"Focus"},R=Utils.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,E)||Utils.getFirstMatch(commonVersionIdentifier,E);return R&&(A.version=R),A}},{test:[/swing/i],describe(E){const A={name:"Swing"},R=Utils.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,E)||Utils.getFirstMatch(commonVersionIdentifier,E);return R&&(A.version=R),A}},{test:[/coast/i],describe(E){const A={name:"Opera Coast"},R=Utils.getFirstMatch(commonVersionIdentifier,E)||Utils.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,E);return R&&(A.version=R),A}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe(E){const A={name:"Opera Touch"},R=Utils.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,E)||Utils.getFirstMatch(commonVersionIdentifier,E);return R&&(A.version=R),A}},{test:[/yabrowser/i],describe(E){const A={name:"Yandex Browser"},R=Utils.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,E)||Utils.getFirstMatch(commonVersionIdentifier,E);return R&&(A.version=R),A}},{test:[/ucbrowser/i],describe(E){const A={name:"UC Browser"},R=Utils.getFirstMatch(commonVersionIdentifier,E)||Utils.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,E);return R&&(A.version=R),A}},{test:[/Maxthon|mxios/i],describe(E){const A={name:"Maxthon"},R=Utils.getFirstMatch(commonVersionIdentifier,E)||Utils.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,E);return R&&(A.version=R),A}},{test:[/epiphany/i],describe(E){const A={name:"Epiphany"},R=Utils.getFirstMatch(commonVersionIdentifier,E)||Utils.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,E);return R&&(A.version=R),A}},{test:[/puffin/i],describe(E){const A={name:"Puffin"},R=Utils.getFirstMatch(commonVersionIdentifier,E)||Utils.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,E);return R&&(A.version=R),A}},{test:[/sleipnir/i],describe(E){const A={name:"Sleipnir"},R=Utils.getFirstMatch(commonVersionIdentifier,E)||Utils.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,E);return R&&(A.version=R),A}},{test:[/k-meleon/i],describe(E){const A={name:"K-Meleon"},R=Utils.getFirstMatch(commonVersionIdentifier,E)||Utils.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,E);return R&&(A.version=R),A}},{test:[/micromessenger/i],describe(E){const A={name:"WeChat"},R=Utils.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,E)||Utils.getFirstMatch(commonVersionIdentifier,E);return R&&(A.version=R),A}},{test:[/qqbrowser/i],describe(E){const A={name:/qqbrowserlite/i.test(E)?"QQ Browser Lite":"QQ Browser"},R=Utils.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,E)||Utils.getFirstMatch(commonVersionIdentifier,E);return R&&(A.version=R),A}},{test:[/msie|trident/i],describe(E){const A={name:"Internet Explorer"},R=Utils.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,E);return R&&(A.version=R),A}},{test:[/\sedg\//i],describe(E){const A={name:"Microsoft Edge"},R=Utils.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,E);return R&&(A.version=R),A}},{test:[/edg([ea]|ios)/i],describe(E){const A={name:"Microsoft Edge"},R=Utils.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,E);return R&&(A.version=R),A}},{test:[/vivaldi/i],describe(E){const A={name:"Vivaldi"},R=Utils.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,E);return R&&(A.version=R),A}},{test:[/seamonkey/i],describe(E){const A={name:"SeaMonkey"},R=Utils.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,E);return R&&(A.version=R),A}},{test:[/sailfish/i],describe(E){const A={name:"Sailfish"},R=Utils.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,E);return R&&(A.version=R),A}},{test:[/silk/i],describe(E){const A={name:"Amazon Silk"},R=Utils.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,E);return R&&(A.version=R),A}},{test:[/phantom/i],describe(E){const A={name:"PhantomJS"},R=Utils.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,E);return R&&(A.version=R),A}},{test:[/slimerjs/i],describe(E){const A={name:"SlimerJS"},R=Utils.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,E);return R&&(A.version=R),A}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe(E){const A={name:"BlackBerry"},R=Utils.getFirstMatch(commonVersionIdentifier,E)||Utils.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,E);return R&&(A.version=R),A}},{test:[/(web|hpw)[o0]s/i],describe(E){const A={name:"WebOS Browser"},R=Utils.getFirstMatch(commonVersionIdentifier,E)||Utils.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,E);return R&&(A.version=R),A}},{test:[/bada/i],describe(E){const A={name:"Bada"},R=Utils.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,E);return R&&(A.version=R),A}},{test:[/tizen/i],describe(E){const A={name:"Tizen"},R=Utils.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,E)||Utils.getFirstMatch(commonVersionIdentifier,E);return R&&(A.version=R),A}},{test:[/qupzilla/i],describe(E){const A={name:"QupZilla"},R=Utils.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,E)||Utils.getFirstMatch(commonVersionIdentifier,E);return R&&(A.version=R),A}},{test:[/firefox|iceweasel|fxios/i],describe(E){const A={name:"Firefox"},R=Utils.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,E);return R&&(A.version=R),A}},{test:[/electron/i],describe(E){const A={name:"Electron"},R=Utils.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,E);return R&&(A.version=R),A}},{test:[/MiuiBrowser/i],describe(E){const A={name:"Miui"},R=Utils.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,E);return R&&(A.version=R),A}},{test:[/chromium/i],describe(E){const A={name:"Chromium"},R=Utils.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,E)||Utils.getFirstMatch(commonVersionIdentifier,E);return R&&(A.version=R),A}},{test:[/chrome|crios|crmo/i],describe(E){const A={name:"Chrome"},R=Utils.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,E);return R&&(A.version=R),A}},{test:[/GSA/i],describe(E){const A={name:"Google Search"},R=Utils.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,E);return R&&(A.version=R),A}},{test(E){const A=!E.test(/like android/i),R=E.test(/android/i);return A&&R},describe(E){const A={name:"Android Browser"},R=Utils.getFirstMatch(commonVersionIdentifier,E);return R&&(A.version=R),A}},{test:[/playstation 4/i],describe(E){const A={name:"PlayStation 4"},R=Utils.getFirstMatch(commonVersionIdentifier,E);return R&&(A.version=R),A}},{test:[/safari|applewebkit/i],describe(E){const A={name:"Safari"},R=Utils.getFirstMatch(commonVersionIdentifier,E);return R&&(A.version=R),A}},{test:[/.*/i],describe(E){const A=/^(.*)\/(.*) /,R=/^(.*)\/(.*)[ \t]\((.*)/,G=E.search("\\(")!==-1?R:A;return{name:Utils.getFirstMatch(G,E),version:Utils.getSecondMatch(G,E)}}}],osParsersList=[{test:[/Roku\/DVP/],describe(E){const A=Utils.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,E);return{name:OS_MAP.Roku,version:A}}},{test:[/windows phone/i],describe(E){const A=Utils.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,E);return{name:OS_MAP.WindowsPhone,version:A}}},{test:[/windows /i],describe(E){const A=Utils.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,E),R=Utils.getWindowsVersionName(A);return{name:OS_MAP.Windows,version:A,versionName:R}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe(E){const A={name:OS_MAP.iOS},R=Utils.getSecondMatch(/(Version\/)(\d[\d.]+)/,E);return R&&(A.version=R),A}},{test:[/macintosh/i],describe(E){const A=Utils.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,E).replace(/[_\s]/g,"."),R=Utils.getMacOSVersionName(A),F={name:OS_MAP.MacOS,version:A};return R&&(F.versionName=R),F}},{test:[/(ipod|iphone|ipad)/i],describe(E){const A=Utils.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,E).replace(/[_\s]/g,".");return{name:OS_MAP.iOS,version:A}}},{test(E){const A=!E.test(/like android/i),R=E.test(/android/i);return A&&R},describe(E){const A=Utils.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,E),R=Utils.getAndroidVersionName(A),F={name:OS_MAP.Android,version:A};return R&&(F.versionName=R),F}},{test:[/(web|hpw)[o0]s/i],describe(E){const A=Utils.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,E),R={name:OS_MAP.WebOS};return A&&A.length&&(R.version=A),R}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe(E){const A=Utils.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,E)||Utils.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,E)||Utils.getFirstMatch(/\bbb(\d+)/i,E);return{name:OS_MAP.BlackBerry,version:A}}},{test:[/bada/i],describe(E){const A=Utils.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,E);return{name:OS_MAP.Bada,version:A}}},{test:[/tizen/i],describe(E){const A=Utils.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,E);return{name:OS_MAP.Tizen,version:A}}},{test:[/linux/i],describe(){return{name:OS_MAP.Linux}}},{test:[/CrOS/],describe(){return{name:OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe(E){const A=Utils.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,E);return{name:OS_MAP.PlayStation4,version:A}}}],platformParsersList=[{test:[/googlebot/i],describe(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe(E){const A=Utils.getFirstMatch(/(can-l01)/i,E)&&"Nova",R={type:PLATFORMS_MAP.mobile,vendor:"Huawei"};return A&&(R.model=A),R}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe(){return{type:PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe(){return{type:PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe(){return{type:PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe(){return{type:PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe(){return{type:PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe(){return{type:PLATFORMS_MAP.tablet}}},{test(E){const A=E.test(/ipod|iphone/i),R=E.test(/like (ipod|iphone)/i);return A&&!R},describe(E){const A=Utils.getFirstMatch(/(ipod|iphone)/i,E);return{type:PLATFORMS_MAP.mobile,vendor:"Apple",model:A}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe(){return{type:PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe(){return{type:PLATFORMS_MAP.mobile}}},{test(E){return E.getBrowserName(!0)==="blackberry"},describe(){return{type:PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test(E){return E.getBrowserName(!0)==="bada"},describe(){return{type:PLATFORMS_MAP.mobile}}},{test(E){return E.getBrowserName()==="windows phone"},describe(){return{type:PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test(E){const A=Number(String(E.getOSVersion()).split(".")[0]);return E.getOSName(!0)==="android"&&A>=3},describe(){return{type:PLATFORMS_MAP.tablet}}},{test(E){return E.getOSName(!0)==="android"},describe(){return{type:PLATFORMS_MAP.mobile}}},{test(E){return E.getOSName(!0)==="macos"},describe(){return{type:PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test(E){return E.getOSName(!0)==="windows"},describe(){return{type:PLATFORMS_MAP.desktop}}},{test(E){return E.getOSName(!0)==="linux"},describe(){return{type:PLATFORMS_MAP.desktop}}},{test(E){return E.getOSName(!0)==="playstation 4"},describe(){return{type:PLATFORMS_MAP.tv}}},{test(E){return E.getOSName(!0)==="roku"},describe(){return{type:PLATFORMS_MAP.tv}}}],enginesParsersList=[{test(E){return E.getBrowserName(!0)==="microsoft edge"},describe(E){if(/\sedg\//i.test(E))return{name:ENGINE_MAP.Blink};const R=Utils.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,E);return{name:ENGINE_MAP.EdgeHTML,version:R}}},{test:[/trident/i],describe(E){const A={name:ENGINE_MAP.Trident},R=Utils.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,E);return R&&(A.version=R),A}},{test(E){return E.test(/presto/i)},describe(E){const A={name:ENGINE_MAP.Presto},R=Utils.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,E);return R&&(A.version=R),A}},{test(E){const A=E.test(/gecko/i),R=E.test(/like gecko/i);return A&&!R},describe(E){const A={name:ENGINE_MAP.Gecko},R=Utils.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,E);return R&&(A.version=R),A}},{test:[/(apple)?webkit\/537\.36/i],describe(){return{name:ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe(E){const A={name:ENGINE_MAP.WebKit},R=Utils.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,E);return R&&(A.version=R),A}}];class Parser{constructor(A,R=!1){if(A==null||A==="")throw new Error("UserAgent parameter can't be empty");this._ua=A,this.parsedResult={},R!==!0&&this.parse()}getUA(){return this._ua}test(A){return A.test(this._ua)}parseBrowser(){this.parsedResult.browser={};const A=Utils.find(browsersList,R=>{if(typeof R.test=="function")return R.test(this);if(R.test instanceof Array)return R.test.some(F=>this.test(F));throw new Error("Browser's test function is not valid")});return A&&(this.parsedResult.browser=A.describe(this.getUA())),this.parsedResult.browser}getBrowser(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()}getBrowserName(A){return A?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""}getBrowserVersion(){return this.getBrowser().version}getOS(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()}parseOS(){this.parsedResult.os={};const A=Utils.find(osParsersList,R=>{if(typeof R.test=="function")return R.test(this);if(R.test instanceof Array)return R.test.some(F=>this.test(F));throw new Error("Browser's test function is not valid")});return A&&(this.parsedResult.os=A.describe(this.getUA())),this.parsedResult.os}getOSName(A){const{name:R}=this.getOS();return A?String(R).toLowerCase()||"":R||""}getOSVersion(){return this.getOS().version}getPlatform(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()}getPlatformType(A=!1){const{type:R}=this.getPlatform();return A?String(R).toLowerCase()||"":R||""}parsePlatform(){this.parsedResult.platform={};const A=Utils.find(platformParsersList,R=>{if(typeof R.test=="function")return R.test(this);if(R.test instanceof Array)return R.test.some(F=>this.test(F));throw new Error("Browser's test function is not valid")});return A&&(this.parsedResult.platform=A.describe(this.getUA())),this.parsedResult.platform}getEngine(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()}getEngineName(A){return A?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""}parseEngine(){this.parsedResult.engine={};const A=Utils.find(enginesParsersList,R=>{if(typeof R.test=="function")return R.test(this);if(R.test instanceof Array)return R.test.some(F=>this.test(F));throw new Error("Browser's test function is not valid")});return A&&(this.parsedResult.engine=A.describe(this.getUA())),this.parsedResult.engine}parse(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this}getResult(){return Utils.assign({},this.parsedResult)}satisfies(A){const R={};let F=0;const G={};let H=0;if(Object.keys(A).forEach(M=>{const ye=A[M];typeof ye=="string"?(G[M]=ye,H+=1):typeof ye=="object"&&(R[M]=ye,F+=1)}),F>0){const M=Object.keys(R),ye=Utils.find(M,Ee=>this.isOS(Ee));if(ye){const Ee=this.satisfies(R[ye]);if(Ee!==void 0)return Ee}const oe=Utils.find(M,Ee=>this.isPlatform(Ee));if(oe){const Ee=this.satisfies(R[oe]);if(Ee!==void 0)return Ee}}if(H>0){const M=Object.keys(G),ye=Utils.find(M,oe=>this.isBrowser(oe,!0));if(ye!==void 0)return this.compareVersion(G[ye])}}isBrowser(A,R=!1){const F=this.getBrowserName().toLowerCase();let G=A.toLowerCase();const H=Utils.getBrowserTypeByAlias(G);return R&&H&&(G=H.toLowerCase()),G===F}compareVersion(A){let R=[0],F=A,G=!1;const H=this.getBrowserVersion();if(typeof H=="string")return A[0]===">"||A[0]==="<"?(F=A.substr(1),A[1]==="="?(G=!0,F=A.substr(2)):R=[],A[0]===">"?R.push(1):R.push(-1)):A[0]==="="?F=A.substr(1):A[0]==="~"&&(G=!0,F=A.substr(1)),R.indexOf(Utils.compareVersions(H,F,G))>-1}isOS(A){return this.getOSName(!0)===String(A).toLowerCase()}isPlatform(A){return this.getPlatformType(!0)===String(A).toLowerCase()}isEngine(A){return this.getEngineName(!0)===String(A).toLowerCase()}is(A,R=!1){return this.isBrowser(A,R)||this.isOS(A)||this.isPlatform(A)}some(A=[]){return A.some(R=>this.is(R))}}/*!
 * Bowser - a browser detector
 * https://github.com/lancedikson/bowser
 * MIT License | (c) Dustin Diaz 2012-2015
 * MIT License | (c) Denis Demchenko 2015-2019
 */class Bowser{static getParser(A,R=!1){if(typeof A!="string")throw new Error("UserAgent should be a string");return new Parser(A,R)}static parse(A){return new Parser(A).getResult()}static get BROWSER_MAP(){return BROWSER_MAP}static get ENGINE_MAP(){return ENGINE_MAP}static get OS_MAP(){return OS_MAP}static get PLATFORMS_MAP(){return PLATFORMS_MAP}}async function withAPIKey(E){return{getLocationClientConfig:()=>({signer:{sign:async A=>{var R;return A.query=Object.assign({key:E},(R=A.query)!==null&&R!==void 0?R:{}),A}},credentials:async()=>({})})}}function resolveHostHeaderConfig(E){return E}const hostHeaderMiddleware=E=>A=>async R=>{if(!HttpRequest.isInstance(R.request))return A(R);const{request:F}=R,{handlerProtocol:G=""}=E.requestHandler.metadata||{};if(G.indexOf("h2")>=0&&!F.headers[":authority"])delete F.headers.host,F.headers[":authority"]=F.hostname+(F.port?":"+F.port:"");else if(!F.headers.host){let H=F.hostname;F.port!=null&&(H+=`:${F.port}`),F.headers.host=H}return A(R)},hostHeaderMiddlewareOptions={name:"hostHeaderMiddleware",step:"build",priority:"low",tags:["HOST"],override:!0},getHostHeaderPlugin=E=>({applyToStack:A=>{A.add(hostHeaderMiddleware(E),hostHeaderMiddlewareOptions)}}),loggerMiddleware=()=>(E,A)=>async R=>{var F,G;try{const H=await E(R),{clientName:$,commandName:M,logger:ye,dynamoDbDocumentClientOptions:oe={}}=A,{overrideInputFilterSensitiveLog:Ee,overrideOutputFilterSensitiveLog:we}=oe,ce=Ee??A.inputFilterSensitiveLog,$e=we??A.outputFilterSensitiveLog,{$metadata:Ge,...Xe}=H.output;return(F=ye==null?void 0:ye.info)==null||F.call(ye,{clientName:$,commandName:M,input:ce(R.input),output:$e(Xe),metadata:Ge}),H}catch(H){const{clientName:$,commandName:M,logger:ye,dynamoDbDocumentClientOptions:oe={}}=A,{overrideInputFilterSensitiveLog:Ee}=oe,we=Ee??A.inputFilterSensitiveLog;throw(G=ye==null?void 0:ye.error)==null||G.call(ye,{clientName:$,commandName:M,input:we(R.input),error:H,metadata:H.$metadata}),H}},loggerMiddlewareOptions={name:"loggerMiddleware",tags:["LOGGER"],step:"initialize",override:!0},getLoggerPlugin=E=>({applyToStack:A=>{A.add(loggerMiddleware(),loggerMiddlewareOptions)}});var define_process_env_default={};const TRACE_ID_HEADER_NAME="X-Amzn-Trace-Id",ENV_LAMBDA_FUNCTION_NAME="AWS_LAMBDA_FUNCTION_NAME",ENV_TRACE_ID="_X_AMZN_TRACE_ID",recursionDetectionMiddleware=E=>A=>async R=>{const{request:F}=R;if(!HttpRequest.isInstance(F)||E.runtime!=="node"||F.headers.hasOwnProperty(TRACE_ID_HEADER_NAME))return A(R);const G=define_process_env_default[ENV_LAMBDA_FUNCTION_NAME],H=define_process_env_default[ENV_TRACE_ID],$=M=>typeof M=="string"&&M.length>0;return $(G)&&$(H)&&(F.headers[TRACE_ID_HEADER_NAME]=H),A({...R,request:F})},addRecursionDetectionMiddlewareOptions={step:"build",tags:["RECURSION_DETECTION"],name:"recursionDetectionMiddleware",override:!0,priority:"low"},getRecursionDetectionPlugin=E=>({applyToStack:A=>{A.add(recursionDetectionMiddleware(E),addRecursionDetectionMiddlewareOptions)}});function resolveUserAgentConfig(E){return{...E,customUserAgent:typeof E.customUserAgent=="string"?[[E.customUserAgent]]:E.customUserAgent}}const IP_V4_REGEX=new RegExp("^(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}$"),isIpAddress=E=>IP_V4_REGEX.test(E)||E.startsWith("[")&&E.endsWith("]"),VALID_HOST_LABEL_REGEX=new RegExp("^(?!.*-$)(?!-)[a-zA-Z0-9-]{1,63}$"),isValidHostLabel=(E,A=!1)=>{if(!A)return VALID_HOST_LABEL_REGEX.test(E);const R=E.split(".");for(const F of R)if(!isValidHostLabel(F))return!1;return!0},customEndpointFunctions={},debugId="endpoints";function toDebugString(E){return typeof E!="object"||E==null?E:"ref"in E?`$${toDebugString(E.ref)}`:"fn"in E?`${E.fn}(${(E.argv||[]).map(toDebugString).join(", ")})`:JSON.stringify(E,null,2)}class EndpointError extends Error{constructor(A){super(A),this.name="EndpointError"}}const booleanEquals=(E,A)=>E===A,getAttrPathList=E=>{const A=E.split("."),R=[];for(const F of A){const G=F.indexOf("[");if(G!==-1){if(F.indexOf("]")!==F.length-1)throw new EndpointError(`Path: '${E}' does not end with ']'`);const H=F.slice(G+1,-1);if(Number.isNaN(parseInt(H)))throw new EndpointError(`Invalid array index: '${H}' in path: '${E}'`);G!==0&&R.push(F.slice(0,G)),R.push(H)}else R.push(F)}return R},getAttr=(E,A)=>getAttrPathList(A).reduce((R,F)=>{if(typeof R!="object")throw new EndpointError(`Index '${F}' in '${A}' not found in '${JSON.stringify(E)}'`);return Array.isArray(R)?R[parseInt(F)]:R[F]},E),isSet=E=>E!=null,not=E=>!E,DEFAULT_PORTS={[EndpointURLScheme.HTTP]:80,[EndpointURLScheme.HTTPS]:443},parseURL=E=>{const A=(()=>{try{if(E instanceof URL)return E;if(typeof E=="object"&&"hostname"in E){const{hostname:ce,port:$e,protocol:Ge="",path:Xe="",query:ht={}}=E,yt=new URL(`${Ge}//${ce}${$e?`:${$e}`:""}${Xe}`);return yt.search=Object.entries(ht).map(([$t,Ft])=>`${$t}=${Ft}`).join("&"),yt}return new URL(E)}catch{return null}})();if(!A)return console.error(`Unable to parse ${JSON.stringify(E)} as a whatwg URL.`),null;const R=A.href,{host:F,hostname:G,pathname:H,protocol:$,search:M}=A;if(M)return null;const ye=$.slice(0,-1);if(!Object.values(EndpointURLScheme).includes(ye))return null;const oe=isIpAddress(G),Ee=R.includes(`${F}:${DEFAULT_PORTS[ye]}`)||typeof E=="string"&&E.includes(`${F}:${DEFAULT_PORTS[ye]}`),we=`${F}${Ee?`:${DEFAULT_PORTS[ye]}`:""}`;return{scheme:ye,authority:we,path:H,normalizedPath:H.endsWith("/")?H:`${H}/`,isIp:oe}},stringEquals=(E,A)=>E===A,substring=(E,A,R,F)=>A>=R||E.length<R?null:F?E.substring(E.length-R,E.length-A):E.substring(A,R),uriEncode=E=>encodeURIComponent(E).replace(/[!*'()]/g,A=>`%${A.charCodeAt(0).toString(16).toUpperCase()}`),endpointFunctions={booleanEquals,getAttr,isSet,isValidHostLabel,not,parseURL,stringEquals,substring,uriEncode},evaluateTemplate=(E,A)=>{const R=[],F={...A.endpointParams,...A.referenceRecord};let G=0;for(;G<E.length;){const H=E.indexOf("{",G);if(H===-1){R.push(E.slice(G));break}R.push(E.slice(G,H));const $=E.indexOf("}",H);if($===-1){R.push(E.slice(H));break}E[H+1]==="{"&&E[$+1]==="}"&&(R.push(E.slice(H+1,$)),G=$+2);const M=E.substring(H+1,$);if(M.includes("#")){const[ye,oe]=M.split("#");R.push(getAttr(F[ye],oe))}else R.push(F[M]);G=$+1}return R.join("")},getReferenceValue=({ref:E},A)=>({...A.endpointParams,...A.referenceRecord})[E],evaluateExpression=(E,A,R)=>{if(typeof E=="string")return evaluateTemplate(E,R);if(E.fn)return callFunction(E,R);if(E.ref)return getReferenceValue(E,R);throw new EndpointError(`'${A}': ${String(E)} is not a string, function or reference.`)},callFunction=({fn:E,argv:A},R)=>{const F=A.map(H=>["boolean","number"].includes(typeof H)?H:evaluateExpression(H,"arg",R)),G=E.split(".");return G[0]in customEndpointFunctions&&G[1]!=null?customEndpointFunctions[G[0]][G[1]](...F):endpointFunctions[E](...F)},evaluateCondition=({assign:E,...A},R)=>{var G,H;if(E&&E in R.referenceRecord)throw new EndpointError(`'${E}' is already defined in Reference Record.`);const F=callFunction(A,R);return(H=(G=R.logger)==null?void 0:G.debug)==null||H.call(G,debugId,`evaluateCondition: ${toDebugString(A)} = ${toDebugString(F)}`),{result:F===""?!0:!!F,...E!=null&&{toAssign:{name:E,value:F}}}},evaluateConditions=(E=[],A)=>{var F,G;const R={};for(const H of E){const{result:$,toAssign:M}=evaluateCondition(H,{...A,referenceRecord:{...A.referenceRecord,...R}});if(!$)return{result:$};M&&(R[M.name]=M.value,(G=(F=A.logger)==null?void 0:F.debug)==null||G.call(F,debugId,`assign: ${M.name} := ${toDebugString(M.value)}`))}return{result:!0,referenceRecord:R}},getEndpointHeaders=(E,A)=>Object.entries(E).reduce((R,[F,G])=>({...R,[F]:G.map(H=>{const $=evaluateExpression(H,"Header value entry",A);if(typeof $!="string")throw new EndpointError(`Header '${F}' value '${$}' is not a string`);return $})}),{}),getEndpointProperty=(E,A)=>{if(Array.isArray(E))return E.map(R=>getEndpointProperty(R,A));switch(typeof E){case"string":return evaluateTemplate(E,A);case"object":if(E===null)throw new EndpointError(`Unexpected endpoint property: ${E}`);return getEndpointProperties(E,A);case"boolean":return E;default:throw new EndpointError(`Unexpected endpoint property type: ${typeof E}`)}},getEndpointProperties=(E,A)=>Object.entries(E).reduce((R,[F,G])=>({...R,[F]:getEndpointProperty(G,A)}),{}),getEndpointUrl=(E,A)=>{const R=evaluateExpression(E,"Endpoint URL",A);if(typeof R=="string")try{return new URL(R)}catch(F){throw console.error(`Failed to construct URL with ${R}`,F),F}throw new EndpointError(`Endpoint URL must be a string, got ${typeof R}`)},evaluateEndpointRule=(E,A)=>{var Ee,we;const{conditions:R,endpoint:F}=E,{result:G,referenceRecord:H}=evaluateConditions(R,A);if(!G)return;const $={...A,referenceRecord:{...A.referenceRecord,...H}},{url:M,properties:ye,headers:oe}=F;return(we=(Ee=A.logger)==null?void 0:Ee.debug)==null||we.call(Ee,debugId,`Resolving endpoint from template: ${toDebugString(F)}`),{...oe!=null&&{headers:getEndpointHeaders(oe,$)},...ye!=null&&{properties:getEndpointProperties(ye,$)},url:getEndpointUrl(M,$)}},evaluateErrorRule=(E,A)=>{const{conditions:R,error:F}=E,{result:G,referenceRecord:H}=evaluateConditions(R,A);if(G)throw new EndpointError(evaluateExpression(F,"Error",{...A,referenceRecord:{...A.referenceRecord,...H}}))},evaluateTreeRule=(E,A)=>{const{conditions:R,rules:F}=E,{result:G,referenceRecord:H}=evaluateConditions(R,A);if(G)return evaluateRules(F,{...A,referenceRecord:{...A.referenceRecord,...H}})},evaluateRules=(E,A)=>{for(const R of E)if(R.type==="endpoint"){const F=evaluateEndpointRule(R,A);if(F)return F}else if(R.type==="error")evaluateErrorRule(R,A);else if(R.type==="tree"){const F=evaluateTreeRule(R,A);if(F)return F}else throw new EndpointError(`Unknown endpoint rule: ${R}`);throw new EndpointError("Rules evaluation failed")},resolveEndpoint=(E,A)=>{var oe,Ee,we,ce,$e;const{endpointParams:R,logger:F}=A,{parameters:G,rules:H}=E;(Ee=(oe=A.logger)==null?void 0:oe.debug)==null||Ee.call(oe,`${debugId} Initial EndpointParams: ${toDebugString(R)}`);const $=Object.entries(G).filter(([,Ge])=>Ge.default!=null).map(([Ge,Xe])=>[Ge,Xe.default]);if($.length>0)for(const[Ge,Xe]of $)R[Ge]=R[Ge]??Xe;const M=Object.entries(G).filter(([,Ge])=>Ge.required).map(([Ge])=>Ge);for(const Ge of M)if(R[Ge]==null)throw new EndpointError(`Missing required parameter: '${Ge}'`);const ye=evaluateRules(H,{endpointParams:R,logger:F,referenceRecord:{}});if((we=A.endpointParams)!=null&&we.Endpoint)try{const Ge=new URL(A.endpointParams.Endpoint),{protocol:Xe,port:ht}=Ge;ye.url.protocol=Xe,ye.url.port=ht}catch{}return($e=(ce=A.logger)==null?void 0:ce.debug)==null||$e.call(ce,`${debugId} Resolved endpoint: ${toDebugString(ye)}`),ye},isVirtualHostableS3Bucket=(E,A=!1)=>{if(A){for(const R of E.split("."))if(!isVirtualHostableS3Bucket(R))return!1;return!0}return!(!isValidHostLabel(E)||E.length<3||E.length>63||E!==E.toLowerCase()||isIpAddress(E))},parseArn=E=>{const A=E.split(":");if(A.length<6)return null;const[R,F,G,H,$,...M]=A;return R!=="arn"||F===""||G===""||M[0]===""?null:{partition:F,service:G,region:H,accountId:$,resourceId:M[0].includes("/")?M[0].split("/"):M}},partitions=[{id:"aws",outputs:{dnsSuffix:"amazonaws.com",dualStackDnsSuffix:"api.aws",implicitGlobalRegion:"us-east-1",name:"aws",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^(us|eu|ap|sa|ca|me|af|il)\\-\\w+\\-\\d+$",regions:{"af-south-1":{description:"Africa (Cape Town)"},"ap-east-1":{description:"Asia Pacific (Hong Kong)"},"ap-northeast-1":{description:"Asia Pacific (Tokyo)"},"ap-northeast-2":{description:"Asia Pacific (Seoul)"},"ap-northeast-3":{description:"Asia Pacific (Osaka)"},"ap-south-1":{description:"Asia Pacific (Mumbai)"},"ap-south-2":{description:"Asia Pacific (Hyderabad)"},"ap-southeast-1":{description:"Asia Pacific (Singapore)"},"ap-southeast-2":{description:"Asia Pacific (Sydney)"},"ap-southeast-3":{description:"Asia Pacific (Jakarta)"},"ap-southeast-4":{description:"Asia Pacific (Melbourne)"},"aws-global":{description:"AWS Standard global region"},"ca-central-1":{description:"Canada (Central)"},"ca-west-1":{description:"Canada West (Calgary)"},"eu-central-1":{description:"Europe (Frankfurt)"},"eu-central-2":{description:"Europe (Zurich)"},"eu-north-1":{description:"Europe (Stockholm)"},"eu-south-1":{description:"Europe (Milan)"},"eu-south-2":{description:"Europe (Spain)"},"eu-west-1":{description:"Europe (Ireland)"},"eu-west-2":{description:"Europe (London)"},"eu-west-3":{description:"Europe (Paris)"},"il-central-1":{description:"Israel (Tel Aviv)"},"me-central-1":{description:"Middle East (UAE)"},"me-south-1":{description:"Middle East (Bahrain)"},"sa-east-1":{description:"South America (Sao Paulo)"},"us-east-1":{description:"US East (N. Virginia)"},"us-east-2":{description:"US East (Ohio)"},"us-west-1":{description:"US West (N. California)"},"us-west-2":{description:"US West (Oregon)"}}},{id:"aws-cn",outputs:{dnsSuffix:"amazonaws.com.cn",dualStackDnsSuffix:"api.amazonwebservices.com.cn",implicitGlobalRegion:"cn-northwest-1",name:"aws-cn",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^cn\\-\\w+\\-\\d+$",regions:{"aws-cn-global":{description:"AWS China global region"},"cn-north-1":{description:"China (Beijing)"},"cn-northwest-1":{description:"China (Ningxia)"}}},{id:"aws-us-gov",outputs:{dnsSuffix:"amazonaws.com",dualStackDnsSuffix:"api.aws",implicitGlobalRegion:"us-gov-west-1",name:"aws-us-gov",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^us\\-gov\\-\\w+\\-\\d+$",regions:{"aws-us-gov-global":{description:"AWS GovCloud (US) global region"},"us-gov-east-1":{description:"AWS GovCloud (US-East)"},"us-gov-west-1":{description:"AWS GovCloud (US-West)"}}},{id:"aws-iso",outputs:{dnsSuffix:"c2s.ic.gov",dualStackDnsSuffix:"c2s.ic.gov",implicitGlobalRegion:"us-iso-east-1",name:"aws-iso",supportsDualStack:!1,supportsFIPS:!0},regionRegex:"^us\\-iso\\-\\w+\\-\\d+$",regions:{"aws-iso-global":{description:"AWS ISO (US) global region"},"us-iso-east-1":{description:"US ISO East"},"us-iso-west-1":{description:"US ISO WEST"}}},{id:"aws-iso-b",outputs:{dnsSuffix:"sc2s.sgov.gov",dualStackDnsSuffix:"sc2s.sgov.gov",implicitGlobalRegion:"us-isob-east-1",name:"aws-iso-b",supportsDualStack:!1,supportsFIPS:!0},regionRegex:"^us\\-isob\\-\\w+\\-\\d+$",regions:{"aws-iso-b-global":{description:"AWS ISOB (US) global region"},"us-isob-east-1":{description:"US ISOB East (Ohio)"}}},{id:"aws-iso-e",outputs:{dnsSuffix:"cloud.adc-e.uk",dualStackDnsSuffix:"cloud.adc-e.uk",implicitGlobalRegion:"eu-isoe-west-1",name:"aws-iso-e",supportsDualStack:!1,supportsFIPS:!0},regionRegex:"^eu\\-isoe\\-\\w+\\-\\d+$",regions:{}},{id:"aws-iso-f",outputs:{dnsSuffix:"csp.hci.ic.gov",dualStackDnsSuffix:"csp.hci.ic.gov",implicitGlobalRegion:"us-isof-south-1",name:"aws-iso-f",supportsDualStack:!1,supportsFIPS:!0},regionRegex:"^us\\-isof\\-\\w+\\-\\d+$",regions:{}}],version$1="1.1",partitionsInfo={partitions,version:version$1};let selectedPartitionsInfo=partitionsInfo;const partition=E=>{const{partitions:A}=selectedPartitionsInfo;for(const F of A){const{regions:G,outputs:H}=F;for(const[$,M]of Object.entries(G))if($===E)return{...H,...M}}for(const F of A){const{regionRegex:G,outputs:H}=F;if(new RegExp(G).test(E))return{...H}}const R=A.find(F=>F.id==="aws");if(!R)throw new Error("Provided region was not found in the partition array or regex, and default partition with id 'aws' doesn't exist.");return{...R.outputs}},awsEndpointFunctions={isVirtualHostableS3Bucket,parseArn,partition};customEndpointFunctions.aws=awsEndpointFunctions;const USER_AGENT="user-agent",X_AMZ_USER_AGENT="x-amz-user-agent",SPACE=" ",UA_NAME_SEPARATOR="/",UA_NAME_ESCAPE_REGEX=/[^\!\$\%\&\'\*\+\-\.\^\_\`\|\~\d\w]/g,UA_VALUE_ESCAPE_REGEX=/[^\!\$\%\&\'\*\+\-\.\^\_\`\|\~\d\w\#]/g,UA_ESCAPE_CHAR="-",userAgentMiddleware=E=>(A,R)=>async F=>{var we,ce;const{request:G}=F;if(!HttpRequest.isInstance(G))return A(F);const{headers:H}=G,$=((we=R==null?void 0:R.userAgent)==null?void 0:we.map(escapeUserAgent))||[],M=(await E.defaultUserAgentProvider()).map(escapeUserAgent),ye=((ce=E==null?void 0:E.customUserAgent)==null?void 0:ce.map(escapeUserAgent))||[],oe=[].concat([...M,...$,...ye]).join(SPACE),Ee=[...M.filter($e=>$e.startsWith("aws-sdk-")),...ye].join(SPACE);return E.runtime!=="browser"?(Ee&&(H[X_AMZ_USER_AGENT]=H[X_AMZ_USER_AGENT]?`${H[USER_AGENT]} ${Ee}`:Ee),H[USER_AGENT]=oe):H[X_AMZ_USER_AGENT]=oe,A({...F,request:G})},escapeUserAgent=E=>{var $;const A=E[0].split(UA_NAME_SEPARATOR).map(M=>M.replace(UA_NAME_ESCAPE_REGEX,UA_ESCAPE_CHAR)).join(UA_NAME_SEPARATOR),R=($=E[1])==null?void 0:$.replace(UA_VALUE_ESCAPE_REGEX,UA_ESCAPE_CHAR),F=A.indexOf(UA_NAME_SEPARATOR),G=A.substring(0,F);let H=A.substring(F+1);return G==="api"&&(H=H.toLowerCase()),[G,H,R].filter(M=>M&&M.length>0).reduce((M,ye,oe)=>{switch(oe){case 0:return ye;case 1:return`${M}/${ye}`;default:return`${M}#${ye}`}},"")},getUserAgentMiddlewareOptions={name:"getUserAgentMiddleware",step:"build",priority:"low",tags:["SET_USER_AGENT","USER_AGENT"],override:!0},getUserAgentPlugin=E=>({applyToStack:A=>{A.add(userAgentMiddleware(E),getUserAgentMiddlewareOptions)}});var SelectorType;(function(E){E.ENV="env",E.CONFIG="shared config entry"})(SelectorType||(SelectorType={}));const DEFAULT_USE_DUALSTACK_ENDPOINT=!1,DEFAULT_USE_FIPS_ENDPOINT=!1,getSmithyContext=E=>E[SMITHY_CONTEXT_KEY]||(E[SMITHY_CONTEXT_KEY]={}),normalizeProvider$1=E=>{if(typeof E=="function")return E;const A=Promise.resolve(E);return()=>A},isFipsRegion=E=>typeof E=="string"&&(E.startsWith("fips-")||E.endsWith("-fips")),getRealRegion=E=>isFipsRegion(E)?["fips-aws-global","aws-fips"].includes(E)?"us-east-1":E.replace(/fips-(dkr-|prod-)?|-fips/,""):E,resolveRegionConfig=E=>{const{region:A,useFipsEndpoint:R}=E;if(!A)throw new Error("Region is missing");return{...E,region:async()=>{if(typeof A=="string")return getRealRegion(A);const F=await A();return getRealRegion(F)},useFipsEndpoint:async()=>{const F=typeof A=="string"?A:await A();return isFipsRegion(F)?!0:typeof R!="function"?Promise.resolve(!!R):R()}}};function convertHttpAuthSchemesToMap(E){const A=new Map;for(const R of E)A.set(R.schemeId,R);return A}const httpAuthSchemeMiddleware=(E,A)=>(R,F)=>async G=>{var oe;const H=E.httpAuthSchemeProvider(await A.httpAuthSchemeParametersProvider(E,F,G.input)),$=convertHttpAuthSchemesToMap(E.httpAuthSchemes),M=getSmithyContext(F),ye=[];for(const Ee of H){const we=$.get(Ee.schemeId);if(!we){ye.push(`HttpAuthScheme \`${Ee.schemeId}\` was not enabled for this service.`);continue}const ce=we.identityProvider(await A.identityProviderConfigProvider(E));if(!ce){ye.push(`HttpAuthScheme \`${Ee.schemeId}\` did not have an IdentityProvider configured.`);continue}const{identityProperties:$e={},signingProperties:Ge={}}=((oe=Ee.propertiesExtractor)==null?void 0:oe.call(Ee,E,F))||{};Ee.identityProperties=Object.assign(Ee.identityProperties||{},$e),Ee.signingProperties=Object.assign(Ee.signingProperties||{},Ge),M.selectedHttpAuthScheme={httpAuthOption:Ee,identity:await ce(Ee.identityProperties),signer:we.signer};break}if(!M.selectedHttpAuthScheme)throw new Error(ye.join(`
`));return R(G)},resolveParamsForS3=async E=>{const A=(E==null?void 0:E.Bucket)||"";if(typeof E.Bucket=="string"&&(E.Bucket=A.replace(/#/g,encodeURIComponent("#")).replace(/\?/g,encodeURIComponent("?"))),isArnBucketName(A)){if(E.ForcePathStyle===!0)throw new Error("Path-style addressing cannot be used with ARN buckets")}else(!isDnsCompatibleBucketName(A)||A.indexOf(".")!==-1&&!String(E.Endpoint).startsWith("http:")||A.toLowerCase()!==A||A.length<3)&&(E.ForcePathStyle=!0);return E.DisableMultiRegionAccessPoints&&(E.disableMultiRegionAccessPoints=!0,E.DisableMRAP=!0),E},DOMAIN_PATTERN=/^[a-z0-9][a-z0-9\.\-]{1,61}[a-z0-9]$/,IP_ADDRESS_PATTERN=/(\d+\.){3}\d+/,DOTS_PATTERN=/\.\./,isDnsCompatibleBucketName=E=>DOMAIN_PATTERN.test(E)&&!IP_ADDRESS_PATTERN.test(E)&&!DOTS_PATTERN.test(E),isArnBucketName=E=>{const[A,R,F,G,H,$]=E.split(":"),M=A==="arn"&&E.split(":").length>=6,ye=[A,R,F,H,$].filter(Boolean).length===5;if(M&&!ye)throw new Error(`Invalid ARN: ${E} was an invalid ARN.`);return A==="arn"&&!!R&&!!F&&!!H&&!!$},createConfigValueProvider=(E,A,R)=>{const F=async()=>{const G=R[E]??R[A];return typeof G=="function"?G():G};return E==="credentialScope"||A==="CredentialScope"?async()=>{const G=typeof R.credentials=="function"?await R.credentials():R.credentials;return(G==null?void 0:G.credentialScope)??(G==null?void 0:G.CredentialScope)}:E==="endpoint"||A==="endpoint"?async()=>{const G=await F();if(G&&typeof G=="object"){if("url"in G)return G.url.href;if("hostname"in G){const{protocol:H,hostname:$,port:M,path:ye}=G;return`${H}//${$}${M?":"+M:""}${ye}`}}return G}:F},getEndpointFromConfig=async E=>{};function parseQueryString(E){const A={};if(E=E.replace(/^\?/,""),E)for(const R of E.split("&")){let[F,G=null]=R.split("=");F=decodeURIComponent(F),G&&(G=decodeURIComponent(G)),F in A?Array.isArray(A[F])?A[F].push(G):A[F]=[A[F],G]:A[F]=G}return A}const parseUrl=E=>{if(typeof E=="string")return parseUrl(new URL(E));const{hostname:A,pathname:R,port:F,protocol:G,search:H}=E;let $;return H&&($=parseQueryString(H)),{hostname:A,port:F?parseInt(F):void 0,protocol:G,path:R,query:$}},toEndpointV1=E=>typeof E=="object"?"url"in E?parseUrl(E.url):E:parseUrl(E),getEndpointFromInstructions=async(E,A,R,F)=>{if(!R.endpoint){const $=await getEndpointFromConfig(R.serviceId||"");$&&(R.endpoint=()=>Promise.resolve(toEndpointV1($)))}const G=await resolveParams(E,A,R);if(typeof R.endpointProvider!="function")throw new Error("config.endpointProvider is not set.");return R.endpointProvider(G,F)},resolveParams=async(E,A,R)=>{var H;const F={},G=((H=A==null?void 0:A.getEndpointParameterInstructions)==null?void 0:H.call(A))||{};for(const[$,M]of Object.entries(G))switch(M.type){case"staticContextParams":F[$]=M.value;break;case"contextParams":F[$]=E[M.name];break;case"clientContextParams":case"builtInParams":F[$]=await createConfigValueProvider(M.name,$,R)();break;default:throw new Error("Unrecognized endpoint parameter instruction: "+JSON.stringify(M))}return Object.keys(G).length===0&&Object.assign(F,R),String(R.serviceId).toLowerCase()==="s3"&&await resolveParamsForS3(F),F},endpointMiddleware=({config:E,instructions:A})=>(R,F)=>async G=>{var M,ye,oe;const H=await getEndpointFromInstructions(G.input,{getEndpointParameterInstructions(){return A}},{...E},F);F.endpointV2=H,F.authSchemes=(M=H.properties)==null?void 0:M.authSchemes;const $=(ye=F.authSchemes)==null?void 0:ye[0];if($){F.signing_region=$.signingRegion,F.signing_service=$.signingName;const Ee=getSmithyContext(F),we=(oe=Ee==null?void 0:Ee.selectedHttpAuthScheme)==null?void 0:oe.httpAuthOption;we&&(we.signingProperties=Object.assign(we.signingProperties||{},{signing_region:$.signingRegion,signingRegion:$.signingRegion,signing_service:$.signingName,signingName:$.signingName,signingRegionSet:$.signingRegionSet},$.properties))}return R({...G})},deserializerMiddleware=(E,A)=>(R,F)=>async G=>{const{response:H}=await R(G);try{const $=await A(H,E);return{response:H,output:$}}catch($){if(Object.defineProperty($,"$response",{value:H}),!("$metadata"in $)){const M="Deserialization error: to see the raw response, inspect the hidden field {error}.$response on this object.";$.message+=`
  `+M,typeof $.$responseBodyText<"u"&&$.$response&&($.$response.body=$.$responseBodyText)}throw $}},serializerMiddleware=(E,A)=>(R,F)=>async G=>{var M;const H=(M=F.endpointV2)!=null&&M.url&&E.urlParser?async()=>E.urlParser(F.endpointV2.url):E.endpoint;if(!H)throw new Error("No valid endpoint provider available.");const $=await A(G.input,{...E,endpoint:H});return R({...G,request:$})},deserializerMiddlewareOption={name:"deserializerMiddleware",step:"deserialize",tags:["DESERIALIZER"],override:!0},serializerMiddlewareOption={name:"serializerMiddleware",step:"serialize",tags:["SERIALIZER"],override:!0};function getSerdePlugin(E,A,R){return{applyToStack:F=>{F.add(deserializerMiddleware(E,R),deserializerMiddlewareOption),F.add(serializerMiddleware(E,A),serializerMiddlewareOption)}}}const endpointMiddlewareOptions={step:"serialize",tags:["ENDPOINT_PARAMETERS","ENDPOINT_V2","ENDPOINT"],name:"endpointV2Middleware",override:!0,relation:"before",toMiddleware:serializerMiddlewareOption.name},getEndpointPlugin=(E,A)=>({applyToStack:R=>{R.addRelativeTo(endpointMiddleware({config:E,instructions:A}),endpointMiddlewareOptions)}}),resolveEndpointConfig=E=>{const A=E.tls??!0,{endpoint:R}=E,F=R!=null?async()=>toEndpointV1(await normalizeProvider$1(R)()):void 0;return{...E,endpoint:F,tls:A,isCustomEndpoint:!!R,useDualstackEndpoint:normalizeProvider$1(E.useDualstackEndpoint??!1),useFipsEndpoint:normalizeProvider$1(E.useFipsEndpoint??!1)}},httpAuthSchemeEndpointRuleSetMiddlewareOptions={step:"serialize",tags:["HTTP_AUTH_SCHEME"],name:"httpAuthSchemeMiddleware",override:!0,relation:"before",toMiddleware:endpointMiddlewareOptions.name},getHttpAuthSchemeEndpointRuleSetPlugin=(E,{httpAuthSchemeParametersProvider:A,identityProviderConfigProvider:R})=>({applyToStack:F=>{F.addRelativeTo(httpAuthSchemeMiddleware(E,{httpAuthSchemeParametersProvider:A,identityProviderConfigProvider:R}),httpAuthSchemeEndpointRuleSetMiddlewareOptions)}});serializerMiddlewareOption.name;const defaultErrorHandler=E=>A=>{throw A},defaultSuccessHandler=(E,A)=>{},httpSigningMiddleware=E=>(A,R)=>async F=>{if(!HttpRequest.isInstance(F.request))return A(F);const H=getSmithyContext(R).selectedHttpAuthScheme;if(!H)throw new Error("No HttpAuthScheme was selected: unable to sign request");const{httpAuthOption:{signingProperties:$={}},identity:M,signer:ye}=H,oe=await A({...F,request:await ye.sign(F.request,M,$)}).catch((ye.errorHandler||defaultErrorHandler)($));return(ye.successHandler||defaultSuccessHandler)(oe.response,$),oe};var RETRY_MODES;(function(E){E.STANDARD="standard",E.ADAPTIVE="adaptive"})(RETRY_MODES||(RETRY_MODES={}));const DEFAULT_MAX_ATTEMPTS=3,DEFAULT_RETRY_MODE=RETRY_MODES.STANDARD,THROTTLING_ERROR_CODES=["BandwidthLimitExceeded","EC2ThrottledException","LimitExceededException","PriorRequestNotComplete","ProvisionedThroughputExceededException","RequestLimitExceeded","RequestThrottled","RequestThrottledException","SlowDown","ThrottledException","Throttling","ThrottlingException","TooManyRequestsException","TransactionInProgressException"],TRANSIENT_ERROR_CODES=["TimeoutError","RequestTimeout","RequestTimeoutException"],TRANSIENT_ERROR_STATUS_CODES=[500,502,503,504],NODEJS_TIMEOUT_ERROR_CODES=["ECONNRESET","ECONNREFUSED","EPIPE","ETIMEDOUT"],isClockSkewCorrectedError=E=>{var A;return(A=E.$metadata)==null?void 0:A.clockSkewCorrected},isThrottlingError=E=>{var A,R;return((A=E.$metadata)==null?void 0:A.httpStatusCode)===429||THROTTLING_ERROR_CODES.includes(E.name)||((R=E.$retryable)==null?void 0:R.throttling)==!0},isTransientError=E=>{var A;return isClockSkewCorrectedError(E)||TRANSIENT_ERROR_CODES.includes(E.name)||NODEJS_TIMEOUT_ERROR_CODES.includes((E==null?void 0:E.code)||"")||TRANSIENT_ERROR_STATUS_CODES.includes(((A=E.$metadata)==null?void 0:A.httpStatusCode)||0)},isServerError=E=>{var A;if(((A=E.$metadata)==null?void 0:A.httpStatusCode)!==void 0){const R=E.$metadata.httpStatusCode;return 500<=R&&R<=599&&!isTransientError(E)}return!1};class DefaultRateLimiter{constructor(A){this.currentCapacity=0,this.enabled=!1,this.lastMaxRate=0,this.measuredTxRate=0,this.requestCount=0,this.lastTimestamp=0,this.timeWindow=0,this.beta=(A==null?void 0:A.beta)??.7,this.minCapacity=(A==null?void 0:A.minCapacity)??1,this.minFillRate=(A==null?void 0:A.minFillRate)??.5,this.scaleConstant=(A==null?void 0:A.scaleConstant)??.4,this.smooth=(A==null?void 0:A.smooth)??.8;const R=this.getCurrentTimeInSeconds();this.lastThrottleTime=R,this.lastTxRateBucket=Math.floor(this.getCurrentTimeInSeconds()),this.fillRate=this.minFillRate,this.maxCapacity=this.minCapacity}getCurrentTimeInSeconds(){return Date.now()/1e3}async getSendToken(){return this.acquireTokenBucket(1)}async acquireTokenBucket(A){if(this.enabled){if(this.refillTokenBucket(),A>this.currentCapacity){const R=(A-this.currentCapacity)/this.fillRate*1e3;await new Promise(F=>setTimeout(F,R))}this.currentCapacity=this.currentCapacity-A}}refillTokenBucket(){const A=this.getCurrentTimeInSeconds();if(!this.lastTimestamp){this.lastTimestamp=A;return}const R=(A-this.lastTimestamp)*this.fillRate;this.currentCapacity=Math.min(this.maxCapacity,this.currentCapacity+R),this.lastTimestamp=A}updateClientSendingRate(A){let R;if(this.updateMeasuredRate(),isThrottlingError(A)){const G=this.enabled?Math.min(this.measuredTxRate,this.fillRate):this.measuredTxRate;this.lastMaxRate=G,this.calculateTimeWindow(),this.lastThrottleTime=this.getCurrentTimeInSeconds(),R=this.cubicThrottle(G),this.enableTokenBucket()}else this.calculateTimeWindow(),R=this.cubicSuccess(this.getCurrentTimeInSeconds());const F=Math.min(R,2*this.measuredTxRate);this.updateTokenBucketRate(F)}calculateTimeWindow(){this.timeWindow=this.getPrecise(Math.pow(this.lastMaxRate*(1-this.beta)/this.scaleConstant,1/3))}cubicThrottle(A){return this.getPrecise(A*this.beta)}cubicSuccess(A){return this.getPrecise(this.scaleConstant*Math.pow(A-this.lastThrottleTime-this.timeWindow,3)+this.lastMaxRate)}enableTokenBucket(){this.enabled=!0}updateTokenBucketRate(A){this.refillTokenBucket(),this.fillRate=Math.max(A,this.minFillRate),this.maxCapacity=Math.max(A,this.minCapacity),this.currentCapacity=Math.min(this.currentCapacity,this.maxCapacity)}updateMeasuredRate(){const A=this.getCurrentTimeInSeconds(),R=Math.floor(A*2)/2;if(this.requestCount++,R>this.lastTxRateBucket){const F=this.requestCount/(R-this.lastTxRateBucket);this.measuredTxRate=this.getPrecise(F*this.smooth+this.measuredTxRate*(1-this.smooth)),this.requestCount=0,this.lastTxRateBucket=R}}getPrecise(A){return parseFloat(A.toFixed(8))}}const DEFAULT_RETRY_DELAY_BASE=100,MAXIMUM_RETRY_DELAY=20*1e3,THROTTLING_RETRY_DELAY_BASE=500,INITIAL_RETRY_TOKENS=500,RETRY_COST=5,TIMEOUT_RETRY_COST=10,NO_RETRY_INCREMENT=1,INVOCATION_ID_HEADER="amz-sdk-invocation-id",REQUEST_HEADER="amz-sdk-request",getDefaultRetryBackoffStrategy=()=>{let E=DEFAULT_RETRY_DELAY_BASE;return{computeNextBackoffDelay:F=>Math.floor(Math.min(MAXIMUM_RETRY_DELAY,Math.random()*2**F*E)),setDelayBase:F=>{E=F}}},createDefaultRetryToken=({retryDelay:E,retryCount:A,retryCost:R})=>({getRetryCount:()=>A,getRetryDelay:()=>Math.min(MAXIMUM_RETRY_DELAY,E),getRetryCost:()=>R});class StandardRetryStrategy{constructor(A){this.maxAttempts=A,this.mode=RETRY_MODES.STANDARD,this.capacity=INITIAL_RETRY_TOKENS,this.retryBackoffStrategy=getDefaultRetryBackoffStrategy(),this.maxAttemptsProvider=typeof A=="function"?A:async()=>A}async acquireInitialRetryToken(A){return createDefaultRetryToken({retryDelay:DEFAULT_RETRY_DELAY_BASE,retryCount:0})}async refreshRetryTokenForRetry(A,R){const F=await this.getMaxAttempts();if(this.shouldRetry(A,R,F)){const G=R.errorType;this.retryBackoffStrategy.setDelayBase(G==="THROTTLING"?THROTTLING_RETRY_DELAY_BASE:DEFAULT_RETRY_DELAY_BASE);const H=this.retryBackoffStrategy.computeNextBackoffDelay(A.getRetryCount()),$=R.retryAfterHint?Math.max(R.retryAfterHint.getTime()-Date.now()||0,H):H,M=this.getCapacityCost(G);return this.capacity-=M,createDefaultRetryToken({retryDelay:$,retryCount:A.getRetryCount()+1,retryCost:M})}throw new Error("No retry token available")}recordSuccess(A){this.capacity=Math.max(INITIAL_RETRY_TOKENS,this.capacity+(A.getRetryCost()??NO_RETRY_INCREMENT))}getCapacity(){return this.capacity}async getMaxAttempts(){try{return await this.maxAttemptsProvider()}catch{return console.warn(`Max attempts provider could not resolve. Using default of ${DEFAULT_MAX_ATTEMPTS}`),DEFAULT_MAX_ATTEMPTS}}shouldRetry(A,R,F){return A.getRetryCount()+1<F&&this.capacity>=this.getCapacityCost(R.errorType)&&this.isRetryableError(R.errorType)}getCapacityCost(A){return A==="TRANSIENT"?TIMEOUT_RETRY_COST:RETRY_COST}isRetryableError(A){return A==="THROTTLING"||A==="TRANSIENT"}}class AdaptiveRetryStrategy{constructor(A,R){this.maxAttemptsProvider=A,this.mode=RETRY_MODES.ADAPTIVE;const{rateLimiter:F}=R??{};this.rateLimiter=F??new DefaultRateLimiter,this.standardRetryStrategy=new StandardRetryStrategy(A)}async acquireInitialRetryToken(A){return await this.rateLimiter.getSendToken(),this.standardRetryStrategy.acquireInitialRetryToken(A)}async refreshRetryTokenForRetry(A,R){return this.rateLimiter.updateClientSendingRate(R),this.standardRetryStrategy.refreshRetryTokenForRetry(A,R)}recordSuccess(A){this.rateLimiter.updateClientSendingRate({}),this.standardRetryStrategy.recordSuccess(A)}}let getRandomValues;const rnds8=new Uint8Array(16);function rng(){if(!getRandomValues&&(getRandomValues=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!getRandomValues))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return getRandomValues(rnds8)}const byteToHex=[];for(let E=0;E<256;++E)byteToHex.push((E+256).toString(16).slice(1));function unsafeStringify(E,A=0){return byteToHex[E[A+0]]+byteToHex[E[A+1]]+byteToHex[E[A+2]]+byteToHex[E[A+3]]+"-"+byteToHex[E[A+4]]+byteToHex[E[A+5]]+"-"+byteToHex[E[A+6]]+byteToHex[E[A+7]]+"-"+byteToHex[E[A+8]]+byteToHex[E[A+9]]+"-"+byteToHex[E[A+10]]+byteToHex[E[A+11]]+byteToHex[E[A+12]]+byteToHex[E[A+13]]+byteToHex[E[A+14]]+byteToHex[E[A+15]]}const randomUUID=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),native={randomUUID};function v4(E,A,R){if(native.randomUUID&&!A&&!E)return native.randomUUID();E=E||{};const F=E.random||(E.rng||rng)();if(F[6]=F[6]&15|64,F[8]=F[8]&63|128,A){R=R||0;for(let G=0;G<16;++G)A[R+G]=F[G];return A}return unsafeStringify(F)}const asSdkError=E=>E instanceof Error?E:E instanceof Object?Object.assign(new Error,E):typeof E=="string"?new Error(E):new Error(`AWS SDK error wrapper for ${E}`),resolveRetryConfig=E=>{const{retryStrategy:A}=E,R=normalizeProvider$1(E.maxAttempts??DEFAULT_MAX_ATTEMPTS);return{...E,maxAttempts:R,retryStrategy:async()=>A||(await normalizeProvider$1(E.retryMode)()===RETRY_MODES.ADAPTIVE?new AdaptiveRetryStrategy(R):new StandardRetryStrategy(R))}},isStreamingPayload=E=>(E==null?void 0:E.body)instanceof ReadableStream,retryMiddleware=E=>(A,R)=>async F=>{var $;let G=await E.retryStrategy();const H=await E.maxAttempts();if(isRetryStrategyV2(G)){G=G;let M=await G.acquireInitialRetryToken(R.partition_id),ye=new Error,oe=0,Ee=0;const{request:we}=F,ce=HttpRequest.isInstance(we);for(ce&&(we.headers[INVOCATION_ID_HEADER]=v4());;)try{ce&&(we.headers[REQUEST_HEADER]=`attempt=${oe+1}; max=${H}`);const{response:$e,output:Ge}=await A(F);return G.recordSuccess(M),Ge.$metadata.attempts=oe+1,Ge.$metadata.totalRetryDelay=Ee,{response:$e,output:Ge}}catch($e){const Ge=getRetryErrorInfo($e);if(ye=asSdkError($e),ce&&isStreamingPayload(we))throw($=R.logger instanceof NoOpLogger?console:R.logger)==null||$.warn("An error was encountered in a non-retryable streaming request."),ye;try{M=await G.refreshRetryTokenForRetry(M,Ge)}catch{throw ye.$metadata||(ye.$metadata={}),ye.$metadata.attempts=oe+1,ye.$metadata.totalRetryDelay=Ee,ye}oe=M.getRetryCount();const Xe=M.getRetryDelay();Ee+=Xe,await new Promise(ht=>setTimeout(ht,Xe))}}else return G=G,G!=null&&G.mode&&(R.userAgent=[...R.userAgent||[],["cfg/retry-mode",G.mode]]),G.retry(A,F)},isRetryStrategyV2=E=>typeof E.acquireInitialRetryToken<"u"&&typeof E.refreshRetryTokenForRetry<"u"&&typeof E.recordSuccess<"u",getRetryErrorInfo=E=>{const A={error:E,errorType:getRetryErrorType(E)},R=getRetryAfterHint(E.$response);return R&&(A.retryAfterHint=R),A},getRetryErrorType=E=>isThrottlingError(E)?"THROTTLING":isTransientError(E)?"TRANSIENT":isServerError(E)?"SERVER_ERROR":"CLIENT_ERROR",retryMiddlewareOptions={name:"retryMiddleware",tags:["RETRY"],step:"finalizeRequest",priority:"high",override:!0},getRetryPlugin=E=>({applyToStack:A=>{A.add(retryMiddleware(E),retryMiddlewareOptions)}}),getRetryAfterHint=E=>{if(!HttpResponse.isInstance(E))return;const A=Object.keys(E.headers).find(H=>H.toLowerCase()==="retry-after");if(!A)return;const R=E.headers[A],F=Number(R);return Number.isNaN(F)?new Date(R):new Date(F*1e3)},httpSigningMiddlewareOptions={step:"finalizeRequest",tags:["HTTP_SIGNING"],name:"httpSigningMiddleware",aliases:["apiKeyMiddleware","tokenMiddleware","awsAuthMiddleware"],override:!0,relation:"after",toMiddleware:retryMiddlewareOptions.name},getHttpSigningPlugin=E=>({applyToStack:A=>{A.addRelativeTo(httpSigningMiddleware(),httpSigningMiddlewareOptions)}});class DefaultIdentityProviderConfig{constructor(A){this.authSchemes=new Map;for(const[R,F]of Object.entries(A))F!==void 0&&this.authSchemes.set(R,F)}getIdentityProvider(A){return this.authSchemes.get(A)}}const createIsIdentityExpiredFunction=E=>A=>doesIdentityRequireRefresh(A)&&A.expiration.getTime()-Date.now()<E,EXPIRATION_MS=3e5,isIdentityExpired=createIsIdentityExpiredFunction(EXPIRATION_MS),doesIdentityRequireRefresh=E=>E.expiration!==void 0,memoizeIdentityProvider=(E,A,R)=>{if(E===void 0)return;const F=typeof E!="function"?async()=>Promise.resolve(E):E;let G,H,$,M=!1;const ye=async oe=>{H||(H=F(oe));try{G=await H,$=!0,M=!1}finally{H=void 0}return G};return A===void 0?async oe=>((!$||oe!=null&&oe.forceRefresh)&&(G=await ye(oe)),G):async oe=>((!$||oe!=null&&oe.forceRefresh)&&(G=await ye(oe)),M?G:R(G)?(A(G)&&await ye(oe),G):(M=!0,G))},normalizeProvider=E=>{if(typeof E=="function")return E;const A=Promise.resolve(E);return()=>A};function requestBuilder(E,A){return new RequestBuilder(E,A)}class RequestBuilder{constructor(A,R){this.input=A,this.context=R,this.query={},this.method="",this.headers={},this.path="",this.body=null,this.hostname="",this.resolvePathStack=[]}async build(){const{hostname:A,protocol:R="https",port:F,path:G}=await this.context.endpoint();this.path=G;for(const H of this.resolvePathStack)H(this.path);return new HttpRequest({protocol:R,hostname:this.hostname||A,port:F,method:this.method,path:this.path,query:this.query,body:this.body,headers:this.headers})}hn(A){return this.hostname=A,this}bp(A){return this.resolvePathStack.push(R=>{this.path=`${R!=null&&R.endsWith("/")?R.slice(0,-1):R||""}`+A}),this}p(A,R,F,G){return this.resolvePathStack.push(H=>{this.path=resolvedPath(H,this.input,A,R,F,G)}),this}h(A){return this.headers=A,this}q(A){return this.query=A,this}b(A){return this.body=A,this}m(A){return this.method=A,this}}const CONTENT_LENGTH_HEADER="content-length";function contentLengthMiddleware(E){return A=>async R=>{const F=R.request;if(HttpRequest.isInstance(F)){const{body:G,headers:H}=F;if(G&&Object.keys(H).map($=>$.toLowerCase()).indexOf(CONTENT_LENGTH_HEADER)===-1)try{const $=E(G);F.headers={...F.headers,[CONTENT_LENGTH_HEADER]:String($)}}catch{}}return A({...R,request:F})}}const contentLengthMiddlewareOptions={step:"build",tags:["SET_CONTENT_LENGTH","CONTENT_LENGTH"],name:"contentLengthMiddleware",override:!0},getContentLengthPlugin=E=>({applyToStack:A=>{A.add(contentLengthMiddleware(E.bodyLengthChecker),contentLengthMiddlewareOptions)}}),getDateHeader=E=>{var A,R;return HttpResponse.isInstance(E)?((A=E.headers)==null?void 0:A.date)??((R=E.headers)==null?void 0:R.Date):void 0},getSkewCorrectedDate=E=>new Date(Date.now()+E),isClockSkewed=(E,A)=>Math.abs(getSkewCorrectedDate(A).getTime()-E)>=3e5,getUpdatedSystemClockOffset=(E,A)=>{const R=Date.parse(E);return isClockSkewed(R,A)?R-Date.now():A},throwSigningPropertyError=(E,A)=>{if(!A)throw new Error(`Property \`${E}\` is not resolved for AWS SDK SigV4Auth`);return A},validateSigningProperties=async E=>{var ye,oe,Ee;const A=throwSigningPropertyError("context",E.context),R=throwSigningPropertyError("config",E.config),F=(Ee=(oe=(ye=A.endpointV2)==null?void 0:ye.properties)==null?void 0:oe.authSchemes)==null?void 0:Ee[0],H=await throwSigningPropertyError("signer",R.signer)(F),$=E==null?void 0:E.signingRegion,M=E==null?void 0:E.signingName;return{config:R,signer:H,signingRegion:$,signingName:M}};class AwsSdkSigV4Signer{async sign(A,R,F){if(!HttpRequest.isInstance(A))throw new Error("The request is not an instance of `HttpRequest` and cannot be signed");const{config:G,signer:H,signingRegion:$,signingName:M}=await validateSigningProperties(F);return await H.sign(A,{signingDate:getSkewCorrectedDate(G.systemClockOffset),signingRegion:$,signingService:M})}errorHandler(A){return R=>{const F=R.ServerTime??getDateHeader(R.$response);if(F){const G=throwSigningPropertyError("config",A.config),H=G.systemClockOffset;G.systemClockOffset=getUpdatedSystemClockOffset(F,G.systemClockOffset),G.systemClockOffset!==H&&R.$metadata&&(R.$metadata.clockSkewCorrected=!0)}throw R}}successHandler(A,R){const F=getDateHeader(A);if(F){const G=throwSigningPropertyError("config",R.config);G.systemClockOffset=getUpdatedSystemClockOffset(F,G.systemClockOffset)}}}var build$5={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var extendStatics$4=function(E,A){return extendStatics$4=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,F){R.__proto__=F}||function(R,F){for(var G in F)F.hasOwnProperty(G)&&(R[G]=F[G])},extendStatics$4(E,A)};function __extends$4(E,A){extendStatics$4(E,A);function R(){this.constructor=E}E.prototype=A===null?Object.create(A):(R.prototype=A.prototype,new R)}var __assign$4=function(){return __assign$4=Object.assign||function(A){for(var R,F=1,G=arguments.length;F<G;F++){R=arguments[F];for(var H in R)Object.prototype.hasOwnProperty.call(R,H)&&(A[H]=R[H])}return A},__assign$4.apply(this,arguments)};function __rest$4(E,A){var R={};for(var F in E)Object.prototype.hasOwnProperty.call(E,F)&&A.indexOf(F)<0&&(R[F]=E[F]);if(E!=null&&typeof Object.getOwnPropertySymbols=="function")for(var G=0,F=Object.getOwnPropertySymbols(E);G<F.length;G++)A.indexOf(F[G])<0&&Object.prototype.propertyIsEnumerable.call(E,F[G])&&(R[F[G]]=E[F[G]]);return R}function __decorate$4(E,A,R,F){var G=arguments.length,H=G<3?A:F===null?F=Object.getOwnPropertyDescriptor(A,R):F,$;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")H=Reflect.decorate(E,A,R,F);else for(var M=E.length-1;M>=0;M--)($=E[M])&&(H=(G<3?$(H):G>3?$(A,R,H):$(A,R))||H);return G>3&&H&&Object.defineProperty(A,R,H),H}function __param$4(E,A){return function(R,F){A(R,F,E)}}function __metadata$4(E,A){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(E,A)}function __awaiter$4(E,A,R,F){function G(H){return H instanceof R?H:new R(function($){$(H)})}return new(R||(R=Promise))(function(H,$){function M(Ee){try{oe(F.next(Ee))}catch(we){$(we)}}function ye(Ee){try{oe(F.throw(Ee))}catch(we){$(we)}}function oe(Ee){Ee.done?H(Ee.value):G(Ee.value).then(M,ye)}oe((F=F.apply(E,A||[])).next())})}function __generator$4(E,A){var R={label:0,sent:function(){if(H[0]&1)throw H[1];return H[1]},trys:[],ops:[]},F,G,H,$;return $={next:M(0),throw:M(1),return:M(2)},typeof Symbol=="function"&&($[Symbol.iterator]=function(){return this}),$;function M(oe){return function(Ee){return ye([oe,Ee])}}function ye(oe){if(F)throw new TypeError("Generator is already executing.");for(;R;)try{if(F=1,G&&(H=oe[0]&2?G.return:oe[0]?G.throw||((H=G.return)&&H.call(G),0):G.next)&&!(H=H.call(G,oe[1])).done)return H;switch(G=0,H&&(oe=[oe[0]&2,H.value]),oe[0]){case 0:case 1:H=oe;break;case 4:return R.label++,{value:oe[1],done:!1};case 5:R.label++,G=oe[1],oe=[0];continue;case 7:oe=R.ops.pop(),R.trys.pop();continue;default:if(H=R.trys,!(H=H.length>0&&H[H.length-1])&&(oe[0]===6||oe[0]===2)){R=0;continue}if(oe[0]===3&&(!H||oe[1]>H[0]&&oe[1]<H[3])){R.label=oe[1];break}if(oe[0]===6&&R.label<H[1]){R.label=H[1],H=oe;break}if(H&&R.label<H[2]){R.label=H[2],R.ops.push(oe);break}H[2]&&R.ops.pop(),R.trys.pop();continue}oe=A.call(E,R)}catch(Ee){oe=[6,Ee],G=0}finally{F=H=0}if(oe[0]&5)throw oe[1];return{value:oe[0]?oe[1]:void 0,done:!0}}}function __createBinding$4(E,A,R,F){F===void 0&&(F=R),E[F]=A[R]}function __exportStar$4(E,A){for(var R in E)R!=="default"&&!A.hasOwnProperty(R)&&(A[R]=E[R])}function __values$4(E){var A=typeof Symbol=="function"&&Symbol.iterator,R=A&&E[A],F=0;if(R)return R.call(E);if(E&&typeof E.length=="number")return{next:function(){return E&&F>=E.length&&(E=void 0),{value:E&&E[F++],done:!E}}};throw new TypeError(A?"Object is not iterable.":"Symbol.iterator is not defined.")}function __read$4(E,A){var R=typeof Symbol=="function"&&E[Symbol.iterator];if(!R)return E;var F=R.call(E),G,H=[],$;try{for(;(A===void 0||A-- >0)&&!(G=F.next()).done;)H.push(G.value)}catch(M){$={error:M}}finally{try{G&&!G.done&&(R=F.return)&&R.call(F)}finally{if($)throw $.error}}return H}function __spread$4(){for(var E=[],A=0;A<arguments.length;A++)E=E.concat(__read$4(arguments[A]));return E}function __spreadArrays$4(){for(var E=0,A=0,R=arguments.length;A<R;A++)E+=arguments[A].length;for(var F=Array(E),G=0,A=0;A<R;A++)for(var H=arguments[A],$=0,M=H.length;$<M;$++,G++)F[G]=H[$];return F}function __await$4(E){return this instanceof __await$4?(this.v=E,this):new __await$4(E)}function __asyncGenerator$4(E,A,R){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var F=R.apply(E,A||[]),G,H=[];return G={},$("next"),$("throw"),$("return"),G[Symbol.asyncIterator]=function(){return this},G;function $(ce){F[ce]&&(G[ce]=function($e){return new Promise(function(Ge,Xe){H.push([ce,$e,Ge,Xe])>1||M(ce,$e)})})}function M(ce,$e){try{ye(F[ce]($e))}catch(Ge){we(H[0][3],Ge)}}function ye(ce){ce.value instanceof __await$4?Promise.resolve(ce.value.v).then(oe,Ee):we(H[0][2],ce)}function oe(ce){M("next",ce)}function Ee(ce){M("throw",ce)}function we(ce,$e){ce($e),H.shift(),H.length&&M(H[0][0],H[0][1])}}function __asyncDelegator$4(E){var A,R;return A={},F("next"),F("throw",function(G){throw G}),F("return"),A[Symbol.iterator]=function(){return this},A;function F(G,H){A[G]=E[G]?function($){return(R=!R)?{value:__await$4(E[G]($)),done:G==="return"}:H?H($):$}:H}}function __asyncValues$4(E){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var A=E[Symbol.asyncIterator],R;return A?A.call(E):(E=typeof __values$4=="function"?__values$4(E):E[Symbol.iterator](),R={},F("next"),F("throw"),F("return"),R[Symbol.asyncIterator]=function(){return this},R);function F(H){R[H]=E[H]&&function($){return new Promise(function(M,ye){$=E[H]($),G(M,ye,$.done,$.value)})}}function G(H,$,M,ye){Promise.resolve(ye).then(function(oe){H({value:oe,done:M})},$)}}function __makeTemplateObject$4(E,A){return Object.defineProperty?Object.defineProperty(E,"raw",{value:A}):E.raw=A,E}function __importStar$4(E){if(E&&E.__esModule)return E;var A={};if(E!=null)for(var R in E)Object.hasOwnProperty.call(E,R)&&(A[R]=E[R]);return A.default=E,A}function __importDefault$4(E){return E&&E.__esModule?E:{default:E}}function __classPrivateFieldGet$4(E,A){if(!A.has(E))throw new TypeError("attempted to get private field on non-instance");return A.get(E)}function __classPrivateFieldSet$4(E,A,R){if(!A.has(E))throw new TypeError("attempted to set private field on non-instance");return A.set(E,R),R}const tslib_es6$4=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return __assign$4},__asyncDelegator:__asyncDelegator$4,__asyncGenerator:__asyncGenerator$4,__asyncValues:__asyncValues$4,__await:__await$4,__awaiter:__awaiter$4,__classPrivateFieldGet:__classPrivateFieldGet$4,__classPrivateFieldSet:__classPrivateFieldSet$4,__createBinding:__createBinding$4,__decorate:__decorate$4,__exportStar:__exportStar$4,__extends:__extends$4,__generator:__generator$4,__importDefault:__importDefault$4,__importStar:__importStar$4,__makeTemplateObject:__makeTemplateObject$4,__metadata:__metadata$4,__param:__param$4,__read:__read$4,__rest:__rest$4,__spread:__spread$4,__spreadArrays:__spreadArrays$4,__values:__values$4},Symbol.toStringTag,{value:"Module"})),require$$0$4=getAugmentedNamespace(tslib_es6$4);var build$4={},convertToBuffer={},hasRequiredConvertToBuffer;function requireConvertToBuffer(){if(hasRequiredConvertToBuffer)return convertToBuffer;hasRequiredConvertToBuffer=1,Object.defineProperty(convertToBuffer,"__esModule",{value:!0}),convertToBuffer.convertToBuffer=void 0;var E=require$$2,A=typeof Buffer<"u"&&Buffer.from?function(F){return Buffer.from(F,"utf8")}:E.fromUtf8;function R(F){return F instanceof Uint8Array?F:typeof F=="string"?A(F):ArrayBuffer.isView(F)?new Uint8Array(F.buffer,F.byteOffset,F.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(F)}return convertToBuffer.convertToBuffer=R,convertToBuffer}var isEmptyData$1={},hasRequiredIsEmptyData$1;function requireIsEmptyData$1(){if(hasRequiredIsEmptyData$1)return isEmptyData$1;hasRequiredIsEmptyData$1=1,Object.defineProperty(isEmptyData$1,"__esModule",{value:!0}),isEmptyData$1.isEmptyData=void 0;function E(A){return typeof A=="string"?A.length===0:A.byteLength===0}return isEmptyData$1.isEmptyData=E,isEmptyData$1}var numToUint8={},hasRequiredNumToUint8;function requireNumToUint8(){if(hasRequiredNumToUint8)return numToUint8;hasRequiredNumToUint8=1,Object.defineProperty(numToUint8,"__esModule",{value:!0}),numToUint8.numToUint8=void 0;function E(A){return new Uint8Array([(A&4278190080)>>24,(A&16711680)>>16,(A&65280)>>8,A&255])}return numToUint8.numToUint8=E,numToUint8}var uint32ArrayFrom={},hasRequiredUint32ArrayFrom;function requireUint32ArrayFrom(){if(hasRequiredUint32ArrayFrom)return uint32ArrayFrom;hasRequiredUint32ArrayFrom=1,Object.defineProperty(uint32ArrayFrom,"__esModule",{value:!0}),uint32ArrayFrom.uint32ArrayFrom=void 0;function E(A){if(!Uint32Array.from){for(var R=new Uint32Array(A.length),F=0;F<A.length;)R[F]=A[F],F+=1;return R}return Uint32Array.from(A)}return uint32ArrayFrom.uint32ArrayFrom=E,uint32ArrayFrom}var hasRequiredBuild$4;function requireBuild$4(){return hasRequiredBuild$4||(hasRequiredBuild$4=1,function(E){Object.defineProperty(E,"__esModule",{value:!0}),E.uint32ArrayFrom=E.numToUint8=E.isEmptyData=E.convertToBuffer=void 0;var A=requireConvertToBuffer();Object.defineProperty(E,"convertToBuffer",{enumerable:!0,get:function(){return A.convertToBuffer}});var R=requireIsEmptyData$1();Object.defineProperty(E,"isEmptyData",{enumerable:!0,get:function(){return R.isEmptyData}});var F=requireNumToUint8();Object.defineProperty(E,"numToUint8",{enumerable:!0,get:function(){return F.numToUint8}});var G=requireUint32ArrayFrom();Object.defineProperty(E,"uint32ArrayFrom",{enumerable:!0,get:function(){return G.uint32ArrayFrom}})}(build$4)),build$4}var aws_crc32={},hasRequiredAws_crc32;function requireAws_crc32(){if(hasRequiredAws_crc32)return aws_crc32;hasRequiredAws_crc32=1,Object.defineProperty(aws_crc32,"__esModule",{value:!0}),aws_crc32.AwsCrc32=void 0;var E=require$$0$4,A=requireBuild$4(),R=requireBuild$3(),F=function(){function G(){this.crc32=new R.Crc32}return G.prototype.update=function(H){(0,A.isEmptyData)(H)||this.crc32.update((0,A.convertToBuffer)(H))},G.prototype.digest=function(){return E.__awaiter(this,void 0,void 0,function(){return E.__generator(this,function(H){return[2,(0,A.numToUint8)(this.crc32.digest())]})})},G.prototype.reset=function(){this.crc32=new R.Crc32},G}();return aws_crc32.AwsCrc32=F,aws_crc32}var hasRequiredBuild$3;function requireBuild$3(){return hasRequiredBuild$3||(hasRequiredBuild$3=1,function(E){Object.defineProperty(E,"__esModule",{value:!0}),E.AwsCrc32=E.Crc32=E.crc32=void 0;var A=require$$0$4,R=requireBuild$4();function F(ye){return new G().update(ye).digest()}E.crc32=F;var G=function(){function ye(){this.checksum=4294967295}return ye.prototype.update=function(oe){var Ee,we;try{for(var ce=A.__values(oe),$e=ce.next();!$e.done;$e=ce.next()){var Ge=$e.value;this.checksum=this.checksum>>>8^$[(this.checksum^Ge)&255]}}catch(Xe){Ee={error:Xe}}finally{try{$e&&!$e.done&&(we=ce.return)&&we.call(ce)}finally{if(Ee)throw Ee.error}}return this},ye.prototype.digest=function(){return(this.checksum^4294967295)>>>0},ye}();E.Crc32=G;var H=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],$=(0,R.uint32ArrayFrom)(H),M=requireAws_crc32();Object.defineProperty(E,"AwsCrc32",{enumerable:!0,get:function(){return M.AwsCrc32}})}(build$5)),build$5}requireBuild$3();class Int64{constructor(A){if(this.bytes=A,A.byteLength!==8)throw new Error("Int64 buffers must be exactly 8 bytes")}static fromNumber(A){if(A>9223372036854776e3||A<-9223372036854776e3)throw new Error(`${A} is too large (or, if negative, too small) to represent as an Int64`);const R=new Uint8Array(8);for(let F=7,G=Math.abs(Math.round(A));F>-1&&G>0;F--,G/=256)R[F]=G;return A<0&&negate(R),new Int64(R)}valueOf(){const A=this.bytes.slice(0),R=A[0]&128;return R&&negate(A),parseInt(toHex(A),16)*(R?-1:1)}toString(){return String(this.valueOf())}}function negate(E){for(let A=0;A<8;A++)E[A]^=255;for(let A=7;A>-1&&(E[A]++,E[A]===0);A--);}class HeaderMarshaller{constructor(A,R){this.toUtf8=A,this.fromUtf8=R}format(A){const R=[];for(const H of Object.keys(A)){const $=this.fromUtf8(H);R.push(Uint8Array.from([$.byteLength]),$,this.formatHeaderValue(A[H]))}const F=new Uint8Array(R.reduce((H,$)=>H+$.byteLength,0));let G=0;for(const H of R)F.set(H,G),G+=H.byteLength;return F}formatHeaderValue(A){switch(A.type){case"boolean":return Uint8Array.from([A.value?0:1]);case"byte":return Uint8Array.from([2,A.value]);case"short":const R=new DataView(new ArrayBuffer(3));return R.setUint8(0,3),R.setInt16(1,A.value,!1),new Uint8Array(R.buffer);case"integer":const F=new DataView(new ArrayBuffer(5));return F.setUint8(0,4),F.setInt32(1,A.value,!1),new Uint8Array(F.buffer);case"long":const G=new Uint8Array(9);return G[0]=5,G.set(A.value.bytes,1),G;case"binary":const H=new DataView(new ArrayBuffer(3+A.value.byteLength));H.setUint8(0,6),H.setUint16(1,A.value.byteLength,!1);const $=new Uint8Array(H.buffer);return $.set(A.value,3),$;case"string":const M=this.fromUtf8(A.value),ye=new DataView(new ArrayBuffer(3+M.byteLength));ye.setUint8(0,7),ye.setUint16(1,M.byteLength,!1);const oe=new Uint8Array(ye.buffer);return oe.set(M,3),oe;case"timestamp":const Ee=new Uint8Array(9);return Ee[0]=8,Ee.set(Int64.fromNumber(A.value.valueOf()).bytes,1),Ee;case"uuid":if(!UUID_PATTERN.test(A.value))throw new Error(`Invalid UUID received: ${A.value}`);const we=new Uint8Array(17);return we[0]=9,we.set(fromHex(A.value.replace(/\-/g,"")),1),we}}parse(A){const R={};let F=0;for(;F<A.byteLength;){const G=A.getUint8(F++),H=this.toUtf8(new Uint8Array(A.buffer,A.byteOffset+F,G));switch(F+=G,A.getUint8(F++)){case 0:R[H]={type:BOOLEAN_TAG,value:!0};break;case 1:R[H]={type:BOOLEAN_TAG,value:!1};break;case 2:R[H]={type:BYTE_TAG,value:A.getInt8(F++)};break;case 3:R[H]={type:SHORT_TAG,value:A.getInt16(F,!1)},F+=2;break;case 4:R[H]={type:INT_TAG,value:A.getInt32(F,!1)},F+=4;break;case 5:R[H]={type:LONG_TAG,value:new Int64(new Uint8Array(A.buffer,A.byteOffset+F,8))},F+=8;break;case 6:const $=A.getUint16(F,!1);F+=2,R[H]={type:BINARY_TAG,value:new Uint8Array(A.buffer,A.byteOffset+F,$)},F+=$;break;case 7:const M=A.getUint16(F,!1);F+=2,R[H]={type:STRING_TAG,value:this.toUtf8(new Uint8Array(A.buffer,A.byteOffset+F,M))},F+=M;break;case 8:R[H]={type:TIMESTAMP_TAG,value:new Date(new Int64(new Uint8Array(A.buffer,A.byteOffset+F,8)).valueOf())},F+=8;break;case 9:const ye=new Uint8Array(A.buffer,A.byteOffset+F,16);F+=16,R[H]={type:UUID_TAG,value:`${toHex(ye.subarray(0,4))}-${toHex(ye.subarray(4,6))}-${toHex(ye.subarray(6,8))}-${toHex(ye.subarray(8,10))}-${toHex(ye.subarray(10))}`};break;default:throw new Error("Unrecognized header type tag")}}return R}}var HEADER_VALUE_TYPE;(function(E){E[E.boolTrue=0]="boolTrue",E[E.boolFalse=1]="boolFalse",E[E.byte=2]="byte",E[E.short=3]="short",E[E.integer=4]="integer",E[E.long=5]="long",E[E.byteArray=6]="byteArray",E[E.string=7]="string",E[E.timestamp=8]="timestamp",E[E.uuid=9]="uuid"})(HEADER_VALUE_TYPE||(HEADER_VALUE_TYPE={}));const BOOLEAN_TAG="boolean",BYTE_TAG="byte",SHORT_TAG="short",INT_TAG="integer",LONG_TAG="long",BINARY_TAG="binary",STRING_TAG="string",TIMESTAMP_TAG="timestamp",UUID_TAG="uuid",UUID_PATTERN=/^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$/,ALGORITHM_QUERY_PARAM="X-Amz-Algorithm",CREDENTIAL_QUERY_PARAM="X-Amz-Credential",AMZ_DATE_QUERY_PARAM="X-Amz-Date",SIGNED_HEADERS_QUERY_PARAM="X-Amz-SignedHeaders",EXPIRES_QUERY_PARAM="X-Amz-Expires",SIGNATURE_QUERY_PARAM="X-Amz-Signature",TOKEN_QUERY_PARAM="X-Amz-Security-Token",AUTH_HEADER="authorization",AMZ_DATE_HEADER=AMZ_DATE_QUERY_PARAM.toLowerCase(),DATE_HEADER="date",GENERATED_HEADERS=[AUTH_HEADER,AMZ_DATE_HEADER,DATE_HEADER],SIGNATURE_HEADER=SIGNATURE_QUERY_PARAM.toLowerCase(),SHA256_HEADER="x-amz-content-sha256",TOKEN_HEADER=TOKEN_QUERY_PARAM.toLowerCase(),ALWAYS_UNSIGNABLE_HEADERS={authorization:!0,"cache-control":!0,connection:!0,expect:!0,from:!0,"keep-alive":!0,"max-forwards":!0,pragma:!0,referer:!0,te:!0,trailer:!0,"transfer-encoding":!0,upgrade:!0,"user-agent":!0,"x-amzn-trace-id":!0},PROXY_HEADER_PATTERN=/^proxy-/,SEC_HEADER_PATTERN=/^sec-/,ALGORITHM_IDENTIFIER="AWS4-HMAC-SHA256",EVENT_ALGORITHM_IDENTIFIER="AWS4-HMAC-SHA256-PAYLOAD",UNSIGNED_PAYLOAD="UNSIGNED-PAYLOAD",MAX_CACHE_SIZE=50,KEY_TYPE_IDENTIFIER="aws4_request",MAX_PRESIGNED_TTL=60*60*24*7,signingKeyCache={},cacheQueue=[],createScope=(E,A,R)=>`${E}/${A}/${R}/${KEY_TYPE_IDENTIFIER}`,getSigningKey=async(E,A,R,F,G)=>{const H=await hmac(E,A.secretAccessKey,A.accessKeyId),$=`${R}:${F}:${G}:${toHex(H)}:${A.sessionToken}`;if($ in signingKeyCache)return signingKeyCache[$];for(cacheQueue.push($);cacheQueue.length>MAX_CACHE_SIZE;)delete signingKeyCache[cacheQueue.shift()];let M=`AWS4${A.secretAccessKey}`;for(const ye of[R,F,G,KEY_TYPE_IDENTIFIER])M=await hmac(E,M,ye);return signingKeyCache[$]=M},hmac=(E,A,R)=>{const F=new E(A);return F.update(toUint8Array(R)),F.digest()},getCanonicalHeaders=({headers:E},A,R)=>{const F={};for(const G of Object.keys(E).sort()){if(E[G]==null)continue;const H=G.toLowerCase();(H in ALWAYS_UNSIGNABLE_HEADERS||A!=null&&A.has(H)||PROXY_HEADER_PATTERN.test(H)||SEC_HEADER_PATTERN.test(H))&&(!R||R&&!R.has(H))||(F[H]=E[G].trim().replace(/\s+/g," "))}return F},getCanonicalQuery=({query:E={}})=>{const A=[],R={};for(const F of Object.keys(E).sort()){if(F.toLowerCase()===SIGNATURE_HEADER)continue;A.push(F);const G=E[F];typeof G=="string"?R[F]=`${escapeUri(F)}=${escapeUri(G)}`:Array.isArray(G)&&(R[F]=G.slice(0).reduce((H,$)=>H.concat([`${escapeUri(F)}=${escapeUri($)}`]),[]).sort().join("&"))}return A.map(F=>R[F]).filter(F=>F).join("&")},isArrayBuffer=E=>typeof ArrayBuffer=="function"&&E instanceof ArrayBuffer||Object.prototype.toString.call(E)==="[object ArrayBuffer]",getPayloadHash=async({headers:E,body:A},R)=>{for(const F of Object.keys(E))if(F.toLowerCase()===SHA256_HEADER)return E[F];if(A==null)return"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855";if(typeof A=="string"||ArrayBuffer.isView(A)||isArrayBuffer(A)){const F=new R;return F.update(toUint8Array(A)),toHex(await F.digest())}return UNSIGNED_PAYLOAD},hasHeader=(E,A)=>{E=E.toLowerCase();for(const R of Object.keys(A))if(E===R.toLowerCase())return!0;return!1},cloneRequest=({headers:E,query:A,...R})=>({...R,headers:{...E},query:A?cloneQuery(A):void 0}),cloneQuery=E=>Object.keys(E).reduce((A,R)=>{const F=E[R];return{...A,[R]:Array.isArray(F)?[...F]:F}},{}),moveHeadersToQuery=(E,A={})=>{var G;const{headers:R,query:F={}}=typeof E.clone=="function"?E.clone():cloneRequest(E);for(const H of Object.keys(R)){const $=H.toLowerCase();$.slice(0,6)==="x-amz-"&&!((G=A.unhoistableHeaders)!=null&&G.has($))&&(F[H]=R[H],delete R[H])}return{...E,headers:R,query:F}},prepareRequest=E=>{E=typeof E.clone=="function"?E.clone():cloneRequest(E);for(const A of Object.keys(E.headers))GENERATED_HEADERS.indexOf(A.toLowerCase())>-1&&delete E.headers[A];return E},iso8601=E=>toDate(E).toISOString().replace(/\.\d{3}Z$/,"Z"),toDate=E=>typeof E=="number"?new Date(E*1e3):typeof E=="string"?Number(E)?new Date(Number(E)*1e3):new Date(E):E;class SignatureV4{constructor({applyChecksum:A,credentials:R,region:F,service:G,sha256:H,uriEscapePath:$=!0}){this.headerMarshaller=new HeaderMarshaller(toUtf8$3,fromUtf8$3),this.service=G,this.sha256=H,this.uriEscapePath=$,this.applyChecksum=typeof A=="boolean"?A:!0,this.regionProvider=normalizeProvider$1(F),this.credentialProvider=normalizeProvider$1(R)}async presign(A,R={}){const{signingDate:F=new Date,expiresIn:G=3600,unsignableHeaders:H,unhoistableHeaders:$,signableHeaders:M,signingRegion:ye,signingService:oe}=R,Ee=await this.credentialProvider();this.validateResolvedCredentials(Ee);const we=ye??await this.regionProvider(),{longDate:ce,shortDate:$e}=formatDate(F);if(G>MAX_PRESIGNED_TTL)return Promise.reject("Signature version 4 presigned URLs must have an expiration date less than one week in the future");const Ge=createScope($e,we,oe??this.service),Xe=moveHeadersToQuery(prepareRequest(A),{unhoistableHeaders:$});Ee.sessionToken&&(Xe.query[TOKEN_QUERY_PARAM]=Ee.sessionToken),Xe.query[ALGORITHM_QUERY_PARAM]=ALGORITHM_IDENTIFIER,Xe.query[CREDENTIAL_QUERY_PARAM]=`${Ee.accessKeyId}/${Ge}`,Xe.query[AMZ_DATE_QUERY_PARAM]=ce,Xe.query[EXPIRES_QUERY_PARAM]=G.toString(10);const ht=getCanonicalHeaders(Xe,H,M);return Xe.query[SIGNED_HEADERS_QUERY_PARAM]=getCanonicalHeaderList(ht),Xe.query[SIGNATURE_QUERY_PARAM]=await this.getSignature(ce,Ge,this.getSigningKey(Ee,we,$e,oe),this.createCanonicalRequest(Xe,ht,await getPayloadHash(A,this.sha256))),Xe}async sign(A,R){return typeof A=="string"?this.signString(A,R):A.headers&&A.payload?this.signEvent(A,R):A.message?this.signMessage(A,R):this.signRequest(A,R)}async signEvent({headers:A,payload:R},{signingDate:F=new Date,priorSignature:G,signingRegion:H,signingService:$}){const M=H??await this.regionProvider(),{shortDate:ye,longDate:oe}=formatDate(F),Ee=createScope(ye,M,$??this.service),we=await getPayloadHash({headers:{},body:R},this.sha256),ce=new this.sha256;ce.update(A);const $e=toHex(await ce.digest()),Ge=[EVENT_ALGORITHM_IDENTIFIER,oe,Ee,G,$e,we].join(`
`);return this.signString(Ge,{signingDate:F,signingRegion:M,signingService:$})}async signMessage(A,{signingDate:R=new Date,signingRegion:F,signingService:G}){return this.signEvent({headers:this.headerMarshaller.format(A.message.headers),payload:A.message.body},{signingDate:R,signingRegion:F,signingService:G,priorSignature:A.priorSignature}).then($=>({message:A.message,signature:$}))}async signString(A,{signingDate:R=new Date,signingRegion:F,signingService:G}={}){const H=await this.credentialProvider();this.validateResolvedCredentials(H);const $=F??await this.regionProvider(),{shortDate:M}=formatDate(R),ye=new this.sha256(await this.getSigningKey(H,$,M,G));return ye.update(toUint8Array(A)),toHex(await ye.digest())}async signRequest(A,{signingDate:R=new Date,signableHeaders:F,unsignableHeaders:G,signingRegion:H,signingService:$}={}){const M=await this.credentialProvider();this.validateResolvedCredentials(M);const ye=H??await this.regionProvider(),oe=prepareRequest(A),{longDate:Ee,shortDate:we}=formatDate(R),ce=createScope(we,ye,$??this.service);oe.headers[AMZ_DATE_HEADER]=Ee,M.sessionToken&&(oe.headers[TOKEN_HEADER]=M.sessionToken);const $e=await getPayloadHash(oe,this.sha256);!hasHeader(SHA256_HEADER,oe.headers)&&this.applyChecksum&&(oe.headers[SHA256_HEADER]=$e);const Ge=getCanonicalHeaders(oe,G,F),Xe=await this.getSignature(Ee,ce,this.getSigningKey(M,ye,we,$),this.createCanonicalRequest(oe,Ge,$e));return oe.headers[AUTH_HEADER]=`${ALGORITHM_IDENTIFIER} Credential=${M.accessKeyId}/${ce}, SignedHeaders=${getCanonicalHeaderList(Ge)}, Signature=${Xe}`,oe}createCanonicalRequest(A,R,F){const G=Object.keys(R).sort();return`${A.method}
${this.getCanonicalPath(A)}
${getCanonicalQuery(A)}
${G.map(H=>`${H}:${R[H]}`).join(`
`)}

${G.join(";")}
${F}`}async createStringToSign(A,R,F){const G=new this.sha256;G.update(toUint8Array(F));const H=await G.digest();return`${ALGORITHM_IDENTIFIER}
${A}
${R}
${toHex(H)}`}getCanonicalPath({path:A}){if(this.uriEscapePath){const R=[];for(const H of A.split("/"))(H==null?void 0:H.length)!==0&&H!=="."&&(H===".."?R.pop():R.push(H));const F=`${A!=null&&A.startsWith("/")?"/":""}${R.join("/")}${R.length>0&&(A!=null&&A.endsWith("/"))?"/":""}`;return encodeURIComponent(F).replace(/%2F/g,"/")}return A}async getSignature(A,R,F,G){const H=await this.createStringToSign(A,R,G),$=new this.sha256(await F);return $.update(toUint8Array(H)),toHex(await $.digest())}getSigningKey(A,R,F,G){return getSigningKey(this.sha256,A,F,R,G||this.service)}validateResolvedCredentials(A){if(typeof A!="object"||typeof A.accessKeyId!="string"||typeof A.secretAccessKey!="string")throw new Error("Resolved credential object is not valid")}}const formatDate=E=>{const A=iso8601(E).replace(/[\-:]/g,"");return{longDate:A,shortDate:A.slice(0,8)}},getCanonicalHeaderList=E=>Object.keys(E).sort().join(";"),resolveAwsSdkSigV4Config=E=>{let A;E.credentials&&(A=memoizeIdentityProvider(E.credentials,isIdentityExpired,doesIdentityRequireRefresh)),A||(E.credentialDefaultProvider?A=normalizeProvider(E.credentialDefaultProvider(Object.assign({},E,{parentClientConfig:E}))):A=async()=>{throw new Error("`credentials` is missing")});const{signingEscapePath:R=!0,systemClockOffset:F=E.systemClockOffset||0,sha256:G}=E;let H;return E.signer?H=normalizeProvider(E.signer):E.regionInfoProvider?H=()=>normalizeProvider(E.region)().then(async $=>[await E.regionInfoProvider($,{useFipsEndpoint:await E.useFipsEndpoint(),useDualstackEndpoint:await E.useDualstackEndpoint()})||{},$]).then(([$,M])=>{const{signingRegion:ye,signingService:oe}=$;E.signingRegion=E.signingRegion||ye||M,E.signingName=E.signingName||oe||E.serviceId;const Ee={...E,credentials:A,region:E.signingRegion,service:E.signingName,sha256:G,uriEscapePath:R},we=E.signerConstructor||SignatureV4;return new we(Ee)}):H=async $=>{$=Object.assign({},{name:"sigv4",signingName:E.signingName||E.defaultSigningName,signingRegion:await normalizeProvider(E.region)(),properties:{}},$);const M=$.signingRegion,ye=$.signingName;E.signingRegion=E.signingRegion||M,E.signingName=E.signingName||ye||E.serviceId;const oe={...E,credentials:A,region:E.signingRegion,service:E.signingName,sha256:G,uriEscapePath:R},Ee=E.signerConstructor||SignatureV4;return new Ee(oe)},{...E,systemClockOffset:F,signingEscapePath:R,credentials:A,signer:H}},collectBodyString=(E,A)=>collectBody(E,A).then(R=>A.utf8Encoder(R)),parseJsonBody=(E,A)=>collectBodyString(E,A).then(R=>{if(R.length)try{return JSON.parse(R)}catch(F){throw(F==null?void 0:F.name)==="SyntaxError"&&Object.defineProperty(F,"$responseBodyText",{value:R}),F}return{}}),parseJsonErrorBody=async(E,A)=>{const R=await parseJsonBody(E,A);return R.message=R.message??R.Message,R},loadRestJsonErrorCode=(E,A)=>{const R=(H,$)=>Object.keys(H).find(M=>M.toLowerCase()===$.toLowerCase()),F=H=>{let $=H;return typeof $=="number"&&($=$.toString()),$.indexOf(",")>=0&&($=$.split(",")[0]),$.indexOf(":")>=0&&($=$.split(":")[0]),$.indexOf("#")>=0&&($=$.split("#")[1]),$},G=R(E.headers,"x-amzn-errortype");if(G!==void 0)return F(E.headers[G]);if(A.code!==void 0)return F(A.code);if(A.__type!==void 0)return F(A.__type)},defaultLocationHttpAuthSchemeParametersProvider=async(E,A,R)=>({operation:getSmithyContext(A).operation,region:await normalizeProvider$1(E.region)()||(()=>{throw new Error("expected `region` to be configured for `aws.auth#sigv4`")})()});function createAwsAuthSigv4HttpAuthOption(E){return{schemeId:"aws.auth#sigv4",signingProperties:{name:"geo",region:E.region},propertiesExtractor:(A,R)=>({signingProperties:{config:A,context:R}})}}const defaultLocationHttpAuthSchemeProvider=E=>{const A=[];switch(E.operation){default:A.push(createAwsAuthSigv4HttpAuthOption(E))}return A},resolveHttpAuthSchemeConfig=E=>({...resolveAwsSdkSigV4Config(E)}),resolveClientEndpointParameters=E=>({...E,useDualstackEndpoint:E.useDualstackEndpoint??!1,useFipsEndpoint:E.useFipsEndpoint??!1,defaultSigningName:"geo"}),commonParams={UseFIPS:{type:"builtInParams",name:"useFipsEndpoint"},Endpoint:{type:"builtInParams",name:"endpoint"},Region:{type:"builtInParams",name:"region"},UseDualStack:{type:"builtInParams",name:"useDualstackEndpoint"}},name="@aws-sdk/client-location",description="AWS SDK for JavaScript Location Client for Node.js, Browser and React Native",version="3.540.0",scripts={build:"concurrently 'yarn:build:cjs' 'yarn:build:es' 'yarn:build:types'","build:cjs":"node ../../scripts/compilation/inline client-location","build:es":"tsc -p tsconfig.es.json","build:include:deps":"lerna run --scope $npm_package_name --include-dependencies build","build:types":"tsc -p tsconfig.types.json","build:types:downlevel":"downlevel-dts dist-types dist-types/ts3.4",clean:"rimraf ./dist-* && rimraf *.tsbuildinfo","extract:docs":"api-extractor run --local","generate:client":"node ../../scripts/generate-clients/single-service --solo location"},main="./dist-cjs/index.js",types="./dist-types/index.d.ts",module="./dist-es/index.js",sideEffects=!1,dependencies={"@aws-crypto/sha256-browser":"3.0.0","@aws-crypto/sha256-js":"3.0.0","@aws-sdk/client-sts":"3.540.0","@aws-sdk/core":"3.535.0","@aws-sdk/credential-provider-node":"3.540.0","@aws-sdk/middleware-host-header":"3.535.0","@aws-sdk/middleware-logger":"3.535.0","@aws-sdk/middleware-recursion-detection":"3.535.0","@aws-sdk/middleware-user-agent":"3.540.0","@aws-sdk/region-config-resolver":"3.535.0","@aws-sdk/types":"3.535.0","@aws-sdk/util-endpoints":"3.540.0","@aws-sdk/util-user-agent-browser":"3.535.0","@aws-sdk/util-user-agent-node":"3.535.0","@smithy/config-resolver":"^2.2.0","@smithy/core":"^1.4.0","@smithy/fetch-http-handler":"^2.5.0","@smithy/hash-node":"^2.2.0","@smithy/invalid-dependency":"^2.2.0","@smithy/middleware-content-length":"^2.2.0","@smithy/middleware-endpoint":"^2.5.0","@smithy/middleware-retry":"^2.2.0","@smithy/middleware-serde":"^2.3.0","@smithy/middleware-stack":"^2.2.0","@smithy/node-config-provider":"^2.3.0","@smithy/node-http-handler":"^2.5.0","@smithy/protocol-http":"^3.3.0","@smithy/smithy-client":"^2.5.0","@smithy/types":"^2.12.0","@smithy/url-parser":"^2.2.0","@smithy/util-base64":"^2.3.0","@smithy/util-body-length-browser":"^2.2.0","@smithy/util-body-length-node":"^2.3.0","@smithy/util-defaults-mode-browser":"^2.2.0","@smithy/util-defaults-mode-node":"^2.3.0","@smithy/util-endpoints":"^1.2.0","@smithy/util-middleware":"^2.2.0","@smithy/util-retry":"^2.2.0","@smithy/util-stream":"^2.2.0","@smithy/util-utf8":"^2.3.0",tslib:"^2.6.2"},devDependencies={"@smithy/service-client-documentation-generator":"^2.2.0","@tsconfig/node14":"1.0.3","@types/node":"^14.14.31",concurrently:"7.0.0","downlevel-dts":"0.10.1",rimraf:"3.0.2",typescript:"~4.9.5"},engines={node:">=14.0.0"},typesVersions={"<4.0":{"dist-types/*":["dist-types/ts3.4/*"]}},files=["dist-*/**"],author={name:"AWS SDK for JavaScript Team",url:"https://aws.amazon.com/javascript/"},license="Apache-2.0",browser={"./dist-es/runtimeConfig":"./dist-es/runtimeConfig.browser"},homepage="https://github.com/aws/aws-sdk-js-v3/tree/main/clients/client-location",repository={type:"git",url:"https://github.com/aws/aws-sdk-js-v3.git",directory:"clients/client-location"},packageInfo={name,description,version,scripts,main,types,module,sideEffects,dependencies,devDependencies,engines,typesVersions,files,author,license,browser,"react-native":{"./dist-es/runtimeConfig":"./dist-es/runtimeConfig.native"},homepage,repository};var build$3={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var extendStatics$3=function(E,A){return extendStatics$3=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,F){R.__proto__=F}||function(R,F){for(var G in F)F.hasOwnProperty(G)&&(R[G]=F[G])},extendStatics$3(E,A)};function __extends$3(E,A){extendStatics$3(E,A);function R(){this.constructor=E}E.prototype=A===null?Object.create(A):(R.prototype=A.prototype,new R)}var __assign$3=function(){return __assign$3=Object.assign||function(A){for(var R,F=1,G=arguments.length;F<G;F++){R=arguments[F];for(var H in R)Object.prototype.hasOwnProperty.call(R,H)&&(A[H]=R[H])}return A},__assign$3.apply(this,arguments)};function __rest$3(E,A){var R={};for(var F in E)Object.prototype.hasOwnProperty.call(E,F)&&A.indexOf(F)<0&&(R[F]=E[F]);if(E!=null&&typeof Object.getOwnPropertySymbols=="function")for(var G=0,F=Object.getOwnPropertySymbols(E);G<F.length;G++)A.indexOf(F[G])<0&&Object.prototype.propertyIsEnumerable.call(E,F[G])&&(R[F[G]]=E[F[G]]);return R}function __decorate$3(E,A,R,F){var G=arguments.length,H=G<3?A:F===null?F=Object.getOwnPropertyDescriptor(A,R):F,$;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")H=Reflect.decorate(E,A,R,F);else for(var M=E.length-1;M>=0;M--)($=E[M])&&(H=(G<3?$(H):G>3?$(A,R,H):$(A,R))||H);return G>3&&H&&Object.defineProperty(A,R,H),H}function __param$3(E,A){return function(R,F){A(R,F,E)}}function __metadata$3(E,A){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(E,A)}function __awaiter$3(E,A,R,F){function G(H){return H instanceof R?H:new R(function($){$(H)})}return new(R||(R=Promise))(function(H,$){function M(Ee){try{oe(F.next(Ee))}catch(we){$(we)}}function ye(Ee){try{oe(F.throw(Ee))}catch(we){$(we)}}function oe(Ee){Ee.done?H(Ee.value):G(Ee.value).then(M,ye)}oe((F=F.apply(E,A||[])).next())})}function __generator$3(E,A){var R={label:0,sent:function(){if(H[0]&1)throw H[1];return H[1]},trys:[],ops:[]},F,G,H,$;return $={next:M(0),throw:M(1),return:M(2)},typeof Symbol=="function"&&($[Symbol.iterator]=function(){return this}),$;function M(oe){return function(Ee){return ye([oe,Ee])}}function ye(oe){if(F)throw new TypeError("Generator is already executing.");for(;R;)try{if(F=1,G&&(H=oe[0]&2?G.return:oe[0]?G.throw||((H=G.return)&&H.call(G),0):G.next)&&!(H=H.call(G,oe[1])).done)return H;switch(G=0,H&&(oe=[oe[0]&2,H.value]),oe[0]){case 0:case 1:H=oe;break;case 4:return R.label++,{value:oe[1],done:!1};case 5:R.label++,G=oe[1],oe=[0];continue;case 7:oe=R.ops.pop(),R.trys.pop();continue;default:if(H=R.trys,!(H=H.length>0&&H[H.length-1])&&(oe[0]===6||oe[0]===2)){R=0;continue}if(oe[0]===3&&(!H||oe[1]>H[0]&&oe[1]<H[3])){R.label=oe[1];break}if(oe[0]===6&&R.label<H[1]){R.label=H[1],H=oe;break}if(H&&R.label<H[2]){R.label=H[2],R.ops.push(oe);break}H[2]&&R.ops.pop(),R.trys.pop();continue}oe=A.call(E,R)}catch(Ee){oe=[6,Ee],G=0}finally{F=H=0}if(oe[0]&5)throw oe[1];return{value:oe[0]?oe[1]:void 0,done:!0}}}function __createBinding$3(E,A,R,F){F===void 0&&(F=R),E[F]=A[R]}function __exportStar$3(E,A){for(var R in E)R!=="default"&&!A.hasOwnProperty(R)&&(A[R]=E[R])}function __values$3(E){var A=typeof Symbol=="function"&&Symbol.iterator,R=A&&E[A],F=0;if(R)return R.call(E);if(E&&typeof E.length=="number")return{next:function(){return E&&F>=E.length&&(E=void 0),{value:E&&E[F++],done:!E}}};throw new TypeError(A?"Object is not iterable.":"Symbol.iterator is not defined.")}function __read$3(E,A){var R=typeof Symbol=="function"&&E[Symbol.iterator];if(!R)return E;var F=R.call(E),G,H=[],$;try{for(;(A===void 0||A-- >0)&&!(G=F.next()).done;)H.push(G.value)}catch(M){$={error:M}}finally{try{G&&!G.done&&(R=F.return)&&R.call(F)}finally{if($)throw $.error}}return H}function __spread$3(){for(var E=[],A=0;A<arguments.length;A++)E=E.concat(__read$3(arguments[A]));return E}function __spreadArrays$3(){for(var E=0,A=0,R=arguments.length;A<R;A++)E+=arguments[A].length;for(var F=Array(E),G=0,A=0;A<R;A++)for(var H=arguments[A],$=0,M=H.length;$<M;$++,G++)F[G]=H[$];return F}function __await$3(E){return this instanceof __await$3?(this.v=E,this):new __await$3(E)}function __asyncGenerator$3(E,A,R){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var F=R.apply(E,A||[]),G,H=[];return G={},$("next"),$("throw"),$("return"),G[Symbol.asyncIterator]=function(){return this},G;function $(ce){F[ce]&&(G[ce]=function($e){return new Promise(function(Ge,Xe){H.push([ce,$e,Ge,Xe])>1||M(ce,$e)})})}function M(ce,$e){try{ye(F[ce]($e))}catch(Ge){we(H[0][3],Ge)}}function ye(ce){ce.value instanceof __await$3?Promise.resolve(ce.value.v).then(oe,Ee):we(H[0][2],ce)}function oe(ce){M("next",ce)}function Ee(ce){M("throw",ce)}function we(ce,$e){ce($e),H.shift(),H.length&&M(H[0][0],H[0][1])}}function __asyncDelegator$3(E){var A,R;return A={},F("next"),F("throw",function(G){throw G}),F("return"),A[Symbol.iterator]=function(){return this},A;function F(G,H){A[G]=E[G]?function($){return(R=!R)?{value:__await$3(E[G]($)),done:G==="return"}:H?H($):$}:H}}function __asyncValues$3(E){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var A=E[Symbol.asyncIterator],R;return A?A.call(E):(E=typeof __values$3=="function"?__values$3(E):E[Symbol.iterator](),R={},F("next"),F("throw"),F("return"),R[Symbol.asyncIterator]=function(){return this},R);function F(H){R[H]=E[H]&&function($){return new Promise(function(M,ye){$=E[H]($),G(M,ye,$.done,$.value)})}}function G(H,$,M,ye){Promise.resolve(ye).then(function(oe){H({value:oe,done:M})},$)}}function __makeTemplateObject$3(E,A){return Object.defineProperty?Object.defineProperty(E,"raw",{value:A}):E.raw=A,E}function __importStar$3(E){if(E&&E.__esModule)return E;var A={};if(E!=null)for(var R in E)Object.hasOwnProperty.call(E,R)&&(A[R]=E[R]);return A.default=E,A}function __importDefault$3(E){return E&&E.__esModule?E:{default:E}}function __classPrivateFieldGet$3(E,A){if(!A.has(E))throw new TypeError("attempted to get private field on non-instance");return A.get(E)}function __classPrivateFieldSet$3(E,A,R){if(!A.has(E))throw new TypeError("attempted to set private field on non-instance");return A.set(E,R),R}const tslib_es6$3=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return __assign$3},__asyncDelegator:__asyncDelegator$3,__asyncGenerator:__asyncGenerator$3,__asyncValues:__asyncValues$3,__await:__await$3,__awaiter:__awaiter$3,__classPrivateFieldGet:__classPrivateFieldGet$3,__classPrivateFieldSet:__classPrivateFieldSet$3,__createBinding:__createBinding$3,__decorate:__decorate$3,__exportStar:__exportStar$3,__extends:__extends$3,__generator:__generator$3,__importDefault:__importDefault$3,__importStar:__importStar$3,__makeTemplateObject:__makeTemplateObject$3,__metadata:__metadata$3,__param:__param$3,__read:__read$3,__rest:__rest$3,__spread:__spread$3,__spreadArrays:__spreadArrays$3,__values:__values$3},Symbol.toStringTag,{value:"Module"})),require$$0$3=getAugmentedNamespace(tslib_es6$3);var crossPlatformSha256={},ie11Sha256={},isEmptyData={},hasRequiredIsEmptyData;function requireIsEmptyData(){if(hasRequiredIsEmptyData)return isEmptyData;hasRequiredIsEmptyData=1,Object.defineProperty(isEmptyData,"__esModule",{value:!0}),isEmptyData.isEmptyData=void 0;function E(A){return typeof A=="string"?A.length===0:A.byteLength===0}return isEmptyData.isEmptyData=E,isEmptyData}var constants$1={},hasRequiredConstants$1;function requireConstants$1(){return hasRequiredConstants$1||(hasRequiredConstants$1=1,function(E){Object.defineProperty(E,"__esModule",{value:!0}),E.EMPTY_DATA_SHA_256=E.SHA_256_HMAC_ALGO=E.SHA_256_HASH=void 0,E.SHA_256_HASH={name:"SHA-256"},E.SHA_256_HMAC_ALGO={name:"HMAC",hash:E.SHA_256_HASH},E.EMPTY_DATA_SHA_256=new Uint8Array([227,176,196,66,152,252,28,20,154,251,244,200,153,111,185,36,39,174,65,228,100,155,147,76,164,149,153,27,120,82,184,85])}(constants$1)),constants$1}var hasRequiredIe11Sha256;function requireIe11Sha256(){if(hasRequiredIe11Sha256)return ie11Sha256;hasRequiredIe11Sha256=1,Object.defineProperty(ie11Sha256,"__esModule",{value:!0}),ie11Sha256.Sha256=void 0;var E=requireIsEmptyData(),A=requireConstants$1(),R=require$$2,F=require$$5,G=function(){function M(ye){this.secret=ye,this.reset()}return M.prototype.update=function(ye){var oe=this;(0,E.isEmptyData)(ye)||(this.operation=this.operation.then(function(Ee){return Ee.onerror=function(){oe.operation=Promise.reject(new Error("Error encountered updating hash"))},Ee.process($(ye)),Ee}),this.operation.catch(function(){}))},M.prototype.digest=function(){return this.operation.then(function(ye){return new Promise(function(oe,Ee){ye.onerror=function(){Ee(new Error("Error encountered finalizing hash"))},ye.oncomplete=function(){ye.result&&oe(new Uint8Array(ye.result)),Ee(new Error("Error encountered finalizing hash"))},ye.finish()})})},M.prototype.reset=function(){this.secret?(this.operation=H(this.secret).then(function(ye){return(0,F.locateWindow)().msCrypto.subtle.sign(A.SHA_256_HMAC_ALGO,ye)}),this.operation.catch(function(){})):this.operation=Promise.resolve((0,F.locateWindow)().msCrypto.subtle.digest("SHA-256"))},M}();ie11Sha256.Sha256=G;function H(M){return new Promise(function(ye,oe){var Ee=(0,F.locateWindow)().msCrypto.subtle.importKey("raw",$(M),A.SHA_256_HMAC_ALGO,!1,["sign"]);Ee.oncomplete=function(){Ee.result&&ye(Ee.result),oe(new Error("ImportKey completed without importing key."))},Ee.onerror=function(){oe(new Error("ImportKey failed to import key."))}})}function $(M){return typeof M=="string"?(0,R.fromUtf8)(M):ArrayBuffer.isView(M)?new Uint8Array(M.buffer,M.byteOffset,M.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(M)}return ie11Sha256}var webCryptoSha256={},hasRequiredWebCryptoSha256;function requireWebCryptoSha256(){if(hasRequiredWebCryptoSha256)return webCryptoSha256;hasRequiredWebCryptoSha256=1,Object.defineProperty(webCryptoSha256,"__esModule",{value:!0}),webCryptoSha256.Sha256=void 0;var E=requireBuild$4(),A=requireConstants$1(),R=require$$5,F=function(){function G(H){this.toHash=new Uint8Array(0),this.secret=H,this.reset()}return G.prototype.update=function(H){if(!(0,E.isEmptyData)(H)){var $=(0,E.convertToBuffer)(H),M=new Uint8Array(this.toHash.byteLength+$.byteLength);M.set(this.toHash,0),M.set($,this.toHash.byteLength),this.toHash=M}},G.prototype.digest=function(){var H=this;return this.key?this.key.then(function($){return(0,R.locateWindow)().crypto.subtle.sign(A.SHA_256_HMAC_ALGO,$,H.toHash).then(function(M){return new Uint8Array(M)})}):(0,E.isEmptyData)(this.toHash)?Promise.resolve(A.EMPTY_DATA_SHA_256):Promise.resolve().then(function(){return(0,R.locateWindow)().crypto.subtle.digest(A.SHA_256_HASH,H.toHash)}).then(function($){return Promise.resolve(new Uint8Array($))})},G.prototype.reset=function(){var H=this;this.toHash=new Uint8Array(0),this.secret&&this.secret!==void 0&&(this.key=new Promise(function($,M){(0,R.locateWindow)().crypto.subtle.importKey("raw",(0,E.convertToBuffer)(H.secret),A.SHA_256_HMAC_ALGO,!1,["sign"]).then($,M)}),this.key.catch(function(){}))},G}();return webCryptoSha256.Sha256=F,webCryptoSha256}var build$2={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var extendStatics$2=function(E,A){return extendStatics$2=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,F){R.__proto__=F}||function(R,F){for(var G in F)F.hasOwnProperty(G)&&(R[G]=F[G])},extendStatics$2(E,A)};function __extends$2(E,A){extendStatics$2(E,A);function R(){this.constructor=E}E.prototype=A===null?Object.create(A):(R.prototype=A.prototype,new R)}var __assign$2=function(){return __assign$2=Object.assign||function(A){for(var R,F=1,G=arguments.length;F<G;F++){R=arguments[F];for(var H in R)Object.prototype.hasOwnProperty.call(R,H)&&(A[H]=R[H])}return A},__assign$2.apply(this,arguments)};function __rest$2(E,A){var R={};for(var F in E)Object.prototype.hasOwnProperty.call(E,F)&&A.indexOf(F)<0&&(R[F]=E[F]);if(E!=null&&typeof Object.getOwnPropertySymbols=="function")for(var G=0,F=Object.getOwnPropertySymbols(E);G<F.length;G++)A.indexOf(F[G])<0&&Object.prototype.propertyIsEnumerable.call(E,F[G])&&(R[F[G]]=E[F[G]]);return R}function __decorate$2(E,A,R,F){var G=arguments.length,H=G<3?A:F===null?F=Object.getOwnPropertyDescriptor(A,R):F,$;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")H=Reflect.decorate(E,A,R,F);else for(var M=E.length-1;M>=0;M--)($=E[M])&&(H=(G<3?$(H):G>3?$(A,R,H):$(A,R))||H);return G>3&&H&&Object.defineProperty(A,R,H),H}function __param$2(E,A){return function(R,F){A(R,F,E)}}function __metadata$2(E,A){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(E,A)}function __awaiter$2(E,A,R,F){function G(H){return H instanceof R?H:new R(function($){$(H)})}return new(R||(R=Promise))(function(H,$){function M(Ee){try{oe(F.next(Ee))}catch(we){$(we)}}function ye(Ee){try{oe(F.throw(Ee))}catch(we){$(we)}}function oe(Ee){Ee.done?H(Ee.value):G(Ee.value).then(M,ye)}oe((F=F.apply(E,A||[])).next())})}function __generator$2(E,A){var R={label:0,sent:function(){if(H[0]&1)throw H[1];return H[1]},trys:[],ops:[]},F,G,H,$;return $={next:M(0),throw:M(1),return:M(2)},typeof Symbol=="function"&&($[Symbol.iterator]=function(){return this}),$;function M(oe){return function(Ee){return ye([oe,Ee])}}function ye(oe){if(F)throw new TypeError("Generator is already executing.");for(;R;)try{if(F=1,G&&(H=oe[0]&2?G.return:oe[0]?G.throw||((H=G.return)&&H.call(G),0):G.next)&&!(H=H.call(G,oe[1])).done)return H;switch(G=0,H&&(oe=[oe[0]&2,H.value]),oe[0]){case 0:case 1:H=oe;break;case 4:return R.label++,{value:oe[1],done:!1};case 5:R.label++,G=oe[1],oe=[0];continue;case 7:oe=R.ops.pop(),R.trys.pop();continue;default:if(H=R.trys,!(H=H.length>0&&H[H.length-1])&&(oe[0]===6||oe[0]===2)){R=0;continue}if(oe[0]===3&&(!H||oe[1]>H[0]&&oe[1]<H[3])){R.label=oe[1];break}if(oe[0]===6&&R.label<H[1]){R.label=H[1],H=oe;break}if(H&&R.label<H[2]){R.label=H[2],R.ops.push(oe);break}H[2]&&R.ops.pop(),R.trys.pop();continue}oe=A.call(E,R)}catch(Ee){oe=[6,Ee],G=0}finally{F=H=0}if(oe[0]&5)throw oe[1];return{value:oe[0]?oe[1]:void 0,done:!0}}}function __createBinding$2(E,A,R,F){F===void 0&&(F=R),E[F]=A[R]}function __exportStar$2(E,A){for(var R in E)R!=="default"&&!A.hasOwnProperty(R)&&(A[R]=E[R])}function __values$2(E){var A=typeof Symbol=="function"&&Symbol.iterator,R=A&&E[A],F=0;if(R)return R.call(E);if(E&&typeof E.length=="number")return{next:function(){return E&&F>=E.length&&(E=void 0),{value:E&&E[F++],done:!E}}};throw new TypeError(A?"Object is not iterable.":"Symbol.iterator is not defined.")}function __read$2(E,A){var R=typeof Symbol=="function"&&E[Symbol.iterator];if(!R)return E;var F=R.call(E),G,H=[],$;try{for(;(A===void 0||A-- >0)&&!(G=F.next()).done;)H.push(G.value)}catch(M){$={error:M}}finally{try{G&&!G.done&&(R=F.return)&&R.call(F)}finally{if($)throw $.error}}return H}function __spread$2(){for(var E=[],A=0;A<arguments.length;A++)E=E.concat(__read$2(arguments[A]));return E}function __spreadArrays$2(){for(var E=0,A=0,R=arguments.length;A<R;A++)E+=arguments[A].length;for(var F=Array(E),G=0,A=0;A<R;A++)for(var H=arguments[A],$=0,M=H.length;$<M;$++,G++)F[G]=H[$];return F}function __await$2(E){return this instanceof __await$2?(this.v=E,this):new __await$2(E)}function __asyncGenerator$2(E,A,R){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var F=R.apply(E,A||[]),G,H=[];return G={},$("next"),$("throw"),$("return"),G[Symbol.asyncIterator]=function(){return this},G;function $(ce){F[ce]&&(G[ce]=function($e){return new Promise(function(Ge,Xe){H.push([ce,$e,Ge,Xe])>1||M(ce,$e)})})}function M(ce,$e){try{ye(F[ce]($e))}catch(Ge){we(H[0][3],Ge)}}function ye(ce){ce.value instanceof __await$2?Promise.resolve(ce.value.v).then(oe,Ee):we(H[0][2],ce)}function oe(ce){M("next",ce)}function Ee(ce){M("throw",ce)}function we(ce,$e){ce($e),H.shift(),H.length&&M(H[0][0],H[0][1])}}function __asyncDelegator$2(E){var A,R;return A={},F("next"),F("throw",function(G){throw G}),F("return"),A[Symbol.iterator]=function(){return this},A;function F(G,H){A[G]=E[G]?function($){return(R=!R)?{value:__await$2(E[G]($)),done:G==="return"}:H?H($):$}:H}}function __asyncValues$2(E){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var A=E[Symbol.asyncIterator],R;return A?A.call(E):(E=typeof __values$2=="function"?__values$2(E):E[Symbol.iterator](),R={},F("next"),F("throw"),F("return"),R[Symbol.asyncIterator]=function(){return this},R);function F(H){R[H]=E[H]&&function($){return new Promise(function(M,ye){$=E[H]($),G(M,ye,$.done,$.value)})}}function G(H,$,M,ye){Promise.resolve(ye).then(function(oe){H({value:oe,done:M})},$)}}function __makeTemplateObject$2(E,A){return Object.defineProperty?Object.defineProperty(E,"raw",{value:A}):E.raw=A,E}function __importStar$2(E){if(E&&E.__esModule)return E;var A={};if(E!=null)for(var R in E)Object.hasOwnProperty.call(E,R)&&(A[R]=E[R]);return A.default=E,A}function __importDefault$2(E){return E&&E.__esModule?E:{default:E}}function __classPrivateFieldGet$2(E,A){if(!A.has(E))throw new TypeError("attempted to get private field on non-instance");return A.get(E)}function __classPrivateFieldSet$2(E,A,R){if(!A.has(E))throw new TypeError("attempted to set private field on non-instance");return A.set(E,R),R}const tslib_es6$2=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return __assign$2},__asyncDelegator:__asyncDelegator$2,__asyncGenerator:__asyncGenerator$2,__asyncValues:__asyncValues$2,__await:__await$2,__awaiter:__awaiter$2,__classPrivateFieldGet:__classPrivateFieldGet$2,__classPrivateFieldSet:__classPrivateFieldSet$2,__createBinding:__createBinding$2,__decorate:__decorate$2,__exportStar:__exportStar$2,__extends:__extends$2,__generator:__generator$2,__importDefault:__importDefault$2,__importStar:__importStar$2,__makeTemplateObject:__makeTemplateObject$2,__metadata:__metadata$2,__param:__param$2,__read:__read$2,__rest:__rest$2,__spread:__spread$2,__spreadArrays:__spreadArrays$2,__values:__values$2},Symbol.toStringTag,{value:"Module"})),require$$0$2=getAugmentedNamespace(tslib_es6$2);var jsSha256={},constants={},hasRequiredConstants;function requireConstants(){return hasRequiredConstants||(hasRequiredConstants=1,Object.defineProperty(constants,"__esModule",{value:!0}),constants.MAX_HASHABLE_LENGTH=constants.INIT=constants.KEY=constants.DIGEST_LENGTH=constants.BLOCK_SIZE=void 0,constants.BLOCK_SIZE=64,constants.DIGEST_LENGTH=32,constants.KEY=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),constants.INIT=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],constants.MAX_HASHABLE_LENGTH=Math.pow(2,53)-1),constants}var RawSha256={},hasRequiredRawSha256;function requireRawSha256(){if(hasRequiredRawSha256)return RawSha256;hasRequiredRawSha256=1,Object.defineProperty(RawSha256,"__esModule",{value:!0}),RawSha256.RawSha256=void 0;var E=requireConstants(),A=function(){function R(){this.state=Int32Array.from(E.INIT),this.temp=new Int32Array(64),this.buffer=new Uint8Array(64),this.bufferLength=0,this.bytesHashed=0,this.finished=!1}return R.prototype.update=function(F){if(this.finished)throw new Error("Attempted to update an already finished hash.");var G=0,H=F.byteLength;if(this.bytesHashed+=H,this.bytesHashed*8>E.MAX_HASHABLE_LENGTH)throw new Error("Cannot hash more than 2^53 - 1 bits");for(;H>0;)this.buffer[this.bufferLength++]=F[G++],H--,this.bufferLength===E.BLOCK_SIZE&&(this.hashBuffer(),this.bufferLength=0)},R.prototype.digest=function(){if(!this.finished){var F=this.bytesHashed*8,G=new DataView(this.buffer.buffer,this.buffer.byteOffset,this.buffer.byteLength),H=this.bufferLength;if(G.setUint8(this.bufferLength++,128),H%E.BLOCK_SIZE>=E.BLOCK_SIZE-8){for(var $=this.bufferLength;$<E.BLOCK_SIZE;$++)G.setUint8($,0);this.hashBuffer(),this.bufferLength=0}for(var $=this.bufferLength;$<E.BLOCK_SIZE-8;$++)G.setUint8($,0);G.setUint32(E.BLOCK_SIZE-8,Math.floor(F/4294967296),!0),G.setUint32(E.BLOCK_SIZE-4,F),this.hashBuffer(),this.finished=!0}for(var M=new Uint8Array(E.DIGEST_LENGTH),$=0;$<8;$++)M[$*4]=this.state[$]>>>24&255,M[$*4+1]=this.state[$]>>>16&255,M[$*4+2]=this.state[$]>>>8&255,M[$*4+3]=this.state[$]>>>0&255;return M},R.prototype.hashBuffer=function(){for(var F=this,G=F.buffer,H=F.state,$=H[0],M=H[1],ye=H[2],oe=H[3],Ee=H[4],we=H[5],ce=H[6],$e=H[7],Ge=0;Ge<E.BLOCK_SIZE;Ge++){if(Ge<16)this.temp[Ge]=(G[Ge*4]&255)<<24|(G[Ge*4+1]&255)<<16|(G[Ge*4+2]&255)<<8|G[Ge*4+3]&255;else{var Xe=this.temp[Ge-2],ht=(Xe>>>17|Xe<<15)^(Xe>>>19|Xe<<13)^Xe>>>10;Xe=this.temp[Ge-15];var yt=(Xe>>>7|Xe<<25)^(Xe>>>18|Xe<<14)^Xe>>>3;this.temp[Ge]=(ht+this.temp[Ge-7]|0)+(yt+this.temp[Ge-16]|0)}var $t=(((Ee>>>6|Ee<<26)^(Ee>>>11|Ee<<21)^(Ee>>>25|Ee<<7))+(Ee&we^~Ee&ce)|0)+($e+(E.KEY[Ge]+this.temp[Ge]|0)|0)|0,Ft=(($>>>2|$<<30)^($>>>13|$<<19)^($>>>22|$<<10))+($&M^$&ye^M&ye)|0;$e=ce,ce=we,we=Ee,Ee=oe+$t|0,oe=ye,ye=M,M=$,$=$t+Ft|0}H[0]+=$,H[1]+=M,H[2]+=ye,H[3]+=oe,H[4]+=Ee,H[5]+=we,H[6]+=ce,H[7]+=$e},R}();return RawSha256.RawSha256=A,RawSha256}var hasRequiredJsSha256;function requireJsSha256(){if(hasRequiredJsSha256)return jsSha256;hasRequiredJsSha256=1,Object.defineProperty(jsSha256,"__esModule",{value:!0}),jsSha256.Sha256=void 0;var E=require$$0$2,A=requireConstants(),R=requireRawSha256(),F=requireBuild$4(),G=function(){function $(M){this.secret=M,this.hash=new R.RawSha256,this.reset()}return $.prototype.update=function(M){if(!((0,F.isEmptyData)(M)||this.error))try{this.hash.update((0,F.convertToBuffer)(M))}catch(ye){this.error=ye}},$.prototype.digestSync=function(){if(this.error)throw this.error;return this.outer?(this.outer.finished||this.outer.update(this.hash.digest()),this.outer.digest()):this.hash.digest()},$.prototype.digest=function(){return E.__awaiter(this,void 0,void 0,function(){return E.__generator(this,function(M){return[2,this.digestSync()]})})},$.prototype.reset=function(){if(this.hash=new R.RawSha256,this.secret){this.outer=new R.RawSha256;var M=H(this.secret),ye=new Uint8Array(A.BLOCK_SIZE);ye.set(M);for(var oe=0;oe<A.BLOCK_SIZE;oe++)M[oe]^=54,ye[oe]^=92;this.hash.update(M),this.outer.update(ye);for(var oe=0;oe<M.byteLength;oe++)M[oe]=0}},$}();jsSha256.Sha256=G;function H($){var M=(0,F.convertToBuffer)($);if(M.byteLength>A.BLOCK_SIZE){var ye=new R.RawSha256;ye.update(M),M=ye.digest()}var oe=new Uint8Array(A.BLOCK_SIZE);return oe.set(M),oe}return jsSha256}var hasRequiredBuild$2;function requireBuild$2(){return hasRequiredBuild$2||(hasRequiredBuild$2=1,function(E){Object.defineProperty(E,"__esModule",{value:!0});var A=require$$0$2;A.__exportStar(requireJsSha256(),E)}(build$2)),build$2}var build$1={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var extendStatics$1=function(E,A){return extendStatics$1=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,F){R.__proto__=F}||function(R,F){for(var G in F)F.hasOwnProperty(G)&&(R[G]=F[G])},extendStatics$1(E,A)};function __extends$1(E,A){extendStatics$1(E,A);function R(){this.constructor=E}E.prototype=A===null?Object.create(A):(R.prototype=A.prototype,new R)}var __assign$1=function(){return __assign$1=Object.assign||function(A){for(var R,F=1,G=arguments.length;F<G;F++){R=arguments[F];for(var H in R)Object.prototype.hasOwnProperty.call(R,H)&&(A[H]=R[H])}return A},__assign$1.apply(this,arguments)};function __rest$1(E,A){var R={};for(var F in E)Object.prototype.hasOwnProperty.call(E,F)&&A.indexOf(F)<0&&(R[F]=E[F]);if(E!=null&&typeof Object.getOwnPropertySymbols=="function")for(var G=0,F=Object.getOwnPropertySymbols(E);G<F.length;G++)A.indexOf(F[G])<0&&Object.prototype.propertyIsEnumerable.call(E,F[G])&&(R[F[G]]=E[F[G]]);return R}function __decorate$1(E,A,R,F){var G=arguments.length,H=G<3?A:F===null?F=Object.getOwnPropertyDescriptor(A,R):F,$;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")H=Reflect.decorate(E,A,R,F);else for(var M=E.length-1;M>=0;M--)($=E[M])&&(H=(G<3?$(H):G>3?$(A,R,H):$(A,R))||H);return G>3&&H&&Object.defineProperty(A,R,H),H}function __param$1(E,A){return function(R,F){A(R,F,E)}}function __metadata$1(E,A){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(E,A)}function __awaiter$1(E,A,R,F){function G(H){return H instanceof R?H:new R(function($){$(H)})}return new(R||(R=Promise))(function(H,$){function M(Ee){try{oe(F.next(Ee))}catch(we){$(we)}}function ye(Ee){try{oe(F.throw(Ee))}catch(we){$(we)}}function oe(Ee){Ee.done?H(Ee.value):G(Ee.value).then(M,ye)}oe((F=F.apply(E,A||[])).next())})}function __generator$1(E,A){var R={label:0,sent:function(){if(H[0]&1)throw H[1];return H[1]},trys:[],ops:[]},F,G,H,$;return $={next:M(0),throw:M(1),return:M(2)},typeof Symbol=="function"&&($[Symbol.iterator]=function(){return this}),$;function M(oe){return function(Ee){return ye([oe,Ee])}}function ye(oe){if(F)throw new TypeError("Generator is already executing.");for(;R;)try{if(F=1,G&&(H=oe[0]&2?G.return:oe[0]?G.throw||((H=G.return)&&H.call(G),0):G.next)&&!(H=H.call(G,oe[1])).done)return H;switch(G=0,H&&(oe=[oe[0]&2,H.value]),oe[0]){case 0:case 1:H=oe;break;case 4:return R.label++,{value:oe[1],done:!1};case 5:R.label++,G=oe[1],oe=[0];continue;case 7:oe=R.ops.pop(),R.trys.pop();continue;default:if(H=R.trys,!(H=H.length>0&&H[H.length-1])&&(oe[0]===6||oe[0]===2)){R=0;continue}if(oe[0]===3&&(!H||oe[1]>H[0]&&oe[1]<H[3])){R.label=oe[1];break}if(oe[0]===6&&R.label<H[1]){R.label=H[1],H=oe;break}if(H&&R.label<H[2]){R.label=H[2],R.ops.push(oe);break}H[2]&&R.ops.pop(),R.trys.pop();continue}oe=A.call(E,R)}catch(Ee){oe=[6,Ee],G=0}finally{F=H=0}if(oe[0]&5)throw oe[1];return{value:oe[0]?oe[1]:void 0,done:!0}}}function __createBinding$1(E,A,R,F){F===void 0&&(F=R),E[F]=A[R]}function __exportStar$1(E,A){for(var R in E)R!=="default"&&!A.hasOwnProperty(R)&&(A[R]=E[R])}function __values$1(E){var A=typeof Symbol=="function"&&Symbol.iterator,R=A&&E[A],F=0;if(R)return R.call(E);if(E&&typeof E.length=="number")return{next:function(){return E&&F>=E.length&&(E=void 0),{value:E&&E[F++],done:!E}}};throw new TypeError(A?"Object is not iterable.":"Symbol.iterator is not defined.")}function __read$1(E,A){var R=typeof Symbol=="function"&&E[Symbol.iterator];if(!R)return E;var F=R.call(E),G,H=[],$;try{for(;(A===void 0||A-- >0)&&!(G=F.next()).done;)H.push(G.value)}catch(M){$={error:M}}finally{try{G&&!G.done&&(R=F.return)&&R.call(F)}finally{if($)throw $.error}}return H}function __spread$1(){for(var E=[],A=0;A<arguments.length;A++)E=E.concat(__read$1(arguments[A]));return E}function __spreadArrays$1(){for(var E=0,A=0,R=arguments.length;A<R;A++)E+=arguments[A].length;for(var F=Array(E),G=0,A=0;A<R;A++)for(var H=arguments[A],$=0,M=H.length;$<M;$++,G++)F[G]=H[$];return F}function __await$1(E){return this instanceof __await$1?(this.v=E,this):new __await$1(E)}function __asyncGenerator$1(E,A,R){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var F=R.apply(E,A||[]),G,H=[];return G={},$("next"),$("throw"),$("return"),G[Symbol.asyncIterator]=function(){return this},G;function $(ce){F[ce]&&(G[ce]=function($e){return new Promise(function(Ge,Xe){H.push([ce,$e,Ge,Xe])>1||M(ce,$e)})})}function M(ce,$e){try{ye(F[ce]($e))}catch(Ge){we(H[0][3],Ge)}}function ye(ce){ce.value instanceof __await$1?Promise.resolve(ce.value.v).then(oe,Ee):we(H[0][2],ce)}function oe(ce){M("next",ce)}function Ee(ce){M("throw",ce)}function we(ce,$e){ce($e),H.shift(),H.length&&M(H[0][0],H[0][1])}}function __asyncDelegator$1(E){var A,R;return A={},F("next"),F("throw",function(G){throw G}),F("return"),A[Symbol.iterator]=function(){return this},A;function F(G,H){A[G]=E[G]?function($){return(R=!R)?{value:__await$1(E[G]($)),done:G==="return"}:H?H($):$}:H}}function __asyncValues$1(E){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var A=E[Symbol.asyncIterator],R;return A?A.call(E):(E=typeof __values$1=="function"?__values$1(E):E[Symbol.iterator](),R={},F("next"),F("throw"),F("return"),R[Symbol.asyncIterator]=function(){return this},R);function F(H){R[H]=E[H]&&function($){return new Promise(function(M,ye){$=E[H]($),G(M,ye,$.done,$.value)})}}function G(H,$,M,ye){Promise.resolve(ye).then(function(oe){H({value:oe,done:M})},$)}}function __makeTemplateObject$1(E,A){return Object.defineProperty?Object.defineProperty(E,"raw",{value:A}):E.raw=A,E}function __importStar$1(E){if(E&&E.__esModule)return E;var A={};if(E!=null)for(var R in E)Object.hasOwnProperty.call(E,R)&&(A[R]=E[R]);return A.default=E,A}function __importDefault$1(E){return E&&E.__esModule?E:{default:E}}function __classPrivateFieldGet$1(E,A){if(!A.has(E))throw new TypeError("attempted to get private field on non-instance");return A.get(E)}function __classPrivateFieldSet$1(E,A,R){if(!A.has(E))throw new TypeError("attempted to set private field on non-instance");return A.set(E,R),R}const tslib_es6$1=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return __assign$1},__asyncDelegator:__asyncDelegator$1,__asyncGenerator:__asyncGenerator$1,__asyncValues:__asyncValues$1,__await:__await$1,__awaiter:__awaiter$1,__classPrivateFieldGet:__classPrivateFieldGet$1,__classPrivateFieldSet:__classPrivateFieldSet$1,__createBinding:__createBinding$1,__decorate:__decorate$1,__exportStar:__exportStar$1,__extends:__extends$1,__generator:__generator$1,__importDefault:__importDefault$1,__importStar:__importStar$1,__makeTemplateObject:__makeTemplateObject$1,__metadata:__metadata$1,__param:__param$1,__read:__read$1,__rest:__rest$1,__spread:__spread$1,__spreadArrays:__spreadArrays$1,__values:__values$1},Symbol.toStringTag,{value:"Module"})),require$$0$1=getAugmentedNamespace(tslib_es6$1);var supportsWebCrypto={},hasRequiredSupportsWebCrypto;function requireSupportsWebCrypto(){if(hasRequiredSupportsWebCrypto)return supportsWebCrypto;hasRequiredSupportsWebCrypto=1,Object.defineProperty(supportsWebCrypto,"__esModule",{value:!0}),supportsWebCrypto.supportsZeroByteGCM=supportsWebCrypto.supportsSubtleCrypto=supportsWebCrypto.supportsSecureRandom=supportsWebCrypto.supportsWebCrypto=void 0;var E=require$$0$1,A=["decrypt","digest","encrypt","exportKey","generateKey","importKey","sign","verify"];function R($){if(F($)&&typeof $.crypto.subtle=="object"){var M=$.crypto.subtle;return G(M)}return!1}supportsWebCrypto.supportsWebCrypto=R;function F($){if(typeof $=="object"&&typeof $.crypto=="object"){var M=$.crypto.getRandomValues;return typeof M=="function"}return!1}supportsWebCrypto.supportsSecureRandom=F;function G($){return $&&A.every(function(M){return typeof $[M]=="function"})}supportsWebCrypto.supportsSubtleCrypto=G;function H($){return E.__awaiter(this,void 0,void 0,function(){var M,ye;return E.__generator(this,function(oe){switch(oe.label){case 0:if(!G($))return[2,!1];oe.label=1;case 1:return oe.trys.push([1,4,,5]),[4,$.generateKey({name:"AES-GCM",length:128},!1,["encrypt"])];case 2:return M=oe.sent(),[4,$.encrypt({name:"AES-GCM",iv:new Uint8Array(Array(12)),additionalData:new Uint8Array(Array(16)),tagLength:128},M,new Uint8Array(0))];case 3:return ye=oe.sent(),[2,ye.byteLength===16];case 4:return oe.sent(),[2,!1];case 5:return[2]}})})}return supportsWebCrypto.supportsZeroByteGCM=H,supportsWebCrypto}var hasRequiredBuild$1;function requireBuild$1(){return hasRequiredBuild$1||(hasRequiredBuild$1=1,function(E){Object.defineProperty(E,"__esModule",{value:!0});var A=require$$0$1;A.__exportStar(requireSupportsWebCrypto(),E)}(build$1)),build$1}var build={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var extendStatics=function(E,A){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,F){R.__proto__=F}||function(R,F){for(var G in F)F.hasOwnProperty(G)&&(R[G]=F[G])},extendStatics(E,A)};function __extends(E,A){extendStatics(E,A);function R(){this.constructor=E}E.prototype=A===null?Object.create(A):(R.prototype=A.prototype,new R)}var __assign=function(){return __assign=Object.assign||function(A){for(var R,F=1,G=arguments.length;F<G;F++){R=arguments[F];for(var H in R)Object.prototype.hasOwnProperty.call(R,H)&&(A[H]=R[H])}return A},__assign.apply(this,arguments)};function __rest(E,A){var R={};for(var F in E)Object.prototype.hasOwnProperty.call(E,F)&&A.indexOf(F)<0&&(R[F]=E[F]);if(E!=null&&typeof Object.getOwnPropertySymbols=="function")for(var G=0,F=Object.getOwnPropertySymbols(E);G<F.length;G++)A.indexOf(F[G])<0&&Object.prototype.propertyIsEnumerable.call(E,F[G])&&(R[F[G]]=E[F[G]]);return R}function __decorate(E,A,R,F){var G=arguments.length,H=G<3?A:F===null?F=Object.getOwnPropertyDescriptor(A,R):F,$;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")H=Reflect.decorate(E,A,R,F);else for(var M=E.length-1;M>=0;M--)($=E[M])&&(H=(G<3?$(H):G>3?$(A,R,H):$(A,R))||H);return G>3&&H&&Object.defineProperty(A,R,H),H}function __param(E,A){return function(R,F){A(R,F,E)}}function __metadata(E,A){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(E,A)}function __awaiter(E,A,R,F){function G(H){return H instanceof R?H:new R(function($){$(H)})}return new(R||(R=Promise))(function(H,$){function M(Ee){try{oe(F.next(Ee))}catch(we){$(we)}}function ye(Ee){try{oe(F.throw(Ee))}catch(we){$(we)}}function oe(Ee){Ee.done?H(Ee.value):G(Ee.value).then(M,ye)}oe((F=F.apply(E,A||[])).next())})}function __generator(E,A){var R={label:0,sent:function(){if(H[0]&1)throw H[1];return H[1]},trys:[],ops:[]},F,G,H,$;return $={next:M(0),throw:M(1),return:M(2)},typeof Symbol=="function"&&($[Symbol.iterator]=function(){return this}),$;function M(oe){return function(Ee){return ye([oe,Ee])}}function ye(oe){if(F)throw new TypeError("Generator is already executing.");for(;R;)try{if(F=1,G&&(H=oe[0]&2?G.return:oe[0]?G.throw||((H=G.return)&&H.call(G),0):G.next)&&!(H=H.call(G,oe[1])).done)return H;switch(G=0,H&&(oe=[oe[0]&2,H.value]),oe[0]){case 0:case 1:H=oe;break;case 4:return R.label++,{value:oe[1],done:!1};case 5:R.label++,G=oe[1],oe=[0];continue;case 7:oe=R.ops.pop(),R.trys.pop();continue;default:if(H=R.trys,!(H=H.length>0&&H[H.length-1])&&(oe[0]===6||oe[0]===2)){R=0;continue}if(oe[0]===3&&(!H||oe[1]>H[0]&&oe[1]<H[3])){R.label=oe[1];break}if(oe[0]===6&&R.label<H[1]){R.label=H[1],H=oe;break}if(H&&R.label<H[2]){R.label=H[2],R.ops.push(oe);break}H[2]&&R.ops.pop(),R.trys.pop();continue}oe=A.call(E,R)}catch(Ee){oe=[6,Ee],G=0}finally{F=H=0}if(oe[0]&5)throw oe[1];return{value:oe[0]?oe[1]:void 0,done:!0}}}function __createBinding(E,A,R,F){F===void 0&&(F=R),E[F]=A[R]}function __exportStar(E,A){for(var R in E)R!=="default"&&!A.hasOwnProperty(R)&&(A[R]=E[R])}function __values(E){var A=typeof Symbol=="function"&&Symbol.iterator,R=A&&E[A],F=0;if(R)return R.call(E);if(E&&typeof E.length=="number")return{next:function(){return E&&F>=E.length&&(E=void 0),{value:E&&E[F++],done:!E}}};throw new TypeError(A?"Object is not iterable.":"Symbol.iterator is not defined.")}function __read(E,A){var R=typeof Symbol=="function"&&E[Symbol.iterator];if(!R)return E;var F=R.call(E),G,H=[],$;try{for(;(A===void 0||A-- >0)&&!(G=F.next()).done;)H.push(G.value)}catch(M){$={error:M}}finally{try{G&&!G.done&&(R=F.return)&&R.call(F)}finally{if($)throw $.error}}return H}function __spread(){for(var E=[],A=0;A<arguments.length;A++)E=E.concat(__read(arguments[A]));return E}function __spreadArrays(){for(var E=0,A=0,R=arguments.length;A<R;A++)E+=arguments[A].length;for(var F=Array(E),G=0,A=0;A<R;A++)for(var H=arguments[A],$=0,M=H.length;$<M;$++,G++)F[G]=H[$];return F}function __await(E){return this instanceof __await?(this.v=E,this):new __await(E)}function __asyncGenerator(E,A,R){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var F=R.apply(E,A||[]),G,H=[];return G={},$("next"),$("throw"),$("return"),G[Symbol.asyncIterator]=function(){return this},G;function $(ce){F[ce]&&(G[ce]=function($e){return new Promise(function(Ge,Xe){H.push([ce,$e,Ge,Xe])>1||M(ce,$e)})})}function M(ce,$e){try{ye(F[ce]($e))}catch(Ge){we(H[0][3],Ge)}}function ye(ce){ce.value instanceof __await?Promise.resolve(ce.value.v).then(oe,Ee):we(H[0][2],ce)}function oe(ce){M("next",ce)}function Ee(ce){M("throw",ce)}function we(ce,$e){ce($e),H.shift(),H.length&&M(H[0][0],H[0][1])}}function __asyncDelegator(E){var A,R;return A={},F("next"),F("throw",function(G){throw G}),F("return"),A[Symbol.iterator]=function(){return this},A;function F(G,H){A[G]=E[G]?function($){return(R=!R)?{value:__await(E[G]($)),done:G==="return"}:H?H($):$}:H}}function __asyncValues(E){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var A=E[Symbol.asyncIterator],R;return A?A.call(E):(E=typeof __values=="function"?__values(E):E[Symbol.iterator](),R={},F("next"),F("throw"),F("return"),R[Symbol.asyncIterator]=function(){return this},R);function F(H){R[H]=E[H]&&function($){return new Promise(function(M,ye){$=E[H]($),G(M,ye,$.done,$.value)})}}function G(H,$,M,ye){Promise.resolve(ye).then(function(oe){H({value:oe,done:M})},$)}}function __makeTemplateObject(E,A){return Object.defineProperty?Object.defineProperty(E,"raw",{value:A}):E.raw=A,E}function __importStar(E){if(E&&E.__esModule)return E;var A={};if(E!=null)for(var R in E)Object.hasOwnProperty.call(E,R)&&(A[R]=E[R]);return A.default=E,A}function __importDefault(E){return E&&E.__esModule?E:{default:E}}function __classPrivateFieldGet(E,A){if(!A.has(E))throw new TypeError("attempted to get private field on non-instance");return A.get(E)}function __classPrivateFieldSet(E,A,R){if(!A.has(E))throw new TypeError("attempted to set private field on non-instance");return A.set(E,R),R}const tslib_es6=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return __assign},__asyncDelegator,__asyncGenerator,__asyncValues,__await,__awaiter,__classPrivateFieldGet,__classPrivateFieldSet,__createBinding,__decorate,__exportStar,__extends,__generator,__importDefault,__importStar,__makeTemplateObject,__metadata,__param,__read,__rest,__spread,__spreadArrays,__values},Symbol.toStringTag,{value:"Module"})),require$$0=getAugmentedNamespace(tslib_es6);var CryptoOperation={},hasRequiredCryptoOperation;function requireCryptoOperation(){return hasRequiredCryptoOperation||(hasRequiredCryptoOperation=1,Object.defineProperty(CryptoOperation,"__esModule",{value:!0})),CryptoOperation}var Key={},hasRequiredKey;function requireKey(){return hasRequiredKey||(hasRequiredKey=1,Object.defineProperty(Key,"__esModule",{value:!0})),Key}var KeyOperation={},hasRequiredKeyOperation;function requireKeyOperation(){return hasRequiredKeyOperation||(hasRequiredKeyOperation=1,Object.defineProperty(KeyOperation,"__esModule",{value:!0})),KeyOperation}var MsSubtleCrypto={},hasRequiredMsSubtleCrypto;function requireMsSubtleCrypto(){return hasRequiredMsSubtleCrypto||(hasRequiredMsSubtleCrypto=1,Object.defineProperty(MsSubtleCrypto,"__esModule",{value:!0})),MsSubtleCrypto}var MsWindow={},hasRequiredMsWindow;function requireMsWindow(){if(hasRequiredMsWindow)return MsWindow;hasRequiredMsWindow=1,Object.defineProperty(MsWindow,"__esModule",{value:!0}),MsWindow.isMsWindow=void 0;var E=["decrypt","digest","encrypt","exportKey","generateKey","importKey","sign","verify"];function A(F){return"MSInputMethodContext"in F&&"msCrypto"in F}function R(F){if(A(F)&&F.msCrypto.subtle!==void 0){var G=F.msCrypto,H=G.getRandomValues,$=G.subtle;return E.map(function(M){return $[M]}).concat(H).every(function(M){return typeof M=="function"})}return!1}return MsWindow.isMsWindow=R,MsWindow}var hasRequiredBuild;function requireBuild(){return hasRequiredBuild||(hasRequiredBuild=1,function(E){Object.defineProperty(E,"__esModule",{value:!0});var A=require$$0;A.__exportStar(requireCryptoOperation(),E),A.__exportStar(requireKey(),E),A.__exportStar(requireKeyOperation(),E),A.__exportStar(requireMsSubtleCrypto(),E),A.__exportStar(requireMsWindow(),E)}(build)),build}var hasRequiredCrossPlatformSha256;function requireCrossPlatformSha256(){if(hasRequiredCrossPlatformSha256)return crossPlatformSha256;hasRequiredCrossPlatformSha256=1,Object.defineProperty(crossPlatformSha256,"__esModule",{value:!0}),crossPlatformSha256.Sha256=void 0;var E=requireIe11Sha256(),A=requireWebCryptoSha256(),R=requireBuild$2(),F=requireBuild$1(),G=requireBuild(),H=require$$5,$=requireBuild$4(),M=function(){function ye(oe){(0,F.supportsWebCrypto)((0,H.locateWindow)())?this.hash=new A.Sha256(oe):(0,G.isMsWindow)((0,H.locateWindow)())?this.hash=new E.Sha256(oe):this.hash=new R.Sha256(oe)}return ye.prototype.update=function(oe,Ee){this.hash.update((0,$.convertToBuffer)(oe))},ye.prototype.digest=function(){return this.hash.digest()},ye.prototype.reset=function(){this.hash.reset()},ye}();return crossPlatformSha256.Sha256=M,crossPlatformSha256}(function(E){Object.defineProperty(E,"__esModule",{value:!0}),E.WebCryptoSha256=E.Ie11Sha256=void 0;var A=require$$0$3;A.__exportStar(requireCrossPlatformSha256(),E);var R=requireIe11Sha256();Object.defineProperty(E,"Ie11Sha256",{enumerable:!0,get:function(){return R.Sha256}});var F=requireWebCryptoSha256();Object.defineProperty(E,"WebCryptoSha256",{enumerable:!0,get:function(){return F.Sha256}})})(build$3);const defaultUserAgent=({serviceId:E,clientVersion:A})=>async()=>{var G,H,$,M,ye;const R=typeof window<"u"&&((G=window==null?void 0:window.navigator)!=null&&G.userAgent)?Bowser.parse(window.navigator.userAgent):void 0,F=[["aws-sdk-js",A],["ua","2.0"],[`os/${((H=R==null?void 0:R.os)==null?void 0:H.name)||"other"}`,($=R==null?void 0:R.os)==null?void 0:$.version],["lang/js"],["md/browser",`${((M=R==null?void 0:R.browser)==null?void 0:M.name)??"unknown"}_${((ye=R==null?void 0:R.browser)==null?void 0:ye.version)??"unknown"}`]];return E&&F.push([`api/${E}`,A]),F},invalidProvider=E=>()=>Promise.reject(E),TEXT_ENCODER=typeof TextEncoder=="function"?new TextEncoder:null,calculateBodyLength=E=>{if(typeof E=="string"){if(TEXT_ENCODER)return TEXT_ENCODER.encode(E).byteLength;let A=E.length;for(let R=A-1;R>=0;R--){const F=E.charCodeAt(R);F>127&&F<=2047?A++:F>2047&&F<=65535&&(A+=2),F>=56320&&F<=57343&&R--}return A}else{if(typeof E.byteLength=="number")return E.byteLength;if(typeof E.size=="number")return E.size}throw new Error(`Body Length computation failed for ${E}`)},s="required",t="fn",u="argv",v="ref",a=!0,b="isSet",c="booleanEquals",d="error",e="endpoint",f="tree",g="PartitionResult",h={[s]:!1,type:"String"},i={[s]:!0,default:!1,type:"Boolean"},j={[v]:"Endpoint"},k={[t]:c,[u]:[{[v]:"UseFIPS"},!0]},l={[t]:c,[u]:[{[v]:"UseDualStack"},!0]},m={},n={[t]:"getAttr",[u]:[{[v]:g},"supportsFIPS"]},o={[t]:c,[u]:[!0,{[t]:"getAttr",[u]:[{[v]:g},"supportsDualStack"]}]},p=[k],q=[l],r=[{[v]:"Region"}],_data={version:"1.0",parameters:{Region:h,UseDualStack:i,UseFIPS:i,Endpoint:h},rules:[{conditions:[{[t]:b,[u]:[j]}],rules:[{conditions:p,error:"Invalid Configuration: FIPS and custom endpoint are not supported",type:d},{conditions:q,error:"Invalid Configuration: Dualstack and custom endpoint are not supported",type:d},{endpoint:{url:j,properties:m,headers:m},type:e}],type:f},{conditions:[{[t]:b,[u]:r}],rules:[{conditions:[{[t]:"aws.partition",[u]:r,assign:g}],rules:[{conditions:[k,l],rules:[{conditions:[{[t]:c,[u]:[a,n]},o],rules:[{endpoint:{url:"https://geo-fips.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:m,headers:m},type:e}],type:f},{error:"FIPS and DualStack are enabled, but this partition does not support one or both",type:d}],type:f},{conditions:p,rules:[{conditions:[{[t]:c,[u]:[n,a]}],rules:[{endpoint:{url:"https://geo-fips.{Region}.{PartitionResult#dnsSuffix}",properties:m,headers:m},type:e}],type:f},{error:"FIPS is enabled but this partition does not support FIPS",type:d}],type:f},{conditions:q,rules:[{conditions:[o],rules:[{endpoint:{url:"https://geo.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:m,headers:m},type:e}],type:f},{error:"DualStack is enabled but this partition does not support DualStack",type:d}],type:f},{endpoint:{url:"https://geo.{Region}.{PartitionResult#dnsSuffix}",properties:m,headers:m},type:e}],type:f}],type:f},{error:"Invalid Configuration: Missing Region",type:d}]},ruleSet=_data,defaultEndpointResolver=(E,A={})=>resolveEndpoint(ruleSet,{endpointParams:E,logger:A.logger});customEndpointFunctions.aws=awsEndpointFunctions;const getRuntimeConfig$1=E=>({apiVersion:"2020-11-19",base64Decoder:(E==null?void 0:E.base64Decoder)??fromBase64,base64Encoder:(E==null?void 0:E.base64Encoder)??toBase64,disableHostPrefix:(E==null?void 0:E.disableHostPrefix)??!1,endpointProvider:(E==null?void 0:E.endpointProvider)??defaultEndpointResolver,extensions:(E==null?void 0:E.extensions)??[],httpAuthSchemeProvider:(E==null?void 0:E.httpAuthSchemeProvider)??defaultLocationHttpAuthSchemeProvider,httpAuthSchemes:(E==null?void 0:E.httpAuthSchemes)??[{schemeId:"aws.auth#sigv4",identityProvider:A=>A.getIdentityProvider("aws.auth#sigv4"),signer:new AwsSdkSigV4Signer}],logger:(E==null?void 0:E.logger)??new NoOpLogger,serviceId:(E==null?void 0:E.serviceId)??"Location",urlParser:(E==null?void 0:E.urlParser)??parseUrl,utf8Decoder:(E==null?void 0:E.utf8Decoder)??fromUtf8$3,utf8Encoder:(E==null?void 0:E.utf8Encoder)??toUtf8$3}),DEFAULTS_MODE_OPTIONS=["in-region","cross-region","mobile","standard","legacy"],resolveDefaultsModeConfig=({defaultsMode:E}={})=>memoize(async()=>{const A=typeof E=="function"?await E():E;switch(A==null?void 0:A.toLowerCase()){case"auto":return Promise.resolve(isMobileBrowser()?"mobile":"standard");case"mobile":case"in-region":case"cross-region":case"standard":case"legacy":return Promise.resolve(A==null?void 0:A.toLocaleLowerCase());case void 0:return Promise.resolve("legacy");default:throw new Error(`Invalid parameter for "defaultsMode", expect ${DEFAULTS_MODE_OPTIONS.join(", ")}, got ${A}`)}}),isMobileBrowser=()=>{var R,F;const E=typeof window<"u"&&((R=window==null?void 0:window.navigator)!=null&&R.userAgent)?Bowser.parse(window.navigator.userAgent):void 0,A=(F=E==null?void 0:E.platform)==null?void 0:F.type;return A==="tablet"||A==="mobile"},getRuntimeConfig=E=>{const A=resolveDefaultsModeConfig(E),R=()=>A().then(loadConfigsForDefaultMode),F=getRuntimeConfig$1(E);return{...F,...E,runtime:"browser",defaultsMode:A,bodyLengthChecker:(E==null?void 0:E.bodyLengthChecker)??calculateBodyLength,credentialDefaultProvider:(E==null?void 0:E.credentialDefaultProvider)??(G=>()=>Promise.reject(new Error("Credential is missing"))),defaultUserAgentProvider:(E==null?void 0:E.defaultUserAgentProvider)??defaultUserAgent({serviceId:F.serviceId,clientVersion:packageInfo.version}),maxAttempts:(E==null?void 0:E.maxAttempts)??DEFAULT_MAX_ATTEMPTS,region:(E==null?void 0:E.region)??invalidProvider("Region is missing"),requestHandler:FetchHttpHandler.create((E==null?void 0:E.requestHandler)??R),retryMode:(E==null?void 0:E.retryMode)??(async()=>(await R()).retryMode||DEFAULT_RETRY_MODE),sha256:(E==null?void 0:E.sha256)??build$3.Sha256,streamCollector:(E==null?void 0:E.streamCollector)??streamCollector,useDualstackEndpoint:(E==null?void 0:E.useDualstackEndpoint)??(()=>Promise.resolve(DEFAULT_USE_DUALSTACK_ENDPOINT)),useFipsEndpoint:(E==null?void 0:E.useFipsEndpoint)??(()=>Promise.resolve(DEFAULT_USE_FIPS_ENDPOINT))}},getAwsRegionExtensionConfiguration=E=>{let A=async()=>{if(E.region===void 0)throw new Error("Region is missing from runtimeConfig");const R=E.region;return typeof R=="string"?R:R()};return{setRegion(R){A=R},region(){return A}}},resolveAwsRegionExtensionConfiguration=E=>({region:E.region()}),getHttpAuthExtensionConfiguration=E=>{const A=E.httpAuthSchemes;let R=E.httpAuthSchemeProvider,F=E.credentials;return{setHttpAuthScheme(G){const H=A.findIndex($=>$.schemeId===G.schemeId);H===-1?A.push(G):A.splice(H,1,G)},httpAuthSchemes(){return A},setHttpAuthSchemeProvider(G){R=G},httpAuthSchemeProvider(){return R},setCredentials(G){F=G},credentials(){return F}}},resolveHttpAuthRuntimeConfig=E=>({httpAuthSchemes:E.httpAuthSchemes(),httpAuthSchemeProvider:E.httpAuthSchemeProvider(),credentials:E.credentials()}),asPartial=E=>E,resolveRuntimeExtensions=(E,A)=>{const R={...asPartial(getAwsRegionExtensionConfiguration(E)),...asPartial(getDefaultExtensionConfiguration(E)),...asPartial(getHttpHandlerExtensionConfiguration(E)),...asPartial(getHttpAuthExtensionConfiguration(E))};return A.forEach(F=>F.configure(R)),{...E,...resolveAwsRegionExtensionConfiguration(R),...resolveDefaultRuntimeConfig(R),...resolveHttpHandlerRuntimeConfig(R),...resolveHttpAuthRuntimeConfig(R)}};class LocationClient extends Client{constructor(...[A]){const R=getRuntimeConfig(A||{}),F=resolveClientEndpointParameters(R),G=resolveRegionConfig(F),H=resolveEndpointConfig(G),$=resolveRetryConfig(H),M=$,ye=resolveUserAgentConfig(M),oe=resolveHttpAuthSchemeConfig(ye),Ee=resolveRuntimeExtensions(oe,(A==null?void 0:A.extensions)||[]);super(Ee),this.config=Ee,this.middlewareStack.use(getRetryPlugin(this.config)),this.middlewareStack.use(getContentLengthPlugin(this.config)),this.middlewareStack.use(getHostHeaderPlugin(this.config)),this.middlewareStack.use(getLoggerPlugin(this.config)),this.middlewareStack.use(getRecursionDetectionPlugin(this.config)),this.middlewareStack.use(getUserAgentPlugin(this.config)),this.middlewareStack.use(getHttpAuthSchemeEndpointRuleSetPlugin(this.config,{httpAuthSchemeParametersProvider:this.getDefaultHttpAuthSchemeParametersProvider(),identityProviderConfigProvider:this.getIdentityProviderConfigProvider()})),this.middlewareStack.use(getHttpSigningPlugin(this.config))}destroy(){super.destroy()}getDefaultHttpAuthSchemeParametersProvider(){return defaultLocationHttpAuthSchemeParametersProvider}getIdentityProviderConfigProvider(){return async A=>new DefaultIdentityProviderConfig({"aws.auth#sigv4":A.credentials})}}class LocationServiceException extends ServiceException{constructor(A){super(A),Object.setPrototypeOf(this,LocationServiceException.prototype)}}class AccessDeniedException extends LocationServiceException{constructor(A){super({name:"AccessDeniedException",$fault:"client",...A}),this.name="AccessDeniedException",this.$fault="client",Object.setPrototypeOf(this,AccessDeniedException.prototype),this.Message=A.Message}}class ConflictException extends LocationServiceException{constructor(A){super({name:"ConflictException",$fault:"client",...A}),this.name="ConflictException",this.$fault="client",Object.setPrototypeOf(this,ConflictException.prototype),this.Message=A.Message}}class InternalServerException extends LocationServiceException{constructor(A){super({name:"InternalServerException",$fault:"server",...A}),this.name="InternalServerException",this.$fault="server",this.$retryable={},Object.setPrototypeOf(this,InternalServerException.prototype),this.Message=A.Message}}class ServiceQuotaExceededException extends LocationServiceException{constructor(A){super({name:"ServiceQuotaExceededException",$fault:"client",...A}),this.name="ServiceQuotaExceededException",this.$fault="client",Object.setPrototypeOf(this,ServiceQuotaExceededException.prototype),this.Message=A.Message}}class ThrottlingException extends LocationServiceException{constructor(A){super({name:"ThrottlingException",$fault:"client",...A}),this.name="ThrottlingException",this.$fault="client",this.$retryable={},Object.setPrototypeOf(this,ThrottlingException.prototype),this.Message=A.Message}}class ValidationException extends LocationServiceException{constructor(A){super({name:"ValidationException",$fault:"client",...A}),this.name="ValidationException",this.$fault="client",Object.setPrototypeOf(this,ValidationException.prototype),this.Message=A.Message,this.Reason=A.Reason,this.FieldList=A.FieldList}}class ResourceNotFoundException extends LocationServiceException{constructor(A){super({name:"ResourceNotFoundException",$fault:"client",...A}),this.name="ResourceNotFoundException",this.$fault="client",Object.setPrototypeOf(this,ResourceNotFoundException.prototype),this.Message=A.Message}}const CalculateRouteRequestFilterSensitiveLog=E=>({...E,...E.DeparturePosition&&{DeparturePosition:SENSITIVE_STRING},...E.DestinationPosition&&{DestinationPosition:SENSITIVE_STRING},...E.WaypointPositions&&{WaypointPositions:SENSITIVE_STRING},...E.Key&&{Key:SENSITIVE_STRING}}),LegGeometryFilterSensitiveLog=E=>({...E,...E.LineString&&{LineString:SENSITIVE_STRING}}),StepFilterSensitiveLog=E=>({...E,...E.StartPosition&&{StartPosition:SENSITIVE_STRING},...E.EndPosition&&{EndPosition:SENSITIVE_STRING}}),LegFilterSensitiveLog=E=>({...E,...E.StartPosition&&{StartPosition:SENSITIVE_STRING},...E.EndPosition&&{EndPosition:SENSITIVE_STRING},...E.Geometry&&{Geometry:LegGeometryFilterSensitiveLog(E.Geometry)},...E.Steps&&{Steps:E.Steps.map(A=>StepFilterSensitiveLog(A))}}),CalculateRouteSummaryFilterSensitiveLog=E=>({...E,...E.RouteBBox&&{RouteBBox:SENSITIVE_STRING}}),CalculateRouteResponseFilterSensitiveLog=E=>({...E,...E.Legs&&{Legs:E.Legs.map(A=>LegFilterSensitiveLog(A))},...E.Summary&&{Summary:CalculateRouteSummaryFilterSensitiveLog(E.Summary)}}),GetPlaceRequestFilterSensitiveLog=E=>({...E,...E.Key&&{Key:SENSITIVE_STRING}}),PlaceGeometryFilterSensitiveLog=E=>({...E,...E.Point&&{Point:SENSITIVE_STRING}}),PlaceFilterSensitiveLog=E=>({...E,...E.Geometry&&{Geometry:PlaceGeometryFilterSensitiveLog(E.Geometry)}}),GetPlaceResponseFilterSensitiveLog=E=>({...E,...E.Place&&{Place:PlaceFilterSensitiveLog(E.Place)}}),SearchPlaceIndexForSuggestionsRequestFilterSensitiveLog=E=>({...E,...E.Text&&{Text:SENSITIVE_STRING},...E.BiasPosition&&{BiasPosition:SENSITIVE_STRING},...E.FilterBBox&&{FilterBBox:SENSITIVE_STRING},...E.Key&&{Key:SENSITIVE_STRING}}),SearchPlaceIndexForSuggestionsSummaryFilterSensitiveLog=E=>({...E,...E.Text&&{Text:SENSITIVE_STRING},...E.BiasPosition&&{BiasPosition:SENSITIVE_STRING},...E.FilterBBox&&{FilterBBox:SENSITIVE_STRING}}),SearchPlaceIndexForSuggestionsResponseFilterSensitiveLog=E=>({...E,...E.Summary&&{Summary:SearchPlaceIndexForSuggestionsSummaryFilterSensitiveLog(E.Summary)}}),SearchPlaceIndexForTextRequestFilterSensitiveLog=E=>({...E,...E.Text&&{Text:SENSITIVE_STRING},...E.BiasPosition&&{BiasPosition:SENSITIVE_STRING},...E.FilterBBox&&{FilterBBox:SENSITIVE_STRING},...E.Key&&{Key:SENSITIVE_STRING}}),SearchForTextResultFilterSensitiveLog=E=>({...E,...E.Place&&{Place:PlaceFilterSensitiveLog(E.Place)}}),SearchPlaceIndexForTextSummaryFilterSensitiveLog=E=>({...E,...E.Text&&{Text:SENSITIVE_STRING},...E.BiasPosition&&{BiasPosition:SENSITIVE_STRING},...E.FilterBBox&&{FilterBBox:SENSITIVE_STRING},...E.ResultBBox&&{ResultBBox:SENSITIVE_STRING}}),SearchPlaceIndexForTextResponseFilterSensitiveLog=E=>({...E,...E.Summary&&{Summary:SearchPlaceIndexForTextSummaryFilterSensitiveLog(E.Summary)},...E.Results&&{Results:E.Results.map(A=>SearchForTextResultFilterSensitiveLog(A))}}),se_CalculateRouteCommand=async(E,A)=>{const R=requestBuilder(E,A),F={"content-type":"application/json"};R.bp("/routes/v0/calculators/{CalculatorName}/calculate/route"),R.p("CalculatorName",()=>E.CalculatorName,"{CalculatorName}",!1);const G=map({[_k]:[,E[_K]]});let H;H=JSON.stringify(take(E,{ArrivalTime:M=>M.toISOString().split(".")[0]+"Z",CarModeOptions:M=>_json(M),DepartNow:[],DeparturePosition:M=>se_Position(M),DepartureTime:M=>M.toISOString().split(".")[0]+"Z",DestinationPosition:M=>se_Position(M),DistanceUnit:[],IncludeLegGeometry:[],OptimizeFor:[],TravelMode:[],TruckModeOptions:M=>se_CalculateRouteTruckModeOptions(M),WaypointPositions:M=>se_WaypointPositionList(M)}));let{hostname:$}=await A.endpoint();if(A.disableHostPrefix!==!0&&($="routes."+$,!isValidHostname($)))throw new Error("ValidationError: prefixed hostname must be hostname compatible.");return R.hn($),R.m("POST").h(F).q(G).b(H),R.build()},se_GetPlaceCommand=async(E,A)=>{const R=requestBuilder(E,A),F={};R.bp("/places/v0/indexes/{IndexName}/places/{PlaceId}"),R.p("IndexName",()=>E.IndexName,"{IndexName}",!1),R.p("PlaceId",()=>E.PlaceId,"{PlaceId}",!1);const G=map({[_l]:[,E[_L]],[_k]:[,E[_K]]});let H,{hostname:$}=await A.endpoint();if(A.disableHostPrefix!==!0&&($="places."+$,!isValidHostname($)))throw new Error("ValidationError: prefixed hostname must be hostname compatible.");return R.hn($),R.m("GET").h(F).q(G).b(H),R.build()},se_SearchPlaceIndexForSuggestionsCommand=async(E,A)=>{const R=requestBuilder(E,A),F={"content-type":"application/json"};R.bp("/places/v0/indexes/{IndexName}/search/suggestions"),R.p("IndexName",()=>E.IndexName,"{IndexName}",!1);const G=map({[_k]:[,E[_K]]});let H;H=JSON.stringify(take(E,{BiasPosition:M=>se_Position(M),FilterBBox:M=>se_BoundingBox(M),FilterCategories:M=>_json(M),FilterCountries:M=>_json(M),Language:[],MaxResults:[],Text:[]}));let{hostname:$}=await A.endpoint();if(A.disableHostPrefix!==!0&&($="places."+$,!isValidHostname($)))throw new Error("ValidationError: prefixed hostname must be hostname compatible.");return R.hn($),R.m("POST").h(F).q(G).b(H),R.build()},se_SearchPlaceIndexForTextCommand=async(E,A)=>{const R=requestBuilder(E,A),F={"content-type":"application/json"};R.bp("/places/v0/indexes/{IndexName}/search/text"),R.p("IndexName",()=>E.IndexName,"{IndexName}",!1);const G=map({[_k]:[,E[_K]]});let H;H=JSON.stringify(take(E,{BiasPosition:M=>se_Position(M),FilterBBox:M=>se_BoundingBox(M),FilterCategories:M=>_json(M),FilterCountries:M=>_json(M),Language:[],MaxResults:[],Text:[]}));let{hostname:$}=await A.endpoint();if(A.disableHostPrefix!==!0&&($="places."+$,!isValidHostname($)))throw new Error("ValidationError: prefixed hostname must be hostname compatible.");return R.hn($),R.m("POST").h(F).q(G).b(H),R.build()},de_CalculateRouteCommand=async(E,A)=>{if(E.statusCode!==200&&E.statusCode>=300)return de_CommandError(E,A);const R=map({$metadata:deserializeMetadata(E)}),F=expectNonNull(expectObject(await parseJsonBody(E.body,A)),"body"),G=take(F,{Legs:H=>de_LegList(H),Summary:H=>de_CalculateRouteSummary(H)});return Object.assign(R,G),R},de_GetPlaceCommand=async(E,A)=>{if(E.statusCode!==200&&E.statusCode>=300)return de_CommandError(E,A);const R=map({$metadata:deserializeMetadata(E)}),F=expectNonNull(expectObject(await parseJsonBody(E.body,A)),"body"),G=take(F,{Place:H=>de_Place(H)});return Object.assign(R,G),R},de_SearchPlaceIndexForSuggestionsCommand=async(E,A)=>{if(E.statusCode!==200&&E.statusCode>=300)return de_CommandError(E,A);const R=map({$metadata:deserializeMetadata(E)}),F=expectNonNull(expectObject(await parseJsonBody(E.body,A)),"body"),G=take(F,{Results:_json,Summary:H=>de_SearchPlaceIndexForSuggestionsSummary(H)});return Object.assign(R,G),R},de_SearchPlaceIndexForTextCommand=async(E,A)=>{if(E.statusCode!==200&&E.statusCode>=300)return de_CommandError(E,A);const R=map({$metadata:deserializeMetadata(E)}),F=expectNonNull(expectObject(await parseJsonBody(E.body,A)),"body"),G=take(F,{Results:H=>de_SearchForTextResultList(H),Summary:H=>de_SearchPlaceIndexForTextSummary(H)});return Object.assign(R,G),R},de_CommandError=async(E,A)=>{const R={...E,body:await parseJsonErrorBody(E.body,A)},F=loadRestJsonErrorCode(E,R.body);switch(F){case"AccessDeniedException":case"com.amazonaws.location#AccessDeniedException":throw await de_AccessDeniedExceptionRes(R);case"ConflictException":case"com.amazonaws.location#ConflictException":throw await de_ConflictExceptionRes(R);case"InternalServerException":case"com.amazonaws.location#InternalServerException":throw await de_InternalServerExceptionRes(R);case"ResourceNotFoundException":case"com.amazonaws.location#ResourceNotFoundException":throw await de_ResourceNotFoundExceptionRes(R);case"ServiceQuotaExceededException":case"com.amazonaws.location#ServiceQuotaExceededException":throw await de_ServiceQuotaExceededExceptionRes(R);case"ThrottlingException":case"com.amazonaws.location#ThrottlingException":throw await de_ThrottlingExceptionRes(R);case"ValidationException":case"com.amazonaws.location#ValidationException":throw await de_ValidationExceptionRes(R);default:const G=R.body;return throwDefaultError({output:E,parsedBody:G,errorCode:F})}},throwDefaultError=withBaseException(LocationServiceException),de_AccessDeniedExceptionRes=async(E,A)=>{const R=map({}),F=E.body,G=take(F,{Message:[,expectString,"message"]});Object.assign(R,G);const H=new AccessDeniedException({$metadata:deserializeMetadata(E),...R});return decorateServiceException(H,E.body)},de_ConflictExceptionRes=async(E,A)=>{const R=map({}),F=E.body,G=take(F,{Message:[,expectString,"message"]});Object.assign(R,G);const H=new ConflictException({$metadata:deserializeMetadata(E),...R});return decorateServiceException(H,E.body)},de_InternalServerExceptionRes=async(E,A)=>{const R=map({}),F=E.body,G=take(F,{Message:[,expectString,"message"]});Object.assign(R,G);const H=new InternalServerException({$metadata:deserializeMetadata(E),...R});return decorateServiceException(H,E.body)},de_ResourceNotFoundExceptionRes=async(E,A)=>{const R=map({}),F=E.body,G=take(F,{Message:[,expectString,"message"]});Object.assign(R,G);const H=new ResourceNotFoundException({$metadata:deserializeMetadata(E),...R});return decorateServiceException(H,E.body)},de_ServiceQuotaExceededExceptionRes=async(E,A)=>{const R=map({}),F=E.body,G=take(F,{Message:[,expectString,"message"]});Object.assign(R,G);const H=new ServiceQuotaExceededException({$metadata:deserializeMetadata(E),...R});return decorateServiceException(H,E.body)},de_ThrottlingExceptionRes=async(E,A)=>{const R=map({}),F=E.body,G=take(F,{Message:[,expectString,"message"]});Object.assign(R,G);const H=new ThrottlingException({$metadata:deserializeMetadata(E),...R});return decorateServiceException(H,E.body)},de_ValidationExceptionRes=async(E,A)=>{const R=map({}),F=E.body,G=take(F,{FieldList:[,$=>de_ValidationExceptionFieldList($),"fieldList"],Message:[,expectString,"message"],Reason:[,expectString,"reason"]});Object.assign(R,G);const H=new ValidationException({$metadata:deserializeMetadata(E),...R});return decorateServiceException(H,E.body)},se_BoundingBox=(E,A)=>E.filter(R=>R!=null).map(R=>serializeFloat(R)),se_CalculateRouteTruckModeOptions=(E,A)=>take(E,{AvoidFerries:[],AvoidTolls:[],Dimensions:R=>se_TruckDimensions(R),Weight:R=>se_TruckWeight(R)}),se_Position=(E,A)=>E.filter(R=>R!=null).map(R=>serializeFloat(R)),se_TruckDimensions=(E,A)=>take(E,{Height:serializeFloat,Length:serializeFloat,Unit:[],Width:serializeFloat}),se_TruckWeight=(E,A)=>take(E,{Total:serializeFloat,Unit:[]}),se_WaypointPositionList=(E,A)=>E.filter(R=>R!=null).map(R=>se_Position(R)),de_BoundingBox=(E,A)=>(E||[]).filter(F=>F!=null).map(F=>limitedParseDouble(F)),de_CalculateRouteSummary=(E,A)=>take(E,{DataSource:expectString,Distance:limitedParseDouble,DistanceUnit:expectString,DurationSeconds:limitedParseDouble,RouteBBox:R=>de_BoundingBox(R)}),de_Leg=(E,A)=>take(E,{Distance:limitedParseDouble,DurationSeconds:limitedParseDouble,EndPosition:R=>de_Position(R),Geometry:R=>de_LegGeometry(R),StartPosition:R=>de_Position(R),Steps:R=>de_StepList(R)}),de_LegGeometry=(E,A)=>take(E,{LineString:R=>de_LineString(R)}),de_LegList=(E,A)=>(E||[]).filter(F=>F!=null).map(F=>de_Leg(F)),de_LineString=(E,A)=>(E||[]).filter(F=>F!=null).map(F=>de_Position(F)),de_Place=(E,A)=>take(E,{AddressNumber:expectString,Categories:_json,Country:expectString,Geometry:R=>de_PlaceGeometry(R),Interpolated:expectBoolean,Label:expectString,Municipality:expectString,Neighborhood:expectString,PostalCode:expectString,Region:expectString,Street:expectString,SubMunicipality:expectString,SubRegion:expectString,SupplementalCategories:_json,TimeZone:_json,UnitNumber:expectString,UnitType:expectString}),de_PlaceGeometry=(E,A)=>take(E,{Point:R=>de_Position(R)}),de_Position=(E,A)=>(E||[]).filter(F=>F!=null).map(F=>limitedParseDouble(F)),de_SearchForTextResult=(E,A)=>take(E,{Distance:limitedParseDouble,Place:R=>de_Place(R),PlaceId:expectString,Relevance:limitedParseDouble}),de_SearchForTextResultList=(E,A)=>(E||[]).filter(F=>F!=null).map(F=>de_SearchForTextResult(F)),de_SearchPlaceIndexForSuggestionsSummary=(E,A)=>take(E,{BiasPosition:R=>de_Position(R),DataSource:expectString,FilterBBox:R=>de_BoundingBox(R),FilterCategories:_json,FilterCountries:_json,Language:expectString,MaxResults:expectInt32,Text:expectString}),de_SearchPlaceIndexForTextSummary=(E,A)=>take(E,{BiasPosition:R=>de_Position(R),DataSource:expectString,FilterBBox:R=>de_BoundingBox(R),FilterCategories:_json,FilterCountries:_json,Language:expectString,MaxResults:expectInt32,ResultBBox:R=>de_BoundingBox(R),Text:expectString}),de_Step=(E,A)=>take(E,{Distance:limitedParseDouble,DurationSeconds:limitedParseDouble,EndPosition:R=>de_Position(R),GeometryOffset:expectInt32,StartPosition:R=>de_Position(R)}),de_StepList=(E,A)=>(E||[]).filter(F=>F!=null).map(F=>de_Step(F)),de_ValidationExceptionField=(E,A)=>take(E,{Message:[,expectString,"message"],Name:[,expectString,"name"]}),de_ValidationExceptionFieldList=(E,A)=>(E||[]).filter(F=>F!=null).map(F=>de_ValidationExceptionField(F)),deserializeMetadata=E=>({httpStatusCode:E.statusCode,requestId:E.headers["x-amzn-requestid"]??E.headers["x-amzn-request-id"]??E.headers["x-amz-request-id"],extendedRequestId:E.headers["x-amz-id-2"],cfId:E.headers["x-amz-cf-id"]}),_K="Key",_L="Language",_k="key",_l="language";class CalculateRouteCommand extends Command.classBuilder().ep({...commonParams}).m(function(A,R,F,G){return[getSerdePlugin(F,this.serialize,this.deserialize),getEndpointPlugin(F,A.getEndpointParameterInstructions())]}).s("LocationService","CalculateRoute",{}).n("LocationClient","CalculateRouteCommand").f(CalculateRouteRequestFilterSensitiveLog,CalculateRouteResponseFilterSensitiveLog).ser(se_CalculateRouteCommand).de(de_CalculateRouteCommand).build(){}class GetPlaceCommand extends Command.classBuilder().ep({...commonParams}).m(function(A,R,F,G){return[getSerdePlugin(F,this.serialize,this.deserialize),getEndpointPlugin(F,A.getEndpointParameterInstructions())]}).s("LocationService","GetPlace",{}).n("LocationClient","GetPlaceCommand").f(GetPlaceRequestFilterSensitiveLog,GetPlaceResponseFilterSensitiveLog).ser(se_GetPlaceCommand).de(de_GetPlaceCommand).build(){}class SearchPlaceIndexForSuggestionsCommand extends Command.classBuilder().ep({...commonParams}).m(function(A,R,F,G){return[getSerdePlugin(F,this.serialize,this.deserialize),getEndpointPlugin(F,A.getEndpointParameterInstructions())]}).s("LocationService","SearchPlaceIndexForSuggestions",{}).n("LocationClient","SearchPlaceIndexForSuggestionsCommand").f(SearchPlaceIndexForSuggestionsRequestFilterSensitiveLog,SearchPlaceIndexForSuggestionsResponseFilterSensitiveLog).ser(se_SearchPlaceIndexForSuggestionsCommand).de(de_SearchPlaceIndexForSuggestionsCommand).build(){}class SearchPlaceIndexForTextCommand extends Command.classBuilder().ep({...commonParams}).m(function(A,R,F,G){return[getSerdePlugin(F,this.serialize,this.deserialize),getEndpointPlugin(F,A.getEndpointParameterInstructions())]}).s("LocationService","SearchPlaceIndexForText",{}).n("LocationClient","SearchPlaceIndexForTextCommand").f(SearchPlaceIndexForTextRequestFilterSensitiveLog,SearchPlaceIndexForTextResponseFilterSensitiveLog).ser(se_SearchPlaceIndexForTextCommand).de(de_SearchPlaceIndexForTextCommand).build(){}const placesName="TaxiGo",region$1="us-east-1";async function initializeLocationClient(){try{const A=useRuntimeConfig().public.AWS_LOCATION_SERVICE_KEY,R=await withAPIKey(A);return new LocationClient({region:region$1,...R.getLocationClientConfig()})}catch(E){throw console.error("Error initializing Location client:",E),E}}const MONTERREY_MX_COORDS=[-100.3175,25.6856],searchPlaceForSuggestions=async(E,A)=>{const R={IndexName:placesName,Text:E,FilterCountries:["MEX"],BiasPosition:MONTERREY_MX_COORDS},F=new SearchPlaceIndexForSuggestionsCommand(R);return await A.send(F)},searchPlaceForText=async(E,A)=>{try{const R={IndexName:placesName,Text:E},F=new SearchPlaceIndexForTextCommand(R);return await A.send(F)}catch(R){throw console.error("Error searching for place:",R),R}},getPlace=async(E,A)=>{try{const R={IndexName:placesName,PlaceId:E},F=new GetPlaceCommand(R);return await A.send(F)}catch(R){throw console.error("Error getting place:",R),R}},calculateRoute=async(E,A,R)=>{try{const F={CalculatorName:placesName,DestinationPosition:A,DeparturePosition:E,IncludeLegGeometry:!0},G=new CalculateRouteCommand(F);return await R.send(G)}catch(F){throw console.error("Error calculating route:",F),F}},convertTime=F=>{var F=parseInt(F,10),A=Math.floor(F/3600),R=Math.floor((F-A*3600)/60),F=F-A*3600-R*60;return A?R?`${A}h ${R}m ${F}s`:`${A}h ${F}s`:R?`${R}m ${F}s`:`${F}s`};var maplibreGl={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.1.2/LICENSE.txt
 */(function(E,A){(function(R,F){E.exports=F()})(commonjsGlobal,function(){var R={},F={};function G($,M,ye){if(F[$]=ye,$==="index"){var oe="var sharedModule = {}; ("+F.shared+")(sharedModule); ("+F.worker+")(sharedModule);",Ee={};return F.shared(Ee),F.index(R,Ee),typeof window<"u"&&R.setWorkerUrl(window.URL.createObjectURL(new Blob([oe],{type:"text/javascript"}))),R}}G("shared",["exports"],function($){function M(x,_,w,T){return new(w||(w=Promise))(function(P,B){function L(W){try{V(T.next(W))}catch(X){B(X)}}function O(W){try{V(T.throw(W))}catch(X){B(X)}}function V(W){var X;W.done?P(W.value):(X=W.value,X instanceof w?X:new w(function(Y){Y(X)})).then(L,O)}V((T=T.apply(x,_||[])).next())})}function ye(x){return x&&x.__esModule&&Object.prototype.hasOwnProperty.call(x,"default")?x.default:x}typeof SuppressedError=="function"&&SuppressedError;var oe=Ee;function Ee(x,_){this.x=x,this.y=_}Ee.prototype={clone:function(){return new Ee(this.x,this.y)},add:function(x){return this.clone()._add(x)},sub:function(x){return this.clone()._sub(x)},multByPoint:function(x){return this.clone()._multByPoint(x)},divByPoint:function(x){return this.clone()._divByPoint(x)},mult:function(x){return this.clone()._mult(x)},div:function(x){return this.clone()._div(x)},rotate:function(x){return this.clone()._rotate(x)},rotateAround:function(x,_){return this.clone()._rotateAround(x,_)},matMult:function(x){return this.clone()._matMult(x)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(x){return this.x===x.x&&this.y===x.y},dist:function(x){return Math.sqrt(this.distSqr(x))},distSqr:function(x){var _=x.x-this.x,w=x.y-this.y;return _*_+w*w},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(x){return Math.atan2(this.y-x.y,this.x-x.x)},angleWith:function(x){return this.angleWithSep(x.x,x.y)},angleWithSep:function(x,_){return Math.atan2(this.x*_-this.y*x,this.x*x+this.y*_)},_matMult:function(x){var _=x[2]*this.x+x[3]*this.y;return this.x=x[0]*this.x+x[1]*this.y,this.y=_,this},_add:function(x){return this.x+=x.x,this.y+=x.y,this},_sub:function(x){return this.x-=x.x,this.y-=x.y,this},_mult:function(x){return this.x*=x,this.y*=x,this},_div:function(x){return this.x/=x,this.y/=x,this},_multByPoint:function(x){return this.x*=x.x,this.y*=x.y,this},_divByPoint:function(x){return this.x/=x.x,this.y/=x.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var x=this.y;return this.y=this.x,this.x=-x,this},_rotate:function(x){var _=Math.cos(x),w=Math.sin(x),T=w*this.x+_*this.y;return this.x=_*this.x-w*this.y,this.y=T,this},_rotateAround:function(x,_){var w=Math.cos(x),T=Math.sin(x),P=_.y+T*(this.x-_.x)+w*(this.y-_.y);return this.x=_.x+w*(this.x-_.x)-T*(this.y-_.y),this.y=P,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ee.convert=function(x){return x instanceof Ee?x:Array.isArray(x)?new Ee(x[0],x[1]):x};var we=ye(oe),ce=$e;function $e(x,_,w,T){this.cx=3*x,this.bx=3*(w-x)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*_,this.by=3*(T-_)-this.cy,this.ay=1-this.cy-this.by,this.p1x=x,this.p1y=_,this.p2x=w,this.p2y=T}$e.prototype={sampleCurveX:function(x){return((this.ax*x+this.bx)*x+this.cx)*x},sampleCurveY:function(x){return((this.ay*x+this.by)*x+this.cy)*x},sampleCurveDerivativeX:function(x){return(3*this.ax*x+2*this.bx)*x+this.cx},solveCurveX:function(x,_){if(_===void 0&&(_=1e-6),x<0)return 0;if(x>1)return 1;for(var w=x,T=0;T<8;T++){var P=this.sampleCurveX(w)-x;if(Math.abs(P)<_)return w;var B=this.sampleCurveDerivativeX(w);if(Math.abs(B)<1e-6)break;w-=P/B}var L=0,O=1;for(w=x,T=0;T<20&&(P=this.sampleCurveX(w),!(Math.abs(P-x)<_));T++)x>P?L=w:O=w,w=.5*(O-L)+L;return w},solve:function(x,_){return this.sampleCurveY(this.solveCurveX(x,_))}};var Ge=ye(ce);let Xe,ht;function yt(){return Xe==null&&(Xe=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Xe}function $t(){if(ht==null&&(ht=!1,yt())){const _=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(_){for(let T=0;T<5*5;T++){const P=4*T;_.fillStyle=`rgb(${P},${P+1},${P+2})`,_.fillRect(T%5,Math.floor(T/5),1,1)}const w=_.getImageData(0,0,5,5).data;for(let T=0;T<5*5*4;T++)if(T%4!=3&&w[T]!==T){ht=!0;break}}}return ht||!1}function Ft(x,_,w,T){const P=new Ge(x,_,w,T);return function(B){return P.solve(B)}}const Nt=Ft(.25,.1,.25,1);function Ci(x,_,w){return Math.min(w,Math.max(_,x))}function ir(x,_,w){const T=w-_,P=((x-_)%T+T)%T+_;return P===_?w:P}function Pi(x,..._){for(const w of _)for(const T in w)x[T]=w[T];return x}let dn=1;function Yr(x,_,w){const T={};for(const P in x)T[P]=_.call(w||this,x[P],P,x);return T}function qs(x,_,w){const T={};for(const P in x)_.call(w||this,x[P],P,x)&&(T[P]=x[P]);return T}function qi(x){return Array.isArray(x)?x.map(qi):typeof x=="object"&&x?Yr(x,qi):x}const ni={};function Mi(x){ni[x]||(typeof console<"u"&&console.warn(x),ni[x]=!0)}function xr(x,_,w){return(w.y-x.y)*(_.x-x.x)>(_.y-x.y)*(w.x-x.x)}function pn(x){let _=0;for(let w,T,P=0,B=x.length,L=B-1;P<B;L=P++)w=x[P],T=x[L],_+=(T.x-w.x)*(w.y+T.y);return _}function Vr(x){return typeof WorkerGlobalScope<"u"&&x!==void 0&&x instanceof WorkerGlobalScope}let $n=null;function Rr(x){return typeof ImageBitmap<"u"&&x instanceof ImageBitmap}const _s="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Jr(x,_,w,T,P){return M(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const B=new VideoFrame(x,{timestamp:0});try{const L=B==null?void 0:B.format;if(!L||!L.startsWith("BGR")&&!L.startsWith("RGB"))throw new Error(`Unrecognized format ${L}`);const O=L.startsWith("BGR"),V=new Uint8ClampedArray(T*P*4);if(yield B.copyTo(V,function(W,X,Y,te,re){const se=4*Math.max(-X,0),ue=(Math.max(0,Y)-Y)*te*4+se,me=4*te,xe=Math.max(0,X),Me=Math.max(0,Y);return{rect:{x:xe,y:Me,width:Math.min(W.width,X+te)-xe,height:Math.min(W.height,Y+re)-Me},layout:[{offset:ue,stride:me}]}}(x,_,w,T,P)),O)for(let W=0;W<V.length;W+=4){const X=V[W];V[W]=V[W+2],V[W+2]=X}return V}finally{B.close()}})}let ji,Hi;const fn="AbortError";function Dr(){return new Error(fn)}const mn={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function qr(x){return mn.REGISTERED_PROTOCOLS[x.substring(0,x.indexOf("://"))]}const vr="global-dispatcher";class br extends Error{constructor(_,w,T,P){super(`AJAXError: ${w} (${_}): ${T}`),this.status=_,this.statusText=w,this.url=T,this.body=P}}const Nn=()=>Vr(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Qr=function(x,_){if(/:\/\//.test(x.url)&&!/^https?:|^file:/.test(x.url)){const T=qr(x.url);if(T)return T(x,_);if(Vr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"getResource",data:x,targetMapId:vr},_)}if(!(/^file:/.test(w=x.url)||/^file:/.test(Nn())&&!/^\w+:/.test(w))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(T,P){return M(this,void 0,void 0,function*(){const B=new Request(T.url,{method:T.method||"GET",body:T.body,credentials:T.credentials,headers:T.headers,cache:T.cache,referrer:Nn(),signal:P.signal});T.type==="json"&&B.headers.set("Accept","application/json");const L=yield fetch(B);if(!L.ok){const W=yield L.blob();throw new br(L.status,L.statusText,T.url,W)}let O;O=T.type==="arrayBuffer"||T.type==="image"?L.arrayBuffer():T.type==="json"?L.json():L.text();const V=yield O;if(P.signal.aborted)throw Dr();return{data:V,cacheControl:L.headers.get("Cache-Control"),expires:L.headers.get("Expires")}})}(x,_);if(Vr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"getResource",data:x,mustQueue:!0,targetMapId:vr},_)}var w;return function(T,P){return new Promise((B,L)=>{const O=new XMLHttpRequest;O.open(T.method||"GET",T.url,!0),T.type!=="arrayBuffer"&&T.type!=="image"||(O.responseType="arraybuffer");for(const V in T.headers)O.setRequestHeader(V,T.headers[V]);T.type==="json"&&(O.responseType="text",O.setRequestHeader("Accept","application/json")),O.withCredentials=T.credentials==="include",O.onerror=()=>{L(new Error(O.statusText))},O.onload=()=>{if(!P.signal.aborted)if((O.status>=200&&O.status<300||O.status===0)&&O.response!==null){let V=O.response;if(T.type==="json")try{V=JSON.parse(O.response)}catch(W){return void L(W)}B({data:V,cacheControl:O.getResponseHeader("Cache-Control"),expires:O.getResponseHeader("Expires")})}else{const V=new Blob([O.response],{type:O.getResponseHeader("Content-Type")});L(new br(O.status,O.statusText,T.url,V))}},P.signal.addEventListener("abort",()=>{O.abort(),L(Dr())}),O.send(T.body)})}(x,_)};function js(x){if(!x||x.indexOf("://")<=0||x.indexOf("data:image/")===0||x.indexOf("blob:")===0)return!0;const _=new URL(x),w=window.location;return _.protocol===w.protocol&&_.host===w.host}function en(x,_,w){w[x]&&w[x].indexOf(_)!==-1||(w[x]=w[x]||[],w[x].push(_))}function tn(x,_,w){if(w&&w[x]){const T=w[x].indexOf(_);T!==-1&&w[x].splice(T,1)}}class rn{constructor(_,w={}){Pi(this,w),this.type=_}}class mi extends rn{constructor(_,w={}){super("error",Pi({error:_},w))}}class gn{on(_,w){return this._listeners=this._listeners||{},en(_,w,this._listeners),this}off(_,w){return tn(_,w,this._listeners),tn(_,w,this._oneTimeListeners),this}once(_,w){return w?(this._oneTimeListeners=this._oneTimeListeners||{},en(_,w,this._oneTimeListeners),this):new Promise(T=>this.once(_,T))}fire(_,w){typeof _=="string"&&(_=new rn(_,w||{}));const T=_.type;if(this.listens(T)){_.target=this;const P=this._listeners&&this._listeners[T]?this._listeners[T].slice():[];for(const O of P)O.call(this,_);const B=this._oneTimeListeners&&this._oneTimeListeners[T]?this._oneTimeListeners[T].slice():[];for(const O of B)tn(T,O,this._oneTimeListeners),O.call(this,_);const L=this._eventedParent;L&&(Pi(_,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),L.fire(_))}else _ instanceof mi&&console.error(_.error);return this}listens(_){return this._listeners&&this._listeners[_]&&this._listeners[_].length>0||this._oneTimeListeners&&this._oneTimeListeners[_]&&this._oneTimeListeners[_].length>0||this._eventedParent&&this._eventedParent.listens(_)}setEventedParent(_,w){return this._eventedParent=_,this._eventedParentData=w,this}}var Le={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const _n=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function ys(x,_){const w={};for(const T in x)T!=="ref"&&(w[T]=x[T]);return _n.forEach(T=>{T in _&&(w[T]=_[T])}),w}function Dt(x,_){if(Array.isArray(x)){if(!Array.isArray(_)||x.length!==_.length)return!1;for(let w=0;w<x.length;w++)if(!Dt(x[w],_[w]))return!1;return!0}if(typeof x=="object"&&x!==null&&_!==null){if(typeof _!="object"||Object.keys(x).length!==Object.keys(_).length)return!1;for(const w in x)if(!Dt(x[w],_[w]))return!1;return!0}return x===_}function Ti(x,_){x.push(_)}function kr(x,_,w){Ti(w,{command:"addSource",args:[x,_[x]]})}function Un(x,_,w){Ti(_,{command:"removeSource",args:[x]}),w[x]=!0}function Vn(x,_,w,T){Un(x,w,T),kr(x,_,w)}function qn(x,_,w){let T;for(T in x[w])if(Object.prototype.hasOwnProperty.call(x[w],T)&&T!=="data"&&!Dt(x[w][T],_[w][T]))return!1;for(T in _[w])if(Object.prototype.hasOwnProperty.call(_[w],T)&&T!=="data"&&!Dt(x[w][T],_[w][T]))return!1;return!0}function yn(x,_,w,T,P,B){x=x||{},_=_||{};for(const L in x)Object.prototype.hasOwnProperty.call(x,L)&&(Dt(x[L],_[L])||w.push({command:B,args:[T,L,_[L],P]}));for(const L in _)Object.prototype.hasOwnProperty.call(_,L)&&!Object.prototype.hasOwnProperty.call(x,L)&&(Dt(x[L],_[L])||w.push({command:B,args:[T,L,_[L],P]}))}function jn(x){return x.id}function xs(x,_){return x[_.id]=_,x}class Ye{constructor(_,w,T,P){this.message=(_?`${_}: `:"")+T,P&&(this.identifier=P),w!=null&&w.__line__&&(this.line=w.__line__)}}function rr(x,..._){for(const w of _)for(const T in w)x[T]=w[T];return x}class Gi extends Error{constructor(_,w){super(w),this.message=w,this.key=_}}class vs{constructor(_,w=[]){this.parent=_,this.bindings={};for(const[T,P]of w)this.bindings[T]=P}concat(_){return new vs(this,_)}get(_){if(this.bindings[_])return this.bindings[_];if(this.parent)return this.parent.get(_);throw new Error(`${_} not found in scope.`)}has(_){return!!this.bindings[_]||!!this.parent&&this.parent.has(_)}}const xn={kind:"null"},We={kind:"number"},Tt={kind:"string"},bt={kind:"boolean"},Ai={kind:"color"},fr={kind:"object"},wt={kind:"value"},nn={kind:"collator"},jr={kind:"formatted"},pe={kind:"padding"},ee={kind:"resolvedImage"},ie={kind:"variableAnchorOffsetCollection"};function ae(x,_){return{kind:"array",itemType:x,N:_}}function he(x){if(x.kind==="array"){const _=he(x.itemType);return typeof x.N=="number"?`array<${_}, ${x.N}>`:x.itemType.kind==="value"?"array":`array<${_}>`}return x.kind}const Te=[xn,We,Tt,bt,Ai,jr,fr,ae(wt),pe,ee,ie];function Ae(x,_){if(_.kind==="error")return null;if(x.kind==="array"){if(_.kind==="array"&&(_.N===0&&_.itemType.kind==="value"||!Ae(x.itemType,_.itemType))&&(typeof x.N!="number"||x.N===_.N))return null}else{if(x.kind===_.kind)return null;if(x.kind==="value"){for(const w of Te)if(!Ae(w,_))return null}}return`Expected ${he(x)} but found ${he(_)} instead.`}function Pe(x,_){return _.some(w=>w.kind===x.kind)}function be(x,_){return _.some(w=>w==="null"?x===null:w==="array"?Array.isArray(x):w==="object"?x&&!Array.isArray(x)&&typeof x=="object":w===typeof x)}function Re(x,_){return x.kind==="array"&&_.kind==="array"?x.itemType.kind===_.itemType.kind&&typeof x.N=="number":x.kind===_.kind}const qe=.96422,Fe=.82521,Ne=4/29,lt=6/29,gt=3*lt*lt,ft=lt*lt*lt,kt=Math.PI/180,xt=180/Math.PI;function Wt(x){return(x%=360)<0&&(x+=360),x}function qt([x,_,w,T]){let P,B;const L=St((.2225045*(x=li(x))+.7168786*(_=li(_))+.0606169*(w=li(w)))/1);x===_&&_===w?P=B=L:(P=St((.4360747*x+.3850649*_+.1430804*w)/qe),B=St((.0139322*x+.0971045*_+.7141733*w)/Fe));const O=116*L-16;return[O<0?0:O,500*(P-L),200*(L-B),T]}function li(x){return x<=.04045?x/12.92:Math.pow((x+.055)/1.055,2.4)}function St(x){return x>ft?Math.pow(x,1/3):x/gt+Ne}function ti([x,_,w,T]){let P=(x+16)/116,B=isNaN(_)?P:P+_/500,L=isNaN(w)?P:P-w/200;return P=1*Zi(P),B=qe*Zi(B),L=Fe*Zi(L),[wi(3.1338561*B-1.6168667*P-.4906146*L),wi(-.9787684*B+1.9161415*P+.033454*L),wi(.0719453*B-.2289914*P+1.4052427*L),T]}function wi(x){return(x=x<=.00304?12.92*x:1.055*Math.pow(x,1/2.4)-.055)<0?0:x>1?1:x}function Zi(x){return x>lt?x*x*x:gt*(x-Ne)}function Ri(x){return parseInt(x.padEnd(2,x),16)/255}function Fi(x,_){return nr(_?x/100:x,0,1)}function nr(x,_,w){return Math.min(Math.max(_,x),w)}function $o(x){return!x.some(Number.isNaN)}const Wl={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Ut{constructor(_,w,T,P=1,B=!0){this.r=_,this.g=w,this.b=T,this.a=P,B||(this.r*=P,this.g*=P,this.b*=P,P||this.overwriteGetter("rgb",[_,w,T,P]))}static parse(_){if(_ instanceof Ut)return _;if(typeof _!="string")return;const w=function(T){if((T=T.toLowerCase().trim())==="transparent")return[0,0,0,0];const P=Wl[T];if(P){const[L,O,V]=P;return[L/255,O/255,V/255,1]}if(T.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(T)){const L=T.length<6?1:2;let O=1;return[Ri(T.slice(O,O+=L)),Ri(T.slice(O,O+=L)),Ri(T.slice(O,O+=L)),Ri(T.slice(O,O+L)||"ff")]}if(T.startsWith("rgb")){const L=T.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(L){const[O,V,W,X,Y,te,re,se,ue,me,xe,Me]=L,ve=[X||" ",re||" ",me].join("");if(ve==="  "||ve==="  /"||ve===",,"||ve===",,,"){const Ie=[W,te,ue].join(""),Oe=Ie==="%%%"?100:Ie===""?255:0;if(Oe){const Ue=[nr(+V/Oe,0,1),nr(+Y/Oe,0,1),nr(+se/Oe,0,1),xe?Fi(+xe,Me):1];if($o(Ue))return Ue}}return}}const B=T.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(B){const[L,O,V,W,X,Y,te,re,se]=B,ue=[V||" ",X||" ",te].join("");if(ue==="  "||ue==="  /"||ue===",,"||ue===",,,"){const me=[+O,nr(+W,0,100),nr(+Y,0,100),re?Fi(+re,se):1];if($o(me))return function([xe,Me,ve,Ie]){function Oe(Ue){const it=(Ue+xe/30)%12,ot=Me*Math.min(ve,1-ve);return ve-ot*Math.max(-1,Math.min(it-3,9-it,1))}return xe=Wt(xe),Me/=100,ve/=100,[Oe(0),Oe(8),Oe(4),Ie]}(me)}}}(_);return w?new Ut(...w,!1):void 0}get rgb(){const{r:_,g:w,b:T,a:P}=this,B=P||1/0;return this.overwriteGetter("rgb",[_/B,w/B,T/B,P])}get hcl(){return this.overwriteGetter("hcl",function(_){const[w,T,P,B]=qt(_),L=Math.sqrt(T*T+P*P);return[Math.round(1e4*L)?Wt(Math.atan2(P,T)*xt):NaN,L,w,B]}(this.rgb))}get lab(){return this.overwriteGetter("lab",qt(this.rgb))}overwriteGetter(_,w){return Object.defineProperty(this,_,{value:w}),w}toString(){const[_,w,T,P]=this.rgb;return`rgba(${[_,w,T].map(B=>Math.round(255*B)).join(",")},${P})`}}Ut.black=new Ut(0,0,0,1),Ut.white=new Ut(1,1,1,1),Ut.transparent=new Ut(0,0,0,0),Ut.red=new Ut(1,0,0,1);class Pa{constructor(_,w,T){this.sensitivity=_?w?"variant":"case":w?"accent":"base",this.locale=T,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(_,w){return this.collator.compare(_,w)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ma{constructor(_,w,T,P,B){this.text=_,this.image=w,this.scale=T,this.fontStack=P,this.textColor=B}}class sr{constructor(_){this.sections=_}static fromString(_){return new sr([new Ma(_,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(_=>_.text.length!==0||_.image&&_.image.name.length!==0)}static factory(_){return _ instanceof sr?_:sr.fromString(_)}toString(){return this.sections.length===0?"":this.sections.map(_=>_.text).join("")}}class ar{constructor(_){this.values=_.slice()}static parse(_){if(_ instanceof ar)return _;if(typeof _=="number")return new ar([_,_,_,_]);if(Array.isArray(_)&&!(_.length<1||_.length>4)){for(const w of _)if(typeof w!="number")return;switch(_.length){case 1:_=[_[0],_[0],_[0],_[0]];break;case 2:_=[_[0],_[1],_[0],_[1]];break;case 3:_=[_[0],_[1],_[2],_[1]]}return new ar(_)}}toString(){return JSON.stringify(this.values)}}const No=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Di{constructor(_){this.values=_.slice()}static parse(_){if(_ instanceof Di)return _;if(Array.isArray(_)&&!(_.length<1)&&_.length%2==0){for(let w=0;w<_.length;w+=2){const T=_[w],P=_[w+1];if(typeof T!="string"||!No.has(T)||!Array.isArray(P)||P.length!==2||typeof P[0]!="number"||typeof P[1]!="number")return}return new Di(_)}}toString(){return JSON.stringify(this.values)}}class mr{constructor(_){this.name=_.name,this.available=_.available}toString(){return this.name}static fromString(_){return _?new mr({name:_,available:!1}):null}}function Uo(x,_,w,T){return typeof x=="number"&&x>=0&&x<=255&&typeof _=="number"&&_>=0&&_<=255&&typeof w=="number"&&w>=0&&w<=255?T===void 0||typeof T=="number"&&T>=0&&T<=1?null:`Invalid rgba value [${[x,_,w,T].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof T=="number"?[x,_,w,T]:[x,_,w]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function sn(x){if(x===null||typeof x=="string"||typeof x=="boolean"||typeof x=="number"||x instanceof Ut||x instanceof Pa||x instanceof sr||x instanceof ar||x instanceof Di||x instanceof mr)return!0;if(Array.isArray(x)){for(const _ of x)if(!sn(_))return!1;return!0}if(typeof x=="object"){for(const _ in x)if(!sn(x[_]))return!1;return!0}return!1}function di(x){if(x===null)return xn;if(typeof x=="string")return Tt;if(typeof x=="boolean")return bt;if(typeof x=="number")return We;if(x instanceof Ut)return Ai;if(x instanceof Pa)return nn;if(x instanceof sr)return jr;if(x instanceof ar)return pe;if(x instanceof Di)return ie;if(x instanceof mr)return ee;if(Array.isArray(x)){const _=x.length;let w;for(const T of x){const P=di(T);if(w){if(w===P)continue;w=wt;break}w=P}return ae(w||wt,_)}return fr}function bs(x){const _=typeof x;return x===null?"":_==="string"||_==="number"||_==="boolean"?String(x):x instanceof Ut||x instanceof sr||x instanceof ar||x instanceof Di||x instanceof mr?x.toString():JSON.stringify(x)}class vn{constructor(_,w){this.type=_,this.value=w}static parse(_,w){if(_.length!==2)return w.error(`'literal' expression requires exactly one argument, but found ${_.length-1} instead.`);if(!sn(_[1]))return w.error("invalid value");const T=_[1];let P=di(T);const B=w.expectedType;return P.kind!=="array"||P.N!==0||!B||B.kind!=="array"||typeof B.N=="number"&&B.N!==0||(P=B),new vn(P,T)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class si{constructor(_){this.name="ExpressionEvaluationError",this.message=_}toJSON(){return this.message}}const bn={string:Tt,number:We,boolean:bt,object:fr};class wr{constructor(_,w){this.type=_,this.args=w}static parse(_,w){if(_.length<2)return w.error("Expected at least one argument.");let T,P=1;const B=_[0];if(B==="array"){let O,V;if(_.length>2){const W=_[1];if(typeof W!="string"||!(W in bn)||W==="object")return w.error('The item type argument of "array" must be one of string, number, boolean',1);O=bn[W],P++}else O=wt;if(_.length>3){if(_[2]!==null&&(typeof _[2]!="number"||_[2]<0||_[2]!==Math.floor(_[2])))return w.error('The length argument to "array" must be a positive integer literal',2);V=_[2],P++}T=ae(O,V)}else{if(!bn[B])throw new Error(`Types doesn't contain name = ${B}`);T=bn[B]}const L=[];for(;P<_.length;P++){const O=w.parse(_[P],P,wt);if(!O)return null;L.push(O)}return new wr(T,L)}evaluate(_){for(let w=0;w<this.args.length;w++){const T=this.args[w].evaluate(_);if(!Ae(this.type,di(T)))return T;if(w===this.args.length-1)throw new si(`Expected value to be of type ${he(this.type)}, but found ${he(di(T))} instead.`)}throw new Error}eachChild(_){this.args.forEach(_)}outputDefined(){return this.args.every(_=>_.outputDefined())}}const Hs={"to-boolean":bt,"to-color":Ai,"to-number":We,"to-string":Tt};class zr{constructor(_,w){this.type=_,this.args=w}static parse(_,w){if(_.length<2)return w.error("Expected at least one argument.");const T=_[0];if(!Hs[T])throw new Error(`Can't parse ${T} as it is not part of the known types`);if((T==="to-boolean"||T==="to-string")&&_.length!==2)return w.error("Expected one argument.");const P=Hs[T],B=[];for(let L=1;L<_.length;L++){const O=w.parse(_[L],L,wt);if(!O)return null;B.push(O)}return new zr(P,B)}evaluate(_){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(_);case"color":{let w,T;for(const P of this.args){if(w=P.evaluate(_),T=null,w instanceof Ut)return w;if(typeof w=="string"){const B=_.parseColor(w);if(B)return B}else if(Array.isArray(w)&&(T=w.length<3||w.length>4?`Invalid rbga value ${JSON.stringify(w)}: expected an array containing either three or four numeric values.`:Uo(w[0],w[1],w[2],w[3]),!T))return new Ut(w[0]/255,w[1]/255,w[2]/255,w[3])}throw new si(T||`Could not parse color from value '${typeof w=="string"?w:JSON.stringify(w)}'`)}case"padding":{let w;for(const T of this.args){w=T.evaluate(_);const P=ar.parse(w);if(P)return P}throw new si(`Could not parse padding from value '${typeof w=="string"?w:JSON.stringify(w)}'`)}case"variableAnchorOffsetCollection":{let w;for(const T of this.args){w=T.evaluate(_);const P=Di.parse(w);if(P)return P}throw new si(`Could not parse variableAnchorOffsetCollection from value '${typeof w=="string"?w:JSON.stringify(w)}'`)}case"number":{let w=null;for(const T of this.args){if(w=T.evaluate(_),w===null)return 0;const P=Number(w);if(!isNaN(P))return P}throw new si(`Could not convert ${JSON.stringify(w)} to number.`)}case"formatted":return sr.fromString(bs(this.args[0].evaluate(_)));case"resolvedImage":return mr.fromString(bs(this.args[0].evaluate(_)));default:return bs(this.args[0].evaluate(_))}}eachChild(_){this.args.forEach(_)}outputDefined(){return this.args.every(_=>_.outputDefined())}}const Ra=["Unknown","Point","LineString","Polygon"];class Hn{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ra[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(_){let w=this._parseColorCache[_];return w||(w=this._parseColorCache[_]=Ut.parse(_)),w}}class Ot{constructor(_,w,T=[],P,B=new vs,L=[]){this.registry=_,this.path=T,this.key=T.map(O=>`[${O}]`).join(""),this.scope=B,this.errors=L,this.expectedType=P,this._isConstant=w}parse(_,w,T,P,B={}){return w?this.concat(w,T,P)._parse(_,B):this._parse(_,B)}_parse(_,w){function T(P,B,L){return L==="assert"?new wr(B,[P]):L==="coerce"?new zr(B,[P]):P}if(_!==null&&typeof _!="string"&&typeof _!="boolean"&&typeof _!="number"||(_=["literal",_]),Array.isArray(_)){if(_.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const P=_[0];if(typeof P!="string")return this.error(`Expression name must be a string, but found ${typeof P} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const B=this.registry[P];if(B){let L=B.parse(_,this);if(!L)return null;if(this.expectedType){const O=this.expectedType,V=L.type;if(O.kind!=="string"&&O.kind!=="number"&&O.kind!=="boolean"&&O.kind!=="object"&&O.kind!=="array"||V.kind!=="value")if(O.kind!=="color"&&O.kind!=="formatted"&&O.kind!=="resolvedImage"||V.kind!=="value"&&V.kind!=="string")if(O.kind!=="padding"||V.kind!=="value"&&V.kind!=="number"&&V.kind!=="array")if(O.kind!=="variableAnchorOffsetCollection"||V.kind!=="value"&&V.kind!=="array"){if(this.checkSubtype(O,V))return null}else L=T(L,O,w.typeAnnotation||"coerce");else L=T(L,O,w.typeAnnotation||"coerce");else L=T(L,O,w.typeAnnotation||"coerce");else L=T(L,O,w.typeAnnotation||"assert")}if(!(L instanceof vn)&&L.type.kind!=="resolvedImage"&&this._isConstant(L)){const O=new Hn;try{L=new vn(L.type,L.evaluate(O))}catch(V){return this.error(V.message),null}}return L}return this.error(`Unknown expression "${P}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(_===void 0?"'undefined' value invalid. Use null instead.":typeof _=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof _} instead.`)}concat(_,w,T){const P=typeof _=="number"?this.path.concat(_):this.path,B=T?this.scope.concat(T):this.scope;return new Ot(this.registry,this._isConstant,P,w||null,B,this.errors)}error(_,...w){const T=`${this.key}${w.map(P=>`[${P}]`).join("")}`;this.errors.push(new Gi(T,_))}checkSubtype(_,w){const T=Ae(_,w);return T&&this.error(T),T}}class Gs{constructor(_,w,T){this.type=nn,this.locale=T,this.caseSensitive=_,this.diacriticSensitive=w}static parse(_,w){if(_.length!==2)return w.error("Expected one argument.");const T=_[1];if(typeof T!="object"||Array.isArray(T))return w.error("Collator options argument must be an object.");const P=w.parse(T["case-sensitive"]!==void 0&&T["case-sensitive"],1,bt);if(!P)return null;const B=w.parse(T["diacritic-sensitive"]!==void 0&&T["diacritic-sensitive"],1,bt);if(!B)return null;let L=null;return T.locale&&(L=w.parse(T.locale,1,Tt),!L)?null:new Gs(P,B,L)}evaluate(_){return new Pa(this.caseSensitive.evaluate(_),this.diacriticSensitive.evaluate(_),this.locale?this.locale.evaluate(_):null)}eachChild(_){_(this.caseSensitive),_(this.diacriticSensitive),this.locale&&_(this.locale)}outputDefined(){return!1}}const Br=8192;function Da(x,_){x[0]=Math.min(x[0],_[0]),x[1]=Math.min(x[1],_[1]),x[2]=Math.max(x[2],_[0]),x[3]=Math.max(x[3],_[1])}function ws(x,_){return!(x[0]<=_[0]||x[2]>=_[2]||x[1]<=_[1]||x[3]>=_[3])}function Vo(x,_){const w=(180+x[0])/360,T=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+x[1]*Math.PI/360)))/360,P=Math.pow(2,_.z);return[Math.round(w*P*Br),Math.round(T*P*Br)]}function Kl(x,_,w){const T=x[0]-_[0],P=x[1]-_[1],B=x[0]-w[0],L=x[1]-w[1];return T*L-B*P==0&&T*B<=0&&P*L<=0}function Zs(x,_){let w=!1;for(let L=0,O=_.length;L<O;L++){const V=_[L];for(let W=0,X=V.length;W<X-1;W++){if(Kl(x,V[W],V[W+1]))return!1;(P=V[W])[1]>(T=x)[1]!=(B=V[W+1])[1]>T[1]&&T[0]<(B[0]-P[0])*(T[1]-P[1])/(B[1]-P[1])+P[0]&&(w=!w)}}var T,P,B;return w}function qo(x,_){for(let w=0;w<_.length;w++)if(Zs(x,_[w]))return!0;return!1}function jo(x,_,w,T){const P=T[0]-w[0],B=T[1]-w[1],L=(x[0]-w[0])*B-P*(x[1]-w[1]),O=(_[0]-w[0])*B-P*(_[1]-w[1]);return L>0&&O<0||L<0&&O>0}function Xl(x,_,w){for(const W of w)for(let X=0;X<W.length-1;++X)if((O=[(L=W[X+1])[0]-(B=W[X])[0],L[1]-B[1]])[0]*(V=[(P=_)[0]-(T=x)[0],P[1]-T[1]])[1]-O[1]*V[0]!=0&&jo(T,P,B,L)&&jo(B,L,T,P))return!0;var T,P,B,L,O,V;return!1}function Ho(x,_){for(let w=0;w<x.length;++w)if(!Zs(x[w],_))return!1;for(let w=0;w<x.length-1;++w)if(Xl(x[w],x[w+1],_))return!1;return!0}function Yl(x,_){for(let w=0;w<_.length;w++)if(Ho(x,_[w]))return!0;return!1}function Ws(x,_,w){const T=[];for(let P=0;P<x.length;P++){const B=[];for(let L=0;L<x[P].length;L++){const O=Vo(x[P][L],w);Da(_,O),B.push(O)}T.push(B)}return T}function ka(x,_,w){const T=[];for(let P=0;P<x.length;P++){const B=Ws(x[P],_,w);T.push(B)}return T}function Go(x,_,w,T){if(x[0]<w[0]||x[0]>w[2]){const P=.5*T;let B=x[0]-w[0]>P?-T:w[0]-x[0]>P?T:0;B===0&&(B=x[0]-w[2]>P?-T:w[2]-x[0]>P?T:0),x[0]+=B}Da(_,x)}function Zo(x,_,w,T){const P=Math.pow(2,T.z)*Br,B=[T.x*Br,T.y*Br],L=[];for(const O of x)for(const V of O){const W=[V.x+B[0],V.y+B[1]];Go(W,_,w,P),L.push(W)}return L}function Ks(x,_,w,T){const P=Math.pow(2,T.z)*Br,B=[T.x*Br,T.y*Br],L=[];for(const V of x){const W=[];for(const X of V){const Y=[X.x+B[0],X.y+B[1]];Da(_,Y),W.push(Y)}L.push(W)}if(_[2]-_[0]<=P/2){(O=_)[0]=O[1]=1/0,O[2]=O[3]=-1/0;for(const V of L)for(const W of V)Go(W,_,w,P)}var O;return L}class wn{constructor(_,w){this.type=bt,this.geojson=_,this.geometries=w}static parse(_,w){if(_.length!==2)return w.error(`'within' expression requires exactly one argument, but found ${_.length-1} instead.`);if(sn(_[1])){const T=_[1];if(T.type==="FeatureCollection"){const P=[];for(const B of T.features){const{type:L,coordinates:O}=B.geometry;L==="Polygon"&&P.push(O),L==="MultiPolygon"&&P.push(...O)}if(P.length)return new wn(T,{type:"MultiPolygon",coordinates:P})}else if(T.type==="Feature"){const P=T.geometry.type;if(P==="Polygon"||P==="MultiPolygon")return new wn(T,T.geometry)}else if(T.type==="Polygon"||T.type==="MultiPolygon")return new wn(T,T)}return w.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(_){if(_.geometry()!=null&&_.canonicalID()!=null){if(_.geometryType()==="Point")return function(w,T){const P=[1/0,1/0,-1/0,-1/0],B=[1/0,1/0,-1/0,-1/0],L=w.canonicalID();if(T.type==="Polygon"){const O=Ws(T.coordinates,B,L),V=Zo(w.geometry(),P,B,L);if(!ws(P,B))return!1;for(const W of V)if(!Zs(W,O))return!1}if(T.type==="MultiPolygon"){const O=ka(T.coordinates,B,L),V=Zo(w.geometry(),P,B,L);if(!ws(P,B))return!1;for(const W of V)if(!qo(W,O))return!1}return!0}(_,this.geometries);if(_.geometryType()==="LineString")return function(w,T){const P=[1/0,1/0,-1/0,-1/0],B=[1/0,1/0,-1/0,-1/0],L=w.canonicalID();if(T.type==="Polygon"){const O=Ws(T.coordinates,B,L),V=Ks(w.geometry(),P,B,L);if(!ws(P,B))return!1;for(const W of V)if(!Ho(W,O))return!1}if(T.type==="MultiPolygon"){const O=ka(T.coordinates,B,L),V=Ks(w.geometry(),P,B,L);if(!ws(P,B))return!1;for(const W of V)if(!Yl(W,O))return!1}return!0}(_,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Xs{constructor(_,w){this.type=w.type,this.name=_,this.boundExpression=w}static parse(_,w){if(_.length!==2||typeof _[1]!="string")return w.error("'var' expression requires exactly one string literal argument.");const T=_[1];return w.scope.has(T)?new Xs(T,w.scope.get(T)):w.error(`Unknown variable "${T}". Make sure "${T}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(_){return this.boundExpression.evaluate(_)}eachChild(){}outputDefined(){return!1}}class gr{constructor(_,w,T,P){this.name=_,this.type=w,this._evaluate=T,this.args=P}evaluate(_){return this._evaluate(_,this.args)}eachChild(_){this.args.forEach(_)}outputDefined(){return!1}static parse(_,w){const T=_[0],P=gr.definitions[T];if(!P)return w.error(`Unknown expression "${T}". If you wanted a literal array, use ["literal", [...]].`,0);const B=Array.isArray(P)?P[0]:P.type,L=Array.isArray(P)?[[P[1],P[2]]]:P.overloads,O=L.filter(([W])=>!Array.isArray(W)||W.length===_.length-1);let V=null;for(const[W,X]of O){V=new Ot(w.registry,Ss,w.path,null,w.scope);const Y=[];let te=!1;for(let re=1;re<_.length;re++){const se=_[re],ue=Array.isArray(W)?W[re-1]:W.type,me=V.parse(se,1+Y.length,ue);if(!me){te=!0;break}Y.push(me)}if(!te)if(Array.isArray(W)&&W.length!==Y.length)V.error(`Expected ${W.length} arguments, but found ${Y.length} instead.`);else{for(let re=0;re<Y.length;re++){const se=Array.isArray(W)?W[re]:W.type,ue=Y[re];V.concat(re+1).checkSubtype(se,ue.type)}if(V.errors.length===0)return new gr(T,B,X,Y)}}if(O.length===1)w.errors.push(...V.errors);else{const W=(O.length?O:L).map(([Y])=>{return te=Y,Array.isArray(te)?`(${te.map(he).join(", ")})`:`(${he(te.type)}...)`;var te}).join(" | "),X=[];for(let Y=1;Y<_.length;Y++){const te=w.parse(_[Y],1+X.length);if(!te)return null;X.push(he(te.type))}w.error(`Expected arguments of type ${W}, but found (${X.join(", ")}) instead.`)}return null}static register(_,w){gr.definitions=w;for(const T in w)_[T]=gr}}function Ss(x){if(x instanceof Xs)return Ss(x.boundExpression);if(x instanceof gr&&x.name==="error"||x instanceof Gs||x instanceof wn)return!1;const _=x instanceof zr||x instanceof wr;let w=!0;return x.eachChild(T=>{w=_?w&&Ss(T):w&&T instanceof vn}),!!w&&Es(x)&&Ys(x,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Es(x){if(x instanceof gr&&(x.name==="get"&&x.args.length===1||x.name==="feature-state"||x.name==="has"&&x.args.length===1||x.name==="properties"||x.name==="geometry-type"||x.name==="id"||/^filter-/.test(x.name))||x instanceof wn)return!1;let _=!0;return x.eachChild(w=>{_&&!Es(w)&&(_=!1)}),_}function Ts(x){if(x instanceof gr&&x.name==="feature-state")return!1;let _=!0;return x.eachChild(w=>{_&&!Ts(w)&&(_=!1)}),_}function Ys(x,_){if(x instanceof gr&&_.indexOf(x.name)>=0)return!1;let w=!0;return x.eachChild(T=>{w&&!Ys(T,_)&&(w=!1)}),w}function As(x,_){const w=x.length-1;let T,P,B=0,L=w,O=0;for(;B<=L;)if(O=Math.floor((B+L)/2),T=x[O],P=x[O+1],T<=_){if(O===w||_<P)return O;B=O+1}else{if(!(T>_))throw new si("Input is not a number.");L=O-1}return 0}class Gn{constructor(_,w,T){this.type=_,this.input=w,this.labels=[],this.outputs=[];for(const[P,B]of T)this.labels.push(P),this.outputs.push(B)}static parse(_,w){if(_.length-1<4)return w.error(`Expected at least 4 arguments, but found only ${_.length-1}.`);if((_.length-1)%2!=0)return w.error("Expected an even number of arguments.");const T=w.parse(_[1],1,We);if(!T)return null;const P=[];let B=null;w.expectedType&&w.expectedType.kind!=="value"&&(B=w.expectedType);for(let L=1;L<_.length;L+=2){const O=L===1?-1/0:_[L],V=_[L+1],W=L,X=L+1;if(typeof O!="number")return w.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',W);if(P.length&&P[P.length-1][0]>=O)return w.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',W);const Y=w.parse(V,X,B);if(!Y)return null;B=B||Y.type,P.push([O,Y])}return new Gn(B,T,P)}evaluate(_){const w=this.labels,T=this.outputs;if(w.length===1)return T[0].evaluate(_);const P=this.input.evaluate(_);if(P<=w[0])return T[0].evaluate(_);const B=w.length;return P>=w[B-1]?T[B-1].evaluate(_):T[As(w,P)].evaluate(_)}eachChild(_){_(this.input);for(const w of this.outputs)_(w)}outputDefined(){return this.outputs.every(_=>_.outputDefined())}}function Jl(x){return x&&x.__esModule&&Object.prototype.hasOwnProperty.call(x,"default")?x.default:x}var Ql=Wo;function Wo(x,_,w,T){this.cx=3*x,this.bx=3*(w-x)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*_,this.by=3*(T-_)-this.cy,this.ay=1-this.cy-this.by,this.p1x=x,this.p1y=_,this.p2x=w,this.p2y=T}Wo.prototype={sampleCurveX:function(x){return((this.ax*x+this.bx)*x+this.cx)*x},sampleCurveY:function(x){return((this.ay*x+this.by)*x+this.cy)*x},sampleCurveDerivativeX:function(x){return(3*this.ax*x+2*this.bx)*x+this.cx},solveCurveX:function(x,_){if(_===void 0&&(_=1e-6),x<0)return 0;if(x>1)return 1;for(var w=x,T=0;T<8;T++){var P=this.sampleCurveX(w)-x;if(Math.abs(P)<_)return w;var B=this.sampleCurveDerivativeX(w);if(Math.abs(B)<1e-6)break;w-=P/B}var L=0,O=1;for(w=x,T=0;T<20&&(P=this.sampleCurveX(w),!(Math.abs(P-x)<_));T++)x>P?L=w:O=w,w=.5*(O-L)+L;return w},solve:function(x,_){return this.sampleCurveY(this.solveCurveX(x,_))}};var ec=Jl(Ql);function Sn(x,_,w){return x+w*(_-x)}function Js(x,_,w){return x.map((T,P)=>Sn(T,_[P],w))}const or={number:Sn,color:function(x,_,w,T="rgb"){switch(T){case"rgb":{const[P,B,L,O]=Js(x.rgb,_.rgb,w);return new Ut(P,B,L,O,!1)}case"hcl":{const[P,B,L,O]=x.hcl,[V,W,X,Y]=_.hcl;let te,re;if(isNaN(P)||isNaN(V))isNaN(P)?isNaN(V)?te=NaN:(te=V,L!==1&&L!==0||(re=W)):(te=P,X!==1&&X!==0||(re=B));else{let Me=V-P;V>P&&Me>180?Me-=360:V<P&&P-V>180&&(Me+=360),te=P+w*Me}const[se,ue,me,xe]=function([Me,ve,Ie,Oe]){return Me=isNaN(Me)?0:Me*kt,ti([Ie,Math.cos(Me)*ve,Math.sin(Me)*ve,Oe])}([te,re??Sn(B,W,w),Sn(L,X,w),Sn(O,Y,w)]);return new Ut(se,ue,me,xe,!1)}case"lab":{const[P,B,L,O]=ti(Js(x.lab,_.lab,w));return new Ut(P,B,L,O,!1)}}},array:Js,padding:function(x,_,w){return new ar(Js(x.values,_.values,w))},variableAnchorOffsetCollection:function(x,_,w){const T=x.values,P=_.values;if(T.length!==P.length)throw new si(`Cannot interpolate values of different length. from: ${x.toString()}, to: ${_.toString()}`);const B=[];for(let L=0;L<T.length;L+=2){if(T[L]!==P[L])throw new si(`Cannot interpolate values containing mismatched anchors. from[${L}]: ${T[L]}, to[${L}]: ${P[L]}`);B.push(T[L]);const[O,V]=T[L+1],[W,X]=P[L+1];B.push([Sn(O,W,w),Sn(V,X,w)])}return new Di(B)}};class Oi{constructor(_,w,T,P,B){this.type=_,this.operator=w,this.interpolation=T,this.input=P,this.labels=[],this.outputs=[];for(const[L,O]of B)this.labels.push(L),this.outputs.push(O)}static interpolationFactor(_,w,T,P){let B=0;if(_.name==="exponential")B=Zn(w,_.base,T,P);else if(_.name==="linear")B=Zn(w,1,T,P);else if(_.name==="cubic-bezier"){const L=_.controlPoints;B=new ec(L[0],L[1],L[2],L[3]).solve(Zn(w,1,T,P))}return B}static parse(_,w){let[T,P,B,...L]=_;if(!Array.isArray(P)||P.length===0)return w.error("Expected an interpolation type expression.",1);if(P[0]==="linear")P={name:"linear"};else if(P[0]==="exponential"){const W=P[1];if(typeof W!="number")return w.error("Exponential interpolation requires a numeric base.",1,1);P={name:"exponential",base:W}}else{if(P[0]!=="cubic-bezier")return w.error(`Unknown interpolation type ${String(P[0])}`,1,0);{const W=P.slice(1);if(W.length!==4||W.some(X=>typeof X!="number"||X<0||X>1))return w.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);P={name:"cubic-bezier",controlPoints:W}}}if(_.length-1<4)return w.error(`Expected at least 4 arguments, but found only ${_.length-1}.`);if((_.length-1)%2!=0)return w.error("Expected an even number of arguments.");if(B=w.parse(B,2,We),!B)return null;const O=[];let V=null;T==="interpolate-hcl"||T==="interpolate-lab"?V=Ai:w.expectedType&&w.expectedType.kind!=="value"&&(V=w.expectedType);for(let W=0;W<L.length;W+=2){const X=L[W],Y=L[W+1],te=W+3,re=W+4;if(typeof X!="number")return w.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',te);if(O.length&&O[O.length-1][0]>=X)return w.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',te);const se=w.parse(Y,re,V);if(!se)return null;V=V||se.type,O.push([X,se])}return Re(V,We)||Re(V,Ai)||Re(V,pe)||Re(V,ie)||Re(V,ae(We))?new Oi(V,T,P,B,O):w.error(`Type ${he(V)} is not interpolatable.`)}evaluate(_){const w=this.labels,T=this.outputs;if(w.length===1)return T[0].evaluate(_);const P=this.input.evaluate(_);if(P<=w[0])return T[0].evaluate(_);const B=w.length;if(P>=w[B-1])return T[B-1].evaluate(_);const L=As(w,P),O=Oi.interpolationFactor(this.interpolation,P,w[L],w[L+1]),V=T[L].evaluate(_),W=T[L+1].evaluate(_);switch(this.operator){case"interpolate":return or[this.type.kind](V,W,O);case"interpolate-hcl":return or.color(V,W,O,"hcl");case"interpolate-lab":return or.color(V,W,O,"lab")}}eachChild(_){_(this.input);for(const w of this.outputs)_(w)}outputDefined(){return this.outputs.every(_=>_.outputDefined())}}function Zn(x,_,w,T){const P=T-w,B=x-w;return P===0?0:_===1?B/P:(Math.pow(_,B)-1)/(Math.pow(_,P)-1)}class Bt{constructor(_,w){this.type=_,this.args=w}static parse(_,w){if(_.length<2)return w.error("Expectected at least one argument.");let T=null;const P=w.expectedType;P&&P.kind!=="value"&&(T=P);const B=[];for(const O of _.slice(1)){const V=w.parse(O,1+B.length,T,void 0,{typeAnnotation:"omit"});if(!V)return null;T=T||V.type,B.push(V)}if(!T)throw new Error("No output type");const L=P&&B.some(O=>Ae(P,O.type));return new Bt(L?wt:T,B)}evaluate(_){let w,T=null,P=0;for(const B of this.args)if(P++,T=B.evaluate(_),T&&T instanceof mr&&!T.available&&(w||(w=T.name),T=null,P===this.args.length&&(T=w)),T!==null)break;return T}eachChild(_){this.args.forEach(_)}outputDefined(){return this.args.every(_=>_.outputDefined())}}class Qs{constructor(_,w){this.type=w.type,this.bindings=[].concat(_),this.result=w}evaluate(_){return this.result.evaluate(_)}eachChild(_){for(const w of this.bindings)_(w[1]);_(this.result)}static parse(_,w){if(_.length<4)return w.error(`Expected at least 3 arguments, but found ${_.length-1} instead.`);const T=[];for(let B=1;B<_.length-1;B+=2){const L=_[B];if(typeof L!="string")return w.error(`Expected string, but found ${typeof L} instead.`,B);if(/[^a-zA-Z0-9_]/.test(L))return w.error("Variable names must contain only alphanumeric characters or '_'.",B);const O=w.parse(_[B+1],B+1);if(!O)return null;T.push([L,O])}const P=w.parse(_[_.length-1],_.length-1,w.expectedType,T);return P?new Qs(T,P):null}outputDefined(){return this.result.outputDefined()}}class za{constructor(_,w,T){this.type=_,this.index=w,this.input=T}static parse(_,w){if(_.length!==3)return w.error(`Expected 2 arguments, but found ${_.length-1} instead.`);const T=w.parse(_[1],1,We),P=w.parse(_[2],2,ae(w.expectedType||wt));return T&&P?new za(P.type.itemType,T,P):null}evaluate(_){const w=this.index.evaluate(_),T=this.input.evaluate(_);if(w<0)throw new si(`Array index out of bounds: ${w} < 0.`);if(w>=T.length)throw new si(`Array index out of bounds: ${w} > ${T.length-1}.`);if(w!==Math.floor(w))throw new si(`Array index must be an integer, but found ${w} instead.`);return T[w]}eachChild(_){_(this.index),_(this.input)}outputDefined(){return!1}}class Ba{constructor(_,w){this.type=bt,this.needle=_,this.haystack=w}static parse(_,w){if(_.length!==3)return w.error(`Expected 2 arguments, but found ${_.length-1} instead.`);const T=w.parse(_[1],1,wt),P=w.parse(_[2],2,wt);return T&&P?Pe(T.type,[bt,Tt,We,xn,wt])?new Ba(T,P):w.error(`Expected first argument to be of type boolean, string, number or null, but found ${he(T.type)} instead`):null}evaluate(_){const w=this.needle.evaluate(_),T=this.haystack.evaluate(_);if(!T)return!1;if(!be(w,["boolean","string","number","null"]))throw new si(`Expected first argument to be of type boolean, string, number or null, but found ${he(di(w))} instead.`);if(!be(T,["string","array"]))throw new si(`Expected second argument to be of type array or string, but found ${he(di(T))} instead.`);return T.indexOf(w)>=0}eachChild(_){_(this.needle),_(this.haystack)}outputDefined(){return!0}}class ea{constructor(_,w,T){this.type=We,this.needle=_,this.haystack=w,this.fromIndex=T}static parse(_,w){if(_.length<=2||_.length>=5)return w.error(`Expected 3 or 4 arguments, but found ${_.length-1} instead.`);const T=w.parse(_[1],1,wt),P=w.parse(_[2],2,wt);if(!T||!P)return null;if(!Pe(T.type,[bt,Tt,We,xn,wt]))return w.error(`Expected first argument to be of type boolean, string, number or null, but found ${he(T.type)} instead`);if(_.length===4){const B=w.parse(_[3],3,We);return B?new ea(T,P,B):null}return new ea(T,P)}evaluate(_){const w=this.needle.evaluate(_),T=this.haystack.evaluate(_);if(!be(w,["boolean","string","number","null"]))throw new si(`Expected first argument to be of type boolean, string, number or null, but found ${he(di(w))} instead.`);if(!be(T,["string","array"]))throw new si(`Expected second argument to be of type array or string, but found ${he(di(T))} instead.`);if(this.fromIndex){const P=this.fromIndex.evaluate(_);return T.indexOf(w,P)}return T.indexOf(w)}eachChild(_){_(this.needle),_(this.haystack),this.fromIndex&&_(this.fromIndex)}outputDefined(){return!1}}class La{constructor(_,w,T,P,B,L){this.inputType=_,this.type=w,this.input=T,this.cases=P,this.outputs=B,this.otherwise=L}static parse(_,w){if(_.length<5)return w.error(`Expected at least 4 arguments, but found only ${_.length-1}.`);if(_.length%2!=1)return w.error("Expected an even number of arguments.");let T,P;w.expectedType&&w.expectedType.kind!=="value"&&(P=w.expectedType);const B={},L=[];for(let W=2;W<_.length-1;W+=2){let X=_[W];const Y=_[W+1];Array.isArray(X)||(X=[X]);const te=w.concat(W);if(X.length===0)return te.error("Expected at least one branch label.");for(const se of X){if(typeof se!="number"&&typeof se!="string")return te.error("Branch labels must be numbers or strings.");if(typeof se=="number"&&Math.abs(se)>Number.MAX_SAFE_INTEGER)return te.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof se=="number"&&Math.floor(se)!==se)return te.error("Numeric branch labels must be integer values.");if(T){if(te.checkSubtype(T,di(se)))return null}else T=di(se);if(B[String(se)]!==void 0)return te.error("Branch labels must be unique.");B[String(se)]=L.length}const re=w.parse(Y,W,P);if(!re)return null;P=P||re.type,L.push(re)}const O=w.parse(_[1],1,wt);if(!O)return null;const V=w.parse(_[_.length-1],_.length-1,P);return V?O.type.kind!=="value"&&w.concat(1).checkSubtype(T,O.type)?null:new La(T,P,O,B,L,V):null}evaluate(_){const w=this.input.evaluate(_);return(di(w)===this.inputType&&this.outputs[this.cases[w]]||this.otherwise).evaluate(_)}eachChild(_){_(this.input),this.outputs.forEach(_),_(this.otherwise)}outputDefined(){return this.outputs.every(_=>_.outputDefined())&&this.otherwise.outputDefined()}}class Fa{constructor(_,w,T){this.type=_,this.branches=w,this.otherwise=T}static parse(_,w){if(_.length<4)return w.error(`Expected at least 3 arguments, but found only ${_.length-1}.`);if(_.length%2!=0)return w.error("Expected an odd number of arguments.");let T;w.expectedType&&w.expectedType.kind!=="value"&&(T=w.expectedType);const P=[];for(let L=1;L<_.length-1;L+=2){const O=w.parse(_[L],L,bt);if(!O)return null;const V=w.parse(_[L+1],L+1,T);if(!V)return null;P.push([O,V]),T=T||V.type}const B=w.parse(_[_.length-1],_.length-1,T);if(!B)return null;if(!T)throw new Error("Can't infer output type");return new Fa(T,P,B)}evaluate(_){for(const[w,T]of this.branches)if(w.evaluate(_))return T.evaluate(_);return this.otherwise.evaluate(_)}eachChild(_){for(const[w,T]of this.branches)_(w),_(T);_(this.otherwise)}outputDefined(){return this.branches.every(([_,w])=>w.outputDefined())&&this.otherwise.outputDefined()}}class ta{constructor(_,w,T,P){this.type=_,this.input=w,this.beginIndex=T,this.endIndex=P}static parse(_,w){if(_.length<=2||_.length>=5)return w.error(`Expected 3 or 4 arguments, but found ${_.length-1} instead.`);const T=w.parse(_[1],1,wt),P=w.parse(_[2],2,We);if(!T||!P)return null;if(!Pe(T.type,[ae(wt),Tt,wt]))return w.error(`Expected first argument to be of type array or string, but found ${he(T.type)} instead`);if(_.length===4){const B=w.parse(_[3],3,We);return B?new ta(T.type,T,P,B):null}return new ta(T.type,T,P)}evaluate(_){const w=this.input.evaluate(_),T=this.beginIndex.evaluate(_);if(!be(w,["string","array"]))throw new si(`Expected first argument to be of type array or string, but found ${he(di(w))} instead.`);if(this.endIndex){const P=this.endIndex.evaluate(_);return w.slice(T,P)}return w.slice(T)}eachChild(_){_(this.input),_(this.beginIndex),this.endIndex&&_(this.endIndex)}outputDefined(){return!1}}function Ko(x,_){return x==="=="||x==="!="?_.kind==="boolean"||_.kind==="string"||_.kind==="number"||_.kind==="null"||_.kind==="value":_.kind==="string"||_.kind==="number"||_.kind==="value"}function Xo(x,_,w,T){return T.compare(_,w)===0}function Wn(x,_,w){const T=x!=="=="&&x!=="!=";return class Ah{constructor(B,L,O){this.type=bt,this.lhs=B,this.rhs=L,this.collator=O,this.hasUntypedArgument=B.type.kind==="value"||L.type.kind==="value"}static parse(B,L){if(B.length!==3&&B.length!==4)return L.error("Expected two or three arguments.");const O=B[0];let V=L.parse(B[1],1,wt);if(!V)return null;if(!Ko(O,V.type))return L.concat(1).error(`"${O}" comparisons are not supported for type '${he(V.type)}'.`);let W=L.parse(B[2],2,wt);if(!W)return null;if(!Ko(O,W.type))return L.concat(2).error(`"${O}" comparisons are not supported for type '${he(W.type)}'.`);if(V.type.kind!==W.type.kind&&V.type.kind!=="value"&&W.type.kind!=="value")return L.error(`Cannot compare types '${he(V.type)}' and '${he(W.type)}'.`);T&&(V.type.kind==="value"&&W.type.kind!=="value"?V=new wr(W.type,[V]):V.type.kind!=="value"&&W.type.kind==="value"&&(W=new wr(V.type,[W])));let X=null;if(B.length===4){if(V.type.kind!=="string"&&W.type.kind!=="string"&&V.type.kind!=="value"&&W.type.kind!=="value")return L.error("Cannot use collator to compare non-string types.");if(X=L.parse(B[3],3,nn),!X)return null}return new Ah(V,W,X)}evaluate(B){const L=this.lhs.evaluate(B),O=this.rhs.evaluate(B);if(T&&this.hasUntypedArgument){const V=di(L),W=di(O);if(V.kind!==W.kind||V.kind!=="string"&&V.kind!=="number")throw new si(`Expected arguments for "${x}" to be (string, string) or (number, number), but found (${V.kind}, ${W.kind}) instead.`)}if(this.collator&&!T&&this.hasUntypedArgument){const V=di(L),W=di(O);if(V.kind!=="string"||W.kind!=="string")return _(B,L,O)}return this.collator?w(B,L,O,this.collator.evaluate(B)):_(B,L,O)}eachChild(B){B(this.lhs),B(this.rhs),this.collator&&B(this.collator)}outputDefined(){return!0}}}const tc=Wn("==",function(x,_,w){return _===w},Xo),ic=Wn("!=",function(x,_,w){return _!==w},function(x,_,w,T){return!Xo(0,_,w,T)}),rc=Wn("<",function(x,_,w){return _<w},function(x,_,w,T){return T.compare(_,w)<0}),nc=Wn(">",function(x,_,w){return _>w},function(x,_,w,T){return T.compare(_,w)>0}),sc=Wn("<=",function(x,_,w){return _<=w},function(x,_,w,T){return T.compare(_,w)<=0}),ac=Wn(">=",function(x,_,w){return _>=w},function(x,_,w,T){return T.compare(_,w)>=0});class Oa{constructor(_,w,T,P,B){this.type=Tt,this.number=_,this.locale=w,this.currency=T,this.minFractionDigits=P,this.maxFractionDigits=B}static parse(_,w){if(_.length!==3)return w.error("Expected two arguments.");const T=w.parse(_[1],1,We);if(!T)return null;const P=_[2];if(typeof P!="object"||Array.isArray(P))return w.error("NumberFormat options argument must be an object.");let B=null;if(P.locale&&(B=w.parse(P.locale,1,Tt),!B))return null;let L=null;if(P.currency&&(L=w.parse(P.currency,1,Tt),!L))return null;let O=null;if(P["min-fraction-digits"]&&(O=w.parse(P["min-fraction-digits"],1,We),!O))return null;let V=null;return P["max-fraction-digits"]&&(V=w.parse(P["max-fraction-digits"],1,We),!V)?null:new Oa(T,B,L,O,V)}evaluate(_){return new Intl.NumberFormat(this.locale?this.locale.evaluate(_):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(_):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(_):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(_):void 0}).format(this.number.evaluate(_))}eachChild(_){_(this.number),this.locale&&_(this.locale),this.currency&&_(this.currency),this.minFractionDigits&&_(this.minFractionDigits),this.maxFractionDigits&&_(this.maxFractionDigits)}outputDefined(){return!1}}class ia{constructor(_){this.type=jr,this.sections=_}static parse(_,w){if(_.length<2)return w.error("Expected at least one argument.");const T=_[1];if(!Array.isArray(T)&&typeof T=="object")return w.error("First argument must be an image or text section.");const P=[];let B=!1;for(let L=1;L<=_.length-1;++L){const O=_[L];if(B&&typeof O=="object"&&!Array.isArray(O)){B=!1;let V=null;if(O["font-scale"]&&(V=w.parse(O["font-scale"],1,We),!V))return null;let W=null;if(O["text-font"]&&(W=w.parse(O["text-font"],1,ae(Tt)),!W))return null;let X=null;if(O["text-color"]&&(X=w.parse(O["text-color"],1,Ai),!X))return null;const Y=P[P.length-1];Y.scale=V,Y.font=W,Y.textColor=X}else{const V=w.parse(_[L],1,wt);if(!V)return null;const W=V.type.kind;if(W!=="string"&&W!=="value"&&W!=="null"&&W!=="resolvedImage")return w.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");B=!0,P.push({content:V,scale:null,font:null,textColor:null})}}return new ia(P)}evaluate(_){return new sr(this.sections.map(w=>{const T=w.content.evaluate(_);return di(T)===ee?new Ma("",T,null,null,null):new Ma(bs(T),null,w.scale?w.scale.evaluate(_):null,w.font?w.font.evaluate(_).join(","):null,w.textColor?w.textColor.evaluate(_):null)}))}eachChild(_){for(const w of this.sections)_(w.content),w.scale&&_(w.scale),w.font&&_(w.font),w.textColor&&_(w.textColor)}outputDefined(){return!1}}class $a{constructor(_){this.type=ee,this.input=_}static parse(_,w){if(_.length!==2)return w.error("Expected two arguments.");const T=w.parse(_[1],1,Tt);return T?new $a(T):w.error("No image name provided.")}evaluate(_){const w=this.input.evaluate(_),T=mr.fromString(w);return T&&_.availableImages&&(T.available=_.availableImages.indexOf(w)>-1),T}eachChild(_){_(this.input)}outputDefined(){return!1}}class Na{constructor(_){this.type=We,this.input=_}static parse(_,w){if(_.length!==2)return w.error(`Expected 1 argument, but found ${_.length-1} instead.`);const T=w.parse(_[1],1);return T?T.type.kind!=="array"&&T.type.kind!=="string"&&T.type.kind!=="value"?w.error(`Expected argument of type string or array, but found ${he(T.type)} instead.`):new Na(T):null}evaluate(_){const w=this.input.evaluate(_);if(typeof w=="string"||Array.isArray(w))return w.length;throw new si(`Expected value to be of type string or array, but found ${he(di(w))} instead.`)}eachChild(_){_(this.input)}outputDefined(){return!1}}const Kn={"==":tc,"!=":ic,">":nc,"<":rc,">=":ac,"<=":sc,array:wr,at:za,boolean:wr,case:Fa,coalesce:Bt,collator:Gs,format:ia,image:$a,in:Ba,"index-of":ea,interpolate:Oi,"interpolate-hcl":Oi,"interpolate-lab":Oi,length:Na,let:Qs,literal:vn,match:La,number:wr,"number-format":Oa,object:wr,slice:ta,step:Gn,string:wr,"to-boolean":zr,"to-color":zr,"to-number":zr,"to-string":zr,var:Xs,within:wn};function Yo(x,[_,w,T,P]){_=_.evaluate(x),w=w.evaluate(x),T=T.evaluate(x);const B=P?P.evaluate(x):1,L=Uo(_,w,T,B);if(L)throw new si(L);return new Ut(_/255,w/255,T/255,B,!1)}function Jo(x,_){return x in _}function Ua(x,_){const w=_[x];return w===void 0?null:w}function En(x){return{type:x}}function Qo(x){return{result:"success",value:x}}function Xn(x){return{result:"error",value:x}}function Yn(x){return x["property-type"]==="data-driven"||x["property-type"]==="cross-faded-data-driven"}function el(x){return!!x.expression&&x.expression.parameters.indexOf("zoom")>-1}function Va(x){return!!x.expression&&x.expression.interpolated}function Lt(x){return x instanceof Number?"number":x instanceof String?"string":x instanceof Boolean?"boolean":Array.isArray(x)?"array":x===null?"null":typeof x}function Jn(x){return typeof x=="object"&&x!==null&&!Array.isArray(x)}function oc(x){return x}function tl(x,_){const w=_.type==="color",T=x.stops&&typeof x.stops[0][0]=="object",P=T||!(T||x.property!==void 0),B=x.type||(Va(_)?"exponential":"interval");if(w||_.type==="padding"){const X=w?Ut.parse:ar.parse;(x=rr({},x)).stops&&(x.stops=x.stops.map(Y=>[Y[0],X(Y[1])])),x.default=X(x.default?x.default:_.default)}if(x.colorSpace&&(L=x.colorSpace)!=="rgb"&&L!=="hcl"&&L!=="lab")throw new Error(`Unknown color space: "${x.colorSpace}"`);var L;let O,V,W;if(B==="exponential")O=il;else if(B==="interval")O=ci;else if(B==="categorical"){O=lc,V=Object.create(null);for(const X of x.stops)V[X[0]]=X[1];W=typeof x.stops[0][0]}else{if(B!=="identity")throw new Error(`Unknown function type "${B}"`);O=zt}if(T){const X={},Y=[];for(let se=0;se<x.stops.length;se++){const ue=x.stops[se],me=ue[0].zoom;X[me]===void 0&&(X[me]={zoom:me,type:x.type,property:x.property,default:x.default,stops:[]},Y.push(me)),X[me].stops.push([ue[0].value,ue[1]])}const te=[];for(const se of Y)te.push([X[se].zoom,tl(X[se],_)]);const re={name:"linear"};return{kind:"composite",interpolationType:re,interpolationFactor:Oi.interpolationFactor.bind(void 0,re),zoomStops:te.map(se=>se[0]),evaluate:({zoom:se},ue)=>il({stops:te,base:x.base},_,se).evaluate(se,ue)}}if(P){const X=B==="exponential"?{name:"exponential",base:x.base!==void 0?x.base:1}:null;return{kind:"camera",interpolationType:X,interpolationFactor:Oi.interpolationFactor.bind(void 0,X),zoomStops:x.stops.map(Y=>Y[0]),evaluate:({zoom:Y})=>O(x,_,Y,V,W)}}return{kind:"source",evaluate(X,Y){const te=Y&&Y.properties?Y.properties[x.property]:void 0;return te===void 0?Is(x.default,_.default):O(x,_,te,V,W)}}}function Is(x,_,w){return x!==void 0?x:_!==void 0?_:w!==void 0?w:void 0}function lc(x,_,w,T,P){return Is(typeof w===P?T[w]:void 0,x.default,_.default)}function ci(x,_,w){if(Lt(w)!=="number")return Is(x.default,_.default);const T=x.stops.length;if(T===1||w<=x.stops[0][0])return x.stops[0][1];if(w>=x.stops[T-1][0])return x.stops[T-1][1];const P=As(x.stops.map(B=>B[0]),w);return x.stops[P][1]}function il(x,_,w){const T=x.base!==void 0?x.base:1;if(Lt(w)!=="number")return Is(x.default,_.default);const P=x.stops.length;if(P===1||w<=x.stops[0][0])return x.stops[0][1];if(w>=x.stops[P-1][0])return x.stops[P-1][1];const B=As(x.stops.map(X=>X[0]),w),L=function(X,Y,te,re){const se=re-te,ue=X-te;return se===0?0:Y===1?ue/se:(Math.pow(Y,ue)-1)/(Math.pow(Y,se)-1)}(w,T,x.stops[B][0],x.stops[B+1][0]),O=x.stops[B][1],V=x.stops[B+1][1],W=or[_.type]||oc;return typeof O.evaluate=="function"?{evaluate(...X){const Y=O.evaluate.apply(void 0,X),te=V.evaluate.apply(void 0,X);if(Y!==void 0&&te!==void 0)return W(Y,te,L,x.colorSpace)}}:W(O,V,L,x.colorSpace)}function zt(x,_,w){switch(_.type){case"color":w=Ut.parse(w);break;case"formatted":w=sr.fromString(w.toString());break;case"resolvedImage":w=mr.fromString(w.toString());break;case"padding":w=ar.parse(w);break;default:Lt(w)===_.type||_.type==="enum"&&_.values[w]||(w=void 0)}return Is(w,x.default,_.default)}gr.register(Kn,{error:[{kind:"error"},[Tt],(x,[_])=>{throw new si(_.evaluate(x))}],typeof:[Tt,[wt],(x,[_])=>he(di(_.evaluate(x)))],"to-rgba":[ae(We,4),[Ai],(x,[_])=>{const[w,T,P,B]=_.evaluate(x).rgb;return[255*w,255*T,255*P,B]}],rgb:[Ai,[We,We,We],Yo],rgba:[Ai,[We,We,We,We],Yo],has:{type:bt,overloads:[[[Tt],(x,[_])=>Jo(_.evaluate(x),x.properties())],[[Tt,fr],(x,[_,w])=>Jo(_.evaluate(x),w.evaluate(x))]]},get:{type:wt,overloads:[[[Tt],(x,[_])=>Ua(_.evaluate(x),x.properties())],[[Tt,fr],(x,[_,w])=>Ua(_.evaluate(x),w.evaluate(x))]]},"feature-state":[wt,[Tt],(x,[_])=>Ua(_.evaluate(x),x.featureState||{})],properties:[fr,[],x=>x.properties()],"geometry-type":[Tt,[],x=>x.geometryType()],id:[wt,[],x=>x.id()],zoom:[We,[],x=>x.globals.zoom],"heatmap-density":[We,[],x=>x.globals.heatmapDensity||0],"line-progress":[We,[],x=>x.globals.lineProgress||0],accumulated:[wt,[],x=>x.globals.accumulated===void 0?null:x.globals.accumulated],"+":[We,En(We),(x,_)=>{let w=0;for(const T of _)w+=T.evaluate(x);return w}],"*":[We,En(We),(x,_)=>{let w=1;for(const T of _)w*=T.evaluate(x);return w}],"-":{type:We,overloads:[[[We,We],(x,[_,w])=>_.evaluate(x)-w.evaluate(x)],[[We],(x,[_])=>-_.evaluate(x)]]},"/":[We,[We,We],(x,[_,w])=>_.evaluate(x)/w.evaluate(x)],"%":[We,[We,We],(x,[_,w])=>_.evaluate(x)%w.evaluate(x)],ln2:[We,[],()=>Math.LN2],pi:[We,[],()=>Math.PI],e:[We,[],()=>Math.E],"^":[We,[We,We],(x,[_,w])=>Math.pow(_.evaluate(x),w.evaluate(x))],sqrt:[We,[We],(x,[_])=>Math.sqrt(_.evaluate(x))],log10:[We,[We],(x,[_])=>Math.log(_.evaluate(x))/Math.LN10],ln:[We,[We],(x,[_])=>Math.log(_.evaluate(x))],log2:[We,[We],(x,[_])=>Math.log(_.evaluate(x))/Math.LN2],sin:[We,[We],(x,[_])=>Math.sin(_.evaluate(x))],cos:[We,[We],(x,[_])=>Math.cos(_.evaluate(x))],tan:[We,[We],(x,[_])=>Math.tan(_.evaluate(x))],asin:[We,[We],(x,[_])=>Math.asin(_.evaluate(x))],acos:[We,[We],(x,[_])=>Math.acos(_.evaluate(x))],atan:[We,[We],(x,[_])=>Math.atan(_.evaluate(x))],min:[We,En(We),(x,_)=>Math.min(..._.map(w=>w.evaluate(x)))],max:[We,En(We),(x,_)=>Math.max(..._.map(w=>w.evaluate(x)))],abs:[We,[We],(x,[_])=>Math.abs(_.evaluate(x))],round:[We,[We],(x,[_])=>{const w=_.evaluate(x);return w<0?-Math.round(-w):Math.round(w)}],floor:[We,[We],(x,[_])=>Math.floor(_.evaluate(x))],ceil:[We,[We],(x,[_])=>Math.ceil(_.evaluate(x))],"filter-==":[bt,[Tt,wt],(x,[_,w])=>x.properties()[_.value]===w.value],"filter-id-==":[bt,[wt],(x,[_])=>x.id()===_.value],"filter-type-==":[bt,[Tt],(x,[_])=>x.geometryType()===_.value],"filter-<":[bt,[Tt,wt],(x,[_,w])=>{const T=x.properties()[_.value],P=w.value;return typeof T==typeof P&&T<P}],"filter-id-<":[bt,[wt],(x,[_])=>{const w=x.id(),T=_.value;return typeof w==typeof T&&w<T}],"filter->":[bt,[Tt,wt],(x,[_,w])=>{const T=x.properties()[_.value],P=w.value;return typeof T==typeof P&&T>P}],"filter-id->":[bt,[wt],(x,[_])=>{const w=x.id(),T=_.value;return typeof w==typeof T&&w>T}],"filter-<=":[bt,[Tt,wt],(x,[_,w])=>{const T=x.properties()[_.value],P=w.value;return typeof T==typeof P&&T<=P}],"filter-id-<=":[bt,[wt],(x,[_])=>{const w=x.id(),T=_.value;return typeof w==typeof T&&w<=T}],"filter->=":[bt,[Tt,wt],(x,[_,w])=>{const T=x.properties()[_.value],P=w.value;return typeof T==typeof P&&T>=P}],"filter-id->=":[bt,[wt],(x,[_])=>{const w=x.id(),T=_.value;return typeof w==typeof T&&w>=T}],"filter-has":[bt,[wt],(x,[_])=>_.value in x.properties()],"filter-has-id":[bt,[],x=>x.id()!==null&&x.id()!==void 0],"filter-type-in":[bt,[ae(Tt)],(x,[_])=>_.value.indexOf(x.geometryType())>=0],"filter-id-in":[bt,[ae(wt)],(x,[_])=>_.value.indexOf(x.id())>=0],"filter-in-small":[bt,[Tt,ae(wt)],(x,[_,w])=>w.value.indexOf(x.properties()[_.value])>=0],"filter-in-large":[bt,[Tt,ae(wt)],(x,[_,w])=>function(T,P,B,L){for(;B<=L;){const O=B+L>>1;if(P[O]===T)return!0;P[O]>T?L=O-1:B=O+1}return!1}(x.properties()[_.value],w.value,0,w.value.length-1)],all:{type:bt,overloads:[[[bt,bt],(x,[_,w])=>_.evaluate(x)&&w.evaluate(x)],[En(bt),(x,_)=>{for(const w of _)if(!w.evaluate(x))return!1;return!0}]]},any:{type:bt,overloads:[[[bt,bt],(x,[_,w])=>_.evaluate(x)||w.evaluate(x)],[En(bt),(x,_)=>{for(const w of _)if(w.evaluate(x))return!0;return!1}]]},"!":[bt,[bt],(x,[_])=>!_.evaluate(x)],"is-supported-script":[bt,[Tt],(x,[_])=>{const w=x.globals&&x.globals.isSupportedScript;return!w||w(_.evaluate(x))}],upcase:[Tt,[Tt],(x,[_])=>_.evaluate(x).toUpperCase()],downcase:[Tt,[Tt],(x,[_])=>_.evaluate(x).toLowerCase()],concat:[Tt,En(wt),(x,_)=>_.map(w=>bs(w.evaluate(x))).join("")],"resolved-locale":[Tt,[nn],(x,[_])=>_.evaluate(x).resolvedLocale()]});class Cs{constructor(_,w){var T;this.expression=_,this._warningHistory={},this._evaluator=new Hn,this._defaultValue=w?(T=w).type==="color"&&Jn(T.default)?new Ut(0,0,0,0):T.type==="color"?Ut.parse(T.default)||null:T.type==="padding"?ar.parse(T.default)||null:T.type==="variableAnchorOffsetCollection"?Di.parse(T.default)||null:T.default===void 0?null:T.default:null,this._enumValues=w&&w.type==="enum"?w.values:null}evaluateWithoutErrorHandling(_,w,T,P,B,L){return this._evaluator.globals=_,this._evaluator.feature=w,this._evaluator.featureState=T,this._evaluator.canonical=P,this._evaluator.availableImages=B||null,this._evaluator.formattedSection=L,this.expression.evaluate(this._evaluator)}evaluate(_,w,T,P,B,L){this._evaluator.globals=_,this._evaluator.feature=w||null,this._evaluator.featureState=T||null,this._evaluator.canonical=P,this._evaluator.availableImages=B||null,this._evaluator.formattedSection=L||null;try{const O=this.expression.evaluate(this._evaluator);if(O==null||typeof O=="number"&&O!=O)return this._defaultValue;if(this._enumValues&&!(O in this._enumValues))throw new si(`Expected value to be one of ${Object.keys(this._enumValues).map(V=>JSON.stringify(V)).join(", ")}, but found ${JSON.stringify(O)} instead.`);return O}catch(O){return this._warningHistory[O.message]||(this._warningHistory[O.message]=!0,typeof console<"u"&&console.warn(O.message)),this._defaultValue}}}function Gt(x){return Array.isArray(x)&&x.length>0&&typeof x[0]=="string"&&x[0]in Kn}function jt(x,_){const w=new Ot(Kn,Ss,[],_?function(P){const B={color:Ai,string:Tt,number:We,enum:Tt,boolean:bt,formatted:jr,padding:pe,resolvedImage:ee,variableAnchorOffsetCollection:ie};return P.type==="array"?ae(B[P.value]||wt,P.length):B[P.type]}(_):void 0),T=w.parse(x,void 0,void 0,void 0,_&&_.type==="string"?{typeAnnotation:"coerce"}:void 0);return T?Qo(new Cs(T,_)):Xn(w.errors)}class Qn{constructor(_,w){this.kind=_,this._styleExpression=w,this.isStateDependent=_!=="constant"&&!Ts(w.expression)}evaluateWithoutErrorHandling(_,w,T,P,B,L){return this._styleExpression.evaluateWithoutErrorHandling(_,w,T,P,B,L)}evaluate(_,w,T,P,B,L){return this._styleExpression.evaluate(_,w,T,P,B,L)}}class ra{constructor(_,w,T,P){this.kind=_,this.zoomStops=T,this._styleExpression=w,this.isStateDependent=_!=="camera"&&!Ts(w.expression),this.interpolationType=P}evaluateWithoutErrorHandling(_,w,T,P,B,L){return this._styleExpression.evaluateWithoutErrorHandling(_,w,T,P,B,L)}evaluate(_,w,T,P,B,L){return this._styleExpression.evaluate(_,w,T,P,B,L)}interpolationFactor(_,w,T){return this.interpolationType?Oi.interpolationFactor(this.interpolationType,_,w,T):0}}function rl(x,_){const w=jt(x,_);if(w.result==="error")return w;const T=w.value.expression,P=Es(T);if(!P&&!Yn(_))return Xn([new Gi("","data expressions not supported")]);const B=Ys(T,["zoom"]);if(!B&&!el(_))return Xn([new Gi("","zoom expressions not supported")]);const L=sa(T);return L||B?L instanceof Gi?Xn([L]):L instanceof Oi&&!Va(_)?Xn([new Gi("",'"interpolate" expressions cannot be used with this property')]):Qo(L?new ra(P?"camera":"composite",w.value,L.labels,L instanceof Oi?L.interpolation:void 0):new Qn(P?"constant":"source",w.value)):Xn([new Gi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class na{constructor(_,w){this._parameters=_,this._specification=w,rr(this,tl(this._parameters,this._specification))}static deserialize(_){return new na(_._parameters,_._specification)}static serialize(_){return{_parameters:_._parameters,_specification:_._specification}}}function sa(x){let _=null;if(x instanceof Qs)_=sa(x.result);else if(x instanceof Bt){for(const w of x.args)if(_=sa(w),_)break}else(x instanceof Gn||x instanceof Oi)&&x.input instanceof gr&&x.input.name==="zoom"&&(_=x);return _ instanceof Gi||x.eachChild(w=>{const T=sa(w);T instanceof Gi?_=T:!_&&T?_=new Gi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):_&&T&&_!==T&&(_=new Gi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),_}function qa(x){if(x===!0||x===!1)return!0;if(!Array.isArray(x)||x.length===0)return!1;switch(x[0]){case"has":return x.length>=2&&x[1]!=="$id"&&x[1]!=="$type";case"in":return x.length>=3&&(typeof x[1]!="string"||Array.isArray(x[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return x.length!==3||Array.isArray(x[1])||Array.isArray(x[2]);case"any":case"all":for(const _ of x.slice(1))if(!qa(_)&&typeof _!="boolean")return!1;return!0;default:return!0}}const nl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function aa(x){if(x==null)return{filter:()=>!0,needGeometry:!1};qa(x)||(x=es(x));const _=jt(x,nl);if(_.result==="error")throw new Error(_.value.map(w=>`${w.key}: ${w.message}`).join(", "));return{filter:(w,T,P)=>_.value.evaluate(w,T,{},P),needGeometry:ja(x)}}function sl(x,_){return x<_?-1:x>_?1:0}function ja(x){if(!Array.isArray(x))return!1;if(x[0]==="within")return!0;for(let _=1;_<x.length;_++)if(ja(x[_]))return!0;return!1}function es(x){if(!x)return!0;const _=x[0];return x.length<=1?_!=="any":_==="=="?Ha(x[1],x[2],"=="):_==="!="?oa(Ha(x[1],x[2],"==")):_==="<"||_===">"||_==="<="||_===">="?Ha(x[1],x[2],_):_==="any"?(w=x.slice(1),["any"].concat(w.map(es))):_==="all"?["all"].concat(x.slice(1).map(es)):_==="none"?["all"].concat(x.slice(1).map(es).map(oa)):_==="in"?al(x[1],x.slice(2)):_==="!in"?oa(al(x[1],x.slice(2))):_==="has"?ol(x[1]):_==="!has"?oa(ol(x[1])):_!=="within"||x;var w}function Ha(x,_,w){switch(x){case"$type":return[`filter-type-${w}`,_];case"$id":return[`filter-id-${w}`,_];default:return[`filter-${w}`,x,_]}}function al(x,_){if(_.length===0)return!1;switch(x){case"$type":return["filter-type-in",["literal",_]];case"$id":return["filter-id-in",["literal",_]];default:return _.length>200&&!_.some(w=>typeof w!=typeof _[0])?["filter-in-large",x,["literal",_.sort(sl)]]:["filter-in-small",x,["literal",_]]}}function ol(x){switch(x){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",x]}}function oa(x){return["!",x]}function Ga(x){const _=typeof x;if(_==="number"||_==="boolean"||_==="string"||x==null)return JSON.stringify(x);if(Array.isArray(x)){let P="[";for(const B of x)P+=`${Ga(B)},`;return`${P}]`}const w=Object.keys(x).sort();let T="{";for(let P=0;P<w.length;P++)T+=`${JSON.stringify(w[P])}:${Ga(x[w[P]])},`;return`${T}}`}function cc(x){let _="";for(const w of _n)_+=`/${Ga(x[w])}`;return _}function ll(x){const _=x.value;return _?[new Ye(x.key,_,"constants have been deprecated as of v8")]:[]}function ai(x){return x instanceof Number||x instanceof String||x instanceof Boolean?x.valueOf():x}function an(x){if(Array.isArray(x))return x.map(an);if(x instanceof Object&&!(x instanceof Number||x instanceof String||x instanceof Boolean)){const _={};for(const w in x)_[w]=an(x[w]);return _}return ai(x)}function lr(x){const _=x.key,w=x.value,T=x.valueSpec||{},P=x.objectElementValidators||{},B=x.style,L=x.styleSpec,O=x.validateSpec;let V=[];const W=Lt(w);if(W!=="object")return[new Ye(_,w,`object expected, ${W} found`)];for(const X in w){const Y=X.split(".")[0],te=T[Y]||T["*"];let re;if(P[Y])re=P[Y];else if(T[Y])re=O;else if(P["*"])re=P["*"];else{if(!T["*"]){V.push(new Ye(_,w[X],`unknown property "${X}"`));continue}re=O}V=V.concat(re({key:(_&&`${_}.`)+X,value:w[X],valueSpec:te,style:B,styleSpec:L,object:w,objectKey:X,validateSpec:O},w))}for(const X in T)P[X]||T[X].required&&T[X].default===void 0&&w[X]===void 0&&V.push(new Ye(_,w,`missing required property "${X}"`));return V}function ts(x){const _=x.value,w=x.valueSpec,T=x.style,P=x.styleSpec,B=x.key,L=x.arrayElementValidator||x.validateSpec;if(Lt(_)!=="array")return[new Ye(B,_,`array expected, ${Lt(_)} found`)];if(w.length&&_.length!==w.length)return[new Ye(B,_,`array length ${w.length} expected, length ${_.length} found`)];if(w["min-length"]&&_.length<w["min-length"])return[new Ye(B,_,`array length at least ${w["min-length"]} expected, length ${_.length} found`)];let O={type:w.value,values:w.values};P.$version<7&&(O.function=w.function),Lt(w.value)==="object"&&(O=w.value);let V=[];for(let W=0;W<_.length;W++)V=V.concat(L({array:_,arrayIndex:W,value:_[W],valueSpec:O,validateSpec:x.validateSpec,style:T,styleSpec:P,key:`${B}[${W}]`}));return V}function Za(x){const _=x.key,w=x.value,T=x.valueSpec;let P=Lt(w);return P==="number"&&w!=w&&(P="NaN"),P!=="number"?[new Ye(_,w,`number expected, ${P} found`)]:"minimum"in T&&w<T.minimum?[new Ye(_,w,`${w} is less than the minimum value ${T.minimum}`)]:"maximum"in T&&w>T.maximum?[new Ye(_,w,`${w} is greater than the maximum value ${T.maximum}`)]:[]}function Wa(x){const _=x.valueSpec,w=ai(x.value.type);let T,P,B,L={};const O=w!=="categorical"&&x.value.property===void 0,V=!O,W=Lt(x.value.stops)==="array"&&Lt(x.value.stops[0])==="array"&&Lt(x.value.stops[0][0])==="object",X=lr({key:x.key,value:x.value,valueSpec:x.styleSpec.function,validateSpec:x.validateSpec,style:x.style,styleSpec:x.styleSpec,objectElementValidators:{stops:function(re){if(w==="identity")return[new Ye(re.key,re.value,'identity function may not have a "stops" property')];let se=[];const ue=re.value;return se=se.concat(ts({key:re.key,value:ue,valueSpec:re.valueSpec,validateSpec:re.validateSpec,style:re.style,styleSpec:re.styleSpec,arrayElementValidator:Y})),Lt(ue)==="array"&&ue.length===0&&se.push(new Ye(re.key,ue,"array must have at least one stop")),se},default:function(re){return re.validateSpec({key:re.key,value:re.value,valueSpec:_,validateSpec:re.validateSpec,style:re.style,styleSpec:re.styleSpec})}}});return w==="identity"&&O&&X.push(new Ye(x.key,x.value,'missing required property "property"')),w==="identity"||x.value.stops||X.push(new Ye(x.key,x.value,'missing required property "stops"')),w==="exponential"&&x.valueSpec.expression&&!Va(x.valueSpec)&&X.push(new Ye(x.key,x.value,"exponential functions not supported")),x.styleSpec.$version>=8&&(V&&!Yn(x.valueSpec)?X.push(new Ye(x.key,x.value,"property functions not supported")):O&&!el(x.valueSpec)&&X.push(new Ye(x.key,x.value,"zoom functions not supported"))),w!=="categorical"&&!W||x.value.property!==void 0||X.push(new Ye(x.key,x.value,'"property" property is required')),X;function Y(re){let se=[];const ue=re.value,me=re.key;if(Lt(ue)!=="array")return[new Ye(me,ue,`array expected, ${Lt(ue)} found`)];if(ue.length!==2)return[new Ye(me,ue,`array length 2 expected, length ${ue.length} found`)];if(W){if(Lt(ue[0])!=="object")return[new Ye(me,ue,`object expected, ${Lt(ue[0])} found`)];if(ue[0].zoom===void 0)return[new Ye(me,ue,"object stop key must have zoom")];if(ue[0].value===void 0)return[new Ye(me,ue,"object stop key must have value")];if(B&&B>ai(ue[0].zoom))return[new Ye(me,ue[0].zoom,"stop zoom values must appear in ascending order")];ai(ue[0].zoom)!==B&&(B=ai(ue[0].zoom),P=void 0,L={}),se=se.concat(lr({key:`${me}[0]`,value:ue[0],valueSpec:{zoom:{}},validateSpec:re.validateSpec,style:re.style,styleSpec:re.styleSpec,objectElementValidators:{zoom:Za,value:te}}))}else se=se.concat(te({key:`${me}[0]`,value:ue[0],valueSpec:{},validateSpec:re.validateSpec,style:re.style,styleSpec:re.styleSpec},ue));return Gt(an(ue[1]))?se.concat([new Ye(`${me}[1]`,ue[1],"expressions are not allowed in function stops.")]):se.concat(re.validateSpec({key:`${me}[1]`,value:ue[1],valueSpec:_,validateSpec:re.validateSpec,style:re.style,styleSpec:re.styleSpec}))}function te(re,se){const ue=Lt(re.value),me=ai(re.value),xe=re.value!==null?re.value:se;if(T){if(ue!==T)return[new Ye(re.key,xe,`${ue} stop domain type must match previous stop domain type ${T}`)]}else T=ue;if(ue!=="number"&&ue!=="string"&&ue!=="boolean")return[new Ye(re.key,xe,"stop domain value must be a number, string, or boolean")];if(ue!=="number"&&w!=="categorical"){let Me=`number expected, ${ue} found`;return Yn(_)&&w===void 0&&(Me+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ye(re.key,xe,Me)]}return w!=="categorical"||ue!=="number"||isFinite(me)&&Math.floor(me)===me?w!=="categorical"&&ue==="number"&&P!==void 0&&me<P?[new Ye(re.key,xe,"stop domain values must appear in ascending order")]:(P=me,w==="categorical"&&me in L?[new Ye(re.key,xe,"stop domain values must be unique")]:(L[me]=!0,[])):[new Ye(re.key,xe,`integer expected, found ${me}`)]}}function is(x){const _=(x.expressionContext==="property"?rl:jt)(an(x.value),x.valueSpec);if(_.result==="error")return _.value.map(T=>new Ye(`${x.key}${T.key}`,x.value,T.message));const w=_.value.expression||_.value._styleExpression.expression;if(x.expressionContext==="property"&&x.propertyKey==="text-font"&&!w.outputDefined())return[new Ye(x.key,x.value,`Invalid data expression for "${x.propertyKey}". Output values must be contained as literals within the expression.`)];if(x.expressionContext==="property"&&x.propertyType==="layout"&&!Ts(w))return[new Ye(x.key,x.value,'"feature-state" data expressions are not supported with layout properties.')];if(x.expressionContext==="filter"&&!Ts(w))return[new Ye(x.key,x.value,'"feature-state" data expressions are not supported with filters.')];if(x.expressionContext&&x.expressionContext.indexOf("cluster")===0){if(!Ys(w,["zoom","feature-state"]))return[new Ye(x.key,x.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(x.expressionContext==="cluster-initial"&&!Es(w))return[new Ye(x.key,x.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Tn(x){const _=x.key,w=x.value,T=x.valueSpec,P=[];return Array.isArray(T.values)?T.values.indexOf(ai(w))===-1&&P.push(new Ye(_,w,`expected one of [${T.values.join(", ")}], ${JSON.stringify(w)} found`)):Object.keys(T.values).indexOf(ai(w))===-1&&P.push(new Ye(_,w,`expected one of [${Object.keys(T.values).join(", ")}], ${JSON.stringify(w)} found`)),P}function rs(x){return qa(an(x.value))?is(rr({},x,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Ps(x)}function Ps(x){const _=x.value,w=x.key;if(Lt(_)!=="array")return[new Ye(w,_,`array expected, ${Lt(_)} found`)];const T=x.styleSpec;let P,B=[];if(_.length<1)return[new Ye(w,_,"filter array must have at least 1 element")];switch(B=B.concat(Tn({key:`${w}[0]`,value:_[0],valueSpec:T.filter_operator,style:x.style,styleSpec:x.styleSpec})),ai(_[0])){case"<":case"<=":case">":case">=":_.length>=2&&ai(_[1])==="$type"&&B.push(new Ye(w,_,`"$type" cannot be use with operator "${_[0]}"`));case"==":case"!=":_.length!==3&&B.push(new Ye(w,_,`filter array for operator "${_[0]}" must have 3 elements`));case"in":case"!in":_.length>=2&&(P=Lt(_[1]),P!=="string"&&B.push(new Ye(`${w}[1]`,_[1],`string expected, ${P} found`)));for(let L=2;L<_.length;L++)P=Lt(_[L]),ai(_[1])==="$type"?B=B.concat(Tn({key:`${w}[${L}]`,value:_[L],valueSpec:T.geometry_type,style:x.style,styleSpec:x.styleSpec})):P!=="string"&&P!=="number"&&P!=="boolean"&&B.push(new Ye(`${w}[${L}]`,_[L],`string, number, or boolean expected, ${P} found`));break;case"any":case"all":case"none":for(let L=1;L<_.length;L++)B=B.concat(Ps({key:`${w}[${L}]`,value:_[L],style:x.style,styleSpec:x.styleSpec}));break;case"has":case"!has":P=Lt(_[1]),_.length!==2?B.push(new Ye(w,_,`filter array for "${_[0]}" operator must have 2 elements`)):P!=="string"&&B.push(new Ye(`${w}[1]`,_[1],`string expected, ${P} found`));break;case"within":P=Lt(_[1]),_.length!==2?B.push(new Ye(w,_,`filter array for "${_[0]}" operator must have 2 elements`)):P!=="object"&&B.push(new Ye(`${w}[1]`,_[1],`object expected, ${P} found`))}return B}function Ka(x,_){const w=x.key,T=x.validateSpec,P=x.style,B=x.styleSpec,L=x.value,O=x.objectKey,V=B[`${_}_${x.layerType}`];if(!V)return[];const W=O.match(/^(.*)-transition$/);if(_==="paint"&&W&&V[W[1]]&&V[W[1]].transition)return T({key:w,value:L,valueSpec:B.transition,style:P,styleSpec:B});const X=x.valueSpec||V[O];if(!X)return[new Ye(w,L,`unknown property "${O}"`)];let Y;if(Lt(L)==="string"&&Yn(X)&&!X.tokens&&(Y=/^{([^}]+)}$/.exec(L)))return[new Ye(w,L,`"${O}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(Y[1])} }\`.`)];const te=[];return x.layerType==="symbol"&&(O==="text-field"&&P&&!P.glyphs&&te.push(new Ye(w,L,'use of "text-field" requires a style "glyphs" property')),O==="text-font"&&Jn(an(L))&&ai(L.type)==="identity"&&te.push(new Ye(w,L,'"text-font" does not support identity functions'))),te.concat(T({key:x.key,value:L,valueSpec:X,style:P,styleSpec:B,expressionContext:"property",propertyType:_,propertyKey:O}))}function la(x){return Ka(x,"paint")}function Xa(x){return Ka(x,"layout")}function Ya(x){let _=[];const w=x.value,T=x.key,P=x.style,B=x.styleSpec;w.type||w.ref||_.push(new Ye(T,w,'either "type" or "ref" is required'));let L=ai(w.type);const O=ai(w.ref);if(w.id){const V=ai(w.id);for(let W=0;W<x.arrayIndex;W++){const X=P.layers[W];ai(X.id)===V&&_.push(new Ye(T,w.id,`duplicate layer id "${w.id}", previously used at line ${X.id.__line__}`))}}if("ref"in w){let V;["type","source","source-layer","filter","layout"].forEach(W=>{W in w&&_.push(new Ye(T,w[W],`"${W}" is prohibited for ref layers`))}),P.layers.forEach(W=>{ai(W.id)===O&&(V=W)}),V?V.ref?_.push(new Ye(T,w.ref,"ref cannot reference another ref layer")):L=ai(V.type):_.push(new Ye(T,w.ref,`ref layer "${O}" not found`))}else if(L!=="background")if(w.source){const V=P.sources&&P.sources[w.source],W=V&&ai(V.type);V?W==="vector"&&L==="raster"?_.push(new Ye(T,w.source,`layer "${w.id}" requires a raster source`)):W!=="raster-dem"&&L==="hillshade"?_.push(new Ye(T,w.source,`layer "${w.id}" requires a raster-dem source`)):W==="raster"&&L!=="raster"?_.push(new Ye(T,w.source,`layer "${w.id}" requires a vector source`)):W!=="vector"||w["source-layer"]?W==="raster-dem"&&L!=="hillshade"?_.push(new Ye(T,w.source,"raster-dem source can only be used with layer type 'hillshade'.")):L!=="line"||!w.paint||!w.paint["line-gradient"]||W==="geojson"&&V.lineMetrics||_.push(new Ye(T,w,`layer "${w.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):_.push(new Ye(T,w,`layer "${w.id}" must specify a "source-layer"`)):_.push(new Ye(T,w.source,`source "${w.source}" not found`))}else _.push(new Ye(T,w,'missing required property "source"'));return _=_.concat(lr({key:T,value:w,valueSpec:B.layer,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":()=>[],type:()=>x.validateSpec({key:`${T}.type`,value:w.type,valueSpec:B.layer.type,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,object:w,objectKey:"type"}),filter:rs,layout:V=>lr({layer:w,key:V.key,value:V.value,style:V.style,styleSpec:V.styleSpec,validateSpec:V.validateSpec,objectElementValidators:{"*":W=>Xa(rr({layerType:L},W))}}),paint:V=>lr({layer:w,key:V.key,value:V.value,style:V.style,styleSpec:V.styleSpec,validateSpec:V.validateSpec,objectElementValidators:{"*":W=>la(rr({layerType:L},W))}})}})),_}function Lr(x){const _=x.value,w=x.key,T=Lt(_);return T!=="string"?[new Ye(w,_,`string expected, ${T} found`)]:[]}const cl={promoteId:function({key:x,value:_}){if(Lt(_)==="string")return Lr({key:x,value:_});{const w=[];for(const T in _)w.push(...Lr({key:`${x}.${T}`,value:_[T]}));return w}}};function ul(x){const _=x.value,w=x.key,T=x.styleSpec,P=x.style,B=x.validateSpec;if(!_.type)return[new Ye(w,_,'"type" is required')];const L=ai(_.type);let O;switch(L){case"vector":case"raster":return O=lr({key:w,value:_,valueSpec:T[`source_${L.replace("-","_")}`],style:x.style,styleSpec:T,objectElementValidators:cl,validateSpec:B}),O;case"raster-dem":return O=function(V){var W;const X=(W=V.sourceName)!==null&&W!==void 0?W:"",Y=V.value,te=V.styleSpec,re=te.source_raster_dem,se=V.style;let ue=[];const me=Lt(Y);if(Y===void 0)return ue;if(me!=="object")return ue.push(new Ye("source_raster_dem",Y,`object expected, ${me} found`)),ue;const xe=ai(Y.encoding)==="custom",Me=["redFactor","greenFactor","blueFactor","baseShift"],ve=V.value.encoding?`"${V.value.encoding}"`:"Default";for(const Ie in Y)!xe&&Me.includes(Ie)?ue.push(new Ye(Ie,Y[Ie],`In "${X}": "${Ie}" is only valid when "encoding" is set to "custom". ${ve} encoding found`)):re[Ie]?ue=ue.concat(V.validateSpec({key:Ie,value:Y[Ie],valueSpec:re[Ie],validateSpec:V.validateSpec,style:se,styleSpec:te})):ue.push(new Ye(Ie,Y[Ie],`unknown property "${Ie}"`));return ue}({sourceName:w,value:_,style:x.style,styleSpec:T,validateSpec:B}),O;case"geojson":if(O=lr({key:w,value:_,valueSpec:T.source_geojson,style:P,styleSpec:T,validateSpec:B,objectElementValidators:cl}),_.cluster)for(const V in _.clusterProperties){const[W,X]=_.clusterProperties[V],Y=typeof W=="string"?[W,["accumulated"],["get",V]]:W;O.push(...is({key:`${w}.${V}.map`,value:X,validateSpec:B,expressionContext:"cluster-map"})),O.push(...is({key:`${w}.${V}.reduce`,value:Y,validateSpec:B,expressionContext:"cluster-reduce"}))}return O;case"video":return lr({key:w,value:_,valueSpec:T.source_video,style:P,validateSpec:B,styleSpec:T});case"image":return lr({key:w,value:_,valueSpec:T.source_image,style:P,validateSpec:B,styleSpec:T});case"canvas":return[new Ye(w,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Tn({key:`${w}.type`,value:_.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:P,validateSpec:B,styleSpec:T})}}function hl(x){const _=x.value,w=x.styleSpec,T=w.light,P=x.style;let B=[];const L=Lt(_);if(_===void 0)return B;if(L!=="object")return B=B.concat([new Ye("light",_,`object expected, ${L} found`)]),B;for(const O in _){const V=O.match(/^(.*)-transition$/);B=B.concat(V&&T[V[1]]&&T[V[1]].transition?x.validateSpec({key:O,value:_[O],valueSpec:w.transition,validateSpec:x.validateSpec,style:P,styleSpec:w}):T[O]?x.validateSpec({key:O,value:_[O],valueSpec:T[O],validateSpec:x.validateSpec,style:P,styleSpec:w}):[new Ye(O,_[O],`unknown property "${O}"`)])}return B}function dl(x){const _=x.value,w=x.styleSpec,T=w.sky,P=x.style,B=Lt(_);if(_===void 0)return[];if(B!=="object")return[new Ye("sky",_,`object expected, ${B} found`)];let L=[];for(const O in _)L=L.concat(T[O]?Si({key:O,value:_[O],valueSpec:T[O],style:P,styleSpec:w}):[new Ye(O,_[O],`unknown property "${O}"`)]);return L}function pl(x){const _=x.value,w=x.styleSpec,T=w.terrain,P=x.style;let B=[];const L=Lt(_);if(_===void 0)return B;if(L!=="object")return B=B.concat([new Ye("terrain",_,`object expected, ${L} found`)]),B;for(const O in _)B=B.concat(T[O]?x.validateSpec({key:O,value:_[O],valueSpec:T[O],validateSpec:x.validateSpec,style:P,styleSpec:w}):[new Ye(O,_[O],`unknown property "${O}"`)]);return B}function Ms(x){let _=[];const w=x.value,T=x.key;if(Array.isArray(w)){const P=[],B=[];for(const L in w)w[L].id&&P.includes(w[L].id)&&_.push(new Ye(T,w,`all the sprites' ids must be unique, but ${w[L].id} is duplicated`)),P.push(w[L].id),w[L].url&&B.includes(w[L].url)&&_.push(new Ye(T,w,`all the sprites' URLs must be unique, but ${w[L].url} is duplicated`)),B.push(w[L].url),_=_.concat(lr({key:`${T}[${L}]`,value:w[L],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:x.validateSpec}));return _}return Lr({key:T,value:w})}const Rs={"*":()=>[],array:ts,boolean:function(x){const _=x.value,w=x.key,T=Lt(_);return T!=="boolean"?[new Ye(w,_,`boolean expected, ${T} found`)]:[]},number:Za,color:function(x){const _=x.key,w=x.value,T=Lt(w);return T!=="string"?[new Ye(_,w,`color expected, ${T} found`)]:Ut.parse(String(w))?[]:[new Ye(_,w,`color expected, "${w}" found`)]},constants:ll,enum:Tn,filter:rs,function:Wa,layer:Ya,object:lr,source:ul,light:hl,sky:dl,terrain:pl,string:Lr,formatted:function(x){return Lr(x).length===0?[]:is(x)},resolvedImage:function(x){return Lr(x).length===0?[]:is(x)},padding:function(x){const _=x.key,w=x.value;if(Lt(w)==="array"){if(w.length<1||w.length>4)return[new Ye(_,w,`padding requires 1 to 4 values; ${w.length} values found`)];const T={type:"number"};let P=[];for(let B=0;B<w.length;B++)P=P.concat(x.validateSpec({key:`${_}[${B}]`,value:w[B],validateSpec:x.validateSpec,valueSpec:T}));return P}return Za({key:_,value:w,valueSpec:{}})},variableAnchorOffsetCollection:function(x){const _=x.key,w=x.value,T=Lt(w),P=x.styleSpec;if(T!=="array"||w.length<1||w.length%2!=0)return[new Ye(_,w,"variableAnchorOffsetCollection requires a non-empty array of even length")];let B=[];for(let L=0;L<w.length;L+=2)B=B.concat(Tn({key:`${_}[${L}]`,value:w[L],valueSpec:P.layout_symbol["text-anchor"]})),B=B.concat(ts({key:`${_}[${L+1}]`,value:w[L+1],valueSpec:{length:2,value:"number"},validateSpec:x.validateSpec,style:x.style,styleSpec:P}));return B},sprite:Ms};function Si(x){const _=x.value,w=x.valueSpec,T=x.styleSpec;return x.validateSpec=Si,w.expression&&Jn(ai(_))?Wa(x):w.expression&&Gt(an(_))?is(x):w.type&&Rs[w.type]?Rs[w.type](x):lr(rr({},x,{valueSpec:w.type?T[w.type]:w}))}function ns(x){const _=x.value,w=x.key,T=Lr(x);return T.length||(_.indexOf("{fontstack}")===-1&&T.push(new Ye(w,_,'"glyphs" url must include a "{fontstack}" token')),_.indexOf("{range}")===-1&&T.push(new Ye(w,_,'"glyphs" url must include a "{range}" token'))),T}function _r(x,_=Le){let w=[];return w=w.concat(Si({key:"",value:x,valueSpec:_.$root,styleSpec:_,style:x,validateSpec:Si,objectElementValidators:{glyphs:ns,"*":()=>[]}})),x.constants&&(w=w.concat(ll({key:"constants",value:x.constants,style:x,styleSpec:_,validateSpec:Si}))),fl(w)}function Fr(x){return function(_){return x({..._,validateSpec:Si})}}function fl(x){return[].concat(x).sort((_,w)=>_.line-w.line)}function Wi(x){return function(..._){return fl(x.apply(this,_))}}_r.source=Wi(Fr(ul)),_r.sprite=Wi(Fr(Ms)),_r.glyphs=Wi(Fr(ns)),_r.light=Wi(Fr(hl)),_r.sky=Wi(Fr(dl)),_r.terrain=Wi(Fr(pl)),_r.layer=Wi(Fr(Ya)),_r.filter=Wi(Fr(rs)),_r.paintProperty=Wi(Fr(la)),_r.layoutProperty=Wi(Fr(Xa));const ss=_r,Ja=ss.light,uc=ss.paintProperty,Qa=ss.layoutProperty;function ml(x,_){let w=!1;if(_&&_.length)for(const T of _)x.fire(new mi(new Error(T.message))),w=!0;return w}class Hr{constructor(_,w,T){const P=this.cells=[];if(_ instanceof ArrayBuffer){this.arrayBuffer=_;const L=new Int32Array(this.arrayBuffer);_=L[0],this.d=(w=L[1])+2*(T=L[2]);for(let V=0;V<this.d*this.d;V++){const W=L[3+V],X=L[3+V+1];P.push(W===X?null:L.subarray(W,X))}const O=L[3+P.length+1];this.keys=L.subarray(L[3+P.length],O),this.bboxes=L.subarray(O),this.insert=this._insertReadonly}else{this.d=w+2*T;for(let L=0;L<this.d*this.d;L++)P.push([]);this.keys=[],this.bboxes=[]}this.n=w,this.extent=_,this.padding=T,this.scale=w/_,this.uid=0;const B=T/w*_;this.min=-B,this.max=_+B}insert(_,w,T,P,B){this._forEachCell(w,T,P,B,this._insertCell,this.uid++,void 0,void 0),this.keys.push(_),this.bboxes.push(w),this.bboxes.push(T),this.bboxes.push(P),this.bboxes.push(B)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(_,w,T,P,B,L){this.cells[B].push(L)}query(_,w,T,P,B){const L=this.min,O=this.max;if(_<=L&&w<=L&&O<=T&&O<=P&&!B)return Array.prototype.slice.call(this.keys);{const V=[];return this._forEachCell(_,w,T,P,this._queryCell,V,{},B),V}}_queryCell(_,w,T,P,B,L,O,V){const W=this.cells[B];if(W!==null){const X=this.keys,Y=this.bboxes;for(let te=0;te<W.length;te++){const re=W[te];if(O[re]===void 0){const se=4*re;(V?V(Y[se+0],Y[se+1],Y[se+2],Y[se+3]):_<=Y[se+2]&&w<=Y[se+3]&&T>=Y[se+0]&&P>=Y[se+1])?(O[re]=!0,L.push(X[re])):O[re]=!1}}}}_forEachCell(_,w,T,P,B,L,O,V){const W=this._convertToCellCoord(_),X=this._convertToCellCoord(w),Y=this._convertToCellCoord(T),te=this._convertToCellCoord(P);for(let re=W;re<=Y;re++)for(let se=X;se<=te;se++){const ue=this.d*se+re;if((!V||V(this._convertFromCellCoord(re),this._convertFromCellCoord(se),this._convertFromCellCoord(re+1),this._convertFromCellCoord(se+1)))&&B.call(this,_,w,T,P,ue,L,O,V))return}}_convertFromCellCoord(_){return(_-this.padding)/this.scale}_convertToCellCoord(_){return Math.max(0,Math.min(this.d-1,Math.floor(_*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const _=this.cells,w=3+this.cells.length+1+1;let T=0;for(let L=0;L<this.cells.length;L++)T+=this.cells[L].length;const P=new Int32Array(w+T+this.keys.length+this.bboxes.length);P[0]=this.extent,P[1]=this.n,P[2]=this.padding;let B=w;for(let L=0;L<_.length;L++){const O=_[L];P[3+L]=B,P.set(O,B),B+=O.length}return P[3+_.length]=B,P.set(this.keys,B),B+=this.keys.length,P[3+_.length+1]=B,P.set(this.bboxes,B),B+=this.bboxes.length,P.buffer}static serialize(_,w){const T=_.toArrayBuffer();return w&&w.push(T),{buffer:T}}static deserialize(_){return new Hr(_.buffer)}}const on={};function st(x,_,w={}){if(on[x])throw new Error(`${x} is already registered.`);Object.defineProperty(_,"_classRegistryKey",{value:x,writeable:!1}),on[x]={klass:_,omit:w.omit||[],shallow:w.shallow||[]}}st("Object",Object),st("TransferableGridIndex",Hr),st("Color",Ut),st("Error",Error),st("AJAXError",br),st("ResolvedImage",mr),st("StylePropertyFunction",na),st("StyleExpression",Cs,{omit:["_evaluator"]}),st("ZoomDependentExpression",ra),st("ZoomConstantExpression",Qn),st("CompoundExpression",gr,{omit:["_evaluate"]});for(const x in Kn)Kn[x]._classRegistryKey||st(`Expression_${x}`,Kn[x]);function eo(x){return x&&typeof ArrayBuffer<"u"&&(x instanceof ArrayBuffer||x.constructor&&x.constructor.name==="ArrayBuffer")}function An(x,_){if(x==null||typeof x=="boolean"||typeof x=="number"||typeof x=="string"||x instanceof Boolean||x instanceof Number||x instanceof String||x instanceof Date||x instanceof RegExp||x instanceof Blob||x instanceof Error)return x;if(eo(x)||Rr(x))return _&&_.push(x),x;if(ArrayBuffer.isView(x)){const w=x;return _&&_.push(w.buffer),w}if(x instanceof ImageData)return _&&_.push(x.data.buffer),x;if(Array.isArray(x)){const w=[];for(const T of x)w.push(An(T,_));return w}if(typeof x=="object"){const w=x.constructor,T=w._classRegistryKey;if(!T)throw new Error(`can't serialize object of unregistered class ${w.name}`);if(!on[T])throw new Error(`${T} is not registered.`);const P=w.serialize?w.serialize(x,_):{};if(w.serialize){if(_&&P===_[_.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const B in x){if(!x.hasOwnProperty(B)||on[T].omit.indexOf(B)>=0)continue;const L=x[B];P[B]=on[T].shallow.indexOf(B)>=0?L:An(L,_)}x instanceof Error&&(P.message=x.message)}if(P.$name)throw new Error("$name property is reserved for worker serialization logic.");return T!=="Object"&&(P.$name=T),P}throw new Error("can't serialize object of type "+typeof x)}function as(x){if(x==null||typeof x=="boolean"||typeof x=="number"||typeof x=="string"||x instanceof Boolean||x instanceof Number||x instanceof String||x instanceof Date||x instanceof RegExp||x instanceof Blob||x instanceof Error||eo(x)||Rr(x)||ArrayBuffer.isView(x)||x instanceof ImageData)return x;if(Array.isArray(x))return x.map(as);if(typeof x=="object"){const _=x.$name||"Object";if(!on[_])throw new Error(`can't deserialize unregistered class ${_}`);const{klass:w}=on[_];if(!w)throw new Error(`can't deserialize unregistered class ${_}`);if(w.deserialize)return w.deserialize(x);const T=Object.create(w.prototype);for(const P of Object.keys(x)){if(P==="$name")continue;const B=x[P];T[P]=on[_].shallow.indexOf(P)>=0?B:as(B)}return T}throw new Error("can't deserialize object of type "+typeof x)}class to{constructor(){this.first=!0}update(_,w){const T=Math.floor(_);return this.first?(this.first=!1,this.lastIntegerZoom=T,this.lastIntegerZoomTime=0,this.lastZoom=_,this.lastFloorZoom=T,!0):(this.lastFloorZoom>T?(this.lastIntegerZoom=T+1,this.lastIntegerZoomTime=w):this.lastFloorZoom<T&&(this.lastIntegerZoom=T,this.lastIntegerZoomTime=w),_!==this.lastZoom&&(this.lastZoom=_,this.lastFloorZoom=T,!0))}}const rt={"Latin-1 Supplement":x=>x>=128&&x<=255,Arabic:x=>x>=1536&&x<=1791,"Arabic Supplement":x=>x>=1872&&x<=1919,"Arabic Extended-A":x=>x>=2208&&x<=2303,"Hangul Jamo":x=>x>=4352&&x<=4607,"Unified Canadian Aboriginal Syllabics":x=>x>=5120&&x<=5759,Khmer:x=>x>=6016&&x<=6143,"Unified Canadian Aboriginal Syllabics Extended":x=>x>=6320&&x<=6399,"General Punctuation":x=>x>=8192&&x<=8303,"Letterlike Symbols":x=>x>=8448&&x<=8527,"Number Forms":x=>x>=8528&&x<=8591,"Miscellaneous Technical":x=>x>=8960&&x<=9215,"Control Pictures":x=>x>=9216&&x<=9279,"Optical Character Recognition":x=>x>=9280&&x<=9311,"Enclosed Alphanumerics":x=>x>=9312&&x<=9471,"Geometric Shapes":x=>x>=9632&&x<=9727,"Miscellaneous Symbols":x=>x>=9728&&x<=9983,"Miscellaneous Symbols and Arrows":x=>x>=11008&&x<=11263,"CJK Radicals Supplement":x=>x>=11904&&x<=12031,"Kangxi Radicals":x=>x>=12032&&x<=12255,"Ideographic Description Characters":x=>x>=12272&&x<=12287,"CJK Symbols and Punctuation":x=>x>=12288&&x<=12351,Hiragana:x=>x>=12352&&x<=12447,Katakana:x=>x>=12448&&x<=12543,Bopomofo:x=>x>=12544&&x<=12591,"Hangul Compatibility Jamo":x=>x>=12592&&x<=12687,Kanbun:x=>x>=12688&&x<=12703,"Bopomofo Extended":x=>x>=12704&&x<=12735,"CJK Strokes":x=>x>=12736&&x<=12783,"Katakana Phonetic Extensions":x=>x>=12784&&x<=12799,"Enclosed CJK Letters and Months":x=>x>=12800&&x<=13055,"CJK Compatibility":x=>x>=13056&&x<=13311,"CJK Unified Ideographs Extension A":x=>x>=13312&&x<=19903,"Yijing Hexagram Symbols":x=>x>=19904&&x<=19967,"CJK Unified Ideographs":x=>x>=19968&&x<=40959,"Yi Syllables":x=>x>=40960&&x<=42127,"Yi Radicals":x=>x>=42128&&x<=42191,"Hangul Jamo Extended-A":x=>x>=43360&&x<=43391,"Hangul Syllables":x=>x>=44032&&x<=55215,"Hangul Jamo Extended-B":x=>x>=55216&&x<=55295,"Private Use Area":x=>x>=57344&&x<=63743,"CJK Compatibility Ideographs":x=>x>=63744&&x<=64255,"Arabic Presentation Forms-A":x=>x>=64336&&x<=65023,"Vertical Forms":x=>x>=65040&&x<=65055,"CJK Compatibility Forms":x=>x>=65072&&x<=65103,"Small Form Variants":x=>x>=65104&&x<=65135,"Arabic Presentation Forms-B":x=>x>=65136&&x<=65279,"Halfwidth and Fullwidth Forms":x=>x>=65280&&x<=65519};function Ds(x){for(const _ of x)if(ua(_.charCodeAt(0)))return!0;return!1}function ca(x){for(const _ of x)if(!gl(_.charCodeAt(0)))return!1;return!0}function gl(x){return!(rt.Arabic(x)||rt["Arabic Supplement"](x)||rt["Arabic Extended-A"](x)||rt["Arabic Presentation Forms-A"](x)||rt["Arabic Presentation Forms-B"](x))}function ua(x){return!(x!==746&&x!==747&&(x<4352||!(rt["Bopomofo Extended"](x)||rt.Bopomofo(x)||rt["CJK Compatibility Forms"](x)&&!(x>=65097&&x<=65103)||rt["CJK Compatibility Ideographs"](x)||rt["CJK Compatibility"](x)||rt["CJK Radicals Supplement"](x)||rt["CJK Strokes"](x)||!(!rt["CJK Symbols and Punctuation"](x)||x>=12296&&x<=12305||x>=12308&&x<=12319||x===12336)||rt["CJK Unified Ideographs Extension A"](x)||rt["CJK Unified Ideographs"](x)||rt["Enclosed CJK Letters and Months"](x)||rt["Hangul Compatibility Jamo"](x)||rt["Hangul Jamo Extended-A"](x)||rt["Hangul Jamo Extended-B"](x)||rt["Hangul Jamo"](x)||rt["Hangul Syllables"](x)||rt.Hiragana(x)||rt["Ideographic Description Characters"](x)||rt.Kanbun(x)||rt["Kangxi Radicals"](x)||rt["Katakana Phonetic Extensions"](x)||rt.Katakana(x)&&x!==12540||!(!rt["Halfwidth and Fullwidth Forms"](x)||x===65288||x===65289||x===65293||x>=65306&&x<=65310||x===65339||x===65341||x===65343||x>=65371&&x<=65503||x===65507||x>=65512&&x<=65519)||!(!rt["Small Form Variants"](x)||x>=65112&&x<=65118||x>=65123&&x<=65126)||rt["Unified Canadian Aboriginal Syllabics"](x)||rt["Unified Canadian Aboriginal Syllabics Extended"](x)||rt["Vertical Forms"](x)||rt["Yijing Hexagram Symbols"](x)||rt["Yi Syllables"](x)||rt["Yi Radicals"](x))))}function io(x){return!(ua(x)||function(_){return!!(rt["Latin-1 Supplement"](_)&&(_===167||_===169||_===174||_===177||_===188||_===189||_===190||_===215||_===247)||rt["General Punctuation"](_)&&(_===8214||_===8224||_===8225||_===8240||_===8241||_===8251||_===8252||_===8258||_===8263||_===8264||_===8265||_===8273)||rt["Letterlike Symbols"](_)||rt["Number Forms"](_)||rt["Miscellaneous Technical"](_)&&(_>=8960&&_<=8967||_>=8972&&_<=8991||_>=8996&&_<=9e3||_===9003||_>=9085&&_<=9114||_>=9150&&_<=9165||_===9167||_>=9169&&_<=9179||_>=9186&&_<=9215)||rt["Control Pictures"](_)&&_!==9251||rt["Optical Character Recognition"](_)||rt["Enclosed Alphanumerics"](_)||rt["Geometric Shapes"](_)||rt["Miscellaneous Symbols"](_)&&!(_>=9754&&_<=9759)||rt["Miscellaneous Symbols and Arrows"](_)&&(_>=11026&&_<=11055||_>=11088&&_<=11097||_>=11192&&_<=11243)||rt["CJK Symbols and Punctuation"](_)||rt.Katakana(_)||rt["Private Use Area"](_)||rt["CJK Compatibility Forms"](_)||rt["Small Form Variants"](_)||rt["Halfwidth and Fullwidth Forms"](_)||_===8734||_===8756||_===8757||_>=9984&&_<=10087||_>=10102&&_<=10131||_===65532||_===65533)}(x))}function ro(x){return x>=1424&&x<=2303||rt["Arabic Presentation Forms-A"](x)||rt["Arabic Presentation Forms-B"](x)}function no(x,_){return!(!_&&ro(x)||x>=2304&&x<=3583||x>=3840&&x<=4255||rt.Khmer(x))}function yl(x){for(const _ of x)if(ro(_.charCodeAt(0)))return!0;return!1}const In=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(x){this.pluginStatus=x.pluginStatus,this.pluginURL=x.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(x){this.applyArabicShaping=x.applyArabicShaping,this.processBidirectionalText=x.processBidirectionalText,this.processStyledBidirectionalText=x.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Kt{constructor(_,w){this.zoom=_,w?(this.now=w.now,this.fadeDuration=w.fadeDuration,this.zoomHistory=w.zoomHistory,this.transition=w.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new to,this.transition={})}isSupportedScript(_){return function(w,T){for(const P of w)if(!no(P.charCodeAt(0),T))return!1;return!0}(_,In.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const _=this.zoom,w=_-Math.floor(_),T=this.crossFadingFactor();return _>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:w+(1-w)*T}:{fromScale:.5,toScale:1,t:1-(1-T)*w}}}class ha{constructor(_,w){this.property=_,this.value=w,this.expression=function(T,P){if(Jn(T))return new na(T,P);if(Gt(T)){const B=rl(T,P);if(B.result==="error")throw new Error(B.value.map(L=>`${L.key}: ${L.message}`).join(", "));return B.value}{let B=T;return P.type==="color"&&typeof T=="string"?B=Ut.parse(T):P.type!=="padding"||typeof T!="number"&&!Array.isArray(T)?P.type==="variableAnchorOffsetCollection"&&Array.isArray(T)&&(B=Di.parse(T)):B=ar.parse(T),{kind:"constant",evaluate:()=>B}}}(w===void 0?_.specification.default:w,_.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(_,w,T){return this.property.possiblyEvaluate(this,_,w,T)}}class da{constructor(_){this.property=_,this.value=new ha(_,void 0)}transitioned(_,w){return new ao(this.property,this.value,w,Pi({},_.transition,this.transition),_.now)}untransitioned(){return new ao(this.property,this.value,null,{},0)}}class so{constructor(_){this._properties=_,this._values=Object.create(_.defaultTransitionablePropertyValues)}getValue(_){return qi(this._values[_].value.value)}setValue(_,w){Object.prototype.hasOwnProperty.call(this._values,_)||(this._values[_]=new da(this._values[_].property)),this._values[_].value=new ha(this._values[_].property,w===null?void 0:qi(w))}getTransition(_){return qi(this._values[_].transition)}setTransition(_,w){Object.prototype.hasOwnProperty.call(this._values,_)||(this._values[_]=new da(this._values[_].property)),this._values[_].transition=qi(w)||void 0}serialize(){const _={};for(const w of Object.keys(this._values)){const T=this.getValue(w);T!==void 0&&(_[w]=T);const P=this.getTransition(w);P!==void 0&&(_[`${w}-transition`]=P)}return _}transitioned(_,w){const T=new xl(this._properties);for(const P of Object.keys(this._values))T._values[P]=this._values[P].transitioned(_,w._values[P]);return T}untransitioned(){const _=new xl(this._properties);for(const w of Object.keys(this._values))_._values[w]=this._values[w].untransitioned();return _}}class ao{constructor(_,w,T,P,B){this.property=_,this.value=w,this.begin=B+P.delay||0,this.end=this.begin+P.duration||0,_.specification.transition&&(P.delay||P.duration)&&(this.prior=T)}possiblyEvaluate(_,w,T){const P=_.now||0,B=this.value.possiblyEvaluate(_,w,T),L=this.prior;if(L){if(P>this.end)return this.prior=null,B;if(this.value.isDataDriven())return this.prior=null,B;if(P<this.begin)return L.possiblyEvaluate(_,w,T);{const O=(P-this.begin)/(this.end-this.begin);return this.property.interpolate(L.possiblyEvaluate(_,w,T),B,function(V){if(V<=0)return 0;if(V>=1)return 1;const W=V*V,X=W*V;return 4*(V<.5?X:3*(V-W)+X-.75)}(O))}}return B}}class xl{constructor(_){this._properties=_,this._values=Object.create(_.defaultTransitioningPropertyValues)}possiblyEvaluate(_,w,T){const P=new ks(this._properties);for(const B of Object.keys(this._values))P._values[B]=this._values[B].possiblyEvaluate(_,w,T);return P}hasTransition(){for(const _ of Object.keys(this._values))if(this._values[_].prior)return!0;return!1}}class hc{constructor(_){this._properties=_,this._values=Object.create(_.defaultPropertyValues)}hasValue(_){return this._values[_].value!==void 0}getValue(_){return qi(this._values[_].value)}setValue(_,w){this._values[_]=new ha(this._values[_].property,w===null?void 0:qi(w))}serialize(){const _={};for(const w of Object.keys(this._values)){const T=this.getValue(w);T!==void 0&&(_[w]=T)}return _}possiblyEvaluate(_,w,T){const P=new ks(this._properties);for(const B of Object.keys(this._values))P._values[B]=this._values[B].possiblyEvaluate(_,w,T);return P}}class Sr{constructor(_,w,T){this.property=_,this.value=w,this.parameters=T}isConstant(){return this.value.kind==="constant"}constantOr(_){return this.value.kind==="constant"?this.value.value:_}evaluate(_,w,T,P){return this.property.evaluate(this.value,this.parameters,_,w,T,P)}}class ks{constructor(_){this._properties=_,this._values=Object.create(_.defaultPossiblyEvaluatedValues)}get(_){return this._values[_]}}class ut{constructor(_){this.specification=_}possiblyEvaluate(_,w){if(_.isDataDriven())throw new Error("Value should not be data driven");return _.expression.evaluate(w)}interpolate(_,w,T){const P=or[this.specification.type];return P?P(_,w,T):_}}class pt{constructor(_,w){this.specification=_,this.overrides=w}possiblyEvaluate(_,w,T,P){return new Sr(this,_.expression.kind==="constant"||_.expression.kind==="camera"?{kind:"constant",value:_.expression.evaluate(w,null,{},T,P)}:_.expression,w)}interpolate(_,w,T){if(_.value.kind!=="constant"||w.value.kind!=="constant")return _;if(_.value.value===void 0||w.value.value===void 0)return new Sr(this,{kind:"constant",value:void 0},_.parameters);const P=or[this.specification.type];if(P){const B=P(_.value.value,w.value.value,T);return new Sr(this,{kind:"constant",value:B},_.parameters)}return _}evaluate(_,w,T,P,B,L){return _.kind==="constant"?_.value:_.evaluate(w,T,P,B,L)}}class Cn extends pt{possiblyEvaluate(_,w,T,P){if(_.value===void 0)return new Sr(this,{kind:"constant",value:void 0},w);if(_.expression.kind==="constant"){const B=_.expression.evaluate(w,null,{},T,P),L=_.property.specification.type==="resolvedImage"&&typeof B!="string"?B.name:B,O=this._calculate(L,L,L,w);return new Sr(this,{kind:"constant",value:O},w)}if(_.expression.kind==="camera"){const B=this._calculate(_.expression.evaluate({zoom:w.zoom-1}),_.expression.evaluate({zoom:w.zoom}),_.expression.evaluate({zoom:w.zoom+1}),w);return new Sr(this,{kind:"constant",value:B},w)}return new Sr(this,_.expression,w)}evaluate(_,w,T,P,B,L){if(_.kind==="source"){const O=_.evaluate(w,T,P,B,L);return this._calculate(O,O,O,w)}return _.kind==="composite"?this._calculate(_.evaluate({zoom:Math.floor(w.zoom)-1},T,P),_.evaluate({zoom:Math.floor(w.zoom)},T,P),_.evaluate({zoom:Math.floor(w.zoom)+1},T,P),w):_.value}_calculate(_,w,T,P){return P.zoom>P.zoomHistory.lastIntegerZoom?{from:_,to:w}:{from:T,to:w}}interpolate(_){return _}}class oo{constructor(_){this.specification=_}possiblyEvaluate(_,w,T,P){if(_.value!==void 0){if(_.expression.kind==="constant"){const B=_.expression.evaluate(w,null,{},T,P);return this._calculate(B,B,B,w)}return this._calculate(_.expression.evaluate(new Kt(Math.floor(w.zoom-1),w)),_.expression.evaluate(new Kt(Math.floor(w.zoom),w)),_.expression.evaluate(new Kt(Math.floor(w.zoom+1),w)),w)}}_calculate(_,w,T,P){return P.zoom>P.zoomHistory.lastIntegerZoom?{from:_,to:w}:{from:T,to:w}}interpolate(_){return _}}class zs{constructor(_){this.specification=_}possiblyEvaluate(_,w,T,P){return!!_.expression.evaluate(w,null,{},T,P)}interpolate(){return!1}}class Ki{constructor(_){this.properties=_,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const w in _){const T=_[w];T.specification.overridable&&this.overridableProperties.push(w);const P=this.defaultPropertyValues[w]=new ha(T,void 0),B=this.defaultTransitionablePropertyValues[w]=new da(T);this.defaultTransitioningPropertyValues[w]=B.untransitioned(),this.defaultPossiblyEvaluatedValues[w]=P.possiblyEvaluate({})}}}st("DataDrivenProperty",pt),st("DataConstantProperty",ut),st("CrossFadedDataDrivenProperty",Cn),st("CrossFadedProperty",oo),st("ColorRampProperty",zs);const vl="-transition";class Er extends gn{constructor(_,w){if(super(),this.id=_.id,this.type=_.type,this._featureFilter={filter:()=>!0,needGeometry:!1},_.type!=="custom"&&(this.metadata=_.metadata,this.minzoom=_.minzoom,this.maxzoom=_.maxzoom,_.type!=="background"&&(this.source=_.source,this.sourceLayer=_["source-layer"],this.filter=_.filter),w.layout&&(this._unevaluatedLayout=new hc(w.layout)),w.paint)){this._transitionablePaint=new so(w.paint);for(const T in _.paint)this.setPaintProperty(T,_.paint[T],{validate:!1});for(const T in _.layout)this.setLayoutProperty(T,_.layout[T],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ks(w.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(_){return _==="visibility"?this.visibility:this._unevaluatedLayout.getValue(_)}setLayoutProperty(_,w,T={}){w!=null&&this._validate(Qa,`layers.${this.id}.layout.${_}`,_,w,T)||(_!=="visibility"?this._unevaluatedLayout.setValue(_,w):this.visibility=w)}getPaintProperty(_){return _.endsWith(vl)?this._transitionablePaint.getTransition(_.slice(0,-11)):this._transitionablePaint.getValue(_)}setPaintProperty(_,w,T={}){if(w!=null&&this._validate(uc,`layers.${this.id}.paint.${_}`,_,w,T))return!1;if(_.endsWith(vl))return this._transitionablePaint.setTransition(_.slice(0,-11),w||void 0),!1;{const P=this._transitionablePaint._values[_],B=P.property.specification["property-type"]==="cross-faded-data-driven",L=P.value.isDataDriven(),O=P.value;this._transitionablePaint.setValue(_,w),this._handleSpecialPaintPropertyUpdate(_);const V=this._transitionablePaint._values[_].value;return V.isDataDriven()||L||B||this._handleOverridablePaintPropertyUpdate(_,O,V)}}_handleSpecialPaintPropertyUpdate(_){}_handleOverridablePaintPropertyUpdate(_,w,T){return!1}isHidden(_){return!!(this.minzoom&&_<this.minzoom)||!!(this.maxzoom&&_>=this.maxzoom)||this.visibility==="none"}updateTransitions(_){this._transitioningPaint=this._transitionablePaint.transitioned(_,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(_,w){_.getCrossfadeParameters&&(this._crossfadeParameters=_.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(_,void 0,w)),this.paint=this._transitioningPaint.possiblyEvaluate(_,void 0,w)}serialize(){const _={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(_.layout=_.layout||{},_.layout.visibility=this.visibility),qs(_,(w,T)=>!(w===void 0||T==="layout"&&!Object.keys(w).length||T==="paint"&&!Object.keys(w).length))}_validate(_,w,T,P,B={}){return(!B||B.validate!==!1)&&ml(this,_.call(ss,{key:w,layerType:this.type,objectKey:T,value:P,styleSpec:Le,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const _ in this.paint._values){const w=this.paint.get(_);if(w instanceof Sr&&Yn(w.property.specification)&&(w.value.kind==="source"||w.value.kind==="composite")&&w.value.isStateDependent)return!0}return!1}}const bl={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class os{constructor(_,w){this._structArray=_,this._pos1=w*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ii{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(_,w){return _._trim(),w&&(_.isTransferred=!0,w.push(_.arrayBuffer)),{length:_.length,arrayBuffer:_.arrayBuffer}}static deserialize(_){const w=Object.create(this.prototype);return w.arrayBuffer=_.arrayBuffer,w.length=_.length,w.capacity=_.arrayBuffer.byteLength/w.bytesPerElement,w._refreshViews(),w}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(_){this.reserve(_),this.length=_}reserve(_){if(_>this.capacity){this.capacity=Math.max(_,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const w=this.uint8;this._refreshViews(),w&&this.uint8.set(w)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function ui(x,_=1){let w=0,T=0;return{members:x.map(P=>{const B=bl[P.type].BYTES_PER_ELEMENT,L=w=wl(w,Math.max(_,B)),O=P.components||1;return T=Math.max(T,B),w+=B*O,{name:P.name,type:P.type,components:O,offset:L}}),size:wl(w,Math.max(T,_)),alignment:_}}function wl(x,_){return Math.ceil(x/_)*_}class Bs extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(_,w){const T=this.length;return this.resize(T+1),this.emplace(T,_,w)}emplace(_,w,T){const P=2*_;return this.int16[P+0]=w,this.int16[P+1]=T,_}}Bs.prototype.bytesPerElement=4,st("StructArrayLayout2i4",Bs);class pa extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(_,w,T){const P=this.length;return this.resize(P+1),this.emplace(P,_,w,T)}emplace(_,w,T,P){const B=3*_;return this.int16[B+0]=w,this.int16[B+1]=T,this.int16[B+2]=P,_}}pa.prototype.bytesPerElement=6,st("StructArrayLayout3i6",pa);class ln extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(_,w,T,P){const B=this.length;return this.resize(B+1),this.emplace(B,_,w,T,P)}emplace(_,w,T,P,B){const L=4*_;return this.int16[L+0]=w,this.int16[L+1]=T,this.int16[L+2]=P,this.int16[L+3]=B,_}}ln.prototype.bytesPerElement=8,st("StructArrayLayout4i8",ln);class lo extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(_,w,T,P,B,L){const O=this.length;return this.resize(O+1),this.emplace(O,_,w,T,P,B,L)}emplace(_,w,T,P,B,L,O){const V=6*_;return this.int16[V+0]=w,this.int16[V+1]=T,this.int16[V+2]=P,this.int16[V+3]=B,this.int16[V+4]=L,this.int16[V+5]=O,_}}lo.prototype.bytesPerElement=12,st("StructArrayLayout2i4i12",lo);class co extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(_,w,T,P,B,L){const O=this.length;return this.resize(O+1),this.emplace(O,_,w,T,P,B,L)}emplace(_,w,T,P,B,L,O){const V=4*_,W=8*_;return this.int16[V+0]=w,this.int16[V+1]=T,this.uint8[W+4]=P,this.uint8[W+5]=B,this.uint8[W+6]=L,this.uint8[W+7]=O,_}}co.prototype.bytesPerElement=8,st("StructArrayLayout2i4ub8",co);class Ls extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(_,w){const T=this.length;return this.resize(T+1),this.emplace(T,_,w)}emplace(_,w,T){const P=2*_;return this.float32[P+0]=w,this.float32[P+1]=T,_}}Ls.prototype.bytesPerElement=8,st("StructArrayLayout2f8",Ls);class uo extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(_,w,T,P,B,L,O,V,W,X){const Y=this.length;return this.resize(Y+1),this.emplace(Y,_,w,T,P,B,L,O,V,W,X)}emplace(_,w,T,P,B,L,O,V,W,X,Y){const te=10*_;return this.uint16[te+0]=w,this.uint16[te+1]=T,this.uint16[te+2]=P,this.uint16[te+3]=B,this.uint16[te+4]=L,this.uint16[te+5]=O,this.uint16[te+6]=V,this.uint16[te+7]=W,this.uint16[te+8]=X,this.uint16[te+9]=Y,_}}uo.prototype.bytesPerElement=20,st("StructArrayLayout10ui20",uo);class fa extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(_,w,T,P,B,L,O,V,W,X,Y,te){const re=this.length;return this.resize(re+1),this.emplace(re,_,w,T,P,B,L,O,V,W,X,Y,te)}emplace(_,w,T,P,B,L,O,V,W,X,Y,te,re){const se=12*_;return this.int16[se+0]=w,this.int16[se+1]=T,this.int16[se+2]=P,this.int16[se+3]=B,this.uint16[se+4]=L,this.uint16[se+5]=O,this.uint16[se+6]=V,this.uint16[se+7]=W,this.int16[se+8]=X,this.int16[se+9]=Y,this.int16[se+10]=te,this.int16[se+11]=re,_}}fa.prototype.bytesPerElement=24,st("StructArrayLayout4i4ui4i24",fa);class ho extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(_,w,T){const P=this.length;return this.resize(P+1),this.emplace(P,_,w,T)}emplace(_,w,T,P){const B=3*_;return this.float32[B+0]=w,this.float32[B+1]=T,this.float32[B+2]=P,_}}ho.prototype.bytesPerElement=12,st("StructArrayLayout3f12",ho);class po extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(_){const w=this.length;return this.resize(w+1),this.emplace(w,_)}emplace(_,w){return this.uint32[1*_+0]=w,_}}po.prototype.bytesPerElement=4,st("StructArrayLayout1ul4",po);class Gr extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(_,w,T,P,B,L,O,V,W){const X=this.length;return this.resize(X+1),this.emplace(X,_,w,T,P,B,L,O,V,W)}emplace(_,w,T,P,B,L,O,V,W,X){const Y=10*_,te=5*_;return this.int16[Y+0]=w,this.int16[Y+1]=T,this.int16[Y+2]=P,this.int16[Y+3]=B,this.int16[Y+4]=L,this.int16[Y+5]=O,this.uint32[te+3]=V,this.uint16[Y+8]=W,this.uint16[Y+9]=X,_}}Gr.prototype.bytesPerElement=20,st("StructArrayLayout6i1ul2ui20",Gr);class ma extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(_,w,T,P,B,L){const O=this.length;return this.resize(O+1),this.emplace(O,_,w,T,P,B,L)}emplace(_,w,T,P,B,L,O){const V=6*_;return this.int16[V+0]=w,this.int16[V+1]=T,this.int16[V+2]=P,this.int16[V+3]=B,this.int16[V+4]=L,this.int16[V+5]=O,_}}ma.prototype.bytesPerElement=12,st("StructArrayLayout2i2i2i12",ma);class Fs extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(_,w,T,P,B){const L=this.length;return this.resize(L+1),this.emplace(L,_,w,T,P,B)}emplace(_,w,T,P,B,L){const O=4*_,V=8*_;return this.float32[O+0]=w,this.float32[O+1]=T,this.float32[O+2]=P,this.int16[V+6]=B,this.int16[V+7]=L,_}}Fs.prototype.bytesPerElement=16,st("StructArrayLayout2f1f2i16",Fs);class ga extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(_,w,T,P){const B=this.length;return this.resize(B+1),this.emplace(B,_,w,T,P)}emplace(_,w,T,P,B){const L=12*_,O=3*_;return this.uint8[L+0]=w,this.uint8[L+1]=T,this.float32[O+1]=P,this.float32[O+2]=B,_}}ga.prototype.bytesPerElement=12,st("StructArrayLayout2ub2f12",ga);class ls extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(_,w,T){const P=this.length;return this.resize(P+1),this.emplace(P,_,w,T)}emplace(_,w,T,P){const B=3*_;return this.uint16[B+0]=w,this.uint16[B+1]=T,this.uint16[B+2]=P,_}}ls.prototype.bytesPerElement=6,st("StructArrayLayout3ui6",ls);class fo extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(_,w,T,P,B,L,O,V,W,X,Y,te,re,se,ue,me,xe){const Me=this.length;return this.resize(Me+1),this.emplace(Me,_,w,T,P,B,L,O,V,W,X,Y,te,re,se,ue,me,xe)}emplace(_,w,T,P,B,L,O,V,W,X,Y,te,re,se,ue,me,xe,Me){const ve=24*_,Ie=12*_,Oe=48*_;return this.int16[ve+0]=w,this.int16[ve+1]=T,this.uint16[ve+2]=P,this.uint16[ve+3]=B,this.uint32[Ie+2]=L,this.uint32[Ie+3]=O,this.uint32[Ie+4]=V,this.uint16[ve+10]=W,this.uint16[ve+11]=X,this.uint16[ve+12]=Y,this.float32[Ie+7]=te,this.float32[Ie+8]=re,this.uint8[Oe+36]=se,this.uint8[Oe+37]=ue,this.uint8[Oe+38]=me,this.uint32[Ie+10]=xe,this.int16[ve+22]=Me,_}}fo.prototype.bytesPerElement=48,st("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",fo);class cs extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(_,w,T,P,B,L,O,V,W,X,Y,te,re,se,ue,me,xe,Me,ve,Ie,Oe,Ue,it,ot,tt,et,Ke,at){const Qe=this.length;return this.resize(Qe+1),this.emplace(Qe,_,w,T,P,B,L,O,V,W,X,Y,te,re,se,ue,me,xe,Me,ve,Ie,Oe,Ue,it,ot,tt,et,Ke,at)}emplace(_,w,T,P,B,L,O,V,W,X,Y,te,re,se,ue,me,xe,Me,ve,Ie,Oe,Ue,it,ot,tt,et,Ke,at,Qe){const Ze=32*_,dt=16*_;return this.int16[Ze+0]=w,this.int16[Ze+1]=T,this.int16[Ze+2]=P,this.int16[Ze+3]=B,this.int16[Ze+4]=L,this.int16[Ze+5]=O,this.int16[Ze+6]=V,this.int16[Ze+7]=W,this.uint16[Ze+8]=X,this.uint16[Ze+9]=Y,this.uint16[Ze+10]=te,this.uint16[Ze+11]=re,this.uint16[Ze+12]=se,this.uint16[Ze+13]=ue,this.uint16[Ze+14]=me,this.uint16[Ze+15]=xe,this.uint16[Ze+16]=Me,this.uint16[Ze+17]=ve,this.uint16[Ze+18]=Ie,this.uint16[Ze+19]=Oe,this.uint16[Ze+20]=Ue,this.uint16[Ze+21]=it,this.uint16[Ze+22]=ot,this.uint32[dt+12]=tt,this.float32[dt+13]=et,this.float32[dt+14]=Ke,this.uint16[Ze+30]=at,this.uint16[Ze+31]=Qe,_}}cs.prototype.bytesPerElement=64,st("StructArrayLayout8i15ui1ul2f2ui64",cs);class cn extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(_){const w=this.length;return this.resize(w+1),this.emplace(w,_)}emplace(_,w){return this.float32[1*_+0]=w,_}}cn.prototype.bytesPerElement=4,st("StructArrayLayout1f4",cn);class mo extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(_,w,T){const P=this.length;return this.resize(P+1),this.emplace(P,_,w,T)}emplace(_,w,T,P){const B=3*_;return this.uint16[6*_+0]=w,this.float32[B+1]=T,this.float32[B+2]=P,_}}mo.prototype.bytesPerElement=12,st("StructArrayLayout1ui2f12",mo);class _a extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(_,w,T){const P=this.length;return this.resize(P+1),this.emplace(P,_,w,T)}emplace(_,w,T,P){const B=4*_;return this.uint32[2*_+0]=w,this.uint16[B+2]=T,this.uint16[B+3]=P,_}}_a.prototype.bytesPerElement=8,st("StructArrayLayout1ul2ui8",_a);class Pn extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(_,w){const T=this.length;return this.resize(T+1),this.emplace(T,_,w)}emplace(_,w,T){const P=2*_;return this.uint16[P+0]=w,this.uint16[P+1]=T,_}}Pn.prototype.bytesPerElement=4,st("StructArrayLayout2ui4",Pn);class go extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(_){const w=this.length;return this.resize(w+1),this.emplace(w,_)}emplace(_,w){return this.uint16[1*_+0]=w,_}}go.prototype.bytesPerElement=2,st("StructArrayLayout1ui2",go);class _o extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(_,w,T,P){const B=this.length;return this.resize(B+1),this.emplace(B,_,w,T,P)}emplace(_,w,T,P,B){const L=4*_;return this.float32[L+0]=w,this.float32[L+1]=T,this.float32[L+2]=P,this.float32[L+3]=B,_}}_o.prototype.bytesPerElement=16,st("StructArrayLayout4f16",_o);class yo extends os{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new we(this.anchorPointX,this.anchorPointY)}}yo.prototype.size=20;class Sl extends Gr{get(_){return new yo(this,_)}}st("CollisionBoxArray",Sl);class D extends os{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(_){this._structArray.uint8[this._pos1+37]=_}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(_){this._structArray.uint8[this._pos1+38]=_}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(_){this._structArray.uint32[this._pos4+10]=_}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}D.prototype.size=48;class y extends fo{get(_){return new D(this,_)}}st("PlacedSymbolArray",y);class S extends os{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(_){this._structArray.uint32[this._pos4+12]=_}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}S.prototype.size=64;class I extends cs{get(_){return new S(this,_)}}st("SymbolInstanceArray",I);class C extends cn{getoffsetX(_){return this.float32[1*_+0]}}st("GlyphOffsetArray",C);class z extends pa{getx(_){return this.int16[3*_+0]}gety(_){return this.int16[3*_+1]}gettileUnitDistanceFromAnchor(_){return this.int16[3*_+2]}}st("SymbolLineVertexArray",z);class N extends os{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}N.prototype.size=12;class U extends mo{get(_){return new N(this,_)}}st("TextAnchorOffsetArray",U);class Z extends os{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Z.prototype.size=8;class K extends _a{get(_){return new Z(this,_)}}st("FeatureIndexArray",K);class J extends Bs{}class Q extends Bs{}class ne extends Bs{}class fe extends lo{}class de extends co{}class ge extends Ls{}class le extends uo{}class Se extends fa{}class De extends ho{}class _e extends po{}class Ce extends ma{}class ke extends ga{}class ze extends ls{}class Be extends Pn{}const He=ui([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ve}=He;class je{constructor(_=[]){this.segments=_}prepareSegment(_,w,T,P){let B=this.segments[this.segments.length-1];return _>je.MAX_VERTEX_ARRAY_LENGTH&&Mi(`Max vertices per segment is ${je.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${_}`),(!B||B.vertexLength+_>je.MAX_VERTEX_ARRAY_LENGTH||B.sortKey!==P)&&(B={vertexOffset:w.length,primitiveOffset:T.length,vertexLength:0,primitiveLength:0},P!==void 0&&(B.sortKey=P),this.segments.push(B)),B}get(){return this.segments}destroy(){for(const _ of this.segments)for(const w in _.vaos)_.vaos[w].destroy()}static simpleSegment(_,w,T,P){return new je([{vertexOffset:_,primitiveOffset:w,vertexLength:T,primitiveLength:P,vaos:{},sortKey:0}])}}function nt(x,_){return 256*(x=Ci(Math.floor(x),0,255))+Ci(Math.floor(_),0,255)}je.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,st("SegmentVector",je);const vt=ui([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Je={exports:{}},mt={exports:{}};mt.exports=function(x,_){var w,T,P,B,L,O,V,W;for(T=x.length-(w=3&x.length),P=_,L=3432918353,O=461845907,W=0;W<T;)V=255&x.charCodeAt(W)|(255&x.charCodeAt(++W))<<8|(255&x.charCodeAt(++W))<<16|(255&x.charCodeAt(++W))<<24,++W,P=27492+(65535&(B=5*(65535&(P=(P^=V=(65535&(V=(V=(65535&V)*L+(((V>>>16)*L&65535)<<16)&4294967295)<<15|V>>>17))*O+(((V>>>16)*O&65535)<<16)&4294967295)<<13|P>>>19))+((5*(P>>>16)&65535)<<16)&4294967295))+((58964+(B>>>16)&65535)<<16);switch(V=0,w){case 3:V^=(255&x.charCodeAt(W+2))<<16;case 2:V^=(255&x.charCodeAt(W+1))<<8;case 1:P^=V=(65535&(V=(V=(65535&(V^=255&x.charCodeAt(W)))*L+(((V>>>16)*L&65535)<<16)&4294967295)<<15|V>>>17))*O+(((V>>>16)*O&65535)<<16)&4294967295}return P^=x.length,P=2246822507*(65535&(P^=P>>>16))+((2246822507*(P>>>16)&65535)<<16)&4294967295,P=3266489909*(65535&(P^=P>>>13))+((3266489909*(P>>>16)&65535)<<16)&4294967295,(P^=P>>>16)>>>0};var Et=mt.exports,Mt={exports:{}};Mt.exports=function(x,_){for(var w,T=x.length,P=_^T,B=0;T>=4;)w=1540483477*(65535&(w=255&x.charCodeAt(B)|(255&x.charCodeAt(++B))<<8|(255&x.charCodeAt(++B))<<16|(255&x.charCodeAt(++B))<<24))+((1540483477*(w>>>16)&65535)<<16),P=1540483477*(65535&P)+((1540483477*(P>>>16)&65535)<<16)^(w=1540483477*(65535&(w^=w>>>24))+((1540483477*(w>>>16)&65535)<<16)),T-=4,++B;switch(T){case 3:P^=(255&x.charCodeAt(B+2))<<16;case 2:P^=(255&x.charCodeAt(B+1))<<8;case 1:P=1540483477*(65535&(P^=255&x.charCodeAt(B)))+((1540483477*(P>>>16)&65535)<<16)}return P=1540483477*(65535&(P^=P>>>13))+((1540483477*(P>>>16)&65535)<<16),(P^=P>>>15)>>>0};var _t=Et,At=Mt.exports;Je.exports=_t,Je.exports.murmur3=_t,Je.exports.murmur2=At;var It=ye(Je.exports);class ei{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(_,w,T,P){this.ids.push(Ht(_)),this.positions.push(w,T,P)}getPositions(_){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const w=Ht(_);let T=0,P=this.ids.length-1;for(;T<P;){const L=T+P>>1;this.ids[L]>=w?P=L:T=L+1}const B=[];for(;this.ids[T]===w;)B.push({index:this.positions[3*T],start:this.positions[3*T+1],end:this.positions[3*T+2]}),T++;return B}static serialize(_,w){const T=new Float64Array(_.ids),P=new Uint32Array(_.positions);return Xi(T,P,0,T.length-1),w&&w.push(T.buffer,P.buffer),{ids:T,positions:P}}static deserialize(_){const w=new ei;return w.ids=_.ids,w.positions=_.positions,w.indexed=!0,w}}function Ht(x){const _=+x;return!isNaN(_)&&_<=Number.MAX_SAFE_INTEGER?_:It(String(x))}function Xi(x,_,w,T){for(;w<T;){const P=x[w+T>>1];let B=w-1,L=T+1;for(;;){do B++;while(x[B]<P);do L--;while(x[L]>P);if(B>=L)break;pi(x,B,L),pi(_,3*B,3*L),pi(_,3*B+1,3*L+1),pi(_,3*B+2,3*L+2)}L-w<T-L?(Xi(x,_,w,L),w=L+1):(Xi(x,_,L+1,T),T=L)}}function pi(x,_,w){const T=x[_];x[_]=x[w],x[w]=T}st("FeaturePositionMap",ei);class Zt{constructor(_,w){this.gl=_.gl,this.location=w}}class ki extends Zt{constructor(_,w){super(_,w),this.current=0}set(_){this.current!==_&&(this.current=_,this.gl.uniform1f(this.location,_))}}class Tr extends Zt{constructor(_,w){super(_,w),this.current=[0,0,0,0]}set(_){_[0]===this.current[0]&&_[1]===this.current[1]&&_[2]===this.current[2]&&_[3]===this.current[3]||(this.current=_,this.gl.uniform4f(this.location,_[0],_[1],_[2],_[3]))}}class Or extends Zt{constructor(_,w){super(_,w),this.current=Ut.transparent}set(_){_.r===this.current.r&&_.g===this.current.g&&_.b===this.current.b&&_.a===this.current.a||(this.current=_,this.gl.uniform4f(this.location,_.r,_.g,_.b,_.a))}}const Mn=new Float32Array(16);function Rn(x){return[nt(255*x.r,255*x.g),nt(255*x.b,255*x.a)]}class $r{constructor(_,w,T){this.value=_,this.uniformNames=w.map(P=>`u_${P}`),this.type=T}setUniform(_,w,T){_.set(T.constantOr(this.value))}getBinding(_,w,T){return this.type==="color"?new Or(_,w):new ki(_,w)}}class Ar{constructor(_,w){this.uniformNames=w.map(T=>`u_${T}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(_,w){this.pixelRatioFrom=w.pixelRatio,this.pixelRatioTo=_.pixelRatio,this.patternFrom=w.tlbr,this.patternTo=_.tlbr}setUniform(_,w,T,P){const B=P==="u_pattern_to"?this.patternTo:P==="u_pattern_from"?this.patternFrom:P==="u_pixel_ratio_to"?this.pixelRatioTo:P==="u_pixel_ratio_from"?this.pixelRatioFrom:null;B&&_.set(B)}getBinding(_,w,T){return T.substr(0,9)==="u_pattern"?new Tr(_,w):new ki(_,w)}}class ri{constructor(_,w,T,P){this.expression=_,this.type=T,this.maxValue=0,this.paintVertexAttributes=w.map(B=>({name:`a_${B}`,type:"Float32",components:T==="color"?2:1,offset:0})),this.paintVertexArray=new P}populatePaintArray(_,w,T,P,B){const L=this.paintVertexArray.length,O=this.expression.evaluate(new Kt(0),w,{},P,[],B);this.paintVertexArray.resize(_),this._setPaintValue(L,_,O)}updatePaintArray(_,w,T,P){const B=this.expression.evaluate({zoom:0},T,P);this._setPaintValue(_,w,B)}_setPaintValue(_,w,T){if(this.type==="color"){const P=Rn(T);for(let B=_;B<w;B++)this.paintVertexArray.emplace(B,P[0],P[1])}else{for(let P=_;P<w;P++)this.paintVertexArray.emplace(P,T);this.maxValue=Math.max(this.maxValue,Math.abs(T))}}upload(_){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=_.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Xt{constructor(_,w,T,P,B,L){this.expression=_,this.uniformNames=w.map(O=>`u_${O}_t`),this.type=T,this.useIntegerZoom=P,this.zoom=B,this.maxValue=0,this.paintVertexAttributes=w.map(O=>({name:`a_${O}`,type:"Float32",components:T==="color"?4:2,offset:0})),this.paintVertexArray=new L}populatePaintArray(_,w,T,P,B){const L=this.expression.evaluate(new Kt(this.zoom),w,{},P,[],B),O=this.expression.evaluate(new Kt(this.zoom+1),w,{},P,[],B),V=this.paintVertexArray.length;this.paintVertexArray.resize(_),this._setPaintValue(V,_,L,O)}updatePaintArray(_,w,T,P){const B=this.expression.evaluate({zoom:this.zoom},T,P),L=this.expression.evaluate({zoom:this.zoom+1},T,P);this._setPaintValue(_,w,B,L)}_setPaintValue(_,w,T,P){if(this.type==="color"){const B=Rn(T),L=Rn(P);for(let O=_;O<w;O++)this.paintVertexArray.emplace(O,B[0],B[1],L[0],L[1])}else{for(let B=_;B<w;B++)this.paintVertexArray.emplace(B,T,P);this.maxValue=Math.max(this.maxValue,Math.abs(T),Math.abs(P))}}upload(_){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=_.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(_,w){const T=this.useIntegerZoom?Math.floor(w.zoom):w.zoom,P=Ci(this.expression.interpolationFactor(T,this.zoom,this.zoom+1),0,1);_.set(P)}getBinding(_,w,T){return new ki(_,w)}}class oi{constructor(_,w,T,P,B,L){this.expression=_,this.type=w,this.useIntegerZoom=T,this.zoom=P,this.layerId=L,this.zoomInPaintVertexArray=new B,this.zoomOutPaintVertexArray=new B}populatePaintArray(_,w,T){const P=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(_),this.zoomOutPaintVertexArray.resize(_),this._setPaintValues(P,_,w.patterns&&w.patterns[this.layerId],T)}updatePaintArray(_,w,T,P,B){this._setPaintValues(_,w,T.patterns&&T.patterns[this.layerId],B)}_setPaintValues(_,w,T,P){if(!P||!T)return;const{min:B,mid:L,max:O}=T,V=P[B],W=P[L],X=P[O];if(V&&W&&X)for(let Y=_;Y<w;Y++)this.zoomInPaintVertexArray.emplace(Y,W.tl[0],W.tl[1],W.br[0],W.br[1],V.tl[0],V.tl[1],V.br[0],V.br[1],W.pixelRatio,V.pixelRatio),this.zoomOutPaintVertexArray.emplace(Y,W.tl[0],W.tl[1],W.br[0],W.br[1],X.tl[0],X.tl[1],X.br[0],X.br[1],W.pixelRatio,X.pixelRatio)}upload(_){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=_.createVertexBuffer(this.zoomInPaintVertexArray,vt.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=_.createVertexBuffer(this.zoomOutPaintVertexArray,vt.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class us{constructor(_,w,T){this.binders={},this._buffers=[];const P=[];for(const B in _.paint._values){if(!T(B))continue;const L=_.paint.get(B);if(!(L instanceof Sr&&Yn(L.property.specification)))continue;const O=Ei(B,_.type),V=L.value,W=L.property.specification.type,X=L.property.useIntegerZoom,Y=L.property.specification["property-type"],te=Y==="cross-faded"||Y==="cross-faded-data-driven";if(V.kind==="constant")this.binders[B]=te?new Ar(V.value,O):new $r(V.value,O,W),P.push(`/u_${B}`);else if(V.kind==="source"||te){const re=cr(B,W,"source");this.binders[B]=te?new oi(V,W,X,w,re,_.id):new ri(V,O,W,re),P.push(`/a_${B}`)}else{const re=cr(B,W,"composite");this.binders[B]=new Xt(V,O,W,X,w,re),P.push(`/z_${B}`)}}this.cacheKey=P.sort().join("")}getMaxValue(_){const w=this.binders[_];return w instanceof ri||w instanceof Xt?w.maxValue:0}populatePaintArrays(_,w,T,P,B){for(const L in this.binders){const O=this.binders[L];(O instanceof ri||O instanceof Xt||O instanceof oi)&&O.populatePaintArray(_,w,T,P,B)}}setConstantPatternPositions(_,w){for(const T in this.binders){const P=this.binders[T];P instanceof Ar&&P.setConstantPatternPositions(_,w)}}updatePaintArrays(_,w,T,P,B){let L=!1;for(const O in _){const V=w.getPositions(O);for(const W of V){const X=T.feature(W.index);for(const Y in this.binders){const te=this.binders[Y];if((te instanceof ri||te instanceof Xt||te instanceof oi)&&te.expression.isStateDependent===!0){const re=P.paint.get(Y);te.expression=re.value,te.updatePaintArray(W.start,W.end,X,_[O],B),L=!0}}}}return L}defines(){const _=[];for(const w in this.binders){const T=this.binders[w];(T instanceof $r||T instanceof Ar)&&_.push(...T.uniformNames.map(P=>`#define HAS_UNIFORM_${P}`))}return _}getBinderAttributes(){const _=[];for(const w in this.binders){const T=this.binders[w];if(T instanceof ri||T instanceof Xt)for(let P=0;P<T.paintVertexAttributes.length;P++)_.push(T.paintVertexAttributes[P].name);else if(T instanceof oi)for(let P=0;P<vt.members.length;P++)_.push(vt.members[P].name)}return _}getBinderUniforms(){const _=[];for(const w in this.binders){const T=this.binders[w];if(T instanceof $r||T instanceof Ar||T instanceof Xt)for(const P of T.uniformNames)_.push(P)}return _}getPaintVertexBuffers(){return this._buffers}getUniforms(_,w){const T=[];for(const P in this.binders){const B=this.binders[P];if(B instanceof $r||B instanceof Ar||B instanceof Xt){for(const L of B.uniformNames)if(w[L]){const O=B.getBinding(_,w[L],L);T.push({name:L,property:P,binding:O})}}}return T}setUniforms(_,w,T,P){for(const{name:B,property:L,binding:O}of w)this.binders[L].setUniform(O,P,T.get(L),B)}updatePaintBuffers(_){this._buffers=[];for(const w in this.binders){const T=this.binders[w];if(_&&T instanceof oi){const P=_.fromScale===2?T.zoomInPaintVertexBuffer:T.zoomOutPaintVertexBuffer;P&&this._buffers.push(P)}else(T instanceof ri||T instanceof Xt)&&T.paintVertexBuffer&&this._buffers.push(T.paintVertexBuffer)}}upload(_){for(const w in this.binders){const T=this.binders[w];(T instanceof ri||T instanceof Xt||T instanceof oi)&&T.upload(_)}this.updatePaintBuffers()}destroy(){for(const _ in this.binders){const w=this.binders[_];(w instanceof ri||w instanceof Xt||w instanceof oi)&&w.destroy()}}}class Jt{constructor(_,w,T=()=>!0){this.programConfigurations={};for(const P of _)this.programConfigurations[P.id]=new us(P,w,T);this.needsUpload=!1,this._featureMap=new ei,this._bufferOffset=0}populatePaintArrays(_,w,T,P,B,L){for(const O in this.programConfigurations)this.programConfigurations[O].populatePaintArrays(_,w,P,B,L);w.id!==void 0&&this._featureMap.add(w.id,T,this._bufferOffset,_),this._bufferOffset=_,this.needsUpload=!0}updatePaintArrays(_,w,T,P){for(const B of T)this.needsUpload=this.programConfigurations[B.id].updatePaintArrays(_,this._featureMap,w,B,P)||this.needsUpload}get(_){return this.programConfigurations[_]}upload(_){if(this.needsUpload){for(const w in this.programConfigurations)this.programConfigurations[w].upload(_);this.needsUpload=!1}}destroy(){for(const _ in this.programConfigurations)this.programConfigurations[_].destroy()}}function Ei(x,_){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[x]||[x.replace(`${_}-`,"").replace(/-/g,"_")]}function cr(x,_,w){const T={color:{source:Ls,composite:_o},number:{source:cn,composite:Ls}},P=function(B){return{"line-pattern":{source:le,composite:le},"fill-pattern":{source:le,composite:le},"fill-extrusion-pattern":{source:le,composite:le}}[B]}(x);return P&&P[w]||T[_][w]}st("ConstantBinder",$r),st("CrossFadedConstantBinder",Ar),st("SourceExpressionBinder",ri),st("CrossFadedCompositeBinder",oi),st("CompositeExpressionBinder",Xt),st("ProgramConfiguration",us,{omit:["_buffers"]}),st("ProgramConfigurationSet",Jt);const Pt=8192,xo=Math.pow(2,14)-1,El=-xo-1;function Dn(x){const _=Pt/x.extent,w=x.loadGeometry();for(let T=0;T<w.length;T++){const P=w[T];for(let B=0;B<P.length;B++){const L=P[B],O=Math.round(L.x*_),V=Math.round(L.y*_);L.x=Ci(O,El,xo),L.y=Ci(V,El,xo),(O<L.x||O>L.x+1||V<L.y||V>L.y+1)&&Mi("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return w}function kn(x,_){return{type:x.type,id:x.id,properties:x.properties,geometry:_?Dn(x):[]}}function ya(x,_,w,T,P){x.emplaceBack(2*_+(T+1)/2,2*w+(P+1)/2)}class vo{constructor(_){this.zoom=_.zoom,this.overscaling=_.overscaling,this.layers=_.layers,this.layerIds=this.layers.map(w=>w.id),this.index=_.index,this.hasPattern=!1,this.layoutVertexArray=new Q,this.indexArray=new ze,this.segments=new je,this.programConfigurations=new Jt(_.layers,_.zoom),this.stateDependentLayerIds=this.layers.filter(w=>w.isStateDependent()).map(w=>w.id)}populate(_,w,T){const P=this.layers[0],B=[];let L=null,O=!1;P.type==="circle"&&(L=P.layout.get("circle-sort-key"),O=!L.isConstant());for(const{feature:V,id:W,index:X,sourceLayerIndex:Y}of _){const te=this.layers[0]._featureFilter.needGeometry,re=kn(V,te);if(!this.layers[0]._featureFilter.filter(new Kt(this.zoom),re,T))continue;const se=O?L.evaluate(re,{},T):void 0,ue={id:W,properties:V.properties,type:V.type,sourceLayerIndex:Y,index:X,geometry:te?re.geometry:Dn(V),patterns:{},sortKey:se};B.push(ue)}O&&B.sort((V,W)=>V.sortKey-W.sortKey);for(const V of B){const{geometry:W,index:X,sourceLayerIndex:Y}=V,te=_[X].feature;this.addFeature(V,W,X,T),w.featureIndex.insert(te,W,X,Y,this.index)}}update(_,w,T){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(_,w,this.stateDependentLayers,T)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(_){this.uploaded||(this.layoutVertexBuffer=_.createVertexBuffer(this.layoutVertexArray,Ve),this.indexBuffer=_.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(_),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(_,w,T,P){for(const B of w)for(const L of B){const O=L.x,V=L.y;if(O<0||O>=Pt||V<0||V>=Pt)continue;const W=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,_.sortKey),X=W.vertexLength;ya(this.layoutVertexArray,O,V,-1,-1),ya(this.layoutVertexArray,O,V,1,-1),ya(this.layoutVertexArray,O,V,1,1),ya(this.layoutVertexArray,O,V,-1,1),this.indexArray.emplaceBack(X,X+1,X+2),this.indexArray.emplaceBack(X,X+3,X+2),W.vertexLength+=4,W.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,_,T,{},P)}}function zn(x,_){for(let w=0;w<x.length;w++)if(xa(_,x[w]))return!0;for(let w=0;w<_.length;w++)if(xa(x,_[w]))return!0;return!!Os(x,_)}function Tl(x,_,w){return!!xa(x,_)||!!$s(_,x,w)}function bo(x,_){if(x.length===1)return Jc(_,x[0]);for(let w=0;w<_.length;w++){const T=_[w];for(let P=0;P<T.length;P++)if(xa(x,T[P]))return!0}for(let w=0;w<x.length;w++)if(Jc(_,x[w]))return!0;for(let w=0;w<_.length;w++)if(Os(x,_[w]))return!0;return!1}function Al(x,_,w){if(x.length>1){if(Os(x,_))return!0;for(let T=0;T<_.length;T++)if($s(_[T],x,w))return!0}for(let T=0;T<x.length;T++)if($s(x[T],_,w))return!0;return!1}function Os(x,_){if(x.length===0||_.length===0)return!1;for(let w=0;w<x.length-1;w++){const T=x[w],P=x[w+1];for(let B=0;B<_.length-1;B++)if(Il(T,P,_[B],_[B+1]))return!0}return!1}function Il(x,_,w,T){return xr(x,w,T)!==xr(_,w,T)&&xr(x,_,w)!==xr(x,_,T)}function $s(x,_,w){const T=w*w;if(_.length===1)return x.distSqr(_[0])<T;for(let P=1;P<_.length;P++)if(Yc(x,_[P-1],_[P])<T)return!0;return!1}function Yc(x,_,w){const T=_.distSqr(w);if(T===0)return x.distSqr(_);const P=((x.x-_.x)*(w.x-_.x)+(x.y-_.y)*(w.y-_.y))/T;return x.distSqr(P<0?_:P>1?w:w.sub(_)._mult(P)._add(_))}function Jc(x,_){let w,T,P,B=!1;for(let L=0;L<x.length;L++){w=x[L];for(let O=0,V=w.length-1;O<w.length;V=O++)T=w[O],P=w[V],T.y>_.y!=P.y>_.y&&_.x<(P.x-T.x)*(_.y-T.y)/(P.y-T.y)+T.x&&(B=!B)}return B}function xa(x,_){let w=!1;for(let T=0,P=x.length-1;T<x.length;P=T++){const B=x[T],L=x[P];B.y>_.y!=L.y>_.y&&_.x<(L.x-B.x)*(_.y-B.y)/(L.y-B.y)+B.x&&(w=!w)}return w}function Ih(x,_,w){const T=w[0],P=w[2];if(x.x<T.x&&_.x<T.x||x.x>P.x&&_.x>P.x||x.y<T.y&&_.y<T.y||x.y>P.y&&_.y>P.y)return!1;const B=xr(x,_,w[0]);return B!==xr(x,_,w[1])||B!==xr(x,_,w[2])||B!==xr(x,_,w[3])}function wo(x,_,w){const T=_.paint.get(x).value;return T.kind==="constant"?T.value:w.programConfigurations.get(_.id).getMaxValue(x)}function Cl(x){return Math.sqrt(x[0]*x[0]+x[1]*x[1])}function Pl(x,_,w,T,P){if(!_[0]&&!_[1])return x;const B=we.convert(_)._mult(P);w==="viewport"&&B._rotate(-T);const L=[];for(let O=0;O<x.length;O++)L.push(x[O].sub(B));return L}let Qc,eu;st("CircleBucket",vo,{omit:["layers"]});var Ch={get paint(){return eu=eu||new Ki({"circle-radius":new pt(Le.paint_circle["circle-radius"]),"circle-color":new pt(Le.paint_circle["circle-color"]),"circle-blur":new pt(Le.paint_circle["circle-blur"]),"circle-opacity":new pt(Le.paint_circle["circle-opacity"]),"circle-translate":new ut(Le.paint_circle["circle-translate"]),"circle-translate-anchor":new ut(Le.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ut(Le.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ut(Le.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new pt(Le.paint_circle["circle-stroke-width"]),"circle-stroke-color":new pt(Le.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new pt(Le.paint_circle["circle-stroke-opacity"])})},get layout(){return Qc=Qc||new Ki({"circle-sort-key":new pt(Le.layout_circle["circle-sort-key"])})}},Yi=1e-6,va=typeof Float32Array<"u"?Float32Array:Array;function dc(x){return x[0]=1,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=1,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=1,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x}function tu(x,_,w){var T=_[0],P=_[1],B=_[2],L=_[3],O=_[4],V=_[5],W=_[6],X=_[7],Y=_[8],te=_[9],re=_[10],se=_[11],ue=_[12],me=_[13],xe=_[14],Me=_[15],ve=w[0],Ie=w[1],Oe=w[2],Ue=w[3];return x[0]=ve*T+Ie*O+Oe*Y+Ue*ue,x[1]=ve*P+Ie*V+Oe*te+Ue*me,x[2]=ve*B+Ie*W+Oe*re+Ue*xe,x[3]=ve*L+Ie*X+Oe*se+Ue*Me,x[4]=(ve=w[4])*T+(Ie=w[5])*O+(Oe=w[6])*Y+(Ue=w[7])*ue,x[5]=ve*P+Ie*V+Oe*te+Ue*me,x[6]=ve*B+Ie*W+Oe*re+Ue*xe,x[7]=ve*L+Ie*X+Oe*se+Ue*Me,x[8]=(ve=w[8])*T+(Ie=w[9])*O+(Oe=w[10])*Y+(Ue=w[11])*ue,x[9]=ve*P+Ie*V+Oe*te+Ue*me,x[10]=ve*B+Ie*W+Oe*re+Ue*xe,x[11]=ve*L+Ie*X+Oe*se+Ue*Me,x[12]=(ve=w[12])*T+(Ie=w[13])*O+(Oe=w[14])*Y+(Ue=w[15])*ue,x[13]=ve*P+Ie*V+Oe*te+Ue*me,x[14]=ve*B+Ie*W+Oe*re+Ue*xe,x[15]=ve*L+Ie*X+Oe*se+Ue*Me,x}Math.hypot||(Math.hypot=function(){for(var x=0,_=arguments.length;_--;)x+=arguments[_]*arguments[_];return Math.sqrt(x)});var So,Ph=tu;function Ml(x,_,w){var T=_[0],P=_[1],B=_[2],L=_[3];return x[0]=w[0]*T+w[4]*P+w[8]*B+w[12]*L,x[1]=w[1]*T+w[5]*P+w[9]*B+w[13]*L,x[2]=w[2]*T+w[6]*P+w[10]*B+w[14]*L,x[3]=w[3]*T+w[7]*P+w[11]*B+w[15]*L,x}So=new va(4),va!=Float32Array&&(So[0]=0,So[1]=0,So[2]=0,So[3]=0);class Mh extends Er{constructor(_){super(_,Ch)}createBucket(_){return new vo(_)}queryRadius(_){const w=_;return wo("circle-radius",this,w)+wo("circle-stroke-width",this,w)+Cl(this.paint.get("circle-translate"))}queryIntersectsFeature(_,w,T,P,B,L,O,V){const W=Pl(_,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),L.angle,O),X=this.paint.get("circle-radius").evaluate(w,T)+this.paint.get("circle-stroke-width").evaluate(w,T),Y=this.paint.get("circle-pitch-alignment")==="map",te=Y?W:function(se,ue){return se.map(me=>iu(me,ue))}(W,V),re=Y?X*O:X;for(const se of P)for(const ue of se){const me=Y?ue:iu(ue,V);let xe=re;const Me=Ml([],[ue.x,ue.y,0,1],V);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?xe*=Me[3]/L.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(xe*=L.cameraToCenterDistance/Me[3]),Tl(te,me,xe))return!0}return!1}}function iu(x,_){const w=Ml([],[x.x,x.y,0,1],_);return new we(w[0]/w[3],w[1]/w[3])}class ru extends vo{}let nu;st("HeatmapBucket",ru,{omit:["layers"]});var Rh={get paint(){return nu=nu||new Ki({"heatmap-radius":new pt(Le.paint_heatmap["heatmap-radius"]),"heatmap-weight":new pt(Le.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ut(Le.paint_heatmap["heatmap-intensity"]),"heatmap-color":new zs(Le.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ut(Le.paint_heatmap["heatmap-opacity"])})}};function pc(x,{width:_,height:w},T,P){if(P){if(P instanceof Uint8ClampedArray)P=new Uint8Array(P.buffer);else if(P.length!==_*w*T)throw new RangeError(`mismatched image size. expected: ${P.length} but got: ${_*w*T}`)}else P=new Uint8Array(_*w*T);return x.width=_,x.height=w,x.data=P,x}function su(x,{width:_,height:w},T){if(_===x.width&&w===x.height)return;const P=pc({},{width:_,height:w},T);fc(x,P,{x:0,y:0},{x:0,y:0},{width:Math.min(x.width,_),height:Math.min(x.height,w)},T),x.width=_,x.height=w,x.data=P.data}function fc(x,_,w,T,P,B){if(P.width===0||P.height===0)return _;if(P.width>x.width||P.height>x.height||w.x>x.width-P.width||w.y>x.height-P.height)throw new RangeError("out of range source coordinates for image copy");if(P.width>_.width||P.height>_.height||T.x>_.width-P.width||T.y>_.height-P.height)throw new RangeError("out of range destination coordinates for image copy");const L=x.data,O=_.data;if(L===O)throw new Error("srcData equals dstData, so image is already copied");for(let V=0;V<P.height;V++){const W=((w.y+V)*x.width+w.x)*B,X=((T.y+V)*_.width+T.x)*B;for(let Y=0;Y<P.width*B;Y++)O[X+Y]=L[W+Y]}return _}class Eo{constructor(_,w){pc(this,_,1,w)}resize(_){su(this,_,1)}clone(){return new Eo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(_,w,T,P,B){fc(_,w,T,P,B,1)}}class Ir{constructor(_,w){pc(this,_,4,w)}resize(_){su(this,_,4)}replace(_,w){w?this.data.set(_):this.data=_ instanceof Uint8ClampedArray?new Uint8Array(_.buffer):_}clone(){return new Ir({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(_,w,T,P,B){fc(_,w,T,P,B,4)}}function au(x){const _={},w=x.resolution||256,T=x.clips?x.clips.length:1,P=x.image||new Ir({width:w,height:T});if(Math.log(w)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${w}`);const B=(L,O,V)=>{_[x.evaluationKey]=V;const W=x.expression.evaluate(_);P.data[L+O+0]=Math.floor(255*W.r/W.a),P.data[L+O+1]=Math.floor(255*W.g/W.a),P.data[L+O+2]=Math.floor(255*W.b/W.a),P.data[L+O+3]=Math.floor(255*W.a)};if(x.clips)for(let L=0,O=0;L<T;++L,O+=4*w)for(let V=0,W=0;V<w;V++,W+=4){const X=V/(w-1),{start:Y,end:te}=x.clips[L];B(O,W,Y*(1-X)+te*X)}else for(let L=0,O=0;L<w;L++,O+=4)B(0,O,L/(w-1));return P}st("AlphaImage",Eo),st("RGBAImage",Ir);class Dh extends Er{createBucket(_){return new ru(_)}constructor(_){super(_,Rh),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(_){_==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=au({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let ou;var kh={get paint(){return ou=ou||new Ki({"hillshade-illumination-direction":new ut(Le.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ut(Le.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ut(Le.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ut(Le.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ut(Le.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ut(Le.paint_hillshade["hillshade-accent-color"])})}};class zh extends Er{constructor(_){super(_,kh)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const Bh=ui([{name:"a_pos",components:2,type:"Int16"}],4),{members:Lh}=Bh;var mc={exports:{}};function Rl(x,_,w){w=w||2;var T,P,B,L,O,V,W,X=_&&_.length,Y=X?_[0]*w:x.length,te=lu(x,0,Y,w,!0),re=[];if(!te||te.next===te.prev)return re;if(X&&(te=function(ue,me,xe,Me){var ve,Ie,Oe,Ue=[];for(ve=0,Ie=me.length;ve<Ie;ve++)(Oe=lu(ue,me[ve]*Me,ve<Ie-1?me[ve+1]*Me:ue.length,Me,!1))===Oe.next&&(Oe.steiner=!0),Ue.push(jh(Oe));for(Ue.sort(Uh),ve=0;ve<Ue.length;ve++)xe=Vh(Ue[ve],xe);return xe}(x,_,te,w)),x.length>80*w){T=B=x[0],P=L=x[1];for(var se=w;se<Y;se+=w)(O=x[se])<T&&(T=O),(V=x[se+1])<P&&(P=V),O>B&&(B=O),V>L&&(L=V);W=(W=Math.max(B-T,L-P))!==0?32767/W:0}return To(te,re,w,T,P,W,0),re}function lu(x,_,w,T,P){var B,L;if(P===yc(x,_,w,T)>0)for(B=_;B<w;B+=T)L=hu(B,x[B],x[B+1],L);else for(B=w-T;B>=_;B-=T)L=hu(B,x[B],x[B+1],L);return L&&Dl(L,L.next)&&(Io(L),L=L.next),L}function Ns(x,_){if(!x)return x;_||(_=x);var w,T=x;do if(w=!1,T.steiner||!Dl(T,T.next)&&hi(T.prev,T,T.next)!==0)T=T.next;else{if(Io(T),(T=_=T.prev)===T.next)break;w=!0}while(w||T!==_);return _}function To(x,_,w,T,P,B,L){if(x){!L&&B&&function(X,Y,te,re){var se=X;do se.z===0&&(se.z=gc(se.x,se.y,Y,te,re)),se.prevZ=se.prev,se.nextZ=se.next,se=se.next;while(se!==X);se.prevZ.nextZ=null,se.prevZ=null,function(ue){var me,xe,Me,ve,Ie,Oe,Ue,it,ot=1;do{for(xe=ue,ue=null,Ie=null,Oe=0;xe;){for(Oe++,Me=xe,Ue=0,me=0;me<ot&&(Ue++,Me=Me.nextZ);me++);for(it=ot;Ue>0||it>0&&Me;)Ue!==0&&(it===0||!Me||xe.z<=Me.z)?(ve=xe,xe=xe.nextZ,Ue--):(ve=Me,Me=Me.nextZ,it--),Ie?Ie.nextZ=ve:ue=ve,ve.prevZ=Ie,Ie=ve;xe=Me}Ie.nextZ=null,ot*=2}while(Oe>1)}(se)}(x,T,P,B);for(var O,V,W=x;x.prev!==x.next;)if(O=x.prev,V=x.next,B?Oh(x,T,P,B):Fh(x))_.push(O.i/w|0),_.push(x.i/w|0),_.push(V.i/w|0),Io(x),x=V.next,W=V.next;else if((x=V)===W){L?L===1?To(x=$h(Ns(x),_,w),_,w,T,P,B,2):L===2&&Nh(x,_,w,T,P,B):To(Ns(x),_,w,T,P,B,1);break}}}function Fh(x){var _=x.prev,w=x,T=x.next;if(hi(_,w,T)>=0)return!1;for(var P=_.x,B=w.x,L=T.x,O=_.y,V=w.y,W=T.y,X=P<B?P<L?P:L:B<L?B:L,Y=O<V?O<W?O:W:V<W?V:W,te=P>B?P>L?P:L:B>L?B:L,re=O>V?O>W?O:W:V>W?V:W,se=T.next;se!==_;){if(se.x>=X&&se.x<=te&&se.y>=Y&&se.y<=re&&ba(P,O,B,V,L,W,se.x,se.y)&&hi(se.prev,se,se.next)>=0)return!1;se=se.next}return!0}function Oh(x,_,w,T){var P=x.prev,B=x,L=x.next;if(hi(P,B,L)>=0)return!1;for(var O=P.x,V=B.x,W=L.x,X=P.y,Y=B.y,te=L.y,re=O<V?O<W?O:W:V<W?V:W,se=X<Y?X<te?X:te:Y<te?Y:te,ue=O>V?O>W?O:W:V>W?V:W,me=X>Y?X>te?X:te:Y>te?Y:te,xe=gc(re,se,_,w,T),Me=gc(ue,me,_,w,T),ve=x.prevZ,Ie=x.nextZ;ve&&ve.z>=xe&&Ie&&Ie.z<=Me;){if(ve.x>=re&&ve.x<=ue&&ve.y>=se&&ve.y<=me&&ve!==P&&ve!==L&&ba(O,X,V,Y,W,te,ve.x,ve.y)&&hi(ve.prev,ve,ve.next)>=0||(ve=ve.prevZ,Ie.x>=re&&Ie.x<=ue&&Ie.y>=se&&Ie.y<=me&&Ie!==P&&Ie!==L&&ba(O,X,V,Y,W,te,Ie.x,Ie.y)&&hi(Ie.prev,Ie,Ie.next)>=0))return!1;Ie=Ie.nextZ}for(;ve&&ve.z>=xe;){if(ve.x>=re&&ve.x<=ue&&ve.y>=se&&ve.y<=me&&ve!==P&&ve!==L&&ba(O,X,V,Y,W,te,ve.x,ve.y)&&hi(ve.prev,ve,ve.next)>=0)return!1;ve=ve.prevZ}for(;Ie&&Ie.z<=Me;){if(Ie.x>=re&&Ie.x<=ue&&Ie.y>=se&&Ie.y<=me&&Ie!==P&&Ie!==L&&ba(O,X,V,Y,W,te,Ie.x,Ie.y)&&hi(Ie.prev,Ie,Ie.next)>=0)return!1;Ie=Ie.nextZ}return!0}function $h(x,_,w){var T=x;do{var P=T.prev,B=T.next.next;!Dl(P,B)&&cu(P,T,T.next,B)&&Ao(P,B)&&Ao(B,P)&&(_.push(P.i/w|0),_.push(T.i/w|0),_.push(B.i/w|0),Io(T),Io(T.next),T=x=B),T=T.next}while(T!==x);return Ns(T)}function Nh(x,_,w,T,P,B){var L=x;do{for(var O=L.next.next;O!==L.prev;){if(L.i!==O.i&&Hh(L,O)){var V=uu(L,O);return L=Ns(L,L.next),V=Ns(V,V.next),To(L,_,w,T,P,B,0),void To(V,_,w,T,P,B,0)}O=O.next}L=L.next}while(L!==x)}function Uh(x,_){return x.x-_.x}function Vh(x,_){var w=function(P,B){var L,O=B,V=P.x,W=P.y,X=-1/0;do{if(W<=O.y&&W>=O.next.y&&O.next.y!==O.y){var Y=O.x+(W-O.y)*(O.next.x-O.x)/(O.next.y-O.y);if(Y<=V&&Y>X&&(X=Y,L=O.x<O.next.x?O:O.next,Y===V))return L}O=O.next}while(O!==B);if(!L)return null;var te,re=L,se=L.x,ue=L.y,me=1/0;O=L;do V>=O.x&&O.x>=se&&V!==O.x&&ba(W<ue?V:X,W,se,ue,W<ue?X:V,W,O.x,O.y)&&(te=Math.abs(W-O.y)/(V-O.x),Ao(O,P)&&(te<me||te===me&&(O.x>L.x||O.x===L.x&&qh(L,O)))&&(L=O,me=te)),O=O.next;while(O!==re);return L}(x,_);if(!w)return _;var T=uu(w,x);return Ns(T,T.next),Ns(w,w.next)}function qh(x,_){return hi(x.prev,x,_.prev)<0&&hi(_.next,x,x.next)<0}function gc(x,_,w,T,P){return(x=1431655765&((x=858993459&((x=252645135&((x=16711935&((x=(x-w)*P|0)|x<<8))|x<<4))|x<<2))|x<<1))|(_=1431655765&((_=858993459&((_=252645135&((_=16711935&((_=(_-T)*P|0)|_<<8))|_<<4))|_<<2))|_<<1))<<1}function jh(x){var _=x,w=x;do(_.x<w.x||_.x===w.x&&_.y<w.y)&&(w=_),_=_.next;while(_!==x);return w}function ba(x,_,w,T,P,B,L,O){return(P-L)*(_-O)>=(x-L)*(B-O)&&(x-L)*(T-O)>=(w-L)*(_-O)&&(w-L)*(B-O)>=(P-L)*(T-O)}function Hh(x,_){return x.next.i!==_.i&&x.prev.i!==_.i&&!function(w,T){var P=w;do{if(P.i!==w.i&&P.next.i!==w.i&&P.i!==T.i&&P.next.i!==T.i&&cu(P,P.next,w,T))return!0;P=P.next}while(P!==w);return!1}(x,_)&&(Ao(x,_)&&Ao(_,x)&&function(w,T){var P=w,B=!1,L=(w.x+T.x)/2,O=(w.y+T.y)/2;do P.y>O!=P.next.y>O&&P.next.y!==P.y&&L<(P.next.x-P.x)*(O-P.y)/(P.next.y-P.y)+P.x&&(B=!B),P=P.next;while(P!==w);return B}(x,_)&&(hi(x.prev,x,_.prev)||hi(x,_.prev,_))||Dl(x,_)&&hi(x.prev,x,x.next)>0&&hi(_.prev,_,_.next)>0)}function hi(x,_,w){return(_.y-x.y)*(w.x-_.x)-(_.x-x.x)*(w.y-_.y)}function Dl(x,_){return x.x===_.x&&x.y===_.y}function cu(x,_,w,T){var P=zl(hi(x,_,w)),B=zl(hi(x,_,T)),L=zl(hi(w,T,x)),O=zl(hi(w,T,_));return P!==B&&L!==O||!(P!==0||!kl(x,w,_))||!(B!==0||!kl(x,T,_))||!(L!==0||!kl(w,x,T))||!(O!==0||!kl(w,_,T))}function kl(x,_,w){return _.x<=Math.max(x.x,w.x)&&_.x>=Math.min(x.x,w.x)&&_.y<=Math.max(x.y,w.y)&&_.y>=Math.min(x.y,w.y)}function zl(x){return x>0?1:x<0?-1:0}function Ao(x,_){return hi(x.prev,x,x.next)<0?hi(x,_,x.next)>=0&&hi(x,x.prev,_)>=0:hi(x,_,x.prev)<0||hi(x,x.next,_)<0}function uu(x,_){var w=new _c(x.i,x.x,x.y),T=new _c(_.i,_.x,_.y),P=x.next,B=_.prev;return x.next=_,_.prev=x,w.next=P,P.prev=w,T.next=w,w.prev=T,B.next=T,T.prev=B,T}function hu(x,_,w,T){var P=new _c(x,_,w);return T?(P.next=T.next,P.prev=T,T.next.prev=P,T.next=P):(P.prev=P,P.next=P),P}function Io(x){x.next.prev=x.prev,x.prev.next=x.next,x.prevZ&&(x.prevZ.nextZ=x.nextZ),x.nextZ&&(x.nextZ.prevZ=x.prevZ)}function _c(x,_,w){this.i=x,this.x=_,this.y=w,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function yc(x,_,w,T){for(var P=0,B=_,L=w-T;B<w;B+=T)P+=(x[L]-x[B])*(x[B+1]+x[L+1]),L=B;return P}mc.exports=Rl,mc.exports.default=Rl,Rl.deviation=function(x,_,w,T){var P=_&&_.length,B=Math.abs(yc(x,0,P?_[0]*w:x.length,w));if(P)for(var L=0,O=_.length;L<O;L++)B-=Math.abs(yc(x,_[L]*w,L<O-1?_[L+1]*w:x.length,w));var V=0;for(L=0;L<T.length;L+=3){var W=T[L]*w,X=T[L+1]*w,Y=T[L+2]*w;V+=Math.abs((x[W]-x[Y])*(x[X+1]-x[W+1])-(x[W]-x[X])*(x[Y+1]-x[W+1]))}return B===0&&V===0?0:Math.abs((V-B)/B)},Rl.flatten=function(x){for(var _=x[0][0].length,w={vertices:[],holes:[],dimensions:_},T=0,P=0;P<x.length;P++){for(var B=0;B<x[P].length;B++)for(var L=0;L<_;L++)w.vertices.push(x[P][B][L]);P>0&&w.holes.push(T+=x[P-1].length)}return w};var du=ye(mc.exports);function Gh(x,_,w,T,P){pu(x,_,w||0,T||x.length-1,P||Zh)}function pu(x,_,w,T,P){for(;T>w;){if(T-w>600){var B=T-w+1,L=_-w+1,O=Math.log(B),V=.5*Math.exp(2*O/3),W=.5*Math.sqrt(O*V*(B-V)/B)*(L-B/2<0?-1:1);pu(x,_,Math.max(w,Math.floor(_-L*V/B+W)),Math.min(T,Math.floor(_+(B-L)*V/B+W)),P)}var X=x[_],Y=w,te=T;for(Co(x,w,_),P(x[T],X)>0&&Co(x,w,T);Y<te;){for(Co(x,Y,te),Y++,te--;P(x[Y],X)<0;)Y++;for(;P(x[te],X)>0;)te--}P(x[w],X)===0?Co(x,w,te):Co(x,++te,T),te<=_&&(w=te+1),_<=te&&(T=te-1)}}function Co(x,_,w){var T=x[_];x[_]=x[w],x[w]=T}function Zh(x,_){return x<_?-1:x>_?1:0}function xc(x,_){const w=x.length;if(w<=1)return[x];const T=[];let P,B;for(let L=0;L<w;L++){const O=pn(x[L]);O!==0&&(x[L].area=Math.abs(O),B===void 0&&(B=O<0),B===O<0?(P&&T.push(P),P=[x[L]]):P.push(x[L]))}if(P&&T.push(P),_>1)for(let L=0;L<T.length;L++)T[L].length<=_||(Gh(T[L],_,1,T[L].length-1,Wh),T[L]=T[L].slice(0,_));return T}function Wh(x,_){return _.area-x.area}function vc(x,_,w){const T=w.patternDependencies;let P=!1;for(const B of _){const L=B.paint.get(`${x}-pattern`);L.isConstant()||(P=!0);const O=L.constantOr(null);O&&(P=!0,T[O.to]=!0,T[O.from]=!0)}return P}function bc(x,_,w,T,P){const B=P.patternDependencies;for(const L of _){const O=L.paint.get(`${x}-pattern`).value;if(O.kind!=="constant"){let V=O.evaluate({zoom:T-1},w,{},P.availableImages),W=O.evaluate({zoom:T},w,{},P.availableImages),X=O.evaluate({zoom:T+1},w,{},P.availableImages);V=V&&V.name?V.name:V,W=W&&W.name?W.name:W,X=X&&X.name?X.name:X,B[V]=!0,B[W]=!0,B[X]=!0,w.patterns[L.id]={min:V,mid:W,max:X}}}return w}class wc{constructor(_){this.zoom=_.zoom,this.overscaling=_.overscaling,this.layers=_.layers,this.layerIds=this.layers.map(w=>w.id),this.index=_.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ne,this.indexArray=new ze,this.indexArray2=new Be,this.programConfigurations=new Jt(_.layers,_.zoom),this.segments=new je,this.segments2=new je,this.stateDependentLayerIds=this.layers.filter(w=>w.isStateDependent()).map(w=>w.id)}populate(_,w,T){this.hasPattern=vc("fill",this.layers,w);const P=this.layers[0].layout.get("fill-sort-key"),B=!P.isConstant(),L=[];for(const{feature:O,id:V,index:W,sourceLayerIndex:X}of _){const Y=this.layers[0]._featureFilter.needGeometry,te=kn(O,Y);if(!this.layers[0]._featureFilter.filter(new Kt(this.zoom),te,T))continue;const re=B?P.evaluate(te,{},T,w.availableImages):void 0,se={id:V,properties:O.properties,type:O.type,sourceLayerIndex:X,index:W,geometry:Y?te.geometry:Dn(O),patterns:{},sortKey:re};L.push(se)}B&&L.sort((O,V)=>O.sortKey-V.sortKey);for(const O of L){const{geometry:V,index:W,sourceLayerIndex:X}=O;if(this.hasPattern){const Y=bc("fill",this.layers,O,this.zoom,w);this.patternFeatures.push(Y)}else this.addFeature(O,V,W,T,{});w.featureIndex.insert(_[W].feature,V,W,X,this.index)}}update(_,w,T){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(_,w,this.stateDependentLayers,T)}addFeatures(_,w,T){for(const P of this.patternFeatures)this.addFeature(P,P.geometry,P.index,w,T)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(_){this.uploaded||(this.layoutVertexBuffer=_.createVertexBuffer(this.layoutVertexArray,Lh),this.indexBuffer=_.createIndexBuffer(this.indexArray),this.indexBuffer2=_.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(_),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(_,w,T,P,B){for(const L of xc(w,500)){let O=0;for(const re of L)O+=re.length;const V=this.segments.prepareSegment(O,this.layoutVertexArray,this.indexArray),W=V.vertexLength,X=[],Y=[];for(const re of L){if(re.length===0)continue;re!==L[0]&&Y.push(X.length/2);const se=this.segments2.prepareSegment(re.length,this.layoutVertexArray,this.indexArray2),ue=se.vertexLength;this.layoutVertexArray.emplaceBack(re[0].x,re[0].y),this.indexArray2.emplaceBack(ue+re.length-1,ue),X.push(re[0].x),X.push(re[0].y);for(let me=1;me<re.length;me++)this.layoutVertexArray.emplaceBack(re[me].x,re[me].y),this.indexArray2.emplaceBack(ue+me-1,ue+me),X.push(re[me].x),X.push(re[me].y);se.vertexLength+=re.length,se.primitiveLength+=re.length}const te=du(X,Y);for(let re=0;re<te.length;re+=3)this.indexArray.emplaceBack(W+te[re],W+te[re+1],W+te[re+2]);V.vertexLength+=O,V.primitiveLength+=te.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,_,T,B,P)}}let fu,mu;st("FillBucket",wc,{omit:["layers","patternFeatures"]});var Kh={get paint(){return mu=mu||new Ki({"fill-antialias":new ut(Le.paint_fill["fill-antialias"]),"fill-opacity":new pt(Le.paint_fill["fill-opacity"]),"fill-color":new pt(Le.paint_fill["fill-color"]),"fill-outline-color":new pt(Le.paint_fill["fill-outline-color"]),"fill-translate":new ut(Le.paint_fill["fill-translate"]),"fill-translate-anchor":new ut(Le.paint_fill["fill-translate-anchor"]),"fill-pattern":new Cn(Le.paint_fill["fill-pattern"])})},get layout(){return fu=fu||new Ki({"fill-sort-key":new pt(Le.layout_fill["fill-sort-key"])})}};class Xh extends Er{constructor(_){super(_,Kh)}recalculate(_,w){super.recalculate(_,w);const T=this.paint._values["fill-outline-color"];T.value.kind==="constant"&&T.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(_){return new wc(_)}queryRadius(){return Cl(this.paint.get("fill-translate"))}queryIntersectsFeature(_,w,T,P,B,L,O){return bo(Pl(_,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),L.angle,O),P)}isTileClipped(){return!0}}const Yh=ui([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Jh=ui([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Qh}=Yh;var hs={},ed=oe,gu=wa;function wa(x,_,w,T,P){this.properties={},this.extent=w,this.type=0,this._pbf=x,this._geometry=-1,this._keys=T,this._values=P,x.readFields(td,this,_)}function td(x,_,w){x==1?_.id=w.readVarint():x==2?function(T,P){for(var B=T.readVarint()+T.pos;T.pos<B;){var L=P._keys[T.readVarint()],O=P._values[T.readVarint()];P.properties[L]=O}}(w,_):x==3?_.type=w.readVarint():x==4&&(_._geometry=w.pos)}function id(x){for(var _,w,T=0,P=0,B=x.length,L=B-1;P<B;L=P++)T+=((w=x[L]).x-(_=x[P]).x)*(_.y+w.y);return T}wa.types=["Unknown","Point","LineString","Polygon"],wa.prototype.loadGeometry=function(){var x=this._pbf;x.pos=this._geometry;for(var _,w=x.readVarint()+x.pos,T=1,P=0,B=0,L=0,O=[];x.pos<w;){if(P<=0){var V=x.readVarint();T=7&V,P=V>>3}if(P--,T===1||T===2)B+=x.readSVarint(),L+=x.readSVarint(),T===1&&(_&&O.push(_),_=[]),_.push(new ed(B,L));else{if(T!==7)throw new Error("unknown command "+T);_&&_.push(_[0].clone())}}return _&&O.push(_),O},wa.prototype.bbox=function(){var x=this._pbf;x.pos=this._geometry;for(var _=x.readVarint()+x.pos,w=1,T=0,P=0,B=0,L=1/0,O=-1/0,V=1/0,W=-1/0;x.pos<_;){if(T<=0){var X=x.readVarint();w=7&X,T=X>>3}if(T--,w===1||w===2)(P+=x.readSVarint())<L&&(L=P),P>O&&(O=P),(B+=x.readSVarint())<V&&(V=B),B>W&&(W=B);else if(w!==7)throw new Error("unknown command "+w)}return[L,V,O,W]},wa.prototype.toGeoJSON=function(x,_,w){var T,P,B=this.extent*Math.pow(2,w),L=this.extent*x,O=this.extent*_,V=this.loadGeometry(),W=wa.types[this.type];function X(re){for(var se=0;se<re.length;se++){var ue=re[se];re[se]=[360*(ue.x+L)/B-180,360/Math.PI*Math.atan(Math.exp((180-360*(ue.y+O)/B)*Math.PI/180))-90]}}switch(this.type){case 1:var Y=[];for(T=0;T<V.length;T++)Y[T]=V[T][0];X(V=Y);break;case 2:for(T=0;T<V.length;T++)X(V[T]);break;case 3:for(V=function(re){var se=re.length;if(se<=1)return[re];for(var ue,me,xe=[],Me=0;Me<se;Me++){var ve=id(re[Me]);ve!==0&&(me===void 0&&(me=ve<0),me===ve<0?(ue&&xe.push(ue),ue=[re[Me]]):ue.push(re[Me]))}return ue&&xe.push(ue),xe}(V),T=0;T<V.length;T++)for(P=0;P<V[T].length;P++)X(V[T][P])}V.length===1?V=V[0]:W="Multi"+W;var te={type:"Feature",geometry:{type:W,coordinates:V},properties:this.properties};return"id"in this&&(te.id=this.id),te};var rd=gu,_u=yu;function yu(x,_){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=x,this._keys=[],this._values=[],this._features=[],x.readFields(nd,this,_),this.length=this._features.length}function nd(x,_,w){x===15?_.version=w.readVarint():x===1?_.name=w.readString():x===5?_.extent=w.readVarint():x===2?_._features.push(w.pos):x===3?_._keys.push(w.readString()):x===4&&_._values.push(function(T){for(var P=null,B=T.readVarint()+T.pos;T.pos<B;){var L=T.readVarint()>>3;P=L===1?T.readString():L===2?T.readFloat():L===3?T.readDouble():L===4?T.readVarint64():L===5?T.readVarint():L===6?T.readSVarint():L===7?T.readBoolean():null}return P}(w))}yu.prototype.feature=function(x){if(x<0||x>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[x];var _=this._pbf.readVarint()+this._pbf.pos;return new rd(this._pbf,_,this.extent,this._keys,this._values)};var sd=_u;function ad(x,_,w){if(x===3){var T=new sd(w,w.readVarint()+w.pos);T.length&&(_[T.name]=T)}}hs.VectorTile=function(x,_){this.layers=x.readFields(ad,{},_)},hs.VectorTileFeature=gu,hs.VectorTileLayer=_u;const od=hs.VectorTileFeature.types,Sc=Math.pow(2,13);function Po(x,_,w,T,P,B,L,O){x.emplaceBack(_,w,2*Math.floor(T*Sc)+L,P*Sc*2,B*Sc*2,Math.round(O))}class Ec{constructor(_){this.zoom=_.zoom,this.overscaling=_.overscaling,this.layers=_.layers,this.layerIds=this.layers.map(w=>w.id),this.index=_.index,this.hasPattern=!1,this.layoutVertexArray=new fe,this.centroidVertexArray=new J,this.indexArray=new ze,this.programConfigurations=new Jt(_.layers,_.zoom),this.segments=new je,this.stateDependentLayerIds=this.layers.filter(w=>w.isStateDependent()).map(w=>w.id)}populate(_,w,T){this.features=[],this.hasPattern=vc("fill-extrusion",this.layers,w);for(const{feature:P,id:B,index:L,sourceLayerIndex:O}of _){const V=this.layers[0]._featureFilter.needGeometry,W=kn(P,V);if(!this.layers[0]._featureFilter.filter(new Kt(this.zoom),W,T))continue;const X={id:B,sourceLayerIndex:O,index:L,geometry:V?W.geometry:Dn(P),properties:P.properties,type:P.type,patterns:{}};this.hasPattern?this.features.push(bc("fill-extrusion",this.layers,X,this.zoom,w)):this.addFeature(X,X.geometry,L,T,{}),w.featureIndex.insert(P,X.geometry,L,O,this.index,!0)}}addFeatures(_,w,T){for(const P of this.features){const{geometry:B}=P;this.addFeature(P,B,P.index,w,T)}}update(_,w,T){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(_,w,this.stateDependentLayers,T)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(_){this.uploaded||(this.layoutVertexBuffer=_.createVertexBuffer(this.layoutVertexArray,Qh),this.centroidVertexBuffer=_.createVertexBuffer(this.centroidVertexArray,Jh.members,!0),this.indexBuffer=_.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(_),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(_,w,T,P,B){const L={x:0,y:0,vertexCount:0};for(const O of xc(w,500)){let V=0;for(const se of O)V+=se.length;let W=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const se of O){if(se.length===0||cd(se))continue;let ue=0;for(let me=0;me<se.length;me++){const xe=se[me];if(me>=1){const Me=se[me-1];if(!ld(xe,Me)){W.vertexLength+4>je.MAX_VERTEX_ARRAY_LENGTH&&(W=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ve=xe.sub(Me)._perp()._unit(),Ie=Me.dist(xe);ue+Ie>32768&&(ue=0),Po(this.layoutVertexArray,xe.x,xe.y,ve.x,ve.y,0,0,ue),Po(this.layoutVertexArray,xe.x,xe.y,ve.x,ve.y,0,1,ue),L.x+=2*xe.x,L.y+=2*xe.y,L.vertexCount+=2,ue+=Ie,Po(this.layoutVertexArray,Me.x,Me.y,ve.x,ve.y,0,0,ue),Po(this.layoutVertexArray,Me.x,Me.y,ve.x,ve.y,0,1,ue),L.x+=2*Me.x,L.y+=2*Me.y,L.vertexCount+=2;const Oe=W.vertexLength;this.indexArray.emplaceBack(Oe,Oe+2,Oe+1),this.indexArray.emplaceBack(Oe+1,Oe+2,Oe+3),W.vertexLength+=4,W.primitiveLength+=2}}}}if(W.vertexLength+V>je.MAX_VERTEX_ARRAY_LENGTH&&(W=this.segments.prepareSegment(V,this.layoutVertexArray,this.indexArray)),od[_.type]!=="Polygon")continue;const X=[],Y=[],te=W.vertexLength;for(const se of O)if(se.length!==0){se!==O[0]&&Y.push(X.length/2);for(let ue=0;ue<se.length;ue++){const me=se[ue];Po(this.layoutVertexArray,me.x,me.y,0,0,1,1,0),L.x+=me.x,L.y+=me.y,L.vertexCount+=1,X.push(me.x),X.push(me.y)}}const re=du(X,Y);for(let se=0;se<re.length;se+=3)this.indexArray.emplaceBack(te+re[se],te+re[se+2],te+re[se+1]);W.primitiveLength+=re.length/3,W.vertexLength+=V}for(let O=0;O<L.vertexCount;O++)this.centroidVertexArray.emplaceBack(Math.floor(L.x/L.vertexCount),Math.floor(L.y/L.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,_,T,B,P)}}function ld(x,_){return x.x===_.x&&(x.x<0||x.x>Pt)||x.y===_.y&&(x.y<0||x.y>Pt)}function cd(x){return x.every(_=>_.x<0)||x.every(_=>_.x>Pt)||x.every(_=>_.y<0)||x.every(_=>_.y>Pt)}let xu;st("FillExtrusionBucket",Ec,{omit:["layers","features"]});var ud={get paint(){return xu=xu||new Ki({"fill-extrusion-opacity":new ut(Le["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new pt(Le["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ut(Le["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ut(Le["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Cn(Le["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new pt(Le["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new pt(Le["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ut(Le["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class hd extends Er{constructor(_){super(_,ud)}createBucket(_){return new Ec(_)}queryRadius(){return Cl(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(_,w,T,P,B,L,O,V){const W=Pl(_,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),L.angle,O),X=this.paint.get("fill-extrusion-height").evaluate(w,T),Y=this.paint.get("fill-extrusion-base").evaluate(w,T),te=function(se,ue,me,xe){const Me=[];for(const ve of se){const Ie=[ve.x,ve.y,0,1];Ml(Ie,Ie,ue),Me.push(new we(Ie[0]/Ie[3],Ie[1]/Ie[3]))}return Me}(W,V),re=function(se,ue,me,xe){const Me=[],ve=[],Ie=xe[8]*ue,Oe=xe[9]*ue,Ue=xe[10]*ue,it=xe[11]*ue,ot=xe[8]*me,tt=xe[9]*me,et=xe[10]*me,Ke=xe[11]*me;for(const at of se){const Qe=[],Ze=[];for(const dt of at){const ct=dt.x,Ct=dt.y,Yt=xe[0]*ct+xe[4]*Ct+xe[12],Qt=xe[1]*ct+xe[5]*Ct+xe[13],_i=xe[2]*ct+xe[6]*Ct+xe[14],yr=xe[3]*ct+xe[7]*Ct+xe[15],Ji=_i+Ue,fi=yr+it,Ii=Yt+ot,Bi=Qt+tt,Qi=_i+et,er=yr+Ke,yi=new we((Yt+Ie)/fi,(Qt+Oe)/fi);yi.z=Ji/fi,Qe.push(yi);const xi=new we(Ii/er,Bi/er);xi.z=Qi/er,Ze.push(xi)}Me.push(Qe),ve.push(Ze)}return[Me,ve]}(P,Y,X,V);return function(se,ue,me){let xe=1/0;bo(me,ue)&&(xe=vu(me,ue[0]));for(let Me=0;Me<ue.length;Me++){const ve=ue[Me],Ie=se[Me];for(let Oe=0;Oe<ve.length-1;Oe++){const Ue=ve[Oe],it=[Ue,ve[Oe+1],Ie[Oe+1],Ie[Oe],Ue];zn(me,it)&&(xe=Math.min(xe,vu(me,it)))}}return xe!==1/0&&xe}(re[0],re[1],te)}}function Mo(x,_){return x.x*_.x+x.y*_.y}function vu(x,_){if(x.length===1){let w=0;const T=_[w++];let P;for(;!P||T.equals(P);)if(P=_[w++],!P)return 1/0;for(;w<_.length;w++){const B=_[w],L=x[0],O=P.sub(T),V=B.sub(T),W=L.sub(T),X=Mo(O,O),Y=Mo(O,V),te=Mo(V,V),re=Mo(W,O),se=Mo(W,V),ue=X*te-Y*Y,me=(te*re-Y*se)/ue,xe=(X*se-Y*re)/ue,Me=T.z*(1-me-xe)+P.z*me+B.z*xe;if(isFinite(Me))return Me}return 1/0}{let w=1/0;for(const T of _)w=Math.min(w,T.z);return w}}const dd=ui([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:pd}=dd,fd=ui([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:md}=fd,gd=hs.VectorTileFeature.types,_d=Math.cos(Math.PI/180*37.5),bu=Math.pow(2,14)/.5;class Tc{constructor(_){this.zoom=_.zoom,this.overscaling=_.overscaling,this.layers=_.layers,this.layerIds=this.layers.map(w=>w.id),this.index=_.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(w=>{this.gradients[w.id]={}}),this.layoutVertexArray=new de,this.layoutVertexArray2=new ge,this.indexArray=new ze,this.programConfigurations=new Jt(_.layers,_.zoom),this.segments=new je,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(w=>w.isStateDependent()).map(w=>w.id)}populate(_,w,T){this.hasPattern=vc("line",this.layers,w);const P=this.layers[0].layout.get("line-sort-key"),B=!P.isConstant(),L=[];for(const{feature:O,id:V,index:W,sourceLayerIndex:X}of _){const Y=this.layers[0]._featureFilter.needGeometry,te=kn(O,Y);if(!this.layers[0]._featureFilter.filter(new Kt(this.zoom),te,T))continue;const re=B?P.evaluate(te,{},T):void 0,se={id:V,properties:O.properties,type:O.type,sourceLayerIndex:X,index:W,geometry:Y?te.geometry:Dn(O),patterns:{},sortKey:re};L.push(se)}B&&L.sort((O,V)=>O.sortKey-V.sortKey);for(const O of L){const{geometry:V,index:W,sourceLayerIndex:X}=O;if(this.hasPattern){const Y=bc("line",this.layers,O,this.zoom,w);this.patternFeatures.push(Y)}else this.addFeature(O,V,W,T,{});w.featureIndex.insert(_[W].feature,V,W,X,this.index)}}update(_,w,T){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(_,w,this.stateDependentLayers,T)}addFeatures(_,w,T){for(const P of this.patternFeatures)this.addFeature(P,P.geometry,P.index,w,T)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(_){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=_.createVertexBuffer(this.layoutVertexArray2,md)),this.layoutVertexBuffer=_.createVertexBuffer(this.layoutVertexArray,pd),this.indexBuffer=_.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(_),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(_){if(_.properties&&Object.prototype.hasOwnProperty.call(_.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(_.properties,"mapbox_clip_end"))return{start:+_.properties.mapbox_clip_start,end:+_.properties.mapbox_clip_end}}addFeature(_,w,T,P,B){const L=this.layers[0].layout,O=L.get("line-join").evaluate(_,{}),V=L.get("line-cap"),W=L.get("line-miter-limit"),X=L.get("line-round-limit");this.lineClips=this.lineFeatureClips(_);for(const Y of w)this.addLine(Y,_,O,V,W,X);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,_,T,B,P)}addLine(_,w,T,P,B,L){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let xe=0;xe<_.length-1;xe++)this.totalDistance+=_[xe].dist(_[xe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const O=gd[w.type]==="Polygon";let V=_.length;for(;V>=2&&_[V-1].equals(_[V-2]);)V--;let W=0;for(;W<V-1&&_[W].equals(_[W+1]);)W++;if(V<(O?3:2))return;T==="bevel"&&(B=1.05);const X=this.overscaling<=16?15*Pt/(512*this.overscaling):0,Y=this.segments.prepareSegment(10*V,this.layoutVertexArray,this.indexArray);let te,re,se,ue,me;this.e1=this.e2=-1,O&&(te=_[V-2],me=_[W].sub(te)._unit()._perp());for(let xe=W;xe<V;xe++){if(se=xe===V-1?O?_[W+1]:void 0:_[xe+1],se&&_[xe].equals(se))continue;me&&(ue=me),te&&(re=te),te=_[xe],me=se?se.sub(te)._unit()._perp():ue,ue=ue||me;let Me=ue.add(me);Me.x===0&&Me.y===0||Me._unit();const ve=ue.x*me.x+ue.y*me.y,Ie=Me.x*me.x+Me.y*me.y,Oe=Ie!==0?1/Ie:1/0,Ue=2*Math.sqrt(2-2*Ie),it=Ie<_d&&re&&se,ot=ue.x*me.y-ue.y*me.x>0;if(it&&xe>W){const Ke=te.dist(re);if(Ke>2*X){const at=te.sub(te.sub(re)._mult(X/Ke)._round());this.updateDistance(re,at),this.addCurrentVertex(at,ue,0,0,Y),re=at}}const tt=re&&se;let et=tt?T:O?"butt":P;if(tt&&et==="round"&&(Oe<L?et="miter":Oe<=2&&(et="fakeround")),et==="miter"&&Oe>B&&(et="bevel"),et==="bevel"&&(Oe>2&&(et="flipbevel"),Oe<B&&(et="miter")),re&&this.updateDistance(re,te),et==="miter")Me._mult(Oe),this.addCurrentVertex(te,Me,0,0,Y);else if(et==="flipbevel"){if(Oe>100)Me=me.mult(-1);else{const Ke=Oe*ue.add(me).mag()/ue.sub(me).mag();Me._perp()._mult(Ke*(ot?-1:1))}this.addCurrentVertex(te,Me,0,0,Y),this.addCurrentVertex(te,Me.mult(-1),0,0,Y)}else if(et==="bevel"||et==="fakeround"){const Ke=-Math.sqrt(Oe*Oe-1),at=ot?Ke:0,Qe=ot?0:Ke;if(re&&this.addCurrentVertex(te,ue,at,Qe,Y),et==="fakeround"){const Ze=Math.round(180*Ue/Math.PI/20);for(let dt=1;dt<Ze;dt++){let ct=dt/Ze;if(ct!==.5){const Yt=ct-.5;ct+=ct*Yt*(ct-1)*((1.0904+ve*(ve*(3.55645-1.43519*ve)-3.2452))*Yt*Yt+(.848013+ve*(.215638*ve-1.06021)))}const Ct=me.sub(ue)._mult(ct)._add(ue)._unit()._mult(ot?-1:1);this.addHalfVertex(te,Ct.x,Ct.y,!1,ot,0,Y)}}se&&this.addCurrentVertex(te,me,-at,-Qe,Y)}else if(et==="butt")this.addCurrentVertex(te,Me,0,0,Y);else if(et==="square"){const Ke=re?1:-1;this.addCurrentVertex(te,Me,Ke,Ke,Y)}else et==="round"&&(re&&(this.addCurrentVertex(te,ue,0,0,Y),this.addCurrentVertex(te,ue,1,1,Y,!0)),se&&(this.addCurrentVertex(te,me,-1,-1,Y,!0),this.addCurrentVertex(te,me,0,0,Y)));if(it&&xe<V-1){const Ke=te.dist(se);if(Ke>2*X){const at=te.add(se.sub(te)._mult(X/Ke)._round());this.updateDistance(te,at),this.addCurrentVertex(at,me,0,0,Y),te=at}}}}addCurrentVertex(_,w,T,P,B,L=!1){const O=w.y*P-w.x,V=-w.y-w.x*P;this.addHalfVertex(_,w.x+w.y*T,w.y-w.x*T,L,!1,T,B),this.addHalfVertex(_,O,V,L,!0,-P,B),this.distance>bu/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(_,w,T,P,B,L))}addHalfVertex({x:_,y:w},T,P,B,L,O,V){const W=.5*(this.lineClips?this.scaledDistance*(bu-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((_<<1)+(B?1:0),(w<<1)+(L?1:0),Math.round(63*T)+128,Math.round(63*P)+128,1+(O===0?0:O<0?-1:1)|(63&W)<<2,W>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const X=V.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,X),V.primitiveLength++),L?this.e2=X:this.e1=X}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(_,w){this.distance+=_.dist(w),this.updateScaledDistance()}}let wu,Su;st("LineBucket",Tc,{omit:["layers","patternFeatures"]});var Eu={get paint(){return Su=Su||new Ki({"line-opacity":new pt(Le.paint_line["line-opacity"]),"line-color":new pt(Le.paint_line["line-color"]),"line-translate":new ut(Le.paint_line["line-translate"]),"line-translate-anchor":new ut(Le.paint_line["line-translate-anchor"]),"line-width":new pt(Le.paint_line["line-width"]),"line-gap-width":new pt(Le.paint_line["line-gap-width"]),"line-offset":new pt(Le.paint_line["line-offset"]),"line-blur":new pt(Le.paint_line["line-blur"]),"line-dasharray":new oo(Le.paint_line["line-dasharray"]),"line-pattern":new Cn(Le.paint_line["line-pattern"]),"line-gradient":new zs(Le.paint_line["line-gradient"])})},get layout(){return wu=wu||new Ki({"line-cap":new ut(Le.layout_line["line-cap"]),"line-join":new pt(Le.layout_line["line-join"]),"line-miter-limit":new ut(Le.layout_line["line-miter-limit"]),"line-round-limit":new ut(Le.layout_line["line-round-limit"]),"line-sort-key":new pt(Le.layout_line["line-sort-key"])})}};class yd extends pt{possiblyEvaluate(_,w){return w=new Kt(Math.floor(w.zoom),{now:w.now,fadeDuration:w.fadeDuration,zoomHistory:w.zoomHistory,transition:w.transition}),super.possiblyEvaluate(_,w)}evaluate(_,w,T,P){return w=Pi({},w,{zoom:Math.floor(w.zoom)}),super.evaluate(_,w,T,P)}}let Bl;class xd extends Er{constructor(_){super(_,Eu),this.gradientVersion=0,Bl||(Bl=new yd(Eu.paint.properties["line-width"].specification),Bl.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(_){if(_==="line-gradient"){const w=this.gradientExpression();this.stepInterpolant=!!function(T){return T._styleExpression!==void 0}(w)&&w._styleExpression.expression instanceof Gn,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(_,w){super.recalculate(_,w),this.paint._values["line-floorwidth"]=Bl.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,_)}createBucket(_){return new Tc(_)}queryRadius(_){const w=_,T=Tu(wo("line-width",this,w),wo("line-gap-width",this,w)),P=wo("line-offset",this,w);return T/2+Math.abs(P)+Cl(this.paint.get("line-translate"))}queryIntersectsFeature(_,w,T,P,B,L,O){const V=Pl(_,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),L.angle,O),W=O/2*Tu(this.paint.get("line-width").evaluate(w,T),this.paint.get("line-gap-width").evaluate(w,T)),X=this.paint.get("line-offset").evaluate(w,T);return X&&(P=function(Y,te){const re=[];for(let se=0;se<Y.length;se++){const ue=Y[se],me=[];for(let xe=0;xe<ue.length;xe++){const Me=ue[xe-1],ve=ue[xe],Ie=ue[xe+1],Oe=xe===0?new we(0,0):ve.sub(Me)._unit()._perp(),Ue=xe===ue.length-1?new we(0,0):Ie.sub(ve)._unit()._perp(),it=Oe._add(Ue)._unit(),ot=it.x*Ue.x+it.y*Ue.y;ot!==0&&it._mult(1/ot),me.push(it._mult(te)._add(ve))}re.push(me)}return re}(P,X*O)),function(Y,te,re){for(let se=0;se<te.length;se++){const ue=te[se];if(Y.length>=3){for(let me=0;me<ue.length;me++)if(xa(Y,ue[me]))return!0}if(Al(Y,ue,re))return!0}return!1}(V,P,W)}isTileClipped(){return!0}}function Tu(x,_){return _>0?_+2*x:x}const vd=ui([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),bd=ui([{name:"a_projected_pos",components:3,type:"Float32"}],4);ui([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const wd=ui([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);ui([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Au=ui([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Sd=ui([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Ed(x,_,w){return x.sections.forEach(T=>{T.text=function(P,B,L){const O=B.layout.get("text-transform").evaluate(L,{});return O==="uppercase"?P=P.toLocaleUpperCase():O==="lowercase"&&(P=P.toLocaleLowerCase()),In.applyArabicShaping&&(P=In.applyArabicShaping(P)),P}(T.text,_,w)}),x}ui([{name:"triangle",components:3,type:"Uint16"}]),ui([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),ui([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),ui([{type:"Float32",name:"offsetX"}]),ui([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),ui([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Ro={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var gi=24,Iu=Vt,Cu=function(x,_,w,T,P){var B,L,O=8*P-T-1,V=(1<<O)-1,W=V>>1,X=-7,Y=w?P-1:0,te=w?-1:1,re=x[_+Y];for(Y+=te,B=re&(1<<-X)-1,re>>=-X,X+=O;X>0;B=256*B+x[_+Y],Y+=te,X-=8);for(L=B&(1<<-X)-1,B>>=-X,X+=T;X>0;L=256*L+x[_+Y],Y+=te,X-=8);if(B===0)B=1-W;else{if(B===V)return L?NaN:1/0*(re?-1:1);L+=Math.pow(2,T),B-=W}return(re?-1:1)*L*Math.pow(2,B-T)},Pu=function(x,_,w,T,P,B){var L,O,V,W=8*B-P-1,X=(1<<W)-1,Y=X>>1,te=P===23?Math.pow(2,-24)-Math.pow(2,-77):0,re=T?0:B-1,se=T?1:-1,ue=_<0||_===0&&1/_<0?1:0;for(_=Math.abs(_),isNaN(_)||_===1/0?(O=isNaN(_)?1:0,L=X):(L=Math.floor(Math.log(_)/Math.LN2),_*(V=Math.pow(2,-L))<1&&(L--,V*=2),(_+=L+Y>=1?te/V:te*Math.pow(2,1-Y))*V>=2&&(L++,V/=2),L+Y>=X?(O=0,L=X):L+Y>=1?(O=(_*V-1)*Math.pow(2,P),L+=Y):(O=_*Math.pow(2,Y-1)*Math.pow(2,P),L=0));P>=8;x[w+re]=255&O,re+=se,O/=256,P-=8);for(L=L<<P|O,W+=P;W>0;x[w+re]=255&L,re+=se,L/=256,W-=8);x[w+re-se]|=128*ue};function Vt(x){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(x)?x:new Uint8Array(x||0),this.pos=0,this.type=0,this.length=this.buf.length}Vt.Varint=0,Vt.Fixed64=1,Vt.Bytes=2,Vt.Fixed32=5;var Ac=4294967296,Mu=1/Ac,Ru=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Bn(x){return x.type===Vt.Bytes?x.readVarint()+x.pos:x.pos+1}function Sa(x,_,w){return w?4294967296*_+(x>>>0):4294967296*(_>>>0)+(x>>>0)}function Du(x,_,w){var T=_<=16383?1:_<=2097151?2:_<=268435455?3:Math.floor(Math.log(_)/(7*Math.LN2));w.realloc(T);for(var P=w.pos-1;P>=x;P--)w.buf[P+T]=w.buf[P]}function Td(x,_){for(var w=0;w<x.length;w++)_.writeVarint(x[w])}function Ad(x,_){for(var w=0;w<x.length;w++)_.writeSVarint(x[w])}function Id(x,_){for(var w=0;w<x.length;w++)_.writeFloat(x[w])}function Cd(x,_){for(var w=0;w<x.length;w++)_.writeDouble(x[w])}function Pd(x,_){for(var w=0;w<x.length;w++)_.writeBoolean(x[w])}function Md(x,_){for(var w=0;w<x.length;w++)_.writeFixed32(x[w])}function Rd(x,_){for(var w=0;w<x.length;w++)_.writeSFixed32(x[w])}function Dd(x,_){for(var w=0;w<x.length;w++)_.writeFixed64(x[w])}function kd(x,_){for(var w=0;w<x.length;w++)_.writeSFixed64(x[w])}function Ll(x,_){return(x[_]|x[_+1]<<8|x[_+2]<<16)+16777216*x[_+3]}function Ea(x,_,w){x[w]=_,x[w+1]=_>>>8,x[w+2]=_>>>16,x[w+3]=_>>>24}function ku(x,_){return(x[_]|x[_+1]<<8|x[_+2]<<16)+(x[_+3]<<24)}Vt.prototype={destroy:function(){this.buf=null},readFields:function(x,_,w){for(w=w||this.length;this.pos<w;){var T=this.readVarint(),P=T>>3,B=this.pos;this.type=7&T,x(P,_,this),this.pos===B&&this.skip(T)}return _},readMessage:function(x,_){return this.readFields(x,_,this.readVarint()+this.pos)},readFixed32:function(){var x=Ll(this.buf,this.pos);return this.pos+=4,x},readSFixed32:function(){var x=ku(this.buf,this.pos);return this.pos+=4,x},readFixed64:function(){var x=Ll(this.buf,this.pos)+Ll(this.buf,this.pos+4)*Ac;return this.pos+=8,x},readSFixed64:function(){var x=Ll(this.buf,this.pos)+ku(this.buf,this.pos+4)*Ac;return this.pos+=8,x},readFloat:function(){var x=Cu(this.buf,this.pos,!0,23,4);return this.pos+=4,x},readDouble:function(){var x=Cu(this.buf,this.pos,!0,52,8);return this.pos+=8,x},readVarint:function(x){var _,w,T=this.buf;return _=127&(w=T[this.pos++]),w<128?_:(_|=(127&(w=T[this.pos++]))<<7,w<128?_:(_|=(127&(w=T[this.pos++]))<<14,w<128?_:(_|=(127&(w=T[this.pos++]))<<21,w<128?_:function(P,B,L){var O,V,W=L.buf;if(O=(112&(V=W[L.pos++]))>>4,V<128||(O|=(127&(V=W[L.pos++]))<<3,V<128)||(O|=(127&(V=W[L.pos++]))<<10,V<128)||(O|=(127&(V=W[L.pos++]))<<17,V<128)||(O|=(127&(V=W[L.pos++]))<<24,V<128)||(O|=(1&(V=W[L.pos++]))<<31,V<128))return Sa(P,O,B);throw new Error("Expected varint not more than 10 bytes")}(_|=(15&(w=T[this.pos]))<<28,x,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var x=this.readVarint();return x%2==1?(x+1)/-2:x/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var x=this.readVarint()+this.pos,_=this.pos;return this.pos=x,x-_>=12&&Ru?function(w,T,P){return Ru.decode(w.subarray(T,P))}(this.buf,_,x):function(w,T,P){for(var B="",L=T;L<P;){var O,V,W,X=w[L],Y=null,te=X>239?4:X>223?3:X>191?2:1;if(L+te>P)break;te===1?X<128&&(Y=X):te===2?(192&(O=w[L+1]))==128&&(Y=(31&X)<<6|63&O)<=127&&(Y=null):te===3?(V=w[L+2],(192&(O=w[L+1]))==128&&(192&V)==128&&((Y=(15&X)<<12|(63&O)<<6|63&V)<=2047||Y>=55296&&Y<=57343)&&(Y=null)):te===4&&(V=w[L+2],W=w[L+3],(192&(O=w[L+1]))==128&&(192&V)==128&&(192&W)==128&&((Y=(15&X)<<18|(63&O)<<12|(63&V)<<6|63&W)<=65535||Y>=1114112)&&(Y=null)),Y===null?(Y=65533,te=1):Y>65535&&(Y-=65536,B+=String.fromCharCode(Y>>>10&1023|55296),Y=56320|1023&Y),B+=String.fromCharCode(Y),L+=te}return B}(this.buf,_,x)},readBytes:function(){var x=this.readVarint()+this.pos,_=this.buf.subarray(this.pos,x);return this.pos=x,_},readPackedVarint:function(x,_){if(this.type!==Vt.Bytes)return x.push(this.readVarint(_));var w=Bn(this);for(x=x||[];this.pos<w;)x.push(this.readVarint(_));return x},readPackedSVarint:function(x){if(this.type!==Vt.Bytes)return x.push(this.readSVarint());var _=Bn(this);for(x=x||[];this.pos<_;)x.push(this.readSVarint());return x},readPackedBoolean:function(x){if(this.type!==Vt.Bytes)return x.push(this.readBoolean());var _=Bn(this);for(x=x||[];this.pos<_;)x.push(this.readBoolean());return x},readPackedFloat:function(x){if(this.type!==Vt.Bytes)return x.push(this.readFloat());var _=Bn(this);for(x=x||[];this.pos<_;)x.push(this.readFloat());return x},readPackedDouble:function(x){if(this.type!==Vt.Bytes)return x.push(this.readDouble());var _=Bn(this);for(x=x||[];this.pos<_;)x.push(this.readDouble());return x},readPackedFixed32:function(x){if(this.type!==Vt.Bytes)return x.push(this.readFixed32());var _=Bn(this);for(x=x||[];this.pos<_;)x.push(this.readFixed32());return x},readPackedSFixed32:function(x){if(this.type!==Vt.Bytes)return x.push(this.readSFixed32());var _=Bn(this);for(x=x||[];this.pos<_;)x.push(this.readSFixed32());return x},readPackedFixed64:function(x){if(this.type!==Vt.Bytes)return x.push(this.readFixed64());var _=Bn(this);for(x=x||[];this.pos<_;)x.push(this.readFixed64());return x},readPackedSFixed64:function(x){if(this.type!==Vt.Bytes)return x.push(this.readSFixed64());var _=Bn(this);for(x=x||[];this.pos<_;)x.push(this.readSFixed64());return x},skip:function(x){var _=7&x;if(_===Vt.Varint)for(;this.buf[this.pos++]>127;);else if(_===Vt.Bytes)this.pos=this.readVarint()+this.pos;else if(_===Vt.Fixed32)this.pos+=4;else{if(_!==Vt.Fixed64)throw new Error("Unimplemented type: "+_);this.pos+=8}},writeTag:function(x,_){this.writeVarint(x<<3|_)},realloc:function(x){for(var _=this.length||16;_<this.pos+x;)_*=2;if(_!==this.length){var w=new Uint8Array(_);w.set(this.buf),this.buf=w,this.length=_}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(x){this.realloc(4),Ea(this.buf,x,this.pos),this.pos+=4},writeSFixed32:function(x){this.realloc(4),Ea(this.buf,x,this.pos),this.pos+=4},writeFixed64:function(x){this.realloc(8),Ea(this.buf,-1&x,this.pos),Ea(this.buf,Math.floor(x*Mu),this.pos+4),this.pos+=8},writeSFixed64:function(x){this.realloc(8),Ea(this.buf,-1&x,this.pos),Ea(this.buf,Math.floor(x*Mu),this.pos+4),this.pos+=8},writeVarint:function(x){(x=+x||0)>268435455||x<0?function(_,w){var T,P;if(_>=0?(T=_%4294967296|0,P=_/4294967296|0):(P=~(-_/4294967296),4294967295^(T=~(-_%4294967296))?T=T+1|0:(T=0,P=P+1|0)),_>=18446744073709552e3||_<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");w.realloc(10),function(B,L,O){O.buf[O.pos++]=127&B|128,B>>>=7,O.buf[O.pos++]=127&B|128,B>>>=7,O.buf[O.pos++]=127&B|128,B>>>=7,O.buf[O.pos++]=127&B|128,O.buf[O.pos]=127&(B>>>=7)}(T,0,w),function(B,L){var O=(7&B)<<4;L.buf[L.pos++]|=O|((B>>>=3)?128:0),B&&(L.buf[L.pos++]=127&B|((B>>>=7)?128:0),B&&(L.buf[L.pos++]=127&B|((B>>>=7)?128:0),B&&(L.buf[L.pos++]=127&B|((B>>>=7)?128:0),B&&(L.buf[L.pos++]=127&B|((B>>>=7)?128:0),B&&(L.buf[L.pos++]=127&B)))))}(P,w)}(x,this):(this.realloc(4),this.buf[this.pos++]=127&x|(x>127?128:0),x<=127||(this.buf[this.pos++]=127&(x>>>=7)|(x>127?128:0),x<=127||(this.buf[this.pos++]=127&(x>>>=7)|(x>127?128:0),x<=127||(this.buf[this.pos++]=x>>>7&127))))},writeSVarint:function(x){this.writeVarint(x<0?2*-x-1:2*x)},writeBoolean:function(x){this.writeVarint(!!x)},writeString:function(x){x=String(x),this.realloc(4*x.length),this.pos++;var _=this.pos;this.pos=function(T,P,B){for(var L,O,V=0;V<P.length;V++){if((L=P.charCodeAt(V))>55295&&L<57344){if(!O){L>56319||V+1===P.length?(T[B++]=239,T[B++]=191,T[B++]=189):O=L;continue}if(L<56320){T[B++]=239,T[B++]=191,T[B++]=189,O=L;continue}L=O-55296<<10|L-56320|65536,O=null}else O&&(T[B++]=239,T[B++]=191,T[B++]=189,O=null);L<128?T[B++]=L:(L<2048?T[B++]=L>>6|192:(L<65536?T[B++]=L>>12|224:(T[B++]=L>>18|240,T[B++]=L>>12&63|128),T[B++]=L>>6&63|128),T[B++]=63&L|128)}return B}(this.buf,x,this.pos);var w=this.pos-_;w>=128&&Du(_,w,this),this.pos=_-1,this.writeVarint(w),this.pos+=w},writeFloat:function(x){this.realloc(4),Pu(this.buf,x,this.pos,!0,23,4),this.pos+=4},writeDouble:function(x){this.realloc(8),Pu(this.buf,x,this.pos,!0,52,8),this.pos+=8},writeBytes:function(x){var _=x.length;this.writeVarint(_),this.realloc(_);for(var w=0;w<_;w++)this.buf[this.pos++]=x[w]},writeRawMessage:function(x,_){this.pos++;var w=this.pos;x(_,this);var T=this.pos-w;T>=128&&Du(w,T,this),this.pos=w-1,this.writeVarint(T),this.pos+=T},writeMessage:function(x,_,w){this.writeTag(x,Vt.Bytes),this.writeRawMessage(_,w)},writePackedVarint:function(x,_){_.length&&this.writeMessage(x,Td,_)},writePackedSVarint:function(x,_){_.length&&this.writeMessage(x,Ad,_)},writePackedBoolean:function(x,_){_.length&&this.writeMessage(x,Pd,_)},writePackedFloat:function(x,_){_.length&&this.writeMessage(x,Id,_)},writePackedDouble:function(x,_){_.length&&this.writeMessage(x,Cd,_)},writePackedFixed32:function(x,_){_.length&&this.writeMessage(x,Md,_)},writePackedSFixed32:function(x,_){_.length&&this.writeMessage(x,Rd,_)},writePackedFixed64:function(x,_){_.length&&this.writeMessage(x,Dd,_)},writePackedSFixed64:function(x,_){_.length&&this.writeMessage(x,kd,_)},writeBytesField:function(x,_){this.writeTag(x,Vt.Bytes),this.writeBytes(_)},writeFixed32Field:function(x,_){this.writeTag(x,Vt.Fixed32),this.writeFixed32(_)},writeSFixed32Field:function(x,_){this.writeTag(x,Vt.Fixed32),this.writeSFixed32(_)},writeFixed64Field:function(x,_){this.writeTag(x,Vt.Fixed64),this.writeFixed64(_)},writeSFixed64Field:function(x,_){this.writeTag(x,Vt.Fixed64),this.writeSFixed64(_)},writeVarintField:function(x,_){this.writeTag(x,Vt.Varint),this.writeVarint(_)},writeSVarintField:function(x,_){this.writeTag(x,Vt.Varint),this.writeSVarint(_)},writeStringField:function(x,_){this.writeTag(x,Vt.Bytes),this.writeString(_)},writeFloatField:function(x,_){this.writeTag(x,Vt.Fixed32),this.writeFloat(_)},writeDoubleField:function(x,_){this.writeTag(x,Vt.Fixed64),this.writeDouble(_)},writeBooleanField:function(x,_){this.writeVarintField(x,!!_)}};var Ic=ye(Iu);const Cc=3;function zd(x,_,w){x===1&&w.readMessage(Bd,_)}function Bd(x,_,w){if(x===3){const{id:T,bitmap:P,width:B,height:L,left:O,top:V,advance:W}=w.readMessage(Ld,{});_.push({id:T,bitmap:new Eo({width:B+2*Cc,height:L+2*Cc},P),metrics:{width:B,height:L,left:O,top:V,advance:W}})}}function Ld(x,_,w){x===1?_.id=w.readVarint():x===2?_.bitmap=w.readBytes():x===3?_.width=w.readVarint():x===4?_.height=w.readVarint():x===5?_.left=w.readSVarint():x===6?_.top=w.readSVarint():x===7&&(_.advance=w.readVarint())}const zu=Cc;function Bu(x){let _=0,w=0;for(const L of x)_+=L.w*L.h,w=Math.max(w,L.w);x.sort((L,O)=>O.h-L.h);const T=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(_/.95)),w),h:1/0}];let P=0,B=0;for(const L of x)for(let O=T.length-1;O>=0;O--){const V=T[O];if(!(L.w>V.w||L.h>V.h)){if(L.x=V.x,L.y=V.y,B=Math.max(B,L.y+L.h),P=Math.max(P,L.x+L.w),L.w===V.w&&L.h===V.h){const W=T.pop();O<T.length&&(T[O]=W)}else L.h===V.h?(V.x+=L.w,V.w-=L.w):L.w===V.w?(V.y+=L.h,V.h-=L.h):(T.push({x:V.x+L.w,y:V.y,w:V.w-L.w,h:L.h}),V.y+=L.h,V.h-=L.h);break}}return{w:P,h:B,fill:_/(P*B)||0}}const ur=1;class Pc{constructor(_,{pixelRatio:w,version:T,stretchX:P,stretchY:B,content:L}){this.paddedRect=_,this.pixelRatio=w,this.stretchX=P,this.stretchY=B,this.content=L,this.version=T}get tl(){return[this.paddedRect.x+ur,this.paddedRect.y+ur]}get br(){return[this.paddedRect.x+this.paddedRect.w-ur,this.paddedRect.y+this.paddedRect.h-ur]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*ur)/this.pixelRatio,(this.paddedRect.h-2*ur)/this.pixelRatio]}}class Lu{constructor(_,w){const T={},P={};this.haveRenderCallbacks=[];const B=[];this.addImages(_,T,B),this.addImages(w,P,B);const{w:L,h:O}=Bu(B),V=new Ir({width:L||1,height:O||1});for(const W in _){const X=_[W],Y=T[W].paddedRect;Ir.copy(X.data,V,{x:0,y:0},{x:Y.x+ur,y:Y.y+ur},X.data)}for(const W in w){const X=w[W],Y=P[W].paddedRect,te=Y.x+ur,re=Y.y+ur,se=X.data.width,ue=X.data.height;Ir.copy(X.data,V,{x:0,y:0},{x:te,y:re},X.data),Ir.copy(X.data,V,{x:0,y:ue-1},{x:te,y:re-1},{width:se,height:1}),Ir.copy(X.data,V,{x:0,y:0},{x:te,y:re+ue},{width:se,height:1}),Ir.copy(X.data,V,{x:se-1,y:0},{x:te-1,y:re},{width:1,height:ue}),Ir.copy(X.data,V,{x:0,y:0},{x:te+se,y:re},{width:1,height:ue})}this.image=V,this.iconPositions=T,this.patternPositions=P}addImages(_,w,T){for(const P in _){const B=_[P],L={x:0,y:0,w:B.data.width+2*ur,h:B.data.height+2*ur};T.push(L),w[P]=new Pc(L,B),B.hasRenderCallback&&this.haveRenderCallbacks.push(P)}}patchUpdatedImages(_,w){_.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const T in _.updatedImages)this.patchUpdatedImage(this.iconPositions[T],_.getImage(T),w),this.patchUpdatedImage(this.patternPositions[T],_.getImage(T),w)}patchUpdatedImage(_,w,T){if(!_||!w||_.version===w.version)return;_.version=w.version;const[P,B]=_.tl;T.update(w.data,void 0,{x:P,y:B})}}var ds;st("ImagePosition",Pc),st("ImageAtlas",Lu),$.ah=void 0,(ds=$.ah||($.ah={}))[ds.none=0]="none",ds[ds.horizontal=1]="horizontal",ds[ds.vertical=2]="vertical",ds[ds.horizontalOnly=3]="horizontalOnly";const Do=-17;class ko{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(_,w){const T=new ko;return T.scale=_||1,T.fontStack=w,T}static forImage(_){const w=new ko;return w.imageName=_,w}}class Ta{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(_,w){const T=new Ta;for(let P=0;P<_.sections.length;P++){const B=_.sections[P];B.image?T.addImageSection(B):T.addTextSection(B,w)}return T}length(){return this.text.length}getSection(_){return this.sections[this.sectionIndex[_]]}getSectionIndex(_){return this.sectionIndex[_]}getCharCode(_){return this.text.charCodeAt(_)}verticalizePunctuation(){this.text=function(_){let w="";for(let T=0;T<_.length;T++){const P=_.charCodeAt(T+1)||null,B=_.charCodeAt(T-1)||null;w+=P&&io(P)&&!Ro[_[T+1]]||B&&io(B)&&!Ro[_[T-1]]||!Ro[_[T]]?_[T]:Ro[_[T]]}return w}(this.text)}trim(){let _=0;for(let T=0;T<this.text.length&&Ol[this.text.charCodeAt(T)];T++)_++;let w=this.text.length;for(let T=this.text.length-1;T>=0&&T>=_&&Ol[this.text.charCodeAt(T)];T--)w--;this.text=this.text.substring(_,w),this.sectionIndex=this.sectionIndex.slice(_,w)}substring(_,w){const T=new Ta;return T.text=this.text.substring(_,w),T.sectionIndex=this.sectionIndex.slice(_,w),T.sections=this.sections,T}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((_,w)=>Math.max(_,this.sections[w].scale),0)}addTextSection(_,w){this.text+=_.text,this.sections.push(ko.forText(_.scale,_.fontStack||w));const T=this.sections.length-1;for(let P=0;P<_.text.length;++P)this.sectionIndex.push(T)}addImageSection(_){const w=_.image?_.image.name:"";if(w.length===0)return void Mi("Can't add FormattedSection with an empty image.");const T=this.getNextImageSectionCharCode();T?(this.text+=String.fromCharCode(T),this.sections.push(ko.forImage(w)),this.sectionIndex.push(this.sections.length-1)):Mi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Fl(x,_,w,T,P,B,L,O,V,W,X,Y,te,re,se,ue){const me=Ta.fromFeature(x,P);let xe;Y===$.ah.vertical&&me.verticalizePunctuation();const{processBidirectionalText:Me,processStyledBidirectionalText:ve}=In;if(Me&&me.sections.length===1){xe=[];const Ue=Me(me.toString(),Mc(me,W,B,_,T,re,se));for(const it of Ue){const ot=new Ta;ot.text=it,ot.sections=me.sections;for(let tt=0;tt<it.length;tt++)ot.sectionIndex.push(0);xe.push(ot)}}else if(ve){xe=[];const Ue=ve(me.text,me.sectionIndex,Mc(me,W,B,_,T,re,se));for(const it of Ue){const ot=new Ta;ot.text=it[0],ot.sectionIndex=it[1],ot.sections=me.sections,xe.push(ot)}}else xe=function(Ue,it){const ot=[],tt=Ue.text;let et=0;for(const Ke of it)ot.push(Ue.substring(et,Ke)),et=Ke;return et<tt.length&&ot.push(Ue.substring(et,tt.length)),ot}(me,Mc(me,W,B,_,T,re,se));const Ie=[],Oe={positionedLines:Ie,text:me.toString(),top:X[1],bottom:X[1],left:X[0],right:X[0],writingMode:Y,iconsInText:!1,verticalizable:!1};return function(Ue,it,ot,tt,et,Ke,at,Qe,Ze,dt,ct,Ct){let Yt=0,Qt=Do,_i=0,yr=0;const Ji=Qe==="right"?1:Qe==="left"?0:.5;let fi=0;for(const yi of et){yi.trim();const xi=yi.getMaxScale(),$i=(xi-1)*gi,tr={positionedGlyphs:[],lineOffset:0};Ue.positionedLines[fi]=tr;const Ni=tr.positionedGlyphs;let hr=0;if(!yi.length()){Qt+=Ke,++fi;continue}for(let vi=0;vi<yi.length();vi++){const Rt=yi.getSection(vi),Ui=yi.getSectionIndex(vi),Li=yi.getCharCode(vi);let bi=0,Nr=null,Zr=null,Wr=null,Ln=gi;const Ur=!(Ze===$.ah.horizontal||!ct&&!ua(Li)||ct&&(Ol[Li]||(Ii=Li,rt.Arabic(Ii)||rt["Arabic Supplement"](Ii)||rt["Arabic Extended-A"](Ii)||rt["Arabic Presentation Forms-A"](Ii)||rt["Arabic Presentation Forms-B"](Ii))));if(Rt.imageName){const Pr=tt[Rt.imageName];if(!Pr)continue;Wr=Rt.imageName,Ue.iconsInText=Ue.iconsInText||!0,Zr=Pr.paddedRect;const pr=Pr.displaySize;Rt.scale=Rt.scale*gi/Ct,Nr={width:pr[0],height:pr[1],left:ur,top:-zu,advance:Ur?pr[1]:pr[0]},bi=$i+(gi-pr[1]*Rt.scale),Ln=Nr.advance;const Fn=Ur?pr[0]*Rt.scale-gi*xi:pr[1]*Rt.scale-gi*xi;Fn>0&&Fn>hr&&(hr=Fn)}else{const Pr=ot[Rt.fontStack],pr=Pr&&Pr[Li];if(pr&&pr.rect)Zr=pr.rect,Nr=pr.metrics;else{const Fn=it[Rt.fontStack],Oo=Fn&&Fn[Li];if(!Oo)continue;Nr=Oo.metrics}bi=(xi-Rt.scale)*gi}Ur?(Ue.verticalizable=!0,Ni.push({glyph:Li,imageName:Wr,x:Yt,y:Qt+bi,vertical:Ur,scale:Rt.scale,fontStack:Rt.fontStack,sectionIndex:Ui,metrics:Nr,rect:Zr}),Yt+=Ln*Rt.scale+dt):(Ni.push({glyph:Li,imageName:Wr,x:Yt,y:Qt+bi,vertical:Ur,scale:Rt.scale,fontStack:Rt.fontStack,sectionIndex:Ui,metrics:Nr,rect:Zr}),Yt+=Nr.advance*Rt.scale+dt)}Ni.length!==0&&(_i=Math.max(Yt-dt,_i),$d(Ni,0,Ni.length-1,Ji,hr)),Yt=0;const dr=Ke*xi+hr;tr.lineOffset=Math.max(hr,$i),Qt+=dr,yr=Math.max(dr,yr),++fi}var Ii;const Bi=Qt-Do,{horizontalAlign:Qi,verticalAlign:er}=Rc(at);(function(yi,xi,$i,tr,Ni,hr,dr,vi,Rt){const Ui=(xi-$i)*Ni;let Li=0;Li=hr!==dr?-vi*tr-Do:(-tr*Rt+.5)*dr;for(const bi of yi)for(const Nr of bi.positionedGlyphs)Nr.x+=Ui,Nr.y+=Li})(Ue.positionedLines,Ji,Qi,er,_i,yr,Ke,Bi,et.length),Ue.top+=-er*Bi,Ue.bottom=Ue.top+Bi,Ue.left+=-Qi*_i,Ue.right=Ue.left+_i}(Oe,_,w,T,xe,L,O,V,Y,W,te,ue),!function(Ue){for(const it of Ue)if(it.positionedGlyphs.length!==0)return!1;return!0}(Ie)&&Oe}const Ol={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Fd={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Fu(x,_,w,T,P,B){if(_.imageName){const L=T[_.imageName];return L?L.displaySize[0]*_.scale*gi/B+P:0}{const L=w[_.fontStack],O=L&&L[x];return O?O.metrics.advance*_.scale+P:0}}function Ou(x,_,w,T){const P=Math.pow(x-_,2);return T?x<_?P/2:2*P:P+Math.abs(w)*w}function Od(x,_,w){let T=0;return x===10&&(T-=1e4),w&&(T+=150),x!==40&&x!==65288||(T+=50),_!==41&&_!==65289||(T+=50),T}function $u(x,_,w,T,P,B){let L=null,O=Ou(_,w,P,B);for(const V of T){const W=Ou(_-V.x,w,P,B)+V.badness;W<=O&&(L=V,O=W)}return{index:x,x:_,priorBreak:L,badness:O}}function Nu(x){return x?Nu(x.priorBreak).concat(x.index):[]}function Mc(x,_,w,T,P,B,L){if(B!=="point")return[];if(!x)return[];const O=[],V=function(te,re,se,ue,me,xe){let Me=0;for(let ve=0;ve<te.length();ve++){const Ie=te.getSection(ve);Me+=Fu(te.getCharCode(ve),Ie,ue,me,re,xe)}return Me/Math.max(1,Math.ceil(Me/se))}(x,_,w,T,P,L),W=x.text.indexOf("")>=0;let X=0;for(let te=0;te<x.length();te++){const re=x.getSection(te),se=x.getCharCode(te);if(Ol[se]||(X+=Fu(se,re,T,P,_,L)),te<x.length()-1){const ue=!((Y=se)<11904||!(rt["Bopomofo Extended"](Y)||rt.Bopomofo(Y)||rt["CJK Compatibility Forms"](Y)||rt["CJK Compatibility Ideographs"](Y)||rt["CJK Compatibility"](Y)||rt["CJK Radicals Supplement"](Y)||rt["CJK Strokes"](Y)||rt["CJK Symbols and Punctuation"](Y)||rt["CJK Unified Ideographs Extension A"](Y)||rt["CJK Unified Ideographs"](Y)||rt["Enclosed CJK Letters and Months"](Y)||rt["Halfwidth and Fullwidth Forms"](Y)||rt.Hiragana(Y)||rt["Ideographic Description Characters"](Y)||rt["Kangxi Radicals"](Y)||rt["Katakana Phonetic Extensions"](Y)||rt.Katakana(Y)||rt["Vertical Forms"](Y)||rt["Yi Radicals"](Y)||rt["Yi Syllables"](Y)));(Fd[se]||ue||re.imageName)&&O.push($u(te+1,X,V,O,Od(se,x.getCharCode(te+1),ue&&W),!1))}}var Y;return Nu($u(x.length(),X,V,O,0,!0))}function Rc(x){let _=.5,w=.5;switch(x){case"right":case"top-right":case"bottom-right":_=1;break;case"left":case"top-left":case"bottom-left":_=0}switch(x){case"bottom":case"bottom-right":case"bottom-left":w=1;break;case"top":case"top-right":case"top-left":w=0}return{horizontalAlign:_,verticalAlign:w}}function $d(x,_,w,T,P){if(!T&&!P)return;const B=x[w],L=(x[w].x+B.metrics.advance*B.scale)*T;for(let O=_;O<=w;O++)x[O].x-=L,x[O].y+=P}function Nd(x,_,w){const{horizontalAlign:T,verticalAlign:P}=Rc(w),B=_[0]-x.displaySize[0]*T,L=_[1]-x.displaySize[1]*P;return{image:x,top:L,bottom:L+x.displaySize[1],left:B,right:B+x.displaySize[0]}}function Uu(x,_,w,T,P,B){const L=x.image;let O;if(L.content){const me=L.content,xe=L.pixelRatio||1;O=[me[0]/xe,me[1]/xe,L.displaySize[0]-me[2]/xe,L.displaySize[1]-me[3]/xe]}const V=_.left*B,W=_.right*B;let X,Y,te,re;w==="width"||w==="both"?(re=P[0]+V-T[3],Y=P[0]+W+T[1]):(re=P[0]+(V+W-L.displaySize[0])/2,Y=re+L.displaySize[0]);const se=_.top*B,ue=_.bottom*B;return w==="height"||w==="both"?(X=P[1]+se-T[0],te=P[1]+ue+T[2]):(X=P[1]+(se+ue-L.displaySize[1])/2,te=X+L.displaySize[1]),{image:L,top:X,right:Y,bottom:te,left:re,collisionPadding:O}}const zo=255,un=128,ps=zo*un;function Vu(x,_){const{expression:w}=_;if(w.kind==="constant")return{kind:"constant",layoutSize:w.evaluate(new Kt(x+1))};if(w.kind==="source")return{kind:"source"};{const{zoomStops:T,interpolationType:P}=w;let B=0;for(;B<T.length&&T[B]<=x;)B++;B=Math.max(0,B-1);let L=B;for(;L<T.length&&T[L]<x+1;)L++;L=Math.min(T.length-1,L);const O=T[B],V=T[L];return w.kind==="composite"?{kind:"composite",minZoom:O,maxZoom:V,interpolationType:P}:{kind:"camera",minZoom:O,maxZoom:V,minSize:w.evaluate(new Kt(O)),maxSize:w.evaluate(new Kt(V)),interpolationType:P}}}function Dc(x,_,w){let T="never";const P=x.get(_);return P?T=P:x.get(w)&&(T="always"),T}const Ud=hs.VectorTileFeature.types,Vd=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function $l(x,_,w,T,P,B,L,O,V,W,X,Y,te){const re=O?Math.min(ps,Math.round(O[0])):0,se=O?Math.min(ps,Math.round(O[1])):0;x.emplaceBack(_,w,Math.round(32*T),Math.round(32*P),B,L,(re<<1)+(V?1:0),se,16*W,16*X,256*Y,256*te)}function kc(x,_,w){x.emplaceBack(_.x,_.y,w),x.emplaceBack(_.x,_.y,w),x.emplaceBack(_.x,_.y,w),x.emplaceBack(_.x,_.y,w)}function qd(x){for(const _ of x.sections)if(yl(_.text))return!0;return!1}class zc{constructor(_){this.layoutVertexArray=new Se,this.indexArray=new ze,this.programConfigurations=_,this.segments=new je,this.dynamicLayoutVertexArray=new De,this.opacityVertexArray=new _e,this.hasVisibleVertices=!1,this.placedSymbolArray=new y}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(_,w,T,P){this.isEmpty()||(T&&(this.layoutVertexBuffer=_.createVertexBuffer(this.layoutVertexArray,vd.members),this.indexBuffer=_.createIndexBuffer(this.indexArray,w),this.dynamicLayoutVertexBuffer=_.createVertexBuffer(this.dynamicLayoutVertexArray,bd.members,!0),this.opacityVertexBuffer=_.createVertexBuffer(this.opacityVertexArray,Vd,!0),this.opacityVertexBuffer.itemSize=1),(T||P)&&this.programConfigurations.upload(_))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}st("SymbolBuffers",zc);class Bc{constructor(_,w,T){this.layoutVertexArray=new _,this.layoutAttributes=w,this.indexArray=new T,this.segments=new je,this.collisionVertexArray=new ke}upload(_){this.layoutVertexBuffer=_.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=_.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=_.createVertexBuffer(this.collisionVertexArray,wd.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}st("CollisionBuffers",Bc);class Aa{constructor(_){this.collisionBoxArray=_.collisionBoxArray,this.zoom=_.zoom,this.overscaling=_.overscaling,this.layers=_.layers,this.layerIds=this.layers.map(L=>L.id),this.index=_.index,this.pixelRatio=_.pixelRatio,this.sourceLayerIndex=_.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=dc([]),this.placementViewportMatrix=dc([]);const w=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Vu(this.zoom,w["text-size"]),this.iconSizeData=Vu(this.zoom,w["icon-size"]);const T=this.layers[0].layout,P=T.get("symbol-sort-key"),B=T.get("symbol-z-order");this.canOverlap=Dc(T,"text-overlap","text-allow-overlap")!=="never"||Dc(T,"icon-overlap","icon-allow-overlap")!=="never"||T.get("text-ignore-placement")||T.get("icon-ignore-placement"),this.sortFeaturesByKey=B!=="viewport-y"&&!P.isConstant(),this.sortFeaturesByY=(B==="viewport-y"||B==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,T.get("symbol-placement")==="point"&&(this.writingModes=T.get("text-writing-mode").map(L=>$.ah[L])),this.stateDependentLayerIds=this.layers.filter(L=>L.isStateDependent()).map(L=>L.id),this.sourceID=_.sourceID}createArrays(){this.text=new zc(new Jt(this.layers,this.zoom,_=>/^text/.test(_))),this.icon=new zc(new Jt(this.layers,this.zoom,_=>/^icon/.test(_))),this.glyphOffsetArray=new C,this.lineVertexArray=new z,this.symbolInstances=new I,this.textAnchorOffsets=new U}calculateGlyphDependencies(_,w,T,P,B){for(let L=0;L<_.length;L++)if(w[_.charCodeAt(L)]=!0,(T||P)&&B){const O=Ro[_.charAt(L)];O&&(w[O.charCodeAt(0)]=!0)}}populate(_,w,T){const P=this.layers[0],B=P.layout,L=B.get("text-font"),O=B.get("text-field"),V=B.get("icon-image"),W=(O.value.kind!=="constant"||O.value.value instanceof sr&&!O.value.value.isEmpty()||O.value.value.toString().length>0)&&(L.value.kind!=="constant"||L.value.value.length>0),X=V.value.kind!=="constant"||!!V.value.value||Object.keys(V.parameters).length>0,Y=B.get("symbol-sort-key");if(this.features=[],!W&&!X)return;const te=w.iconDependencies,re=w.glyphDependencies,se=w.availableImages,ue=new Kt(this.zoom);for(const{feature:me,id:xe,index:Me,sourceLayerIndex:ve}of _){const Ie=P._featureFilter.needGeometry,Oe=kn(me,Ie);if(!P._featureFilter.filter(ue,Oe,T))continue;let Ue,it;if(Ie||(Oe.geometry=Dn(me)),W){const tt=P.getValueAndResolveTokens("text-field",Oe,T,se),et=sr.factory(tt),Ke=this.hasRTLText=this.hasRTLText||qd(et);(!Ke||In.getRTLTextPluginStatus()==="unavailable"||Ke&&In.isParsed())&&(Ue=Ed(et,P,Oe))}if(X){const tt=P.getValueAndResolveTokens("icon-image",Oe,T,se);it=tt instanceof mr?tt:mr.fromString(tt)}if(!Ue&&!it)continue;const ot=this.sortFeaturesByKey?Y.evaluate(Oe,{},T):void 0;if(this.features.push({id:xe,text:Ue,icon:it,index:Me,sourceLayerIndex:ve,geometry:Oe.geometry,properties:me.properties,type:Ud[me.type],sortKey:ot}),it&&(te[it.name]=!0),Ue){const tt=L.evaluate(Oe,{},T).join(","),et=B.get("text-rotation-alignment")!=="viewport"&&B.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf($.ah.vertical)>=0;for(const Ke of Ue.sections)if(Ke.image)te[Ke.image.name]=!0;else{const at=Ds(Ue.toString()),Qe=Ke.fontStack||tt,Ze=re[Qe]=re[Qe]||{};this.calculateGlyphDependencies(Ke.text,Ze,et,this.allowVerticalPlacement,at)}}}B.get("symbol-placement")==="line"&&(this.features=function(me){const xe={},Me={},ve=[];let Ie=0;function Oe(tt){ve.push(me[tt]),Ie++}function Ue(tt,et,Ke){const at=Me[tt];return delete Me[tt],Me[et]=at,ve[at].geometry[0].pop(),ve[at].geometry[0]=ve[at].geometry[0].concat(Ke[0]),at}function it(tt,et,Ke){const at=xe[et];return delete xe[et],xe[tt]=at,ve[at].geometry[0].shift(),ve[at].geometry[0]=Ke[0].concat(ve[at].geometry[0]),at}function ot(tt,et,Ke){const at=Ke?et[0][et[0].length-1]:et[0][0];return`${tt}:${at.x}:${at.y}`}for(let tt=0;tt<me.length;tt++){const et=me[tt],Ke=et.geometry,at=et.text?et.text.toString():null;if(!at){Oe(tt);continue}const Qe=ot(at,Ke),Ze=ot(at,Ke,!0);if(Qe in Me&&Ze in xe&&Me[Qe]!==xe[Ze]){const dt=it(Qe,Ze,Ke),ct=Ue(Qe,Ze,ve[dt].geometry);delete xe[Qe],delete Me[Ze],Me[ot(at,ve[ct].geometry,!0)]=ct,ve[dt].geometry=null}else Qe in Me?Ue(Qe,Ze,Ke):Ze in xe?it(Qe,Ze,Ke):(Oe(tt),xe[Qe]=Ie-1,Me[Ze]=Ie-1)}return ve.filter(tt=>tt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((me,xe)=>me.sortKey-xe.sortKey)}update(_,w,T){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(_,w,this.layers,T),this.icon.programConfigurations.updatePaintArrays(_,w,this.layers,T))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(_){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(_),this.iconCollisionBox.upload(_)),this.text.upload(_,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(_,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(_,w){const T=this.lineVertexArray.length;if(_.segment!==void 0){let P=_.dist(w[_.segment+1]),B=_.dist(w[_.segment]);const L={};for(let O=_.segment+1;O<w.length;O++)L[O]={x:w[O].x,y:w[O].y,tileUnitDistanceFromAnchor:P},O<w.length-1&&(P+=w[O+1].dist(w[O]));for(let O=_.segment||0;O>=0;O--)L[O]={x:w[O].x,y:w[O].y,tileUnitDistanceFromAnchor:B},O>0&&(B+=w[O-1].dist(w[O]));for(let O=0;O<w.length;O++){const V=L[O];this.lineVertexArray.emplaceBack(V.x,V.y,V.tileUnitDistanceFromAnchor)}}return{lineStartIndex:T,lineLength:this.lineVertexArray.length-T}}addSymbols(_,w,T,P,B,L,O,V,W,X,Y,te){const re=_.indexArray,se=_.layoutVertexArray,ue=_.segments.prepareSegment(4*w.length,se,re,this.canOverlap?L.sortKey:void 0),me=this.glyphOffsetArray.length,xe=ue.vertexLength,Me=this.allowVerticalPlacement&&O===$.ah.vertical?Math.PI/2:0,ve=L.text&&L.text.sections;for(let Ie=0;Ie<w.length;Ie++){const{tl:Oe,tr:Ue,bl:it,br:ot,tex:tt,pixelOffsetTL:et,pixelOffsetBR:Ke,minFontScaleX:at,minFontScaleY:Qe,glyphOffset:Ze,isSDF:dt,sectionIndex:ct}=w[Ie],Ct=ue.vertexLength,Yt=Ze[1];$l(se,V.x,V.y,Oe.x,Yt+Oe.y,tt.x,tt.y,T,dt,et.x,et.y,at,Qe),$l(se,V.x,V.y,Ue.x,Yt+Ue.y,tt.x+tt.w,tt.y,T,dt,Ke.x,et.y,at,Qe),$l(se,V.x,V.y,it.x,Yt+it.y,tt.x,tt.y+tt.h,T,dt,et.x,Ke.y,at,Qe),$l(se,V.x,V.y,ot.x,Yt+ot.y,tt.x+tt.w,tt.y+tt.h,T,dt,Ke.x,Ke.y,at,Qe),kc(_.dynamicLayoutVertexArray,V,Me),re.emplaceBack(Ct,Ct+1,Ct+2),re.emplaceBack(Ct+1,Ct+2,Ct+3),ue.vertexLength+=4,ue.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ze[0]),Ie!==w.length-1&&ct===w[Ie+1].sectionIndex||_.programConfigurations.populatePaintArrays(se.length,L,L.index,{},te,ve&&ve[ct])}_.placedSymbolArray.emplaceBack(V.x,V.y,me,this.glyphOffsetArray.length-me,xe,W,X,V.segment,T?T[0]:0,T?T[1]:0,P[0],P[1],O,0,!1,0,Y)}_addCollisionDebugVertex(_,w,T,P,B,L){return w.emplaceBack(0,0),_.emplaceBack(T.x,T.y,P,B,Math.round(L.x),Math.round(L.y))}addCollisionDebugVertices(_,w,T,P,B,L,O){const V=B.segments.prepareSegment(4,B.layoutVertexArray,B.indexArray),W=V.vertexLength,X=B.layoutVertexArray,Y=B.collisionVertexArray,te=O.anchorX,re=O.anchorY;this._addCollisionDebugVertex(X,Y,L,te,re,new we(_,w)),this._addCollisionDebugVertex(X,Y,L,te,re,new we(T,w)),this._addCollisionDebugVertex(X,Y,L,te,re,new we(T,P)),this._addCollisionDebugVertex(X,Y,L,te,re,new we(_,P)),V.vertexLength+=4;const se=B.indexArray;se.emplaceBack(W,W+1),se.emplaceBack(W+1,W+2),se.emplaceBack(W+2,W+3),se.emplaceBack(W+3,W),V.primitiveLength+=4}addDebugCollisionBoxes(_,w,T,P){for(let B=_;B<w;B++){const L=this.collisionBoxArray.get(B);this.addCollisionDebugVertices(L.x1,L.y1,L.x2,L.y2,P?this.textCollisionBox:this.iconCollisionBox,L.anchorPoint,T)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Bc(Ce,Au.members,Be),this.iconCollisionBox=new Bc(Ce,Au.members,Be);for(let _=0;_<this.symbolInstances.length;_++){const w=this.symbolInstances.get(_);this.addDebugCollisionBoxes(w.textBoxStartIndex,w.textBoxEndIndex,w,!0),this.addDebugCollisionBoxes(w.verticalTextBoxStartIndex,w.verticalTextBoxEndIndex,w,!0),this.addDebugCollisionBoxes(w.iconBoxStartIndex,w.iconBoxEndIndex,w,!1),this.addDebugCollisionBoxes(w.verticalIconBoxStartIndex,w.verticalIconBoxEndIndex,w,!1)}}_deserializeCollisionBoxesForSymbol(_,w,T,P,B,L,O,V,W){const X={};for(let Y=w;Y<T;Y++){const te=_.get(Y);X.textBox={x1:te.x1,y1:te.y1,x2:te.x2,y2:te.y2,anchorPointX:te.anchorPointX,anchorPointY:te.anchorPointY},X.textFeatureIndex=te.featureIndex;break}for(let Y=P;Y<B;Y++){const te=_.get(Y);X.verticalTextBox={x1:te.x1,y1:te.y1,x2:te.x2,y2:te.y2,anchorPointX:te.anchorPointX,anchorPointY:te.anchorPointY},X.verticalTextFeatureIndex=te.featureIndex;break}for(let Y=L;Y<O;Y++){const te=_.get(Y);X.iconBox={x1:te.x1,y1:te.y1,x2:te.x2,y2:te.y2,anchorPointX:te.anchorPointX,anchorPointY:te.anchorPointY},X.iconFeatureIndex=te.featureIndex;break}for(let Y=V;Y<W;Y++){const te=_.get(Y);X.verticalIconBox={x1:te.x1,y1:te.y1,x2:te.x2,y2:te.y2,anchorPointX:te.anchorPointX,anchorPointY:te.anchorPointY},X.verticalIconFeatureIndex=te.featureIndex;break}return X}deserializeCollisionBoxes(_){this.collisionArrays=[];for(let w=0;w<this.symbolInstances.length;w++){const T=this.symbolInstances.get(w);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(_,T.textBoxStartIndex,T.textBoxEndIndex,T.verticalTextBoxStartIndex,T.verticalTextBoxEndIndex,T.iconBoxStartIndex,T.iconBoxEndIndex,T.verticalIconBoxStartIndex,T.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(_,w){const T=_.placedSymbolArray.get(w),P=T.vertexStartIndex+4*T.numGlyphs;for(let B=T.vertexStartIndex;B<P;B+=4)_.indexArray.emplaceBack(B,B+1,B+2),_.indexArray.emplaceBack(B+1,B+2,B+3)}getSortedSymbolIndexes(_){if(this.sortedAngle===_&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const w=Math.sin(_),T=Math.cos(_),P=[],B=[],L=[];for(let O=0;O<this.symbolInstances.length;++O){L.push(O);const V=this.symbolInstances.get(O);P.push(0|Math.round(w*V.anchorX+T*V.anchorY)),B.push(V.featureIndex)}return L.sort((O,V)=>P[O]-P[V]||B[V]-B[O]),L}addToSortKeyRanges(_,w){const T=this.sortKeyRanges[this.sortKeyRanges.length-1];T&&T.sortKey===w?T.symbolInstanceEnd=_+1:this.sortKeyRanges.push({sortKey:w,symbolInstanceStart:_,symbolInstanceEnd:_+1})}sortFeatures(_){if(this.sortFeaturesByY&&this.sortedAngle!==_&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(_),this.sortedAngle=_,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const w of this.symbolInstanceIndexes){const T=this.symbolInstances.get(w);this.featureSortOrder.push(T.featureIndex),[T.rightJustifiedTextSymbolIndex,T.centerJustifiedTextSymbolIndex,T.leftJustifiedTextSymbolIndex].forEach((P,B,L)=>{P>=0&&L.indexOf(P)===B&&this.addIndicesForPlacedSymbol(this.text,P)}),T.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,T.verticalPlacedTextSymbolIndex),T.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,T.placedIconSymbolIndex),T.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,T.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let qu,ju;st("SymbolBucket",Aa,{omit:["layers","collisionBoxArray","features","compareText"]}),Aa.MAX_GLYPHS=65535,Aa.addDynamicAttributes=kc;var Lc={get paint(){return ju=ju||new Ki({"icon-opacity":new pt(Le.paint_symbol["icon-opacity"]),"icon-color":new pt(Le.paint_symbol["icon-color"]),"icon-halo-color":new pt(Le.paint_symbol["icon-halo-color"]),"icon-halo-width":new pt(Le.paint_symbol["icon-halo-width"]),"icon-halo-blur":new pt(Le.paint_symbol["icon-halo-blur"]),"icon-translate":new ut(Le.paint_symbol["icon-translate"]),"icon-translate-anchor":new ut(Le.paint_symbol["icon-translate-anchor"]),"text-opacity":new pt(Le.paint_symbol["text-opacity"]),"text-color":new pt(Le.paint_symbol["text-color"],{runtimeType:Ai,getOverride:x=>x.textColor,hasOverride:x=>!!x.textColor}),"text-halo-color":new pt(Le.paint_symbol["text-halo-color"]),"text-halo-width":new pt(Le.paint_symbol["text-halo-width"]),"text-halo-blur":new pt(Le.paint_symbol["text-halo-blur"]),"text-translate":new ut(Le.paint_symbol["text-translate"]),"text-translate-anchor":new ut(Le.paint_symbol["text-translate-anchor"])})},get layout(){return qu=qu||new Ki({"symbol-placement":new ut(Le.layout_symbol["symbol-placement"]),"symbol-spacing":new ut(Le.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ut(Le.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new pt(Le.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ut(Le.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ut(Le.layout_symbol["icon-allow-overlap"]),"icon-overlap":new ut(Le.layout_symbol["icon-overlap"]),"icon-ignore-placement":new ut(Le.layout_symbol["icon-ignore-placement"]),"icon-optional":new ut(Le.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ut(Le.layout_symbol["icon-rotation-alignment"]),"icon-size":new pt(Le.layout_symbol["icon-size"]),"icon-text-fit":new ut(Le.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ut(Le.layout_symbol["icon-text-fit-padding"]),"icon-image":new pt(Le.layout_symbol["icon-image"]),"icon-rotate":new pt(Le.layout_symbol["icon-rotate"]),"icon-padding":new pt(Le.layout_symbol["icon-padding"]),"icon-keep-upright":new ut(Le.layout_symbol["icon-keep-upright"]),"icon-offset":new pt(Le.layout_symbol["icon-offset"]),"icon-anchor":new pt(Le.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ut(Le.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ut(Le.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ut(Le.layout_symbol["text-rotation-alignment"]),"text-field":new pt(Le.layout_symbol["text-field"]),"text-font":new pt(Le.layout_symbol["text-font"]),"text-size":new pt(Le.layout_symbol["text-size"]),"text-max-width":new pt(Le.layout_symbol["text-max-width"]),"text-line-height":new ut(Le.layout_symbol["text-line-height"]),"text-letter-spacing":new pt(Le.layout_symbol["text-letter-spacing"]),"text-justify":new pt(Le.layout_symbol["text-justify"]),"text-radial-offset":new pt(Le.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ut(Le.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new pt(Le.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new pt(Le.layout_symbol["text-anchor"]),"text-max-angle":new ut(Le.layout_symbol["text-max-angle"]),"text-writing-mode":new ut(Le.layout_symbol["text-writing-mode"]),"text-rotate":new pt(Le.layout_symbol["text-rotate"]),"text-padding":new ut(Le.layout_symbol["text-padding"]),"text-keep-upright":new ut(Le.layout_symbol["text-keep-upright"]),"text-transform":new pt(Le.layout_symbol["text-transform"]),"text-offset":new pt(Le.layout_symbol["text-offset"]),"text-allow-overlap":new ut(Le.layout_symbol["text-allow-overlap"]),"text-overlap":new ut(Le.layout_symbol["text-overlap"]),"text-ignore-placement":new ut(Le.layout_symbol["text-ignore-placement"]),"text-optional":new ut(Le.layout_symbol["text-optional"])})}};class Hu{constructor(_){if(_.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=_.property.overrides?_.property.overrides.runtimeType:xn,this.defaultValue=_}evaluate(_){if(_.formattedSection){const w=this.defaultValue.property.overrides;if(w&&w.hasOverride(_.formattedSection))return w.getOverride(_.formattedSection)}return _.feature&&_.featureState?this.defaultValue.evaluate(_.feature,_.featureState):this.defaultValue.property.specification.default}eachChild(_){this.defaultValue.isConstant()||_(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}st("FormatSectionOverride",Hu,{omit:["defaultValue"]});class Nl extends Er{constructor(_){super(_,Lc)}recalculate(_,w){if(super.recalculate(_,w),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const T=this.layout.get("text-writing-mode");if(T){const P=[];for(const B of T)P.indexOf(B)<0&&P.push(B);this.layout._values["text-writing-mode"]=P}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(_,w,T,P){const B=this.layout.get(_).evaluate(w,{},T,P),L=this._unevaluatedLayout._values[_];return L.isDataDriven()||Gt(L.value)||!B?B:function(O,V){return V.replace(/{([^{}]+)}/g,(W,X)=>O&&X in O?String(O[X]):"")}(w.properties,B)}createBucket(_){return new Aa(_)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const _ of Lc.paint.overridableProperties){if(!Nl.hasPaintOverride(this.layout,_))continue;const w=this.paint.get(_),T=new Hu(w),P=new Cs(T,w.property.specification);let B=null;B=w.value.kind==="constant"||w.value.kind==="source"?new Qn("source",P):new ra("composite",P,w.value.zoomStops),this.paint._values[_]=new Sr(w.property,B,w.parameters)}}_handleOverridablePaintPropertyUpdate(_,w,T){return!(!this.layout||w.isDataDriven()||T.isDataDriven())&&Nl.hasPaintOverride(this.layout,_)}static hasPaintOverride(_,w){const T=_.get("text-field"),P=Lc.paint.properties[w];let B=!1;const L=O=>{for(const V of O)if(P.overrides&&P.overrides.hasOverride(V))return void(B=!0)};if(T.value.kind==="constant"&&T.value.value instanceof sr)L(T.value.value.sections);else if(T.value.kind==="source"){const O=W=>{B||(W instanceof vn&&di(W.value)===jr?L(W.value.sections):W instanceof ia?L(W.sections):W.eachChild(O))},V=T.value;V._styleExpression&&O(V._styleExpression.expression)}return B}}let Gu;var jd={get paint(){return Gu=Gu||new Ki({"background-color":new ut(Le.paint_background["background-color"]),"background-pattern":new oo(Le.paint_background["background-pattern"]),"background-opacity":new ut(Le.paint_background["background-opacity"])})}};class Hd extends Er{constructor(_){super(_,jd)}}let Zu;var Gd={get paint(){return Zu=Zu||new Ki({"raster-opacity":new ut(Le.paint_raster["raster-opacity"]),"raster-hue-rotate":new ut(Le.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ut(Le.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ut(Le.paint_raster["raster-brightness-max"]),"raster-saturation":new ut(Le.paint_raster["raster-saturation"]),"raster-contrast":new ut(Le.paint_raster["raster-contrast"]),"raster-resampling":new ut(Le.paint_raster["raster-resampling"]),"raster-fade-duration":new ut(Le.paint_raster["raster-fade-duration"])})}};class Zd extends Er{constructor(_){super(_,Gd)}}class Wd extends Er{constructor(_){super(_,{}),this.onAdd=w=>{this.implementation.onAdd&&this.implementation.onAdd(w,w.painter.context.gl)},this.onRemove=w=>{this.implementation.onRemove&&this.implementation.onRemove(w,w.painter.context.gl)},this.implementation=_}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Kd{constructor(_){this._methodToThrottle=_,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Fc=63710088e-1;class fs{constructor(_,w){if(isNaN(_)||isNaN(w))throw new Error(`Invalid LngLat object: (${_}, ${w})`);if(this.lng=+_,this.lat=+w,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new fs(ir(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(_){const w=Math.PI/180,T=this.lat*w,P=_.lat*w,B=Math.sin(T)*Math.sin(P)+Math.cos(T)*Math.cos(P)*Math.cos((_.lng-this.lng)*w);return Fc*Math.acos(Math.min(B,1))}static convert(_){if(_ instanceof fs)return _;if(Array.isArray(_)&&(_.length===2||_.length===3))return new fs(Number(_[0]),Number(_[1]));if(!Array.isArray(_)&&typeof _=="object"&&_!==null)return new fs(Number("lng"in _?_.lng:_.lon),Number(_.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Wu=2*Math.PI*Fc;function Ku(x){return Wu*Math.cos(x*Math.PI/180)}function Xu(x){return(180+x)/360}function Yu(x){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+x*Math.PI/360)))/360}function Ju(x,_){return x/Ku(_)}function Oc(x){return 360/Math.PI*Math.atan(Math.exp((180-360*x)*Math.PI/180))-90}class Ul{constructor(_,w,T=0){this.x=+_,this.y=+w,this.z=+T}static fromLngLat(_,w=0){const T=fs.convert(_);return new Ul(Xu(T.lng),Yu(T.lat),Ju(w,T.lat))}toLngLat(){return new fs(360*this.x-180,Oc(this.y))}toAltitude(){return this.z*Ku(Oc(this.y))}meterInMercatorCoordinateUnits(){return 1/Wu*(_=Oc(this.y),1/Math.cos(_*Math.PI/180));var _}}function Qu(x,_,w){var T=2*Math.PI*6378137/256/Math.pow(2,w);return[x*T-2*Math.PI*6378137/2,_*T-2*Math.PI*6378137/2]}class $c{constructor(_,w,T){if(_<0||_>25||T<0||T>=Math.pow(2,_)||w<0||w>=Math.pow(2,_))throw new Error(`x=${w}, y=${T}, z=${_} outside of bounds. 0<=x<${Math.pow(2,_)}, 0<=y<${Math.pow(2,_)} 0<=z<=25 `);this.z=_,this.x=w,this.y=T,this.key=Bo(0,_,_,w,T)}equals(_){return this.z===_.z&&this.x===_.x&&this.y===_.y}url(_,w,T){const P=(L=this.y,O=this.z,V=Qu(256*(B=this.x),256*(L=Math.pow(2,O)-L-1),O),W=Qu(256*(B+1),256*(L+1),O),V[0]+","+V[1]+","+W[0]+","+W[1]);var B,L,O,V,W;const X=function(Y,te,re){let se,ue="";for(let me=Y;me>0;me--)se=1<<me-1,ue+=(te&se?1:0)+(re&se?2:0);return ue}(this.z,this.x,this.y);return _[(this.x+this.y)%_.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(T==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,w>1?"@2x":"").replace(/{quadkey}/g,X).replace(/{bbox-epsg-3857}/g,P)}isChildOf(_){const w=this.z-_.z;return w>0&&_.x===this.x>>w&&_.y===this.y>>w}getTilePoint(_){const w=Math.pow(2,this.z);return new we((_.x*w-this.x)*Pt,(_.y*w-this.y)*Pt)}toString(){return`${this.z}/${this.x}/${this.y}`}}class eh{constructor(_,w){this.wrap=_,this.canonical=w,this.key=Bo(_,w.z,w.z,w.x,w.y)}}class Cr{constructor(_,w,T,P,B){if(_<T)throw new Error(`overscaledZ should be >= z; overscaledZ = ${_}; z = ${T}`);this.overscaledZ=_,this.wrap=w,this.canonical=new $c(T,+P,+B),this.key=Bo(w,_,T,P,B)}clone(){return new Cr(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(_){return this.overscaledZ===_.overscaledZ&&this.wrap===_.wrap&&this.canonical.equals(_.canonical)}scaledTo(_){if(_>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${_}; overscaledZ = ${this.overscaledZ}`);const w=this.canonical.z-_;return _>this.canonical.z?new Cr(_,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Cr(_,this.wrap,_,this.canonical.x>>w,this.canonical.y>>w)}calculateScaledKey(_,w){if(_>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${_}; overscaledZ = ${this.overscaledZ}`);const T=this.canonical.z-_;return _>this.canonical.z?Bo(this.wrap*+w,_,this.canonical.z,this.canonical.x,this.canonical.y):Bo(this.wrap*+w,_,_,this.canonical.x>>T,this.canonical.y>>T)}isChildOf(_){if(_.wrap!==this.wrap)return!1;const w=this.canonical.z-_.canonical.z;return _.overscaledZ===0||_.overscaledZ<this.overscaledZ&&_.canonical.x===this.canonical.x>>w&&_.canonical.y===this.canonical.y>>w}children(_){if(this.overscaledZ>=_)return[new Cr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const w=this.canonical.z+1,T=2*this.canonical.x,P=2*this.canonical.y;return[new Cr(w,this.wrap,w,T,P),new Cr(w,this.wrap,w,T+1,P),new Cr(w,this.wrap,w,T,P+1),new Cr(w,this.wrap,w,T+1,P+1)]}isLessThan(_){return this.wrap<_.wrap||!(this.wrap>_.wrap)&&(this.overscaledZ<_.overscaledZ||!(this.overscaledZ>_.overscaledZ)&&(this.canonical.x<_.canonical.x||!(this.canonical.x>_.canonical.x)&&this.canonical.y<_.canonical.y))}wrapped(){return new Cr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(_){return new Cr(this.overscaledZ,_,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new eh(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(_){return this.canonical.getTilePoint(new Ul(_.x-this.wrap,_.y))}}function Bo(x,_,w,T,P){(x*=2)<0&&(x=-1*x-1);const B=1<<w;return(B*B*x+B*P+T).toString(36)+w.toString(36)+_.toString(36)}st("CanonicalTileID",$c),st("OverscaledTileID",Cr,{omit:["posMatrix"]});class th{constructor(_,w,T,P=1,B=1,L=1,O=0){if(this.uid=_,w.height!==w.width)throw new RangeError("DEM tiles must be square");if(T&&!["mapbox","terrarium","custom"].includes(T))return void Mi(`"${T}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=w.height;const V=this.dim=w.height-2;switch(this.data=new Uint32Array(w.data.buffer),T){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=P,this.greenFactor=B,this.blueFactor=L,this.baseShift=O;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let W=0;W<V;W++)this.data[this._idx(-1,W)]=this.data[this._idx(0,W)],this.data[this._idx(V,W)]=this.data[this._idx(V-1,W)],this.data[this._idx(W,-1)]=this.data[this._idx(W,0)],this.data[this._idx(W,V)]=this.data[this._idx(W,V-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(V,-1)]=this.data[this._idx(V-1,0)],this.data[this._idx(-1,V)]=this.data[this._idx(0,V-1)],this.data[this._idx(V,V)]=this.data[this._idx(V-1,V-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let W=0;W<V;W++)for(let X=0;X<V;X++){const Y=this.get(W,X);Y>this.max&&(this.max=Y),Y<this.min&&(this.min=Y)}}get(_,w){const T=new Uint8Array(this.data.buffer),P=4*this._idx(_,w);return this.unpack(T[P],T[P+1],T[P+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(_,w){if(_<-1||_>=this.dim+1||w<-1||w>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(w+1)*this.stride+(_+1)}unpack(_,w,T){return _*this.redFactor+w*this.greenFactor+T*this.blueFactor-this.baseShift}getPixels(){return new Ir({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(_,w,T){if(this.dim!==_.dim)throw new Error("dem dimension mismatch");let P=w*this.dim,B=w*this.dim+this.dim,L=T*this.dim,O=T*this.dim+this.dim;switch(w){case-1:P=B-1;break;case 1:B=P+1}switch(T){case-1:L=O-1;break;case 1:O=L+1}const V=-w*this.dim,W=-T*this.dim;for(let X=L;X<O;X++)for(let Y=P;Y<B;Y++)this.data[this._idx(Y,X)]=_.data[this._idx(Y+V,X+W)]}}st("DEMData",th);class ih{constructor(_){this._stringToNumber={},this._numberToString=[];for(let w=0;w<_.length;w++){const T=_[w];this._stringToNumber[T]=w,this._numberToString[w]=T}}encode(_){return this._stringToNumber[_]}decode(_){if(_>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${_} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[_]}}class rh{constructor(_,w,T,P,B){this.type="Feature",this._vectorTileFeature=_,_._z=w,_._x=T,_._y=P,this.properties=_.properties,this.id=B}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(_){this._geometry=_}toJSON(){const _={geometry:this.geometry};for(const w in this)w!=="_geometry"&&w!=="_vectorTileFeature"&&(_[w]=this[w]);return _}}class nh{constructor(_,w){this.tileID=_,this.x=_.canonical.x,this.y=_.canonical.y,this.z=_.canonical.z,this.grid=new Hr(Pt,16,0),this.grid3D=new Hr(Pt,16,0),this.featureIndexArray=new K,this.promoteId=w}insert(_,w,T,P,B,L){const O=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(T,P,B);const V=L?this.grid3D:this.grid;for(let W=0;W<w.length;W++){const X=w[W],Y=[1/0,1/0,-1/0,-1/0];for(let te=0;te<X.length;te++){const re=X[te];Y[0]=Math.min(Y[0],re.x),Y[1]=Math.min(Y[1],re.y),Y[2]=Math.max(Y[2],re.x),Y[3]=Math.max(Y[3],re.y)}Y[0]<Pt&&Y[1]<Pt&&Y[2]>=0&&Y[3]>=0&&V.insert(O,Y[0],Y[1],Y[2],Y[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new hs.VectorTile(new Ic(this.rawTileData)).layers,this.sourceLayerCoder=new ih(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(_,w,T,P){this.loadVTLayers();const B=_.params||{},L=Pt/_.tileSize/_.scale,O=aa(B.filter),V=_.queryGeometry,W=_.queryPadding*L,X=ah(V),Y=this.grid.query(X.minX-W,X.minY-W,X.maxX+W,X.maxY+W),te=ah(_.cameraQueryGeometry),re=this.grid3D.query(te.minX-W,te.minY-W,te.maxX+W,te.maxY+W,(me,xe,Me,ve)=>function(Ie,Oe,Ue,it,ot){for(const et of Ie)if(Oe<=et.x&&Ue<=et.y&&it>=et.x&&ot>=et.y)return!0;const tt=[new we(Oe,Ue),new we(Oe,ot),new we(it,ot),new we(it,Ue)];if(Ie.length>2){for(const et of tt)if(xa(Ie,et))return!0}for(let et=0;et<Ie.length-1;et++)if(Ih(Ie[et],Ie[et+1],tt))return!0;return!1}(_.cameraQueryGeometry,me-W,xe-W,Me+W,ve+W));for(const me of re)Y.push(me);Y.sort(Xd);const se={};let ue;for(let me=0;me<Y.length;me++){const xe=Y[me];if(xe===ue)continue;ue=xe;const Me=this.featureIndexArray.get(xe);let ve=null;this.loadMatchingFeature(se,Me.bucketIndex,Me.sourceLayerIndex,Me.featureIndex,O,B.layers,B.availableImages,w,T,P,(Ie,Oe,Ue)=>(ve||(ve=Dn(Ie)),Oe.queryIntersectsFeature(V,Ie,Ue,ve,this.z,_.transform,L,_.pixelPosMatrix)))}return se}loadMatchingFeature(_,w,T,P,B,L,O,V,W,X,Y){const te=this.bucketLayerIDs[w];if(L&&!function(me,xe){for(let Me=0;Me<me.length;Me++)if(xe.indexOf(me[Me])>=0)return!0;return!1}(L,te))return;const re=this.sourceLayerCoder.decode(T),se=this.vtLayers[re].feature(P);if(B.needGeometry){const me=kn(se,!0);if(!B.filter(new Kt(this.tileID.overscaledZ),me,this.tileID.canonical))return}else if(!B.filter(new Kt(this.tileID.overscaledZ),se))return;const ue=this.getId(se,re);for(let me=0;me<te.length;me++){const xe=te[me];if(L&&L.indexOf(xe)<0)continue;const Me=V[xe];if(!Me)continue;let ve={};ue&&X&&(ve=X.getState(Me.sourceLayer||"_geojsonTileLayer",ue));const Ie=Pi({},W[xe]);Ie.paint=sh(Ie.paint,Me.paint,se,ve,O),Ie.layout=sh(Ie.layout,Me.layout,se,ve,O);const Oe=!Y||Y(se,Me,ve);if(!Oe)continue;const Ue=new rh(se,this.z,this.x,this.y,ue);Ue.layer=Ie;let it=_[xe];it===void 0&&(it=_[xe]=[]),it.push({featureIndex:P,feature:Ue,intersectionZ:Oe})}}lookupSymbolFeatures(_,w,T,P,B,L,O,V){const W={};this.loadVTLayers();const X=aa(B);for(const Y of _)this.loadMatchingFeature(W,T,P,Y,X,L,O,V,w);return W}hasLayer(_){for(const w of this.bucketLayerIDs)for(const T of w)if(_===T)return!0;return!1}getId(_,w){let T=_.id;return this.promoteId&&(T=_.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[w]],typeof T=="boolean"&&(T=Number(T))),T}}function sh(x,_,w,T,P){return Yr(x,(B,L)=>{const O=_ instanceof ks?_.get(L):null;return O&&O.evaluate?O.evaluate(w,T,P):O})}function ah(x){let _=1/0,w=1/0,T=-1/0,P=-1/0;for(const B of x)_=Math.min(_,B.x),w=Math.min(w,B.y),T=Math.max(T,B.x),P=Math.max(P,B.y);return{minX:_,minY:w,maxX:T,maxY:P}}function Xd(x,_){return _-x}function oh(x,_,w,T,P){const B=[];for(let L=0;L<x.length;L++){const O=x[L];let V;for(let W=0;W<O.length-1;W++){let X=O[W],Y=O[W+1];X.x<_&&Y.x<_||(X.x<_?X=new we(_,X.y+(_-X.x)/(Y.x-X.x)*(Y.y-X.y))._round():Y.x<_&&(Y=new we(_,X.y+(_-X.x)/(Y.x-X.x)*(Y.y-X.y))._round()),X.y<w&&Y.y<w||(X.y<w?X=new we(X.x+(w-X.y)/(Y.y-X.y)*(Y.x-X.x),w)._round():Y.y<w&&(Y=new we(X.x+(w-X.y)/(Y.y-X.y)*(Y.x-X.x),w)._round()),X.x>=T&&Y.x>=T||(X.x>=T?X=new we(T,X.y+(T-X.x)/(Y.x-X.x)*(Y.y-X.y))._round():Y.x>=T&&(Y=new we(T,X.y+(T-X.x)/(Y.x-X.x)*(Y.y-X.y))._round()),X.y>=P&&Y.y>=P||(X.y>=P?X=new we(X.x+(P-X.y)/(Y.y-X.y)*(Y.x-X.x),P)._round():Y.y>=P&&(Y=new we(X.x+(P-X.y)/(Y.y-X.y)*(Y.x-X.x),P)._round()),V&&X.equals(V[V.length-1])||(V=[X],B.push(V)),V.push(Y)))))}}return B}st("FeatureIndex",nh,{omit:["rawTileData","sourceLayerCoder"]});class ms extends we{constructor(_,w,T,P){super(_,w),this.angle=T,P!==void 0&&(this.segment=P)}clone(){return new ms(this.x,this.y,this.angle,this.segment)}}function lh(x,_,w,T,P){if(_.segment===void 0||w===0)return!0;let B=_,L=_.segment+1,O=0;for(;O>-w/2;){if(L--,L<0)return!1;O-=x[L].dist(B),B=x[L]}O+=x[L].dist(x[L+1]),L++;const V=[];let W=0;for(;O<w/2;){const X=x[L],Y=x[L+1];if(!Y)return!1;let te=x[L-1].angleTo(X)-X.angleTo(Y);for(te=Math.abs((te+3*Math.PI)%(2*Math.PI)-Math.PI),V.push({distance:O,angleDelta:te}),W+=te;O-V[0].distance>T;)W-=V.shift().angleDelta;if(W>P)return!1;L++,O+=X.dist(Y)}return!0}function ch(x){let _=0;for(let w=0;w<x.length-1;w++)_+=x[w].dist(x[w+1]);return _}function uh(x,_,w){return x?.6*_*w:0}function hh(x,_){return Math.max(x?x.right-x.left:0,_?_.right-_.left:0)}function Yd(x,_,w,T,P,B){const L=uh(w,P,B),O=hh(w,T)*B;let V=0;const W=ch(x)/2;for(let X=0;X<x.length-1;X++){const Y=x[X],te=x[X+1],re=Y.dist(te);if(V+re>W){const se=(W-V)/re,ue=or.number(Y.x,te.x,se),me=or.number(Y.y,te.y,se),xe=new ms(ue,me,te.angleTo(Y),X);return xe._round(),!L||lh(x,xe,O,L,_)?xe:void 0}V+=re}}function Jd(x,_,w,T,P,B,L,O,V){const W=uh(T,B,L),X=hh(T,P),Y=X*L,te=x[0].x===0||x[0].x===V||x[0].y===0||x[0].y===V;return _-Y<_/4&&(_=Y+_/4),dh(x,te?_/2*O%_:(X/2+2*B)*L*O%_,_,W,w,Y,te,!1,V)}function dh(x,_,w,T,P,B,L,O,V){const W=B/2,X=ch(x);let Y=0,te=_-w,re=[];for(let se=0;se<x.length-1;se++){const ue=x[se],me=x[se+1],xe=ue.dist(me),Me=me.angleTo(ue);for(;te+w<Y+xe;){te+=w;const ve=(te-Y)/xe,Ie=or.number(ue.x,me.x,ve),Oe=or.number(ue.y,me.y,ve);if(Ie>=0&&Ie<V&&Oe>=0&&Oe<V&&te-W>=0&&te+W<=X){const Ue=new ms(Ie,Oe,Me,se);Ue._round(),T&&!lh(x,Ue,B,T,P)||re.push(Ue)}}Y+=xe}return O||re.length||L||(re=dh(x,Y/2,w,T,P,B,L,!0,V)),re}st("Anchor",ms);const Ia=ur;function ph(x,_,w,T){const P=[],B=x.image,L=B.pixelRatio,O=B.paddedRect.w-2*Ia,V=B.paddedRect.h-2*Ia,W=x.right-x.left,X=x.bottom-x.top,Y=B.stretchX||[[0,O]],te=B.stretchY||[[0,V]],re=(Ke,at)=>Ke+at[1]-at[0],se=Y.reduce(re,0),ue=te.reduce(re,0),me=O-se,xe=V-ue;let Me=0,ve=se,Ie=0,Oe=ue,Ue=0,it=me,ot=0,tt=xe;if(B.content&&T){const Ke=B.content;Me=Vl(Y,0,Ke[0]),Ie=Vl(te,0,Ke[1]),ve=Vl(Y,Ke[0],Ke[2]),Oe=Vl(te,Ke[1],Ke[3]),Ue=Ke[0]-Me,ot=Ke[1]-Ie,it=Ke[2]-Ke[0]-ve,tt=Ke[3]-Ke[1]-Oe}const et=(Ke,at,Qe,Ze)=>{const dt=ql(Ke.stretch-Me,ve,W,x.left),ct=jl(Ke.fixed-Ue,it,Ke.stretch,se),Ct=ql(at.stretch-Ie,Oe,X,x.top),Yt=jl(at.fixed-ot,tt,at.stretch,ue),Qt=ql(Qe.stretch-Me,ve,W,x.left),_i=jl(Qe.fixed-Ue,it,Qe.stretch,se),yr=ql(Ze.stretch-Ie,Oe,X,x.top),Ji=jl(Ze.fixed-ot,tt,Ze.stretch,ue),fi=new we(dt,Ct),Ii=new we(Qt,Ct),Bi=new we(Qt,yr),Qi=new we(dt,yr),er=new we(ct/L,Yt/L),yi=new we(_i/L,Ji/L),xi=_*Math.PI/180;if(xi){const Ni=Math.sin(xi),hr=Math.cos(xi),dr=[hr,-Ni,Ni,hr];fi._matMult(dr),Ii._matMult(dr),Qi._matMult(dr),Bi._matMult(dr)}const $i=Ke.stretch+Ke.fixed,tr=at.stretch+at.fixed;return{tl:fi,tr:Ii,bl:Qi,br:Bi,tex:{x:B.paddedRect.x+Ia+$i,y:B.paddedRect.y+Ia+tr,w:Qe.stretch+Qe.fixed-$i,h:Ze.stretch+Ze.fixed-tr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:er,pixelOffsetBR:yi,minFontScaleX:it/L/W,minFontScaleY:tt/L/X,isSDF:w}};if(T&&(B.stretchX||B.stretchY)){const Ke=fh(Y,me,se),at=fh(te,xe,ue);for(let Qe=0;Qe<Ke.length-1;Qe++){const Ze=Ke[Qe],dt=Ke[Qe+1];for(let ct=0;ct<at.length-1;ct++)P.push(et(Ze,at[ct],dt,at[ct+1]))}}else P.push(et({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:O+1},{fixed:0,stretch:V+1}));return P}function Vl(x,_,w){let T=0;for(const P of x)T+=Math.max(_,Math.min(w,P[1]))-Math.max(_,Math.min(w,P[0]));return T}function fh(x,_,w){const T=[{fixed:-Ia,stretch:0}];for(const[P,B]of x){const L=T[T.length-1];T.push({fixed:P-L.stretch,stretch:L.stretch}),T.push({fixed:P-L.stretch,stretch:L.stretch+(B-P)})}return T.push({fixed:_+Ia,stretch:w}),T}function ql(x,_,w,T){return x/_*w+T}function jl(x,_,w,T){return x-_*w/T}class Hl{constructor(_,w,T,P,B,L,O,V,W,X){if(this.boxStartIndex=_.length,W){let Y=L.top,te=L.bottom;const re=L.collisionPadding;re&&(Y-=re[1],te+=re[3]);let se=te-Y;se>0&&(se=Math.max(10,se),this.circleDiameter=se)}else{let Y=L.top*O-V[0],te=L.bottom*O+V[2],re=L.left*O-V[3],se=L.right*O+V[1];const ue=L.collisionPadding;if(ue&&(re-=ue[0]*O,Y-=ue[1]*O,se+=ue[2]*O,te+=ue[3]*O),X){const me=new we(re,Y),xe=new we(se,Y),Me=new we(re,te),ve=new we(se,te),Ie=X*Math.PI/180;me._rotate(Ie),xe._rotate(Ie),Me._rotate(Ie),ve._rotate(Ie),re=Math.min(me.x,xe.x,Me.x,ve.x),se=Math.max(me.x,xe.x,Me.x,ve.x),Y=Math.min(me.y,xe.y,Me.y,ve.y),te=Math.max(me.y,xe.y,Me.y,ve.y)}_.emplaceBack(w.x,w.y,re,Y,se,te,T,P,B)}this.boxEndIndex=_.length}}class Qd{constructor(_=[],w=ep){if(this.data=_,this.length=this.data.length,this.compare=w,this.length>0)for(let T=(this.length>>1)-1;T>=0;T--)this._down(T)}push(_){this.data.push(_),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const _=this.data[0],w=this.data.pop();return this.length--,this.length>0&&(this.data[0]=w,this._down(0)),_}peek(){return this.data[0]}_up(_){const{data:w,compare:T}=this,P=w[_];for(;_>0;){const B=_-1>>1,L=w[B];if(T(P,L)>=0)break;w[_]=L,_=B}w[_]=P}_down(_){const{data:w,compare:T}=this,P=this.length>>1,B=w[_];for(;_<P;){let L=1+(_<<1),O=w[L];const V=L+1;if(V<this.length&&T(w[V],O)<0&&(L=V,O=w[V]),T(O,B)>=0)break;w[_]=O,_=L}w[_]=B}}function ep(x,_){return x<_?-1:x>_?1:0}function tp(x,_=1,w=!1){let T=1/0,P=1/0,B=-1/0,L=-1/0;const O=x[0];for(let re=0;re<O.length;re++){const se=O[re];(!re||se.x<T)&&(T=se.x),(!re||se.y<P)&&(P=se.y),(!re||se.x>B)&&(B=se.x),(!re||se.y>L)&&(L=se.y)}const V=Math.min(B-T,L-P);let W=V/2;const X=new Qd([],ip);if(V===0)return new we(T,P);for(let re=T;re<B;re+=V)for(let se=P;se<L;se+=V)X.push(new Ca(re+W,se+W,W,x));let Y=function(re){let se=0,ue=0,me=0;const xe=re[0];for(let Me=0,ve=xe.length,Ie=ve-1;Me<ve;Ie=Me++){const Oe=xe[Me],Ue=xe[Ie],it=Oe.x*Ue.y-Ue.x*Oe.y;ue+=(Oe.x+Ue.x)*it,me+=(Oe.y+Ue.y)*it,se+=3*it}return new Ca(ue/se,me/se,0,re)}(x),te=X.length;for(;X.length;){const re=X.pop();(re.d>Y.d||!Y.d)&&(Y=re,w&&console.log("found best %d after %d probes",Math.round(1e4*re.d)/1e4,te)),re.max-Y.d<=_||(W=re.h/2,X.push(new Ca(re.p.x-W,re.p.y-W,W,x)),X.push(new Ca(re.p.x+W,re.p.y-W,W,x)),X.push(new Ca(re.p.x-W,re.p.y+W,W,x)),X.push(new Ca(re.p.x+W,re.p.y+W,W,x)),te+=4)}return w&&(console.log(`num probes: ${te}`),console.log(`best distance: ${Y.d}`)),Y.p}function ip(x,_){return _.max-x.max}function Ca(x,_,w,T){this.p=new we(x,_),this.h=w,this.d=function(P,B){let L=!1,O=1/0;for(let V=0;V<B.length;V++){const W=B[V];for(let X=0,Y=W.length,te=Y-1;X<Y;te=X++){const re=W[X],se=W[te];re.y>P.y!=se.y>P.y&&P.x<(se.x-re.x)*(P.y-re.y)/(se.y-re.y)+re.x&&(L=!L),O=Math.min(O,Yc(P,re,se))}}return(L?1:-1)*Math.sqrt(O)}(this.p,T),this.max=this.d+this.h*Math.SQRT2}var zi;$.ap=void 0,(zi=$.ap||($.ap={}))[zi.center=1]="center",zi[zi.left=2]="left",zi[zi.right=3]="right",zi[zi.top=4]="top",zi[zi.bottom=5]="bottom",zi[zi["top-left"]=6]="top-left",zi[zi["top-right"]=7]="top-right",zi[zi["bottom-left"]=8]="bottom-left",zi[zi["bottom-right"]=9]="bottom-right";const gs=7,Nc=Number.POSITIVE_INFINITY;function mh(x,_){return _[1]!==Nc?function(w,T,P){let B=0,L=0;switch(T=Math.abs(T),P=Math.abs(P),w){case"top-right":case"top-left":case"top":L=P-gs;break;case"bottom-right":case"bottom-left":case"bottom":L=-P+gs}switch(w){case"top-right":case"bottom-right":case"right":B=-T;break;case"top-left":case"bottom-left":case"left":B=T}return[B,L]}(x,_[0],_[1]):function(w,T){let P=0,B=0;T<0&&(T=0);const L=T/Math.SQRT2;switch(w){case"top-right":case"top-left":B=L-gs;break;case"bottom-right":case"bottom-left":B=-L+gs;break;case"bottom":B=-T+gs;break;case"top":B=T-gs}switch(w){case"top-right":case"bottom-right":P=-L;break;case"top-left":case"bottom-left":P=L;break;case"left":P=T;break;case"right":P=-T}return[P,B]}(x,_[0])}function gh(x,_,w){var T;const P=x.layout,B=(T=P.get("text-variable-anchor-offset"))===null||T===void 0?void 0:T.evaluate(_,{},w);if(B){const O=B.values,V=[];for(let W=0;W<O.length;W+=2){const X=V[W]=O[W],Y=O[W+1].map(te=>te*gi);X.startsWith("top")?Y[1]-=gs:X.startsWith("bottom")&&(Y[1]+=gs),V[W+1]=Y}return new Di(V)}const L=P.get("text-variable-anchor");if(L){let O;O=x._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[P.get("text-radial-offset").evaluate(_,{},w)*gi,Nc]:P.get("text-offset").evaluate(_,{},w).map(W=>W*gi);const V=[];for(const W of L)V.push(W,mh(W,O));return new Di(V)}return null}function Uc(x){switch(x){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function rp(x,_,w,T,P,B,L,O,V,W,X){let Y=B.textMaxSize.evaluate(_,{});Y===void 0&&(Y=L);const te=x.layers[0].layout,re=te.get("icon-offset").evaluate(_,{},X),se=yh(w.horizontal),ue=L/24,me=x.tilePixelRatio*ue,xe=x.tilePixelRatio*Y/24,Me=x.tilePixelRatio*O,ve=x.tilePixelRatio*te.get("symbol-spacing"),Ie=te.get("text-padding")*x.tilePixelRatio,Oe=function(Ze,dt,ct,Ct=1){const Yt=Ze.get("icon-padding").evaluate(dt,{},ct),Qt=Yt&&Yt.values;return[Qt[0]*Ct,Qt[1]*Ct,Qt[2]*Ct,Qt[3]*Ct]}(te,_,X,x.tilePixelRatio),Ue=te.get("text-max-angle")/180*Math.PI,it=te.get("text-rotation-alignment")!=="viewport"&&te.get("symbol-placement")!=="point",ot=te.get("icon-rotation-alignment")==="map"&&te.get("symbol-placement")!=="point",tt=te.get("symbol-placement"),et=ve/2,Ke=te.get("icon-text-fit");let at;T&&Ke!=="none"&&(x.allowVerticalPlacement&&w.vertical&&(at=Uu(T,w.vertical,Ke,te.get("icon-text-fit-padding"),re,ue)),se&&(T=Uu(T,se,Ke,te.get("icon-text-fit-padding"),re,ue)));const Qe=(Ze,dt)=>{dt.x<0||dt.x>=Pt||dt.y<0||dt.y>=Pt||function(ct,Ct,Yt,Qt,_i,yr,Ji,fi,Ii,Bi,Qi,er,yi,xi,$i,tr,Ni,hr,dr,vi,Rt,Ui,Li,bi,Nr){const Zr=ct.addToLineVertexArray(Ct,Yt);let Wr,Ln,Ur,Pr,pr=0,Fn=0,Oo=0,wh=0,Kc=-1,Xc=-1;const On={};let Sh=It("");if(ct.allowVerticalPlacement&&Qt.vertical){const Vi=fi.layout.get("text-rotate").evaluate(Rt,{},bi)+90;Ur=new Hl(Ii,Ct,Bi,Qi,er,Qt.vertical,yi,xi,$i,Vi),Ji&&(Pr=new Hl(Ii,Ct,Bi,Qi,er,Ji,Ni,hr,$i,Vi))}if(_i){const Vi=fi.layout.get("icon-rotate").evaluate(Rt,{}),Mr=fi.layout.get("icon-text-fit")!=="none",Us=ph(_i,Vi,Li,Mr),Xr=Ji?ph(Ji,Vi,Li,Mr):void 0;Ln=new Hl(Ii,Ct,Bi,Qi,er,_i,Ni,hr,!1,Vi),pr=4*Us.length;const Vs=ct.iconSizeData;let hn=null;Vs.kind==="source"?(hn=[un*fi.layout.get("icon-size").evaluate(Rt,{})],hn[0]>ps&&Mi(`${ct.layerIds[0]}: Value for "icon-size" is >= ${zo}. Reduce your "icon-size".`)):Vs.kind==="composite"&&(hn=[un*Ui.compositeIconSizes[0].evaluate(Rt,{},bi),un*Ui.compositeIconSizes[1].evaluate(Rt,{},bi)],(hn[0]>ps||hn[1]>ps)&&Mi(`${ct.layerIds[0]}: Value for "icon-size" is >= ${zo}. Reduce your "icon-size".`)),ct.addSymbols(ct.icon,Us,hn,vi,dr,Rt,$.ah.none,Ct,Zr.lineStartIndex,Zr.lineLength,-1,bi),Kc=ct.icon.placedSymbolArray.length-1,Xr&&(Fn=4*Xr.length,ct.addSymbols(ct.icon,Xr,hn,vi,dr,Rt,$.ah.vertical,Ct,Zr.lineStartIndex,Zr.lineLength,-1,bi),Xc=ct.icon.placedSymbolArray.length-1)}const Eh=Object.keys(Qt.horizontal);for(const Vi of Eh){const Mr=Qt.horizontal[Vi];if(!Wr){Sh=It(Mr.text);const Xr=fi.layout.get("text-rotate").evaluate(Rt,{},bi);Wr=new Hl(Ii,Ct,Bi,Qi,er,Mr,yi,xi,$i,Xr)}const Us=Mr.positionedLines.length===1;if(Oo+=_h(ct,Ct,Mr,yr,fi,$i,Rt,tr,Zr,Qt.vertical?$.ah.horizontal:$.ah.horizontalOnly,Us?Eh:[Vi],On,Kc,Ui,bi),Us)break}Qt.vertical&&(wh+=_h(ct,Ct,Qt.vertical,yr,fi,$i,Rt,tr,Zr,$.ah.vertical,["vertical"],On,Xc,Ui,bi));const ap=Wr?Wr.boxStartIndex:ct.collisionBoxArray.length,op=Wr?Wr.boxEndIndex:ct.collisionBoxArray.length,lp=Ur?Ur.boxStartIndex:ct.collisionBoxArray.length,cp=Ur?Ur.boxEndIndex:ct.collisionBoxArray.length,up=Ln?Ln.boxStartIndex:ct.collisionBoxArray.length,hp=Ln?Ln.boxEndIndex:ct.collisionBoxArray.length,dp=Pr?Pr.boxStartIndex:ct.collisionBoxArray.length,pp=Pr?Pr.boxEndIndex:ct.collisionBoxArray.length;let Kr=-1;const Zl=(Vi,Mr)=>Vi&&Vi.circleDiameter?Math.max(Vi.circleDiameter,Mr):Mr;Kr=Zl(Wr,Kr),Kr=Zl(Ur,Kr),Kr=Zl(Ln,Kr),Kr=Zl(Pr,Kr);const Th=Kr>-1?1:0;Th&&(Kr*=Nr/gi),ct.glyphOffsetArray.length>=Aa.MAX_GLYPHS&&Mi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Rt.sortKey!==void 0&&ct.addToSortKeyRanges(ct.symbolInstances.length,Rt.sortKey);const fp=gh(fi,Rt,bi),[mp,gp]=function(Vi,Mr){const Us=Vi.length,Xr=Mr==null?void 0:Mr.values;if((Xr==null?void 0:Xr.length)>0)for(let Vs=0;Vs<Xr.length;Vs+=2){const hn=Xr[Vs+1];Vi.emplaceBack($.ap[Xr[Vs]],hn[0],hn[1])}return[Us,Vi.length]}(ct.textAnchorOffsets,fp);ct.symbolInstances.emplaceBack(Ct.x,Ct.y,On.right>=0?On.right:-1,On.center>=0?On.center:-1,On.left>=0?On.left:-1,On.vertical||-1,Kc,Xc,Sh,ap,op,lp,cp,up,hp,dp,pp,Bi,Oo,wh,pr,Fn,Th,0,yi,Kr,mp,gp)}(x,dt,Ze,w,T,P,at,x.layers[0],x.collisionBoxArray,_.index,_.sourceLayerIndex,x.index,me,[Ie,Ie,Ie,Ie],it,V,Me,Oe,ot,re,_,B,W,X,L)};if(tt==="line")for(const Ze of oh(_.geometry,0,0,Pt,Pt)){const dt=Jd(Ze,ve,Ue,w.vertical||se,T,24,xe,x.overscaling,Pt);for(const ct of dt)se&&np(x,se.text,et,ct)||Qe(Ze,ct)}else if(tt==="line-center"){for(const Ze of _.geometry)if(Ze.length>1){const dt=Yd(Ze,Ue,w.vertical||se,T,24,xe);dt&&Qe(Ze,dt)}}else if(_.type==="Polygon")for(const Ze of xc(_.geometry,0)){const dt=tp(Ze,16);Qe(Ze[0],new ms(dt.x,dt.y,0))}else if(_.type==="LineString")for(const Ze of _.geometry)Qe(Ze,new ms(Ze[0].x,Ze[0].y,0));else if(_.type==="Point")for(const Ze of _.geometry)for(const dt of Ze)Qe([dt],new ms(dt.x,dt.y,0))}function _h(x,_,w,T,P,B,L,O,V,W,X,Y,te,re,se){const ue=function(Me,ve,Ie,Oe,Ue,it,ot,tt){const et=Oe.layout.get("text-rotate").evaluate(it,{})*Math.PI/180,Ke=[];for(const at of ve.positionedLines)for(const Qe of at.positionedGlyphs){if(!Qe.rect)continue;const Ze=Qe.rect||{};let dt=zu+1,ct=!0,Ct=1,Yt=0;const Qt=(Ue||tt)&&Qe.vertical,_i=Qe.metrics.advance*Qe.scale/2;if(tt&&ve.verticalizable&&(Yt=at.lineOffset/2-(Qe.imageName?-(gi-Qe.metrics.width*Qe.scale)/2:(Qe.scale-1)*gi)),Qe.imageName){const vi=ot[Qe.imageName];ct=vi.sdf,Ct=vi.pixelRatio,dt=ur/Ct}const yr=Ue?[Qe.x+_i,Qe.y]:[0,0];let Ji=Ue?[0,0]:[Qe.x+_i+Ie[0],Qe.y+Ie[1]-Yt],fi=[0,0];Qt&&(fi=Ji,Ji=[0,0]);const Ii=Qe.metrics.isDoubleResolution?2:1,Bi=(Qe.metrics.left-dt)*Qe.scale-_i+Ji[0],Qi=(-Qe.metrics.top-dt)*Qe.scale+Ji[1],er=Bi+Ze.w/Ii*Qe.scale/Ct,yi=Qi+Ze.h/Ii*Qe.scale/Ct,xi=new we(Bi,Qi),$i=new we(er,Qi),tr=new we(Bi,yi),Ni=new we(er,yi);if(Qt){const vi=new we(-_i,_i-Do),Rt=-Math.PI/2,Ui=gi/2-_i,Li=new we(5-Do-Ui,-(Qe.imageName?Ui:0)),bi=new we(...fi);xi._rotateAround(Rt,vi)._add(Li)._add(bi),$i._rotateAround(Rt,vi)._add(Li)._add(bi),tr._rotateAround(Rt,vi)._add(Li)._add(bi),Ni._rotateAround(Rt,vi)._add(Li)._add(bi)}if(et){const vi=Math.sin(et),Rt=Math.cos(et),Ui=[Rt,-vi,vi,Rt];xi._matMult(Ui),$i._matMult(Ui),tr._matMult(Ui),Ni._matMult(Ui)}const hr=new we(0,0),dr=new we(0,0);Ke.push({tl:xi,tr:$i,bl:tr,br:Ni,tex:Ze,writingMode:ve.writingMode,glyphOffset:yr,sectionIndex:Qe.sectionIndex,isSDF:ct,pixelOffsetTL:hr,pixelOffsetBR:dr,minFontScaleX:0,minFontScaleY:0})}return Ke}(0,w,O,P,B,L,T,x.allowVerticalPlacement),me=x.textSizeData;let xe=null;me.kind==="source"?(xe=[un*P.layout.get("text-size").evaluate(L,{})],xe[0]>ps&&Mi(`${x.layerIds[0]}: Value for "text-size" is >= ${zo}. Reduce your "text-size".`)):me.kind==="composite"&&(xe=[un*re.compositeTextSizes[0].evaluate(L,{},se),un*re.compositeTextSizes[1].evaluate(L,{},se)],(xe[0]>ps||xe[1]>ps)&&Mi(`${x.layerIds[0]}: Value for "text-size" is >= ${zo}. Reduce your "text-size".`)),x.addSymbols(x.text,ue,xe,O,B,L,W,_,V.lineStartIndex,V.lineLength,te,se);for(const Me of X)Y[Me]=x.text.placedSymbolArray.length-1;return 4*ue.length}function yh(x){for(const _ in x)return x[_];return null}function np(x,_,w,T){const P=x.compareText;if(_ in P){const B=P[_];for(let L=B.length-1;L>=0;L--)if(T.dist(B[L])<w)return!0}else P[_]=[];return P[_].push(T),!1}const xh=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Vc{static from(_){if(!(_ instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[w,T]=new Uint8Array(_,0,2);if(w!==219)throw new Error("Data does not appear to be in a KDBush format.");const P=T>>4;if(P!==1)throw new Error(`Got v${P} data when expected v1.`);const B=xh[15&T];if(!B)throw new Error("Unrecognized array type.");const[L]=new Uint16Array(_,2,1),[O]=new Uint32Array(_,4,1);return new Vc(O,L,B,_)}constructor(_,w=64,T=Float64Array,P){if(isNaN(_)||_<0)throw new Error(`Unpexpected numItems value: ${_}.`);this.numItems=+_,this.nodeSize=Math.min(Math.max(+w,2),65535),this.ArrayType=T,this.IndexArrayType=_<65536?Uint16Array:Uint32Array;const B=xh.indexOf(this.ArrayType),L=2*_*this.ArrayType.BYTES_PER_ELEMENT,O=_*this.IndexArrayType.BYTES_PER_ELEMENT,V=(8-O%8)%8;if(B<0)throw new Error(`Unexpected typed array class: ${T}.`);P&&P instanceof ArrayBuffer?(this.data=P,this.ids=new this.IndexArrayType(this.data,8,_),this.coords=new this.ArrayType(this.data,8+O+V,2*_),this._pos=2*_,this._finished=!0):(this.data=new ArrayBuffer(8+L+O+V),this.ids=new this.IndexArrayType(this.data,8,_),this.coords=new this.ArrayType(this.data,8+O+V,2*_),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+B]),new Uint16Array(this.data,2,1)[0]=w,new Uint32Array(this.data,4,1)[0]=_)}add(_,w){const T=this._pos>>1;return this.ids[T]=T,this.coords[this._pos++]=_,this.coords[this._pos++]=w,T}finish(){const _=this._pos>>1;if(_!==this.numItems)throw new Error(`Added ${_} items when expected ${this.numItems}.`);return qc(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(_,w,T,P){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:B,coords:L,nodeSize:O}=this,V=[0,B.length-1,0],W=[];for(;V.length;){const X=V.pop()||0,Y=V.pop()||0,te=V.pop()||0;if(Y-te<=O){for(let me=te;me<=Y;me++){const xe=L[2*me],Me=L[2*me+1];xe>=_&&xe<=T&&Me>=w&&Me<=P&&W.push(B[me])}continue}const re=te+Y>>1,se=L[2*re],ue=L[2*re+1];se>=_&&se<=T&&ue>=w&&ue<=P&&W.push(B[re]),(X===0?_<=se:w<=ue)&&(V.push(te),V.push(re-1),V.push(1-X)),(X===0?T>=se:P>=ue)&&(V.push(re+1),V.push(Y),V.push(1-X))}return W}within(_,w,T){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:P,coords:B,nodeSize:L}=this,O=[0,P.length-1,0],V=[],W=T*T;for(;O.length;){const X=O.pop()||0,Y=O.pop()||0,te=O.pop()||0;if(Y-te<=L){for(let me=te;me<=Y;me++)bh(B[2*me],B[2*me+1],_,w)<=W&&V.push(P[me]);continue}const re=te+Y>>1,se=B[2*re],ue=B[2*re+1];bh(se,ue,_,w)<=W&&V.push(P[re]),(X===0?_-T<=se:w-T<=ue)&&(O.push(te),O.push(re-1),O.push(1-X)),(X===0?_+T>=se:w+T>=ue)&&(O.push(re+1),O.push(Y),O.push(1-X))}return V}}function qc(x,_,w,T,P,B){if(P-T<=w)return;const L=T+P>>1;vh(x,_,L,T,P,B),qc(x,_,w,T,L-1,1-B),qc(x,_,w,L+1,P,1-B)}function vh(x,_,w,T,P,B){for(;P>T;){if(P-T>600){const W=P-T+1,X=w-T+1,Y=Math.log(W),te=.5*Math.exp(2*Y/3),re=.5*Math.sqrt(Y*te*(W-te)/W)*(X-W/2<0?-1:1);vh(x,_,w,Math.max(T,Math.floor(w-X*te/W+re)),Math.min(P,Math.floor(w+(W-X)*te/W+re)),B)}const L=_[2*w+B];let O=T,V=P;for(Lo(x,_,T,w),_[2*P+B]>L&&Lo(x,_,T,P);O<V;){for(Lo(x,_,O,V),O++,V--;_[2*O+B]<L;)O++;for(;_[2*V+B]>L;)V--}_[2*T+B]===L?Lo(x,_,T,V):(V++,Lo(x,_,V,P)),V<=w&&(T=V+1),w<=V&&(P=V-1)}}function Lo(x,_,w,T){jc(x,w,T),jc(_,2*w,2*T),jc(_,2*w+1,2*T+1)}function jc(x,_,w){const T=x[_];x[_]=x[w],x[w]=T}function bh(x,_,w,T){const P=x-w,B=_-T;return P*P+B*B}var Hc;$.bd=void 0,(Hc=$.bd||($.bd={})).create="create",Hc.load="load",Hc.fullLoad="fullLoad";let Gl=null,Fo=[];const Gc=1e3/60,Zc="loadTime",Wc="fullLoadTime",sp={mark(x){performance.mark(x)},frame(x){const _=x;Gl!=null&&Fo.push(_-Gl),Gl=_},clearMetrics(){Gl=null,Fo=[],performance.clearMeasures(Zc),performance.clearMeasures(Wc);for(const x in $.bd)performance.clearMarks($.bd[x])},getPerformanceMetrics(){performance.measure(Zc,$.bd.create,$.bd.load),performance.measure(Wc,$.bd.create,$.bd.fullLoad);const x=performance.getEntriesByName(Zc)[0].duration,_=performance.getEntriesByName(Wc)[0].duration,w=Fo.length,T=1/(Fo.reduce((B,L)=>B+L,0)/w/1e3),P=Fo.filter(B=>B>Gc).reduce((B,L)=>B+(L-Gc)/Gc,0);return{loadTime:x,fullLoadTime:_,fps:T,percentDroppedFrames:P/(w+P)*100,totalFrames:w}}};$.$=je,$.A=va,$.B=function(x){if($n==null){const _=x.navigator?x.navigator.userAgent:null;$n=!!x.safari||!(!_||!(/\b(iPad|iPhone|iPod)\b/.test(_)||_.match("Safari")&&!_.match("Chrome")))}return $n},$.C=class{constructor(x,_){this.target=x,this.mapId=_,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Kd(()=>this.process()),this.subscription=function(w,T,P,B){return w.addEventListener(T,P,!1),{unsubscribe:()=>{w.removeEventListener(T,P,!1)}}}(this.target,"message",w=>this.receive(w)),this.globalScope=Vr(self)?x:window}registerMessageHandler(x,_){this.messageHandlers[x]=_}sendAsync(x,_){return new Promise((w,T)=>{const P=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[P]={resolve:w,reject:T},_&&_.signal.addEventListener("abort",()=>{delete this.resolveRejects[P];const O={id:P,type:"<cancel>",origin:location.origin,targetMapId:x.targetMapId,sourceMapId:this.mapId};this.target.postMessage(O)},{once:!0});const B=[],L=Object.assign(Object.assign({},x),{id:P,sourceMapId:this.mapId,origin:location.origin,data:An(x.data,B)});this.target.postMessage(L,{transfer:B})})}receive(x){const _=x.data,w=_.id;if(!(_.origin!=="file://"&&location.origin!=="file://"&&_.origin!==location.origin||_.targetMapId&&this.mapId!==_.targetMapId)){if(_.type==="<cancel>"){delete this.tasks[w];const T=this.abortControllers[w];return delete this.abortControllers[w],void(T&&T.abort())}if(Vr(self)||_.mustQueue)return this.tasks[w]=_,this.taskQueue.push(w),void this.invoker.trigger();this.processTask(w,_)}}process(){if(this.taskQueue.length===0)return;const x=this.taskQueue.shift(),_=this.tasks[x];delete this.tasks[x],this.taskQueue.length>0&&this.invoker.trigger(),_&&this.processTask(x,_)}processTask(x,_){return M(this,void 0,void 0,function*(){if(_.type==="<response>"){const P=this.resolveRejects[x];return delete this.resolveRejects[x],P?void(_.error?P.reject(as(_.error)):P.resolve(as(_.data))):void 0}if(!this.messageHandlers[_.type])return void this.completeTask(x,new Error(`Could not find a registered handler for ${_.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const w=as(_.data),T=new AbortController;this.abortControllers[x]=T;try{const P=yield this.messageHandlers[_.type](_.sourceMapId,w,T);this.completeTask(x,null,P)}catch(P){this.completeTask(x,P)}})}completeTask(x,_,w){const T=[];delete this.abortControllers[x];const P={id:x,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:_?An(_):null,data:An(w,T)};this.target.postMessage(P,{transfer:T})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},$.D=ut,$.E=gn,$.F=function(){var x=new va(16);return va!=Float32Array&&(x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[11]=0,x[12]=0,x[13]=0,x[14]=0),x[0]=1,x[5]=1,x[10]=1,x[15]=1,x},$.G=vr,$.H=function(x,_,w){var T,P,B,L,O,V,W,X,Y,te,re,se,ue=w[0],me=w[1],xe=w[2];return _===x?(x[12]=_[0]*ue+_[4]*me+_[8]*xe+_[12],x[13]=_[1]*ue+_[5]*me+_[9]*xe+_[13],x[14]=_[2]*ue+_[6]*me+_[10]*xe+_[14],x[15]=_[3]*ue+_[7]*me+_[11]*xe+_[15]):(P=_[1],B=_[2],L=_[3],O=_[4],V=_[5],W=_[6],X=_[7],Y=_[8],te=_[9],re=_[10],se=_[11],x[0]=T=_[0],x[1]=P,x[2]=B,x[3]=L,x[4]=O,x[5]=V,x[6]=W,x[7]=X,x[8]=Y,x[9]=te,x[10]=re,x[11]=se,x[12]=T*ue+O*me+Y*xe+_[12],x[13]=P*ue+V*me+te*xe+_[13],x[14]=B*ue+W*me+re*xe+_[14],x[15]=L*ue+X*me+se*xe+_[15]),x},$.I=Pc,$.J=function(x,_,w){var T=w[0],P=w[1],B=w[2];return x[0]=_[0]*T,x[1]=_[1]*T,x[2]=_[2]*T,x[3]=_[3]*T,x[4]=_[4]*P,x[5]=_[5]*P,x[6]=_[6]*P,x[7]=_[7]*P,x[8]=_[8]*B,x[9]=_[9]*B,x[10]=_[10]*B,x[11]=_[11]*B,x[12]=_[12],x[13]=_[13],x[14]=_[14],x[15]=_[15],x},$.K=tu,$.L=function(x,_){const w={};for(let T=0;T<_.length;T++){const P=_[T];P in x&&(w[P]=x[P])}return w},$.M=fs,$.N=Xu,$.O=Yu,$.P=we,$.Q=Cr,$.R=Ir,$.S=yt,$.T=so,$.U=$t,$.V=Jr,$.W=Pt,$.X=ui,$.Y=Ul,$.Z=class extends ln{},$._=M,$.a=mn,$.a$=function(x,_,w){return x[0]=_[0]*w[0],x[1]=_[1]*w[1],x[2]=_[2]*w[2],x[3]=_[3]*w[3],x},$.a0=$c,$.a1=Ye,$.a2=x=>{const _=window.document.createElement("video");return _.muted=!0,new Promise(w=>{_.onloadstart=()=>{w(_)};for(const T of x){const P=window.document.createElement("source");js(T)||(_.crossOrigin="Anonymous"),P.src=T,_.appendChild(P)}})},$.a3=function(){return dn++},$.a4=Sl,$.a5=Aa,$.a6=aa,$.a7=kn,$.a8=Kt,$.a9=rh,$.aA=qi,$.aB=function(x,_){if(!x)return[{command:"setStyle",args:[_]}];let w=[];try{if(!Dt(x.version,_.version))return[{command:"setStyle",args:[_]}];Dt(x.center,_.center)||w.push({command:"setCenter",args:[_.center]}),Dt(x.zoom,_.zoom)||w.push({command:"setZoom",args:[_.zoom]}),Dt(x.bearing,_.bearing)||w.push({command:"setBearing",args:[_.bearing]}),Dt(x.pitch,_.pitch)||w.push({command:"setPitch",args:[_.pitch]}),Dt(x.sprite,_.sprite)||w.push({command:"setSprite",args:[_.sprite]}),Dt(x.glyphs,_.glyphs)||w.push({command:"setGlyphs",args:[_.glyphs]}),Dt(x.transition,_.transition)||w.push({command:"setTransition",args:[_.transition]}),Dt(x.light,_.light)||w.push({command:"setLight",args:[_.light]}),Dt(x.terrain,_.terrain)||w.push({command:"setTerrain",args:[_.terrain]}),Dt(x.sky,_.sky)||w.push({command:"setSky",args:[_.sky]});const T={},P=[];(function(L,O,V,W){let X;for(X in O=O||{},L=L||{})Object.prototype.hasOwnProperty.call(L,X)&&(Object.prototype.hasOwnProperty.call(O,X)||Un(X,V,W));for(X in O)Object.prototype.hasOwnProperty.call(O,X)&&(Object.prototype.hasOwnProperty.call(L,X)?Dt(L[X],O[X])||(L[X].type==="geojson"&&O[X].type==="geojson"&&qn(L,O,X)?Ti(V,{command:"setGeoJSONSourceData",args:[X,O[X].data]}):Vn(X,O,V,W)):kr(X,O,V))})(x.sources,_.sources,P,T);const B=[];x.layers&&x.layers.forEach(L=>{"source"in L&&T[L.source]?w.push({command:"removeLayer",args:[L.id]}):B.push(L)}),w=w.concat(P),function(L,O,V){O=O||[];const W=(L=L||[]).map(jn),X=O.map(jn),Y=L.reduce(xs,{}),te=O.reduce(xs,{}),re=W.slice(),se=Object.create(null);let ue,me,xe,Me,ve;for(let Ie=0,Oe=0;Ie<W.length;Ie++)ue=W[Ie],Object.prototype.hasOwnProperty.call(te,ue)?Oe++:(Ti(V,{command:"removeLayer",args:[ue]}),re.splice(re.indexOf(ue,Oe),1));for(let Ie=0,Oe=0;Ie<X.length;Ie++)ue=X[X.length-1-Ie],re[re.length-1-Ie]!==ue&&(Object.prototype.hasOwnProperty.call(Y,ue)?(Ti(V,{command:"removeLayer",args:[ue]}),re.splice(re.lastIndexOf(ue,re.length-Oe),1)):Oe++,Me=re[re.length-Ie],Ti(V,{command:"addLayer",args:[te[ue],Me]}),re.splice(re.length-Ie,0,ue),se[ue]=!0);for(let Ie=0;Ie<X.length;Ie++)if(ue=X[Ie],me=Y[ue],xe=te[ue],!se[ue]&&!Dt(me,xe))if(Dt(me.source,xe.source)&&Dt(me["source-layer"],xe["source-layer"])&&Dt(me.type,xe.type)){for(ve in yn(me.layout,xe.layout,V,ue,null,"setLayoutProperty"),yn(me.paint,xe.paint,V,ue,null,"setPaintProperty"),Dt(me.filter,xe.filter)||Ti(V,{command:"setFilter",args:[ue,xe.filter]}),Dt(me.minzoom,xe.minzoom)&&Dt(me.maxzoom,xe.maxzoom)||Ti(V,{command:"setLayerZoomRange",args:[ue,xe.minzoom,xe.maxzoom]}),me)Object.prototype.hasOwnProperty.call(me,ve)&&ve!=="layout"&&ve!=="paint"&&ve!=="filter"&&ve!=="metadata"&&ve!=="minzoom"&&ve!=="maxzoom"&&(ve.indexOf("paint.")===0?yn(me[ve],xe[ve],V,ue,ve.slice(6),"setPaintProperty"):Dt(me[ve],xe[ve])||Ti(V,{command:"setLayerProperty",args:[ue,ve,xe[ve]]}));for(ve in xe)Object.prototype.hasOwnProperty.call(xe,ve)&&!Object.prototype.hasOwnProperty.call(me,ve)&&ve!=="layout"&&ve!=="paint"&&ve!=="filter"&&ve!=="metadata"&&ve!=="minzoom"&&ve!=="maxzoom"&&(ve.indexOf("paint.")===0?yn(me[ve],xe[ve],V,ue,ve.slice(6),"setPaintProperty"):Dt(me[ve],xe[ve])||Ti(V,{command:"setLayerProperty",args:[ue,ve,xe[ve]]}))}else Ti(V,{command:"removeLayer",args:[ue]}),Me=re[re.lastIndexOf(ue)+1],Ti(V,{command:"addLayer",args:[xe,Me]})}(B,_.layers,w)}catch(T){console.warn("Unable to compute style diff:",T),w=[{command:"setStyle",args:[_]}]}return w},$.aC=function(x){const _=[],w=x.id;return w===void 0&&_.push({message:`layers.${w}: missing required property "id"`}),x.render===void 0&&_.push({message:`layers.${w}: missing required method "render"`}),x.renderingMode&&x.renderingMode!=="2d"&&x.renderingMode!=="3d"&&_.push({message:`layers.${w}: property "renderingMode" must be either "2d" or "3d"`}),_},$.aD=function x(_,w){if(Array.isArray(_)){if(!Array.isArray(w)||_.length!==w.length)return!1;for(let T=0;T<_.length;T++)if(!x(_[T],w[T]))return!1;return!0}if(typeof _=="object"&&_!==null&&w!==null){if(typeof w!="object"||Object.keys(_).length!==Object.keys(w).length)return!1;for(const T in _)if(!x(_[T],w[T]))return!1;return!0}return _===w},$.aE=Yr,$.aF=qs,$.aG=class extends Zt{constructor(x,_){super(x,_),this.current=0}set(x){this.current!==x&&(this.current=x,this.gl.uniform1i(this.location,x))}},$.aH=ki,$.aI=class extends Zt{constructor(x,_){super(x,_),this.current=Mn}set(x){if(x[12]!==this.current[12]||x[0]!==this.current[0])return this.current=x,void this.gl.uniformMatrix4fv(this.location,!1,x);for(let _=1;_<16;_++)if(x[_]!==this.current[_]){this.current=x,this.gl.uniformMatrix4fv(this.location,!1,x);break}}},$.aJ=Tr,$.aK=class extends Zt{constructor(x,_){super(x,_),this.current=[0,0,0]}set(x){x[0]===this.current[0]&&x[1]===this.current[1]&&x[2]===this.current[2]||(this.current=x,this.gl.uniform3f(this.location,x[0],x[1],x[2]))}},$.aL=class extends Zt{constructor(x,_){super(x,_),this.current=[0,0]}set(x){x[0]===this.current[0]&&x[1]===this.current[1]||(this.current=x,this.gl.uniform2f(this.location,x[0],x[1]))}},$.aM=Or,$.aN=function(x,_,w,T,P,B,L){var O=1/(_-w),V=1/(T-P),W=1/(B-L);return x[0]=-2*O,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=-2*V,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=2*W,x[11]=0,x[12]=(_+w)*O,x[13]=(P+T)*V,x[14]=(L+B)*W,x[15]=1,x},$.aO=Ut,$.aP=Ph,$.aQ=class extends Fs{},$.aR=Sd,$.aS=class extends ls{},$.aT=function(x){return x<=1?1:Math.pow(2,Math.ceil(Math.log(x)/Math.LN2))},$.aU=au,$.aV=J,$.aW=class extends go{},$.aX=ze,$.aY=function(x,_){return x[0]===_[0]&&x[1]===_[1]&&x[2]===_[2]&&x[3]===_[3]&&x[4]===_[4]&&x[5]===_[5]&&x[6]===_[6]&&x[7]===_[7]&&x[8]===_[8]&&x[9]===_[9]&&x[10]===_[10]&&x[11]===_[11]&&x[12]===_[12]&&x[13]===_[13]&&x[14]===_[14]&&x[15]===_[15]},$.aZ=function(x,_){var w=x[0],T=x[1],P=x[2],B=x[3],L=x[4],O=x[5],V=x[6],W=x[7],X=x[8],Y=x[9],te=x[10],re=x[11],se=x[12],ue=x[13],me=x[14],xe=x[15],Me=_[0],ve=_[1],Ie=_[2],Oe=_[3],Ue=_[4],it=_[5],ot=_[6],tt=_[7],et=_[8],Ke=_[9],at=_[10],Qe=_[11],Ze=_[12],dt=_[13],ct=_[14],Ct=_[15];return Math.abs(w-Me)<=Yi*Math.max(1,Math.abs(w),Math.abs(Me))&&Math.abs(T-ve)<=Yi*Math.max(1,Math.abs(T),Math.abs(ve))&&Math.abs(P-Ie)<=Yi*Math.max(1,Math.abs(P),Math.abs(Ie))&&Math.abs(B-Oe)<=Yi*Math.max(1,Math.abs(B),Math.abs(Oe))&&Math.abs(L-Ue)<=Yi*Math.max(1,Math.abs(L),Math.abs(Ue))&&Math.abs(O-it)<=Yi*Math.max(1,Math.abs(O),Math.abs(it))&&Math.abs(V-ot)<=Yi*Math.max(1,Math.abs(V),Math.abs(ot))&&Math.abs(W-tt)<=Yi*Math.max(1,Math.abs(W),Math.abs(tt))&&Math.abs(X-et)<=Yi*Math.max(1,Math.abs(X),Math.abs(et))&&Math.abs(Y-Ke)<=Yi*Math.max(1,Math.abs(Y),Math.abs(Ke))&&Math.abs(te-at)<=Yi*Math.max(1,Math.abs(te),Math.abs(at))&&Math.abs(re-Qe)<=Yi*Math.max(1,Math.abs(re),Math.abs(Qe))&&Math.abs(se-Ze)<=Yi*Math.max(1,Math.abs(se),Math.abs(Ze))&&Math.abs(ue-dt)<=Yi*Math.max(1,Math.abs(ue),Math.abs(dt))&&Math.abs(me-ct)<=Yi*Math.max(1,Math.abs(me),Math.abs(ct))&&Math.abs(xe-Ct)<=Yi*Math.max(1,Math.abs(xe),Math.abs(Ct))},$.a_=function(x,_){return x[0]=_[0],x[1]=_[1],x[2]=_[2],x[3]=_[3],x[4]=_[4],x[5]=_[5],x[6]=_[6],x[7]=_[7],x[8]=_[8],x[9]=_[9],x[10]=_[10],x[11]=_[11],x[12]=_[12],x[13]=_[13],x[14]=_[14],x[15]=_[15],x},$.aa=function(x){const _={};if(x.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(w,T,P,B)=>{const L=P||B;return _[T]=!L||L.toLowerCase(),""}),_["max-age"]){const w=parseInt(_["max-age"],10);isNaN(w)?delete _["max-age"]:_["max-age"]=w}return _},$.ab=function(x,_){const w=[];for(const T in x)T in _||w.push(T);return w},$.ac=Ci,$.ad=function(x,_,w){var T=Math.sin(w),P=Math.cos(w),B=_[0],L=_[1],O=_[2],V=_[3],W=_[4],X=_[5],Y=_[6],te=_[7];return _!==x&&(x[8]=_[8],x[9]=_[9],x[10]=_[10],x[11]=_[11],x[12]=_[12],x[13]=_[13],x[14]=_[14],x[15]=_[15]),x[0]=B*P+W*T,x[1]=L*P+X*T,x[2]=O*P+Y*T,x[3]=V*P+te*T,x[4]=W*P-B*T,x[5]=X*P-L*T,x[6]=Y*P-O*T,x[7]=te*P-V*T,x},$.ae=function(x){var _=new va(16);return _[0]=x[0],_[1]=x[1],_[2]=x[2],_[3]=x[3],_[4]=x[4],_[5]=x[5],_[6]=x[6],_[7]=x[7],_[8]=x[8],_[9]=x[9],_[10]=x[10],_[11]=x[11],_[12]=x[12],_[13]=x[13],_[14]=x[14],_[15]=x[15],_},$.af=Ml,$.ag=function(x,_){let w=0,T=0;if(x.kind==="constant")T=x.layoutSize;else if(x.kind!=="source"){const{interpolationType:P,minZoom:B,maxZoom:L}=x,O=P?Ci(Oi.interpolationFactor(P,_,B,L),0,1):0;x.kind==="camera"?T=or.number(x.minSize,x.maxSize,O):w=O}return{uSizeT:w,uSize:T}},$.ai=function(x,{uSize:_,uSizeT:w},{lowerSize:T,upperSize:P}){return x.kind==="source"?T/un:x.kind==="composite"?or.number(T/un,P/un,w):_},$.aj=kc,$.ak=function(x,_,w,T){const P=_.y-x.y,B=_.x-x.x,L=T.y-w.y,O=T.x-w.x,V=L*B-O*P;if(V===0)return null;const W=(O*(x.y-w.y)-L*(x.x-w.x))/V;return new we(x.x+W*B,x.y+W*P)},$.al=oh,$.am=zn,$.an=dc,$.ao=gi,$.aq=Dc,$.ar=function(x,_){var w=_[0],T=_[1],P=_[2],B=_[3],L=_[4],O=_[5],V=_[6],W=_[7],X=_[8],Y=_[9],te=_[10],re=_[11],se=_[12],ue=_[13],me=_[14],xe=_[15],Me=w*O-T*L,ve=w*V-P*L,Ie=w*W-B*L,Oe=T*V-P*O,Ue=T*W-B*O,it=P*W-B*V,ot=X*ue-Y*se,tt=X*me-te*se,et=X*xe-re*se,Ke=Y*me-te*ue,at=Y*xe-re*ue,Qe=te*xe-re*me,Ze=Me*Qe-ve*at+Ie*Ke+Oe*et-Ue*tt+it*ot;return Ze?(x[0]=(O*Qe-V*at+W*Ke)*(Ze=1/Ze),x[1]=(P*at-T*Qe-B*Ke)*Ze,x[2]=(ue*it-me*Ue+xe*Oe)*Ze,x[3]=(te*Ue-Y*it-re*Oe)*Ze,x[4]=(V*et-L*Qe-W*tt)*Ze,x[5]=(w*Qe-P*et+B*tt)*Ze,x[6]=(me*Ie-se*it-xe*ve)*Ze,x[7]=(X*it-te*Ie+re*ve)*Ze,x[8]=(L*at-O*et+W*ot)*Ze,x[9]=(T*et-w*at-B*ot)*Ze,x[10]=(se*Ue-ue*Ie+xe*Me)*Ze,x[11]=(Y*Ie-X*Ue-re*Me)*Ze,x[12]=(O*tt-L*Ke-V*ot)*Ze,x[13]=(w*Ke-T*tt+P*ot)*Ze,x[14]=(ue*ve-se*Oe-me*Me)*Ze,x[15]=(X*Oe-Y*ve+te*Me)*Ze,x):null},$.as=Uc,$.at=Rc,$.au=Vc,$.av=function(){const x={},_=Le.$version;for(const w in Le.$root){const T=Le.$root[w];if(T.required){let P=null;P=w==="version"?_:T.type==="array"?[]:{},P!=null&&(x[w]=P)}}return x},$.aw=to,$.ax=Nn,$.ay=function(x){x=x.slice();const _=Object.create(null);for(let w=0;w<x.length;w++)_[x[w].id]=x[w];for(let w=0;w<x.length;w++)"ref"in x[w]&&(x[w]=ys(x[w],_[x[w].ref]));return x},$.az=function(x){if(x.type==="custom")return new Wd(x);switch(x.type){case"background":return new Hd(x);case"circle":return new Mh(x);case"fill":return new Xh(x);case"fill-extrusion":return new hd(x);case"heatmap":return new Dh(x);case"hillshade":return new zh(x);case"line":return new xd(x);case"raster":return new Zd(x);case"symbol":return new Nl(x)}},$.b=Rr,$.b0=function(x,_){return x[0]*_[0]+x[1]*_[1]+x[2]*_[2]+x[3]*_[3]},$.b1=ir,$.b2=eh,$.b3=Ju,$.b4=function(x,_,w,T,P){var B,L=1/Math.tan(_/2);return x[0]=L/w,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=L,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[11]=-1,x[12]=0,x[13]=0,x[15]=0,P!=null&&P!==1/0?(x[10]=(P+T)*(B=1/(T-P)),x[14]=2*P*T*B):(x[10]=-1,x[14]=-2*T),x},$.b5=function(x,_,w){var T=Math.sin(w),P=Math.cos(w),B=_[4],L=_[5],O=_[6],V=_[7],W=_[8],X=_[9],Y=_[10],te=_[11];return _!==x&&(x[0]=_[0],x[1]=_[1],x[2]=_[2],x[3]=_[3],x[12]=_[12],x[13]=_[13],x[14]=_[14],x[15]=_[15]),x[4]=B*P+W*T,x[5]=L*P+X*T,x[6]=O*P+Y*T,x[7]=V*P+te*T,x[8]=W*P-B*T,x[9]=X*P-L*T,x[10]=Y*P-O*T,x[11]=te*P-V*T,x},$.b6=Ft,$.b7=Nt,$.b8=function(x){return x*Math.PI/180},$.b9=function(x,_){return x[0]=_[0],x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=_[1],x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=_[2],x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},$.bA=In,$.ba=class extends pa{},$.bb=Fc,$.bc=sp,$.be=br,$.bf=function(x,_){mn.REGISTERED_PROTOCOLS[x]=_},$.bg=function(x){delete mn.REGISTERED_PROTOCOLS[x]},$.bh=function(x,_){const w={};for(let P=0;P<x.length;P++){const B=_&&_[x[P].id]||cc(x[P]);_&&(_[x[P].id]=B);let L=w[B];L||(L=w[B]=[]),L.push(x[P])}const T=[];for(const P in w)T.push(w[P]);return T},$.bi=st,$.bj=ih,$.bk=nh,$.bl=Lu,$.bm=function(x){x.bucket.createArrays(),x.bucket.tilePixelRatio=Pt/(512*x.bucket.overscaling),x.bucket.compareText={},x.bucket.iconsNeedLinear=!1;const _=x.bucket.layers[0],w=_.layout,T=_._unevaluatedLayout._values,P={layoutIconSize:T["icon-size"].possiblyEvaluate(new Kt(x.bucket.zoom+1),x.canonical),layoutTextSize:T["text-size"].possiblyEvaluate(new Kt(x.bucket.zoom+1),x.canonical),textMaxSize:T["text-size"].possiblyEvaluate(new Kt(18))};if(x.bucket.textSizeData.kind==="composite"){const{minZoom:W,maxZoom:X}=x.bucket.textSizeData;P.compositeTextSizes=[T["text-size"].possiblyEvaluate(new Kt(W),x.canonical),T["text-size"].possiblyEvaluate(new Kt(X),x.canonical)]}if(x.bucket.iconSizeData.kind==="composite"){const{minZoom:W,maxZoom:X}=x.bucket.iconSizeData;P.compositeIconSizes=[T["icon-size"].possiblyEvaluate(new Kt(W),x.canonical),T["icon-size"].possiblyEvaluate(new Kt(X),x.canonical)]}const B=w.get("text-line-height")*gi,L=w.get("text-rotation-alignment")!=="viewport"&&w.get("symbol-placement")!=="point",O=w.get("text-keep-upright"),V=w.get("text-size");for(const W of x.bucket.features){const X=w.get("text-font").evaluate(W,{},x.canonical).join(","),Y=V.evaluate(W,{},x.canonical),te=P.layoutTextSize.evaluate(W,{},x.canonical),re=P.layoutIconSize.evaluate(W,{},x.canonical),se={horizontal:{},vertical:void 0},ue=W.text;let me,xe=[0,0];if(ue){const Ie=ue.toString(),Oe=w.get("text-letter-spacing").evaluate(W,{},x.canonical)*gi,Ue=ca(Ie)?Oe:0,it=w.get("text-anchor").evaluate(W,{},x.canonical),ot=gh(_,W,x.canonical);if(!ot){const Qe=w.get("text-radial-offset").evaluate(W,{},x.canonical);xe=Qe?mh(it,[Qe*gi,Nc]):w.get("text-offset").evaluate(W,{},x.canonical).map(Ze=>Ze*gi)}let tt=L?"center":w.get("text-justify").evaluate(W,{},x.canonical);const et=w.get("symbol-placement"),Ke=et==="point"?w.get("text-max-width").evaluate(W,{},x.canonical)*gi:0,at=()=>{x.bucket.allowVerticalPlacement&&Ds(Ie)&&(se.vertical=Fl(ue,x.glyphMap,x.glyphPositions,x.imagePositions,X,Ke,B,it,"left",Ue,xe,$.ah.vertical,!0,et,te,Y))};if(!L&&ot){const Qe=new Set;if(tt==="auto")for(let dt=0;dt<ot.values.length;dt+=2)Qe.add(Uc(ot.values[dt]));else Qe.add(tt);let Ze=!1;for(const dt of Qe)if(!se.horizontal[dt])if(Ze)se.horizontal[dt]=se.horizontal[0];else{const ct=Fl(ue,x.glyphMap,x.glyphPositions,x.imagePositions,X,Ke,B,"center",dt,Ue,xe,$.ah.horizontal,!1,et,te,Y);ct&&(se.horizontal[dt]=ct,Ze=ct.positionedLines.length===1)}at()}else{tt==="auto"&&(tt=Uc(it));const Qe=Fl(ue,x.glyphMap,x.glyphPositions,x.imagePositions,X,Ke,B,it,tt,Ue,xe,$.ah.horizontal,!1,et,te,Y);Qe&&(se.horizontal[tt]=Qe),at(),Ds(Ie)&&L&&O&&(se.vertical=Fl(ue,x.glyphMap,x.glyphPositions,x.imagePositions,X,Ke,B,it,tt,Ue,xe,$.ah.vertical,!1,et,te,Y))}}let Me=!1;if(W.icon&&W.icon.name){const Ie=x.imageMap[W.icon.name];Ie&&(me=Nd(x.imagePositions[W.icon.name],w.get("icon-offset").evaluate(W,{},x.canonical),w.get("icon-anchor").evaluate(W,{},x.canonical)),Me=!!Ie.sdf,x.bucket.sdfIcons===void 0?x.bucket.sdfIcons=Me:x.bucket.sdfIcons!==Me&&Mi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ie.pixelRatio!==x.bucket.pixelRatio||w.get("icon-rotate").constantOr(1)!==0)&&(x.bucket.iconsNeedLinear=!0))}const ve=yh(se.horizontal)||se.vertical;x.bucket.iconsInText=!!ve&&ve.iconsInText,(ve||me)&&rp(x.bucket,W,se,me,x.imageMap,P,te,re,xe,Me,x.canonical)}x.showCollisionBoxes&&x.bucket.generateCollisionDebugBuffers()},$.bn=Tc,$.bo=wc,$.bp=Ec,$.bq=hs,$.br=Ic,$.bs=class{constructor(x){this._marks={start:[x.url,"start"].join("#"),end:[x.url,"end"].join("#"),measure:x.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let x=performance.getEntriesByName(this._marks.measure);return x.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),x=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),x}},$.bt=function(x,_,w,T,P){return M(this,void 0,void 0,function*(){if($t())try{return yield Jr(x,_,w,T,P)}catch{}return function(B,L,O,V,W){const X=B.width,Y=B.height;ji&&Hi||(ji=new OffscreenCanvas(X,Y),Hi=ji.getContext("2d",{willReadFrequently:!0})),ji.width=X,ji.height=Y,Hi.drawImage(B,0,0,X,Y);const te=Hi.getImageData(L,O,V,W);return Hi.clearRect(0,0,X,Y),te.data}(x,_,w,T,P)})},$.bu=th,$.bv=ye,$.bw=oe,$.bx=Iu,$.by=jt,$.bz=function(x){return x.message===fn},$.c=Dr,$.d=x=>M(void 0,void 0,void 0,function*(){if(x.byteLength===0)return createImageBitmap(new ImageData(1,1));const _=new Blob([new Uint8Array(x)],{type:"image/png"});try{return createImageBitmap(_)}catch(w){throw new Error(`Could not load image because of ${w.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),$.e=Pi,$.f=x=>new Promise((_,w)=>{const T=new Image;T.onload=()=>{_(T),URL.revokeObjectURL(T.src),T.onload=null,window.requestAnimationFrame(()=>{T.src=_s})},T.onerror=()=>w(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const P=new Blob([new Uint8Array(x)],{type:"image/png"});T.src=x.byteLength?URL.createObjectURL(P):_s}),$.g=qr,$.h=(x,_)=>Qr(Pi(x,{type:"json"}),_),$.i=Vr,$.j=mi,$.k=rn,$.l=(x,_)=>Qr(Pi(x,{type:"arrayBuffer"}),_),$.m=Qr,$.n=function(x){return new Ic(x).readFields(zd,[])},$.o=Eo,$.p=Bu,$.q=Ki,$.r=Ja,$.s=js,$.t=ml,$.u=rt,$.v=Le,$.w=Mi,$.x=ss,$.y=function([x,_,w]){return _+=90,_*=Math.PI/180,w*=Math.PI/180,{x:x*Math.cos(_)*Math.sin(w),y:x*Math.sin(_)*Math.sin(w),z:x*Math.cos(w)}},$.z=or}),G("worker",["./shared"],function($){class M{constructor(ee){this.keyCache={},ee&&this.replace(ee)}replace(ee){this._layerConfigs={},this._layers={},this.update(ee,[])}update(ee,ie){for(const he of ee){this._layerConfigs[he.id]=he;const Te=this._layers[he.id]=$.az(he);Te._featureFilter=$.a6(Te.filter),this.keyCache[he.id]&&delete this.keyCache[he.id]}for(const he of ie)delete this.keyCache[he],delete this._layerConfigs[he],delete this._layers[he];this.familiesBySource={};const ae=$.bh(Object.values(this._layerConfigs),this.keyCache);for(const he of ae){const Te=he.map(Fe=>this._layers[Fe.id]),Ae=Te[0];if(Ae.visibility==="none")continue;const Pe=Ae.source||"";let be=this.familiesBySource[Pe];be||(be=this.familiesBySource[Pe]={});const Re=Ae.sourceLayer||"_geojsonTileLayer";let qe=be[Re];qe||(qe=be[Re]=[]),qe.push(Te)}}}class ye{constructor(ee){const ie={},ae=[];for(const Pe in ee){const be=ee[Pe],Re=ie[Pe]={};for(const qe in be){const Fe=be[+qe];if(!Fe||Fe.bitmap.width===0||Fe.bitmap.height===0)continue;const Ne={x:0,y:0,w:Fe.bitmap.width+2,h:Fe.bitmap.height+2};ae.push(Ne),Re[qe]={rect:Ne,metrics:Fe.metrics}}}const{w:he,h:Te}=$.p(ae),Ae=new $.o({width:he||1,height:Te||1});for(const Pe in ee){const be=ee[Pe];for(const Re in be){const qe=be[+Re];if(!qe||qe.bitmap.width===0||qe.bitmap.height===0)continue;const Fe=ie[Pe][Re].rect;$.o.copy(qe.bitmap,Ae,{x:0,y:0},{x:Fe.x+1,y:Fe.y+1},qe.bitmap)}}this.image=Ae,this.positions=ie}}$.bi("GlyphAtlas",ye);class oe{constructor(ee){this.tileID=new $.Q(ee.tileID.overscaledZ,ee.tileID.wrap,ee.tileID.canonical.z,ee.tileID.canonical.x,ee.tileID.canonical.y),this.uid=ee.uid,this.zoom=ee.zoom,this.pixelRatio=ee.pixelRatio,this.tileSize=ee.tileSize,this.source=ee.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ee.showCollisionBoxes,this.collectResourceTiming=!!ee.collectResourceTiming,this.returnDependencies=!!ee.returnDependencies,this.promoteId=ee.promoteId,this.inFlightDependencies=[]}parse(ee,ie,ae,he){return $._(this,void 0,void 0,function*(){this.status="parsing",this.data=ee,this.collisionBoxArray=new $.a4;const Te=new $.bj(Object.keys(ee.layers).sort()),Ae=new $.bk(this.tileID,this.promoteId);Ae.bucketLayerIDs=[];const Pe={},be={featureIndex:Ae,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ae},Re=ie.familiesBySource[this.source];for(const St in Re){const ti=ee.layers[St];if(!ti)continue;ti.version===1&&$.w(`Vector tile source "${this.source}" layer "${St}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const wi=Te.encode(St),Zi=[];for(let Ri=0;Ri<ti.length;Ri++){const Fi=ti.feature(Ri),nr=Ae.getId(Fi,St);Zi.push({feature:Fi,id:nr,index:Ri,sourceLayerIndex:wi})}for(const Ri of Re[St]){const Fi=Ri[0];Fi.source!==this.source&&$.w(`layer.source = ${Fi.source} does not equal this.source = ${this.source}`),Fi.minzoom&&this.zoom<Math.floor(Fi.minzoom)||Fi.maxzoom&&this.zoom>=Fi.maxzoom||Fi.visibility!=="none"&&(Ee(Ri,this.zoom,ae),(Pe[Fi.id]=Fi.createBucket({index:Ae.bucketLayerIDs.length,layers:Ri,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:wi,sourceID:this.source})).populate(Zi,be,this.tileID.canonical),Ae.bucketLayerIDs.push(Ri.map(nr=>nr.id)))}}const qe=$.aE(be.glyphDependencies,St=>Object.keys(St).map(Number));this.inFlightDependencies.forEach(St=>St==null?void 0:St.abort()),this.inFlightDependencies=[];let Fe=Promise.resolve({});if(Object.keys(qe).length){const St=new AbortController;this.inFlightDependencies.push(St),Fe=he.sendAsync({type:"getGlyphs",data:{stacks:qe,source:this.source,tileID:this.tileID,type:"glyphs"}},St)}const Ne=Object.keys(be.iconDependencies);let lt=Promise.resolve({});if(Ne.length){const St=new AbortController;this.inFlightDependencies.push(St),lt=he.sendAsync({type:"getImages",data:{icons:Ne,source:this.source,tileID:this.tileID,type:"icons"}},St)}const gt=Object.keys(be.patternDependencies);let ft=Promise.resolve({});if(gt.length){const St=new AbortController;this.inFlightDependencies.push(St),ft=he.sendAsync({type:"getImages",data:{icons:gt,source:this.source,tileID:this.tileID,type:"patterns"}},St)}const[kt,xt,Wt]=yield Promise.all([Fe,lt,ft]),qt=new ye(kt),li=new $.bl(xt,Wt);for(const St in Pe){const ti=Pe[St];ti instanceof $.a5?(Ee(ti.layers,this.zoom,ae),$.bm({bucket:ti,glyphMap:kt,glyphPositions:qt.positions,imageMap:xt,imagePositions:li.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):ti.hasPattern&&(ti instanceof $.bn||ti instanceof $.bo||ti instanceof $.bp)&&(Ee(ti.layers,this.zoom,ae),ti.addFeatures(be,this.tileID.canonical,li.patternPositions))}return this.status="done",{buckets:Object.values(Pe).filter(St=>!St.isEmpty()),featureIndex:Ae,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:qt.image,imageAtlas:li,glyphMap:this.returnDependencies?kt:null,iconMap:this.returnDependencies?xt:null,glyphPositions:this.returnDependencies?qt.positions:null}})}}function Ee(pe,ee,ie){const ae=new $.a8(ee);for(const he of pe)he.recalculate(ae,ie)}class we{constructor(ee,ie,ae){this.actor=ee,this.layerIndex=ie,this.availableImages=ae,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(ee,ie){return $._(this,void 0,void 0,function*(){const ae=yield $.l(ee.request,ie);try{return{vectorTile:new $.bq.VectorTile(new $.br(ae.data)),rawData:ae.data,cacheControl:ae.cacheControl,expires:ae.expires}}catch(he){const Te=new Uint8Array(ae.data);let Ae=`Unable to parse the tile at ${ee.request.url}, `;throw Ae+=Te[0]===31&&Te[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${he.messge}`,new Error(Ae)}})}loadTile(ee){return $._(this,void 0,void 0,function*(){const ie=ee.uid,ae=!!(ee&&ee.request&&ee.request.collectResourceTiming)&&new $.bs(ee.request),he=new oe(ee);this.loading[ie]=he;const Te=new AbortController;he.abort=Te;try{const Ae=yield this.loadVectorTile(ee,Te);if(delete this.loading[ie],!Ae)return null;const Pe=Ae.rawData,be={};Ae.expires&&(be.expires=Ae.expires),Ae.cacheControl&&(be.cacheControl=Ae.cacheControl);const Re={};if(ae){const Fe=ae.finish();Fe&&(Re.resourceTiming=JSON.parse(JSON.stringify(Fe)))}he.vectorTile=Ae.vectorTile;const qe=he.parse(Ae.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[ie]=he,this.fetching[ie]={rawTileData:Pe,cacheControl:be,resourceTiming:Re};try{const Fe=yield qe;return $.e({rawTileData:Pe.slice(0)},Fe,be,Re)}finally{delete this.fetching[ie]}}catch(Ae){throw delete this.loading[ie],he.status="done",this.loaded[ie]=he,Ae}})}reloadTile(ee){return $._(this,void 0,void 0,function*(){const ie=ee.uid;if(!this.loaded||!this.loaded[ie])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const ae=this.loaded[ie];if(ae.showCollisionBoxes=ee.showCollisionBoxes,ae.status==="parsing"){const he=yield ae.parse(ae.vectorTile,this.layerIndex,this.availableImages,this.actor);let Te;if(this.fetching[ie]){const{rawTileData:Ae,cacheControl:Pe,resourceTiming:be}=this.fetching[ie];delete this.fetching[ie],Te=$.e({rawTileData:Ae.slice(0)},he,Pe,be)}else Te=he;return Te}if(ae.status==="done"&&ae.vectorTile)return ae.parse(ae.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(ee){return $._(this,void 0,void 0,function*(){const ie=this.loading,ae=ee.uid;ie&&ie[ae]&&ie[ae].abort&&(ie[ae].abort.abort(),delete ie[ae])})}removeTile(ee){return $._(this,void 0,void 0,function*(){this.loaded&&this.loaded[ee.uid]&&delete this.loaded[ee.uid]})}}class ce{constructor(){this.loaded={}}loadTile(ee){return $._(this,void 0,void 0,function*(){const{uid:ie,encoding:ae,rawImageData:he,redFactor:Te,greenFactor:Ae,blueFactor:Pe,baseShift:be}=ee,Re=he.width+2,qe=he.height+2,Fe=$.b(he)?new $.R({width:Re,height:qe},yield $.bt(he,-1,-1,Re,qe)):he,Ne=new $.bu(ie,Fe,ae,Te,Ae,Pe,be);return this.loaded=this.loaded||{},this.loaded[ie]=Ne,Ne})}removeTile(ee){const ie=this.loaded,ae=ee.uid;ie&&ie[ae]&&delete ie[ae]}}function $e(pe,ee){if(pe.length!==0){Ge(pe[0],ee);for(var ie=1;ie<pe.length;ie++)Ge(pe[ie],!ee)}}function Ge(pe,ee){for(var ie=0,ae=0,he=0,Te=pe.length,Ae=Te-1;he<Te;Ae=he++){var Pe=(pe[he][0]-pe[Ae][0])*(pe[Ae][1]+pe[he][1]),be=ie+Pe;ae+=Math.abs(ie)>=Math.abs(Pe)?ie-be+Pe:Pe-be+ie,ie=be}ie+ae>=0!=!!ee&&pe.reverse()}var Xe=$.bv(function pe(ee,ie){var ae,he=ee&&ee.type;if(he==="FeatureCollection")for(ae=0;ae<ee.features.length;ae++)pe(ee.features[ae],ie);else if(he==="GeometryCollection")for(ae=0;ae<ee.geometries.length;ae++)pe(ee.geometries[ae],ie);else if(he==="Feature")pe(ee.geometry,ie);else if(he==="Polygon")$e(ee.coordinates,ie);else if(he==="MultiPolygon")for(ae=0;ae<ee.coordinates.length;ae++)$e(ee.coordinates[ae],ie);return ee});const ht=$.bq.VectorTileFeature.prototype.toGeoJSON;var yt={exports:{}},$t=$.bw,Ft=$.bq.VectorTileFeature,Nt=Ci;function Ci(pe,ee){this.options=ee||{},this.features=pe,this.length=pe.length}function ir(pe,ee){this.id=typeof pe.id=="number"?pe.id:void 0,this.type=pe.type,this.rawGeometry=pe.type===1?[pe.geometry]:pe.geometry,this.properties=pe.tags,this.extent=ee||4096}Ci.prototype.feature=function(pe){return new ir(this.features[pe],this.options.extent)},ir.prototype.loadGeometry=function(){var pe=this.rawGeometry;this.geometry=[];for(var ee=0;ee<pe.length;ee++){for(var ie=pe[ee],ae=[],he=0;he<ie.length;he++)ae.push(new $t(ie[he][0],ie[he][1]));this.geometry.push(ae)}return this.geometry},ir.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var pe=this.geometry,ee=1/0,ie=-1/0,ae=1/0,he=-1/0,Te=0;Te<pe.length;Te++)for(var Ae=pe[Te],Pe=0;Pe<Ae.length;Pe++){var be=Ae[Pe];ee=Math.min(ee,be.x),ie=Math.max(ie,be.x),ae=Math.min(ae,be.y),he=Math.max(he,be.y)}return[ee,ae,ie,he]},ir.prototype.toGeoJSON=Ft.prototype.toGeoJSON;var Pi=$.bx,dn=Nt;function Yr(pe){var ee=new Pi;return function(ie,ae){for(var he in ie.layers)ae.writeMessage(3,qs,ie.layers[he])}(pe,ee),ee.finish()}function qs(pe,ee){var ie;ee.writeVarintField(15,pe.version||1),ee.writeStringField(1,pe.name||""),ee.writeVarintField(5,pe.extent||4096);var ae={keys:[],values:[],keycache:{},valuecache:{}};for(ie=0;ie<pe.length;ie++)ae.feature=pe.feature(ie),ee.writeMessage(2,qi,ae);var he=ae.keys;for(ie=0;ie<he.length;ie++)ee.writeStringField(3,he[ie]);var Te=ae.values;for(ie=0;ie<Te.length;ie++)ee.writeMessage(4,Vr,Te[ie])}function qi(pe,ee){var ie=pe.feature;ie.id!==void 0&&ee.writeVarintField(1,ie.id),ee.writeMessage(2,ni,pe),ee.writeVarintField(3,ie.type),ee.writeMessage(4,pn,ie)}function ni(pe,ee){var ie=pe.feature,ae=pe.keys,he=pe.values,Te=pe.keycache,Ae=pe.valuecache;for(var Pe in ie.properties){var be=ie.properties[Pe],Re=Te[Pe];if(be!==null){Re===void 0&&(ae.push(Pe),Te[Pe]=Re=ae.length-1),ee.writeVarint(Re);var qe=typeof be;qe!=="string"&&qe!=="boolean"&&qe!=="number"&&(be=JSON.stringify(be));var Fe=qe+":"+be,Ne=Ae[Fe];Ne===void 0&&(he.push(be),Ae[Fe]=Ne=he.length-1),ee.writeVarint(Ne)}}}function Mi(pe,ee){return(ee<<3)+(7&pe)}function xr(pe){return pe<<1^pe>>31}function pn(pe,ee){for(var ie=pe.loadGeometry(),ae=pe.type,he=0,Te=0,Ae=ie.length,Pe=0;Pe<Ae;Pe++){var be=ie[Pe],Re=1;ae===1&&(Re=be.length),ee.writeVarint(Mi(1,Re));for(var qe=ae===3?be.length-1:be.length,Fe=0;Fe<qe;Fe++){Fe===1&&ae!==1&&ee.writeVarint(Mi(2,qe-1));var Ne=be[Fe].x-he,lt=be[Fe].y-Te;ee.writeVarint(xr(Ne)),ee.writeVarint(xr(lt)),he+=Ne,Te+=lt}ae===3&&ee.writeVarint(Mi(7,1))}}function Vr(pe,ee){var ie=typeof pe;ie==="string"?ee.writeStringField(1,pe):ie==="boolean"?ee.writeBooleanField(7,pe):ie==="number"&&(pe%1!=0?ee.writeDoubleField(3,pe):pe<0?ee.writeSVarintField(6,pe):ee.writeVarintField(5,pe))}yt.exports=Yr,yt.exports.fromVectorTileJs=Yr,yt.exports.fromGeojsonVt=function(pe,ee){ee=ee||{};var ie={};for(var ae in pe)ie[ae]=new dn(pe[ae].features,ee),ie[ae].name=ae,ie[ae].version=ee.version,ie[ae].extent=ee.extent;return Yr({layers:ie})},yt.exports.GeoJSONWrapper=dn;var $n=$.bv(yt.exports);const Rr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:pe=>pe},_s=Math.fround||(Jr=new Float32Array(1),pe=>(Jr[0]=+pe,Jr[0]));var Jr;const ji=3,Hi=5,fn=6;class Dr{constructor(ee){this.options=Object.assign(Object.create(Rr),ee),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ee){const{log:ie,minZoom:ae,maxZoom:he}=this.options;ie&&console.time("total time");const Te=`prepare ${ee.length} points`;ie&&console.time(Te),this.points=ee;const Ae=[];for(let be=0;be<ee.length;be++){const Re=ee[be];if(!Re.geometry)continue;const[qe,Fe]=Re.geometry.coordinates,Ne=_s(vr(qe)),lt=_s(br(Fe));Ae.push(Ne,lt,1/0,be,-1,1),this.options.reduce&&Ae.push(0)}let Pe=this.trees[he+1]=this._createTree(Ae);ie&&console.timeEnd(Te);for(let be=he;be>=ae;be--){const Re=+Date.now();Pe=this.trees[be]=this._createTree(this._cluster(Pe,be)),ie&&console.log("z%d: %d clusters in %dms",be,Pe.numItems,+Date.now()-Re)}return ie&&console.timeEnd("total time"),this}getClusters(ee,ie){let ae=((ee[0]+180)%360+360)%360-180;const he=Math.max(-90,Math.min(90,ee[1]));let Te=ee[2]===180?180:((ee[2]+180)%360+360)%360-180;const Ae=Math.max(-90,Math.min(90,ee[3]));if(ee[2]-ee[0]>=360)ae=-180,Te=180;else if(ae>Te){const Fe=this.getClusters([ae,he,180,Ae],ie),Ne=this.getClusters([-180,he,Te,Ae],ie);return Fe.concat(Ne)}const Pe=this.trees[this._limitZoom(ie)],be=Pe.range(vr(ae),br(Ae),vr(Te),br(he)),Re=Pe.data,qe=[];for(const Fe of be){const Ne=this.stride*Fe;qe.push(Re[Ne+Hi]>1?mn(Re,Ne,this.clusterProps):this.points[Re[Ne+ji]])}return qe}getChildren(ee){const ie=this._getOriginId(ee),ae=this._getOriginZoom(ee),he="No cluster with the specified id.",Te=this.trees[ae];if(!Te)throw new Error(he);const Ae=Te.data;if(ie*this.stride>=Ae.length)throw new Error(he);const Pe=this.options.radius/(this.options.extent*Math.pow(2,ae-1)),be=Te.within(Ae[ie*this.stride],Ae[ie*this.stride+1],Pe),Re=[];for(const qe of be){const Fe=qe*this.stride;Ae[Fe+4]===ee&&Re.push(Ae[Fe+Hi]>1?mn(Ae,Fe,this.clusterProps):this.points[Ae[Fe+ji]])}if(Re.length===0)throw new Error(he);return Re}getLeaves(ee,ie,ae){const he=[];return this._appendLeaves(he,ee,ie=ie||10,ae=ae||0,0),he}getTile(ee,ie,ae){const he=this.trees[this._limitZoom(ee)],Te=Math.pow(2,ee),{extent:Ae,radius:Pe}=this.options,be=Pe/Ae,Re=(ae-be)/Te,qe=(ae+1+be)/Te,Fe={features:[]};return this._addTileFeatures(he.range((ie-be)/Te,Re,(ie+1+be)/Te,qe),he.data,ie,ae,Te,Fe),ie===0&&this._addTileFeatures(he.range(1-be/Te,Re,1,qe),he.data,Te,ae,Te,Fe),ie===Te-1&&this._addTileFeatures(he.range(0,Re,be/Te,qe),he.data,-1,ae,Te,Fe),Fe.features.length?Fe:null}getClusterExpansionZoom(ee){let ie=this._getOriginZoom(ee)-1;for(;ie<=this.options.maxZoom;){const ae=this.getChildren(ee);if(ie++,ae.length!==1)break;ee=ae[0].properties.cluster_id}return ie}_appendLeaves(ee,ie,ae,he,Te){const Ae=this.getChildren(ie);for(const Pe of Ae){const be=Pe.properties;if(be&&be.cluster?Te+be.point_count<=he?Te+=be.point_count:Te=this._appendLeaves(ee,be.cluster_id,ae,he,Te):Te<he?Te++:ee.push(Pe),ee.length===ae)break}return Te}_createTree(ee){const ie=new $.au(ee.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ae=0;ae<ee.length;ae+=this.stride)ie.add(ee[ae],ee[ae+1]);return ie.finish(),ie.data=ee,ie}_addTileFeatures(ee,ie,ae,he,Te,Ae){for(const Pe of ee){const be=Pe*this.stride,Re=ie[be+Hi]>1;let qe,Fe,Ne;if(Re)qe=qr(ie,be,this.clusterProps),Fe=ie[be],Ne=ie[be+1];else{const ft=this.points[ie[be+ji]];qe=ft.properties;const[kt,xt]=ft.geometry.coordinates;Fe=vr(kt),Ne=br(xt)}const lt={type:1,geometry:[[Math.round(this.options.extent*(Fe*Te-ae)),Math.round(this.options.extent*(Ne*Te-he))]],tags:qe};let gt;gt=Re||this.options.generateId?ie[be+ji]:this.points[ie[be+ji]].id,gt!==void 0&&(lt.id=gt),Ae.features.push(lt)}}_limitZoom(ee){return Math.max(this.options.minZoom,Math.min(Math.floor(+ee),this.options.maxZoom+1))}_cluster(ee,ie){const{radius:ae,extent:he,reduce:Te,minPoints:Ae}=this.options,Pe=ae/(he*Math.pow(2,ie)),be=ee.data,Re=[],qe=this.stride;for(let Fe=0;Fe<be.length;Fe+=qe){if(be[Fe+2]<=ie)continue;be[Fe+2]=ie;const Ne=be[Fe],lt=be[Fe+1],gt=ee.within(be[Fe],be[Fe+1],Pe),ft=be[Fe+Hi];let kt=ft;for(const xt of gt){const Wt=xt*qe;be[Wt+2]>ie&&(kt+=be[Wt+Hi])}if(kt>ft&&kt>=Ae){let xt,Wt=Ne*ft,qt=lt*ft,li=-1;const St=((Fe/qe|0)<<5)+(ie+1)+this.points.length;for(const ti of gt){const wi=ti*qe;if(be[wi+2]<=ie)continue;be[wi+2]=ie;const Zi=be[wi+Hi];Wt+=be[wi]*Zi,qt+=be[wi+1]*Zi,be[wi+4]=St,Te&&(xt||(xt=this._map(be,Fe,!0),li=this.clusterProps.length,this.clusterProps.push(xt)),Te(xt,this._map(be,wi)))}be[Fe+4]=St,Re.push(Wt/kt,qt/kt,1/0,St,-1,kt),Te&&Re.push(li)}else{for(let xt=0;xt<qe;xt++)Re.push(be[Fe+xt]);if(kt>1)for(const xt of gt){const Wt=xt*qe;if(!(be[Wt+2]<=ie)){be[Wt+2]=ie;for(let qt=0;qt<qe;qt++)Re.push(be[Wt+qt])}}}}return Re}_getOriginId(ee){return ee-this.points.length>>5}_getOriginZoom(ee){return(ee-this.points.length)%32}_map(ee,ie,ae){if(ee[ie+Hi]>1){const Ae=this.clusterProps[ee[ie+fn]];return ae?Object.assign({},Ae):Ae}const he=this.points[ee[ie+ji]].properties,Te=this.options.map(he);return ae&&Te===he?Object.assign({},Te):Te}}function mn(pe,ee,ie){return{type:"Feature",id:pe[ee+ji],properties:qr(pe,ee,ie),geometry:{type:"Point",coordinates:[(ae=pe[ee],360*(ae-.5)),Nn(pe[ee+1])]}};var ae}function qr(pe,ee,ie){const ae=pe[ee+Hi],he=ae>=1e4?`${Math.round(ae/1e3)}k`:ae>=1e3?Math.round(ae/100)/10+"k":ae,Te=pe[ee+fn],Ae=Te===-1?{}:Object.assign({},ie[Te]);return Object.assign(Ae,{cluster:!0,cluster_id:pe[ee+ji],point_count:ae,point_count_abbreviated:he})}function vr(pe){return pe/360+.5}function br(pe){const ee=Math.sin(pe*Math.PI/180),ie=.5-.25*Math.log((1+ee)/(1-ee))/Math.PI;return ie<0?0:ie>1?1:ie}function Nn(pe){const ee=(180-360*pe)*Math.PI/180;return 360*Math.atan(Math.exp(ee))/Math.PI-90}function Qr(pe,ee,ie,ae){for(var he,Te=ae,Ae=ie-ee>>1,Pe=ie-ee,be=pe[ee],Re=pe[ee+1],qe=pe[ie],Fe=pe[ie+1],Ne=ee+3;Ne<ie;Ne+=3){var lt=js(pe[Ne],pe[Ne+1],be,Re,qe,Fe);if(lt>Te)he=Ne,Te=lt;else if(lt===Te){var gt=Math.abs(Ne-Ae);gt<Pe&&(he=Ne,Pe=gt)}}Te>ae&&(he-ee>3&&Qr(pe,ee,he,ae),pe[he+2]=Te,ie-he>3&&Qr(pe,he,ie,ae))}function js(pe,ee,ie,ae,he,Te){var Ae=he-ie,Pe=Te-ae;if(Ae!==0||Pe!==0){var be=((pe-ie)*Ae+(ee-ae)*Pe)/(Ae*Ae+Pe*Pe);be>1?(ie=he,ae=Te):be>0&&(ie+=Ae*be,ae+=Pe*be)}return(Ae=pe-ie)*Ae+(Pe=ee-ae)*Pe}function en(pe,ee,ie,ae){var he={id:pe===void 0?null:pe,type:ee,geometry:ie,tags:ae,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Te){var Ae=Te.geometry,Pe=Te.type;if(Pe==="Point"||Pe==="MultiPoint"||Pe==="LineString")tn(Te,Ae);else if(Pe==="Polygon"||Pe==="MultiLineString")for(var be=0;be<Ae.length;be++)tn(Te,Ae[be]);else if(Pe==="MultiPolygon")for(be=0;be<Ae.length;be++)for(var Re=0;Re<Ae[be].length;Re++)tn(Te,Ae[be][Re])}(he),he}function tn(pe,ee){for(var ie=0;ie<ee.length;ie+=3)pe.minX=Math.min(pe.minX,ee[ie]),pe.minY=Math.min(pe.minY,ee[ie+1]),pe.maxX=Math.max(pe.maxX,ee[ie]),pe.maxY=Math.max(pe.maxY,ee[ie+1])}function rn(pe,ee,ie,ae){if(ee.geometry){var he=ee.geometry.coordinates,Te=ee.geometry.type,Ae=Math.pow(ie.tolerance/((1<<ie.maxZoom)*ie.extent),2),Pe=[],be=ee.id;if(ie.promoteId?be=ee.properties[ie.promoteId]:ie.generateId&&(be=ae||0),Te==="Point")mi(he,Pe);else if(Te==="MultiPoint")for(var Re=0;Re<he.length;Re++)mi(he[Re],Pe);else if(Te==="LineString")gn(he,Pe,Ae,!1);else if(Te==="MultiLineString"){if(ie.lineMetrics){for(Re=0;Re<he.length;Re++)gn(he[Re],Pe=[],Ae,!1),pe.push(en(be,"LineString",Pe,ee.properties));return}Le(he,Pe,Ae,!1)}else if(Te==="Polygon")Le(he,Pe,Ae,!0);else{if(Te!=="MultiPolygon"){if(Te==="GeometryCollection"){for(Re=0;Re<ee.geometry.geometries.length;Re++)rn(pe,{id:be,geometry:ee.geometry.geometries[Re],properties:ee.properties},ie,ae);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Re=0;Re<he.length;Re++){var qe=[];Le(he[Re],qe,Ae,!0),Pe.push(qe)}}pe.push(en(be,Te,Pe,ee.properties))}}function mi(pe,ee){ee.push(_n(pe[0])),ee.push(ys(pe[1])),ee.push(0)}function gn(pe,ee,ie,ae){for(var he,Te,Ae=0,Pe=0;Pe<pe.length;Pe++){var be=_n(pe[Pe][0]),Re=ys(pe[Pe][1]);ee.push(be),ee.push(Re),ee.push(0),Pe>0&&(Ae+=ae?(he*Re-be*Te)/2:Math.sqrt(Math.pow(be-he,2)+Math.pow(Re-Te,2))),he=be,Te=Re}var qe=ee.length-3;ee[2]=1,Qr(ee,0,qe,ie),ee[qe+2]=1,ee.size=Math.abs(Ae),ee.start=0,ee.end=ee.size}function Le(pe,ee,ie,ae){for(var he=0;he<pe.length;he++){var Te=[];gn(pe[he],Te,ie,ae),ee.push(Te)}}function _n(pe){return pe/360+.5}function ys(pe){var ee=Math.sin(pe*Math.PI/180),ie=.5-.25*Math.log((1+ee)/(1-ee))/Math.PI;return ie<0?0:ie>1?1:ie}function Dt(pe,ee,ie,ae,he,Te,Ae,Pe){if(ae/=ee,Te>=(ie/=ee)&&Ae<ae)return pe;if(Ae<ie||Te>=ae)return null;for(var be=[],Re=0;Re<pe.length;Re++){var qe=pe[Re],Fe=qe.geometry,Ne=qe.type,lt=he===0?qe.minX:qe.minY,gt=he===0?qe.maxX:qe.maxY;if(lt>=ie&&gt<ae)be.push(qe);else if(!(gt<ie||lt>=ae)){var ft=[];if(Ne==="Point"||Ne==="MultiPoint")Ti(Fe,ft,ie,ae,he);else if(Ne==="LineString")kr(Fe,ft,ie,ae,he,!1,Pe.lineMetrics);else if(Ne==="MultiLineString")Vn(Fe,ft,ie,ae,he,!1);else if(Ne==="Polygon")Vn(Fe,ft,ie,ae,he,!0);else if(Ne==="MultiPolygon")for(var kt=0;kt<Fe.length;kt++){var xt=[];Vn(Fe[kt],xt,ie,ae,he,!0),xt.length&&ft.push(xt)}if(ft.length){if(Pe.lineMetrics&&Ne==="LineString"){for(kt=0;kt<ft.length;kt++)be.push(en(qe.id,Ne,ft[kt],qe.tags));continue}Ne!=="LineString"&&Ne!=="MultiLineString"||(ft.length===1?(Ne="LineString",ft=ft[0]):Ne="MultiLineString"),Ne!=="Point"&&Ne!=="MultiPoint"||(Ne=ft.length===3?"Point":"MultiPoint"),be.push(en(qe.id,Ne,ft,qe.tags))}}}return be.length?be:null}function Ti(pe,ee,ie,ae,he){for(var Te=0;Te<pe.length;Te+=3){var Ae=pe[Te+he];Ae>=ie&&Ae<=ae&&(ee.push(pe[Te]),ee.push(pe[Te+1]),ee.push(pe[Te+2]))}}function kr(pe,ee,ie,ae,he,Te,Ae){for(var Pe,be,Re=Un(pe),qe=he===0?yn:jn,Fe=pe.start,Ne=0;Ne<pe.length-3;Ne+=3){var lt=pe[Ne],gt=pe[Ne+1],ft=pe[Ne+2],kt=pe[Ne+3],xt=pe[Ne+4],Wt=he===0?lt:gt,qt=he===0?kt:xt,li=!1;Ae&&(Pe=Math.sqrt(Math.pow(lt-kt,2)+Math.pow(gt-xt,2))),Wt<ie?qt>ie&&(be=qe(Re,lt,gt,kt,xt,ie),Ae&&(Re.start=Fe+Pe*be)):Wt>ae?qt<ae&&(be=qe(Re,lt,gt,kt,xt,ae),Ae&&(Re.start=Fe+Pe*be)):qn(Re,lt,gt,ft),qt<ie&&Wt>=ie&&(be=qe(Re,lt,gt,kt,xt,ie),li=!0),qt>ae&&Wt<=ae&&(be=qe(Re,lt,gt,kt,xt,ae),li=!0),!Te&&li&&(Ae&&(Re.end=Fe+Pe*be),ee.push(Re),Re=Un(pe)),Ae&&(Fe+=Pe)}var St=pe.length-3;lt=pe[St],gt=pe[St+1],ft=pe[St+2],(Wt=he===0?lt:gt)>=ie&&Wt<=ae&&qn(Re,lt,gt,ft),St=Re.length-3,Te&&St>=3&&(Re[St]!==Re[0]||Re[St+1]!==Re[1])&&qn(Re,Re[0],Re[1],Re[2]),Re.length&&ee.push(Re)}function Un(pe){var ee=[];return ee.size=pe.size,ee.start=pe.start,ee.end=pe.end,ee}function Vn(pe,ee,ie,ae,he,Te){for(var Ae=0;Ae<pe.length;Ae++)kr(pe[Ae],ee,ie,ae,he,Te,!1)}function qn(pe,ee,ie,ae){pe.push(ee),pe.push(ie),pe.push(ae)}function yn(pe,ee,ie,ae,he,Te){var Ae=(Te-ee)/(ae-ee);return pe.push(Te),pe.push(ie+(he-ie)*Ae),pe.push(1),Ae}function jn(pe,ee,ie,ae,he,Te){var Ae=(Te-ie)/(he-ie);return pe.push(ee+(ae-ee)*Ae),pe.push(Te),pe.push(1),Ae}function xs(pe,ee){for(var ie=[],ae=0;ae<pe.length;ae++){var he,Te=pe[ae],Ae=Te.type;if(Ae==="Point"||Ae==="MultiPoint"||Ae==="LineString")he=Ye(Te.geometry,ee);else if(Ae==="MultiLineString"||Ae==="Polygon"){he=[];for(var Pe=0;Pe<Te.geometry.length;Pe++)he.push(Ye(Te.geometry[Pe],ee))}else if(Ae==="MultiPolygon")for(he=[],Pe=0;Pe<Te.geometry.length;Pe++){for(var be=[],Re=0;Re<Te.geometry[Pe].length;Re++)be.push(Ye(Te.geometry[Pe][Re],ee));he.push(be)}ie.push(en(Te.id,Ae,he,Te.tags))}return ie}function Ye(pe,ee){var ie=[];ie.size=pe.size,pe.start!==void 0&&(ie.start=pe.start,ie.end=pe.end);for(var ae=0;ae<pe.length;ae+=3)ie.push(pe[ae]+ee,pe[ae+1],pe[ae+2]);return ie}function rr(pe,ee){if(pe.transformed)return pe;var ie,ae,he,Te=1<<pe.z,Ae=pe.x,Pe=pe.y;for(ie=0;ie<pe.features.length;ie++){var be=pe.features[ie],Re=be.geometry,qe=be.type;if(be.geometry=[],qe===1)for(ae=0;ae<Re.length;ae+=2)be.geometry.push(Gi(Re[ae],Re[ae+1],ee,Te,Ae,Pe));else for(ae=0;ae<Re.length;ae++){var Fe=[];for(he=0;he<Re[ae].length;he+=2)Fe.push(Gi(Re[ae][he],Re[ae][he+1],ee,Te,Ae,Pe));be.geometry.push(Fe)}}return pe.transformed=!0,pe}function Gi(pe,ee,ie,ae,he,Te){return[Math.round(ie*(pe*ae-he)),Math.round(ie*(ee*ae-Te))]}function vs(pe,ee,ie,ae,he){for(var Te=ee===he.maxZoom?0:he.tolerance/((1<<ee)*he.extent),Ae={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ie,y:ae,z:ee,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Pe=0;Pe<pe.length;Pe++){Ae.numFeatures++,xn(Ae,pe[Pe],Te,he);var be=pe[Pe].minX,Re=pe[Pe].minY,qe=pe[Pe].maxX,Fe=pe[Pe].maxY;be<Ae.minX&&(Ae.minX=be),Re<Ae.minY&&(Ae.minY=Re),qe>Ae.maxX&&(Ae.maxX=qe),Fe>Ae.maxY&&(Ae.maxY=Fe)}return Ae}function xn(pe,ee,ie,ae){var he=ee.geometry,Te=ee.type,Ae=[];if(Te==="Point"||Te==="MultiPoint")for(var Pe=0;Pe<he.length;Pe+=3)Ae.push(he[Pe]),Ae.push(he[Pe+1]),pe.numPoints++,pe.numSimplified++;else if(Te==="LineString")We(Ae,he,pe,ie,!1,!1);else if(Te==="MultiLineString"||Te==="Polygon")for(Pe=0;Pe<he.length;Pe++)We(Ae,he[Pe],pe,ie,Te==="Polygon",Pe===0);else if(Te==="MultiPolygon")for(var be=0;be<he.length;be++){var Re=he[be];for(Pe=0;Pe<Re.length;Pe++)We(Ae,Re[Pe],pe,ie,!0,Pe===0)}if(Ae.length){var qe=ee.tags||null;if(Te==="LineString"&&ae.lineMetrics){for(var Fe in qe={},ee.tags)qe[Fe]=ee.tags[Fe];qe.mapbox_clip_start=he.start/he.size,qe.mapbox_clip_end=he.end/he.size}var Ne={geometry:Ae,type:Te==="Polygon"||Te==="MultiPolygon"?3:Te==="LineString"||Te==="MultiLineString"?2:1,tags:qe};ee.id!==null&&(Ne.id=ee.id),pe.features.push(Ne)}}function We(pe,ee,ie,ae,he,Te){var Ae=ae*ae;if(ae>0&&ee.size<(he?Ae:ae))ie.numPoints+=ee.length/3;else{for(var Pe=[],be=0;be<ee.length;be+=3)(ae===0||ee[be+2]>Ae)&&(ie.numSimplified++,Pe.push(ee[be]),Pe.push(ee[be+1])),ie.numPoints++;he&&function(Re,qe){for(var Fe=0,Ne=0,lt=Re.length,gt=lt-2;Ne<lt;gt=Ne,Ne+=2)Fe+=(Re[Ne]-Re[gt])*(Re[Ne+1]+Re[gt+1]);if(Fe>0===qe)for(Ne=0,lt=Re.length;Ne<lt/2;Ne+=2){var ft=Re[Ne],kt=Re[Ne+1];Re[Ne]=Re[lt-2-Ne],Re[Ne+1]=Re[lt-1-Ne],Re[lt-2-Ne]=ft,Re[lt-1-Ne]=kt}}(Pe,Te),pe.push(Pe)}}function Tt(pe,ee){var ie=(ee=this.options=function(he,Te){for(var Ae in Te)he[Ae]=Te[Ae];return he}(Object.create(this.options),ee)).debug;if(ie&&console.time("preprocess data"),ee.maxZoom<0||ee.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ee.promoteId&&ee.generateId)throw new Error("promoteId and generateId cannot be used together.");var ae=function(he,Te){var Ae=[];if(he.type==="FeatureCollection")for(var Pe=0;Pe<he.features.length;Pe++)rn(Ae,he.features[Pe],Te,Pe);else rn(Ae,he.type==="Feature"?he:{geometry:he},Te);return Ae}(pe,ee);this.tiles={},this.tileCoords=[],ie&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ee.indexMaxZoom,ee.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ae=function(he,Te){var Ae=Te.buffer/Te.extent,Pe=he,be=Dt(he,1,-1-Ae,Ae,0,-1,2,Te),Re=Dt(he,1,1-Ae,2+Ae,0,-1,2,Te);return(be||Re)&&(Pe=Dt(he,1,-Ae,1+Ae,0,-1,2,Te)||[],be&&(Pe=xs(be,1).concat(Pe)),Re&&(Pe=Pe.concat(xs(Re,-1)))),Pe}(ae,ee),ae.length&&this.splitTile(ae,0,0,0),ie&&(ae.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function bt(pe,ee,ie){return 32*((1<<pe)*ie+ee)+pe}function Ai(pe,ee){return ee?pe.properties[ee]:pe.id}function fr(pe,ee){if(pe==null)return!0;if(pe.type==="Feature")return Ai(pe,ee)!=null;if(pe.type==="FeatureCollection"){const ie=new Set;for(const ae of pe.features){const he=Ai(ae,ee);if(he==null||ie.has(he))return!1;ie.add(he)}return!0}return!1}function wt(pe,ee){const ie=new Map;if(pe!=null)if(pe.type==="Feature")ie.set(Ai(pe,ee),pe);else for(const ae of pe.features)ie.set(Ai(ae,ee),ae);return ie}Tt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Tt.prototype.splitTile=function(pe,ee,ie,ae,he,Te,Ae){for(var Pe=[pe,ee,ie,ae],be=this.options,Re=be.debug;Pe.length;){ae=Pe.pop(),ie=Pe.pop(),ee=Pe.pop(),pe=Pe.pop();var qe=1<<ee,Fe=bt(ee,ie,ae),Ne=this.tiles[Fe];if(!Ne&&(Re>1&&console.time("creation"),Ne=this.tiles[Fe]=vs(pe,ee,ie,ae,be),this.tileCoords.push({z:ee,x:ie,y:ae}),Re)){Re>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ee,ie,ae,Ne.numFeatures,Ne.numPoints,Ne.numSimplified),console.timeEnd("creation"));var lt="z"+ee;this.stats[lt]=(this.stats[lt]||0)+1,this.total++}if(Ne.source=pe,he){if(ee===be.maxZoom||ee===he)continue;var gt=1<<he-ee;if(ie!==Math.floor(Te/gt)||ae!==Math.floor(Ae/gt))continue}else if(ee===be.indexMaxZoom||Ne.numPoints<=be.indexMaxPoints)continue;if(Ne.source=null,pe.length!==0){Re>1&&console.time("clipping");var ft,kt,xt,Wt,qt,li,St=.5*be.buffer/be.extent,ti=.5-St,wi=.5+St,Zi=1+St;ft=kt=xt=Wt=null,qt=Dt(pe,qe,ie-St,ie+wi,0,Ne.minX,Ne.maxX,be),li=Dt(pe,qe,ie+ti,ie+Zi,0,Ne.minX,Ne.maxX,be),pe=null,qt&&(ft=Dt(qt,qe,ae-St,ae+wi,1,Ne.minY,Ne.maxY,be),kt=Dt(qt,qe,ae+ti,ae+Zi,1,Ne.minY,Ne.maxY,be),qt=null),li&&(xt=Dt(li,qe,ae-St,ae+wi,1,Ne.minY,Ne.maxY,be),Wt=Dt(li,qe,ae+ti,ae+Zi,1,Ne.minY,Ne.maxY,be),li=null),Re>1&&console.timeEnd("clipping"),Pe.push(ft||[],ee+1,2*ie,2*ae),Pe.push(kt||[],ee+1,2*ie,2*ae+1),Pe.push(xt||[],ee+1,2*ie+1,2*ae),Pe.push(Wt||[],ee+1,2*ie+1,2*ae+1)}}},Tt.prototype.getTile=function(pe,ee,ie){var ae=this.options,he=ae.extent,Te=ae.debug;if(pe<0||pe>24)return null;var Ae=1<<pe,Pe=bt(pe,ee=(ee%Ae+Ae)%Ae,ie);if(this.tiles[Pe])return rr(this.tiles[Pe],he);Te>1&&console.log("drilling down to z%d-%d-%d",pe,ee,ie);for(var be,Re=pe,qe=ee,Fe=ie;!be&&Re>0;)Re--,qe=Math.floor(qe/2),Fe=Math.floor(Fe/2),be=this.tiles[bt(Re,qe,Fe)];return be&&be.source?(Te>1&&console.log("found parent tile z%d-%d-%d",Re,qe,Fe),Te>1&&console.time("drilling down"),this.splitTile(be.source,Re,qe,Fe,pe,ee,ie),Te>1&&console.timeEnd("drilling down"),this.tiles[Pe]?rr(this.tiles[Pe],he):null):null};class nn extends we{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(ee,ie){return $._(this,void 0,void 0,function*(){const ae=ee.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const he=this._geoJSONIndex.getTile(ae.z,ae.x,ae.y);if(!he)return null;const Te=new class{constructor(Pe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=$.W,this.length=Pe.length,this._features=Pe}feature(Pe){return new class{constructor(be){this._feature=be,this.extent=$.W,this.type=be.type,this.properties=be.tags,"id"in be&&!isNaN(be.id)&&(this.id=parseInt(be.id,10))}loadGeometry(){if(this._feature.type===1){const be=[];for(const Re of this._feature.geometry)be.push([new $.P(Re[0],Re[1])]);return be}{const be=[];for(const Re of this._feature.geometry){const qe=[];for(const Fe of Re)qe.push(new $.P(Fe[0],Fe[1]));be.push(qe)}return be}}toGeoJSON(be,Re,qe){return ht.call(this,be,Re,qe)}}(this._features[Pe])}}(he.features);let Ae=$n(Te);return Ae.byteOffset===0&&Ae.byteLength===Ae.buffer.byteLength||(Ae=new Uint8Array(Ae)),{vectorTile:Te,rawData:Ae.buffer}})}loadData(ee){return $._(this,void 0,void 0,function*(){var ie;(ie=this._pendingRequest)===null||ie===void 0||ie.abort();const ae=!!(ee&&ee.request&&ee.request.collectResourceTiming)&&new $.bs(ee.request);this._pendingRequest=new AbortController;try{let he=yield this.loadGeoJSON(ee,this._pendingRequest);if(delete this._pendingRequest,typeof he!="object")throw new Error(`Input data given to '${ee.source}' is not a valid GeoJSON object.`);if(Xe(he,!0),ee.filter){const Ae=$.by(ee.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ae.result==="error")throw new Error(Ae.value.map(be=>`${be.key}: ${be.message}`).join(", "));he={type:"FeatureCollection",features:he.features.filter(be=>Ae.value.evaluate({zoom:0},be))}}this._geoJSONIndex=ee.cluster?new Dr(function({superclusterOptions:Ae,clusterProperties:Pe}){if(!Pe||!Ae)return Ae;const be={},Re={},qe={accumulated:null,zoom:0},Fe={properties:null},Ne=Object.keys(Pe);for(const lt of Ne){const[gt,ft]=Pe[lt],kt=$.by(ft),xt=$.by(typeof gt=="string"?[gt,["accumulated"],["get",lt]]:gt);be[lt]=kt.value,Re[lt]=xt.value}return Ae.map=lt=>{Fe.properties=lt;const gt={};for(const ft of Ne)gt[ft]=be[ft].evaluate(qe,Fe);return gt},Ae.reduce=(lt,gt)=>{Fe.properties=gt;for(const ft of Ne)qe.accumulated=lt[ft],lt[ft]=Re[ft].evaluate(qe,Fe)},Ae}(ee)).load(he.features):function(Ae,Pe){return new Tt(Ae,Pe)}(he,ee.geojsonVtOptions),this.loaded={};const Te={};if(ae){const Ae=ae.finish();Ae&&(Te.resourceTiming={},Te.resourceTiming[ee.source]=JSON.parse(JSON.stringify(Ae)))}return Te}catch(he){if(delete this._pendingRequest,$.bz(he))return{abandoned:!0};throw he}})}reloadTile(ee){const ie=this.loaded;return ie&&ie[ee.uid]?super.reloadTile(ee):this.loadTile(ee)}loadGeoJSON(ee,ie){return $._(this,void 0,void 0,function*(){const{promoteId:ae}=ee;if(ee.request){const he=yield $.h(ee.request,ie);return this._dataUpdateable=fr(he.data,ae)?wt(he.data,ae):void 0,he.data}if(typeof ee.data=="string")try{const he=JSON.parse(ee.data);return this._dataUpdateable=fr(he,ae)?wt(he,ae):void 0,he}catch{throw new Error(`Input data given to '${ee.source}' is not a valid GeoJSON object.`)}if(!ee.dataDiff)throw new Error(`Input data given to '${ee.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${ee.source}`);return function(he,Te,Ae){var Pe,be,Re,qe;if(Te.removeAll&&he.clear(),Te.remove)for(const Fe of Te.remove)he.delete(Fe);if(Te.add)for(const Fe of Te.add){const Ne=Ai(Fe,Ae);Ne!=null&&he.set(Ne,Fe)}if(Te.update)for(const Fe of Te.update){let Ne=he.get(Fe.id);if(Ne==null)continue;const lt=!Fe.removeAllProperties&&(((Pe=Fe.removeProperties)===null||Pe===void 0?void 0:Pe.length)>0||((be=Fe.addOrUpdateProperties)===null||be===void 0?void 0:be.length)>0);if((Fe.newGeometry||Fe.removeAllProperties||lt)&&(Ne=Object.assign({},Ne),he.set(Fe.id,Ne),lt&&(Ne.properties=Object.assign({},Ne.properties))),Fe.newGeometry&&(Ne.geometry=Fe.newGeometry),Fe.removeAllProperties)Ne.properties={};else if(((Re=Fe.removeProperties)===null||Re===void 0?void 0:Re.length)>0)for(const gt of Fe.removeProperties)Object.prototype.hasOwnProperty.call(Ne.properties,gt)&&delete Ne.properties[gt];if(((qe=Fe.addOrUpdateProperties)===null||qe===void 0?void 0:qe.length)>0)for(const{key:gt,value:ft}of Fe.addOrUpdateProperties)Ne.properties[gt]=ft}}(this._dataUpdateable,ee.dataDiff,ae),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(ee){return $._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(ee){return this._geoJSONIndex.getClusterExpansionZoom(ee.clusterId)}getClusterChildren(ee){return this._geoJSONIndex.getChildren(ee.clusterId)}getClusterLeaves(ee){return this._geoJSONIndex.getLeaves(ee.clusterId,ee.limit,ee.offset)}}class jr{constructor(ee){this.self=ee,this.actor=new $.C(ee),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(ie,ae)=>{if(this.externalWorkerSourceTypes[ie])throw new Error(`Worker source with name "${ie}" already registered.`);this.externalWorkerSourceTypes[ie]=ae},this.self.addProtocol=$.bf,this.self.removeProtocol=$.bg,this.self.registerRTLTextPlugin=ie=>{if($.bA.isParsed())throw new Error("RTL text plugin already registered.");$.bA.setMethods(ie)},this.actor.registerMessageHandler("loadDEMTile",(ie,ae)=>this._getDEMWorkerSource(ie,ae.source).loadTile(ae)),this.actor.registerMessageHandler("removeDEMTile",(ie,ae)=>$._(this,void 0,void 0,function*(){this._getDEMWorkerSource(ie,ae.source).removeTile(ae)})),this.actor.registerMessageHandler("getClusterExpansionZoom",(ie,ae)=>$._(this,void 0,void 0,function*(){return this._getWorkerSource(ie,ae.type,ae.source).getClusterExpansionZoom(ae)})),this.actor.registerMessageHandler("getClusterChildren",(ie,ae)=>$._(this,void 0,void 0,function*(){return this._getWorkerSource(ie,ae.type,ae.source).getClusterChildren(ae)})),this.actor.registerMessageHandler("getClusterLeaves",(ie,ae)=>$._(this,void 0,void 0,function*(){return this._getWorkerSource(ie,ae.type,ae.source).getClusterLeaves(ae)})),this.actor.registerMessageHandler("loadData",(ie,ae)=>this._getWorkerSource(ie,ae.type,ae.source).loadData(ae)),this.actor.registerMessageHandler("loadTile",(ie,ae)=>this._getWorkerSource(ie,ae.type,ae.source).loadTile(ae)),this.actor.registerMessageHandler("reloadTile",(ie,ae)=>this._getWorkerSource(ie,ae.type,ae.source).reloadTile(ae)),this.actor.registerMessageHandler("abortTile",(ie,ae)=>this._getWorkerSource(ie,ae.type,ae.source).abortTile(ae)),this.actor.registerMessageHandler("removeTile",(ie,ae)=>this._getWorkerSource(ie,ae.type,ae.source).removeTile(ae)),this.actor.registerMessageHandler("removeSource",(ie,ae)=>$._(this,void 0,void 0,function*(){if(!this.workerSources[ie]||!this.workerSources[ie][ae.type]||!this.workerSources[ie][ae.type][ae.source])return;const he=this.workerSources[ie][ae.type][ae.source];delete this.workerSources[ie][ae.type][ae.source],he.removeSource!==void 0&&he.removeSource(ae)})),this.actor.registerMessageHandler("removeMap",ie=>$._(this,void 0,void 0,function*(){delete this.layerIndexes[ie],delete this.availableImages[ie],delete this.workerSources[ie],delete this.demWorkerSources[ie]})),this.actor.registerMessageHandler("setReferrer",(ie,ae)=>$._(this,void 0,void 0,function*(){this.referrer=ae})),this.actor.registerMessageHandler("syncRTLPluginState",(ie,ae)=>this._syncRTLPluginState(ie,ae)),this.actor.registerMessageHandler("importScript",(ie,ae)=>$._(this,void 0,void 0,function*(){this.self.importScripts(ae)})),this.actor.registerMessageHandler("setImages",(ie,ae)=>this._setImages(ie,ae)),this.actor.registerMessageHandler("updateLayers",(ie,ae)=>$._(this,void 0,void 0,function*(){this._getLayerIndex(ie).update(ae.layers,ae.removedIds)})),this.actor.registerMessageHandler("setLayers",(ie,ae)=>$._(this,void 0,void 0,function*(){this._getLayerIndex(ie).replace(ae)}))}_setImages(ee,ie){return $._(this,void 0,void 0,function*(){this.availableImages[ee]=ie;for(const ae in this.workerSources[ee]){const he=this.workerSources[ee][ae];for(const Te in he)he[Te].availableImages=ie}})}_syncRTLPluginState(ee,ie){return $._(this,void 0,void 0,function*(){if($.bA.isParsed())return $.bA.getState();if(ie.pluginStatus!=="loading")return $.bA.setState(ie),ie;const ae=ie.pluginURL;if(this.self.importScripts(ae),$.bA.isParsed()){const he={pluginStatus:"loaded",pluginURL:ae};return $.bA.setState(he),he}throw $.bA.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${ae}`)})}_getAvailableImages(ee){let ie=this.availableImages[ee];return ie||(ie=[]),ie}_getLayerIndex(ee){let ie=this.layerIndexes[ee];return ie||(ie=this.layerIndexes[ee]=new M),ie}_getWorkerSource(ee,ie,ae){if(this.workerSources[ee]||(this.workerSources[ee]={}),this.workerSources[ee][ie]||(this.workerSources[ee][ie]={}),!this.workerSources[ee][ie][ae]){const he={sendAsync:(Te,Ae)=>(Te.targetMapId=ee,this.actor.sendAsync(Te,Ae))};switch(ie){case"vector":this.workerSources[ee][ie][ae]=new we(he,this._getLayerIndex(ee),this._getAvailableImages(ee));break;case"geojson":this.workerSources[ee][ie][ae]=new nn(he,this._getLayerIndex(ee),this._getAvailableImages(ee));break;default:this.workerSources[ee][ie][ae]=new this.externalWorkerSourceTypes[ie](he,this._getLayerIndex(ee),this._getAvailableImages(ee))}}return this.workerSources[ee][ie][ae]}_getDEMWorkerSource(ee,ie){return this.demWorkerSources[ee]||(this.demWorkerSources[ee]={}),this.demWorkerSources[ee][ie]||(this.demWorkerSources[ee][ie]=new ce),this.demWorkerSources[ee][ie]}}return $.i(self)&&(self.worker=new jr(self)),jr}),G("index",["exports","./shared"],function($,M){var ye="4.1.2";let oe,Ee;const we={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:D=>new Promise((y,S)=>{const I=requestAnimationFrame(y);D.signal.addEventListener("abort",()=>{cancelAnimationFrame(I),S(M.c())})}),getImageData(D,y=0){return this.getImageCanvasContext(D).getImageData(-y,-y,D.width+2*y,D.height+2*y)},getImageCanvasContext(D){const y=window.document.createElement("canvas"),S=y.getContext("2d",{willReadFrequently:!0});if(!S)throw new Error("failed to create canvas 2d context");return y.width=D.width,y.height=D.height,S.drawImage(D,0,0,D.width,D.height),S},resolveURL:D=>(oe||(oe=document.createElement("a")),oe.href=D,oe.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Ee==null&&(Ee=matchMedia("(prefers-reduced-motion: reduce)")),Ee.matches)}};class ce{static testProp(y){if(!ce.docStyle)return y[0];for(let S=0;S<y.length;S++)if(y[S]in ce.docStyle)return y[S];return y[0]}static create(y,S,I){const C=window.document.createElement(y);return S!==void 0&&(C.className=S),I&&I.appendChild(C),C}static createNS(y,S){return window.document.createElementNS(y,S)}static disableDrag(){ce.docStyle&&ce.selectProp&&(ce.userSelect=ce.docStyle[ce.selectProp],ce.docStyle[ce.selectProp]="none")}static enableDrag(){ce.docStyle&&ce.selectProp&&(ce.docStyle[ce.selectProp]=ce.userSelect)}static setTransform(y,S){y.style[ce.transformProp]=S}static addEventListener(y,S,I,C={}){y.addEventListener(S,I,"passive"in C?C:C.capture)}static removeEventListener(y,S,I,C={}){y.removeEventListener(S,I,"passive"in C?C:C.capture)}static suppressClickInternal(y){y.preventDefault(),y.stopPropagation(),window.removeEventListener("click",ce.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",ce.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",ce.suppressClickInternal,!0)},0)}static getScale(y){const S=y.getBoundingClientRect();return{x:S.width/y.offsetWidth||1,y:S.height/y.offsetHeight||1,boundingClientRect:S}}static getPoint(y,S,I){const C=S.boundingClientRect;return new M.P((I.clientX-C.left)/S.x-y.clientLeft,(I.clientY-C.top)/S.y-y.clientTop)}static mousePos(y,S){const I=ce.getScale(y);return ce.getPoint(y,I,S)}static touchPos(y,S){const I=[],C=ce.getScale(y);for(let z=0;z<S.length;z++)I.push(ce.getPoint(y,C,S[z]));return I}static mouseButton(y){return y.button}static remove(y){y.parentNode&&y.parentNode.removeChild(y)}}ce.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,ce.selectProp=ce.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),ce.transformProp=ce.testProp(["transform","WebkitTransform"]);const $e={supported:!1,testSupport:function(D){!ht&&Xe&&(yt?$t(D):Ge=D)}};let Ge,Xe,ht=!1,yt=!1;function $t(D){const y=D.createTexture();D.bindTexture(D.TEXTURE_2D,y);try{if(D.texImage2D(D.TEXTURE_2D,0,D.RGBA,D.RGBA,D.UNSIGNED_BYTE,Xe),D.isContextLost())return;$e.supported=!0}catch{}D.deleteTexture(y),ht=!0}var Ft,Nt;typeof document<"u"&&(Xe=document.createElement("img"),Xe.onload=function(){Ge&&$t(Ge),Ge=null,yt=!0},Xe.onerror=function(){ht=!0,Ge=null},Xe.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(D){let y,S,I,C;D.resetRequestQueue=()=>{y=[],S=0,I=0,C={}},D.addThrottleControl=Z=>{const K=I++;return C[K]=Z,K},D.removeThrottleControl=Z=>{delete C[Z],N()},D.getImage=(Z,K,J=!0)=>new Promise((Q,ne)=>{$e.supported&&(Z.headers||(Z.headers={}),Z.headers.accept="image/webp,*/*"),M.e(Z,{type:"image"}),y.push({abortController:K,requestParameters:Z,supportImageRefresh:J,state:"queued",onError:fe=>{ne(fe)},onSuccess:fe=>{Q(fe)}}),N()});const z=Z=>M._(this,void 0,void 0,function*(){Z.state="running";const{requestParameters:K,supportImageRefresh:J,onError:Q,onSuccess:ne,abortController:fe}=Z,de=J===!1&&!M.i(self)&&!M.g(K.url)&&(!K.headers||Object.keys(K.headers).reduce((Se,De)=>Se&&De==="accept",!0));S++;const ge=de?U(K,fe):M.m(K,fe);try{const Se=yield ge;delete Z.abortController,Z.state="completed",Se.data instanceof HTMLImageElement||M.b(Se.data)?ne(Se):Se.data&&ne({data:yield(le=Se.data,typeof createImageBitmap=="function"?M.d(le):M.f(le)),cacheControl:Se.cacheControl,expires:Se.expires})}catch(Se){delete Z.abortController,Q(Se)}finally{S--,N()}var le}),N=()=>{const Z=(()=>{for(const K of Object.keys(C))if(C[K]())return!0;return!1})()?M.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:M.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let K=S;K<Z&&y.length>0;K++){const J=y.shift();J.abortController.signal.aborted?K--:z(J)}},U=(Z,K)=>new Promise((J,Q)=>{const ne=new Image,fe=Z.url,de=Z.credentials;de&&de==="include"?ne.crossOrigin="use-credentials":(de&&de==="same-origin"||!M.s(fe))&&(ne.crossOrigin="anonymous"),K.signal.addEventListener("abort",()=>{ne.src="",Q(M.c())}),ne.fetchPriority="high",ne.onload=()=>{ne.onerror=ne.onload=null,J({data:ne})},ne.onerror=()=>{ne.onerror=ne.onload=null,K.signal.aborted||Q(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},ne.src=fe})}(Ft||(Ft={})),Ft.resetRequestQueue(),function(D){D.Glyphs="Glyphs",D.Image="Image",D.Source="Source",D.SpriteImage="SpriteImage",D.SpriteJSON="SpriteJSON",D.Style="Style",D.Tile="Tile",D.Unknown="Unknown"}(Nt||(Nt={}));class Ci{constructor(y){this._transformRequestFn=y}transformRequest(y,S){return this._transformRequestFn&&this._transformRequestFn(y,S)||{url:y}}normalizeSpriteURL(y,S,I){const C=function(z){const N=z.match(ir);if(!N)throw new Error(`Unable to parse URL "${z}"`);return{protocol:N[1],authority:N[2],path:N[3]||"/",params:N[4]?N[4].split("&"):[]}}(y);return C.path+=`${S}${I}`,function(z){const N=z.params.length?`?${z.params.join("&")}`:"";return`${z.protocol}://${z.authority}${z.path}${N}`}(C)}setTransformRequest(y){this._transformRequestFn=y}}const ir=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Pi(D){var y=new M.A(3);return y[0]=D[0],y[1]=D[1],y[2]=D[2],y}var dn,Yr=function(D,y,S){return D[0]=y[0]-S[0],D[1]=y[1]-S[1],D[2]=y[2]-S[2],D};dn=new M.A(3),M.A!=Float32Array&&(dn[0]=0,dn[1]=0,dn[2]=0);var qs=function(D){var y=D[0],S=D[1];return y*y+S*S};function qi(D){const y=[];if(typeof D=="string")y.push({id:"default",url:D});else if(D&&D.length>0){const S=[];for(const{id:I,url:C}of D){const z=`${I}${C}`;S.indexOf(z)===-1&&(S.push(z),y.push({id:I,url:C}))}}return y}(function(){var D=new M.A(2);M.A!=Float32Array&&(D[0]=0,D[1]=0)})();class ni{constructor(y,S,I,C){this.context=y,this.format=I,this.texture=y.gl.createTexture(),this.update(S,C)}update(y,S,I){const{width:C,height:z}=y,N=!(this.size&&this.size[0]===C&&this.size[1]===z||I),{context:U}=this,{gl:Z}=U;if(this.useMipmap=!!(S&&S.useMipmap),Z.bindTexture(Z.TEXTURE_2D,this.texture),U.pixelStoreUnpackFlipY.set(!1),U.pixelStoreUnpack.set(1),U.pixelStoreUnpackPremultiplyAlpha.set(this.format===Z.RGBA&&(!S||S.premultiply!==!1)),N)this.size=[C,z],y instanceof HTMLImageElement||y instanceof HTMLCanvasElement||y instanceof HTMLVideoElement||y instanceof ImageData||M.b(y)?Z.texImage2D(Z.TEXTURE_2D,0,this.format,this.format,Z.UNSIGNED_BYTE,y):Z.texImage2D(Z.TEXTURE_2D,0,this.format,C,z,0,this.format,Z.UNSIGNED_BYTE,y.data);else{const{x:K,y:J}=I||{x:0,y:0};y instanceof HTMLImageElement||y instanceof HTMLCanvasElement||y instanceof HTMLVideoElement||y instanceof ImageData||M.b(y)?Z.texSubImage2D(Z.TEXTURE_2D,0,K,J,Z.RGBA,Z.UNSIGNED_BYTE,y):Z.texSubImage2D(Z.TEXTURE_2D,0,K,J,C,z,Z.RGBA,Z.UNSIGNED_BYTE,y.data)}this.useMipmap&&this.isSizePowerOfTwo()&&Z.generateMipmap(Z.TEXTURE_2D)}bind(y,S,I){const{context:C}=this,{gl:z}=C;z.bindTexture(z.TEXTURE_2D,this.texture),I!==z.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(I=z.LINEAR),y!==this.filter&&(z.texParameteri(z.TEXTURE_2D,z.TEXTURE_MAG_FILTER,y),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_MIN_FILTER,I||y),this.filter=y),S!==this.wrap&&(z.texParameteri(z.TEXTURE_2D,z.TEXTURE_WRAP_S,S),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_WRAP_T,S),this.wrap=S)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:y}=this.context;y.deleteTexture(this.texture),this.texture=null}}function Mi(D){const{userImage:y}=D;return!!(y&&y.render&&y.render())&&(D.data.replace(new Uint8Array(y.data.buffer)),!0)}class xr extends M.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new M.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(y){if(this.loaded!==y&&(this.loaded=y,y)){for(const{ids:S,promiseResolve:I}of this.requestors)I(this._getImagesForIds(S));this.requestors=[]}}getImage(y){const S=this.images[y];if(S&&!S.data&&S.spriteData){const I=S.spriteData;S.data=new M.R({width:I.width,height:I.height},I.context.getImageData(I.x,I.y,I.width,I.height).data),S.spriteData=null}return S}addImage(y,S){if(this.images[y])throw new Error(`Image id ${y} already exist, use updateImage instead`);this._validate(y,S)&&(this.images[y]=S)}_validate(y,S){let I=!0;const C=S.data||S.spriteData;return this._validateStretch(S.stretchX,C&&C.width)||(this.fire(new M.j(new Error(`Image "${y}" has invalid "stretchX" value`))),I=!1),this._validateStretch(S.stretchY,C&&C.height)||(this.fire(new M.j(new Error(`Image "${y}" has invalid "stretchY" value`))),I=!1),this._validateContent(S.content,S)||(this.fire(new M.j(new Error(`Image "${y}" has invalid "content" value`))),I=!1),I}_validateStretch(y,S){if(!y)return!0;let I=0;for(const C of y){if(C[0]<I||C[1]<C[0]||S<C[1])return!1;I=C[1]}return!0}_validateContent(y,S){if(!y)return!0;if(y.length!==4)return!1;const I=S.spriteData,C=I&&I.width||S.data.width,z=I&&I.height||S.data.height;return!(y[0]<0||C<y[0]||y[1]<0||z<y[1]||y[2]<0||C<y[2]||y[3]<0||z<y[3]||y[2]<y[0]||y[3]<y[1])}updateImage(y,S,I=!0){const C=this.getImage(y);if(I&&(C.data.width!==S.data.width||C.data.height!==S.data.height))throw new Error(`size mismatch between old image (${C.data.width}x${C.data.height}) and new image (${S.data.width}x${S.data.height}).`);S.version=C.version+1,this.images[y]=S,this.updatedImages[y]=!0}removeImage(y){const S=this.images[y];delete this.images[y],delete this.patterns[y],S.userImage&&S.userImage.onRemove&&S.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(y){return new Promise((S,I)=>{let C=!0;if(!this.isLoaded())for(const z of y)this.images[z]||(C=!1);this.isLoaded()||C?S(this._getImagesForIds(y)):this.requestors.push({ids:y,promiseResolve:S})})}_getImagesForIds(y){const S={};for(const I of y){let C=this.getImage(I);C||(this.fire(new M.k("styleimagemissing",{id:I})),C=this.getImage(I)),C?S[I]={data:C.data.clone(),pixelRatio:C.pixelRatio,sdf:C.sdf,version:C.version,stretchX:C.stretchX,stretchY:C.stretchY,content:C.content,hasRenderCallback:!!(C.userImage&&C.userImage.render)}:M.w(`Image "${I}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return S}getPixelSize(){const{width:y,height:S}=this.atlasImage;return{width:y,height:S}}getPattern(y){const S=this.patterns[y],I=this.getImage(y);if(!I)return null;if(S&&S.position.version===I.version)return S.position;if(S)S.position.version=I.version;else{const C={w:I.data.width+2,h:I.data.height+2,x:0,y:0},z=new M.I(C,I);this.patterns[y]={bin:C,position:z}}return this._updatePatternAtlas(),this.patterns[y].position}bind(y){const S=y.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new ni(y,this.atlasImage,S.RGBA),this.atlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE)}_updatePatternAtlas(){const y=[];for(const z in this.patterns)y.push(this.patterns[z].bin);const{w:S,h:I}=M.p(y),C=this.atlasImage;C.resize({width:S||1,height:I||1});for(const z in this.patterns){const{bin:N}=this.patterns[z],U=N.x+1,Z=N.y+1,K=this.getImage(z).data,J=K.width,Q=K.height;M.R.copy(K,C,{x:0,y:0},{x:U,y:Z},{width:J,height:Q}),M.R.copy(K,C,{x:0,y:Q-1},{x:U,y:Z-1},{width:J,height:1}),M.R.copy(K,C,{x:0,y:0},{x:U,y:Z+Q},{width:J,height:1}),M.R.copy(K,C,{x:J-1,y:0},{x:U-1,y:Z},{width:1,height:Q}),M.R.copy(K,C,{x:0,y:0},{x:U+J,y:Z},{width:1,height:Q})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(y){for(const S of y){if(this.callbackDispatchedThisFrame[S])continue;this.callbackDispatchedThisFrame[S]=!0;const I=this.getImage(S);I||M.w(`Image with ID: "${S}" was not found`),Mi(I)&&this.updateImage(S,I)}}}const pn=1e20;function Vr(D,y,S,I,C,z,N,U,Z){for(let K=y;K<y+I;K++)$n(D,S*z+K,z,C,N,U,Z);for(let K=S;K<S+C;K++)$n(D,K*z+y,1,I,N,U,Z)}function $n(D,y,S,I,C,z,N){z[0]=0,N[0]=-pn,N[1]=pn,C[0]=D[y];for(let U=1,Z=0,K=0;U<I;U++){C[U]=D[y+U*S];const J=U*U;do{const Q=z[Z];K=(C[U]-C[Q]+J-Q*Q)/(U-Q)/2}while(K<=N[Z]&&--Z>-1);Z++,z[Z]=U,N[Z]=K,N[Z+1]=pn}for(let U=0,Z=0;U<I;U++){for(;N[Z+1]<U;)Z++;const K=z[Z],J=U-K;D[y+U*S]=C[K]+J*J}}class Rr{constructor(y,S){this.requestManager=y,this.localIdeographFontFamily=S,this.entries={}}setURL(y){this.url=y}getGlyphs(y){return M._(this,void 0,void 0,function*(){const S=[];for(const z in y)for(const N of y[z])S.push(this._getAndCacheGlyphsPromise(z,N));const I=yield Promise.all(S),C={};for(const{stack:z,id:N,glyph:U}of I)C[z]||(C[z]={}),C[z][N]=U&&{id:U.id,bitmap:U.bitmap.clone(),metrics:U.metrics};return C})}_getAndCacheGlyphsPromise(y,S){return M._(this,void 0,void 0,function*(){let I=this.entries[y];I||(I=this.entries[y]={glyphs:{},requests:{},ranges:{}});let C=I.glyphs[S];if(C!==void 0)return{stack:y,id:S,glyph:C};if(C=this._tinySDF(I,y,S),C)return I.glyphs[S]=C,{stack:y,id:S,glyph:C};const z=Math.floor(S/256);if(256*z>65535)throw new Error("glyphs > 65535 not supported");if(I.ranges[z])return{stack:y,id:S,glyph:C};if(!this.url)throw new Error("glyphsUrl is not set");if(!I.requests[z]){const U=Rr.loadGlyphRange(y,z,this.url,this.requestManager);I.requests[z]=U}const N=yield I.requests[z];for(const U in N)this._doesCharSupportLocalGlyph(+U)||(I.glyphs[+U]=N[+U]);return I.ranges[z]=!0,{stack:y,id:S,glyph:N[S]||null}})}_doesCharSupportLocalGlyph(y){return!!this.localIdeographFontFamily&&(M.u["CJK Unified Ideographs"](y)||M.u["Hangul Syllables"](y)||M.u.Hiragana(y)||M.u.Katakana(y))}_tinySDF(y,S,I){const C=this.localIdeographFontFamily;if(!C||!this._doesCharSupportLocalGlyph(I))return;let z=y.tinySDF;if(!z){let U="400";/bold/i.test(S)?U="900":/medium/i.test(S)?U="500":/light/i.test(S)&&(U="200"),z=y.tinySDF=new Rr.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:C,fontWeight:U})}const N=z.draw(String.fromCharCode(I));return{id:I,bitmap:new M.o({width:N.width||60,height:N.height||60},N.data),metrics:{width:N.glyphWidth/2||24,height:N.glyphHeight/2||24,left:N.glyphLeft/2+.5||0,top:N.glyphTop/2-27.5||-8,advance:N.glyphAdvance/2||24,isDoubleResolution:!0}}}}Rr.loadGlyphRange=function(D,y,S,I){return M._(this,void 0,void 0,function*(){const C=256*y,z=C+255,N=I.transformRequest(S.replace("{fontstack}",D).replace("{range}",`${C}-${z}`),Nt.Glyphs),U=yield M.l(N,new AbortController);if(!U||!U.data)throw new Error(`Could not load glyph range. range: ${y}, ${C}-${z}`);const Z={};for(const K of M.n(U.data))Z[K.id]=K;return Z})},Rr.TinySDF=class{constructor({fontSize:D=24,buffer:y=3,radius:S=8,cutoff:I=.25,fontFamily:C="sans-serif",fontWeight:z="normal",fontStyle:N="normal"}={}){this.buffer=y,this.cutoff=I,this.radius=S;const U=this.size=D+4*y,Z=this._createCanvas(U),K=this.ctx=Z.getContext("2d",{willReadFrequently:!0});K.font=`${N} ${z} ${D}px ${C}`,K.textBaseline="alphabetic",K.textAlign="left",K.fillStyle="black",this.gridOuter=new Float64Array(U*U),this.gridInner=new Float64Array(U*U),this.f=new Float64Array(U),this.z=new Float64Array(U+1),this.v=new Uint16Array(U)}_createCanvas(D){const y=document.createElement("canvas");return y.width=y.height=D,y}draw(D){const{width:y,actualBoundingBoxAscent:S,actualBoundingBoxDescent:I,actualBoundingBoxLeft:C,actualBoundingBoxRight:z}=this.ctx.measureText(D),N=Math.ceil(S),U=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(z-C))),Z=Math.min(this.size-this.buffer,N+Math.ceil(I)),K=U+2*this.buffer,J=Z+2*this.buffer,Q=Math.max(K*J,0),ne=new Uint8ClampedArray(Q),fe={data:ne,width:K,height:J,glyphWidth:U,glyphHeight:Z,glyphTop:N,glyphLeft:0,glyphAdvance:y};if(U===0||Z===0)return fe;const{ctx:de,buffer:ge,gridInner:le,gridOuter:Se}=this;de.clearRect(ge,ge,U,Z),de.fillText(D,ge,ge+N);const De=de.getImageData(ge,ge,U,Z);Se.fill(pn,0,Q),le.fill(0,0,Q);for(let _e=0;_e<Z;_e++)for(let Ce=0;Ce<U;Ce++){const ke=De.data[4*(_e*U+Ce)+3]/255;if(ke===0)continue;const ze=(_e+ge)*K+Ce+ge;if(ke===1)Se[ze]=0,le[ze]=pn;else{const Be=.5-ke;Se[ze]=Be>0?Be*Be:0,le[ze]=Be<0?Be*Be:0}}Vr(Se,0,0,K,J,K,this.f,this.v,this.z),Vr(le,ge,ge,U,Z,K,this.f,this.v,this.z);for(let _e=0;_e<Q;_e++){const Ce=Math.sqrt(Se[_e])-Math.sqrt(le[_e]);ne[_e]=Math.round(255-255*(Ce/this.radius+this.cutoff))}return fe}};class _s{constructor(){this.specification=M.v.light.position}possiblyEvaluate(y,S){return M.y(y.expression.evaluate(S))}interpolate(y,S,I){return{x:M.z.number(y.x,S.x,I),y:M.z.number(y.y,S.y,I),z:M.z.number(y.z,S.z,I)}}}let Jr;class ji extends M.E{constructor(y){super(),Jr=Jr||new M.q({anchor:new M.D(M.v.light.anchor),position:new _s,color:new M.D(M.v.light.color),intensity:new M.D(M.v.light.intensity)}),this._transitionable=new M.T(Jr),this.setLight(y),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(y,S={}){if(!this._validate(M.r,y,S))for(const I in y){const C=y[I];I.endsWith("-transition")?this._transitionable.setTransition(I.slice(0,-11),C):this._transitionable.setValue(I,C)}}updateTransitions(y){this._transitioning=this._transitionable.transitioned(y,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(y){this.properties=this._transitioning.possiblyEvaluate(y)}_validate(y,S,I){return(!I||I.validate!==!1)&&M.t(this,y.call(M.x,{value:S,style:{glyphs:!0,sprite:!0},styleSpec:M.v}))}}class Hi{constructor(y,S){this.width=y,this.height=S,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(y,S){const I=y.join(",")+String(S);return this.dashEntry[I]||(this.dashEntry[I]=this.addDash(y,S)),this.dashEntry[I]}getDashRanges(y,S,I){const C=[];let z=y.length%2==1?-y[y.length-1]*I:0,N=y[0]*I,U=!0;C.push({left:z,right:N,isDash:U,zeroLength:y[0]===0});let Z=y[0];for(let K=1;K<y.length;K++){U=!U;const J=y[K];z=Z*I,Z+=J,N=Z*I,C.push({left:z,right:N,isDash:U,zeroLength:J===0})}return C}addRoundDash(y,S,I){const C=S/2;for(let z=-I;z<=I;z++){const N=this.width*(this.nextRow+I+z);let U=0,Z=y[U];for(let K=0;K<this.width;K++){K/Z.right>1&&(Z=y[++U]);const J=Math.abs(K-Z.left),Q=Math.abs(K-Z.right),ne=Math.min(J,Q);let fe;const de=z/I*(C+1);if(Z.isDash){const ge=C-Math.abs(de);fe=Math.sqrt(ne*ne+ge*ge)}else fe=C-Math.sqrt(ne*ne+de*de);this.data[N+K]=Math.max(0,Math.min(255,fe+128))}}}addRegularDash(y){for(let U=y.length-1;U>=0;--U){const Z=y[U],K=y[U+1];Z.zeroLength?y.splice(U,1):K&&K.isDash===Z.isDash&&(K.left=Z.left,y.splice(U,1))}const S=y[0],I=y[y.length-1];S.isDash===I.isDash&&(S.left=I.left-this.width,I.right=S.right+this.width);const C=this.width*this.nextRow;let z=0,N=y[z];for(let U=0;U<this.width;U++){U/N.right>1&&(N=y[++z]);const Z=Math.abs(U-N.left),K=Math.abs(U-N.right),J=Math.min(Z,K);this.data[C+U]=Math.max(0,Math.min(255,(N.isDash?J:-J)+128))}}addDash(y,S){const I=S?7:0,C=2*I+1;if(this.nextRow+C>this.height)return M.w("LineAtlas out of space"),null;let z=0;for(let U=0;U<y.length;U++)z+=y[U];if(z!==0){const U=this.width/z,Z=this.getDashRanges(y,this.width,U);S?this.addRoundDash(Z,U,I):this.addRegularDash(Z)}const N={y:(this.nextRow+I+.5)/this.height,height:2*I/this.height,width:z};return this.nextRow+=C,this.dirty=!0,N}bind(y){const S=y.gl;this.texture?(S.bindTexture(S.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,S.texSubImage2D(S.TEXTURE_2D,0,0,0,this.width,this.height,S.ALPHA,S.UNSIGNED_BYTE,this.data))):(this.texture=S.createTexture(),S.bindTexture(S.TEXTURE_2D,this.texture),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_S,S.REPEAT),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_T,S.REPEAT),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MIN_FILTER,S.LINEAR),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MAG_FILTER,S.LINEAR),S.texImage2D(S.TEXTURE_2D,0,S.ALPHA,this.width,this.height,0,S.ALPHA,S.UNSIGNED_BYTE,this.data))}}const fn="maplibre_preloaded_worker_pool";class Dr{constructor(){this.active={}}acquire(y){if(!this.workers)for(this.workers=[];this.workers.length<Dr.workerCount;)this.workers.push(new Worker(M.a.WORKER_URL));return this.active[y]=!0,this.workers.slice()}release(y){delete this.active[y],this.numActive()===0&&(this.workers.forEach(S=>{S.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[fn]}numActive(){return Object.keys(this.active).length}}const mn=Math.floor(we.hardwareConcurrency/2);let qr,vr;function br(){return qr||(qr=new Dr),qr}Dr.workerCount=M.B(globalThis)?Math.max(Math.min(mn,3),1):1;class Nn{constructor(y,S){this.workerPool=y,this.actors=[],this.currentActor=0,this.id=S;const I=this.workerPool.acquire(S);for(let C=0;C<I.length;C++){const z=new M.C(I[C],S);z.name=`Worker ${C}`,this.actors.push(z)}if(!this.actors.length)throw new Error("No actors found")}broadcast(y,S){const I=[];for(const C of this.actors)I.push(C.sendAsync({type:y,data:S}));return Promise.all(I)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(y=!0){this.actors.forEach(S=>{S.remove()}),this.actors=[],y&&this.workerPool.release(this.id)}registerMessageHandler(y,S){for(const I of this.actors)I.registerMessageHandler(y,S)}}function Qr(){return vr||(vr=new Nn(br(),M.G),vr.registerMessageHandler("getResource",(D,y,S)=>M.m(y,S))),vr}function js(D,y){const S=M.F();return M.H(S,S,[1,1,0]),M.J(S,S,[.5*D.width,.5*D.height,1]),M.K(S,S,D.calculatePosMatrix(y.toUnwrapped()))}function en(D,y,S,I,C,z){const N=function(Q,ne,fe){if(Q)for(const de of Q){const ge=ne[de];if(ge&&ge.source===fe&&ge.type==="fill-extrusion")return!0}else for(const de in ne){const ge=ne[de];if(ge.source===fe&&ge.type==="fill-extrusion")return!0}return!1}(C&&C.layers,y,D.id),U=z.maxPitchScaleFactor(),Z=D.tilesIn(I,U,N);Z.sort(tn);const K=[];for(const Q of Z)K.push({wrappedTileID:Q.tileID.wrapped().key,queryResults:Q.tile.queryRenderedFeatures(y,S,D._state,Q.queryGeometry,Q.cameraQueryGeometry,Q.scale,C,z,U,js(D.transform,Q.tileID))});const J=function(Q){const ne={},fe={};for(const de of Q){const ge=de.queryResults,le=de.wrappedTileID,Se=fe[le]=fe[le]||{};for(const De in ge){const _e=ge[De],Ce=Se[De]=Se[De]||{},ke=ne[De]=ne[De]||[];for(const ze of _e)Ce[ze.featureIndex]||(Ce[ze.featureIndex]=!0,ke.push(ze))}}return ne}(K);for(const Q in J)J[Q].forEach(ne=>{const fe=ne.feature,de=D.getFeatureState(fe.layer["source-layer"],fe.id);fe.source=fe.layer.source,fe.layer["source-layer"]&&(fe.sourceLayer=fe.layer["source-layer"]),fe.state=de});return J}function tn(D,y){const S=D.tileID,I=y.tileID;return S.overscaledZ-I.overscaledZ||S.canonical.y-I.canonical.y||S.wrap-I.wrap||S.canonical.x-I.canonical.x}function rn(D,y,S){return M._(this,void 0,void 0,function*(){let I=D;if(D.url?I=(yield M.h(y.transformRequest(D.url,Nt.Source),S)).data:yield we.frameAsync(S),!I)return null;const C=M.L(M.e(I,D),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in I&&I.vector_layers&&(C.vectorLayerIds=I.vector_layers.map(z=>z.id)),C})}class mi{constructor(y,S){y&&(S?this.setSouthWest(y).setNorthEast(S):Array.isArray(y)&&(y.length===4?this.setSouthWest([y[0],y[1]]).setNorthEast([y[2],y[3]]):this.setSouthWest(y[0]).setNorthEast(y[1])))}setNorthEast(y){return this._ne=y instanceof M.M?new M.M(y.lng,y.lat):M.M.convert(y),this}setSouthWest(y){return this._sw=y instanceof M.M?new M.M(y.lng,y.lat):M.M.convert(y),this}extend(y){const S=this._sw,I=this._ne;let C,z;if(y instanceof M.M)C=y,z=y;else{if(!(y instanceof mi))return Array.isArray(y)?y.length===4||y.every(Array.isArray)?this.extend(mi.convert(y)):this.extend(M.M.convert(y)):y&&("lng"in y||"lon"in y)&&"lat"in y?this.extend(M.M.convert(y)):this;if(C=y._sw,z=y._ne,!C||!z)return this}return S||I?(S.lng=Math.min(C.lng,S.lng),S.lat=Math.min(C.lat,S.lat),I.lng=Math.max(z.lng,I.lng),I.lat=Math.max(z.lat,I.lat)):(this._sw=new M.M(C.lng,C.lat),this._ne=new M.M(z.lng,z.lat)),this}getCenter(){return new M.M((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new M.M(this.getWest(),this.getNorth())}getSouthEast(){return new M.M(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(y){const{lng:S,lat:I}=M.M.convert(y);let C=this._sw.lng<=S&&S<=this._ne.lng;return this._sw.lng>this._ne.lng&&(C=this._sw.lng>=S&&S>=this._ne.lng),this._sw.lat<=I&&I<=this._ne.lat&&C}static convert(y){return y instanceof mi?y:y&&new mi(y)}static fromLngLat(y,S=0){const I=360*S/40075017,C=I/Math.cos(Math.PI/180*y.lat);return new mi(new M.M(y.lng-C,y.lat-I),new M.M(y.lng+C,y.lat+I))}}class gn{constructor(y,S,I){this.bounds=mi.convert(this.validateBounds(y)),this.minzoom=S||0,this.maxzoom=I||24}validateBounds(y){return Array.isArray(y)&&y.length===4?[Math.max(-180,y[0]),Math.max(-90,y[1]),Math.min(180,y[2]),Math.min(90,y[3])]:[-180,-90,180,90]}contains(y){const S=Math.pow(2,y.z),I=Math.floor(M.N(this.bounds.getWest())*S),C=Math.floor(M.O(this.bounds.getNorth())*S),z=Math.ceil(M.N(this.bounds.getEast())*S),N=Math.ceil(M.O(this.bounds.getSouth())*S);return y.x>=I&&y.x<z&&y.y>=C&&y.y<N}}class Le extends M.E{constructor(y,S,I,C){if(super(),this.id=y,this.dispatcher=I,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,M.e(this,M.L(S,["url","scheme","tileSize","promoteId"])),this._options=M.e({type:"vector"},S),this._collectResourceTiming=S.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(C)}load(){return M._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new M.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const y=yield rn(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),y&&(M.e(this,y),y.bounds&&(this.tileBounds=new gn(y.bounds,this.minzoom,this.maxzoom)),this.fire(new M.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new M.k("data",{dataType:"source",sourceDataType:"content"})))}catch(y){this._tileJSONRequest=null,this.fire(new M.j(y))}})}loaded(){return this._loaded}hasTile(y){return!this.tileBounds||this.tileBounds.contains(y.canonical)}onAdd(y){this.map=y,this.load()}setSourceProperty(y){this._tileJSONRequest&&this._tileJSONRequest.abort(),y(),this.load()}setTiles(y){return this.setSourceProperty(()=>{this._options.tiles=y}),this}setUrl(y){return this.setSourceProperty(()=>{this.url=y,this._options.url=y}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return M.e({},this._options)}loadTile(y){return M._(this,void 0,void 0,function*(){const S=y.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),I={request:this.map._requestManager.transformRequest(S,Nt.Tile),uid:y.uid,tileID:y.tileID,zoom:y.tileID.overscaledZ,tileSize:this.tileSize*y.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};I.request.collectResourceTiming=this._collectResourceTiming;let C="reloadTile";if(y.actor&&y.state!=="expired"){if(y.state==="loading")return new Promise((z,N)=>{y.reloadPromise={resolve:z,reject:N}})}else y.actor=this.dispatcher.getActor(),C="loadTile";y.abortController=new AbortController;try{const z=yield y.actor.sendAsync({type:C,data:I},y.abortController);if(delete y.abortController,y.aborted)return;this._afterTileLoadWorkerResponse(y,z)}catch(z){if(delete y.abortController,y.aborted)return;if(z&&z.status!==404)throw z;this._afterTileLoadWorkerResponse(y,null)}})}_afterTileLoadWorkerResponse(y,S){if(S&&S.resourceTiming&&(y.resourceTiming=S.resourceTiming),S&&this.map._refreshExpiredTiles&&y.setExpiryData(S),y.loadVectorData(S,this.map.painter),y.reloadPromise){const I=y.reloadPromise;y.reloadPromise=null,this.loadTile(y).then(I.resolve).catch(I.reject)}}abortTile(y){return M._(this,void 0,void 0,function*(){y.abortController&&(y.abortController.abort(),delete y.abortController),y.actor&&(yield y.actor.sendAsync({type:"abortTile",data:{uid:y.uid,type:this.type,source:this.id}}))})}unloadTile(y){return M._(this,void 0,void 0,function*(){y.unloadVectorData(),y.actor&&(yield y.actor.sendAsync({type:"removeTile",data:{uid:y.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class _n extends M.E{constructor(y,S,I,C){super(),this.id=y,this.dispatcher=I,this.setEventedParent(C),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=M.e({type:"raster"},S),M.e(this,M.L(S,["url","scheme","tileSize"]))}load(){return M._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new M.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const y=yield rn(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,y&&(M.e(this,y),y.bounds&&(this.tileBounds=new gn(y.bounds,this.minzoom,this.maxzoom)),this.fire(new M.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new M.k("data",{dataType:"source",sourceDataType:"content"})))}catch(y){this._tileJSONRequest=null,this.fire(new M.j(y))}})}loaded(){return this._loaded}onAdd(y){this.map=y,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(y){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),y(),this.load()}setTiles(y){return this.setSourceProperty(()=>{this._options.tiles=y}),this}setUrl(y){return this.setSourceProperty(()=>{this.url=y,this._options.url=y}),this}serialize(){return M.e({},this._options)}hasTile(y){return!this.tileBounds||this.tileBounds.contains(y.canonical)}loadTile(y){return M._(this,void 0,void 0,function*(){const S=y.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);y.abortController=new AbortController;try{const I=yield Ft.getImage(this.map._requestManager.transformRequest(S,Nt.Tile),y.abortController,this.map._refreshExpiredTiles);if(delete y.abortController,y.aborted)return void(y.state="unloaded");if(I&&I.data){this.map._refreshExpiredTiles&&I.cacheControl&&I.expires&&y.setExpiryData({cacheControl:I.cacheControl,expires:I.expires});const C=this.map.painter.context,z=C.gl,N=I.data;y.texture=this.map.painter.getTileTexture(N.width),y.texture?y.texture.update(N,{useMipmap:!0}):(y.texture=new ni(C,N,z.RGBA,{useMipmap:!0}),y.texture.bind(z.LINEAR,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST),C.extTextureFilterAnisotropic&&z.texParameterf(z.TEXTURE_2D,C.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,C.extTextureFilterAnisotropicMax)),y.state="loaded"}}catch(I){if(delete y.abortController,y.aborted)y.state="unloaded";else if(I)throw y.state="errored",I}})}abortTile(y){return M._(this,void 0,void 0,function*(){y.abortController&&(y.abortController.abort(),delete y.abortController)})}unloadTile(y){return M._(this,void 0,void 0,function*(){y.texture&&this.map.painter.saveTileTexture(y.texture)})}hasTransition(){return!1}}class ys extends _n{constructor(y,S,I,C){super(y,S,I,C),this.type="raster-dem",this.maxzoom=22,this._options=M.e({type:"raster-dem"},S),this.encoding=S.encoding||"mapbox",this.redFactor=S.redFactor,this.greenFactor=S.greenFactor,this.blueFactor=S.blueFactor,this.baseShift=S.baseShift}loadTile(y){return M._(this,void 0,void 0,function*(){const S=y.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),I=this.map._requestManager.transformRequest(S,Nt.Tile);y.neighboringTiles=this._getNeighboringTiles(y.tileID),y.abortController=new AbortController;try{const C=yield Ft.getImage(I,y.abortController,this.map._refreshExpiredTiles);if(delete y.abortController,y.aborted)return void(y.state="unloaded");if(C&&C.data){const z=C.data;this.map._refreshExpiredTiles&&C.cacheControl&&C.expires&&y.setExpiryData({cacheControl:C.cacheControl,expires:C.expires});const N=M.b(z)&&M.S()?z:yield this.readImageNow(z),U={type:this.type,uid:y.uid,source:this.id,rawImageData:N,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!y.actor||y.state==="expired"){y.actor=this.dispatcher.getActor();const Z=yield y.actor.sendAsync({type:"loadDEMTile",data:U});y.dem=Z,y.needsHillshadePrepare=!0,y.needsTerrainPrepare=!0,y.state="loaded"}}}catch(C){if(delete y.abortController,y.aborted)y.state="unloaded";else if(C)throw y.state="errored",C}})}readImageNow(y){return M._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&M.U()){const S=y.width+2,I=y.height+2;try{return new M.R({width:S,height:I},yield M.V(y,-1,-1,S,I))}catch{}}return we.getImageData(y,1)})}_getNeighboringTiles(y){const S=y.canonical,I=Math.pow(2,S.z),C=(S.x-1+I)%I,z=S.x===0?y.wrap-1:y.wrap,N=(S.x+1+I)%I,U=S.x+1===I?y.wrap+1:y.wrap,Z={};return Z[new M.Q(y.overscaledZ,z,S.z,C,S.y).key]={backfilled:!1},Z[new M.Q(y.overscaledZ,U,S.z,N,S.y).key]={backfilled:!1},S.y>0&&(Z[new M.Q(y.overscaledZ,z,S.z,C,S.y-1).key]={backfilled:!1},Z[new M.Q(y.overscaledZ,y.wrap,S.z,S.x,S.y-1).key]={backfilled:!1},Z[new M.Q(y.overscaledZ,U,S.z,N,S.y-1).key]={backfilled:!1}),S.y+1<I&&(Z[new M.Q(y.overscaledZ,z,S.z,C,S.y+1).key]={backfilled:!1},Z[new M.Q(y.overscaledZ,y.wrap,S.z,S.x,S.y+1).key]={backfilled:!1},Z[new M.Q(y.overscaledZ,U,S.z,N,S.y+1).key]={backfilled:!1}),Z}unloadTile(y){return M._(this,void 0,void 0,function*(){y.demTexture&&this.map.painter.saveTileTexture(y.demTexture),y.fbo&&(y.fbo.destroy(),delete y.fbo),y.dem&&delete y.dem,delete y.neighboringTiles,y.state="unloaded",y.actor&&(yield y.actor.sendAsync({type:"removeDEMTile",data:{type:this.type,uid:y.uid,source:this.id}}))})}}class Dt extends M.E{constructor(y,S,I,C){super(),this.id=y,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=I.getActor(),this.setEventedParent(C),this._data=S.data,this._options=M.e({},S),this._collectResourceTiming=S.collectResourceTiming,S.maxzoom!==void 0&&(this.maxzoom=S.maxzoom),S.type&&(this.type=S.type),S.attribution&&(this.attribution=S.attribution),this.promoteId=S.promoteId;const z=M.W/this.tileSize;this.workerOptions=M.e({source:this.id,cluster:S.cluster||!1,geojsonVtOptions:{buffer:(S.buffer!==void 0?S.buffer:128)*z,tolerance:(S.tolerance!==void 0?S.tolerance:.375)*z,extent:M.W,maxZoom:this.maxzoom,lineMetrics:S.lineMetrics||!1,generateId:S.generateId||!1},superclusterOptions:{maxZoom:S.clusterMaxZoom!==void 0?S.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,S.clusterMinPoints||2),extent:M.W,radius:(S.clusterRadius||50)*z,log:!1,generateId:S.generateId||!1},clusterProperties:S.clusterProperties,filter:S.filter},S.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return M._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(y){this.map=y,this.load()}setData(y){return this._data=y,this._updateWorkerData(),this}updateData(y){return this._updateWorkerData(y),this}setClusterOptions(y){return this.workerOptions.cluster=y.cluster,y&&(y.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=y.clusterRadius),y.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=y.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(y){return this.actor.sendAsync({type:"getClusterExpansionZoom",data:{type:this.type,clusterId:y,source:this.id}})}getClusterChildren(y){return this.actor.sendAsync({type:"getClusterChildren",data:{type:this.type,clusterId:y,source:this.id}})}getClusterLeaves(y,S,I){return this.actor.sendAsync({type:"getClusterLeaves",data:{type:this.type,source:this.id,clusterId:y,limit:S,offset:I}})}_updateWorkerData(y){return M._(this,void 0,void 0,function*(){const S=M.e({type:this.type},this.workerOptions);y?S.dataDiff=y:typeof this._data=="string"?(S.request=this.map._requestManager.transformRequest(we.resolveURL(this._data),Nt.Source),S.request.collectResourceTiming=this._collectResourceTiming):S.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new M.k("dataloading",{dataType:"source"}));try{const I=yield this.actor.sendAsync({type:"loadData",data:S});if(this._pendingLoads--,this._removed||I.abandoned)return void this.fire(new M.k("dataabort",{dataType:"source"}));let C=null;I.resourceTiming&&I.resourceTiming[this.id]&&(C=I.resourceTiming[this.id].slice(0));const z={dataType:"source"};this._collectResourceTiming&&C&&C.length>0&&M.e(z,{resourceTiming:C}),this.fire(new M.k("data",Object.assign(Object.assign({},z),{sourceDataType:"metadata"}))),this.fire(new M.k("data",Object.assign(Object.assign({},z),{sourceDataType:"content"})))}catch(I){if(this._pendingLoads--,this._removed)return void this.fire(new M.k("dataabort",{dataType:"source"}));this.fire(new M.j(I))}})}loaded(){return this._pendingLoads===0}loadTile(y){return M._(this,void 0,void 0,function*(){const S=y.actor?"reloadTile":"loadTile";y.actor=this.actor;const I={type:this.type,uid:y.uid,tileID:y.tileID,zoom:y.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};y.abortController=new AbortController;const C=yield this.actor.sendAsync({type:S,data:I},y.abortController);delete y.abortController,y.unloadVectorData(),y.aborted||y.loadVectorData(C,this.map.painter,S==="reloadTile")})}abortTile(y){return M._(this,void 0,void 0,function*(){y.abortController&&(y.abortController.abort(),delete y.abortController),y.aborted=!0})}unloadTile(y){return M._(this,void 0,void 0,function*(){y.unloadVectorData(),yield this.actor.sendAsync({type:"removeTile",data:{uid:y.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"removeSource",data:{type:this.type,source:this.id}})}serialize(){return M.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Ti=M.X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class kr extends M.E{constructor(y,S,I,C){super(),this.id=y,this.dispatcher=I,this.coordinates=S.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(C),this.options=S}load(y){return M._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new M.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const S=yield Ft.getImage(this.map._requestManager.transformRequest(this.url,Nt.Image),this._request);this._request=null,this._loaded=!0,S&&S.data&&(this.image=S.data,y&&(this.coordinates=y),this._finishLoading())}catch(S){this._request=null,this.fire(new M.j(S))}})}loaded(){return this._loaded}updateImage(y){return y.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=y.url,this.load(y.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new M.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(y){this.map=y,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(y){this.coordinates=y;const S=y.map(M.Y.fromLngLat);this.tileID=function(C){let z=1/0,N=1/0,U=-1/0,Z=-1/0;for(const ne of C)z=Math.min(z,ne.x),N=Math.min(N,ne.y),U=Math.max(U,ne.x),Z=Math.max(Z,ne.y);const K=Math.max(U-z,Z-N),J=Math.max(0,Math.floor(-Math.log(K)/Math.LN2)),Q=Math.pow(2,J);return new M.a0(J,Math.floor((z+U)/2*Q),Math.floor((N+Z)/2*Q))}(S),this.minzoom=this.maxzoom=this.tileID.z;const I=S.map(C=>this.tileID.getTilePoint(C)._round());return this._boundsArray=new M.Z,this._boundsArray.emplaceBack(I[0].x,I[0].y,0,0),this._boundsArray.emplaceBack(I[1].x,I[1].y,M.W,0),this._boundsArray.emplaceBack(I[3].x,I[3].y,0,M.W),this._boundsArray.emplaceBack(I[2].x,I[2].y,M.W,M.W),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new M.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const y=this.map.painter.context,S=y.gl;this.boundsBuffer||(this.boundsBuffer=y.createVertexBuffer(this._boundsArray,Ti.members)),this.boundsSegments||(this.boundsSegments=M.$.simpleSegment(0,0,4,2)),this.texture||(this.texture=new ni(y,this.image,S.RGBA),this.texture.bind(S.LINEAR,S.CLAMP_TO_EDGE));let I=!1;for(const C in this.tiles){const z=this.tiles[C];z.state!=="loaded"&&(z.state="loaded",z.texture=this.texture,I=!0)}I&&this.fire(new M.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(y){return M._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(y.tileID.canonical)?(this.tiles[String(y.tileID.wrap)]=y,y.buckets={}):y.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Un extends kr{constructor(y,S,I,C){super(y,S,I,C),this.roundZoom=!0,this.type="video",this.options=S}load(){return M._(this,void 0,void 0,function*(){this._loaded=!1;const y=this.options;this.urls=[];for(const S of y.urls)this.urls.push(this.map._requestManager.transformRequest(S,Nt.Source).url);try{const S=yield M.a2(this.urls);if(this._loaded=!0,!S)return;this.video=S,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(S){this.fire(new M.j(S))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(y){if(this.video){const S=this.video.seekable;y<S.start(0)||y>S.end(0)?this.fire(new M.j(new M.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${S.start(0)} and ${S.end(0)}-second mark.`))):this.video.currentTime=y}}getVideo(){return this.video}onAdd(y){this.map||(this.map=y,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const y=this.map.painter.context,S=y.gl;this.boundsBuffer||(this.boundsBuffer=y.createVertexBuffer(this._boundsArray,Ti.members)),this.boundsSegments||(this.boundsSegments=M.$.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(S.LINEAR,S.CLAMP_TO_EDGE),S.texSubImage2D(S.TEXTURE_2D,0,0,0,S.RGBA,S.UNSIGNED_BYTE,this.video)):(this.texture=new ni(y,this.video,S.RGBA),this.texture.bind(S.LINEAR,S.CLAMP_TO_EDGE));let I=!1;for(const C in this.tiles){const z=this.tiles[C];z.state!=="loaded"&&(z.state="loaded",z.texture=this.texture,I=!0)}I&&this.fire(new M.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Vn extends kr{constructor(y,S,I,C){super(y,S,I,C),S.coordinates?Array.isArray(S.coordinates)&&S.coordinates.length===4&&!S.coordinates.some(z=>!Array.isArray(z)||z.length!==2||z.some(N=>typeof N!="number"))||this.fire(new M.j(new M.a1(`sources.${y}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new M.j(new M.a1(`sources.${y}`,null,'missing required property "coordinates"'))),S.animate&&typeof S.animate!="boolean"&&this.fire(new M.j(new M.a1(`sources.${y}`,null,'optional "animate" property must be a boolean value'))),S.canvas?typeof S.canvas=="string"||S.canvas instanceof HTMLCanvasElement||this.fire(new M.j(new M.a1(`sources.${y}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new M.j(new M.a1(`sources.${y}`,null,'missing required property "canvas"'))),this.options=S,this.animate=S.animate===void 0||S.animate}load(){return M._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new M.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(y){this.map=y,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let y=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,y=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,y=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const S=this.map.painter.context,I=S.gl;this.boundsBuffer||(this.boundsBuffer=S.createVertexBuffer(this._boundsArray,Ti.members)),this.boundsSegments||(this.boundsSegments=M.$.simpleSegment(0,0,4,2)),this.texture?(y||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new ni(S,this.canvas,I.RGBA,{premultiply:!0});let C=!1;for(const z in this.tiles){const N=this.tiles[z];N.state!=="loaded"&&(N.state="loaded",N.texture=this.texture,C=!0)}C&&this.fire(new M.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const y of[this.canvas.width,this.canvas.height])if(isNaN(y)||y<=0)return!0;return!1}}const qn={},yn=D=>{switch(D){case"geojson":return Dt;case"image":return kr;case"raster":return _n;case"raster-dem":return ys;case"vector":return Le;case"video":return Un;case"canvas":return Vn}return qn[D]},jn="RTLPluginLoaded";class xs extends M.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Qr()}_syncState(y){return this.status=y,this.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:y,pluginURL:this.url}).catch(S=>{throw this.status="error",S})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(y){return M._(this,arguments,void 0,function*(S,I=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=we.resolveURL(S),!this.url)throw new Error(`requested url ${S} is invalid`);if(this.status==="unavailable"){if(!I)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return M._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new M.k(jn))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Ye=null;function rr(){return Ye||(Ye=new xs),Ye}class Gi{constructor(y,S){this.timeAdded=0,this.fadeEndTime=0,this.tileID=y,this.uid=M.a3(),this.uses=0,this.tileSize=S,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(y){const S=y+this.timeAdded;S<this.fadeEndTime||(this.fadeEndTime=S)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(y){this.demTexture&&y.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(y,S,I){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",y){y.featureIndex&&(this.latestFeatureIndex=y.featureIndex,y.rawTileData?(this.latestRawTileData=y.rawTileData,this.latestFeatureIndex.rawTileData=y.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=y.collisionBoxArray,this.buckets=function(C,z){const N={};if(!z)return N;for(const U of C){const Z=U.layerIds.map(K=>z.getLayer(K)).filter(Boolean);if(Z.length!==0){U.layers=Z,U.stateDependentLayerIds&&(U.stateDependentLayers=U.stateDependentLayerIds.map(K=>Z.filter(J=>J.id===K)[0]));for(const K of Z)N[K.id]=U}}return N}(y.buckets,S.style),this.hasSymbolBuckets=!1;for(const C in this.buckets){const z=this.buckets[C];if(z instanceof M.a5){if(this.hasSymbolBuckets=!0,!I)break;z.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const C in this.buckets){const z=this.buckets[C];if(z instanceof M.a5&&z.hasRTLText){this.hasRTLText=!0,rr().lazyLoad();break}}this.queryPadding=0;for(const C in this.buckets){const z=this.buckets[C];this.queryPadding=Math.max(this.queryPadding,S.style.getLayer(C).queryRadius(z))}y.imageAtlas&&(this.imageAtlas=y.imageAtlas),y.glyphAtlasImage&&(this.glyphAtlasImage=y.glyphAtlasImage)}else this.collisionBoxArray=new M.a4}unloadVectorData(){for(const y in this.buckets)this.buckets[y].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(y){return this.buckets[y.id]}upload(y){for(const I in this.buckets){const C=this.buckets[I];C.uploadPending()&&C.upload(y)}const S=y.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ni(y,this.imageAtlas.image,S.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ni(y,this.glyphAtlasImage,S.ALPHA),this.glyphAtlasImage=null)}prepare(y){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(y,this.imageAtlasTexture)}queryRenderedFeatures(y,S,I,C,z,N,U,Z,K,J){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:C,cameraQueryGeometry:z,scale:N,tileSize:this.tileSize,pixelPosMatrix:J,transform:Z,params:U,queryPadding:this.queryPadding*K},y,S,I):{}}querySourceFeatures(y,S){const I=this.latestFeatureIndex;if(!I||!I.rawTileData)return;const C=I.loadVTLayers(),z=S&&S.sourceLayer?S.sourceLayer:"",N=C._geojsonTileLayer||C[z];if(!N)return;const U=M.a6(S&&S.filter),{z:Z,x:K,y:J}=this.tileID.canonical,Q={z:Z,x:K,y:J};for(let ne=0;ne<N.length;ne++){const fe=N.feature(ne);if(U.needGeometry){const le=M.a7(fe,!0);if(!U.filter(new M.a8(this.tileID.overscaledZ),le,this.tileID.canonical))continue}else if(!U.filter(new M.a8(this.tileID.overscaledZ),fe))continue;const de=I.getId(fe,z),ge=new M.a9(fe,Z,K,J,de);ge.tile=Q,y.push(ge)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(y){const S=this.expirationTime;if(y.cacheControl){const I=M.aa(y.cacheControl);I["max-age"]&&(this.expirationTime=Date.now()+1e3*I["max-age"])}else y.expires&&(this.expirationTime=new Date(y.expires).getTime());if(this.expirationTime){const I=Date.now();let C=!1;if(this.expirationTime>I)C=!1;else if(S)if(this.expirationTime<S)C=!0;else{const z=this.expirationTime-S;z?this.expirationTime=I+Math.max(z,3e4):C=!0}else C=!0;C?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(y,S){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(y).length===0)return;const I=this.latestFeatureIndex.loadVTLayers();for(const C in this.buckets){if(!S.style.hasLayer(C))continue;const z=this.buckets[C],N=z.layers[0].sourceLayer||"_geojsonTileLayer",U=I[N],Z=y[N];if(!U||!Z||Object.keys(Z).length===0)continue;z.update(Z,U,this.imageAtlas&&this.imageAtlas.patternPositions||{});const K=S&&S.style&&S.style.getLayer(C);K&&(this.queryPadding=Math.max(this.queryPadding,K.queryRadius(z)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<we.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(y){this.symbolFadeHoldUntil=we.now()+y}setDependencies(y,S){const I={};for(const C of S)I[C]=!0;this.dependencies[y]=I}hasDependency(y,S){for(const I of y){const C=this.dependencies[I];if(C){for(const z of S)if(C[z])return!0}}return!1}}class vs{constructor(y,S){this.max=y,this.onRemove=S,this.reset()}reset(){for(const y in this.data)for(const S of this.data[y])S.timeout&&clearTimeout(S.timeout),this.onRemove(S.value);return this.data={},this.order=[],this}add(y,S,I){const C=y.wrapped().key;this.data[C]===void 0&&(this.data[C]=[]);const z={value:S,timeout:void 0};if(I!==void 0&&(z.timeout=setTimeout(()=>{this.remove(y,z)},I)),this.data[C].push(z),this.order.push(C),this.order.length>this.max){const N=this._getAndRemoveByKey(this.order[0]);N&&this.onRemove(N)}return this}has(y){return y.wrapped().key in this.data}getAndRemove(y){return this.has(y)?this._getAndRemoveByKey(y.wrapped().key):null}_getAndRemoveByKey(y){const S=this.data[y].shift();return S.timeout&&clearTimeout(S.timeout),this.data[y].length===0&&delete this.data[y],this.order.splice(this.order.indexOf(y),1),S.value}getByKey(y){const S=this.data[y];return S?S[0].value:null}get(y){return this.has(y)?this.data[y.wrapped().key][0].value:null}remove(y,S){if(!this.has(y))return this;const I=y.wrapped().key,C=S===void 0?0:this.data[I].indexOf(S),z=this.data[I][C];return this.data[I].splice(C,1),z.timeout&&clearTimeout(z.timeout),this.data[I].length===0&&delete this.data[I],this.onRemove(z.value),this.order.splice(this.order.indexOf(I),1),this}setMaxSize(y){for(this.max=y;this.order.length>this.max;){const S=this._getAndRemoveByKey(this.order[0]);S&&this.onRemove(S)}return this}filter(y){const S=[];for(const I in this.data)for(const C of this.data[I])y(C.value)||S.push(C);for(const I of S)this.remove(I.value.tileID,I)}}class xn{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(y,S,I){const C=String(S);if(this.stateChanges[y]=this.stateChanges[y]||{},this.stateChanges[y][C]=this.stateChanges[y][C]||{},M.e(this.stateChanges[y][C],I),this.deletedStates[y]===null){this.deletedStates[y]={};for(const z in this.state[y])z!==C&&(this.deletedStates[y][z]=null)}else if(this.deletedStates[y]&&this.deletedStates[y][C]===null){this.deletedStates[y][C]={};for(const z in this.state[y][C])I[z]||(this.deletedStates[y][C][z]=null)}else for(const z in I)this.deletedStates[y]&&this.deletedStates[y][C]&&this.deletedStates[y][C][z]===null&&delete this.deletedStates[y][C][z]}removeFeatureState(y,S,I){if(this.deletedStates[y]===null)return;const C=String(S);if(this.deletedStates[y]=this.deletedStates[y]||{},I&&S!==void 0)this.deletedStates[y][C]!==null&&(this.deletedStates[y][C]=this.deletedStates[y][C]||{},this.deletedStates[y][C][I]=null);else if(S!==void 0)if(this.stateChanges[y]&&this.stateChanges[y][C])for(I in this.deletedStates[y][C]={},this.stateChanges[y][C])this.deletedStates[y][C][I]=null;else this.deletedStates[y][C]=null;else this.deletedStates[y]=null}getState(y,S){const I=String(S),C=M.e({},(this.state[y]||{})[I],(this.stateChanges[y]||{})[I]);if(this.deletedStates[y]===null)return{};if(this.deletedStates[y]){const z=this.deletedStates[y][S];if(z===null)return{};for(const N in z)delete C[N]}return C}initializeTileState(y,S){y.setFeatureState(this.state,S)}coalesceChanges(y,S){const I={};for(const C in this.stateChanges){this.state[C]=this.state[C]||{};const z={};for(const N in this.stateChanges[C])this.state[C][N]||(this.state[C][N]={}),M.e(this.state[C][N],this.stateChanges[C][N]),z[N]=this.state[C][N];I[C]=z}for(const C in this.deletedStates){this.state[C]=this.state[C]||{};const z={};if(this.deletedStates[C]===null)for(const N in this.state[C])z[N]={},this.state[C][N]={};else for(const N in this.deletedStates[C]){if(this.deletedStates[C][N]===null)this.state[C][N]={};else for(const U of Object.keys(this.deletedStates[C][N]))delete this.state[C][N][U];z[N]=this.state[C][N]}I[C]=I[C]||{},M.e(I[C],z)}if(this.stateChanges={},this.deletedStates={},Object.keys(I).length!==0)for(const C in y)y[C].setFeatureState(I,S)}}class We extends M.E{constructor(y,S,I){super(),this.id=y,this.dispatcher=I,this.on("data",C=>{C.dataType==="source"&&C.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&C.dataType==="source"&&C.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((C,z,N,U)=>{const Z=new(yn(z.type))(C,z,N,U);if(Z.id!==C)throw new Error(`Expected Source id to be ${C} instead of ${Z.id}`);return Z})(y,S,I,this),this._tiles={},this._cache=new vs(0,C=>this._unloadTile(C)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new xn,this._didEmitContent=!1,this._updated=!1}onAdd(y){this.map=y,this._maxTileCacheSize=y?y._maxTileCacheSize:null,this._maxTileCacheZoomLevels=y?y._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(y)}onRemove(y){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(y)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const y in this._tiles){const S=this._tiles[y];if(S.state!=="loaded"&&S.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const y=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,y&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(y,S,I){return M._(this,void 0,void 0,function*(){try{yield this._source.loadTile(y),this._tileLoaded(y,S,I)}catch(C){y.state="errored",C.status!==404?this._source.fire(new M.j(C,{tile:y})):this.update(this.transform,this.terrain)}})}_unloadTile(y){this._source.unloadTile&&this._source.unloadTile(y)}_abortTile(y){this._source.abortTile&&this._source.abortTile(y),this._source.fire(new M.k("dataabort",{tile:y,coord:y.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(y){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const S in this._tiles){const I=this._tiles[S];I.upload(y),I.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(y=>y.tileID).sort(Tt).map(y=>y.key)}getRenderableIds(y){const S=[];for(const I in this._tiles)this._isIdRenderable(I,y)&&S.push(this._tiles[I]);return y?S.sort((I,C)=>{const z=I.tileID,N=C.tileID,U=new M.P(z.canonical.x,z.canonical.y)._rotate(this.transform.angle),Z=new M.P(N.canonical.x,N.canonical.y)._rotate(this.transform.angle);return z.overscaledZ-N.overscaledZ||Z.y-U.y||Z.x-U.x}).map(I=>I.tileID.key):S.map(I=>I.tileID).sort(Tt).map(I=>I.key)}hasRenderableParent(y){const S=this.findLoadedParent(y,0);return!!S&&this._isIdRenderable(S.tileID.key)}_isIdRenderable(y,S){return this._tiles[y]&&this._tiles[y].hasData()&&!this._coveredTiles[y]&&(S||!this._tiles[y].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const y in this._tiles)this._tiles[y].state!=="errored"&&this._reloadTile(y,"reloading")}}_reloadTile(y,S){return M._(this,void 0,void 0,function*(){const I=this._tiles[y];I&&(I.state!=="loading"&&(I.state=S),yield this._loadTile(I,y,S))})}_tileLoaded(y,S,I){y.timeAdded=we.now(),I==="expired"&&(y.refreshedUponExpiration=!0),this._setTileReloadTimer(S,y),this.getSource().type==="raster-dem"&&y.dem&&this._backfillDEM(y),this._state.initializeTileState(y,this.map?this.map.painter:null),y.aborted||this._source.fire(new M.k("data",{dataType:"source",tile:y,coord:y.tileID}))}_backfillDEM(y){const S=this.getRenderableIds();for(let C=0;C<S.length;C++){const z=S[C];if(y.neighboringTiles&&y.neighboringTiles[z]){const N=this.getTileByID(z);I(y,N),I(N,y)}}function I(C,z){C.needsHillshadePrepare=!0,C.needsTerrainPrepare=!0;let N=z.tileID.canonical.x-C.tileID.canonical.x;const U=z.tileID.canonical.y-C.tileID.canonical.y,Z=Math.pow(2,C.tileID.canonical.z),K=z.tileID.key;N===0&&U===0||Math.abs(U)>1||(Math.abs(N)>1&&(Math.abs(N+Z)===1?N+=Z:Math.abs(N-Z)===1&&(N-=Z)),z.dem&&C.dem&&(C.dem.backfillBorder(z.dem,N,U),C.neighboringTiles&&C.neighboringTiles[K]&&(C.neighboringTiles[K].backfilled=!0)))}}getTile(y){return this.getTileByID(y.key)}getTileByID(y){return this._tiles[y]}_retainLoadedChildren(y,S,I,C){for(const z in this._tiles){let N=this._tiles[z];if(C[z]||!N.hasData()||N.tileID.overscaledZ<=S||N.tileID.overscaledZ>I)continue;let U=N.tileID;for(;N&&N.tileID.overscaledZ>S+1;){const K=N.tileID.scaledTo(N.tileID.overscaledZ-1);N=this._tiles[K.key],N&&N.hasData()&&(U=K)}let Z=U;for(;Z.overscaledZ>S;)if(Z=Z.scaledTo(Z.overscaledZ-1),y[Z.key]){C[U.key]=U;break}}}findLoadedParent(y,S){if(y.key in this._loadedParentTiles){const I=this._loadedParentTiles[y.key];return I&&I.tileID.overscaledZ>=S?I:null}for(let I=y.overscaledZ-1;I>=S;I--){const C=y.scaledTo(I),z=this._getLoadedTile(C);if(z)return z}}_getLoadedTile(y){const S=this._tiles[y.key];return S&&S.hasData()?S:this._cache.getByKey(y.wrapped().key)}updateCacheSize(y){const S=Math.ceil(y.width/this._source.tileSize)+1,I=Math.ceil(y.height/this._source.tileSize)+1,C=Math.floor(S*I*(this._maxTileCacheZoomLevels===null?M.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),z=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,C):C;this._cache.setMaxSize(z)}handleWrapJump(y){const S=Math.round((y-(this._prevLng===void 0?y:this._prevLng))/360);if(this._prevLng=y,S){const I={};for(const C in this._tiles){const z=this._tiles[C];z.tileID=z.tileID.unwrapTo(z.tileID.wrap+S),I[z.tileID.key]=z}this._tiles=I;for(const C in this._timers)clearTimeout(this._timers[C]),delete this._timers[C];for(const C in this._tiles)this._setTileReloadTimer(C,this._tiles[C])}}update(y,S){if(this.transform=y,this.terrain=S,!this._sourceLoaded||this._paused)return;let I;this.updateCacheSize(y),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?I=y.getVisibleUnwrappedCoordinates(this._source.tileID).map(J=>new M.Q(J.canonical.z,J.wrap,J.canonical.z,J.canonical.x,J.canonical.y)):(I=y.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:S}),this._source.hasTile&&(I=I.filter(J=>this._source.hasTile(J)))):I=[];const C=y.coveringZoomLevel(this._source),z=Math.max(C-We.maxOverzooming,this._source.minzoom),N=Math.max(C+We.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const J={};for(const Q of I)if(Q.canonical.z>this._source.minzoom){const ne=Q.scaledTo(Q.canonical.z-1);J[ne.key]=ne;const fe=Q.scaledTo(Math.max(this._source.minzoom,Math.min(Q.canonical.z,5)));J[fe.key]=fe}I=I.concat(Object.values(J))}const U=I.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,U&&this.fire(new M.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const Z=this._updateRetainedTiles(I,C);if(bt(this._source.type)){const J={},Q={},ne=Object.keys(Z),fe=we.now();for(const de of ne){const ge=Z[de],le=this._tiles[de];if(!le||le.fadeEndTime!==0&&le.fadeEndTime<=fe)continue;const Se=this.findLoadedParent(ge,z);Se&&(this._addTile(Se.tileID),J[Se.tileID.key]=Se.tileID),Q[de]=ge}this._retainLoadedChildren(Q,C,N,Z);for(const de in J)Z[de]||(this._coveredTiles[de]=!0,Z[de]=J[de]);if(S){const de={},ge={};for(const le of I)this._tiles[le.key].hasData()?de[le.key]=le:ge[le.key]=le;for(const le in ge){const Se=ge[le].children(this._source.maxzoom);this._tiles[Se[0].key]&&this._tiles[Se[1].key]&&this._tiles[Se[2].key]&&this._tiles[Se[3].key]&&(de[Se[0].key]=Z[Se[0].key]=Se[0],de[Se[1].key]=Z[Se[1].key]=Se[1],de[Se[2].key]=Z[Se[2].key]=Se[2],de[Se[3].key]=Z[Se[3].key]=Se[3],delete ge[le])}for(const le in ge){const Se=this.findLoadedParent(ge[le],this._source.minzoom);if(Se){de[Se.tileID.key]=Z[Se.tileID.key]=Se.tileID;for(const De in de)de[De].isChildOf(Se.tileID)&&delete de[De]}}for(const le in this._tiles)de[le]||(this._coveredTiles[le]=!0)}}for(const J in Z)this._tiles[J].clearFadeHold();const K=M.ab(this._tiles,Z);for(const J of K){const Q=this._tiles[J];Q.hasSymbolBuckets&&!Q.holdingForFade()?Q.setHoldDuration(this.map._fadeDuration):Q.hasSymbolBuckets&&!Q.symbolFadeFinished()||this._removeTile(J)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const y in this._tiles)this._tiles[y].holdingForFade()&&this._removeTile(y)}_updateRetainedTiles(y,S){const I={},C={},z=Math.max(S-We.maxOverzooming,this._source.minzoom),N=Math.max(S+We.maxUnderzooming,this._source.minzoom),U={};for(const Z of y){const K=this._addTile(Z);I[Z.key]=Z,K.hasData()||S<this._source.maxzoom&&(U[Z.key]=Z)}this._retainLoadedChildren(U,S,N,I);for(const Z of y){let K=this._tiles[Z.key];if(K.hasData())continue;if(S+1>this._source.maxzoom){const Q=Z.children(this._source.maxzoom)[0],ne=this.getTile(Q);if(ne&&ne.hasData()){I[Q.key]=Q;continue}}else{const Q=Z.children(this._source.maxzoom);if(I[Q[0].key]&&I[Q[1].key]&&I[Q[2].key]&&I[Q[3].key])continue}let J=K.wasRequested();for(let Q=Z.overscaledZ-1;Q>=z;--Q){const ne=Z.scaledTo(Q);if(C[ne.key])break;if(C[ne.key]=!0,K=this.getTile(ne),!K&&J&&(K=this._addTile(ne)),K){const fe=K.hasData();if((J||fe)&&(I[ne.key]=ne),J=K.wasRequested(),fe)break}}}return I}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const y in this._tiles){const S=[];let I,C=this._tiles[y].tileID;for(;C.overscaledZ>0;){if(C.key in this._loadedParentTiles){I=this._loadedParentTiles[C.key];break}S.push(C.key);const z=C.scaledTo(C.overscaledZ-1);if(I=this._getLoadedTile(z),I)break;C=z}for(const z of S)this._loadedParentTiles[z]=I}}_addTile(y){let S=this._tiles[y.key];if(S)return S;S=this._cache.getAndRemove(y),S&&(this._setTileReloadTimer(y.key,S),S.tileID=y,this._state.initializeTileState(S,this.map?this.map.painter:null),this._cacheTimers[y.key]&&(clearTimeout(this._cacheTimers[y.key]),delete this._cacheTimers[y.key],this._setTileReloadTimer(y.key,S)));const I=S;return S||(S=new Gi(y,this._source.tileSize*y.overscaleFactor()),this._loadTile(S,y.key,S.state)),S.uses++,this._tiles[y.key]=S,I||this._source.fire(new M.k("dataloading",{tile:S,coord:S.tileID,dataType:"source"})),S}_setTileReloadTimer(y,S){y in this._timers&&(clearTimeout(this._timers[y]),delete this._timers[y]);const I=S.getExpiryTimeout();I&&(this._timers[y]=setTimeout(()=>{this._reloadTile(y,"expired"),delete this._timers[y]},I))}_removeTile(y){const S=this._tiles[y];S&&(S.uses--,delete this._tiles[y],this._timers[y]&&(clearTimeout(this._timers[y]),delete this._timers[y]),S.uses>0||(S.hasData()&&S.state!=="reloading"?this._cache.add(S.tileID,S,S.getExpiryTimeout()):(S.aborted=!0,this._abortTile(S),this._unloadTile(S))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const y in this._tiles)this._removeTile(y);this._cache.reset()}tilesIn(y,S,I){const C=[],z=this.transform;if(!z)return C;const N=I?z.getCameraQueryGeometry(y):y,U=y.map(de=>z.pointCoordinate(de,this.terrain)),Z=N.map(de=>z.pointCoordinate(de,this.terrain)),K=this.getIds();let J=1/0,Q=1/0,ne=-1/0,fe=-1/0;for(const de of Z)J=Math.min(J,de.x),Q=Math.min(Q,de.y),ne=Math.max(ne,de.x),fe=Math.max(fe,de.y);for(let de=0;de<K.length;de++){const ge=this._tiles[K[de]];if(ge.holdingForFade())continue;const le=ge.tileID,Se=Math.pow(2,z.zoom-ge.tileID.overscaledZ),De=S*ge.queryPadding*M.W/ge.tileSize/Se,_e=[le.getTilePoint(new M.Y(J,Q)),le.getTilePoint(new M.Y(ne,fe))];if(_e[0].x-De<M.W&&_e[0].y-De<M.W&&_e[1].x+De>=0&&_e[1].y+De>=0){const Ce=U.map(ze=>le.getTilePoint(ze)),ke=Z.map(ze=>le.getTilePoint(ze));C.push({tile:ge,tileID:le,queryGeometry:Ce,cameraQueryGeometry:ke,scale:Se})}}return C}getVisibleCoordinates(y){const S=this.getRenderableIds(y).map(I=>this._tiles[I].tileID);for(const I of S)I.posMatrix=this.transform.calculatePosMatrix(I.toUnwrapped());return S}hasTransition(){if(this._source.hasTransition())return!0;if(bt(this._source.type)){const y=we.now();for(const S in this._tiles)if(this._tiles[S].fadeEndTime>=y)return!0}return!1}setFeatureState(y,S,I){this._state.updateState(y=y||"_geojsonTileLayer",S,I)}removeFeatureState(y,S,I){this._state.removeFeatureState(y=y||"_geojsonTileLayer",S,I)}getFeatureState(y,S){return this._state.getState(y=y||"_geojsonTileLayer",S)}setDependencies(y,S,I){const C=this._tiles[y];C&&C.setDependencies(S,I)}reloadTilesForDependencies(y,S){for(const I in this._tiles)this._tiles[I].hasDependency(y,S)&&this._reloadTile(I,"reloading");this._cache.filter(I=>!I.hasDependency(y,S))}}function Tt(D,y){const S=Math.abs(2*D.wrap)-+(D.wrap<0),I=Math.abs(2*y.wrap)-+(y.wrap<0);return D.overscaledZ-y.overscaledZ||I-S||y.canonical.y-D.canonical.y||y.canonical.x-D.canonical.x}function bt(D){return D==="raster"||D==="image"||D==="video"}We.maxOverzooming=10,We.maxUnderzooming=3;class Ai{constructor(y,S){this.reset(y,S)}reset(y,S){this.points=y||[],this._distances=[0];for(let I=1;I<this.points.length;I++)this._distances[I]=this._distances[I-1]+this.points[I].dist(this.points[I-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(S||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(y){if(this.points.length===1)return this.points[0];y=M.ac(y,0,1);let S=1,I=this._distances[S];const C=y*this.paddedLength+this.padding;for(;I<C&&S<this._distances.length;)I=this._distances[++S];const z=S-1,N=this._distances[z],U=I-N,Z=U>0?(C-N)/U:0;return this.points[z].mult(1-Z).add(this.points[S].mult(Z))}}function fr(D,y){let S=!0;return D==="always"||D!=="never"&&y!=="never"||(S=!1),S}class wt{constructor(y,S,I){const C=this.boxCells=[],z=this.circleCells=[];this.xCellCount=Math.ceil(y/I),this.yCellCount=Math.ceil(S/I);for(let N=0;N<this.xCellCount*this.yCellCount;N++)C.push([]),z.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=y,this.height=S,this.xScale=this.xCellCount/y,this.yScale=this.yCellCount/S,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(y,S,I,C,z){this._forEachCell(S,I,C,z,this._insertBoxCell,this.boxUid++),this.boxKeys.push(y),this.bboxes.push(S),this.bboxes.push(I),this.bboxes.push(C),this.bboxes.push(z)}insertCircle(y,S,I,C){this._forEachCell(S-C,I-C,S+C,I+C,this._insertCircleCell,this.circleUid++),this.circleKeys.push(y),this.circles.push(S),this.circles.push(I),this.circles.push(C)}_insertBoxCell(y,S,I,C,z,N){this.boxCells[z].push(N)}_insertCircleCell(y,S,I,C,z,N){this.circleCells[z].push(N)}_query(y,S,I,C,z,N,U){if(I<0||y>this.width||C<0||S>this.height)return[];const Z=[];if(y<=0&&S<=0&&this.width<=I&&this.height<=C){if(z)return[{key:null,x1:y,y1:S,x2:I,y2:C}];for(let K=0;K<this.boxKeys.length;K++)Z.push({key:this.boxKeys[K],x1:this.bboxes[4*K],y1:this.bboxes[4*K+1],x2:this.bboxes[4*K+2],y2:this.bboxes[4*K+3]});for(let K=0;K<this.circleKeys.length;K++){const J=this.circles[3*K],Q=this.circles[3*K+1],ne=this.circles[3*K+2];Z.push({key:this.circleKeys[K],x1:J-ne,y1:Q-ne,x2:J+ne,y2:Q+ne})}}else this._forEachCell(y,S,I,C,this._queryCell,Z,{hitTest:z,overlapMode:N,seenUids:{box:{},circle:{}}},U);return Z}query(y,S,I,C){return this._query(y,S,I,C,!1,null)}hitTest(y,S,I,C,z,N){return this._query(y,S,I,C,!0,z,N).length>0}hitTestCircle(y,S,I,C,z){const N=y-I,U=y+I,Z=S-I,K=S+I;if(U<0||N>this.width||K<0||Z>this.height)return!1;const J=[];return this._forEachCell(N,Z,U,K,this._queryCellCircle,J,{hitTest:!0,overlapMode:C,circle:{x:y,y:S,radius:I},seenUids:{box:{},circle:{}}},z),J.length>0}_queryCell(y,S,I,C,z,N,U,Z){const{seenUids:K,hitTest:J,overlapMode:Q}=U,ne=this.boxCells[z];if(ne!==null){const de=this.bboxes;for(const ge of ne)if(!K.box[ge]){K.box[ge]=!0;const le=4*ge,Se=this.boxKeys[ge];if(y<=de[le+2]&&S<=de[le+3]&&I>=de[le+0]&&C>=de[le+1]&&(!Z||Z(Se))&&(!J||!fr(Q,Se.overlapMode))&&(N.push({key:Se,x1:de[le],y1:de[le+1],x2:de[le+2],y2:de[le+3]}),J))return!0}}const fe=this.circleCells[z];if(fe!==null){const de=this.circles;for(const ge of fe)if(!K.circle[ge]){K.circle[ge]=!0;const le=3*ge,Se=this.circleKeys[ge];if(this._circleAndRectCollide(de[le],de[le+1],de[le+2],y,S,I,C)&&(!Z||Z(Se))&&(!J||!fr(Q,Se.overlapMode))){const De=de[le],_e=de[le+1],Ce=de[le+2];if(N.push({key:Se,x1:De-Ce,y1:_e-Ce,x2:De+Ce,y2:_e+Ce}),J)return!0}}}return!1}_queryCellCircle(y,S,I,C,z,N,U,Z){const{circle:K,seenUids:J,overlapMode:Q}=U,ne=this.boxCells[z];if(ne!==null){const de=this.bboxes;for(const ge of ne)if(!J.box[ge]){J.box[ge]=!0;const le=4*ge,Se=this.boxKeys[ge];if(this._circleAndRectCollide(K.x,K.y,K.radius,de[le+0],de[le+1],de[le+2],de[le+3])&&(!Z||Z(Se))&&!fr(Q,Se.overlapMode))return N.push(!0),!0}}const fe=this.circleCells[z];if(fe!==null){const de=this.circles;for(const ge of fe)if(!J.circle[ge]){J.circle[ge]=!0;const le=3*ge,Se=this.circleKeys[ge];if(this._circlesCollide(de[le],de[le+1],de[le+2],K.x,K.y,K.radius)&&(!Z||Z(Se))&&!fr(Q,Se.overlapMode))return N.push(!0),!0}}}_forEachCell(y,S,I,C,z,N,U,Z){const K=this._convertToXCellCoord(y),J=this._convertToYCellCoord(S),Q=this._convertToXCellCoord(I),ne=this._convertToYCellCoord(C);for(let fe=K;fe<=Q;fe++)for(let de=J;de<=ne;de++)if(z.call(this,y,S,I,C,this.xCellCount*de+fe,N,U,Z))return}_convertToXCellCoord(y){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(y*this.xScale)))}_convertToYCellCoord(y){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(y*this.yScale)))}_circlesCollide(y,S,I,C,z,N){const U=C-y,Z=z-S,K=I+N;return K*K>U*U+Z*Z}_circleAndRectCollide(y,S,I,C,z,N,U){const Z=(N-C)/2,K=Math.abs(y-(C+Z));if(K>Z+I)return!1;const J=(U-z)/2,Q=Math.abs(S-(z+J));if(Q>J+I)return!1;if(K<=Z||Q<=J)return!0;const ne=K-Z,fe=Q-J;return ne*ne+fe*fe<=I*I}}function nn(D,y,S,I,C){const z=M.F();return y?(M.J(z,z,[1/C,1/C,1]),S||M.ad(z,z,I.angle)):M.K(z,I.labelPlaneMatrix,D),z}function jr(D,y,S,I,C){if(y){const z=M.ae(D);return M.J(z,z,[C,C,1]),S||M.ad(z,z,-I.angle),z}return I.glCoordMatrix}function pe(D,y,S){let I;S?(I=[D.x,D.y,S(D.x,D.y),1],M.af(I,I,y)):(I=[D.x,D.y,0,1],gt(I,I,y));const C=I[3];return{point:new M.P(I[0]/C,I[1]/C),signedDistanceFromCamera:C}}function ee(D,y){return .5+D/y*.5}function ie(D,y){const S=D[0]/D[3],I=D[1]/D[3];return S>=-y[0]&&S<=y[0]&&I>=-y[1]&&I<=y[1]}function ae(D,y,S,I,C,z,N,U,Z,K){const J=I?D.textSizeData:D.iconSizeData,Q=M.ag(J,S.transform.zoom),ne=[256/S.width*2+1,256/S.height*2+1],fe=I?D.text.dynamicLayoutVertexArray:D.icon.dynamicLayoutVertexArray;fe.clear();const de=D.lineVertexArray,ge=I?D.text.placedSymbolArray:D.icon.placedSymbolArray,le=S.transform.width/S.transform.height;let Se=!1;for(let De=0;De<ge.length;De++){const _e=ge.get(De);if(_e.hidden||_e.writingMode===M.ah.vertical&&!Se){lt(_e.numGlyphs,fe);continue}let Ce;if(Se=!1,K?(Ce=[_e.anchorX,_e.anchorY,K(_e.anchorX,_e.anchorY),1],M.af(Ce,Ce,y)):(Ce=[_e.anchorX,_e.anchorY,0,1],gt(Ce,Ce,y)),!ie(Ce,ne)){lt(_e.numGlyphs,fe);continue}const ke=ee(S.transform.cameraToCenterDistance,Ce[3]),ze=M.ai(J,Q,_e),Be=N?ze/ke:ze*ke,He=new M.P(_e.anchorX,_e.anchorY),Ve=pe(He,C,K).point,je={projections:{},offsets:{}},nt=Ae(_e,Be,!1,U,y,C,z,D.glyphOffsetArray,de,fe,Ve,He,je,le,Z,K);Se=nt.useVertical,(nt.notEnoughRoom||Se||nt.needsFlipping&&Ae(_e,Be,!0,U,y,C,z,D.glyphOffsetArray,de,fe,Ve,He,je,le,Z,K).notEnoughRoom)&&lt(_e.numGlyphs,fe)}I?D.text.dynamicLayoutVertexBuffer.updateData(fe):D.icon.dynamicLayoutVertexBuffer.updateData(fe)}function he(D,y,S,I,C,z,N,U,Z,K,J,Q,ne){const fe=U.glyphStartIndex+U.numGlyphs,de=U.lineStartIndex,ge=U.lineStartIndex+U.lineLength,le=y.getoffsetX(U.glyphStartIndex),Se=y.getoffsetX(fe-1),De=Fe(D*le,S,I,C,z,N,U.segment,de,ge,Z,K,J,Q,ne);if(!De)return null;const _e=Fe(D*Se,S,I,C,z,N,U.segment,de,ge,Z,K,J,Q,ne);return _e?{first:De,last:_e}:null}function Te(D,y,S,I){return D===M.ah.horizontal&&Math.abs(S.y-y.y)>Math.abs(S.x-y.x)*I?{useVertical:!0}:(D===M.ah.vertical?y.y<S.y:y.x>S.x)?{needsFlipping:!0}:null}function Ae(D,y,S,I,C,z,N,U,Z,K,J,Q,ne,fe,de,ge){const le=y/24,Se=D.lineOffsetX*le,De=D.lineOffsetY*le;let _e;if(D.numGlyphs>1){const Ce=D.glyphStartIndex+D.numGlyphs,ke=D.lineStartIndex,ze=D.lineStartIndex+D.lineLength,Be=he(le,U,Se,De,S,J,Q,D,Z,z,ne,de,ge);if(!Be)return{notEnoughRoom:!0};const He=pe(Be.first.point,N,ge).point,Ve=pe(Be.last.point,N,ge).point;if(I&&!S){const je=Te(D.writingMode,He,Ve,fe);if(je)return je}_e=[Be.first];for(let je=D.glyphStartIndex+1;je<Ce-1;je++)_e.push(Fe(le*U.getoffsetX(je),Se,De,S,J,Q,D.segment,ke,ze,Z,z,ne,de,ge));_e.push(Be.last)}else{if(I&&!S){const ke=pe(Q,C,ge).point,ze=D.lineStartIndex+D.segment+1,Be=new M.P(Z.getx(ze),Z.gety(ze)),He=pe(Be,C,ge),Ve=He.signedDistanceFromCamera>0?He.point:Pe(Q,Be,ke,1,C,ge),je=Te(D.writingMode,ke,Ve,fe);if(je)return je}const Ce=Fe(le*U.getoffsetX(D.glyphStartIndex),Se,De,S,J,Q,D.segment,D.lineStartIndex,D.lineStartIndex+D.lineLength,Z,z,ne,de,ge);if(!Ce)return{notEnoughRoom:!0};_e=[Ce]}for(const Ce of _e)M.aj(K,Ce.point,Ce.angle);return{}}function Pe(D,y,S,I,C,z){const N=pe(D.add(D.sub(y)._unit()),C,z).point,U=S.sub(N);return S.add(U._mult(I/U.mag()))}function be(D,y){const{projectionCache:S,lineVertexArray:I,labelPlaneMatrix:C,tileAnchorPoint:z,distanceFromAnchor:N,getElevation:U,previousVertex:Z,direction:K,absOffsetX:J}=y;if(S.projections[D])return S.projections[D];const Q=new M.P(I.getx(D),I.gety(D)),ne=pe(Q,C,U);if(ne.signedDistanceFromCamera>0)return S.projections[D]=ne.point,ne.point;const fe=D-K;return Pe(N===0?z:new M.P(I.getx(fe),I.gety(fe)),Q,Z,J-N+1,C,U)}function Re(D,y,S){return D._unit()._perp()._mult(y*S)}function qe(D,y,S,I,C,z,N,U){const{projectionCache:Z,direction:K}=U;if(Z.offsets[D])return Z.offsets[D];const J=S.add(y);if(D+K<I||D+K>=C)return Z.offsets[D]=J,J;const Q=be(D+K,U),ne=Re(Q.sub(S),N,K),fe=S.add(ne),de=Q.add(ne);return Z.offsets[D]=M.ak(z,J,fe,de)||J,Z.offsets[D]}function Fe(D,y,S,I,C,z,N,U,Z,K,J,Q,ne,fe){const de=I?D-y:D+y;let ge=de>0?1:-1,le=0;I&&(ge*=-1,le=Math.PI),ge<0&&(le+=Math.PI);let Se,De,_e=ge>0?U+N:U+N+1,Ce=C,ke=C,ze=0,Be=0;const He=Math.abs(de),Ve=[];let je;for(;ze+Be<=He;){if(_e+=ge,_e<U||_e>=Z)return null;ze+=Be,ke=Ce,De=Se;const Je={projectionCache:Q,lineVertexArray:K,labelPlaneMatrix:J,tileAnchorPoint:z,distanceFromAnchor:ze,getElevation:fe,previousVertex:ke,direction:ge,absOffsetX:He};if(Ce=be(_e,Je),S===0)Ve.push(ke),je=Ce.sub(ke);else{let mt;const Et=Ce.sub(ke);mt=Et.mag()===0?Re(be(_e+ge,Je).sub(Ce),S,ge):Re(Et,S,ge),De||(De=ke.add(mt)),Se=qe(_e,mt,Ce,U,Z,De,S,Je),Ve.push(De),je=Se.sub(De)}Be=je.mag()}const nt=je._mult((He-ze)/Be)._add(De||ke),vt=le+Math.atan2(Ce.y-ke.y,Ce.x-ke.x);return Ve.push(nt),{point:nt,angle:ne?vt:0,path:Ve}}const Ne=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function lt(D,y){for(let S=0;S<D;S++){const I=y.length;y.resize(I+4),y.float32.set(Ne,3*I)}}function gt(D,y,S){const I=y[0],C=y[1];return D[0]=S[0]*I+S[4]*C+S[12],D[1]=S[1]*I+S[5]*C+S[13],D[3]=S[3]*I+S[7]*C+S[15],D}const ft=100;class kt{constructor(y,S=new wt(y.width+200,y.height+200,25),I=new wt(y.width+200,y.height+200,25)){this.transform=y,this.grid=S,this.ignoredGrid=I,this.pitchfactor=Math.cos(y._pitch)*y.cameraToCenterDistance,this.screenRightBoundary=y.width+ft,this.screenBottomBoundary=y.height+ft,this.gridRightBoundary=y.width+200,this.gridBottomBoundary=y.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(y,S,I,C,z,N){const U=this.projectAndGetPerspectiveRatio(C,y.anchorPointX,y.anchorPointY,N),Z=I*U.perspectiveRatio,K=y.x1*Z+U.point.x,J=y.y1*Z+U.point.y,Q=y.x2*Z+U.point.x,ne=y.y2*Z+U.point.y;return!this.isInsideGrid(K,J,Q,ne)||S!=="always"&&this.grid.hitTest(K,J,Q,ne,S,z)||U.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[K,J,Q,ne],offscreen:this.isOffscreen(K,J,Q,ne)}}placeCollisionCircles(y,S,I,C,z,N,U,Z,K,J,Q,ne,fe,de){const ge=[],le=new M.P(S.anchorX,S.anchorY),Se=pe(le,N,de),De=ee(this.transform.cameraToCenterDistance,Se.signedDistanceFromCamera),_e=(J?z/De:z*De)/M.ao,Ce=pe(le,U,de).point,ke=he(_e,C,S.lineOffsetX*_e,S.lineOffsetY*_e,!1,Ce,le,S,I,U,{projections:{},offsets:{}},!1,de);let ze=!1,Be=!1,He=!0;if(ke){const Ve=.5*ne*De+fe,je=new M.P(-100,-100),nt=new M.P(this.screenRightBoundary,this.screenBottomBoundary),vt=new Ai,Je=ke.first,mt=ke.last;let Et=[];for(let At=Je.path.length-1;At>=1;At--)Et.push(Je.path[At]);for(let At=1;At<mt.path.length;At++)Et.push(mt.path[At]);const Mt=2.5*Ve;if(Z){const At=Et.map(It=>pe(It,Z,de));Et=At.some(It=>It.signedDistanceFromCamera<=0)?[]:At.map(It=>It.point)}let _t=[];if(Et.length>0){const At=Et[0].clone(),It=Et[0].clone();for(let ei=1;ei<Et.length;ei++)At.x=Math.min(At.x,Et[ei].x),At.y=Math.min(At.y,Et[ei].y),It.x=Math.max(It.x,Et[ei].x),It.y=Math.max(It.y,Et[ei].y);_t=At.x>=je.x&&It.x<=nt.x&&At.y>=je.y&&It.y<=nt.y?[Et]:It.x<je.x||At.x>nt.x||It.y<je.y||At.y>nt.y?[]:M.al([Et],je.x,je.y,nt.x,nt.y)}for(const At of _t){vt.reset(At,.25*Ve);let It=0;It=vt.length<=.5*Ve?1:Math.ceil(vt.paddedLength/Mt)+1;for(let ei=0;ei<It;ei++){const Ht=ei/Math.max(It-1,1),Xi=vt.lerp(Ht),pi=Xi.x+ft,Zt=Xi.y+ft;ge.push(pi,Zt,Ve,0);const ki=pi-Ve,Tr=Zt-Ve,Or=pi+Ve,Mn=Zt+Ve;if(He=He&&this.isOffscreen(ki,Tr,Or,Mn),Be=Be||this.isInsideGrid(ki,Tr,Or,Mn),y!=="always"&&this.grid.hitTestCircle(pi,Zt,Ve,y,Q)&&(ze=!0,!K))return{circles:[],offscreen:!1,collisionDetected:ze}}}}return{circles:!K&&ze||!Be||De<this.perspectiveRatioCutoff?[]:ge,offscreen:He,collisionDetected:ze}}queryRenderedSymbols(y){if(y.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const S=[];let I=1/0,C=1/0,z=-1/0,N=-1/0;for(const J of y){const Q=new M.P(J.x+ft,J.y+ft);I=Math.min(I,Q.x),C=Math.min(C,Q.y),z=Math.max(z,Q.x),N=Math.max(N,Q.y),S.push(Q)}const U=this.grid.query(I,C,z,N).concat(this.ignoredGrid.query(I,C,z,N)),Z={},K={};for(const J of U){const Q=J.key;if(Z[Q.bucketInstanceId]===void 0&&(Z[Q.bucketInstanceId]={}),Z[Q.bucketInstanceId][Q.featureIndex])continue;const ne=[new M.P(J.x1,J.y1),new M.P(J.x2,J.y1),new M.P(J.x2,J.y2),new M.P(J.x1,J.y2)];M.am(S,ne)&&(Z[Q.bucketInstanceId][Q.featureIndex]=!0,K[Q.bucketInstanceId]===void 0&&(K[Q.bucketInstanceId]=[]),K[Q.bucketInstanceId].push(Q.featureIndex))}return K}insertCollisionBox(y,S,I,C,z,N){(I?this.ignoredGrid:this.grid).insert({bucketInstanceId:C,featureIndex:z,collisionGroupID:N,overlapMode:S},y[0],y[1],y[2],y[3])}insertCollisionCircles(y,S,I,C,z,N){const U=I?this.ignoredGrid:this.grid,Z={bucketInstanceId:C,featureIndex:z,collisionGroupID:N,overlapMode:S};for(let K=0;K<y.length;K+=4)U.insertCircle(Z,y[K],y[K+1],y[K+2])}projectAndGetPerspectiveRatio(y,S,I,C){let z;return C?(z=[S,I,C(S,I),1],M.af(z,z,y)):(z=[S,I,0,1],gt(z,z,y)),{point:new M.P((z[0]/z[3]+1)/2*this.transform.width+ft,(-z[1]/z[3]+1)/2*this.transform.height+ft),perspectiveRatio:.5+this.transform.cameraToCenterDistance/z[3]*.5}}isOffscreen(y,S,I,C){return I<ft||y>=this.screenRightBoundary||C<ft||S>this.screenBottomBoundary}isInsideGrid(y,S,I,C){return I>=0&&y<this.gridRightBoundary&&C>=0&&S<this.gridBottomBoundary}getViewportMatrix(){const y=M.an([]);return M.H(y,y,[-100,-100,0]),y}}function xt(D,y,S){return y*(M.W/(D.tileSize*Math.pow(2,S-D.tileID.overscaledZ)))}class Wt{constructor(y,S,I,C){this.opacity=y?Math.max(0,Math.min(1,y.opacity+(y.placed?S:-S))):C&&I?1:0,this.placed=I}isHidden(){return this.opacity===0&&!this.placed}}class qt{constructor(y,S,I,C,z){this.text=new Wt(y?y.text:null,S,I,z),this.icon=new Wt(y?y.icon:null,S,C,z)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class li{constructor(y,S,I){this.text=y,this.icon=S,this.skipFade=I}}class St{constructor(){this.invProjMatrix=M.F(),this.viewportMatrix=M.F(),this.circles=[]}}class ti{constructor(y,S,I,C,z){this.bucketInstanceId=y,this.featureIndex=S,this.sourceLayerIndex=I,this.bucketIndex=C,this.tileID=z}}class wi{constructor(y){this.crossSourceCollisions=y,this.maxGroupID=0,this.collisionGroups={}}get(y){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[y]){const S=++this.maxGroupID;this.collisionGroups[y]={ID:S,predicate:I=>I.collisionGroupID===S}}return this.collisionGroups[y]}}function Zi(D,y,S,I,C){const{horizontalAlign:z,verticalAlign:N}=M.at(D);return new M.P(-(z-.5)*y+I[0]*C,-(N-.5)*S+I[1]*C)}function Ri(D,y,S,I,C,z){const{x1:N,x2:U,y1:Z,y2:K,anchorPointX:J,anchorPointY:Q}=D,ne=new M.P(y,S);return I&&ne._rotate(C?z:-z),{x1:N+ne.x,y1:Z+ne.y,x2:U+ne.x,y2:K+ne.y,anchorPointX:J,anchorPointY:Q}}class Fi{constructor(y,S,I,C,z){this.transform=y.clone(),this.terrain=S,this.collisionIndex=new kt(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=I,this.retainedQueryData={},this.collisionGroups=new wi(C),this.collisionCircleArrays={},this.prevPlacement=z,z&&(z.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(y,S,I,C){const z=I.getBucket(S),N=I.latestFeatureIndex;if(!z||!N||S.id!==z.layerIds[0])return;const U=I.collisionBoxArray,Z=z.layers[0].layout,K=Math.pow(2,this.transform.zoom-I.tileID.overscaledZ),J=I.tileSize/M.W,Q=this.transform.calculatePosMatrix(I.tileID.toUnwrapped()),ne=Z.get("text-pitch-alignment")==="map",fe=Z.get("text-rotation-alignment")==="map",de=xt(I,1,this.transform.zoom),ge=nn(Q,ne,fe,this.transform,de);let le=null;if(ne){const De=jr(Q,ne,fe,this.transform,de);le=M.K([],this.transform.labelPlaneMatrix,De)}this.retainedQueryData[z.bucketInstanceId]=new ti(z.bucketInstanceId,N,z.sourceLayerIndex,z.index,I.tileID);const Se={bucket:z,layout:Z,posMatrix:Q,textLabelPlaneMatrix:ge,labelToScreenMatrix:le,scale:K,textPixelRatio:J,holdingForFade:I.holdingForFade(),collisionBoxArray:U,partiallyEvaluatedTextSize:M.ag(z.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(z.sourceID)};if(C)for(const De of z.sortKeyRanges){const{sortKey:_e,symbolInstanceStart:Ce,symbolInstanceEnd:ke}=De;y.push({sortKey:_e,symbolInstanceStart:Ce,symbolInstanceEnd:ke,parameters:Se})}else y.push({symbolInstanceStart:0,symbolInstanceEnd:z.symbolInstances.length,parameters:Se})}attemptAnchorPlacement(y,S,I,C,z,N,U,Z,K,J,Q,ne,fe,de,ge,le){const Se=M.ap[y.textAnchor],De=[y.textOffset0,y.textOffset1],_e=Zi(Se,I,C,De,z),Ce=this.collisionIndex.placeCollisionBox(Ri(S,_e.x,_e.y,N,U,this.transform.angle),Q,Z,K,J.predicate,le);if((!ge||this.collisionIndex.placeCollisionBox(Ri(ge,_e.x,_e.y,N,U,this.transform.angle),Q,Z,K,J.predicate,le).box.length!==0)&&Ce.box.length>0){let ke;if(this.prevPlacement&&this.prevPlacement.variableOffsets[ne.crossTileID]&&this.prevPlacement.placements[ne.crossTileID]&&this.prevPlacement.placements[ne.crossTileID].text&&(ke=this.prevPlacement.variableOffsets[ne.crossTileID].anchor),ne.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[ne.crossTileID]={textOffset:De,width:I,height:C,anchor:Se,textBoxScale:z,prevAnchor:ke},this.markUsedJustification(fe,Se,ne,de),fe.allowVerticalPlacement&&(this.markUsedOrientation(fe,de,ne),this.placedOrientations[ne.crossTileID]=de),{shift:_e,placedGlyphBoxes:Ce}}}placeLayerBucketPart(y,S,I){const{bucket:C,layout:z,posMatrix:N,textLabelPlaneMatrix:U,labelToScreenMatrix:Z,textPixelRatio:K,holdingForFade:J,collisionBoxArray:Q,partiallyEvaluatedTextSize:ne,collisionGroup:fe}=y.parameters,de=z.get("text-optional"),ge=z.get("icon-optional"),le=M.aq(z,"text-overlap","text-allow-overlap"),Se=le==="always",De=M.aq(z,"icon-overlap","icon-allow-overlap"),_e=De==="always",Ce=z.get("text-rotation-alignment")==="map",ke=z.get("text-pitch-alignment")==="map",ze=z.get("icon-text-fit")!=="none",Be=z.get("symbol-z-order")==="viewport-y",He=Se&&(_e||!C.hasIconData()||ge),Ve=_e&&(Se||!C.hasTextData()||de);!C.collisionArrays&&Q&&C.deserializeCollisionBoxes(Q);const je=this.retainedQueryData[C.bucketInstanceId].tileID,nt=this.terrain?(Je,mt)=>this.terrain.getElevation(je,Je,mt):null,vt=(Je,mt)=>{var Et,Mt;if(S[Je.crossTileID])return;if(J)return void(this.placements[Je.crossTileID]=new li(!1,!1,!1));let _t=!1,At=!1,It=!0,ei=null,Ht={box:null,offscreen:null},Xi={box:null,offscreen:null},pi=null,Zt=null,ki=null,Tr=0,Or=0,Mn=0;mt.textFeatureIndex?Tr=mt.textFeatureIndex:Je.useRuntimeCollisionCircles&&(Tr=Je.featureIndex),mt.verticalTextFeatureIndex&&(Or=mt.verticalTextFeatureIndex);const Rn=mt.textBox;if(Rn){const ri=Jt=>{let Ei=M.ah.horizontal;if(C.allowVerticalPlacement&&!Jt&&this.prevPlacement){const cr=this.prevPlacement.placedOrientations[Je.crossTileID];cr&&(this.placedOrientations[Je.crossTileID]=cr,Ei=cr,this.markUsedOrientation(C,Ei,Je))}return Ei},Xt=(Jt,Ei)=>{if(C.allowVerticalPlacement&&Je.numVerticalGlyphVertices>0&&mt.verticalTextBox){for(const cr of C.writingModes)if(cr===M.ah.vertical?(Ht=Ei(),Xi=Ht):Ht=Jt(),Ht&&Ht.box&&Ht.box.length)break}else Ht=Jt()},oi=Je.textAnchorOffsetStartIndex,us=Je.textAnchorOffsetEndIndex;if(us===oi){const Jt=(Ei,cr)=>{const Pt=this.collisionIndex.placeCollisionBox(Ei,le,K,N,fe.predicate,nt);return Pt&&Pt.box&&Pt.box.length&&(this.markUsedOrientation(C,cr,Je),this.placedOrientations[Je.crossTileID]=cr),Pt};Xt(()=>Jt(Rn,M.ah.horizontal),()=>{const Ei=mt.verticalTextBox;return C.allowVerticalPlacement&&Je.numVerticalGlyphVertices>0&&Ei?Jt(Ei,M.ah.vertical):{box:null,offscreen:null}}),ri(Ht&&Ht.box&&Ht.box.length)}else{let Jt=M.ap[(Mt=(Et=this.prevPlacement)===null||Et===void 0?void 0:Et.variableOffsets[Je.crossTileID])===null||Mt===void 0?void 0:Mt.anchor];const Ei=(Pt,xo,El)=>{const Dn=Pt.x2-Pt.x1,kn=Pt.y2-Pt.y1,ya=Je.textBoxScale,vo=ze&&De==="never"?xo:null;let zn={box:[],offscreen:!1},Tl=le==="never"?1:2,bo="never";Jt&&Tl++;for(let Al=0;Al<Tl;Al++){for(let Os=oi;Os<us;Os++){const Il=C.textAnchorOffsets.get(Os);if(Jt&&Il.textAnchor!==Jt)continue;const $s=this.attemptAnchorPlacement(Il,Pt,Dn,kn,ya,Ce,ke,K,N,fe,bo,Je,C,El,vo,nt);if($s&&(zn=$s.placedGlyphBoxes,zn&&zn.box&&zn.box.length))return _t=!0,ei=$s.shift,zn}Jt?Jt=null:bo=le}return zn};Xt(()=>Ei(Rn,mt.iconBox,M.ah.horizontal),()=>{const Pt=mt.verticalTextBox;return C.allowVerticalPlacement&&!(Ht&&Ht.box&&Ht.box.length)&&Je.numVerticalGlyphVertices>0&&Pt?Ei(Pt,mt.verticalIconBox,M.ah.vertical):{box:null,offscreen:null}}),Ht&&(_t=Ht.box,It=Ht.offscreen);const cr=ri(Ht&&Ht.box);if(!_t&&this.prevPlacement){const Pt=this.prevPlacement.variableOffsets[Je.crossTileID];Pt&&(this.variableOffsets[Je.crossTileID]=Pt,this.markUsedJustification(C,Pt.anchor,Je,cr))}}}if(pi=Ht,_t=pi&&pi.box&&pi.box.length>0,It=pi&&pi.offscreen,Je.useRuntimeCollisionCircles){const ri=C.text.placedSymbolArray.get(Je.centerJustifiedTextSymbolIndex),Xt=M.ai(C.textSizeData,ne,ri),oi=z.get("text-padding");Zt=this.collisionIndex.placeCollisionCircles(le,ri,C.lineVertexArray,C.glyphOffsetArray,Xt,N,U,Z,I,ke,fe.predicate,Je.collisionCircleDiameter,oi,nt),Zt.circles.length&&Zt.collisionDetected&&!I&&M.w("Collisions detected, but collision boxes are not shown"),_t=Se||Zt.circles.length>0&&!Zt.collisionDetected,It=It&&Zt.offscreen}if(mt.iconFeatureIndex&&(Mn=mt.iconFeatureIndex),mt.iconBox){const ri=Xt=>{const oi=ze&&ei?Ri(Xt,ei.x,ei.y,Ce,ke,this.transform.angle):Xt;return this.collisionIndex.placeCollisionBox(oi,De,K,N,fe.predicate,nt)};Xi&&Xi.box&&Xi.box.length&&mt.verticalIconBox?(ki=ri(mt.verticalIconBox),At=ki.box.length>0):(ki=ri(mt.iconBox),At=ki.box.length>0),It=It&&ki.offscreen}const $r=de||Je.numHorizontalGlyphVertices===0&&Je.numVerticalGlyphVertices===0,Ar=ge||Je.numIconVertices===0;if($r||Ar?Ar?$r||(At=At&&_t):_t=At&&_t:At=_t=At&&_t,_t&&pi&&pi.box&&this.collisionIndex.insertCollisionBox(pi.box,le,z.get("text-ignore-placement"),C.bucketInstanceId,Xi&&Xi.box&&Or?Or:Tr,fe.ID),At&&ki&&this.collisionIndex.insertCollisionBox(ki.box,De,z.get("icon-ignore-placement"),C.bucketInstanceId,Mn,fe.ID),Zt&&(_t&&this.collisionIndex.insertCollisionCircles(Zt.circles,le,z.get("text-ignore-placement"),C.bucketInstanceId,Tr,fe.ID),I)){const ri=C.bucketInstanceId;let Xt=this.collisionCircleArrays[ri];Xt===void 0&&(Xt=this.collisionCircleArrays[ri]=new St);for(let oi=0;oi<Zt.circles.length;oi+=4)Xt.circles.push(Zt.circles[oi+0]),Xt.circles.push(Zt.circles[oi+1]),Xt.circles.push(Zt.circles[oi+2]),Xt.circles.push(Zt.collisionDetected?1:0)}if(Je.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(C.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Je.crossTileID]=new li(_t||He,At||Ve,It||C.justReloaded),S[Je.crossTileID]=!0};if(Be){if(y.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Je=C.getSortedSymbolIndexes(this.transform.angle);for(let mt=Je.length-1;mt>=0;--mt){const Et=Je[mt];vt(C.symbolInstances.get(Et),C.collisionArrays[Et])}}else for(let Je=y.symbolInstanceStart;Je<y.symbolInstanceEnd;Je++)vt(C.symbolInstances.get(Je),C.collisionArrays[Je]);if(I&&C.bucketInstanceId in this.collisionCircleArrays){const Je=this.collisionCircleArrays[C.bucketInstanceId];M.ar(Je.invProjMatrix,N),Je.viewportMatrix=this.collisionIndex.getViewportMatrix()}C.justReloaded=!1}markUsedJustification(y,S,I,C){let z;z=C===M.ah.vertical?I.verticalPlacedTextSymbolIndex:{left:I.leftJustifiedTextSymbolIndex,center:I.centerJustifiedTextSymbolIndex,right:I.rightJustifiedTextSymbolIndex}[M.as(S)];const N=[I.leftJustifiedTextSymbolIndex,I.centerJustifiedTextSymbolIndex,I.rightJustifiedTextSymbolIndex,I.verticalPlacedTextSymbolIndex];for(const U of N)U>=0&&(y.text.placedSymbolArray.get(U).crossTileID=z>=0&&U!==z?0:I.crossTileID)}markUsedOrientation(y,S,I){const C=S===M.ah.horizontal||S===M.ah.horizontalOnly?S:0,z=S===M.ah.vertical?S:0,N=[I.leftJustifiedTextSymbolIndex,I.centerJustifiedTextSymbolIndex,I.rightJustifiedTextSymbolIndex];for(const U of N)y.text.placedSymbolArray.get(U).placedOrientation=C;I.verticalPlacedTextSymbolIndex&&(y.text.placedSymbolArray.get(I.verticalPlacedTextSymbolIndex).placedOrientation=z)}commit(y){this.commitTime=y,this.zoomAtLastRecencyCheck=this.transform.zoom;const S=this.prevPlacement;let I=!1;this.prevZoomAdjustment=S?S.zoomAdjustment(this.transform.zoom):0;const C=S?S.symbolFadeChange(y):1,z=S?S.opacities:{},N=S?S.variableOffsets:{},U=S?S.placedOrientations:{};for(const Z in this.placements){const K=this.placements[Z],J=z[Z];J?(this.opacities[Z]=new qt(J,C,K.text,K.icon),I=I||K.text!==J.text.placed||K.icon!==J.icon.placed):(this.opacities[Z]=new qt(null,C,K.text,K.icon,K.skipFade),I=I||K.text||K.icon)}for(const Z in z){const K=z[Z];if(!this.opacities[Z]){const J=new qt(K,C,!1,!1);J.isHidden()||(this.opacities[Z]=J,I=I||K.text.placed||K.icon.placed)}}for(const Z in N)this.variableOffsets[Z]||!this.opacities[Z]||this.opacities[Z].isHidden()||(this.variableOffsets[Z]=N[Z]);for(const Z in U)this.placedOrientations[Z]||!this.opacities[Z]||this.opacities[Z].isHidden()||(this.placedOrientations[Z]=U[Z]);if(S&&S.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");I?this.lastPlacementChangeTime=y:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=S?S.lastPlacementChangeTime:y)}updateLayerOpacities(y,S){const I={};for(const C of S){const z=C.getBucket(y);z&&C.latestFeatureIndex&&y.id===z.layerIds[0]&&this.updateBucketOpacities(z,I,C.collisionBoxArray)}}updateBucketOpacities(y,S,I){y.hasTextData()&&(y.text.opacityVertexArray.clear(),y.text.hasVisibleVertices=!1),y.hasIconData()&&(y.icon.opacityVertexArray.clear(),y.icon.hasVisibleVertices=!1),y.hasIconCollisionBoxData()&&y.iconCollisionBox.collisionVertexArray.clear(),y.hasTextCollisionBoxData()&&y.textCollisionBox.collisionVertexArray.clear();const C=y.layers[0],z=C.layout,N=new qt(null,0,!1,!1,!0),U=z.get("text-allow-overlap"),Z=z.get("icon-allow-overlap"),K=C._unevaluatedLayout.hasValue("text-variable-anchor")||C._unevaluatedLayout.hasValue("text-variable-anchor-offset"),J=z.get("text-rotation-alignment")==="map",Q=z.get("text-pitch-alignment")==="map",ne=z.get("icon-text-fit")!=="none",fe=new qt(null,0,U&&(Z||!y.hasIconData()||z.get("icon-optional")),Z&&(U||!y.hasTextData()||z.get("text-optional")),!0);!y.collisionArrays&&I&&(y.hasIconCollisionBoxData()||y.hasTextCollisionBoxData())&&y.deserializeCollisionBoxes(I);const de=(ge,le,Se)=>{for(let De=0;De<le/4;De++)ge.opacityVertexArray.emplaceBack(Se);ge.hasVisibleVertices=ge.hasVisibleVertices||Se!==Di};for(let ge=0;ge<y.symbolInstances.length;ge++){const le=y.symbolInstances.get(ge),{numHorizontalGlyphVertices:Se,numVerticalGlyphVertices:De,crossTileID:_e}=le;let Ce=this.opacities[_e];S[_e]?Ce=N:Ce||(Ce=fe,this.opacities[_e]=Ce),S[_e]=!0;const ke=le.numIconVertices>0,ze=this.placedOrientations[le.crossTileID],Be=ze===M.ah.vertical,He=ze===M.ah.horizontal||ze===M.ah.horizontalOnly;if(Se>0||De>0){const Ve=No(Ce.text);de(y.text,Se,Be?Di:Ve),de(y.text,De,He?Di:Ve);const je=Ce.text.isHidden();[le.rightJustifiedTextSymbolIndex,le.centerJustifiedTextSymbolIndex,le.leftJustifiedTextSymbolIndex].forEach(Je=>{Je>=0&&(y.text.placedSymbolArray.get(Je).hidden=je||Be?1:0)}),le.verticalPlacedTextSymbolIndex>=0&&(y.text.placedSymbolArray.get(le.verticalPlacedTextSymbolIndex).hidden=je||He?1:0);const nt=this.variableOffsets[le.crossTileID];nt&&this.markUsedJustification(y,nt.anchor,le,ze);const vt=this.placedOrientations[le.crossTileID];vt&&(this.markUsedJustification(y,"left",le,vt),this.markUsedOrientation(y,vt,le))}if(ke){const Ve=No(Ce.icon),je=!(ne&&le.verticalPlacedIconSymbolIndex&&Be);le.placedIconSymbolIndex>=0&&(de(y.icon,le.numIconVertices,je?Ve:Di),y.icon.placedSymbolArray.get(le.placedIconSymbolIndex).hidden=Ce.icon.isHidden()),le.verticalPlacedIconSymbolIndex>=0&&(de(y.icon,le.numVerticalIconVertices,je?Di:Ve),y.icon.placedSymbolArray.get(le.verticalPlacedIconSymbolIndex).hidden=Ce.icon.isHidden())}if(y.hasIconCollisionBoxData()||y.hasTextCollisionBoxData()){const Ve=y.collisionArrays[ge];if(Ve){let je=new M.P(0,0);if(Ve.textBox||Ve.verticalTextBox){let vt=!0;if(K){const Je=this.variableOffsets[_e];Je?(je=Zi(Je.anchor,Je.width,Je.height,Je.textOffset,Je.textBoxScale),J&&je._rotate(Q?this.transform.angle:-this.transform.angle)):vt=!1}Ve.textBox&&nr(y.textCollisionBox.collisionVertexArray,Ce.text.placed,!vt||Be,je.x,je.y),Ve.verticalTextBox&&nr(y.textCollisionBox.collisionVertexArray,Ce.text.placed,!vt||He,je.x,je.y)}const nt=!!(!He&&Ve.verticalIconBox);Ve.iconBox&&nr(y.iconCollisionBox.collisionVertexArray,Ce.icon.placed,nt,ne?je.x:0,ne?je.y:0),Ve.verticalIconBox&&nr(y.iconCollisionBox.collisionVertexArray,Ce.icon.placed,!nt,ne?je.x:0,ne?je.y:0)}}}if(y.sortFeatures(this.transform.angle),this.retainedQueryData[y.bucketInstanceId]&&(this.retainedQueryData[y.bucketInstanceId].featureSortOrder=y.featureSortOrder),y.hasTextData()&&y.text.opacityVertexBuffer&&y.text.opacityVertexBuffer.updateData(y.text.opacityVertexArray),y.hasIconData()&&y.icon.opacityVertexBuffer&&y.icon.opacityVertexBuffer.updateData(y.icon.opacityVertexArray),y.hasIconCollisionBoxData()&&y.iconCollisionBox.collisionVertexBuffer&&y.iconCollisionBox.collisionVertexBuffer.updateData(y.iconCollisionBox.collisionVertexArray),y.hasTextCollisionBoxData()&&y.textCollisionBox.collisionVertexBuffer&&y.textCollisionBox.collisionVertexBuffer.updateData(y.textCollisionBox.collisionVertexArray),y.text.opacityVertexArray.length!==y.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${y.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${y.text.layoutVertexArray.length}) / 4`);if(y.icon.opacityVertexArray.length!==y.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${y.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${y.icon.layoutVertexArray.length}) / 4`);if(y.bucketInstanceId in this.collisionCircleArrays){const ge=this.collisionCircleArrays[y.bucketInstanceId];y.placementInvProjMatrix=ge.invProjMatrix,y.placementViewportMatrix=ge.viewportMatrix,y.collisionCircleArray=ge.circles,delete this.collisionCircleArrays[y.bucketInstanceId]}}symbolFadeChange(y){return this.fadeDuration===0?1:(y-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(y){return Math.max(0,(this.transform.zoom-y)/1.5)}hasTransitions(y){return this.stale||y-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(y,S){const I=this.zoomAtLastRecencyCheck===S?1-this.zoomAdjustment(S):1;return this.zoomAtLastRecencyCheck=S,this.commitTime+this.fadeDuration*I>y}setStale(){this.stale=!0}}function nr(D,y,S,I,C){D.emplaceBack(y?1:0,S?1:0,I||0,C||0),D.emplaceBack(y?1:0,S?1:0,I||0,C||0),D.emplaceBack(y?1:0,S?1:0,I||0,C||0),D.emplaceBack(y?1:0,S?1:0,I||0,C||0)}const $o=Math.pow(2,25),Wl=Math.pow(2,24),Ut=Math.pow(2,17),Pa=Math.pow(2,16),Ma=Math.pow(2,9),sr=Math.pow(2,8),ar=Math.pow(2,1);function No(D){if(D.opacity===0&&!D.placed)return 0;if(D.opacity===1&&D.placed)return 4294967295;const y=D.placed?1:0,S=Math.floor(127*D.opacity);return S*$o+y*Wl+S*Ut+y*Pa+S*Ma+y*sr+S*ar+y}const Di=0;class mr{constructor(y){this._sortAcrossTiles=y.layout.get("symbol-z-order")!=="viewport-y"&&!y.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(y,S,I,C,z){const N=this._bucketParts;for(;this._currentTileIndex<y.length;)if(S.getBucketParts(N,C,y[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,z())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,N.sort((U,Z)=>U.sortKey-Z.sortKey));this._currentPartIndex<N.length;)if(S.placeLayerBucketPart(N[this._currentPartIndex],this._seenCrossTileIDs,I),this._currentPartIndex++,z())return!0;return!1}}class Uo{constructor(y,S,I,C,z,N,U,Z){this.placement=new Fi(y,S,N,U,Z),this._currentPlacementIndex=I.length-1,this._forceFullPlacement=C,this._showCollisionBoxes=z,this._done=!1}isDone(){return this._done}continuePlacement(y,S,I){const C=we.now(),z=()=>!this._forceFullPlacement&&we.now()-C>2;for(;this._currentPlacementIndex>=0;){const N=S[y[this._currentPlacementIndex]],U=this.placement.collisionIndex.transform.zoom;if(N.type==="symbol"&&(!N.minzoom||N.minzoom<=U)&&(!N.maxzoom||N.maxzoom>U)){if(this._inProgressLayer||(this._inProgressLayer=new mr(N)),this._inProgressLayer.continuePlacement(I[N.source],this.placement,this._showCollisionBoxes,N,z))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(y){return this.placement.commit(y),this.placement}}const sn=512/M.W/2;class di{constructor(y,S,I){this.tileID=y,this.bucketInstanceId=I,this._symbolsByKey={};const C=new Map;for(let z=0;z<S.length;z++){const N=S.get(z),U=N.key,Z=C.get(U);Z?Z.push(N):C.set(U,[N])}for(const[z,N]of C){const U={positions:N.map(Z=>({x:Math.floor(Z.anchorX*sn),y:Math.floor(Z.anchorY*sn)})),crossTileIDs:N.map(Z=>Z.crossTileID)};if(U.positions.length>128){const Z=new M.au(U.positions.length,16,Uint16Array);for(const{x:K,y:J}of U.positions)Z.add(K,J);Z.finish(),delete U.positions,U.index=Z}this._symbolsByKey[z]=U}}getScaledCoordinates(y,S){const{x:I,y:C,z}=this.tileID.canonical,{x:N,y:U,z:Z}=S.canonical,K=sn/Math.pow(2,Z-z),J=(U*M.W+y.anchorY)*K,Q=C*M.W*sn;return{x:Math.floor((N*M.W+y.anchorX)*K-I*M.W*sn),y:Math.floor(J-Q)}}findMatches(y,S,I){const C=this.tileID.canonical.z<S.canonical.z?1:Math.pow(2,this.tileID.canonical.z-S.canonical.z);for(let z=0;z<y.length;z++){const N=y.get(z);if(N.crossTileID)continue;const U=this._symbolsByKey[N.key];if(!U)continue;const Z=this.getScaledCoordinates(N,S);if(U.index){const K=U.index.range(Z.x-C,Z.y-C,Z.x+C,Z.y+C).sort();for(const J of K){const Q=U.crossTileIDs[J];if(!I[Q]){I[Q]=!0,N.crossTileID=Q;break}}}else if(U.positions)for(let K=0;K<U.positions.length;K++){const J=U.positions[K],Q=U.crossTileIDs[K];if(Math.abs(J.x-Z.x)<=C&&Math.abs(J.y-Z.y)<=C&&!I[Q]){I[Q]=!0,N.crossTileID=Q;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:y})=>y)}}class bs{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class vn{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(y){const S=Math.round((y-this.lng)/360);if(S!==0)for(const I in this.indexes){const C=this.indexes[I],z={};for(const N in C){const U=C[N];U.tileID=U.tileID.unwrapTo(U.tileID.wrap+S),z[U.tileID.key]=U}this.indexes[I]=z}this.lng=y}addBucket(y,S,I){if(this.indexes[y.overscaledZ]&&this.indexes[y.overscaledZ][y.key]){if(this.indexes[y.overscaledZ][y.key].bucketInstanceId===S.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(y.overscaledZ,this.indexes[y.overscaledZ][y.key])}for(let z=0;z<S.symbolInstances.length;z++)S.symbolInstances.get(z).crossTileID=0;this.usedCrossTileIDs[y.overscaledZ]||(this.usedCrossTileIDs[y.overscaledZ]={});const C=this.usedCrossTileIDs[y.overscaledZ];for(const z in this.indexes){const N=this.indexes[z];if(Number(z)>y.overscaledZ)for(const U in N){const Z=N[U];Z.tileID.isChildOf(y)&&Z.findMatches(S.symbolInstances,y,C)}else{const U=N[y.scaledTo(Number(z)).key];U&&U.findMatches(S.symbolInstances,y,C)}}for(let z=0;z<S.symbolInstances.length;z++){const N=S.symbolInstances.get(z);N.crossTileID||(N.crossTileID=I.generate(),C[N.crossTileID]=!0)}return this.indexes[y.overscaledZ]===void 0&&(this.indexes[y.overscaledZ]={}),this.indexes[y.overscaledZ][y.key]=new di(y,S.symbolInstances,S.bucketInstanceId),!0}removeBucketCrossTileIDs(y,S){for(const I of S.getCrossTileIDsLists())for(const C of I)delete this.usedCrossTileIDs[y][C]}removeStaleBuckets(y){let S=!1;for(const I in this.indexes){const C=this.indexes[I];for(const z in C)y[C[z].bucketInstanceId]||(this.removeBucketCrossTileIDs(I,C[z]),delete C[z],S=!0)}return S}}class si{constructor(){this.layerIndexes={},this.crossTileIDs=new bs,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(y,S,I){let C=this.layerIndexes[y.id];C===void 0&&(C=this.layerIndexes[y.id]=new vn);let z=!1;const N={};C.handleWrapJump(I);for(const U of S){const Z=U.getBucket(y);Z&&y.id===Z.layerIds[0]&&(Z.bucketInstanceId||(Z.bucketInstanceId=++this.maxBucketInstanceId),C.addBucket(U.tileID,Z,this.crossTileIDs)&&(z=!0),N[Z.bucketInstanceId]=!0)}return C.removeStaleBuckets(N)&&(z=!0),z}pruneUnusedLayers(y){const S={};y.forEach(I=>{S[I]=!0});for(const I in this.layerIndexes)S[I]||delete this.layerIndexes[I]}}const bn=(D,y)=>M.t(D,y&&y.filter(S=>S.identifier!=="source.canvas")),wr=M.av();class Hs extends M.E{constructor(y,S={}){super(),this._rtlPluginLoaded=()=>{for(const I in this.sourceCaches){const C=this.sourceCaches[I].getSource().type;C!=="vector"&&C!=="geojson"||this.sourceCaches[I].reload()}},this.map=y,this.dispatcher=new Nn(br(),y._getMapId()),this.dispatcher.registerMessageHandler("getGlyphs",(I,C)=>this.getGlyphs(I,C)),this.dispatcher.registerMessageHandler("getImages",(I,C)=>this.getImages(I,C)),this.imageManager=new xr,this.imageManager.setEventedParent(this),this.glyphManager=new Rr(y._requestManager,S.localIdeographFontFamily),this.lineAtlas=new Hi(256,512),this.crossTileSymbolIndex=new si,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new M.aw,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",M.ax()),rr().on(jn,this._rtlPluginLoaded),this.on("data",I=>{if(I.dataType!=="source"||I.sourceDataType!=="metadata")return;const C=this.sourceCaches[I.sourceId];if(!C)return;const z=C.getSource();if(z&&z.vectorLayerIds)for(const N in this._layers){const U=this._layers[N];U.source===z.id&&this._validateLayer(U)}})}loadURL(y,S={},I){this.fire(new M.k("dataloading",{dataType:"style"})),S.validate=typeof S.validate!="boolean"||S.validate;const C=this.map._requestManager.transformRequest(y,Nt.Style);this._loadStyleRequest=new AbortController,M.h(C,this._loadStyleRequest).then(z=>{this._loadStyleRequest=null,this._load(z.data,S,I)}).catch(z=>{this._loadStyleRequest=null,z&&this.fire(new M.j(z))})}loadJSON(y,S={},I){this.fire(new M.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,we.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,S.validate=S.validate!==!1,this._load(y,S,I)}).catch(()=>{})}loadEmpty(){this.fire(new M.k("dataloading",{dataType:"style"})),this._load(wr,{validate:!1})}_load(y,S,I){var C;const z=S.transformStyle?S.transformStyle(I,y):y;if(!S.validate||!bn(this,M.x(z))){this._loaded=!0,this.stylesheet=z;for(const N in z.sources)this.addSource(N,z.sources[N],{validate:!1});z.sprite?this._loadSprite(z.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(z.glyphs),this._createLayers(),this.light=new ji(this.stylesheet.light),this.map.setTerrain((C=this.stylesheet.terrain)!==null&&C!==void 0?C:null),this.fire(new M.k("data",{dataType:"style"})),this.fire(new M.k("style.load"))}}_createLayers(){const y=M.ay(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",y),this._order=y.map(S=>S.id),this._layers={},this._serializedLayers=null;for(const S of y){const I=M.az(S);I.setEventedParent(this,{layer:{id:S.id}}),this._layers[S.id]=I}}_loadSprite(y,S=!1,I=void 0){let C;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(z,N,U,Z){return M._(this,void 0,void 0,function*(){const K=qi(z),J=U>1?"@2x":"",Q={},ne={};for(const{id:fe,url:de}of K){const ge=N.transformRequest(N.normalizeSpriteURL(de,J,".json"),Nt.SpriteJSON);Q[fe]=M.h(ge,Z);const le=N.transformRequest(N.normalizeSpriteURL(de,J,".png"),Nt.SpriteImage);ne[fe]=Ft.getImage(le,Z)}return yield Promise.all([...Object.values(Q),...Object.values(ne)]),function(fe,de){return M._(this,void 0,void 0,function*(){const ge={};for(const le in fe){ge[le]={};const Se=we.getImageCanvasContext((yield de[le]).data),De=(yield fe[le]).data;for(const _e in De){const{width:Ce,height:ke,x:ze,y:Be,sdf:He,pixelRatio:Ve,stretchX:je,stretchY:nt,content:vt}=De[_e];ge[le][_e]={data:null,pixelRatio:Ve,sdf:He,stretchX:je,stretchY:nt,content:vt,spriteData:{width:Ce,height:ke,x:ze,y:Be,context:Se}}}}return ge})}(Q,ne)})}(y,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(z=>{if(this._spriteRequest=null,z)for(const N in z){this._spritesImagesIds[N]=[];const U=this._spritesImagesIds[N]?this._spritesImagesIds[N].filter(Z=>!(Z in z)):[];for(const Z of U)this.imageManager.removeImage(Z),this._changedImages[Z]=!0;for(const Z in z[N]){const K=N==="default"?Z:`${N}:${Z}`;this._spritesImagesIds[N].push(K),K in this.imageManager.images?this.imageManager.updateImage(K,z[N][Z],!1):this.imageManager.addImage(K,z[N][Z]),S&&(this._changedImages[K]=!0)}}}).catch(z=>{this._spriteRequest=null,C=z,this.fire(new M.j(C))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),S&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new M.k("data",{dataType:"style"})),I&&I(C)})}_unloadSprite(){for(const y of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(y),this._changedImages[y]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new M.k("data",{dataType:"style"}))}_validateLayer(y){const S=this.sourceCaches[y.source];if(!S)return;const I=y.sourceLayer;if(!I)return;const C=S.getSource();(C.type==="geojson"||C.vectorLayerIds&&C.vectorLayerIds.indexOf(I)===-1)&&this.fire(new M.j(new Error(`Source layer "${I}" does not exist on source "${C.id}" as specified by style layer "${y.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const y in this.sourceCaches)if(!this.sourceCaches[y].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(y){const S=this._serializedAllLayers();if(!y||y.length===0)return Object.values(S);const I=[];for(const C of y)S[C]&&I.push(S[C]);return I}_serializedAllLayers(){let y=this._serializedLayers;if(y)return y;y=this._serializedLayers={};const S=Object.keys(this._layers);for(const I of S){const C=this._layers[I];C.type!=="custom"&&(y[I]=C.serialize())}return y}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const y in this.sourceCaches)if(this.sourceCaches[y].hasTransition())return!0;for(const y in this._layers)if(this._layers[y].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(y){if(!this._loaded)return;const S=this._changed;if(this._changed){const C=Object.keys(this._updatedLayers),z=Object.keys(this._removedLayers);(C.length||z.length)&&this._updateWorkerLayers(C,z);for(const N in this._updatedSources){const U=this._updatedSources[N];if(U==="reload")this._reloadSource(N);else{if(U!=="clear")throw new Error(`Invalid action ${U}`);this._clearSource(N)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const N in this._updatedPaintProps)this._layers[N].updateTransitions(y);this.light.updateTransitions(y),this._resetUpdates()}const I={};for(const C in this.sourceCaches){const z=this.sourceCaches[C];I[C]=z.used,z.used=!1}for(const C of this._order){const z=this._layers[C];z.recalculate(y,this._availableImages),!z.isHidden(y.zoom)&&z.source&&(this.sourceCaches[z.source].used=!0)}for(const C in I){const z=this.sourceCaches[C];I[C]!==z.used&&z.fire(new M.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:C}))}this.light.recalculate(y),this.z=y.zoom,S&&this.fire(new M.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const y=Object.keys(this._changedImages);if(y.length){for(const S in this.sourceCaches)this.sourceCaches[S].reloadTilesForDependencies(["icons","patterns"],y);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const y in this.sourceCaches)this.sourceCaches[y].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(y,S){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(y),removedIds:S})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(y,S={}){var I;this._checkLoaded();const C=this.serialize();if(y=S.transformStyle?S.transformStyle(C,y):y,((I=S.validate)===null||I===void 0||I)&&bn(this,M.x(y)))return!1;(y=M.aA(y)).layers=M.ay(y.layers);const z=M.aB(C,y),N=this._getOperationsToPerform(z);if(N.unimplemented.length>0)throw new Error(`Unimplemented: ${N.unimplemented.join(", ")}.`);if(N.operations.length===0)return!1;for(const U of N.operations)U();return this.stylesheet=y,this._serializedLayers=null,!0}_getOperationsToPerform(y){const S=[],I=[];for(const C of y)switch(C.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":S.push(()=>this.addLayer.apply(this,C.args));break;case"removeLayer":S.push(()=>this.removeLayer.apply(this,C.args));break;case"setPaintProperty":S.push(()=>this.setPaintProperty.apply(this,C.args));break;case"setLayoutProperty":S.push(()=>this.setLayoutProperty.apply(this,C.args));break;case"setFilter":S.push(()=>this.setFilter.apply(this,C.args));break;case"addSource":S.push(()=>this.addSource.apply(this,C.args));break;case"removeSource":S.push(()=>this.removeSource.apply(this,C.args));break;case"setLayerZoomRange":S.push(()=>this.setLayerZoomRange.apply(this,C.args));break;case"setLight":S.push(()=>this.setLight.apply(this,C.args));break;case"setGeoJSONSourceData":S.push(()=>this.setGeoJSONSourceData.apply(this,C.args));break;case"setGlyphs":S.push(()=>this.setGlyphs.apply(this,C.args));break;case"setSprite":S.push(()=>this.setSprite.apply(this,C.args));break;case"setTerrain":S.push(()=>this.map.setTerrain.apply(this,C.args));break;case"setTransition":S.push(()=>{});break;default:I.push(C.command)}return{operations:S,unimplemented:I}}addImage(y,S){if(this.getImage(y))return this.fire(new M.j(new Error(`An image named "${y}" already exists.`)));this.imageManager.addImage(y,S),this._afterImageUpdated(y)}updateImage(y,S){this.imageManager.updateImage(y,S)}getImage(y){return this.imageManager.getImage(y)}removeImage(y){if(!this.getImage(y))return this.fire(new M.j(new Error(`An image named "${y}" does not exist.`)));this.imageManager.removeImage(y),this._afterImageUpdated(y)}_afterImageUpdated(y){this._availableImages=this.imageManager.listImages(),this._changedImages[y]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new M.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(y,S,I={}){if(this._checkLoaded(),this.sourceCaches[y]!==void 0)throw new Error(`Source "${y}" already exists.`);if(!S.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(S).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(S.type)>=0&&this._validate(M.x.source,`sources.${y}`,S,null,I))return;this.map&&this.map._collectResourceTiming&&(S.collectResourceTiming=!0);const C=this.sourceCaches[y]=new We(y,S,this.dispatcher);C.style=this,C.setEventedParent(this,()=>({isSourceLoaded:C.loaded(),source:C.serialize(),sourceId:y})),C.onAdd(this.map),this._changed=!0}removeSource(y){if(this._checkLoaded(),this.sourceCaches[y]===void 0)throw new Error("There is no source with this ID");for(const I in this._layers)if(this._layers[I].source===y)return this.fire(new M.j(new Error(`Source "${y}" cannot be removed while layer "${I}" is using it.`)));const S=this.sourceCaches[y];delete this.sourceCaches[y],delete this._updatedSources[y],S.fire(new M.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:y})),S.setEventedParent(null),S.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(y,S){if(this._checkLoaded(),this.sourceCaches[y]===void 0)throw new Error(`There is no source with this ID=${y}`);const I=this.sourceCaches[y].getSource();if(I.type!=="geojson")throw new Error(`geojsonSource.type is ${I.type}, which is !== 'geojson`);I.setData(S),this._changed=!0}getSource(y){return this.sourceCaches[y]&&this.sourceCaches[y].getSource()}addLayer(y,S,I={}){this._checkLoaded();const C=y.id;if(this.getLayer(C))return void this.fire(new M.j(new Error(`Layer "${C}" already exists on this map.`)));let z;if(y.type==="custom"){if(bn(this,M.aC(y)))return;z=M.az(y)}else{if("source"in y&&typeof y.source=="object"&&(this.addSource(C,y.source),y=M.aA(y),y=M.e(y,{source:C})),this._validate(M.x.layer,`layers.${C}`,y,{arrayIndex:-1},I))return;z=M.az(y),this._validateLayer(z),z.setEventedParent(this,{layer:{id:C}})}const N=S?this._order.indexOf(S):this._order.length;if(S&&N===-1)this.fire(new M.j(new Error(`Cannot add layer "${C}" before non-existing layer "${S}".`)));else{if(this._order.splice(N,0,C),this._layerOrderChanged=!0,this._layers[C]=z,this._removedLayers[C]&&z.source&&z.type!=="custom"){const U=this._removedLayers[C];delete this._removedLayers[C],U.type!==z.type?this._updatedSources[z.source]="clear":(this._updatedSources[z.source]="reload",this.sourceCaches[z.source].pause())}this._updateLayer(z),z.onAdd&&z.onAdd(this.map)}}moveLayer(y,S){if(this._checkLoaded(),this._changed=!0,!this._layers[y])return void this.fire(new M.j(new Error(`The layer '${y}' does not exist in the map's style and cannot be moved.`)));if(y===S)return;const I=this._order.indexOf(y);this._order.splice(I,1);const C=S?this._order.indexOf(S):this._order.length;S&&C===-1?this.fire(new M.j(new Error(`Cannot move layer "${y}" before non-existing layer "${S}".`))):(this._order.splice(C,0,y),this._layerOrderChanged=!0)}removeLayer(y){this._checkLoaded();const S=this._layers[y];if(!S)return void this.fire(new M.j(new Error(`Cannot remove non-existing layer "${y}".`)));S.setEventedParent(null);const I=this._order.indexOf(y);this._order.splice(I,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[y]=S,delete this._layers[y],this._serializedLayers&&delete this._serializedLayers[y],delete this._updatedLayers[y],delete this._updatedPaintProps[y],S.onRemove&&S.onRemove(this.map)}getLayer(y){return this._layers[y]}getLayersOrder(){return[...this._order]}hasLayer(y){return y in this._layers}setLayerZoomRange(y,S,I){this._checkLoaded();const C=this.getLayer(y);C?C.minzoom===S&&C.maxzoom===I||(S!=null&&(C.minzoom=S),I!=null&&(C.maxzoom=I),this._updateLayer(C)):this.fire(new M.j(new Error(`Cannot set the zoom range of non-existing layer "${y}".`)))}setFilter(y,S,I={}){this._checkLoaded();const C=this.getLayer(y);if(C){if(!M.aD(C.filter,S))return S==null?(C.filter=void 0,void this._updateLayer(C)):void(this._validate(M.x.filter,`layers.${C.id}.filter`,S,null,I)||(C.filter=M.aA(S),this._updateLayer(C)))}else this.fire(new M.j(new Error(`Cannot filter non-existing layer "${y}".`)))}getFilter(y){return M.aA(this.getLayer(y).filter)}setLayoutProperty(y,S,I,C={}){this._checkLoaded();const z=this.getLayer(y);z?M.aD(z.getLayoutProperty(S),I)||(z.setLayoutProperty(S,I,C),this._updateLayer(z)):this.fire(new M.j(new Error(`Cannot style non-existing layer "${y}".`)))}getLayoutProperty(y,S){const I=this.getLayer(y);if(I)return I.getLayoutProperty(S);this.fire(new M.j(new Error(`Cannot get style of non-existing layer "${y}".`)))}setPaintProperty(y,S,I,C={}){this._checkLoaded();const z=this.getLayer(y);z?M.aD(z.getPaintProperty(S),I)||(z.setPaintProperty(S,I,C)&&this._updateLayer(z),this._changed=!0,this._updatedPaintProps[y]=!0):this.fire(new M.j(new Error(`Cannot style non-existing layer "${y}".`)))}getPaintProperty(y,S){return this.getLayer(y).getPaintProperty(S)}setFeatureState(y,S){this._checkLoaded();const I=y.source,C=y.sourceLayer,z=this.sourceCaches[I];if(z===void 0)return void this.fire(new M.j(new Error(`The source '${I}' does not exist in the map's style.`)));const N=z.getSource().type;N==="geojson"&&C?this.fire(new M.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):N!=="vector"||C?(y.id===void 0&&this.fire(new M.j(new Error("The feature id parameter must be provided."))),z.setFeatureState(C,y.id,S)):this.fire(new M.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(y,S){this._checkLoaded();const I=y.source,C=this.sourceCaches[I];if(C===void 0)return void this.fire(new M.j(new Error(`The source '${I}' does not exist in the map's style.`)));const z=C.getSource().type,N=z==="vector"?y.sourceLayer:void 0;z!=="vector"||N?S&&typeof y.id!="string"&&typeof y.id!="number"?this.fire(new M.j(new Error("A feature id is required to remove its specific state property."))):C.removeFeatureState(N,y.id,S):this.fire(new M.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(y){this._checkLoaded();const S=y.source,I=y.sourceLayer,C=this.sourceCaches[S];if(C!==void 0)return C.getSource().type!=="vector"||I?(y.id===void 0&&this.fire(new M.j(new Error("The feature id parameter must be provided."))),C.getFeatureState(I,y.id)):void this.fire(new M.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new M.j(new Error(`The source '${S}' does not exist in the map's style.`)))}getTransition(){return M.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const y=M.aE(this.sourceCaches,z=>z.serialize()),S=this._serializeByIds(this._order),I=this.map.getTerrain()||void 0,C=this.stylesheet;return M.aF({version:C.version,name:C.name,metadata:C.metadata,light:C.light,center:C.center,zoom:C.zoom,bearing:C.bearing,pitch:C.pitch,sprite:C.sprite,glyphs:C.glyphs,transition:C.transition,sources:y,layers:S,terrain:I},z=>z!==void 0)}_updateLayer(y){this._updatedLayers[y.id]=!0,y.source&&!this._updatedSources[y.source]&&this.sourceCaches[y.source].getSource().type!=="raster"&&(this._updatedSources[y.source]="reload",this.sourceCaches[y.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(y){const S=N=>this._layers[N].type==="fill-extrusion",I={},C=[];for(let N=this._order.length-1;N>=0;N--){const U=this._order[N];if(S(U)){I[U]=N;for(const Z of y){const K=Z[U];if(K)for(const J of K)C.push(J)}}}C.sort((N,U)=>U.intersectionZ-N.intersectionZ);const z=[];for(let N=this._order.length-1;N>=0;N--){const U=this._order[N];if(S(U))for(let Z=C.length-1;Z>=0;Z--){const K=C[Z].feature;if(I[K.layer.id]<N)break;z.push(K),C.pop()}else for(const Z of y){const K=Z[U];if(K)for(const J of K)z.push(J.feature)}}return z}queryRenderedFeatures(y,S,I){S&&S.filter&&this._validate(M.x.filter,"queryRenderedFeatures.filter",S.filter,null,S);const C={};if(S&&S.layers){if(!Array.isArray(S.layers))return this.fire(new M.j(new Error("parameters.layers must be an Array."))),[];for(const U of S.layers){const Z=this._layers[U];if(!Z)return this.fire(new M.j(new Error(`The layer '${U}' does not exist in the map's style and cannot be queried for features.`))),[];C[Z.source]=!0}}const z=[];S.availableImages=this._availableImages;const N=this._serializedAllLayers();for(const U in this.sourceCaches)S.layers&&!C[U]||z.push(en(this.sourceCaches[U],this._layers,N,y,S,I));return this.placement&&z.push(function(U,Z,K,J,Q,ne,fe){const de={},ge=ne.queryRenderedSymbols(J),le=[];for(const Se of Object.keys(ge).map(Number))le.push(fe[Se]);le.sort(tn);for(const Se of le){const De=Se.featureIndex.lookupSymbolFeatures(ge[Se.bucketInstanceId],Z,Se.bucketIndex,Se.sourceLayerIndex,Q.filter,Q.layers,Q.availableImages,U);for(const _e in De){const Ce=de[_e]=de[_e]||[],ke=De[_e];ke.sort((ze,Be)=>{const He=Se.featureSortOrder;if(He){const Ve=He.indexOf(ze.featureIndex);return He.indexOf(Be.featureIndex)-Ve}return Be.featureIndex-ze.featureIndex});for(const ze of ke)Ce.push(ze)}}for(const Se in de)de[Se].forEach(De=>{const _e=De.feature,Ce=K[U[Se].source].getFeatureState(_e.layer["source-layer"],_e.id);_e.source=_e.layer.source,_e.layer["source-layer"]&&(_e.sourceLayer=_e.layer["source-layer"]),_e.state=Ce});return de}(this._layers,N,this.sourceCaches,y,S,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(z)}querySourceFeatures(y,S){S&&S.filter&&this._validate(M.x.filter,"querySourceFeatures.filter",S.filter,null,S);const I=this.sourceCaches[y];return I?function(C,z){const N=C.getRenderableIds().map(K=>C.getTileByID(K)),U=[],Z={};for(let K=0;K<N.length;K++){const J=N[K],Q=J.tileID.canonical.key;Z[Q]||(Z[Q]=!0,J.querySourceFeatures(U,z))}return U}(I,S):[]}getLight(){return this.light.getLight()}setLight(y,S={}){this._checkLoaded();const I=this.light.getLight();let C=!1;for(const N in y)if(!M.aD(y[N],I[N])){C=!0;break}if(!C)return;const z={now:we.now(),transition:M.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(y,S),this.light.updateTransitions(z)}_validate(y,S,I,C,z={}){return(!z||z.validate!==!1)&&bn(this,y.call(M.x,M.e({key:S,style:this.serialize(),value:I,styleSpec:M.v},C)))}_remove(y=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),rr().off(jn,this._rtlPluginLoaded);for(const S in this._layers)this._layers[S].setEventedParent(null);for(const S in this.sourceCaches){const I=this.sourceCaches[S];I.setEventedParent(null),I.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),y&&this.dispatcher.broadcast("removeMap",void 0),this.dispatcher.remove(y)}_clearSource(y){this.sourceCaches[y].clearTiles()}_reloadSource(y){this.sourceCaches[y].resume(),this.sourceCaches[y].reload()}_updateSources(y){for(const S in this.sourceCaches)this.sourceCaches[S].update(y,this.map.terrain)}_generateCollisionBoxes(){for(const y in this.sourceCaches)this._reloadSource(y)}_updatePlacement(y,S,I,C,z=!1){let N=!1,U=!1;const Z={};for(const K of this._order){const J=this._layers[K];if(J.type!=="symbol")continue;if(!Z[J.source]){const ne=this.sourceCaches[J.source];Z[J.source]=ne.getRenderableIds(!0).map(fe=>ne.getTileByID(fe)).sort((fe,de)=>de.tileID.overscaledZ-fe.tileID.overscaledZ||(fe.tileID.isLessThan(de.tileID)?-1:1))}const Q=this.crossTileSymbolIndex.addLayer(J,Z[J.source],y.center.lng);N=N||Q}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((z=z||this._layerOrderChanged||I===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(we.now(),y.zoom))&&(this.pauseablePlacement=new Uo(y,this.map.terrain,this._order,z,S,I,C,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,Z),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(we.now()),U=!0),N&&this.pauseablePlacement.placement.setStale()),U||N)for(const K of this._order){const J=this._layers[K];J.type==="symbol"&&this.placement.updateLayerOpacities(J,Z[J.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(we.now())}_releaseSymbolFadeTiles(){for(const y in this.sourceCaches)this.sourceCaches[y].releaseSymbolFadeTiles()}getImages(y,S){return M._(this,void 0,void 0,function*(){const I=yield this.imageManager.getImages(S.icons);this._updateTilesForChangedImages();const C=this.sourceCaches[S.source];return C&&C.setDependencies(S.tileID.key,S.type,S.icons),I})}getGlyphs(y,S){return M._(this,void 0,void 0,function*(){const I=yield this.glyphManager.getGlyphs(S.stacks),C=this.sourceCaches[S.source];return C&&C.setDependencies(S.tileID.key,S.type,[""]),I})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(y,S={}){this._checkLoaded(),y&&this._validate(M.x.glyphs,"glyphs",y,null,S)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=y,this.glyphManager.entries={},this.glyphManager.setURL(y))}addSprite(y,S,I={},C){this._checkLoaded();const z=[{id:y,url:S}],N=[...qi(this.stylesheet.sprite),...z];this._validate(M.x.sprite,"sprite",N,null,I)||(this.stylesheet.sprite=N,this._loadSprite(z,!0,C))}removeSprite(y){this._checkLoaded();const S=qi(this.stylesheet.sprite);if(S.find(I=>I.id===y)){if(this._spritesImagesIds[y])for(const I of this._spritesImagesIds[y])this.imageManager.removeImage(I),this._changedImages[I]=!0;S.splice(S.findIndex(I=>I.id===y),1),this.stylesheet.sprite=S.length>0?S:void 0,delete this._spritesImagesIds[y],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new M.k("data",{dataType:"style"}))}else this.fire(new M.j(new Error(`Sprite "${y}" doesn't exists on this map.`)))}getSprite(){return qi(this.stylesheet.sprite)}setSprite(y,S={},I){this._checkLoaded(),y&&this._validate(M.x.sprite,"sprite",y,null,S)||(this.stylesheet.sprite=y,y?this._loadSprite(y,!0,I):(this._unloadSprite(),I&&I(null)))}}var zr=M.X([{name:"a_pos",type:"Int16",components:2}]),Ra="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const Hn={prelude:Ot(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Ot(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Ot(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Ot(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Ot("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ot(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Ot(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Ot("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Ot("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Ot("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Ot(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Ot(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Ot(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Ot(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Ot(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Ot(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Ot(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ot(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Ot(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Ot(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Ot(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Ot(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Ot(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Ot(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Ot(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Ot(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Ot("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Ra),terrainDepth:Ot("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Ra),terrainCoords:Ot("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Ra)};function Ot(D,y){const S=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,I=y.match(/attribute ([\w]+) ([\w]+)/g),C=D.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),z=y.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),N=z?z.concat(C):C,U={};return{fragmentSource:D=D.replace(S,(Z,K,J,Q,ne)=>(U[ne]=!0,K==="define"?`
#ifndef HAS_UNIFORM_u_${ne}
varying ${J} ${Q} ${ne};
#else
uniform ${J} ${Q} u_${ne};
#endif
`:`
#ifdef HAS_UNIFORM_u_${ne}
    ${J} ${Q} ${ne} = u_${ne};
#endif
`)),vertexSource:y=y.replace(S,(Z,K,J,Q,ne)=>{const fe=Q==="float"?"vec2":"vec4",de=ne.match(/color/)?"color":fe;return U[ne]?K==="define"?`
#ifndef HAS_UNIFORM_u_${ne}
uniform lowp float u_${ne}_t;
attribute ${J} ${fe} a_${ne};
varying ${J} ${Q} ${ne};
#else
uniform ${J} ${Q} u_${ne};
#endif
`:de==="vec4"?`
#ifndef HAS_UNIFORM_u_${ne}
    ${ne} = a_${ne};
#else
    ${J} ${Q} ${ne} = u_${ne};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ne}
    ${ne} = unpack_mix_${de}(a_${ne}, u_${ne}_t);
#else
    ${J} ${Q} ${ne} = u_${ne};
#endif
`:K==="define"?`
#ifndef HAS_UNIFORM_u_${ne}
uniform lowp float u_${ne}_t;
attribute ${J} ${fe} a_${ne};
#else
uniform ${J} ${Q} u_${ne};
#endif
`:de==="vec4"?`
#ifndef HAS_UNIFORM_u_${ne}
    ${J} ${Q} ${ne} = a_${ne};
#else
    ${J} ${Q} ${ne} = u_${ne};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ne}
    ${J} ${Q} ${ne} = unpack_mix_${de}(a_${ne}, u_${ne}_t);
#else
    ${J} ${Q} ${ne} = u_${ne};
#endif
`}),staticAttributes:I,staticUniforms:N}}class Gs{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(y,S,I,C,z,N,U,Z,K){this.context=y;let J=this.boundPaintVertexBuffers.length!==C.length;for(let Q=0;!J&&Q<C.length;Q++)this.boundPaintVertexBuffers[Q]!==C[Q]&&(J=!0);!this.vao||this.boundProgram!==S||this.boundLayoutVertexBuffer!==I||J||this.boundIndexBuffer!==z||this.boundVertexOffset!==N||this.boundDynamicVertexBuffer!==U||this.boundDynamicVertexBuffer2!==Z||this.boundDynamicVertexBuffer3!==K?this.freshBind(S,I,C,z,N,U,Z,K):(y.bindVertexArray.set(this.vao),U&&U.bind(),z&&z.dynamicDraw&&z.bind(),Z&&Z.bind(),K&&K.bind())}freshBind(y,S,I,C,z,N,U,Z){const K=y.numAttributes,J=this.context,Q=J.gl;this.vao&&this.destroy(),this.vao=J.createVertexArray(),J.bindVertexArray.set(this.vao),this.boundProgram=y,this.boundLayoutVertexBuffer=S,this.boundPaintVertexBuffers=I,this.boundIndexBuffer=C,this.boundVertexOffset=z,this.boundDynamicVertexBuffer=N,this.boundDynamicVertexBuffer2=U,this.boundDynamicVertexBuffer3=Z,S.enableAttributes(Q,y);for(const ne of I)ne.enableAttributes(Q,y);N&&N.enableAttributes(Q,y),U&&U.enableAttributes(Q,y),Z&&Z.enableAttributes(Q,y),S.bind(),S.setVertexAttribPointers(Q,y,z);for(const ne of I)ne.bind(),ne.setVertexAttribPointers(Q,y,z);N&&(N.bind(),N.setVertexAttribPointers(Q,y,z)),C&&C.bind(),U&&(U.bind(),U.setVertexAttribPointers(Q,y,z)),Z&&(Z.bind(),Z.setVertexAttribPointers(Q,y,z)),J.currentNumAttributes=K}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function Br(D){const y=[];for(let S=0;S<D.length;S++){if(D[S]===null)continue;const I=D[S].split(" ");y.push(I.pop())}return y}class Da{constructor(y,S,I,C,z,N){const U=y.gl;this.program=U.createProgram();const Z=Br(S.staticAttributes),K=I?I.getBinderAttributes():[],J=Z.concat(K),Q=Hn.prelude.staticUniforms?Br(Hn.prelude.staticUniforms):[],ne=S.staticUniforms?Br(S.staticUniforms):[],fe=I?I.getBinderUniforms():[],de=Q.concat(ne).concat(fe),ge=[];for(const ze of de)ge.indexOf(ze)<0&&ge.push(ze);const le=I?I.defines():[];z&&le.push("#define OVERDRAW_INSPECTOR;"),N&&le.push("#define TERRAIN3D;");const Se=le.concat(Hn.prelude.fragmentSource,S.fragmentSource).join(`
`),De=le.concat(Hn.prelude.vertexSource,S.vertexSource).join(`
`),_e=U.createShader(U.FRAGMENT_SHADER);if(U.isContextLost())return void(this.failedToCreate=!0);if(U.shaderSource(_e,Se),U.compileShader(_e),!U.getShaderParameter(_e,U.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${U.getShaderInfoLog(_e)}`);U.attachShader(this.program,_e);const Ce=U.createShader(U.VERTEX_SHADER);if(U.isContextLost())return void(this.failedToCreate=!0);if(U.shaderSource(Ce,De),U.compileShader(Ce),!U.getShaderParameter(Ce,U.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${U.getShaderInfoLog(Ce)}`);U.attachShader(this.program,Ce),this.attributes={};const ke={};this.numAttributes=J.length;for(let ze=0;ze<this.numAttributes;ze++)J[ze]&&(U.bindAttribLocation(this.program,ze,J[ze]),this.attributes[J[ze]]=ze);if(U.linkProgram(this.program),!U.getProgramParameter(this.program,U.LINK_STATUS))throw new Error(`Program failed to link: ${U.getProgramInfoLog(this.program)}`);U.deleteShader(Ce),U.deleteShader(_e);for(let ze=0;ze<ge.length;ze++){const Be=ge[ze];if(Be&&!ke[Be]){const He=U.getUniformLocation(this.program,Be);He&&(ke[Be]=He)}}this.fixedUniforms=C(y,ke),this.terrainUniforms=((ze,Be)=>({u_depth:new M.aG(ze,Be.u_depth),u_terrain:new M.aG(ze,Be.u_terrain),u_terrain_dim:new M.aH(ze,Be.u_terrain_dim),u_terrain_matrix:new M.aI(ze,Be.u_terrain_matrix),u_terrain_unpack:new M.aJ(ze,Be.u_terrain_unpack),u_terrain_exaggeration:new M.aH(ze,Be.u_terrain_exaggeration)}))(y,ke),this.binderUniforms=I?I.getUniforms(y,ke):[]}draw(y,S,I,C,z,N,U,Z,K,J,Q,ne,fe,de,ge,le,Se,De){const _e=y.gl;if(this.failedToCreate)return;if(y.program.set(this.program),y.setDepthMode(I),y.setStencilMode(C),y.setColorMode(z),y.setCullFace(N),Z){y.activeTexture.set(_e.TEXTURE2),_e.bindTexture(_e.TEXTURE_2D,Z.depthTexture),y.activeTexture.set(_e.TEXTURE3),_e.bindTexture(_e.TEXTURE_2D,Z.texture);for(const ke in this.terrainUniforms)this.terrainUniforms[ke].set(Z[ke])}for(const ke in this.fixedUniforms)this.fixedUniforms[ke].set(U[ke]);ge&&ge.setUniforms(y,this.binderUniforms,fe,{zoom:de});let Ce=0;switch(S){case _e.LINES:Ce=2;break;case _e.TRIANGLES:Ce=3;break;case _e.LINE_STRIP:Ce=1}for(const ke of ne.get()){const ze=ke.vaos||(ke.vaos={});(ze[K]||(ze[K]=new Gs)).bind(y,this,J,ge?ge.getPaintVertexBuffers():[],Q,ke.vertexOffset,le,Se,De),_e.drawElements(S,ke.primitiveLength*Ce,_e.UNSIGNED_SHORT,ke.primitiveOffset*Ce*2)}}}function ws(D,y,S){const I=1/xt(S,1,y.transform.tileZoom),C=Math.pow(2,S.tileID.overscaledZ),z=S.tileSize*Math.pow(2,y.transform.tileZoom)/C,N=z*(S.tileID.canonical.x+S.tileID.wrap*C),U=z*S.tileID.canonical.y;return{u_image:0,u_texsize:S.imageAtlasTexture.size,u_scale:[I,D.fromScale,D.toScale],u_fade:D.t,u_pixel_coord_upper:[N>>16,U>>16],u_pixel_coord_lower:[65535&N,65535&U]}}const Vo=(D,y,S,I)=>{const C=y.style.light,z=C.properties.get("position"),N=[z.x,z.y,z.z],U=function(){var K=new M.A(9);return M.A!=Float32Array&&(K[1]=0,K[2]=0,K[3]=0,K[5]=0,K[6]=0,K[7]=0),K[0]=1,K[4]=1,K[8]=1,K}();C.properties.get("anchor")==="viewport"&&function(K,J){var Q=Math.sin(J),ne=Math.cos(J);K[0]=ne,K[1]=Q,K[2]=0,K[3]=-Q,K[4]=ne,K[5]=0,K[6]=0,K[7]=0,K[8]=1}(U,-y.transform.angle),function(K,J,Q){var ne=J[0],fe=J[1],de=J[2];K[0]=ne*Q[0]+fe*Q[3]+de*Q[6],K[1]=ne*Q[1]+fe*Q[4]+de*Q[7],K[2]=ne*Q[2]+fe*Q[5]+de*Q[8]}(N,N,U);const Z=C.properties.get("color");return{u_matrix:D,u_lightpos:N,u_lightintensity:C.properties.get("intensity"),u_lightcolor:[Z.r,Z.g,Z.b],u_vertical_gradient:+S,u_opacity:I}},Kl=(D,y,S,I,C,z,N)=>M.e(Vo(D,y,S,I),ws(z,y,N),{u_height_factor:-Math.pow(2,C.overscaledZ)/N.tileSize/8}),Zs=D=>({u_matrix:D}),qo=(D,y,S,I)=>M.e(Zs(D),ws(S,y,I)),jo=(D,y)=>({u_matrix:D,u_world:y}),Xl=(D,y,S,I,C)=>M.e(qo(D,y,S,I),{u_world:C}),Ho=(D,y,S,I)=>{const C=D.transform;let z,N;if(I.paint.get("circle-pitch-alignment")==="map"){const U=xt(S,1,C.zoom);z=!0,N=[U,U]}else z=!1,N=C.pixelsToGLUnits;return{u_camera_to_center_distance:C.cameraToCenterDistance,u_scale_with_map:+(I.paint.get("circle-pitch-scale")==="map"),u_matrix:D.translatePosMatrix(y.posMatrix,S,I.paint.get("circle-translate"),I.paint.get("circle-translate-anchor")),u_pitch_with_map:+z,u_device_pixel_ratio:D.pixelRatio,u_extrude_scale:N}},Yl=(D,y,S)=>{const I=xt(S,1,y.zoom),C=Math.pow(2,y.zoom-S.tileID.overscaledZ),z=S.tileID.overscaleFactor();return{u_matrix:D,u_camera_to_center_distance:y.cameraToCenterDistance,u_pixels_to_tile_units:I,u_extrude_scale:[y.pixelsToGLUnits[0]/(I*C),y.pixelsToGLUnits[1]/(I*C)],u_overscale_factor:z}},Ws=(D,y,S=1)=>({u_matrix:D,u_color:y,u_overlay:0,u_overlay_scale:S}),ka=D=>({u_matrix:D}),Go=(D,y,S,I)=>({u_matrix:D,u_extrude_scale:xt(y,1,S),u_intensity:I});function Zo(D,y){const S=Math.pow(2,y.canonical.z),I=y.canonical.y;return[new M.Y(0,I/S).toLngLat().lat,new M.Y(0,(I+1)/S).toLngLat().lat]}const Ks=(D,y,S,I)=>{const C=D.transform;return{u_matrix:Es(D,y,S,I),u_ratio:1/xt(y,1,C.zoom),u_device_pixel_ratio:D.pixelRatio,u_units_to_pixels:[1/C.pixelsToGLUnits[0],1/C.pixelsToGLUnits[1]]}},wn=(D,y,S,I,C)=>M.e(Ks(D,y,S,C),{u_image:0,u_image_height:I}),Xs=(D,y,S,I,C)=>{const z=D.transform,N=Ss(y,z);return{u_matrix:Es(D,y,S,C),u_texsize:y.imageAtlasTexture.size,u_ratio:1/xt(y,1,z.zoom),u_device_pixel_ratio:D.pixelRatio,u_image:0,u_scale:[N,I.fromScale,I.toScale],u_fade:I.t,u_units_to_pixels:[1/z.pixelsToGLUnits[0],1/z.pixelsToGLUnits[1]]}},gr=(D,y,S,I,C,z)=>{const N=D.lineAtlas,U=Ss(y,D.transform),Z=S.layout.get("line-cap")==="round",K=N.getDash(I.from,Z),J=N.getDash(I.to,Z),Q=K.width*C.fromScale,ne=J.width*C.toScale;return M.e(Ks(D,y,S,z),{u_patternscale_a:[U/Q,-K.height/2],u_patternscale_b:[U/ne,-J.height/2],u_sdfgamma:N.width/(256*Math.min(Q,ne)*D.pixelRatio)/2,u_image:0,u_tex_y_a:K.y,u_tex_y_b:J.y,u_mix:C.t})};function Ss(D,y){return 1/xt(D,1,y.tileZoom)}function Es(D,y,S,I){return D.translatePosMatrix(I?I.posMatrix:y.tileID.posMatrix,y,S.paint.get("line-translate"),S.paint.get("line-translate-anchor"))}const Ts=(D,y,S,I,C)=>{return{u_matrix:D,u_tl_parent:y,u_scale_parent:S,u_buffer_scale:1,u_fade_t:I.mix,u_opacity:I.opacity*C.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:C.paint.get("raster-brightness-min"),u_brightness_high:C.paint.get("raster-brightness-max"),u_saturation_factor:(N=C.paint.get("raster-saturation"),N>0?1-1/(1.001-N):-N),u_contrast_factor:(z=C.paint.get("raster-contrast"),z>0?1/(1-z):1+z),u_spin_weights:Ys(C.paint.get("raster-hue-rotate"))};var z,N};function Ys(D){D*=Math.PI/180;const y=Math.sin(D),S=Math.cos(D);return[(2*S+1)/3,(-Math.sqrt(3)*y-S+1)/3,(Math.sqrt(3)*y-S+1)/3]}const As=(D,y,S,I,C,z,N,U,Z,K)=>{const J=C.transform;return{u_is_size_zoom_constant:+(D==="constant"||D==="source"),u_is_size_feature_constant:+(D==="constant"||D==="camera"),u_size_t:y?y.uSizeT:0,u_size:y?y.uSize:0,u_camera_to_center_distance:J.cameraToCenterDistance,u_pitch:J.pitch/360*2*Math.PI,u_rotate_symbol:+S,u_aspect_ratio:J.width/J.height,u_fade_change:C.options.fadeDuration?C.symbolFadeChange:1,u_matrix:z,u_label_plane_matrix:N,u_coord_matrix:U,u_is_text:+Z,u_pitch_with_map:+I,u_texsize:K,u_texture:0}},Gn=(D,y,S,I,C,z,N,U,Z,K,J)=>{const Q=C.transform;return M.e(As(D,y,S,I,C,z,N,U,Z,K),{u_gamma_scale:I?Math.cos(Q._pitch)*Q.cameraToCenterDistance:1,u_device_pixel_ratio:C.pixelRatio,u_is_halo:+J})},Jl=(D,y,S,I,C,z,N,U,Z,K)=>M.e(Gn(D,y,S,I,C,z,N,U,!0,Z,!0),{u_texsize_icon:K,u_texture_icon:1}),Ql=(D,y,S)=>({u_matrix:D,u_opacity:y,u_color:S}),Wo=(D,y,S,I,C,z)=>M.e(function(N,U,Z,K){const J=Z.imageManager.getPattern(N.from.toString()),Q=Z.imageManager.getPattern(N.to.toString()),{width:ne,height:fe}=Z.imageManager.getPixelSize(),de=Math.pow(2,K.tileID.overscaledZ),ge=K.tileSize*Math.pow(2,Z.transform.tileZoom)/de,le=ge*(K.tileID.canonical.x+K.tileID.wrap*de),Se=ge*K.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:J.tl,u_pattern_br_a:J.br,u_pattern_tl_b:Q.tl,u_pattern_br_b:Q.br,u_texsize:[ne,fe],u_mix:U.t,u_pattern_size_a:J.displaySize,u_pattern_size_b:Q.displaySize,u_scale_a:U.fromScale,u_scale_b:U.toScale,u_tile_units_to_pixels:1/xt(K,1,Z.transform.tileZoom),u_pixel_coord_upper:[le>>16,Se>>16],u_pixel_coord_lower:[65535&le,65535&Se]}}(I,z,S,C),{u_matrix:D,u_opacity:y}),ec={fillExtrusion:(D,y)=>({u_matrix:new M.aI(D,y.u_matrix),u_lightpos:new M.aK(D,y.u_lightpos),u_lightintensity:new M.aH(D,y.u_lightintensity),u_lightcolor:new M.aK(D,y.u_lightcolor),u_vertical_gradient:new M.aH(D,y.u_vertical_gradient),u_opacity:new M.aH(D,y.u_opacity)}),fillExtrusionPattern:(D,y)=>({u_matrix:new M.aI(D,y.u_matrix),u_lightpos:new M.aK(D,y.u_lightpos),u_lightintensity:new M.aH(D,y.u_lightintensity),u_lightcolor:new M.aK(D,y.u_lightcolor),u_vertical_gradient:new M.aH(D,y.u_vertical_gradient),u_height_factor:new M.aH(D,y.u_height_factor),u_image:new M.aG(D,y.u_image),u_texsize:new M.aL(D,y.u_texsize),u_pixel_coord_upper:new M.aL(D,y.u_pixel_coord_upper),u_pixel_coord_lower:new M.aL(D,y.u_pixel_coord_lower),u_scale:new M.aK(D,y.u_scale),u_fade:new M.aH(D,y.u_fade),u_opacity:new M.aH(D,y.u_opacity)}),fill:(D,y)=>({u_matrix:new M.aI(D,y.u_matrix)}),fillPattern:(D,y)=>({u_matrix:new M.aI(D,y.u_matrix),u_image:new M.aG(D,y.u_image),u_texsize:new M.aL(D,y.u_texsize),u_pixel_coord_upper:new M.aL(D,y.u_pixel_coord_upper),u_pixel_coord_lower:new M.aL(D,y.u_pixel_coord_lower),u_scale:new M.aK(D,y.u_scale),u_fade:new M.aH(D,y.u_fade)}),fillOutline:(D,y)=>({u_matrix:new M.aI(D,y.u_matrix),u_world:new M.aL(D,y.u_world)}),fillOutlinePattern:(D,y)=>({u_matrix:new M.aI(D,y.u_matrix),u_world:new M.aL(D,y.u_world),u_image:new M.aG(D,y.u_image),u_texsize:new M.aL(D,y.u_texsize),u_pixel_coord_upper:new M.aL(D,y.u_pixel_coord_upper),u_pixel_coord_lower:new M.aL(D,y.u_pixel_coord_lower),u_scale:new M.aK(D,y.u_scale),u_fade:new M.aH(D,y.u_fade)}),circle:(D,y)=>({u_camera_to_center_distance:new M.aH(D,y.u_camera_to_center_distance),u_scale_with_map:new M.aG(D,y.u_scale_with_map),u_pitch_with_map:new M.aG(D,y.u_pitch_with_map),u_extrude_scale:new M.aL(D,y.u_extrude_scale),u_device_pixel_ratio:new M.aH(D,y.u_device_pixel_ratio),u_matrix:new M.aI(D,y.u_matrix)}),collisionBox:(D,y)=>({u_matrix:new M.aI(D,y.u_matrix),u_camera_to_center_distance:new M.aH(D,y.u_camera_to_center_distance),u_pixels_to_tile_units:new M.aH(D,y.u_pixels_to_tile_units),u_extrude_scale:new M.aL(D,y.u_extrude_scale),u_overscale_factor:new M.aH(D,y.u_overscale_factor)}),collisionCircle:(D,y)=>({u_matrix:new M.aI(D,y.u_matrix),u_inv_matrix:new M.aI(D,y.u_inv_matrix),u_camera_to_center_distance:new M.aH(D,y.u_camera_to_center_distance),u_viewport_size:new M.aL(D,y.u_viewport_size)}),debug:(D,y)=>({u_color:new M.aM(D,y.u_color),u_matrix:new M.aI(D,y.u_matrix),u_overlay:new M.aG(D,y.u_overlay),u_overlay_scale:new M.aH(D,y.u_overlay_scale)}),clippingMask:(D,y)=>({u_matrix:new M.aI(D,y.u_matrix)}),heatmap:(D,y)=>({u_extrude_scale:new M.aH(D,y.u_extrude_scale),u_intensity:new M.aH(D,y.u_intensity),u_matrix:new M.aI(D,y.u_matrix)}),heatmapTexture:(D,y)=>({u_matrix:new M.aI(D,y.u_matrix),u_world:new M.aL(D,y.u_world),u_image:new M.aG(D,y.u_image),u_color_ramp:new M.aG(D,y.u_color_ramp),u_opacity:new M.aH(D,y.u_opacity)}),hillshade:(D,y)=>({u_matrix:new M.aI(D,y.u_matrix),u_image:new M.aG(D,y.u_image),u_latrange:new M.aL(D,y.u_latrange),u_light:new M.aL(D,y.u_light),u_shadow:new M.aM(D,y.u_shadow),u_highlight:new M.aM(D,y.u_highlight),u_accent:new M.aM(D,y.u_accent)}),hillshadePrepare:(D,y)=>({u_matrix:new M.aI(D,y.u_matrix),u_image:new M.aG(D,y.u_image),u_dimension:new M.aL(D,y.u_dimension),u_zoom:new M.aH(D,y.u_zoom),u_unpack:new M.aJ(D,y.u_unpack)}),line:(D,y)=>({u_matrix:new M.aI(D,y.u_matrix),u_ratio:new M.aH(D,y.u_ratio),u_device_pixel_ratio:new M.aH(D,y.u_device_pixel_ratio),u_units_to_pixels:new M.aL(D,y.u_units_to_pixels)}),lineGradient:(D,y)=>({u_matrix:new M.aI(D,y.u_matrix),u_ratio:new M.aH(D,y.u_ratio),u_device_pixel_ratio:new M.aH(D,y.u_device_pixel_ratio),u_units_to_pixels:new M.aL(D,y.u_units_to_pixels),u_image:new M.aG(D,y.u_image),u_image_height:new M.aH(D,y.u_image_height)}),linePattern:(D,y)=>({u_matrix:new M.aI(D,y.u_matrix),u_texsize:new M.aL(D,y.u_texsize),u_ratio:new M.aH(D,y.u_ratio),u_device_pixel_ratio:new M.aH(D,y.u_device_pixel_ratio),u_image:new M.aG(D,y.u_image),u_units_to_pixels:new M.aL(D,y.u_units_to_pixels),u_scale:new M.aK(D,y.u_scale),u_fade:new M.aH(D,y.u_fade)}),lineSDF:(D,y)=>({u_matrix:new M.aI(D,y.u_matrix),u_ratio:new M.aH(D,y.u_ratio),u_device_pixel_ratio:new M.aH(D,y.u_device_pixel_ratio),u_units_to_pixels:new M.aL(D,y.u_units_to_pixels),u_patternscale_a:new M.aL(D,y.u_patternscale_a),u_patternscale_b:new M.aL(D,y.u_patternscale_b),u_sdfgamma:new M.aH(D,y.u_sdfgamma),u_image:new M.aG(D,y.u_image),u_tex_y_a:new M.aH(D,y.u_tex_y_a),u_tex_y_b:new M.aH(D,y.u_tex_y_b),u_mix:new M.aH(D,y.u_mix)}),raster:(D,y)=>({u_matrix:new M.aI(D,y.u_matrix),u_tl_parent:new M.aL(D,y.u_tl_parent),u_scale_parent:new M.aH(D,y.u_scale_parent),u_buffer_scale:new M.aH(D,y.u_buffer_scale),u_fade_t:new M.aH(D,y.u_fade_t),u_opacity:new M.aH(D,y.u_opacity),u_image0:new M.aG(D,y.u_image0),u_image1:new M.aG(D,y.u_image1),u_brightness_low:new M.aH(D,y.u_brightness_low),u_brightness_high:new M.aH(D,y.u_brightness_high),u_saturation_factor:new M.aH(D,y.u_saturation_factor),u_contrast_factor:new M.aH(D,y.u_contrast_factor),u_spin_weights:new M.aK(D,y.u_spin_weights)}),symbolIcon:(D,y)=>({u_is_size_zoom_constant:new M.aG(D,y.u_is_size_zoom_constant),u_is_size_feature_constant:new M.aG(D,y.u_is_size_feature_constant),u_size_t:new M.aH(D,y.u_size_t),u_size:new M.aH(D,y.u_size),u_camera_to_center_distance:new M.aH(D,y.u_camera_to_center_distance),u_pitch:new M.aH(D,y.u_pitch),u_rotate_symbol:new M.aG(D,y.u_rotate_symbol),u_aspect_ratio:new M.aH(D,y.u_aspect_ratio),u_fade_change:new M.aH(D,y.u_fade_change),u_matrix:new M.aI(D,y.u_matrix),u_label_plane_matrix:new M.aI(D,y.u_label_plane_matrix),u_coord_matrix:new M.aI(D,y.u_coord_matrix),u_is_text:new M.aG(D,y.u_is_text),u_pitch_with_map:new M.aG(D,y.u_pitch_with_map),u_texsize:new M.aL(D,y.u_texsize),u_texture:new M.aG(D,y.u_texture)}),symbolSDF:(D,y)=>({u_is_size_zoom_constant:new M.aG(D,y.u_is_size_zoom_constant),u_is_size_feature_constant:new M.aG(D,y.u_is_size_feature_constant),u_size_t:new M.aH(D,y.u_size_t),u_size:new M.aH(D,y.u_size),u_camera_to_center_distance:new M.aH(D,y.u_camera_to_center_distance),u_pitch:new M.aH(D,y.u_pitch),u_rotate_symbol:new M.aG(D,y.u_rotate_symbol),u_aspect_ratio:new M.aH(D,y.u_aspect_ratio),u_fade_change:new M.aH(D,y.u_fade_change),u_matrix:new M.aI(D,y.u_matrix),u_label_plane_matrix:new M.aI(D,y.u_label_plane_matrix),u_coord_matrix:new M.aI(D,y.u_coord_matrix),u_is_text:new M.aG(D,y.u_is_text),u_pitch_with_map:new M.aG(D,y.u_pitch_with_map),u_texsize:new M.aL(D,y.u_texsize),u_texture:new M.aG(D,y.u_texture),u_gamma_scale:new M.aH(D,y.u_gamma_scale),u_device_pixel_ratio:new M.aH(D,y.u_device_pixel_ratio),u_is_halo:new M.aG(D,y.u_is_halo)}),symbolTextAndIcon:(D,y)=>({u_is_size_zoom_constant:new M.aG(D,y.u_is_size_zoom_constant),u_is_size_feature_constant:new M.aG(D,y.u_is_size_feature_constant),u_size_t:new M.aH(D,y.u_size_t),u_size:new M.aH(D,y.u_size),u_camera_to_center_distance:new M.aH(D,y.u_camera_to_center_distance),u_pitch:new M.aH(D,y.u_pitch),u_rotate_symbol:new M.aG(D,y.u_rotate_symbol),u_aspect_ratio:new M.aH(D,y.u_aspect_ratio),u_fade_change:new M.aH(D,y.u_fade_change),u_matrix:new M.aI(D,y.u_matrix),u_label_plane_matrix:new M.aI(D,y.u_label_plane_matrix),u_coord_matrix:new M.aI(D,y.u_coord_matrix),u_is_text:new M.aG(D,y.u_is_text),u_pitch_with_map:new M.aG(D,y.u_pitch_with_map),u_texsize:new M.aL(D,y.u_texsize),u_texsize_icon:new M.aL(D,y.u_texsize_icon),u_texture:new M.aG(D,y.u_texture),u_texture_icon:new M.aG(D,y.u_texture_icon),u_gamma_scale:new M.aH(D,y.u_gamma_scale),u_device_pixel_ratio:new M.aH(D,y.u_device_pixel_ratio),u_is_halo:new M.aG(D,y.u_is_halo)}),background:(D,y)=>({u_matrix:new M.aI(D,y.u_matrix),u_opacity:new M.aH(D,y.u_opacity),u_color:new M.aM(D,y.u_color)}),backgroundPattern:(D,y)=>({u_matrix:new M.aI(D,y.u_matrix),u_opacity:new M.aH(D,y.u_opacity),u_image:new M.aG(D,y.u_image),u_pattern_tl_a:new M.aL(D,y.u_pattern_tl_a),u_pattern_br_a:new M.aL(D,y.u_pattern_br_a),u_pattern_tl_b:new M.aL(D,y.u_pattern_tl_b),u_pattern_br_b:new M.aL(D,y.u_pattern_br_b),u_texsize:new M.aL(D,y.u_texsize),u_mix:new M.aH(D,y.u_mix),u_pattern_size_a:new M.aL(D,y.u_pattern_size_a),u_pattern_size_b:new M.aL(D,y.u_pattern_size_b),u_scale_a:new M.aH(D,y.u_scale_a),u_scale_b:new M.aH(D,y.u_scale_b),u_pixel_coord_upper:new M.aL(D,y.u_pixel_coord_upper),u_pixel_coord_lower:new M.aL(D,y.u_pixel_coord_lower),u_tile_units_to_pixels:new M.aH(D,y.u_tile_units_to_pixels)}),terrain:(D,y)=>({u_matrix:new M.aI(D,y.u_matrix),u_texture:new M.aG(D,y.u_texture),u_ele_delta:new M.aH(D,y.u_ele_delta)}),terrainDepth:(D,y)=>({u_matrix:new M.aI(D,y.u_matrix),u_ele_delta:new M.aH(D,y.u_ele_delta)}),terrainCoords:(D,y)=>({u_matrix:new M.aI(D,y.u_matrix),u_texture:new M.aG(D,y.u_texture),u_terrain_coords_id:new M.aH(D,y.u_terrain_coords_id),u_ele_delta:new M.aH(D,y.u_ele_delta)})};class Sn{constructor(y,S,I){this.context=y;const C=y.gl;this.buffer=C.createBuffer(),this.dynamicDraw=!!I,this.context.unbindVAO(),y.bindElementBuffer.set(this.buffer),C.bufferData(C.ELEMENT_ARRAY_BUFFER,S.arrayBuffer,this.dynamicDraw?C.DYNAMIC_DRAW:C.STATIC_DRAW),this.dynamicDraw||delete S.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(y){const S=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),S.bufferSubData(S.ELEMENT_ARRAY_BUFFER,0,y.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Js={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class or{constructor(y,S,I,C){this.length=S.length,this.attributes=I,this.itemSize=S.bytesPerElement,this.dynamicDraw=C,this.context=y;const z=y.gl;this.buffer=z.createBuffer(),y.bindVertexBuffer.set(this.buffer),z.bufferData(z.ARRAY_BUFFER,S.arrayBuffer,this.dynamicDraw?z.DYNAMIC_DRAW:z.STATIC_DRAW),this.dynamicDraw||delete S.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(y){if(y.length!==this.length)throw new Error(`Length of new data is ${y.length}, which doesn't match current length of ${this.length}`);const S=this.context.gl;this.bind(),S.bufferSubData(S.ARRAY_BUFFER,0,y.arrayBuffer)}enableAttributes(y,S){for(let I=0;I<this.attributes.length;I++){const C=S.attributes[this.attributes[I].name];C!==void 0&&y.enableVertexAttribArray(C)}}setVertexAttribPointers(y,S,I){for(let C=0;C<this.attributes.length;C++){const z=this.attributes[C],N=S.attributes[z.name];N!==void 0&&y.vertexAttribPointer(N,z.components,y[Js[z.type]],!1,this.itemSize,z.offset+this.itemSize*(I||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Oi=new WeakMap;function Zn(D){var y;if(Oi.has(D))return Oi.get(D);{const S=(y=D.getParameter(D.VERSION))===null||y===void 0?void 0:y.startsWith("WebGL 2.0");return Oi.set(D,S),S}}class Bt{constructor(y){this.gl=y.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(y){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Qs extends Bt{getDefault(){return M.aO.transparent}set(y){const S=this.current;(y.r!==S.r||y.g!==S.g||y.b!==S.b||y.a!==S.a||this.dirty)&&(this.gl.clearColor(y.r,y.g,y.b,y.a),this.current=y,this.dirty=!1)}}class za extends Bt{getDefault(){return 1}set(y){(y!==this.current||this.dirty)&&(this.gl.clearDepth(y),this.current=y,this.dirty=!1)}}class Ba extends Bt{getDefault(){return 0}set(y){(y!==this.current||this.dirty)&&(this.gl.clearStencil(y),this.current=y,this.dirty=!1)}}class ea extends Bt{getDefault(){return[!0,!0,!0,!0]}set(y){const S=this.current;(y[0]!==S[0]||y[1]!==S[1]||y[2]!==S[2]||y[3]!==S[3]||this.dirty)&&(this.gl.colorMask(y[0],y[1],y[2],y[3]),this.current=y,this.dirty=!1)}}class La extends Bt{getDefault(){return!0}set(y){(y!==this.current||this.dirty)&&(this.gl.depthMask(y),this.current=y,this.dirty=!1)}}class Fa extends Bt{getDefault(){return 255}set(y){(y!==this.current||this.dirty)&&(this.gl.stencilMask(y),this.current=y,this.dirty=!1)}}class ta extends Bt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(y){const S=this.current;(y.func!==S.func||y.ref!==S.ref||y.mask!==S.mask||this.dirty)&&(this.gl.stencilFunc(y.func,y.ref,y.mask),this.current=y,this.dirty=!1)}}class Ko extends Bt{getDefault(){const y=this.gl;return[y.KEEP,y.KEEP,y.KEEP]}set(y){const S=this.current;(y[0]!==S[0]||y[1]!==S[1]||y[2]!==S[2]||this.dirty)&&(this.gl.stencilOp(y[0],y[1],y[2]),this.current=y,this.dirty=!1)}}class Xo extends Bt{getDefault(){return!1}set(y){if(y===this.current&&!this.dirty)return;const S=this.gl;y?S.enable(S.STENCIL_TEST):S.disable(S.STENCIL_TEST),this.current=y,this.dirty=!1}}class Wn extends Bt{getDefault(){return[0,1]}set(y){const S=this.current;(y[0]!==S[0]||y[1]!==S[1]||this.dirty)&&(this.gl.depthRange(y[0],y[1]),this.current=y,this.dirty=!1)}}class tc extends Bt{getDefault(){return!1}set(y){if(y===this.current&&!this.dirty)return;const S=this.gl;y?S.enable(S.DEPTH_TEST):S.disable(S.DEPTH_TEST),this.current=y,this.dirty=!1}}class ic extends Bt{getDefault(){return this.gl.LESS}set(y){(y!==this.current||this.dirty)&&(this.gl.depthFunc(y),this.current=y,this.dirty=!1)}}class rc extends Bt{getDefault(){return!1}set(y){if(y===this.current&&!this.dirty)return;const S=this.gl;y?S.enable(S.BLEND):S.disable(S.BLEND),this.current=y,this.dirty=!1}}class nc extends Bt{getDefault(){const y=this.gl;return[y.ONE,y.ZERO]}set(y){const S=this.current;(y[0]!==S[0]||y[1]!==S[1]||this.dirty)&&(this.gl.blendFunc(y[0],y[1]),this.current=y,this.dirty=!1)}}class sc extends Bt{getDefault(){return M.aO.transparent}set(y){const S=this.current;(y.r!==S.r||y.g!==S.g||y.b!==S.b||y.a!==S.a||this.dirty)&&(this.gl.blendColor(y.r,y.g,y.b,y.a),this.current=y,this.dirty=!1)}}class ac extends Bt{getDefault(){return this.gl.FUNC_ADD}set(y){(y!==this.current||this.dirty)&&(this.gl.blendEquation(y),this.current=y,this.dirty=!1)}}class Oa extends Bt{getDefault(){return!1}set(y){if(y===this.current&&!this.dirty)return;const S=this.gl;y?S.enable(S.CULL_FACE):S.disable(S.CULL_FACE),this.current=y,this.dirty=!1}}class ia extends Bt{getDefault(){return this.gl.BACK}set(y){(y!==this.current||this.dirty)&&(this.gl.cullFace(y),this.current=y,this.dirty=!1)}}class $a extends Bt{getDefault(){return this.gl.CCW}set(y){(y!==this.current||this.dirty)&&(this.gl.frontFace(y),this.current=y,this.dirty=!1)}}class Na extends Bt{getDefault(){return null}set(y){(y!==this.current||this.dirty)&&(this.gl.useProgram(y),this.current=y,this.dirty=!1)}}class Kn extends Bt{getDefault(){return this.gl.TEXTURE0}set(y){(y!==this.current||this.dirty)&&(this.gl.activeTexture(y),this.current=y,this.dirty=!1)}}class Yo extends Bt{getDefault(){const y=this.gl;return[0,0,y.drawingBufferWidth,y.drawingBufferHeight]}set(y){const S=this.current;(y[0]!==S[0]||y[1]!==S[1]||y[2]!==S[2]||y[3]!==S[3]||this.dirty)&&(this.gl.viewport(y[0],y[1],y[2],y[3]),this.current=y,this.dirty=!1)}}class Jo extends Bt{getDefault(){return null}set(y){if(y===this.current&&!this.dirty)return;const S=this.gl;S.bindFramebuffer(S.FRAMEBUFFER,y),this.current=y,this.dirty=!1}}class Ua extends Bt{getDefault(){return null}set(y){if(y===this.current&&!this.dirty)return;const S=this.gl;S.bindRenderbuffer(S.RENDERBUFFER,y),this.current=y,this.dirty=!1}}class En extends Bt{getDefault(){return null}set(y){if(y===this.current&&!this.dirty)return;const S=this.gl;S.bindTexture(S.TEXTURE_2D,y),this.current=y,this.dirty=!1}}class Qo extends Bt{getDefault(){return null}set(y){if(y===this.current&&!this.dirty)return;const S=this.gl;S.bindBuffer(S.ARRAY_BUFFER,y),this.current=y,this.dirty=!1}}class Xn extends Bt{getDefault(){return null}set(y){const S=this.gl;S.bindBuffer(S.ELEMENT_ARRAY_BUFFER,y),this.current=y,this.dirty=!1}}class Yn extends Bt{getDefault(){return null}set(y){var S;if(y===this.current&&!this.dirty)return;const I=this.gl;Zn(I)?I.bindVertexArray(y):(S=I.getExtension("OES_vertex_array_object"))===null||S===void 0||S.bindVertexArrayOES(y),this.current=y,this.dirty=!1}}class el extends Bt{getDefault(){return 4}set(y){if(y===this.current&&!this.dirty)return;const S=this.gl;S.pixelStorei(S.UNPACK_ALIGNMENT,y),this.current=y,this.dirty=!1}}class Va extends Bt{getDefault(){return!1}set(y){if(y===this.current&&!this.dirty)return;const S=this.gl;S.pixelStorei(S.UNPACK_PREMULTIPLY_ALPHA_WEBGL,y),this.current=y,this.dirty=!1}}class Lt extends Bt{getDefault(){return!1}set(y){if(y===this.current&&!this.dirty)return;const S=this.gl;S.pixelStorei(S.UNPACK_FLIP_Y_WEBGL,y),this.current=y,this.dirty=!1}}class Jn extends Bt{constructor(y,S){super(y),this.context=y,this.parent=S}getDefault(){return null}}class oc extends Jn{setDirty(){this.dirty=!0}set(y){if(y===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const S=this.gl;S.framebufferTexture2D(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0,S.TEXTURE_2D,y,0),this.current=y,this.dirty=!1}}class tl extends Jn{set(y){if(y===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const S=this.gl;S.framebufferRenderbuffer(S.FRAMEBUFFER,S.DEPTH_ATTACHMENT,S.RENDERBUFFER,y),this.current=y,this.dirty=!1}}class Is extends Jn{set(y){if(y===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const S=this.gl;S.framebufferRenderbuffer(S.FRAMEBUFFER,S.DEPTH_STENCIL_ATTACHMENT,S.RENDERBUFFER,y),this.current=y,this.dirty=!1}}class lc{constructor(y,S,I,C,z){this.context=y,this.width=S,this.height=I;const N=y.gl,U=this.framebuffer=N.createFramebuffer();if(this.colorAttachment=new oc(y,U),C)this.depthAttachment=z?new Is(y,U):new tl(y,U);else if(z)throw new Error("Stencil cannot be set without depth");if(N.checkFramebufferStatus(N.FRAMEBUFFER)!==N.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const y=this.context.gl,S=this.colorAttachment.get();if(S&&y.deleteTexture(S),this.depthAttachment){const I=this.depthAttachment.get();I&&y.deleteRenderbuffer(I)}y.deleteFramebuffer(this.framebuffer)}}class ci{constructor(y,S,I){this.blendFunction=y,this.blendColor=S,this.mask=I}}ci.Replace=[1,0],ci.disabled=new ci(ci.Replace,M.aO.transparent,[!1,!1,!1,!1]),ci.unblended=new ci(ci.Replace,M.aO.transparent,[!0,!0,!0,!0]),ci.alphaBlended=new ci([1,771],M.aO.transparent,[!0,!0,!0,!0]);class il{constructor(y){var S,I;if(this.gl=y,this.clearColor=new Qs(this),this.clearDepth=new za(this),this.clearStencil=new Ba(this),this.colorMask=new ea(this),this.depthMask=new La(this),this.stencilMask=new Fa(this),this.stencilFunc=new ta(this),this.stencilOp=new Ko(this),this.stencilTest=new Xo(this),this.depthRange=new Wn(this),this.depthTest=new tc(this),this.depthFunc=new ic(this),this.blend=new rc(this),this.blendFunc=new nc(this),this.blendColor=new sc(this),this.blendEquation=new ac(this),this.cullFace=new Oa(this),this.cullFaceSide=new ia(this),this.frontFace=new $a(this),this.program=new Na(this),this.activeTexture=new Kn(this),this.viewport=new Yo(this),this.bindFramebuffer=new Jo(this),this.bindRenderbuffer=new Ua(this),this.bindTexture=new En(this),this.bindVertexBuffer=new Qo(this),this.bindElementBuffer=new Xn(this),this.bindVertexArray=new Yn(this),this.pixelStoreUnpack=new el(this),this.pixelStoreUnpackPremultiplyAlpha=new Va(this),this.pixelStoreUnpackFlipY=new Lt(this),this.extTextureFilterAnisotropic=y.getExtension("EXT_texture_filter_anisotropic")||y.getExtension("MOZ_EXT_texture_filter_anisotropic")||y.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=y.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=y.getParameter(y.MAX_TEXTURE_SIZE),Zn(y)){this.HALF_FLOAT=y.HALF_FLOAT;const C=y.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(S=y.RGBA16F)!==null&&S!==void 0?S:C==null?void 0:C.RGBA16F_EXT,this.RGB16F=(I=y.RGB16F)!==null&&I!==void 0?I:C==null?void 0:C.RGB16F_EXT,y.getExtension("EXT_color_buffer_float")}else{y.getExtension("EXT_color_buffer_half_float"),y.getExtension("OES_texture_half_float_linear");const C=y.getExtension("OES_texture_half_float");this.HALF_FLOAT=C==null?void 0:C.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(y,S){return new Sn(this,y,S)}createVertexBuffer(y,S,I){return new or(this,y,S,I)}createRenderbuffer(y,S,I){const C=this.gl,z=C.createRenderbuffer();return this.bindRenderbuffer.set(z),C.renderbufferStorage(C.RENDERBUFFER,y,S,I),this.bindRenderbuffer.set(null),z}createFramebuffer(y,S,I,C){return new lc(this,y,S,I,C)}clear({color:y,depth:S,stencil:I}){const C=this.gl;let z=0;y&&(z|=C.COLOR_BUFFER_BIT,this.clearColor.set(y),this.colorMask.set([!0,!0,!0,!0])),S!==void 0&&(z|=C.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(S),this.depthMask.set(!0)),I!==void 0&&(z|=C.STENCIL_BUFFER_BIT,this.clearStencil.set(I),this.stencilMask.set(255)),C.clear(z)}setCullFace(y){y.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(y.mode),this.frontFace.set(y.frontFace))}setDepthMode(y){y.func!==this.gl.ALWAYS||y.mask?(this.depthTest.set(!0),this.depthFunc.set(y.func),this.depthMask.set(y.mask),this.depthRange.set(y.range)):this.depthTest.set(!1)}setStencilMode(y){y.test.func!==this.gl.ALWAYS||y.mask?(this.stencilTest.set(!0),this.stencilMask.set(y.mask),this.stencilOp.set([y.fail,y.depthFail,y.pass]),this.stencilFunc.set({func:y.test.func,ref:y.ref,mask:y.test.mask})):this.stencilTest.set(!1)}setColorMode(y){M.aD(y.blendFunction,ci.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(y.blendFunction),this.blendColor.set(y.blendColor)),this.colorMask.set(y.mask)}createVertexArray(){var y;return Zn(this.gl)?this.gl.createVertexArray():(y=this.gl.getExtension("OES_vertex_array_object"))===null||y===void 0?void 0:y.createVertexArrayOES()}deleteVertexArray(y){var S;return Zn(this.gl)?this.gl.deleteVertexArray(y):(S=this.gl.getExtension("OES_vertex_array_object"))===null||S===void 0?void 0:S.deleteVertexArrayOES(y)}unbindVAO(){this.bindVertexArray.set(null)}}class zt{constructor(y,S,I){this.func=y,this.mask=S,this.range=I}}zt.ReadOnly=!1,zt.ReadWrite=!0,zt.disabled=new zt(519,zt.ReadOnly,[0,1]);const Cs=7680;class Gt{constructor(y,S,I,C,z,N){this.test=y,this.ref=S,this.mask=I,this.fail=C,this.depthFail=z,this.pass=N}}Gt.disabled=new Gt({func:519,mask:0},0,0,Cs,Cs,Cs);class jt{constructor(y,S,I){this.enable=y,this.mode=S,this.frontFace=I}}let Qn;function ra(D,y,S,I,C,z,N){const U=D.context,Z=U.gl,K=D.useProgram("collisionBox"),J=[];let Q=0,ne=0;for(let _e=0;_e<I.length;_e++){const Ce=I[_e],ke=y.getTile(Ce),ze=ke.getBucket(S);if(!ze)continue;let Be=Ce.posMatrix;C[0]===0&&C[1]===0||(Be=D.translatePosMatrix(Ce.posMatrix,ke,C,z));const He=N?ze.textCollisionBox:ze.iconCollisionBox,Ve=ze.collisionCircleArray;if(Ve.length>0){const je=M.F(),nt=Be;M.aP(je,ze.placementInvProjMatrix,D.transform.glCoordMatrix),M.aP(je,je,ze.placementViewportMatrix),J.push({circleArray:Ve,circleOffset:ne,transform:nt,invTransform:je,coord:Ce}),Q+=Ve.length/4,ne=Q}He&&K.draw(U,Z.LINES,zt.disabled,Gt.disabled,D.colorModeForRenderPass(),jt.disabled,Yl(Be,D.transform,ke),D.style.map.terrain&&D.style.map.terrain.getTerrainData(Ce),S.id,He.layoutVertexBuffer,He.indexBuffer,He.segments,null,D.transform.zoom,null,null,He.collisionVertexBuffer)}if(!N||!J.length)return;const fe=D.useProgram("collisionCircle"),de=new M.aQ;de.resize(4*Q),de._trim();let ge=0;for(const _e of J)for(let Ce=0;Ce<_e.circleArray.length/4;Ce++){const ke=4*Ce,ze=_e.circleArray[ke+0],Be=_e.circleArray[ke+1],He=_e.circleArray[ke+2],Ve=_e.circleArray[ke+3];de.emplace(ge++,ze,Be,He,Ve,0),de.emplace(ge++,ze,Be,He,Ve,1),de.emplace(ge++,ze,Be,He,Ve,2),de.emplace(ge++,ze,Be,He,Ve,3)}(!Qn||Qn.length<2*Q)&&(Qn=function(_e){const Ce=2*_e,ke=new M.aS;ke.resize(Ce),ke._trim();for(let ze=0;ze<Ce;ze++){const Be=6*ze;ke.uint16[Be+0]=4*ze+0,ke.uint16[Be+1]=4*ze+1,ke.uint16[Be+2]=4*ze+2,ke.uint16[Be+3]=4*ze+2,ke.uint16[Be+4]=4*ze+3,ke.uint16[Be+5]=4*ze+0}return ke}(Q));const le=U.createIndexBuffer(Qn,!0),Se=U.createVertexBuffer(de,M.aR.members,!0);for(const _e of J){const Ce={u_matrix:_e.transform,u_inv_matrix:_e.invTransform,u_camera_to_center_distance:(De=D.transform).cameraToCenterDistance,u_viewport_size:[De.width,De.height]};fe.draw(U,Z.TRIANGLES,zt.disabled,Gt.disabled,D.colorModeForRenderPass(),jt.disabled,Ce,D.style.map.terrain&&D.style.map.terrain.getTerrainData(_e.coord),S.id,Se,le,M.$.simpleSegment(0,2*_e.circleOffset,_e.circleArray.length,_e.circleArray.length/2),null,D.transform.zoom,null,null,null)}var De;Se.destroy(),le.destroy()}jt.disabled=new jt(!1,1029,2305),jt.backCCW=new jt(!0,1029,2305);const rl=M.an(new Float32Array(16));function na(D,y,S,I,C,z){const{horizontalAlign:N,verticalAlign:U}=M.at(D);return new M.P((-(N-.5)*y/C+I[0])*z,(-(U-.5)*S/C+I[1])*z)}function sa(D,y,S,I,C,z,N,U,Z,K,J){const Q=D.text.placedSymbolArray,ne=D.text.dynamicLayoutVertexArray,fe=D.icon.dynamicLayoutVertexArray,de={};ne.clear();for(let ge=0;ge<Q.length;ge++){const le=Q.get(ge),Se=le.hidden||!le.crossTileID||D.allowVerticalPlacement&&!le.placedOrientation?null:I[le.crossTileID];if(Se){const De=new M.P(le.anchorX,le.anchorY),_e=pe(De,S?N:z,J),Ce=ee(C.cameraToCenterDistance,_e.signedDistanceFromCamera);let ke=M.ai(D.textSizeData,Z,le)*Ce/M.ao;S&&(ke*=D.tilePixelRatio/U);const{width:ze,height:Be,anchor:He,textOffset:Ve,textBoxScale:je}=Se,nt=na(He,ze,Be,Ve,je,ke),vt=S?pe(De.add(nt),z,J).point:_e.point.add(y?nt.rotate(-C.angle):nt),Je=D.allowVerticalPlacement&&le.placedOrientation===M.ah.vertical?Math.PI/2:0;for(let mt=0;mt<le.numGlyphs;mt++)M.aj(ne,vt,Je);K&&le.associatedIconIndex>=0&&(de[le.associatedIconIndex]={shiftedAnchor:vt,angle:Je})}else lt(le.numGlyphs,ne)}if(K){fe.clear();const ge=D.icon.placedSymbolArray;for(let le=0;le<ge.length;le++){const Se=ge.get(le);if(Se.hidden)lt(Se.numGlyphs,fe);else{const De=de[le];if(De)for(let _e=0;_e<Se.numGlyphs;_e++)M.aj(fe,De.shiftedAnchor,De.angle);else lt(Se.numGlyphs,fe)}}D.icon.dynamicLayoutVertexBuffer.updateData(fe)}D.text.dynamicLayoutVertexBuffer.updateData(ne)}function qa(D,y,S){return S.iconsInText&&y?"symbolTextAndIcon":D?"symbolSDF":"symbolIcon"}function nl(D,y,S,I,C,z,N,U,Z,K,J,Q){const ne=D.context,fe=ne.gl,de=D.transform,ge=U==="map",le=Z==="map",Se=U!=="viewport"&&S.layout.get("symbol-placement")!=="point",De=ge&&!le&&!Se,_e=!S.layout.get("symbol-sort-key").isConstant();let Ce=!1;const ke=D.depthModeForSublayer(0,zt.ReadOnly),ze=S._unevaluatedLayout.hasValue("text-variable-anchor")||S._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Be=[];for(const He of I){const Ve=y.getTile(He),je=Ve.getBucket(S);if(!je)continue;const nt=C?je.text:je.icon;if(!nt||!nt.segments.get().length||!nt.hasVisibleVertices)continue;const vt=nt.programConfigurations.get(S.id),Je=C||je.sdfIcons,mt=C?je.textSizeData:je.iconSizeData,Et=le||de.pitch!==0,Mt=D.useProgram(qa(Je,C,je),vt),_t=M.ag(mt,de.zoom),At=D.style.map.terrain&&D.style.map.terrain.getTerrainData(He);let It,ei,Ht,Xi,pi=[0,0],Zt=null;if(C)ei=Ve.glyphAtlasTexture,Ht=fe.LINEAR,It=Ve.glyphAtlasTexture.size,je.iconsInText&&(pi=Ve.imageAtlasTexture.size,Zt=Ve.imageAtlasTexture,Xi=Et||D.options.rotating||D.options.zooming||mt.kind==="composite"||mt.kind==="camera"?fe.LINEAR:fe.NEAREST);else{const Jt=S.layout.get("icon-size").constantOr(0)!==1||je.iconsNeedLinear;ei=Ve.imageAtlasTexture,Ht=Je||D.options.rotating||D.options.zooming||Jt||Et?fe.LINEAR:fe.NEAREST,It=Ve.imageAtlasTexture.size}const ki=xt(Ve,1,D.transform.zoom),Tr=nn(He.posMatrix,le,ge,D.transform,ki),Or=jr(He.posMatrix,le,ge,D.transform,ki),Mn=ze&&je.hasTextData(),Rn=S.layout.get("icon-text-fit")!=="none"&&Mn&&je.hasIconData();if(Se){const Jt=D.style.map.terrain?(cr,Pt)=>D.style.map.terrain.getElevation(He,cr,Pt):null,Ei=S.layout.get("text-rotation-alignment")==="map";ae(je,He.posMatrix,D,C,Tr,Or,le,K,Ei,Jt)}const $r=D.translatePosMatrix(He.posMatrix,Ve,z,N),Ar=Se||C&&ze||Rn?rl:Tr,ri=D.translatePosMatrix(Or,Ve,z,N,!0),Xt=Je&&S.paint.get(C?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let oi;oi=Je?je.iconsInText?Jl(mt.kind,_t,De,le,D,$r,Ar,ri,It,pi):Gn(mt.kind,_t,De,le,D,$r,Ar,ri,C,It,!0):As(mt.kind,_t,De,le,D,$r,Ar,ri,C,It);const us={program:Mt,buffers:nt,uniformValues:oi,atlasTexture:ei,atlasTextureIcon:Zt,atlasInterpolation:Ht,atlasInterpolationIcon:Xi,isSDF:Je,hasHalo:Xt};if(_e&&je.canOverlap){Ce=!0;const Jt=nt.segments.get();for(const Ei of Jt)Be.push({segments:new M.$([Ei]),sortKey:Ei.sortKey,state:us,terrainData:At})}else Be.push({segments:nt.segments,sortKey:0,state:us,terrainData:At})}Ce&&Be.sort((He,Ve)=>He.sortKey-Ve.sortKey);for(const He of Be){const Ve=He.state;if(ne.activeTexture.set(fe.TEXTURE0),Ve.atlasTexture.bind(Ve.atlasInterpolation,fe.CLAMP_TO_EDGE),Ve.atlasTextureIcon&&(ne.activeTexture.set(fe.TEXTURE1),Ve.atlasTextureIcon&&Ve.atlasTextureIcon.bind(Ve.atlasInterpolationIcon,fe.CLAMP_TO_EDGE)),Ve.isSDF){const je=Ve.uniformValues;Ve.hasHalo&&(je.u_is_halo=1,aa(Ve.buffers,He.segments,S,D,Ve.program,ke,J,Q,je,He.terrainData)),je.u_is_halo=0}aa(Ve.buffers,He.segments,S,D,Ve.program,ke,J,Q,Ve.uniformValues,He.terrainData)}}function aa(D,y,S,I,C,z,N,U,Z,K){const J=I.context;C.draw(J,J.gl.TRIANGLES,z,N,U,jt.disabled,Z,K,S.id,D.layoutVertexBuffer,D.indexBuffer,y,S.paint,I.transform.zoom,D.programConfigurations.get(S.id),D.dynamicLayoutVertexBuffer,D.opacityVertexBuffer)}function sl(D,y,S,I,C){if(!S||!I||!I.imageAtlas)return;const z=I.imageAtlas.patternPositions;let N=z[S.to.toString()],U=z[S.from.toString()];if(!N&&U&&(N=U),!U&&N&&(U=N),!N||!U){const Z=C.getPaintProperty(y);N=z[Z],U=z[Z]}N&&U&&D.setConstantPatternPositions(N,U)}function ja(D,y,S,I,C,z,N){const U=D.context.gl,Z="fill-pattern",K=S.paint.get(Z),J=K&&K.constantOr(1),Q=S.getCrossfadeParameters();let ne,fe,de,ge,le;N?(fe=J&&!S.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ne=U.LINES):(fe=J?"fillPattern":"fill",ne=U.TRIANGLES);const Se=K.constantOr(null);for(const De of I){const _e=y.getTile(De);if(J&&!_e.patternsLoaded())continue;const Ce=_e.getBucket(S);if(!Ce)continue;const ke=Ce.programConfigurations.get(S.id),ze=D.useProgram(fe,ke),Be=D.style.map.terrain&&D.style.map.terrain.getTerrainData(De);J&&(D.context.activeTexture.set(U.TEXTURE0),_e.imageAtlasTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),ke.updatePaintBuffers(Q)),sl(ke,Z,Se,_e,S);const He=Be?De:null,Ve=D.translatePosMatrix(He?He.posMatrix:De.posMatrix,_e,S.paint.get("fill-translate"),S.paint.get("fill-translate-anchor"));if(N){ge=Ce.indexBuffer2,le=Ce.segments2;const je=[U.drawingBufferWidth,U.drawingBufferHeight];de=fe==="fillOutlinePattern"&&J?Xl(Ve,D,Q,_e,je):jo(Ve,je)}else ge=Ce.indexBuffer,le=Ce.segments,de=J?qo(Ve,D,Q,_e):Zs(Ve);ze.draw(D.context,ne,C,D.stencilModeForClipping(De),z,jt.disabled,de,Be,S.id,Ce.layoutVertexBuffer,ge,le,S.paint,D.transform.zoom,ke)}}function es(D,y,S,I,C,z,N){const U=D.context,Z=U.gl,K="fill-extrusion-pattern",J=S.paint.get(K),Q=J.constantOr(1),ne=S.getCrossfadeParameters(),fe=S.paint.get("fill-extrusion-opacity"),de=J.constantOr(null);for(const ge of I){const le=y.getTile(ge),Se=le.getBucket(S);if(!Se)continue;const De=D.style.map.terrain&&D.style.map.terrain.getTerrainData(ge),_e=Se.programConfigurations.get(S.id),Ce=D.useProgram(Q?"fillExtrusionPattern":"fillExtrusion",_e);Q&&(D.context.activeTexture.set(Z.TEXTURE0),le.imageAtlasTexture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE),_e.updatePaintBuffers(ne)),sl(_e,K,de,le,S);const ke=D.translatePosMatrix(ge.posMatrix,le,S.paint.get("fill-extrusion-translate"),S.paint.get("fill-extrusion-translate-anchor")),ze=S.paint.get("fill-extrusion-vertical-gradient"),Be=Q?Kl(ke,D,ze,fe,ge,ne,le):Vo(ke,D,ze,fe);Ce.draw(U,U.gl.TRIANGLES,C,z,N,jt.backCCW,Be,De,S.id,Se.layoutVertexBuffer,Se.indexBuffer,Se.segments,S.paint,D.transform.zoom,_e,D.style.map.terrain&&Se.centroidVertexBuffer)}}function Ha(D,y,S,I,C,z,N){const U=D.context,Z=U.gl,K=S.fbo;if(!K)return;const J=D.useProgram("hillshade"),Q=D.style.map.terrain&&D.style.map.terrain.getTerrainData(y);U.activeTexture.set(Z.TEXTURE0),Z.bindTexture(Z.TEXTURE_2D,K.colorAttachment.get()),J.draw(U,Z.TRIANGLES,C,z,N,jt.disabled,((ne,fe,de,ge)=>{const le=de.paint.get("hillshade-shadow-color"),Se=de.paint.get("hillshade-highlight-color"),De=de.paint.get("hillshade-accent-color");let _e=de.paint.get("hillshade-illumination-direction")*(Math.PI/180);de.paint.get("hillshade-illumination-anchor")==="viewport"&&(_e-=ne.transform.angle);const Ce=!ne.options.moving;return{u_matrix:ge?ge.posMatrix:ne.transform.calculatePosMatrix(fe.tileID.toUnwrapped(),Ce),u_image:0,u_latrange:Zo(0,fe.tileID),u_light:[de.paint.get("hillshade-exaggeration"),_e],u_shadow:le,u_highlight:Se,u_accent:De}})(D,S,I,Q?y:null),Q,I.id,D.rasterBoundsBuffer,D.quadTriangleIndexBuffer,D.rasterBoundsSegments)}function al(D,y,S,I,C,z){const N=D.context,U=N.gl,Z=y.dem;if(Z&&Z.data){const K=Z.dim,J=Z.stride,Q=Z.getPixels();if(N.activeTexture.set(U.TEXTURE1),N.pixelStoreUnpackPremultiplyAlpha.set(!1),y.demTexture=y.demTexture||D.getTileTexture(J),y.demTexture){const fe=y.demTexture;fe.update(Q,{premultiply:!1}),fe.bind(U.NEAREST,U.CLAMP_TO_EDGE)}else y.demTexture=new ni(N,Q,U.RGBA,{premultiply:!1}),y.demTexture.bind(U.NEAREST,U.CLAMP_TO_EDGE);N.activeTexture.set(U.TEXTURE0);let ne=y.fbo;if(!ne){const fe=new ni(N,{width:K,height:K,data:null},U.RGBA);fe.bind(U.LINEAR,U.CLAMP_TO_EDGE),ne=y.fbo=N.createFramebuffer(K,K,!0,!1),ne.colorAttachment.set(fe.texture)}N.bindFramebuffer.set(ne.framebuffer),N.viewport.set([0,0,K,K]),D.useProgram("hillshadePrepare").draw(N,U.TRIANGLES,I,C,z,jt.disabled,((fe,de)=>{const ge=de.stride,le=M.F();return M.aN(le,0,M.W,-M.W,0,0,1),M.H(le,le,[0,-M.W,0]),{u_matrix:le,u_image:1,u_dimension:[ge,ge],u_zoom:fe.overscaledZ,u_unpack:de.getUnpackVector()}})(y.tileID,Z),null,S.id,D.rasterBoundsBuffer,D.quadTriangleIndexBuffer,D.rasterBoundsSegments),y.needsHillshadePrepare=!1}}function ol(D,y,S,I,C,z){const N=I.paint.get("raster-fade-duration");if(!z&&N>0){const U=we.now(),Z=(U-D.timeAdded)/N,K=y?(U-y.timeAdded)/N:-1,J=S.getSource(),Q=C.coveringZoomLevel({tileSize:J.tileSize,roundZoom:J.roundZoom}),ne=!y||Math.abs(y.tileID.overscaledZ-Q)>Math.abs(D.tileID.overscaledZ-Q),fe=ne&&D.refreshedUponExpiration?1:M.ac(ne?Z:1-K,0,1);return D.refreshedUponExpiration&&Z>=1&&(D.refreshedUponExpiration=!1),y?{opacity:1,mix:1-fe}:{opacity:fe,mix:0}}return{opacity:1,mix:0}}const oa=new M.aO(1,0,0,1),Ga=new M.aO(0,1,0,1),cc=new M.aO(0,0,1,1),ll=new M.aO(1,0,1,1),ai=new M.aO(0,1,1,1);function an(D,y,S,I){ts(D,0,y+S/2,D.transform.width,S,I)}function lr(D,y,S,I){ts(D,y-S/2,0,S,D.transform.height,I)}function ts(D,y,S,I,C,z){const N=D.context,U=N.gl;U.enable(U.SCISSOR_TEST),U.scissor(y*D.pixelRatio,S*D.pixelRatio,I*D.pixelRatio,C*D.pixelRatio),N.clear({color:z}),U.disable(U.SCISSOR_TEST)}function Za(D,y,S){const I=D.context,C=I.gl,z=S.posMatrix,N=D.useProgram("debug"),U=zt.disabled,Z=Gt.disabled,K=D.colorModeForRenderPass(),J="$debug",Q=D.style.map.terrain&&D.style.map.terrain.getTerrainData(S);I.activeTexture.set(C.TEXTURE0);const ne=y.getTileByID(S.key).latestRawTileData,fe=Math.floor((ne&&ne.byteLength||0)/1024),de=y.getTile(S).tileSize,ge=512/Math.min(de,512)*(S.overscaledZ/D.transform.zoom)*.5;let le=S.canonical.toString();S.overscaledZ!==S.canonical.z&&(le+=` => ${S.overscaledZ}`),function(Se,De){Se.initDebugOverlayCanvas();const _e=Se.debugOverlayCanvas,Ce=Se.context.gl,ke=Se.debugOverlayCanvas.getContext("2d");ke.clearRect(0,0,_e.width,_e.height),ke.shadowColor="white",ke.shadowBlur=2,ke.lineWidth=1.5,ke.strokeStyle="white",ke.textBaseline="top",ke.font="bold 36px Open Sans, sans-serif",ke.fillText(De,5,5),ke.strokeText(De,5,5),Se.debugOverlayTexture.update(_e),Se.debugOverlayTexture.bind(Ce.LINEAR,Ce.CLAMP_TO_EDGE)}(D,`${le} ${fe}kB`),N.draw(I,C.TRIANGLES,U,Z,ci.alphaBlended,jt.disabled,Ws(z,M.aO.transparent,ge),null,J,D.debugBuffer,D.quadTriangleIndexBuffer,D.debugSegments),N.draw(I,C.LINE_STRIP,U,Z,K,jt.disabled,Ws(z,M.aO.red),Q,J,D.debugBuffer,D.tileBorderIndexBuffer,D.debugSegments)}function Wa(D,y,S){const I=D.context,C=I.gl,z=D.colorModeForRenderPass(),N=new zt(C.LEQUAL,zt.ReadWrite,D.depthRangeFor3D),U=D.useProgram("terrain"),Z=y.getTerrainMesh();I.bindFramebuffer.set(null),I.viewport.set([0,0,D.width,D.height]);for(const K of S){const J=D.renderToTexture.getTexture(K),Q=y.getTerrainData(K.tileID);I.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,J.texture);const ne={u_matrix:D.transform.calculatePosMatrix(K.tileID.toUnwrapped()),u_texture:0,u_ele_delta:y.getMeshFrameDelta(D.transform.zoom)};U.draw(I,C.TRIANGLES,N,Gt.disabled,z,jt.backCCW,ne,Q,"terrain",Z.vertexBuffer,Z.indexBuffer,Z.segments)}}class is{constructor(y,S){this.context=new il(y),this.transform=S,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:M.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=We.maxUnderzooming+We.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new si}resize(y,S,I){if(this.width=Math.floor(y*I),this.height=Math.floor(S*I),this.pixelRatio=I,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const C of this.style._order)this.style._layers[C].resize()}setup(){const y=this.context,S=new M.aV;S.emplaceBack(0,0),S.emplaceBack(M.W,0),S.emplaceBack(0,M.W),S.emplaceBack(M.W,M.W),this.tileExtentBuffer=y.createVertexBuffer(S,zr.members),this.tileExtentSegments=M.$.simpleSegment(0,0,4,2);const I=new M.aV;I.emplaceBack(0,0),I.emplaceBack(M.W,0),I.emplaceBack(0,M.W),I.emplaceBack(M.W,M.W),this.debugBuffer=y.createVertexBuffer(I,zr.members),this.debugSegments=M.$.simpleSegment(0,0,4,5);const C=new M.Z;C.emplaceBack(0,0,0,0),C.emplaceBack(M.W,0,M.W,0),C.emplaceBack(0,M.W,0,M.W),C.emplaceBack(M.W,M.W,M.W,M.W),this.rasterBoundsBuffer=y.createVertexBuffer(C,Ti.members),this.rasterBoundsSegments=M.$.simpleSegment(0,0,4,2);const z=new M.aV;z.emplaceBack(0,0),z.emplaceBack(1,0),z.emplaceBack(0,1),z.emplaceBack(1,1),this.viewportBuffer=y.createVertexBuffer(z,zr.members),this.viewportSegments=M.$.simpleSegment(0,0,4,2);const N=new M.aW;N.emplaceBack(0),N.emplaceBack(1),N.emplaceBack(3),N.emplaceBack(2),N.emplaceBack(0),this.tileBorderIndexBuffer=y.createIndexBuffer(N);const U=new M.aX;U.emplaceBack(0,1,2),U.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=y.createIndexBuffer(U);const Z=this.context.gl;this.stencilClearMode=new Gt({func:Z.ALWAYS,mask:0},0,255,Z.ZERO,Z.ZERO,Z.ZERO)}clearStencil(){const y=this.context,S=y.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const I=M.F();M.aN(I,0,this.width,this.height,0,0,1),M.J(I,I,[S.drawingBufferWidth,S.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(y,S.TRIANGLES,zt.disabled,this.stencilClearMode,ci.disabled,jt.disabled,ka(I),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(y,S){if(this.currentStencilSource===y.source||!y.isTileClipped()||!S||!S.length)return;this.currentStencilSource=y.source;const I=this.context,C=I.gl;this.nextStencilID+S.length>256&&this.clearStencil(),I.setColorMode(ci.disabled),I.setDepthMode(zt.disabled);const z=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const N of S){const U=this._tileClippingMaskIDs[N.key]=this.nextStencilID++,Z=this.style.map.terrain&&this.style.map.terrain.getTerrainData(N);z.draw(I,C.TRIANGLES,zt.disabled,new Gt({func:C.ALWAYS,mask:0},U,255,C.KEEP,C.KEEP,C.REPLACE),ci.disabled,jt.disabled,ka(N.posMatrix),Z,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const y=this.nextStencilID++,S=this.context.gl;return new Gt({func:S.NOTEQUAL,mask:255},y,255,S.KEEP,S.KEEP,S.REPLACE)}stencilModeForClipping(y){const S=this.context.gl;return new Gt({func:S.EQUAL,mask:255},this._tileClippingMaskIDs[y.key],0,S.KEEP,S.KEEP,S.REPLACE)}stencilConfigForOverlap(y){const S=this.context.gl,I=y.sort((N,U)=>U.overscaledZ-N.overscaledZ),C=I[I.length-1].overscaledZ,z=I[0].overscaledZ-C+1;if(z>1){this.currentStencilSource=void 0,this.nextStencilID+z>256&&this.clearStencil();const N={};for(let U=0;U<z;U++)N[U+C]=new Gt({func:S.GEQUAL,mask:255},U+this.nextStencilID,255,S.KEEP,S.KEEP,S.REPLACE);return this.nextStencilID+=z,[N,I]}return[{[C]:Gt.disabled},I]}colorModeForRenderPass(){const y=this.context.gl;return this._showOverdrawInspector?new ci([y.CONSTANT_COLOR,y.ONE],new M.aO(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?ci.unblended:ci.alphaBlended}depthModeForSublayer(y,S,I){if(!this.opaquePassEnabledForLayer())return zt.disabled;const C=1-((1+this.currentLayer)*this.numSublayers+y)*this.depthEpsilon;return new zt(I||this.context.gl.LEQUAL,S,[C,C])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(y,S){this.style=y,this.options=S,this.lineAtlas=y.lineAtlas,this.imageManager=y.imageManager,this.glyphManager=y.glyphManager,this.symbolFadeChange=y.placement.symbolFadeChange(we.now()),this.imageManager.beginFrame();const I=this.style._order,C=this.style.sourceCaches,z={},N={},U={};for(const Z in C){const K=C[Z];K.used&&K.prepare(this.context),z[Z]=K.getVisibleCoordinates(),N[Z]=z[Z].slice().reverse(),U[Z]=K.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let Z=0;Z<I.length;Z++)if(this.style._layers[I[Z]].is3D()){this.opaquePassCutoff=Z;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const Z of I){const K=this.style._layers[Z];if(!K.hasOffscreenPass()||K.isHidden(this.transform.zoom))continue;const J=N[K.source];(K.type==="custom"||J.length)&&this.renderLayer(this,C[K.source],K,J)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:S.showOverdrawInspector?M.aO.black:M.aO.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=S.showOverdrawInspector,this.depthRangeFor3D=[0,1-(y._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=I.length-1;this.currentLayer>=0;this.currentLayer--){const Z=this.style._layers[I[this.currentLayer]],K=C[Z.source],J=z[Z.source];this._renderTileClippingMasks(Z,J),this.renderLayer(this,K,Z,J)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<I.length;this.currentLayer++){const Z=this.style._layers[I[this.currentLayer]],K=C[Z.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(Z))continue;const J=(Z.type==="symbol"?U:N)[Z.source];this._renderTileClippingMasks(Z,z[Z.source]),this.renderLayer(this,K,Z,J)}if(this.options.showTileBoundaries){const Z=function(K,J){let Q=null;const ne=Object.values(K._layers).flatMap(le=>le.source&&!le.isHidden(J)?[K.sourceCaches[le.source]]:[]),fe=ne.filter(le=>le.getSource().type==="vector"),de=ne.filter(le=>le.getSource().type!=="vector"),ge=le=>{(!Q||Q.getSource().maxzoom<le.getSource().maxzoom)&&(Q=le)};return fe.forEach(le=>ge(le)),Q||de.forEach(le=>ge(le)),Q}(this.style,this.transform.zoom);Z&&function(K,J,Q){for(let ne=0;ne<Q.length;ne++)Za(K,J,Q[ne])}(this,Z,Z.getVisibleCoordinates())}this.options.showPadding&&function(Z){const K=Z.transform.padding;an(Z,Z.transform.height-(K.top||0),3,oa),an(Z,K.bottom||0,3,Ga),lr(Z,K.left||0,3,cc),lr(Z,Z.transform.width-(K.right||0),3,ll);const J=Z.transform.centerPoint;(function(Q,ne,fe,de){ts(Q,ne-1,fe-10,2,20,de),ts(Q,ne-10,fe-1,20,2,de)})(Z,J.x,Z.transform.height-J.y,ai)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(y){if(!this.style||!this.style.map||!this.style.map.terrain)return;const S=this.terrainFacilitator.matrix,I=this.transform.projMatrix;let C=this.terrainFacilitator.dirty;C||(C=y?!M.aY(S,I):!M.aZ(S,I)),C||(C=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),C&&(M.a_(S,I),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(z,N){const U=z.context,Z=U.gl,K=ci.unblended,J=new zt(Z.LEQUAL,zt.ReadWrite,[0,1]),Q=N.getTerrainMesh(),ne=N.sourceCache.getRenderableTiles(),fe=z.useProgram("terrainDepth");U.bindFramebuffer.set(N.getFramebuffer("depth").framebuffer),U.viewport.set([0,0,z.width/devicePixelRatio,z.height/devicePixelRatio]),U.clear({color:M.aO.transparent,depth:1});for(const de of ne){const ge=N.getTerrainData(de.tileID),le={u_matrix:z.transform.calculatePosMatrix(de.tileID.toUnwrapped()),u_ele_delta:N.getMeshFrameDelta(z.transform.zoom)};fe.draw(U,Z.TRIANGLES,J,Gt.disabled,K,jt.backCCW,le,ge,"terrain",Q.vertexBuffer,Q.indexBuffer,Q.segments)}U.bindFramebuffer.set(null),U.viewport.set([0,0,z.width,z.height])}(this,this.style.map.terrain),function(z,N){const U=z.context,Z=U.gl,K=ci.unblended,J=new zt(Z.LEQUAL,zt.ReadWrite,[0,1]),Q=N.getTerrainMesh(),ne=N.getCoordsTexture(),fe=N.sourceCache.getRenderableTiles(),de=z.useProgram("terrainCoords");U.bindFramebuffer.set(N.getFramebuffer("coords").framebuffer),U.viewport.set([0,0,z.width/devicePixelRatio,z.height/devicePixelRatio]),U.clear({color:M.aO.transparent,depth:1}),N.coordsIndex=[];for(const ge of fe){const le=N.getTerrainData(ge.tileID);U.activeTexture.set(Z.TEXTURE0),Z.bindTexture(Z.TEXTURE_2D,ne.texture);const Se={u_matrix:z.transform.calculatePosMatrix(ge.tileID.toUnwrapped()),u_terrain_coords_id:(255-N.coordsIndex.length)/255,u_texture:0,u_ele_delta:N.getMeshFrameDelta(z.transform.zoom)};de.draw(U,Z.TRIANGLES,J,Gt.disabled,K,jt.backCCW,Se,le,"terrain",Q.vertexBuffer,Q.indexBuffer,Q.segments),N.coordsIndex.push(ge.tileID.key)}U.bindFramebuffer.set(null),U.viewport.set([0,0,z.width,z.height])}(this,this.style.map.terrain))}renderLayer(y,S,I,C){if(!I.isHidden(this.transform.zoom)&&(I.type==="background"||I.type==="custom"||(C||[]).length))switch(this.id=I.id,I.type){case"symbol":(function(z,N,U,Z,K){if(z.renderPass!=="translucent")return;const J=Gt.disabled,Q=z.colorModeForRenderPass();(U._unevaluatedLayout.hasValue("text-variable-anchor")||U._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(ne,fe,de,ge,le,Se,De){const _e=fe.transform,Ce=le==="map",ke=Se==="map";for(const ze of ne){const Be=ge.getTile(ze),He=Be.getBucket(de);if(!He||!He.text||!He.text.segments.get().length)continue;const Ve=M.ag(He.textSizeData,_e.zoom),je=xt(Be,1,fe.transform.zoom),nt=nn(ze.posMatrix,ke,Ce,fe.transform,je),vt=de.layout.get("icon-text-fit")!=="none"&&He.hasIconData();if(Ve){const Je=Math.pow(2,_e.zoom-Be.tileID.overscaledZ);sa(He,Ce,ke,De,_e,nt,ze.posMatrix,Je,Ve,vt,fe.style.map.terrain?(mt,Et)=>fe.style.map.terrain.getElevation(ze,mt,Et):null)}}}(Z,z,U,N,U.layout.get("text-rotation-alignment"),U.layout.get("text-pitch-alignment"),K),U.paint.get("icon-opacity").constantOr(1)!==0&&nl(z,N,U,Z,!1,U.paint.get("icon-translate"),U.paint.get("icon-translate-anchor"),U.layout.get("icon-rotation-alignment"),U.layout.get("icon-pitch-alignment"),U.layout.get("icon-keep-upright"),J,Q),U.paint.get("text-opacity").constantOr(1)!==0&&nl(z,N,U,Z,!0,U.paint.get("text-translate"),U.paint.get("text-translate-anchor"),U.layout.get("text-rotation-alignment"),U.layout.get("text-pitch-alignment"),U.layout.get("text-keep-upright"),J,Q),N.map.showCollisionBoxes&&(ra(z,N,U,Z,U.paint.get("text-translate"),U.paint.get("text-translate-anchor"),!0),ra(z,N,U,Z,U.paint.get("icon-translate"),U.paint.get("icon-translate-anchor"),!1))})(y,S,I,C,this.style.placement.variableOffsets);break;case"circle":(function(z,N,U,Z){if(z.renderPass!=="translucent")return;const K=U.paint.get("circle-opacity"),J=U.paint.get("circle-stroke-width"),Q=U.paint.get("circle-stroke-opacity"),ne=!U.layout.get("circle-sort-key").isConstant();if(K.constantOr(1)===0&&(J.constantOr(1)===0||Q.constantOr(1)===0))return;const fe=z.context,de=fe.gl,ge=z.depthModeForSublayer(0,zt.ReadOnly),le=Gt.disabled,Se=z.colorModeForRenderPass(),De=[];for(let _e=0;_e<Z.length;_e++){const Ce=Z[_e],ke=N.getTile(Ce),ze=ke.getBucket(U);if(!ze)continue;const Be=ze.programConfigurations.get(U.id),He=z.useProgram("circle",Be),Ve=ze.layoutVertexBuffer,je=ze.indexBuffer,nt=z.style.map.terrain&&z.style.map.terrain.getTerrainData(Ce),vt={programConfiguration:Be,program:He,layoutVertexBuffer:Ve,indexBuffer:je,uniformValues:Ho(z,Ce,ke,U),terrainData:nt};if(ne){const Je=ze.segments.get();for(const mt of Je)De.push({segments:new M.$([mt]),sortKey:mt.sortKey,state:vt})}else De.push({segments:ze.segments,sortKey:0,state:vt})}ne&&De.sort((_e,Ce)=>_e.sortKey-Ce.sortKey);for(const _e of De){const{programConfiguration:Ce,program:ke,layoutVertexBuffer:ze,indexBuffer:Be,uniformValues:He,terrainData:Ve}=_e.state;ke.draw(fe,de.TRIANGLES,ge,le,Se,jt.disabled,He,Ve,U.id,ze,Be,_e.segments,U.paint,z.transform.zoom,Ce)}})(y,S,I,C);break;case"heatmap":(function(z,N,U,Z){if(U.paint.get("heatmap-opacity")!==0)if(z.renderPass==="offscreen"){const K=z.context,J=K.gl,Q=Gt.disabled,ne=new ci([J.ONE,J.ONE],M.aO.transparent,[!0,!0,!0,!0]);(function(fe,de,ge){const le=fe.gl;fe.activeTexture.set(le.TEXTURE1),fe.viewport.set([0,0,de.width/4,de.height/4]);let Se=ge.heatmapFbo;if(Se)le.bindTexture(le.TEXTURE_2D,Se.colorAttachment.get()),fe.bindFramebuffer.set(Se.framebuffer);else{const De=le.createTexture();le.bindTexture(le.TEXTURE_2D,De),le.texParameteri(le.TEXTURE_2D,le.TEXTURE_WRAP_S,le.CLAMP_TO_EDGE),le.texParameteri(le.TEXTURE_2D,le.TEXTURE_WRAP_T,le.CLAMP_TO_EDGE),le.texParameteri(le.TEXTURE_2D,le.TEXTURE_MIN_FILTER,le.LINEAR),le.texParameteri(le.TEXTURE_2D,le.TEXTURE_MAG_FILTER,le.LINEAR),Se=ge.heatmapFbo=fe.createFramebuffer(de.width/4,de.height/4,!1,!1),function(_e,Ce,ke,ze){var Be,He;const Ve=_e.gl,je=(Be=_e.HALF_FLOAT)!==null&&Be!==void 0?Be:Ve.UNSIGNED_BYTE,nt=(He=_e.RGBA16F)!==null&&He!==void 0?He:Ve.RGBA;Ve.texImage2D(Ve.TEXTURE_2D,0,nt,Ce.width/4,Ce.height/4,0,Ve.RGBA,je,null),ze.colorAttachment.set(ke)}(fe,de,De,Se)}})(K,z,U),K.clear({color:M.aO.transparent});for(let fe=0;fe<Z.length;fe++){const de=Z[fe];if(N.hasRenderableParent(de))continue;const ge=N.getTile(de),le=ge.getBucket(U);if(!le)continue;const Se=le.programConfigurations.get(U.id),De=z.useProgram("heatmap",Se),{zoom:_e}=z.transform;De.draw(K,J.TRIANGLES,zt.disabled,Q,ne,jt.disabled,Go(de.posMatrix,ge,_e,U.paint.get("heatmap-intensity")),null,U.id,le.layoutVertexBuffer,le.indexBuffer,le.segments,U.paint,z.transform.zoom,Se)}K.viewport.set([0,0,z.width,z.height])}else z.renderPass==="translucent"&&(z.context.setColorMode(z.colorModeForRenderPass()),function(K,J){const Q=K.context,ne=Q.gl,fe=J.heatmapFbo;if(!fe)return;Q.activeTexture.set(ne.TEXTURE0),ne.bindTexture(ne.TEXTURE_2D,fe.colorAttachment.get()),Q.activeTexture.set(ne.TEXTURE1);let de=J.colorRampTexture;de||(de=J.colorRampTexture=new ni(Q,J.colorRamp,ne.RGBA)),de.bind(ne.LINEAR,ne.CLAMP_TO_EDGE),K.useProgram("heatmapTexture").draw(Q,ne.TRIANGLES,zt.disabled,Gt.disabled,K.colorModeForRenderPass(),jt.disabled,((ge,le,Se,De)=>{const _e=M.F();M.aN(_e,0,ge.width,ge.height,0,0,1);const Ce=ge.context.gl;return{u_matrix:_e,u_world:[Ce.drawingBufferWidth,Ce.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:le.paint.get("heatmap-opacity")}})(K,J),null,J.id,K.viewportBuffer,K.quadTriangleIndexBuffer,K.viewportSegments,J.paint,K.transform.zoom)}(z,U))})(y,S,I,C);break;case"line":(function(z,N,U,Z){if(z.renderPass!=="translucent")return;const K=U.paint.get("line-opacity"),J=U.paint.get("line-width");if(K.constantOr(1)===0||J.constantOr(1)===0)return;const Q=z.depthModeForSublayer(0,zt.ReadOnly),ne=z.colorModeForRenderPass(),fe=U.paint.get("line-dasharray"),de=U.paint.get("line-pattern"),ge=de.constantOr(1),le=U.paint.get("line-gradient"),Se=U.getCrossfadeParameters(),De=ge?"linePattern":fe?"lineSDF":le?"lineGradient":"line",_e=z.context,Ce=_e.gl;let ke=!0;for(const ze of Z){const Be=N.getTile(ze);if(ge&&!Be.patternsLoaded())continue;const He=Be.getBucket(U);if(!He)continue;const Ve=He.programConfigurations.get(U.id),je=z.context.program.get(),nt=z.useProgram(De,Ve),vt=ke||nt.program!==je,Je=z.style.map.terrain&&z.style.map.terrain.getTerrainData(ze),mt=de.constantOr(null);if(mt&&Be.imageAtlas){const _t=Be.imageAtlas,At=_t.patternPositions[mt.to.toString()],It=_t.patternPositions[mt.from.toString()];At&&It&&Ve.setConstantPatternPositions(At,It)}const Et=Je?ze:null,Mt=ge?Xs(z,Be,U,Se,Et):fe?gr(z,Be,U,fe,Se,Et):le?wn(z,Be,U,He.lineClipsArray.length,Et):Ks(z,Be,U,Et);if(ge)_e.activeTexture.set(Ce.TEXTURE0),Be.imageAtlasTexture.bind(Ce.LINEAR,Ce.CLAMP_TO_EDGE),Ve.updatePaintBuffers(Se);else if(fe&&(vt||z.lineAtlas.dirty))_e.activeTexture.set(Ce.TEXTURE0),z.lineAtlas.bind(_e);else if(le){const _t=He.gradients[U.id];let At=_t.texture;if(U.gradientVersion!==_t.version){let It=256;if(U.stepInterpolant){const ei=N.getSource().maxzoom,Ht=ze.canonical.z===ei?Math.ceil(1<<z.transform.maxZoom-ze.canonical.z):1;It=M.ac(M.aT(He.maxLineLength/M.W*1024*Ht),256,_e.maxTextureSize)}_t.gradient=M.aU({expression:U.gradientExpression(),evaluationKey:"lineProgress",resolution:It,image:_t.gradient||void 0,clips:He.lineClipsArray}),_t.texture?_t.texture.update(_t.gradient):_t.texture=new ni(_e,_t.gradient,Ce.RGBA),_t.version=U.gradientVersion,At=_t.texture}_e.activeTexture.set(Ce.TEXTURE0),At.bind(U.stepInterpolant?Ce.NEAREST:Ce.LINEAR,Ce.CLAMP_TO_EDGE)}nt.draw(_e,Ce.TRIANGLES,Q,z.stencilModeForClipping(ze),ne,jt.disabled,Mt,Je,U.id,He.layoutVertexBuffer,He.indexBuffer,He.segments,U.paint,z.transform.zoom,Ve,He.layoutVertexBuffer2),ke=!1}})(y,S,I,C);break;case"fill":(function(z,N,U,Z){const K=U.paint.get("fill-color"),J=U.paint.get("fill-opacity");if(J.constantOr(1)===0)return;const Q=z.colorModeForRenderPass(),ne=U.paint.get("fill-pattern"),fe=z.opaquePassEnabledForLayer()&&!ne.constantOr(1)&&K.constantOr(M.aO.transparent).a===1&&J.constantOr(0)===1?"opaque":"translucent";if(z.renderPass===fe){const de=z.depthModeForSublayer(1,z.renderPass==="opaque"?zt.ReadWrite:zt.ReadOnly);ja(z,N,U,Z,de,Q,!1)}if(z.renderPass==="translucent"&&U.paint.get("fill-antialias")){const de=z.depthModeForSublayer(U.getPaintProperty("fill-outline-color")?2:0,zt.ReadOnly);ja(z,N,U,Z,de,Q,!0)}})(y,S,I,C);break;case"fill-extrusion":(function(z,N,U,Z){const K=U.paint.get("fill-extrusion-opacity");if(K!==0&&z.renderPass==="translucent"){const J=new zt(z.context.gl.LEQUAL,zt.ReadWrite,z.depthRangeFor3D);if(K!==1||U.paint.get("fill-extrusion-pattern").constantOr(1))es(z,N,U,Z,J,Gt.disabled,ci.disabled),es(z,N,U,Z,J,z.stencilModeFor3D(),z.colorModeForRenderPass());else{const Q=z.colorModeForRenderPass();es(z,N,U,Z,J,Gt.disabled,Q)}}})(y,S,I,C);break;case"hillshade":(function(z,N,U,Z){if(z.renderPass!=="offscreen"&&z.renderPass!=="translucent")return;const K=z.context,J=z.depthModeForSublayer(0,zt.ReadOnly),Q=z.colorModeForRenderPass(),[ne,fe]=z.renderPass==="translucent"?z.stencilConfigForOverlap(Z):[{},Z];for(const de of fe){const ge=N.getTile(de);ge.needsHillshadePrepare!==void 0&&ge.needsHillshadePrepare&&z.renderPass==="offscreen"?al(z,ge,U,J,Gt.disabled,Q):z.renderPass==="translucent"&&Ha(z,de,ge,U,J,ne[de.overscaledZ],Q)}K.viewport.set([0,0,z.width,z.height])})(y,S,I,C);break;case"raster":(function(z,N,U,Z){if(z.renderPass!=="translucent"||U.paint.get("raster-opacity")===0||!Z.length)return;const K=z.context,J=K.gl,Q=N.getSource(),ne=z.useProgram("raster"),fe=z.colorModeForRenderPass(),[de,ge]=Q instanceof kr?[{},Z]:z.stencilConfigForOverlap(Z),le=ge[ge.length-1].overscaledZ,Se=!z.options.moving;for(const De of ge){const _e=z.depthModeForSublayer(De.overscaledZ-le,U.paint.get("raster-opacity")===1?zt.ReadWrite:zt.ReadOnly,J.LESS),Ce=N.getTile(De);Ce.registerFadeDuration(U.paint.get("raster-fade-duration"));const ke=N.findLoadedParent(De,0),ze=ol(Ce,ke,N,U,z.transform,z.style.map.terrain);let Be,He;const Ve=U.paint.get("raster-resampling")==="nearest"?J.NEAREST:J.LINEAR;K.activeTexture.set(J.TEXTURE0),Ce.texture.bind(Ve,J.CLAMP_TO_EDGE,J.LINEAR_MIPMAP_NEAREST),K.activeTexture.set(J.TEXTURE1),ke?(ke.texture.bind(Ve,J.CLAMP_TO_EDGE,J.LINEAR_MIPMAP_NEAREST),Be=Math.pow(2,ke.tileID.overscaledZ-Ce.tileID.overscaledZ),He=[Ce.tileID.canonical.x*Be%1,Ce.tileID.canonical.y*Be%1]):Ce.texture.bind(Ve,J.CLAMP_TO_EDGE,J.LINEAR_MIPMAP_NEAREST);const je=z.style.map.terrain&&z.style.map.terrain.getTerrainData(De),nt=je?De:null,vt=nt?nt.posMatrix:z.transform.calculatePosMatrix(De.toUnwrapped(),Se),Je=Ts(vt,He||[0,0],Be||1,ze,U);Q instanceof kr?ne.draw(K,J.TRIANGLES,_e,Gt.disabled,fe,jt.disabled,Je,je,U.id,Q.boundsBuffer,z.quadTriangleIndexBuffer,Q.boundsSegments):ne.draw(K,J.TRIANGLES,_e,de[De.overscaledZ],fe,jt.disabled,Je,je,U.id,z.rasterBoundsBuffer,z.quadTriangleIndexBuffer,z.rasterBoundsSegments)}})(y,S,I,C);break;case"background":(function(z,N,U,Z){const K=U.paint.get("background-color"),J=U.paint.get("background-opacity");if(J===0)return;const Q=z.context,ne=Q.gl,fe=z.transform,de=fe.tileSize,ge=U.paint.get("background-pattern");if(z.isPatternMissing(ge))return;const le=!ge&&K.a===1&&J===1&&z.opaquePassEnabledForLayer()?"opaque":"translucent";if(z.renderPass!==le)return;const Se=Gt.disabled,De=z.depthModeForSublayer(0,le==="opaque"?zt.ReadWrite:zt.ReadOnly),_e=z.colorModeForRenderPass(),Ce=z.useProgram(ge?"backgroundPattern":"background"),ke=Z||fe.coveringTiles({tileSize:de,terrain:z.style.map.terrain});ge&&(Q.activeTexture.set(ne.TEXTURE0),z.imageManager.bind(z.context));const ze=U.getCrossfadeParameters();for(const Be of ke){const He=Z?Be.posMatrix:z.transform.calculatePosMatrix(Be.toUnwrapped()),Ve=ge?Wo(He,J,z,ge,{tileID:Be,tileSize:de},ze):Ql(He,J,K),je=z.style.map.terrain&&z.style.map.terrain.getTerrainData(Be);Ce.draw(Q,ne.TRIANGLES,De,Se,_e,jt.disabled,Ve,je,U.id,z.tileExtentBuffer,z.quadTriangleIndexBuffer,z.tileExtentSegments)}})(y,0,I,C);break;case"custom":(function(z,N,U){const Z=z.context,K=U.implementation;if(z.renderPass==="offscreen"){const J=K.prerender;J&&(z.setCustomLayerDefaults(),Z.setColorMode(z.colorModeForRenderPass()),J.call(K,Z.gl,z.transform.customLayerMatrix()),Z.setDirty(),z.setBaseState())}else if(z.renderPass==="translucent"){z.setCustomLayerDefaults(),Z.setColorMode(z.colorModeForRenderPass()),Z.setStencilMode(Gt.disabled);const J=K.renderingMode==="3d"?new zt(z.context.gl.LEQUAL,zt.ReadWrite,z.depthRangeFor3D):z.depthModeForSublayer(0,zt.ReadOnly);Z.setDepthMode(J),K.render(Z.gl,z.transform.customLayerMatrix()),Z.setDirty(),z.setBaseState(),Z.bindFramebuffer.set(null)}})(y,0,I)}}translatePosMatrix(y,S,I,C,z){if(!I[0]&&!I[1])return y;const N=z?C==="map"?this.transform.angle:0:C==="viewport"?-this.transform.angle:0;if(N){const K=Math.sin(N),J=Math.cos(N);I=[I[0]*J-I[1]*K,I[0]*K+I[1]*J]}const U=[z?I[0]:xt(S,I[0],this.transform.zoom),z?I[1]:xt(S,I[1],this.transform.zoom),0],Z=new Float32Array(16);return M.H(Z,y,U),Z}saveTileTexture(y){const S=this._tileTextures[y.size[0]];S?S.push(y):this._tileTextures[y.size[0]]=[y]}getTileTexture(y){const S=this._tileTextures[y];return S&&S.length>0?S.pop():null}isPatternMissing(y){if(!y)return!1;if(!y.from||!y.to)return!0;const S=this.imageManager.getPattern(y.from.toString()),I=this.imageManager.getPattern(y.to.toString());return!S||!I}useProgram(y,S){this.cache=this.cache||{};const I=y+(S?S.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[I]||(this.cache[I]=new Da(this.context,Hn[y],S,ec[y],this._showOverdrawInspector,this.style.map.terrain)),this.cache[I]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const y=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(y.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new ni(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:y,drawingBufferHeight:S}=this.context.gl;return this.width!==y||this.height!==S}}class Tn{constructor(y,S){this.points=y,this.planes=S}static fromInvProjectionMatrix(y,S,I){const C=Math.pow(2,I),z=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(U=>{const Z=1/(U=M.af([],U,y))[3]/S*C;return M.a$(U,U,[Z,Z,1/U[3],Z])}),N=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(U=>{const Z=function(ne,fe){var de=fe[0],ge=fe[1],le=fe[2],Se=de*de+ge*ge+le*le;return Se>0&&(Se=1/Math.sqrt(Se)),ne[0]=fe[0]*Se,ne[1]=fe[1]*Se,ne[2]=fe[2]*Se,ne}([],function(ne,fe,de){var ge=fe[0],le=fe[1],Se=fe[2],De=de[0],_e=de[1],Ce=de[2];return ne[0]=le*Ce-Se*_e,ne[1]=Se*De-ge*Ce,ne[2]=ge*_e-le*De,ne}([],Yr([],z[U[0]],z[U[1]]),Yr([],z[U[2]],z[U[1]]))),K=-((J=Z)[0]*(Q=z[U[1]])[0]+J[1]*Q[1]+J[2]*Q[2]);var J,Q;return Z.concat(K)});return new Tn(z,N)}}class rs{constructor(y,S){this.min=y,this.max=S,this.center=function(I,C,z){return I[0]=.5*C[0],I[1]=.5*C[1],I[2]=.5*C[2],I}([],function(I,C,z){return I[0]=C[0]+z[0],I[1]=C[1]+z[1],I[2]=C[2]+z[2],I}([],this.min,this.max))}quadrant(y){const S=[y%2==0,y<2],I=Pi(this.min),C=Pi(this.max);for(let z=0;z<S.length;z++)I[z]=S[z]?this.min[z]:this.center[z],C[z]=S[z]?this.center[z]:this.max[z];return C[2]=this.max[2],new rs(I,C)}distanceX(y){return Math.max(Math.min(this.max[0],y[0]),this.min[0])-y[0]}distanceY(y){return Math.max(Math.min(this.max[1],y[1]),this.min[1])-y[1]}intersects(y){const S=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let I=!0;for(let C=0;C<y.planes.length;C++){const z=y.planes[C];let N=0;for(let U=0;U<S.length;U++)M.b0(z,S[U])>=0&&N++;if(N===0)return 0;N!==S.length&&(I=!1)}if(I)return 2;for(let C=0;C<3;C++){let z=Number.MAX_VALUE,N=-Number.MAX_VALUE;for(let U=0;U<y.points.length;U++){const Z=y.points[U][C]-this.min[C];z=Math.min(z,Z),N=Math.max(N,Z)}if(N<0||z>this.max[C]-this.min[C])return 0}return 1}}class Ps{constructor(y=0,S=0,I=0,C=0){if(isNaN(y)||y<0||isNaN(S)||S<0||isNaN(I)||I<0||isNaN(C)||C<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=y,this.bottom=S,this.left=I,this.right=C}interpolate(y,S,I){return S.top!=null&&y.top!=null&&(this.top=M.z.number(y.top,S.top,I)),S.bottom!=null&&y.bottom!=null&&(this.bottom=M.z.number(y.bottom,S.bottom,I)),S.left!=null&&y.left!=null&&(this.left=M.z.number(y.left,S.left,I)),S.right!=null&&y.right!=null&&(this.right=M.z.number(y.right,S.right,I)),this}getCenter(y,S){const I=M.ac((this.left+y-this.right)/2,0,y),C=M.ac((this.top+S-this.bottom)/2,0,S);return new M.P(I,C)}equals(y){return this.top===y.top&&this.bottom===y.bottom&&this.left===y.left&&this.right===y.right}clone(){return new Ps(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Ka=85.051129;class la{constructor(y,S,I,C,z){this.tileSize=512,this._renderWorldCopies=z===void 0||!!z,this._minZoom=y||0,this._maxZoom=S||22,this._minPitch=I??0,this._maxPitch=C??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new M.M(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Ps,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const y=new la(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return y.apply(this),y}apply(y){this.tileSize=y.tileSize,this.latRange=y.latRange,this.width=y.width,this.height=y.height,this._center=y._center,this._elevation=y._elevation,this.minElevationForCurrentTile=y.minElevationForCurrentTile,this.zoom=y.zoom,this.angle=y.angle,this._fov=y._fov,this._pitch=y._pitch,this._unmodified=y._unmodified,this._edgeInsets=y._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(y){this._minZoom!==y&&(this._minZoom=y,this.zoom=Math.max(this.zoom,y))}get maxZoom(){return this._maxZoom}set maxZoom(y){this._maxZoom!==y&&(this._maxZoom=y,this.zoom=Math.min(this.zoom,y))}get minPitch(){return this._minPitch}set minPitch(y){this._minPitch!==y&&(this._minPitch=y,this.pitch=Math.max(this.pitch,y))}get maxPitch(){return this._maxPitch}set maxPitch(y){this._maxPitch!==y&&(this._maxPitch=y,this.pitch=Math.min(this.pitch,y))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(y){y===void 0?y=!0:y===null&&(y=!1),this._renderWorldCopies=y}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new M.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(y){const S=-M.b1(y,-180,180)*Math.PI/180;this.angle!==S&&(this._unmodified=!1,this.angle=S,this._calcMatrices(),this.rotationMatrix=function(){var I=new M.A(4);return M.A!=Float32Array&&(I[1]=0,I[2]=0),I[0]=1,I[3]=1,I}(),function(I,C,z){var N=C[0],U=C[1],Z=C[2],K=C[3],J=Math.sin(z),Q=Math.cos(z);I[0]=N*Q+Z*J,I[1]=U*Q+K*J,I[2]=N*-J+Z*Q,I[3]=U*-J+K*Q}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(y){const S=M.ac(y,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==S&&(this._unmodified=!1,this._pitch=S,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(y){y=Math.max(.01,Math.min(60,y)),this._fov!==y&&(this._unmodified=!1,this._fov=y/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(y){const S=Math.min(Math.max(y,this.minZoom),this.maxZoom);this._zoom!==S&&(this._unmodified=!1,this._zoom=S,this.tileZoom=Math.max(0,Math.floor(S)),this.scale=this.zoomScale(S),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(y){y.lat===this._center.lat&&y.lng===this._center.lng||(this._unmodified=!1,this._center=y,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(y){y!==this._elevation&&(this._elevation=y,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(y){this._edgeInsets.equals(y)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,y,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(y){return this._edgeInsets.equals(y)}interpolatePadding(y,S,I){this._unmodified=!1,this._edgeInsets.interpolate(y,S,I),this._constrain(),this._calcMatrices()}coveringZoomLevel(y){const S=(y.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/y.tileSize));return Math.max(0,S)}getVisibleUnwrappedCoordinates(y){const S=[new M.b2(0,y)];if(this._renderWorldCopies){const I=this.pointCoordinate(new M.P(0,0)),C=this.pointCoordinate(new M.P(this.width,0)),z=this.pointCoordinate(new M.P(this.width,this.height)),N=this.pointCoordinate(new M.P(0,this.height)),U=Math.floor(Math.min(I.x,C.x,z.x,N.x)),Z=Math.floor(Math.max(I.x,C.x,z.x,N.x)),K=1;for(let J=U-K;J<=Z+K;J++)J!==0&&S.push(new M.b2(J,y))}return S}coveringTiles(y){var S,I;let C=this.coveringZoomLevel(y);const z=C;if(y.minzoom!==void 0&&C<y.minzoom)return[];y.maxzoom!==void 0&&C>y.maxzoom&&(C=y.maxzoom);const N=this.pointCoordinate(this.getCameraPoint()),U=M.Y.fromLngLat(this.center),Z=Math.pow(2,C),K=[Z*N.x,Z*N.y,0],J=[Z*U.x,Z*U.y,0],Q=Tn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,C);let ne=y.minzoom||0;!y.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(ne=C);const fe=y.terrain?2/Math.min(this.tileSize,y.tileSize)*this.tileSize:3,de=_e=>({aabb:new rs([_e*Z,0,0],[(_e+1)*Z,Z,0]),zoom:0,x:0,y:0,wrap:_e,fullyVisible:!1}),ge=[],le=[],Se=C,De=y.reparseOverscaled?z:C;if(this._renderWorldCopies)for(let _e=1;_e<=3;_e++)ge.push(de(-_e)),ge.push(de(_e));for(ge.push(de(0));ge.length>0;){const _e=ge.pop(),Ce=_e.x,ke=_e.y;let ze=_e.fullyVisible;if(!ze){const nt=_e.aabb.intersects(Q);if(nt===0)continue;ze=nt===2}const Be=y.terrain?K:J,He=_e.aabb.distanceX(Be),Ve=_e.aabb.distanceY(Be),je=Math.max(Math.abs(He),Math.abs(Ve));if(_e.zoom===Se||je>fe+(1<<Se-_e.zoom)-2&&_e.zoom>=ne){const nt=Se-_e.zoom,vt=K[0]-.5-(Ce<<nt),Je=K[1]-.5-(ke<<nt);le.push({tileID:new M.Q(_e.zoom===Se?De:_e.zoom,_e.wrap,_e.zoom,Ce,ke),distanceSq:qs([J[0]-.5-Ce,J[1]-.5-ke]),tileDistanceToCamera:Math.sqrt(vt*vt+Je*Je)})}else for(let nt=0;nt<4;nt++){const vt=(Ce<<1)+nt%2,Je=(ke<<1)+(nt>>1),mt=_e.zoom+1;let Et=_e.aabb.quadrant(nt);if(y.terrain){const Mt=new M.Q(mt,_e.wrap,mt,vt,Je),_t=y.terrain.getMinMaxElevation(Mt),At=(S=_t.minElevation)!==null&&S!==void 0?S:this.elevation,It=(I=_t.maxElevation)!==null&&I!==void 0?I:this.elevation;Et=new rs([Et.min[0],Et.min[1],At],[Et.max[0],Et.max[1],It])}ge.push({aabb:Et,zoom:mt,x:vt,y:Je,wrap:_e.wrap,fullyVisible:ze})}}return le.sort((_e,Ce)=>_e.distanceSq-Ce.distanceSq).map(_e=>_e.tileID)}resize(y,S){this.width=y,this.height=S,this.pixelsToGLUnits=[2/y,-2/S],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(y){return Math.pow(2,y)}scaleZoom(y){return Math.log(y)/Math.LN2}project(y){const S=M.ac(y.lat,-85.051129,Ka);return new M.P(M.N(y.lng)*this.worldSize,M.O(S)*this.worldSize)}unproject(y){return new M.Y(y.x/this.worldSize,y.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(y){const S=this.elevation,I=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,C=this.pointLocation(this.centerPoint,y),z=y.getElevationForLngLatZoom(C,this.tileZoom);if(!(this.elevation-z))return;const N=I+S-z,U=Math.cos(this._pitch)*this.cameraToCenterDistance/N/M.b3(1,C.lat),Z=this.scaleZoom(U/this.tileSize);this._elevation=z,this._center=C,this.zoom=Z}setLocationAtPoint(y,S){const I=this.pointCoordinate(S),C=this.pointCoordinate(this.centerPoint),z=this.locationCoordinate(y),N=new M.Y(z.x-(I.x-C.x),z.y-(I.y-C.y));this.center=this.coordinateLocation(N),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(y,S){return S?this.coordinatePoint(this.locationCoordinate(y),S.getElevationForLngLatZoom(y,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(y))}pointLocation(y,S){return this.coordinateLocation(this.pointCoordinate(y,S))}locationCoordinate(y){return M.Y.fromLngLat(y)}coordinateLocation(y){return y&&y.toLngLat()}pointCoordinate(y,S){if(S){const ne=S.pointCoordinate(y);if(ne!=null)return ne}const I=[y.x,y.y,0,1],C=[y.x,y.y,1,1];M.af(I,I,this.pixelMatrixInverse),M.af(C,C,this.pixelMatrixInverse);const z=I[3],N=C[3],U=I[1]/z,Z=C[1]/N,K=I[2]/z,J=C[2]/N,Q=K===J?0:(0-K)/(J-K);return new M.Y(M.z.number(I[0]/z,C[0]/N,Q)/this.worldSize,M.z.number(U,Z,Q)/this.worldSize)}coordinatePoint(y,S=0,I=this.pixelMatrix){const C=[y.x*this.worldSize,y.y*this.worldSize,S,1];return M.af(C,C,I),new M.P(C[0]/C[3],C[1]/C[3])}getBounds(){const y=Math.max(0,this.height/2-this.getHorizon());return new mi().extend(this.pointLocation(new M.P(0,y))).extend(this.pointLocation(new M.P(this.width,y))).extend(this.pointLocation(new M.P(this.width,this.height))).extend(this.pointLocation(new M.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new mi([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(y){y?(this.lngRange=[y.getWest(),y.getEast()],this.latRange=[y.getSouth(),y.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,Ka])}calculatePosMatrix(y,S=!1){const I=y.key,C=S?this._alignedPosMatrixCache:this._posMatrixCache;if(C[I])return C[I];const z=y.canonical,N=this.worldSize/this.zoomScale(z.z),U=z.x+Math.pow(2,z.z)*y.wrap,Z=M.an(new Float64Array(16));return M.H(Z,Z,[U*N,z.y*N,0]),M.J(Z,Z,[N/M.W,N/M.W,1]),M.K(Z,S?this.alignedProjMatrix:this.projMatrix,Z),C[I]=new Float32Array(Z),C[I]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(y,S){S=M.ac(+S,this.minZoom,this.maxZoom);const I={center:new M.M(y.lng,y.lat),zoom:S};let C=this.lngRange;if(!this._renderWorldCopies&&C===null){const _e=179.9999999999;C=[-_e,_e]}const z=this.tileSize*this.zoomScale(I.zoom);let N=0,U=z,Z=0,K=z,J=0,Q=0;const{x:ne,y:fe}=this.size;if(this.latRange){const _e=this.latRange;N=M.O(_e[1])*z,U=M.O(_e[0])*z,U-N<fe&&(J=fe/(U-N))}C&&(Z=M.b1(M.N(C[0])*z,0,z),K=M.b1(M.N(C[1])*z,0,z),K<Z&&(K+=z),K-Z<ne&&(Q=ne/(K-Z)));const{x:de,y:ge}=this.project.call({worldSize:z},y);let le,Se;const De=Math.max(Q||0,J||0);if(De){const _e=new M.P(Q?(K+Z)/2:de,J?(U+N)/2:ge);return I.center=this.unproject.call({worldSize:z},_e).wrap(),I.zoom+=this.scaleZoom(De),I}if(this.latRange){const _e=fe/2;ge-_e<N&&(Se=N+_e),ge+_e>U&&(Se=U-_e)}if(C){const _e=(Z+K)/2;let Ce=de;this._renderWorldCopies&&(Ce=M.b1(de,_e-z/2,_e+z/2));const ke=ne/2;Ce-ke<Z&&(le=Z+ke),Ce+ke>K&&(le=K-ke)}if(le!==void 0||Se!==void 0){const _e=new M.P(le??de,Se??ge);I.center=this.unproject.call({worldSize:z},_e).wrap()}return I}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const y=this._unmodified,{center:S,zoom:I}=this.getConstrained(this.center,this.zoom);this.center=S,this.zoom=I,this._unmodified=y,this._constraining=!1}_calcMatrices(){if(!this.height)return;const y=this.centerOffset,S=this.point.x,I=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=M.b3(1,this.center.lat)*this.worldSize;let C=M.an(new Float64Array(16));M.J(C,C,[this.width/2,-this.height/2,1]),M.H(C,C,[1,-1,0]),this.labelPlaneMatrix=C,C=M.an(new Float64Array(16)),M.J(C,C,[1,-1,1]),M.H(C,C,[-1,-1,0]),M.J(C,C,[2/this.width,2/this.height,1]),this.glCoordMatrix=C;const z=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),N=Math.min(this.elevation,this.minElevationForCurrentTile),U=z-N*this._pixelPerMeter/Math.cos(this._pitch),Z=N<0?U:z,K=Math.PI/2+this._pitch,J=this._fov*(.5+y.y/this.height),Q=Math.sin(J)*Z/Math.sin(M.ac(Math.PI-K-J,.01,Math.PI-.01)),ne=this.getHorizon(),fe=2*Math.atan(ne/this.cameraToCenterDistance)*(.5+y.y/(2*ne)),de=Math.sin(fe)*Z/Math.sin(M.ac(Math.PI-K-fe,.01,Math.PI-.01)),ge=Math.min(Q,de),le=1.01*(Math.cos(Math.PI/2-this._pitch)*ge+Z),Se=this.height/50;C=new Float64Array(16),M.b4(C,this._fov,this.width/this.height,Se,le),C[8]=2*-y.x/this.width,C[9]=2*y.y/this.height,M.J(C,C,[1,-1,1]),M.H(C,C,[0,0,-this.cameraToCenterDistance]),M.b5(C,C,this._pitch),M.ad(C,C,this.angle),M.H(C,C,[-S,-I,0]),this.mercatorMatrix=M.J([],C,[this.worldSize,this.worldSize,this.worldSize]),M.J(C,C,[1,1,this._pixelPerMeter]),this.pixelMatrix=M.K(new Float64Array(16),this.labelPlaneMatrix,C),M.H(C,C,[0,0,-this.elevation]),this.projMatrix=C,this.invProjMatrix=M.ar([],C),this.pixelMatrix3D=M.K(new Float64Array(16),this.labelPlaneMatrix,C);const De=this.width%2/2,_e=this.height%2/2,Ce=Math.cos(this.angle),ke=Math.sin(this.angle),ze=S-Math.round(S)+Ce*De+ke*_e,Be=I-Math.round(I)+Ce*_e+ke*De,He=new Float64Array(C);if(M.H(He,He,[ze>.5?ze-1:ze,Be>.5?Be-1:Be,0]),this.alignedProjMatrix=He,C=M.ar(new Float64Array(16),this.pixelMatrix),!C)throw new Error("failed to invert matrix");this.pixelMatrixInverse=C,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const y=this.pointCoordinate(new M.P(0,0)),S=[y.x*this.worldSize,y.y*this.worldSize,0,1];return M.af(S,S,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const y=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new M.P(0,y))}getCameraQueryGeometry(y){const S=this.getCameraPoint();if(y.length===1)return[y[0],S];{let I=S.x,C=S.y,z=S.x,N=S.y;for(const U of y)I=Math.min(I,U.x),C=Math.min(C,U.y),z=Math.max(z,U.x),N=Math.max(N,U.y);return[new M.P(I,C),new M.P(z,C),new M.P(z,N),new M.P(I,N),new M.P(I,C)]}}lngLatToCameraDepth(y,S){const I=this.locationCoordinate(y),C=[I.x*this.worldSize,I.y*this.worldSize,S,1];return M.af(C,C,this.projMatrix),C[2]/C[3]}}function Xa(D,y){let S,I=!1,C=null,z=null;const N=()=>{C=null,I&&(D.apply(z,S),C=setTimeout(N,y),I=!1)};return(...U)=>(I=!0,z=this,S=U,C||N(),C)}class Ya{constructor(y){this._getCurrentHash=()=>{const S=window.location.hash.replace("#","");if(this._hashName){let I;return S.split("&").map(C=>C.split("=")).forEach(C=>{C[0]===this._hashName&&(I=C)}),(I&&I[1]||"").split("/")}return S.split("/")},this._onHashChange=()=>{const S=this._getCurrentHash();if(S.length>=3&&!S.some(I=>isNaN(I))){const I=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(S[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+S[2],+S[1]],zoom:+S[0],bearing:I,pitch:+(S[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const S=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,S)}catch{}},this._updateHash=Xa(this._updateHashUnthrottled,300),this._hashName=y&&encodeURIComponent(y)}addTo(y){return this._map=y,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(y){const S=this._map.getCenter(),I=Math.round(100*this._map.getZoom())/100,C=Math.ceil((I*Math.LN2+Math.log(512/360/.5))/Math.LN10),z=Math.pow(10,C),N=Math.round(S.lng*z)/z,U=Math.round(S.lat*z)/z,Z=this._map.getBearing(),K=this._map.getPitch();let J="";if(J+=y?`/${N}/${U}/${I}`:`${I}/${U}/${N}`,(Z||K)&&(J+="/"+Math.round(10*Z)/10),K&&(J+=`/${Math.round(K)}`),this._hashName){const Q=this._hashName;let ne=!1;const fe=window.location.hash.slice(1).split("&").map(de=>{const ge=de.split("=")[0];return ge===Q?(ne=!0,`${ge}=${J}`):de}).filter(de=>de);return ne||fe.push(`${Q}=${J}`),`#${fe.join("&")}`}return`#${J}`}}const Lr={linearity:.3,easing:M.b6(0,0,.3,1)},cl=M.e({deceleration:2500,maxSpeed:1400},Lr),ul=M.e({deceleration:20,maxSpeed:1400},Lr),hl=M.e({deceleration:1e3,maxSpeed:360},Lr),dl=M.e({deceleration:1e3,maxSpeed:90},Lr);class pl{constructor(y){this._map=y,this.clear()}clear(){this._inertiaBuffer=[]}record(y){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:we.now(),settings:y})}_drainInertiaBuffer(){const y=this._inertiaBuffer,S=we.now();for(;y.length>0&&S-y[0].time>160;)y.shift()}_onMoveEnd(y){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const S={zoom:0,bearing:0,pitch:0,pan:new M.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:z}of this._inertiaBuffer)S.zoom+=z.zoomDelta||0,S.bearing+=z.bearingDelta||0,S.pitch+=z.pitchDelta||0,z.panDelta&&S.pan._add(z.panDelta),z.around&&(S.around=z.around),z.pinchAround&&(S.pinchAround=z.pinchAround);const I=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,C={};if(S.pan.mag()){const z=Rs(S.pan.mag(),I,M.e({},cl,y||{}));C.offset=S.pan.mult(z.amount/S.pan.mag()),C.center=this._map.transform.center,Ms(C,z)}if(S.zoom){const z=Rs(S.zoom,I,ul);C.zoom=this._map.transform.zoom+z.amount,Ms(C,z)}if(S.bearing){const z=Rs(S.bearing,I,hl);C.bearing=this._map.transform.bearing+M.ac(z.amount,-179,179),Ms(C,z)}if(S.pitch){const z=Rs(S.pitch,I,dl);C.pitch=this._map.transform.pitch+z.amount,Ms(C,z)}if(C.zoom||C.bearing){const z=S.pinchAround===void 0?S.around:S.pinchAround;C.around=z?this._map.unproject(z):this._map.getCenter()}return this.clear(),M.e(C,{noMoveStart:!0})}}function Ms(D,y){(!D.duration||D.duration<y.duration)&&(D.duration=y.duration,D.easing=y.easing)}function Rs(D,y,S){const{maxSpeed:I,linearity:C,deceleration:z}=S,N=M.ac(D*C/(y/1e3),-I,I),U=Math.abs(N)/(z*C);return{easing:S.easing,duration:1e3*U,amount:N*(U/2)}}class Si extends M.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(y,S,I,C={}){const z=ce.mousePos(S.getCanvas(),I),N=S.unproject(z);super(y,M.e({point:z,lngLat:N,originalEvent:I},C)),this._defaultPrevented=!1,this.target=S}}class ns extends M.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(y,S,I){const C=y==="touchend"?I.changedTouches:I.touches,z=ce.touchPos(S.getCanvasContainer(),C),N=z.map(Z=>S.unproject(Z)),U=z.reduce((Z,K,J,Q)=>Z.add(K.div(Q.length)),new M.P(0,0));super(y,{points:z,point:U,lngLats:N,lngLat:S.unproject(U),originalEvent:I}),this._defaultPrevented=!1}}class _r extends M.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(y,S,I){super(y,{originalEvent:I}),this._defaultPrevented=!1}}class Fr{constructor(y,S){this._map=y,this._clickTolerance=S.clickTolerance}reset(){delete this._mousedownPos}wheel(y){return this._firePreventable(new _r(y.type,this._map,y))}mousedown(y,S){return this._mousedownPos=S,this._firePreventable(new Si(y.type,this._map,y))}mouseup(y){this._map.fire(new Si(y.type,this._map,y))}click(y,S){this._mousedownPos&&this._mousedownPos.dist(S)>=this._clickTolerance||this._map.fire(new Si(y.type,this._map,y))}dblclick(y){return this._firePreventable(new Si(y.type,this._map,y))}mouseover(y){this._map.fire(new Si(y.type,this._map,y))}mouseout(y){this._map.fire(new Si(y.type,this._map,y))}touchstart(y){return this._firePreventable(new ns(y.type,this._map,y))}touchmove(y){this._map.fire(new ns(y.type,this._map,y))}touchend(y){this._map.fire(new ns(y.type,this._map,y))}touchcancel(y){this._map.fire(new ns(y.type,this._map,y))}_firePreventable(y){if(this._map.fire(y),y.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class fl{constructor(y){this._map=y}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(y){this._map.fire(new Si(y.type,this._map,y))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Si("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(y){this._delayContextMenu?this._contextMenuEvent=y:this._ignoreContextMenu||this._map.fire(new Si(y.type,this._map,y)),this._map.listens("contextmenu")&&y.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Wi{constructor(y){this._map=y}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(y){return this.transform.pointLocation(M.P.convert(y),this._map.terrain)}}class ss{constructor(y,S){this._map=y,this._tr=new Wi(y),this._el=y.getCanvasContainer(),this._container=y.getContainer(),this._clickTolerance=S.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(y,S){this.isEnabled()&&y.shiftKey&&y.button===0&&(ce.disableDrag(),this._startPos=this._lastPos=S,this._active=!0)}mousemoveWindow(y,S){if(!this._active)return;const I=S;if(this._lastPos.equals(I)||!this._box&&I.dist(this._startPos)<this._clickTolerance)return;const C=this._startPos;this._lastPos=I,this._box||(this._box=ce.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",y));const z=Math.min(C.x,I.x),N=Math.max(C.x,I.x),U=Math.min(C.y,I.y),Z=Math.max(C.y,I.y);ce.setTransform(this._box,`translate(${z}px,${U}px)`),this._box.style.width=N-z+"px",this._box.style.height=Z-U+"px"}mouseupWindow(y,S){if(!this._active||y.button!==0)return;const I=this._startPos,C=S;if(this.reset(),ce.suppressClick(),I.x!==C.x||I.y!==C.y)return this._map.fire(new M.k("boxzoomend",{originalEvent:y})),{cameraAnimation:z=>z.fitScreenCoordinates(I,C,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",y)}keydown(y){this._active&&y.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",y))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(ce.remove(this._box),this._box=null),ce.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(y,S){return this._map.fire(new M.k(y,{originalEvent:S}))}}function Ja(D,y){if(D.length!==y.length)throw new Error(`The number of touches and points are not equal - touches ${D.length}, points ${y.length}`);const S={};for(let I=0;I<D.length;I++)S[D[I].identifier]=y[I];return S}class uc{constructor(y){this.reset(),this.numTouches=y.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(y,S,I){(this.centroid||I.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=y.timeStamp),I.length===this.numTouches&&(this.centroid=function(C){const z=new M.P(0,0);for(const N of C)z._add(N);return z.div(C.length)}(S),this.touches=Ja(I,S)))}touchmove(y,S,I){if(this.aborted||!this.centroid)return;const C=Ja(I,S);for(const z in this.touches){const N=C[z];(!N||N.dist(this.touches[z])>30)&&(this.aborted=!0)}}touchend(y,S,I){if((!this.centroid||y.timeStamp-this.startTime>500)&&(this.aborted=!0),I.length===0){const C=!this.aborted&&this.centroid;if(this.reset(),C)return C}}}class Qa{constructor(y){this.singleTap=new uc(y),this.numTaps=y.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(y,S,I){this.singleTap.touchstart(y,S,I)}touchmove(y,S,I){this.singleTap.touchmove(y,S,I)}touchend(y,S,I){const C=this.singleTap.touchend(y,S,I);if(C){const z=y.timeStamp-this.lastTime<500,N=!this.lastTap||this.lastTap.dist(C)<30;if(z&&N||this.reset(),this.count++,this.lastTime=y.timeStamp,this.lastTap=C,this.count===this.numTaps)return this.reset(),C}}}class ml{constructor(y){this._tr=new Wi(y),this._zoomIn=new Qa({numTouches:1,numTaps:2}),this._zoomOut=new Qa({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(y,S,I){this._zoomIn.touchstart(y,S,I),this._zoomOut.touchstart(y,S,I)}touchmove(y,S,I){this._zoomIn.touchmove(y,S,I),this._zoomOut.touchmove(y,S,I)}touchend(y,S,I){const C=this._zoomIn.touchend(y,S,I),z=this._zoomOut.touchend(y,S,I),N=this._tr;return C?(this._active=!0,y.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:U=>U.easeTo({duration:300,zoom:N.zoom+1,around:N.unproject(C)},{originalEvent:y})}):z?(this._active=!0,y.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:U=>U.easeTo({duration:300,zoom:N.zoom-1,around:N.unproject(z)},{originalEvent:y})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Hr{constructor(y){this._enabled=!!y.enable,this._moveStateManager=y.moveStateManager,this._clickTolerance=y.clickTolerance||1,this._moveFunction=y.move,this._activateOnStart=!!y.activateOnStart,y.assignEvents(this),this.reset()}reset(y){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(y)}_move(...y){const S=this._moveFunction(...y);if(S.bearingDelta||S.pitchDelta||S.around||S.panDelta)return this._active=!0,S}dragStart(y,S){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(y)&&(this._moveStateManager.startMove(y),this._lastPoint=S.length?S[0]:S,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(y,S){if(!this.isEnabled())return;const I=this._lastPoint;if(!I)return;if(y.preventDefault(),!this._moveStateManager.isValidMoveEvent(y))return void this.reset(y);const C=S.length?S[0]:S;return!this._moved&&C.dist(I)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=C,this._move(I,C))}dragEnd(y){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(y)&&(this._moved&&ce.suppressClick(),this.reset(y))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const on={0:1,2:2};class st{constructor(y){this._correctEvent=y.checkCorrectEvent}startMove(y){const S=ce.mouseButton(y);this._eventButton=S}endMove(y){delete this._eventButton}isValidStartEvent(y){return this._correctEvent(y)}isValidMoveEvent(y){return!function(S,I){const C=on[I];return S.buttons===void 0||(S.buttons&C)!==C}(y,this._eventButton)}isValidEndEvent(y){return ce.mouseButton(y)===this._eventButton}}class eo{constructor(){this._firstTouch=void 0}_isOneFingerTouch(y){return y.targetTouches.length===1}_isSameTouchEvent(y){return y.targetTouches[0].identifier===this._firstTouch}startMove(y){this._firstTouch=y.targetTouches[0].identifier}endMove(y){delete this._firstTouch}isValidStartEvent(y){return this._isOneFingerTouch(y)}isValidMoveEvent(y){return this._isOneFingerTouch(y)&&this._isSameTouchEvent(y)}isValidEndEvent(y){return this._isOneFingerTouch(y)&&this._isSameTouchEvent(y)}}const An=D=>{D.mousedown=D.dragStart,D.mousemoveWindow=D.dragMove,D.mouseup=D.dragEnd,D.contextmenu=function(y){y.preventDefault()}},as=({enable:D,clickTolerance:y,bearingDegreesPerPixelMoved:S=.8})=>{const I=new st({checkCorrectEvent:C=>ce.mouseButton(C)===0&&C.ctrlKey||ce.mouseButton(C)===2});return new Hr({clickTolerance:y,move:(C,z)=>({bearingDelta:(z.x-C.x)*S}),moveStateManager:I,enable:D,assignEvents:An})},to=({enable:D,clickTolerance:y,pitchDegreesPerPixelMoved:S=-.5})=>{const I=new st({checkCorrectEvent:C=>ce.mouseButton(C)===0&&C.ctrlKey||ce.mouseButton(C)===2});return new Hr({clickTolerance:y,move:(C,z)=>({pitchDelta:(z.y-C.y)*S}),moveStateManager:I,enable:D,assignEvents:An})};class rt{constructor(y,S){this._clickTolerance=y.clickTolerance||1,this._map=S,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new M.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(y,S,I){return this._calculateTransform(y,S,I)}touchmove(y,S,I){if(this._active&&!(I.length<this.minTouchs()))return y.preventDefault(),this._calculateTransform(y,S,I)}touchend(y,S,I){this._calculateTransform(y,S,I),this._active&&I.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(y,S,I){I.length>0&&(this._active=!0);const C=Ja(I,S),z=new M.P(0,0),N=new M.P(0,0);let U=0;for(const K in C){const J=C[K],Q=this._touches[K];Q&&(z._add(J),N._add(J.sub(Q)),U++,C[K]=J)}if(this._touches=C,U<this.minTouchs()||!N.mag())return;const Z=N.div(U);return this._sum._add(Z),this._sum.mag()<this._clickTolerance?void 0:{around:z.div(U),panDelta:Z}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ds{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(y,S,I){this._firstTwoTouches||I.length<2||(this._firstTwoTouches=[I[0].identifier,I[1].identifier],this._start([S[0],S[1]]))}touchmove(y,S,I){if(!this._firstTwoTouches)return;y.preventDefault();const[C,z]=this._firstTwoTouches,N=ca(I,S,C),U=ca(I,S,z);if(!N||!U)return;const Z=this._aroundCenter?null:N.add(U).div(2);return this._move([N,U],Z,y)}touchend(y,S,I){if(!this._firstTwoTouches)return;const[C,z]=this._firstTwoTouches,N=ca(I,S,C),U=ca(I,S,z);N&&U||(this._active&&ce.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(y){this._enabled=!0,this._aroundCenter=!!y&&y.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function ca(D,y,S){for(let I=0;I<D.length;I++)if(D[I].identifier===S)return y[I]}function gl(D,y){return Math.log(D/y)/Math.LN2}class ua extends Ds{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(y){this._startDistance=this._distance=y[0].dist(y[1])}_move(y,S){const I=this._distance;if(this._distance=y[0].dist(y[1]),this._active||!(Math.abs(gl(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:gl(this._distance,I),pinchAround:S}}}function io(D,y){return 180*D.angleWith(y)/Math.PI}class ro extends Ds{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(y){this._startVector=this._vector=y[0].sub(y[1]),this._minDiameter=y[0].dist(y[1])}_move(y,S,I){const C=this._vector;if(this._vector=y[0].sub(y[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:io(this._vector,C),pinchAround:S}}_isBelowThreshold(y){this._minDiameter=Math.min(this._minDiameter,y.mag());const S=25/(Math.PI*this._minDiameter)*360,I=io(y,this._startVector);return Math.abs(I)<S}}function no(D){return Math.abs(D.y)>Math.abs(D.x)}class yl extends Ds{constructor(y){super(),this._currentTouchCount=0,this._map=y}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(y,S,I){super.touchstart(y,S,I),this._currentTouchCount=I.length}_start(y){this._lastPoints=y,no(y[0].sub(y[1]))&&(this._valid=!1)}_move(y,S,I){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const C=y[0].sub(this._lastPoints[0]),z=y[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(C,z,I.timeStamp),this._valid?(this._lastPoints=y,this._active=!0,{pitchDelta:(C.y+z.y)/2*-.5}):void 0}gestureBeginsVertically(y,S,I){if(this._valid!==void 0)return this._valid;const C=y.mag()>=2,z=S.mag()>=2;if(!C&&!z)return;if(!C||!z)return this._firstMove===void 0&&(this._firstMove=I),I-this._firstMove<100&&void 0;const N=y.y>0==S.y>0;return no(y)&&no(S)&&N}}const In={panStep:100,bearingStep:15,pitchStep:10};class Kt{constructor(y){this._tr=new Wi(y);const S=In;this._panStep=S.panStep,this._bearingStep=S.bearingStep,this._pitchStep=S.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(y){if(y.altKey||y.ctrlKey||y.metaKey)return;let S=0,I=0,C=0,z=0,N=0;switch(y.keyCode){case 61:case 107:case 171:case 187:S=1;break;case 189:case 109:case 173:S=-1;break;case 37:y.shiftKey?I=-1:(y.preventDefault(),z=-1);break;case 39:y.shiftKey?I=1:(y.preventDefault(),z=1);break;case 38:y.shiftKey?C=1:(y.preventDefault(),N=-1);break;case 40:y.shiftKey?C=-1:(y.preventDefault(),N=1);break;default:return}return this._rotationDisabled&&(I=0,C=0),{cameraAnimation:U=>{const Z=this._tr;U.easeTo({duration:300,easeId:"keyboardHandler",easing:ha,zoom:S?Math.round(Z.zoom)+S*(y.shiftKey?2:1):Z.zoom,bearing:Z.bearing+I*this._bearingStep,pitch:Z.pitch+C*this._pitchStep,offset:[-z*this._panStep,-N*this._panStep],center:Z.center},{originalEvent:y})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function ha(D){return D*(2-D)}const da=4.000244140625;class so{constructor(y,S){this._onTimeout=I=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(I)},this._map=y,this._tr=new Wi(y),this._triggerRenderFrame=S,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(y){this._defaultZoomRate=y}setWheelZoomRate(y){this._wheelZoomRate=y}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(y){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!y&&y.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(y){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!y[this._map.cooperativeGestures._bypassKey])return;let S=y.deltaMode===WheelEvent.DOM_DELTA_LINE?40*y.deltaY:y.deltaY;const I=we.now(),C=I-(this._lastWheelEventTime||0);this._lastWheelEventTime=I,S!==0&&S%da==0?this._type="wheel":S!==0&&Math.abs(S)<4?this._type="trackpad":C>400?(this._type=null,this._lastValue=S,this._timeout=setTimeout(this._onTimeout,40,y)):this._type||(this._type=Math.abs(C*S)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,S+=this._lastValue)),y.shiftKey&&S&&(S/=4),this._type&&(this._lastWheelEvent=y,this._delta-=S,this._active||this._start(y)),y.preventDefault()}_start(y){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const S=ce.mousePos(this._map.getCanvas(),y),I=this._tr;this._around=S.y>I.transform.height/2-I.transform.getHorizon()?M.M.convert(this._aroundCenter?I.center:I.unproject(S)):M.M.convert(I.center),this._aroundPoint=I.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const y=this._tr.transform;if(this._delta!==0){const U=this._type==="wheel"&&Math.abs(this._delta)>da?this._wheelZoomRate:this._defaultZoomRate;let Z=2/(1+Math.exp(-Math.abs(this._delta*U)));this._delta<0&&Z!==0&&(Z=1/Z);const K=typeof this._targetZoom=="number"?y.zoomScale(this._targetZoom):y.scale;this._targetZoom=Math.min(y.maxZoom,Math.max(y.minZoom,y.scaleZoom(K*Z))),this._type==="wheel"&&(this._startZoom=y.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const S=typeof this._targetZoom=="number"?this._targetZoom:y.zoom,I=this._startZoom,C=this._easing;let z,N=!1;if(this._type==="wheel"&&I&&C){const U=Math.min((we.now()-this._lastWheelEventTime)/200,1),Z=C(U);z=M.z.number(I,S,Z),U<1?this._frameId||(this._frameId=!0):N=!0}else z=S,N=!0;return this._active=!0,N&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!N,zoomDelta:z-y.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(y){let S=M.b7;if(this._prevEase){const I=this._prevEase,C=(we.now()-I.start)/I.duration,z=I.easing(C+.01)-I.easing(C),N=.27/Math.sqrt(z*z+1e-4)*.01,U=Math.sqrt(.0729-N*N);S=M.b6(N,U,.25,1)}return this._prevEase={start:we.now(),duration:y,easing:S},S}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class ao{constructor(y,S){this._clickZoom=y,this._tapZoom=S}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class xl{constructor(y){this._tr=new Wi(y),this.reset()}reset(){this._active=!1}dblclick(y,S){return y.preventDefault(),{cameraAnimation:I=>{I.easeTo({duration:300,zoom:this._tr.zoom+(y.shiftKey?-1:1),around:this._tr.unproject(S)},{originalEvent:y})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class hc{constructor(){this._tap=new Qa({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(y,S,I){if(!this._swipePoint)if(this._tapTime){const C=S[0],z=y.timeStamp-this._tapTime<500,N=this._tapPoint.dist(C)<30;z&&N?I.length>0&&(this._swipePoint=C,this._swipeTouch=I[0].identifier):this.reset()}else this._tap.touchstart(y,S,I)}touchmove(y,S,I){if(this._tapTime){if(this._swipePoint){if(I[0].identifier!==this._swipeTouch)return;const C=S[0],z=C.y-this._swipePoint.y;return this._swipePoint=C,y.preventDefault(),this._active=!0,{zoomDelta:z/128}}}else this._tap.touchmove(y,S,I)}touchend(y,S,I){if(this._tapTime)this._swipePoint&&I.length===0&&this.reset();else{const C=this._tap.touchend(y,S,I);C&&(this._tapTime=y.timeStamp,this._tapPoint=C)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Sr{constructor(y,S,I){this._el=y,this._mousePan=S,this._touchPan=I}enable(y){this._inertiaOptions=y||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ks{constructor(y,S,I){this._pitchWithRotate=y.pitchWithRotate,this._mouseRotate=S,this._mousePitch=I}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class ut{constructor(y,S,I,C){this._el=y,this._touchZoom=S,this._touchRotate=I,this._tapDragZoom=C,this._rotationDisabled=!1,this._enabled=!0}enable(y){this._touchZoom.enable(y),this._rotationDisabled||this._touchRotate.enable(y),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class pt{constructor(y,S){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=y,this._options=S,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const y=this._map.getCanvasContainer();y.classList.add("maplibregl-cooperative-gestures"),this._container=ce.create("div","maplibregl-cooperative-gesture-screen",y);let S=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(S=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const I=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),C=document.createElement("div");C.className="maplibregl-desktop-message",C.textContent=S,this._container.appendChild(C);const z=document.createElement("div");z.className="maplibregl-mobile-message",z.textContent=I,this._container.appendChild(z),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(ce.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(y){this._onCooperativeGesture(y.touches.length===1)}wheel(y){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!y[this._bypassKey])}_onCooperativeGesture(y){this._enabled&&y&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Cn=D=>D.zoom||D.drag||D.pitch||D.rotate;class oo extends M.k{}function zs(D){return D.panDelta&&D.panDelta.mag()||D.zoomDelta||D.bearingDelta||D.pitchDelta}class Ki{constructor(y,S){this.handleWindowEvent=C=>{this.handleEvent(C,`${C.type}Window`)},this.handleEvent=(C,z)=>{if(C.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const N=C.type==="renderFrame"?void 0:C,U={needsRenderFrame:!1},Z={},K={},J=C.touches,Q=J?this._getMapTouches(J):void 0,ne=Q?ce.touchPos(this._map.getCanvas(),Q):ce.mousePos(this._map.getCanvas(),C);for(const{handlerName:ge,handler:le,allowed:Se}of this._handlers){if(!le.isEnabled())continue;let De;this._blockedByActive(K,Se,ge)?le.reset():le[z||C.type]&&(De=le[z||C.type](C,ne,Q),this.mergeHandlerResult(U,Z,De,ge,N),De&&De.needsRenderFrame&&this._triggerRenderFrame()),(De||le.isActive())&&(K[ge]=le)}const fe={};for(const ge in this._previousActiveHandlers)K[ge]||(fe[ge]=N);this._previousActiveHandlers=K,(Object.keys(fe).length||zs(U))&&(this._changes.push([U,Z,fe]),this._triggerRenderFrame()),(Object.keys(K).length||zs(U))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:de}=U;de&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],de(this._map))},this._map=y,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new pl(y),this._bearingSnap=S.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(S);const I=this._el;this._listeners=[[I,"touchstart",{passive:!0}],[I,"touchmove",{passive:!1}],[I,"touchend",void 0],[I,"touchcancel",void 0],[I,"mousedown",void 0],[I,"mousemove",void 0],[I,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[I,"mouseover",void 0],[I,"mouseout",void 0],[I,"dblclick",void 0],[I,"click",void 0],[I,"keydown",{capture:!1}],[I,"keyup",void 0],[I,"wheel",{passive:!1}],[I,"contextmenu",void 0],[window,"blur",void 0]];for(const[C,z,N]of this._listeners)ce.addEventListener(C,z,C===document?this.handleWindowEvent:this.handleEvent,N)}destroy(){for(const[y,S,I]of this._listeners)ce.removeEventListener(y,S,y===document?this.handleWindowEvent:this.handleEvent,I)}_addDefaultHandlers(y){const S=this._map,I=S.getCanvasContainer();this._add("mapEvent",new Fr(S,y));const C=S.boxZoom=new ss(S,y);this._add("boxZoom",C),y.interactive&&y.boxZoom&&C.enable();const z=S.cooperativeGestures=new pt(S,y.cooperativeGestures);this._add("cooperativeGestures",z),y.cooperativeGestures&&z.enable();const N=new ml(S),U=new xl(S);S.doubleClickZoom=new ao(U,N),this._add("tapZoom",N),this._add("clickZoom",U),y.interactive&&y.doubleClickZoom&&S.doubleClickZoom.enable();const Z=new hc;this._add("tapDragZoom",Z);const K=S.touchPitch=new yl(S);this._add("touchPitch",K),y.interactive&&y.touchPitch&&S.touchPitch.enable(y.touchPitch);const J=as(y),Q=to(y);S.dragRotate=new ks(y,J,Q),this._add("mouseRotate",J,["mousePitch"]),this._add("mousePitch",Q,["mouseRotate"]),y.interactive&&y.dragRotate&&S.dragRotate.enable();const ne=(({enable:De,clickTolerance:_e})=>{const Ce=new st({checkCorrectEvent:ke=>ce.mouseButton(ke)===0&&!ke.ctrlKey});return new Hr({clickTolerance:_e,move:(ke,ze)=>({around:ze,panDelta:ze.sub(ke)}),activateOnStart:!0,moveStateManager:Ce,enable:De,assignEvents:An})})(y),fe=new rt(y,S);S.dragPan=new Sr(I,ne,fe),this._add("mousePan",ne),this._add("touchPan",fe,["touchZoom","touchRotate"]),y.interactive&&y.dragPan&&S.dragPan.enable(y.dragPan);const de=new ro,ge=new ua;S.touchZoomRotate=new ut(I,ge,de,Z),this._add("touchRotate",de,["touchPan","touchZoom"]),this._add("touchZoom",ge,["touchPan","touchRotate"]),y.interactive&&y.touchZoomRotate&&S.touchZoomRotate.enable(y.touchZoomRotate);const le=S.scrollZoom=new so(S,()=>this._triggerRenderFrame());this._add("scrollZoom",le,["mousePan"]),y.interactive&&y.scrollZoom&&S.scrollZoom.enable(y.scrollZoom);const Se=S.keyboard=new Kt(S);this._add("keyboard",Se),y.interactive&&y.keyboard&&S.keyboard.enable(),this._add("blockableMapEvent",new fl(S))}_add(y,S,I){this._handlers.push({handlerName:y,handler:S,allowed:I}),this._handlersById[y]=S}stop(y){if(!this._updatingCamera){for(const{handler:S}of this._handlers)S.reset();this._inertia.clear(),this._fireEvents({},{},y),this._changes=[]}}isActive(){for(const{handler:y}of this._handlers)if(y.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Cn(this._eventsInProgress)||this.isZooming()}_blockedByActive(y,S,I){for(const C in y)if(C!==I&&(!S||S.indexOf(C)<0))return!0;return!1}_getMapTouches(y){const S=[];for(const I of y)this._el.contains(I.target)&&S.push(I);return S}mergeHandlerResult(y,S,I,C,z){if(!I)return;M.e(y,I);const N={handlerName:C,originalEvent:I.originalEvent||z};I.zoomDelta!==void 0&&(S.zoom=N),I.panDelta!==void 0&&(S.drag=N),I.pitchDelta!==void 0&&(S.pitch=N),I.bearingDelta!==void 0&&(S.rotate=N)}_applyChanges(){const y={},S={},I={};for(const[C,z,N]of this._changes)C.panDelta&&(y.panDelta=(y.panDelta||new M.P(0,0))._add(C.panDelta)),C.zoomDelta&&(y.zoomDelta=(y.zoomDelta||0)+C.zoomDelta),C.bearingDelta&&(y.bearingDelta=(y.bearingDelta||0)+C.bearingDelta),C.pitchDelta&&(y.pitchDelta=(y.pitchDelta||0)+C.pitchDelta),C.around!==void 0&&(y.around=C.around),C.pinchAround!==void 0&&(y.pinchAround=C.pinchAround),C.noInertia&&(y.noInertia=C.noInertia),M.e(S,z),M.e(I,N);this._updateMapTransform(y,S,I),this._changes=[]}_updateMapTransform(y,S,I){const C=this._map,z=C._getTransformForUpdate(),N=C.terrain;if(!(zs(y)||N&&this._terrainMovement))return this._fireEvents(S,I,!0);let{panDelta:U,zoomDelta:Z,bearingDelta:K,pitchDelta:J,around:Q,pinchAround:ne}=y;ne!==void 0&&(Q=ne),C._stop(!0),Q=Q||C.transform.centerPoint;const fe=z.pointLocation(U?Q.sub(U):Q);K&&(z.bearing+=K),J&&(z.pitch+=J),Z&&(z.zoom+=Z),N?this._terrainMovement||!S.drag&&!S.zoom?S.drag&&this._terrainMovement?z.center=z.pointLocation(z.centerPoint.sub(U)):z.setLocationAtPoint(fe,Q):(this._terrainMovement=!0,this._map._elevationFreeze=!0,z.setLocationAtPoint(fe,Q),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,z.recalculateZoom(C.terrain)})):z.setLocationAtPoint(fe,Q),C._applyUpdatedTransform(z),this._map._update(),y.noInertia||this._inertia.record(y),this._fireEvents(S,I,!0)}_fireEvents(y,S,I){const C=Cn(this._eventsInProgress),z=Cn(y),N={};for(const J in y){const{originalEvent:Q}=y[J];this._eventsInProgress[J]||(N[`${J}start`]=Q),this._eventsInProgress[J]=y[J]}!C&&z&&this._fireEvent("movestart",z.originalEvent);for(const J in N)this._fireEvent(J,N[J]);z&&this._fireEvent("move",z.originalEvent);for(const J in y){const{originalEvent:Q}=y[J];this._fireEvent(J,Q)}const U={};let Z;for(const J in this._eventsInProgress){const{handlerName:Q,originalEvent:ne}=this._eventsInProgress[J];this._handlersById[Q].isActive()||(delete this._eventsInProgress[J],Z=S[Q]||ne,U[`${J}end`]=Z)}for(const J in U)this._fireEvent(J,U[J]);const K=Cn(this._eventsInProgress);if(I&&(C||z)&&!K){this._updatingCamera=!0;const J=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Q=ne=>ne!==0&&-this._bearingSnap<ne&&ne<this._bearingSnap;!J||!J.essential&&we.prefersReducedMotion?(this._map.fire(new M.k("moveend",{originalEvent:Z})),Q(this._map.getBearing())&&this._map.resetNorth()):(Q(J.bearing||this._map.getBearing())&&(J.bearing=0),J.freezeElevation=!0,this._map.easeTo(J,{originalEvent:Z})),this._updatingCamera=!1}}_fireEvent(y,S){this._map.fire(new M.k(y,S?{originalEvent:S}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(y=>{delete this._frameId,this.handleEvent(new oo("renderFrame",{timeStamp:y})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class vl extends M.E{constructor(y,S){super(),this._renderFrameCallback=()=>{const I=Math.min((we.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(I)),I<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=y,this._bearingSnap=S.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new M.M(this.transform.center.lng,this.transform.center.lat)}setCenter(y,S){return this.jumpTo({center:y},S)}panBy(y,S,I){return y=M.P.convert(y).mult(-1),this.panTo(this.transform.center,M.e({offset:y},S),I)}panTo(y,S,I){return this.easeTo(M.e({center:y},S),I)}getZoom(){return this.transform.zoom}setZoom(y,S){return this.jumpTo({zoom:y},S),this}zoomTo(y,S,I){return this.easeTo(M.e({zoom:y},S),I)}zoomIn(y,S){return this.zoomTo(this.getZoom()+1,y,S),this}zoomOut(y,S){return this.zoomTo(this.getZoom()-1,y,S),this}getBearing(){return this.transform.bearing}setBearing(y,S){return this.jumpTo({bearing:y},S),this}getPadding(){return this.transform.padding}setPadding(y,S){return this.jumpTo({padding:y},S),this}rotateTo(y,S,I){return this.easeTo(M.e({bearing:y},S),I)}resetNorth(y,S){return this.rotateTo(0,M.e({duration:1e3},y),S),this}resetNorthPitch(y,S){return this.easeTo(M.e({bearing:0,pitch:0,duration:1e3},y),S),this}snapToNorth(y,S){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(y,S):this}getPitch(){return this.transform.pitch}setPitch(y,S){return this.jumpTo({pitch:y},S),this}cameraForBounds(y,S){y=mi.convert(y);const I=S&&S.bearing||0;return this._cameraForBoxAndBearing(y.getNorthWest(),y.getSouthEast(),I,S)}_cameraForBoxAndBearing(y,S,I,C){const z={top:0,bottom:0,right:0,left:0};if(typeof(C=M.e({padding:z,offset:[0,0],maxZoom:this.transform.maxZoom},C)).padding=="number"){const nt=C.padding;C.padding={top:nt,bottom:nt,right:nt,left:nt}}C.padding=M.e(z,C.padding);const N=this.transform,U=N.padding,Z=new mi(y,S),K=N.project(Z.getNorthWest()),J=N.project(Z.getNorthEast()),Q=N.project(Z.getSouthEast()),ne=N.project(Z.getSouthWest()),fe=M.b8(-I),de=K.rotate(fe),ge=J.rotate(fe),le=Q.rotate(fe),Se=ne.rotate(fe),De=new M.P(Math.max(de.x,ge.x,Se.x,le.x),Math.max(de.y,ge.y,Se.y,le.y)),_e=new M.P(Math.min(de.x,ge.x,Se.x,le.x),Math.min(de.y,ge.y,Se.y,le.y)),Ce=De.sub(_e),ke=(N.width-(U.left+U.right+C.padding.left+C.padding.right))/Ce.x,ze=(N.height-(U.top+U.bottom+C.padding.top+C.padding.bottom))/Ce.y;if(ze<0||ke<0)return void M.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Be=Math.min(N.scaleZoom(N.scale*Math.min(ke,ze)),C.maxZoom),He=M.P.convert(C.offset),Ve=new M.P((C.padding.left-C.padding.right)/2,(C.padding.top-C.padding.bottom)/2).rotate(M.b8(I)),je=He.add(Ve).mult(N.scale/N.zoomScale(Be));return{center:N.unproject(K.add(Q).div(2).sub(je)),zoom:Be,bearing:I}}fitBounds(y,S,I){return this._fitInternal(this.cameraForBounds(y,S),S,I)}fitScreenCoordinates(y,S,I,C,z){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(M.P.convert(y)),this.transform.pointLocation(M.P.convert(S)),I,C),C,z)}_fitInternal(y,S,I){return y?(delete(S=M.e(y,S)).padding,S.linear?this.easeTo(S,I):this.flyTo(S,I)):this}jumpTo(y,S){this.stop();const I=this._getTransformForUpdate();let C=!1,z=!1,N=!1;return"zoom"in y&&I.zoom!==+y.zoom&&(C=!0,I.zoom=+y.zoom),y.center!==void 0&&(I.center=M.M.convert(y.center)),"bearing"in y&&I.bearing!==+y.bearing&&(z=!0,I.bearing=+y.bearing),"pitch"in y&&I.pitch!==+y.pitch&&(N=!0,I.pitch=+y.pitch),y.padding==null||I.isPaddingEqual(y.padding)||(I.padding=y.padding),this._applyUpdatedTransform(I),this.fire(new M.k("movestart",S)).fire(new M.k("move",S)),C&&this.fire(new M.k("zoomstart",S)).fire(new M.k("zoom",S)).fire(new M.k("zoomend",S)),z&&this.fire(new M.k("rotatestart",S)).fire(new M.k("rotate",S)).fire(new M.k("rotateend",S)),N&&this.fire(new M.k("pitchstart",S)).fire(new M.k("pitch",S)).fire(new M.k("pitchend",S)),this.fire(new M.k("moveend",S))}calculateCameraOptionsFromTo(y,S,I,C=0){const z=M.Y.fromLngLat(y,S),N=M.Y.fromLngLat(I,C),U=N.x-z.x,Z=N.y-z.y,K=N.z-z.z,J=Math.hypot(U,Z,K);if(J===0)throw new Error("Can't calculate camera options with same From and To");const Q=Math.hypot(U,Z),ne=this.transform.scaleZoom(this.transform.cameraToCenterDistance/J/this.transform.tileSize),fe=180*Math.atan2(U,-Z)/Math.PI;let de=180*Math.acos(Q/J)/Math.PI;return de=K<0?90-de:90+de,{center:N.toLngLat(),zoom:ne,pitch:de,bearing:fe}}easeTo(y,S){var I;this._stop(!1,y.easeId),((y=M.e({offset:[0,0],duration:500,easing:M.b7},y)).animate===!1||!y.essential&&we.prefersReducedMotion)&&(y.duration=0);const C=this._getTransformForUpdate(),z=this.getZoom(),N=this.getBearing(),U=this.getPitch(),Z=this.getPadding(),K="bearing"in y?this._normalizeBearing(y.bearing,N):N,J="pitch"in y?+y.pitch:U,Q="padding"in y?y.padding:C.padding,ne=M.P.convert(y.offset);let fe=C.centerPoint.add(ne);const de=C.pointLocation(fe),{center:ge,zoom:le}=C.getConstrained(M.M.convert(y.center||de),(I=y.zoom)!==null&&I!==void 0?I:z);this._normalizeCenter(ge);const Se=C.project(de),De=C.project(ge).sub(Se),_e=C.zoomScale(le-z);let Ce,ke;y.around&&(Ce=M.M.convert(y.around),ke=C.locationPoint(Ce));const ze={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||le!==z,this._rotating=this._rotating||N!==K,this._pitching=this._pitching||J!==U,this._padding=!C.isPaddingEqual(Q),this._easeId=y.easeId,this._prepareEase(S,y.noMoveStart,ze),this.terrain&&this._prepareElevation(ge),this._ease(Be=>{if(this._zooming&&(C.zoom=M.z.number(z,le,Be)),this._rotating&&(C.bearing=M.z.number(N,K,Be)),this._pitching&&(C.pitch=M.z.number(U,J,Be)),this._padding&&(C.interpolatePadding(Z,Q,Be),fe=C.centerPoint.add(ne)),this.terrain&&!y.freezeElevation&&this._updateElevation(Be),Ce)C.setLocationAtPoint(Ce,ke);else{const He=C.zoomScale(C.zoom-z),Ve=le>z?Math.min(2,_e):Math.max(.5,_e),je=Math.pow(Ve,1-Be),nt=C.unproject(Se.add(De.mult(Be*je)).mult(He));C.setLocationAtPoint(C.renderWorldCopies?nt.wrap():nt,fe)}this._applyUpdatedTransform(C),this._fireMoveEvents(S)},Be=>{this.terrain&&this._finalizeElevation(),this._afterEase(S,Be)},y),this}_prepareEase(y,S,I={}){this._moving=!0,S||I.moving||this.fire(new M.k("movestart",y)),this._zooming&&!I.zooming&&this.fire(new M.k("zoomstart",y)),this._rotating&&!I.rotating&&this.fire(new M.k("rotatestart",y)),this._pitching&&!I.pitching&&this.fire(new M.k("pitchstart",y))}_prepareElevation(y){this._elevationCenter=y,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(y,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(y){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const S=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(y<1&&S!==this._elevationTarget){const I=this._elevationTarget-this._elevationStart;this._elevationStart+=y*(I-(S-(I*y+this._elevationStart))/(1-y)),this._elevationTarget=S}this.transform.elevation=M.z.number(this._elevationStart,this._elevationTarget,y)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(y){if(!this.transformCameraUpdate)return;const S=y.clone(),{center:I,zoom:C,pitch:z,bearing:N,elevation:U}=this.transformCameraUpdate(S);I&&(S.center=I),C!==void 0&&(S.zoom=C),z!==void 0&&(S.pitch=z),N!==void 0&&(S.bearing=N),U!==void 0&&(S.elevation=U),this.transform.apply(S)}_fireMoveEvents(y){this.fire(new M.k("move",y)),this._zooming&&this.fire(new M.k("zoom",y)),this._rotating&&this.fire(new M.k("rotate",y)),this._pitching&&this.fire(new M.k("pitch",y))}_afterEase(y,S){if(this._easeId&&S&&this._easeId===S)return;delete this._easeId;const I=this._zooming,C=this._rotating,z=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,I&&this.fire(new M.k("zoomend",y)),C&&this.fire(new M.k("rotateend",y)),z&&this.fire(new M.k("pitchend",y)),this.fire(new M.k("moveend",y))}flyTo(y,S){var I;if(!y.essential&&we.prefersReducedMotion){const Mt=M.L(y,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Mt,S)}this.stop(),y=M.e({offset:[0,0],speed:1.2,curve:1.42,easing:M.b7},y);const C=this._getTransformForUpdate(),z=this.getZoom(),N=this.getBearing(),U=this.getPitch(),Z=this.getPadding(),K="bearing"in y?this._normalizeBearing(y.bearing,N):N,J="pitch"in y?+y.pitch:U,Q="padding"in y?y.padding:C.padding,ne=M.P.convert(y.offset);let fe=C.centerPoint.add(ne);const de=C.pointLocation(fe),{center:ge,zoom:le}=C.getConstrained(M.M.convert(y.center||de),(I=y.zoom)!==null&&I!==void 0?I:z);this._normalizeCenter(ge);const Se=C.zoomScale(le-z),De=C.project(de),_e=C.project(ge).sub(De);let Ce=y.curve;const ke=Math.max(C.width,C.height),ze=ke/Se,Be=_e.mag();if("minZoom"in y){const Mt=M.ac(Math.min(y.minZoom,z,le),C.minZoom,C.maxZoom),_t=ke/C.zoomScale(Mt-z);Ce=Math.sqrt(_t/Be*2)}const He=Ce*Ce;function Ve(Mt){const _t=(ze*ze-ke*ke+(Mt?-1:1)*He*He*Be*Be)/(2*(Mt?ze:ke)*He*Be);return Math.log(Math.sqrt(_t*_t+1)-_t)}function je(Mt){return(Math.exp(Mt)-Math.exp(-Mt))/2}function nt(Mt){return(Math.exp(Mt)+Math.exp(-Mt))/2}const vt=Ve(!1);let Je=function(Mt){return nt(vt)/nt(vt+Ce*Mt)},mt=function(Mt){return ke*((nt(vt)*(je(_t=vt+Ce*Mt)/nt(_t))-je(vt))/He)/Be;var _t},Et=(Ve(!0)-vt)/Ce;if(Math.abs(Be)<1e-6||!isFinite(Et)){if(Math.abs(ke-ze)<1e-6)return this.easeTo(y,S);const Mt=ze<ke?-1:1;Et=Math.abs(Math.log(ze/ke))/Ce,mt=function(){return 0},Je=function(_t){return Math.exp(Mt*Ce*_t)}}return y.duration="duration"in y?+y.duration:1e3*Et/("screenSpeed"in y?+y.screenSpeed/Ce:+y.speed),y.maxDuration&&y.duration>y.maxDuration&&(y.duration=0),this._zooming=!0,this._rotating=N!==K,this._pitching=J!==U,this._padding=!C.isPaddingEqual(Q),this._prepareEase(S,!1),this.terrain&&this._prepareElevation(ge),this._ease(Mt=>{const _t=Mt*Et,At=1/Je(_t);C.zoom=Mt===1?le:z+C.scaleZoom(At),this._rotating&&(C.bearing=M.z.number(N,K,Mt)),this._pitching&&(C.pitch=M.z.number(U,J,Mt)),this._padding&&(C.interpolatePadding(Z,Q,Mt),fe=C.centerPoint.add(ne)),this.terrain&&!y.freezeElevation&&this._updateElevation(Mt);const It=Mt===1?ge:C.unproject(De.add(_e.mult(mt(_t))).mult(At));C.setLocationAtPoint(C.renderWorldCopies?It.wrap():It,fe),this._applyUpdatedTransform(C),this._fireMoveEvents(S)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(S)},y),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(y,S){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const I=this._onEaseEnd;delete this._onEaseEnd,I.call(this,S)}if(!y){const I=this.handlers;I&&I.stop(!1)}return this}_ease(y,S,I){I.animate===!1||I.duration===0?(y(1),S()):(this._easeStart=we.now(),this._easeOptions=I,this._onEaseFrame=y,this._onEaseEnd=S,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(y,S){y=M.b1(y,-180,180);const I=Math.abs(y-S);return Math.abs(y-360-S)<I&&(y-=360),Math.abs(y+360-S)<I&&(y+=360),y}_normalizeCenter(y){const S=this.transform;if(!S.renderWorldCopies||S.lngRange)return;const I=y.lng-S.center.lng;y.lng+=I>180?-360:I<-180?360:0}queryTerrainElevation(y){return this.terrain?this.terrain.getElevationForLngLatZoom(M.M.convert(y),this.transform.tileZoom)-this.transform.elevation:null}}const Er={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class bl{constructor(y=Er){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=S=>{!S||S.sourceDataType!=="metadata"&&S.sourceDataType!=="visibility"&&S.dataType!=="style"&&S.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=y}getDefaultPosition(){return"bottom-right"}onAdd(y){return this._map=y,this._compact=this.options.compact,this._container=ce.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=ce.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=ce.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){ce.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(y,S){const I=this._map._getUIString(`AttributionControl.${S}`);y.title=I,y.setAttribute("aria-label",I)}_updateAttributions(){if(!this._map.style)return;let y=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?y=y.concat(this.options.customAttribution.map(C=>typeof C!="string"?"":C)):typeof this.options.customAttribution=="string"&&y.push(this.options.customAttribution)),this._map.style.stylesheet){const C=this._map.style.stylesheet;this.styleOwner=C.owner,this.styleId=C.id}const S=this._map.style.sourceCaches;for(const C in S){const z=S[C];if(z.used||z.usedForTerrain){const N=z.getSource();N.attribution&&y.indexOf(N.attribution)<0&&y.push(N.attribution)}}y=y.filter(C=>String(C).trim()),y.sort((C,z)=>C.length-z.length),y=y.filter((C,z)=>{for(let N=z+1;N<y.length;N++)if(y[N].indexOf(C)>=0)return!1;return!0});const I=y.join(" | ");I!==this._attribHTML&&(this._attribHTML=I,y.length?(this._innerContainer.innerHTML=I,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class os{constructor(y={}){this._updateCompact=()=>{const S=this._container.children;if(S.length){const I=S[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&I.classList.add("maplibregl-compact"):I.classList.remove("maplibregl-compact")}},this.options=y}getDefaultPosition(){return"bottom-left"}onAdd(y){this._map=y,this._compact=this.options&&this.options.compact,this._container=ce.create("div","maplibregl-ctrl");const S=ce.create("a","maplibregl-ctrl-logo");return S.target="_blank",S.rel="noopener nofollow",S.href="https://maplibre.org/",S.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),S.setAttribute("rel","noopener nofollow"),this._container.appendChild(S),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){ce.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class ii{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(y){const S=++this._id;return this._queue.push({callback:y,id:S,cancelled:!1}),S}remove(y){const S=this._currentlyRunning,I=S?this._queue.concat(S):this._queue;for(const C of I)if(C.id===y)return void(C.cancelled=!0)}run(y=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const S=this._currentlyRunning=this._queue;this._queue=[];for(const I of S)if(!I.cancelled&&(I.callback(y),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var ui=M.X([{name:"a_pos3d",type:"Int16",components:3}]);class wl extends M.E{constructor(y){super(),this.sourceCache=y,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,y.usedForTerrain=!0,y.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(y,S){this.sourceCache.update(y,S),this._renderableTilesKeys=[];const I={};for(const C of y.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:S}))I[C.key]=!0,this._renderableTilesKeys.push(C.key),this._tiles[C.key]||(C.posMatrix=new Float64Array(16),M.aN(C.posMatrix,0,M.W,0,M.W,0,1),this._tiles[C.key]=new Gi(C,this.tileSize));for(const C in this._tiles)I[C]||delete this._tiles[C]}freeRtt(y){for(const S in this._tiles){const I=this._tiles[S];(!y||I.tileID.equals(y)||I.tileID.isChildOf(y)||y.isChildOf(I.tileID))&&(I.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(y=>this.getTileByID(y))}getTileByID(y){return this._tiles[y]}getTerrainCoords(y){const S={};for(const I of this._renderableTilesKeys){const C=this._tiles[I].tileID;if(C.canonical.equals(y.canonical)){const z=y.clone();z.posMatrix=new Float64Array(16),M.aN(z.posMatrix,0,M.W,0,M.W,0,1),S[I]=z}else if(C.canonical.isChildOf(y.canonical)){const z=y.clone();z.posMatrix=new Float64Array(16);const N=C.canonical.z-y.canonical.z,U=C.canonical.x-(C.canonical.x>>N<<N),Z=C.canonical.y-(C.canonical.y>>N<<N),K=M.W>>N;M.aN(z.posMatrix,0,K,0,K,0,1),M.H(z.posMatrix,z.posMatrix,[-U*K,-Z*K,0]),S[I]=z}else if(y.canonical.isChildOf(C.canonical)){const z=y.clone();z.posMatrix=new Float64Array(16);const N=y.canonical.z-C.canonical.z,U=y.canonical.x-(y.canonical.x>>N<<N),Z=y.canonical.y-(y.canonical.y>>N<<N),K=M.W>>N;M.aN(z.posMatrix,0,M.W,0,M.W,0,1),M.H(z.posMatrix,z.posMatrix,[U*K,Z*K,0]),M.J(z.posMatrix,z.posMatrix,[1/2**N,1/2**N,0]),S[I]=z}}return S}getSourceTile(y,S){const I=this.sourceCache._source;let C=y.overscaledZ-this.deltaZoom;if(C>I.maxzoom&&(C=I.maxzoom),C<I.minzoom)return null;this._sourceTileCache[y.key]||(this._sourceTileCache[y.key]=y.scaledTo(C).key);let z=this.sourceCache.getTileByID(this._sourceTileCache[y.key]);if((!z||!z.dem)&&S)for(;C>=I.minzoom&&(!z||!z.dem);)z=this.sourceCache.getTileByID(y.scaledTo(C--).key);return z}tilesAfterTime(y=Date.now()){return Object.values(this._tiles).filter(S=>S.timeAdded>=y)}}class Bs{constructor(y,S,I){this.painter=y,this.sourceCache=new wl(S),this.options=I,this.exaggeration=typeof I.exaggeration=="number"?I.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(y,S,I,C=M.W){var z;if(!(S>=0&&S<C&&I>=0&&I<C))return 0;const N=this.getTerrainData(y),U=(z=N.tile)===null||z===void 0?void 0:z.dem;if(!U)return 0;const Z=function(de,ge,le){var Se=ge[0],De=ge[1];return de[0]=le[0]*Se+le[4]*De+le[12],de[1]=le[1]*Se+le[5]*De+le[13],de}([],[S/C*M.W,I/C*M.W],N.u_terrain_matrix),K=[Z[0]*U.dim,Z[1]*U.dim],J=Math.floor(K[0]),Q=Math.floor(K[1]),ne=K[0]-J,fe=K[1]-Q;return U.get(J,Q)*(1-ne)*(1-fe)+U.get(J+1,Q)*ne*(1-fe)+U.get(J,Q+1)*(1-ne)*fe+U.get(J+1,Q+1)*ne*fe}getElevationForLngLatZoom(y,S){const{tileID:I,mercatorX:C,mercatorY:z}=this._getOverscaledTileIDFromLngLatZoom(y,S);return this.getElevation(I,C%M.W,z%M.W,M.W)}getElevation(y,S,I,C=M.W){return this.getDEMElevation(y,S,I,C)*this.exaggeration}getTerrainData(y){if(!this._emptyDemTexture){const C=this.painter.context,z=new M.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new ni(C,z,C.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new ni(C,new M.R({width:1,height:1}),C.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(C.gl.NEAREST,C.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=M.an([])}const S=this.sourceCache.getSourceTile(y,!0);if(S&&S.dem&&(!S.demTexture||S.needsTerrainPrepare)){const C=this.painter.context;S.demTexture=this.painter.getTileTexture(S.dem.stride),S.demTexture?S.demTexture.update(S.dem.getPixels(),{premultiply:!1}):S.demTexture=new ni(C,S.dem.getPixels(),C.gl.RGBA,{premultiply:!1}),S.demTexture.bind(C.gl.NEAREST,C.gl.CLAMP_TO_EDGE),S.needsTerrainPrepare=!1}const I=S&&S+S.tileID.key+y.key;if(I&&!this._demMatrixCache[I]){const C=this.sourceCache.sourceCache._source.maxzoom;let z=y.canonical.z-S.tileID.canonical.z;y.overscaledZ>y.canonical.z&&(y.canonical.z>=C?z=y.canonical.z-C:M.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const N=y.canonical.x-(y.canonical.x>>z<<z),U=y.canonical.y-(y.canonical.y>>z<<z),Z=M.b9(new Float64Array(16),[1/(M.W<<z),1/(M.W<<z),0]);M.H(Z,Z,[N*M.W,U*M.W,0]),this._demMatrixCache[y.key]={matrix:Z,coord:y}}return{u_depth:2,u_terrain:3,u_terrain_dim:S&&S.dem&&S.dem.dim||1,u_terrain_matrix:I?this._demMatrixCache[y.key].matrix:this._emptyDemMatrix,u_terrain_unpack:S&&S.dem&&S.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(S&&S.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:S}}getFramebuffer(y){const S=this.painter,I=S.width/devicePixelRatio,C=S.height/devicePixelRatio;return!this._fbo||this._fbo.width===I&&this._fbo.height===C||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new ni(S.context,{width:I,height:C,data:null},S.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(S.context.gl.NEAREST,S.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new ni(S.context,{width:I,height:C,data:null},S.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(S.context.gl.NEAREST,S.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=S.context.createFramebuffer(I,C,!0,!1),this._fbo.depthAttachment.set(S.context.createRenderbuffer(S.context.gl.DEPTH_COMPONENT16,I,C))),this._fbo.colorAttachment.set(y==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const y=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const S=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let z=0,N=0;z<this._coordsTextureSize;z++)for(let U=0;U<this._coordsTextureSize;U++,N+=4)S[N+0]=255&U,S[N+1]=255&z,S[N+2]=U>>8<<4|z>>8,S[N+3]=0;const I=new M.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(S.buffer)),C=new ni(y,I,y.gl.RGBA,{premultiply:!1});return C.bind(y.gl.NEAREST,y.gl.CLAMP_TO_EDGE),this._coordsTexture=C,C}pointCoordinate(y){this.painter.maybeDrawDepthAndCoords(!0);const S=new Uint8Array(4),I=this.painter.context,C=I.gl;I.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),C.readPixels(y.x,this.painter.height/devicePixelRatio-y.y-1,1,1,C.RGBA,C.UNSIGNED_BYTE,S),I.bindFramebuffer.set(null);const z=S[0]+(S[2]>>4<<8),N=S[1]+((15&S[2])<<8),U=this.coordsIndex[255-S[3]],Z=U&&this.sourceCache.getTileByID(U);if(!Z)return null;const K=this._coordsTextureSize,J=(1<<Z.tileID.canonical.z)*K;return new M.Y((Z.tileID.canonical.x*K+z)/J+Z.tileID.wrap,(Z.tileID.canonical.y*K+N)/J,this.getElevation(Z.tileID,z,N,K))}depthAtPoint(y){const S=new Uint8Array(4),I=this.painter.context,C=I.gl;return I.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),C.readPixels(y.x,this.painter.height/devicePixelRatio-y.y-1,1,1,C.RGBA,C.UNSIGNED_BYTE,S),I.bindFramebuffer.set(null),(S[0]/16777216+S[1]/65536+S[2]/256+S[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const y=this.painter.context,S=new M.ba,I=new M.aX,C=this.meshSize,z=M.W/C,N=C*C;for(let Q=0;Q<=C;Q++)for(let ne=0;ne<=C;ne++)S.emplaceBack(ne*z,Q*z,0);for(let Q=0;Q<N;Q+=C+1)for(let ne=0;ne<C;ne++)I.emplaceBack(ne+Q,C+ne+Q+1,C+ne+Q+2),I.emplaceBack(ne+Q,C+ne+Q+2,ne+Q+1);const U=S.length,Z=U+2*(C+1);for(const Q of[0,1])for(let ne=0;ne<=C;ne++)for(const fe of[0,1])S.emplaceBack(ne*z,Q*M.W,fe);for(let Q=0;Q<2*C;Q+=2)I.emplaceBack(Z+Q,Z+Q+1,Z+Q+3),I.emplaceBack(Z+Q,Z+Q+3,Z+Q+2),I.emplaceBack(U+Q,U+Q+3,U+Q+1),I.emplaceBack(U+Q,U+Q+2,U+Q+3);const K=S.length,J=K+2*(C+1);for(const Q of[0,1])for(let ne=0;ne<=C;ne++)for(const fe of[0,1])S.emplaceBack(Q*M.W,ne*z,fe);for(let Q=0;Q<2*C;Q+=2)I.emplaceBack(K+Q,K+Q+1,K+Q+3),I.emplaceBack(K+Q,K+Q+3,K+Q+2),I.emplaceBack(J+Q,J+Q+3,J+Q+1),I.emplaceBack(J+Q,J+Q+2,J+Q+3);return this._mesh={indexBuffer:y.createIndexBuffer(I),vertexBuffer:y.createVertexBuffer(S,ui.members),segments:M.$.simpleSegment(0,0,S.length,I.length)},this._mesh}getMeshFrameDelta(y){return 2*Math.PI*M.bb/Math.pow(2,y)/5}getMinTileElevationForLngLatZoom(y,S){var I;const{tileID:C}=this._getOverscaledTileIDFromLngLatZoom(y,S);return(I=this.getMinMaxElevation(C).minElevation)!==null&&I!==void 0?I:0}getMinMaxElevation(y){const S=this.getTerrainData(y).tile,I={minElevation:null,maxElevation:null};return S&&S.dem&&(I.minElevation=S.dem.min*this.exaggeration,I.maxElevation=S.dem.max*this.exaggeration),I}_getOverscaledTileIDFromLngLatZoom(y,S){const I=M.Y.fromLngLat(y.wrap()),C=(1<<S)*M.W,z=I.x*C,N=I.y*C,U=Math.floor(z/M.W),Z=Math.floor(N/M.W);return{tileID:new M.Q(S,0,S,U,Z),mercatorX:z,mercatorY:N}}}class pa{constructor(y,S,I){this._context=y,this._size=S,this._tileSize=I,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const y of this._objects)y.texture.destroy(),y.fbo.destroy()}_createObject(y){const S=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),I=new ni(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return I.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),S.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),S.colorAttachment.set(I.texture),{id:y,fbo:S,texture:I,stamp:-1,inUse:!1}}getObjectForId(y){return this._objects[y]}useObject(y){y.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(S=>y.id!==S),this._recentlyUsed.push(y.id)}stampObject(y){y.stamp=++this._stamp}getOrCreateFreeObject(){for(const S of this._recentlyUsed)if(!this._objects[S].inUse)return this._objects[S];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const y=this._createObject(this._objects.length);return this._objects.push(y),y}freeObject(y){y.inUse=!1}freeAllObjects(){for(const y of this._objects)this.freeObject(y)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(y=>!y.inUse)===!1}}const ln={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class lo{constructor(y,S){this.painter=y,this.terrain=S,this.pool=new pa(y.context,30,S.sourceCache.tileSize*S.qualityFactor)}destruct(){this.pool.destruct()}getTexture(y){return this.pool.getObjectForId(y.rtt[this._stacks.length-1].id).texture}prepareForRender(y,S){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=y._order.filter(I=>!y._layers[I].isHidden(S)),this._coordsDescendingInv={};for(const I in y.sourceCaches){this._coordsDescendingInv[I]={};const C=y.sourceCaches[I].getVisibleCoordinates();for(const z of C){const N=this.terrain.sourceCache.getTerrainCoords(z);for(const U in N)this._coordsDescendingInv[I][U]||(this._coordsDescendingInv[I][U]=[]),this._coordsDescendingInv[I][U].push(N[U])}}this._coordsDescendingInvStr={};for(const I of y._order){const C=y._layers[I],z=C.source;if(ln[C.type]&&!this._coordsDescendingInvStr[z]){this._coordsDescendingInvStr[z]={};for(const N in this._coordsDescendingInv[z])this._coordsDescendingInvStr[z][N]=this._coordsDescendingInv[z][N].map(U=>U.key).sort().join()}}for(const I of this._renderableTiles)for(const C in this._coordsDescendingInvStr){const z=this._coordsDescendingInvStr[C][I.tileID.key];z&&z!==I.rttCoords[C]&&(I.rtt=[])}}renderLayer(y){if(y.isHidden(this.painter.transform.zoom))return!1;const S=y.type,I=this.painter,C=this._renderableLayerIds[this._renderableLayerIds.length-1]===y.id;if(ln[S]&&(this._prevType&&ln[this._prevType]||this._stacks.push([]),this._prevType=S,this._stacks[this._stacks.length-1].push(y.id),!C))return!0;if(ln[this._prevType]||ln[S]&&C){this._prevType=S;const z=this._stacks.length-1,N=this._stacks[z]||[];for(const U of this._renderableTiles){if(this.pool.isFull()&&(Wa(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(U),U.rtt[z]){const K=this.pool.getObjectForId(U.rtt[z].id);if(K.stamp===U.rtt[z].stamp){this.pool.useObject(K);continue}}const Z=this.pool.getOrCreateFreeObject();this.pool.useObject(Z),this.pool.stampObject(Z),U.rtt[z]={id:Z.id,stamp:Z.stamp},I.context.bindFramebuffer.set(Z.fbo.framebuffer),I.context.clear({color:M.aO.transparent,stencil:0}),I.currentStencilSource=void 0;for(let K=0;K<N.length;K++){const J=I.style._layers[N[K]],Q=J.source?this._coordsDescendingInv[J.source][U.tileID.key]:[U.tileID];I.context.viewport.set([0,0,Z.fbo.width,Z.fbo.height]),I._renderTileClippingMasks(J,Q),I.renderLayer(I,I.style.sourceCaches[J.source],J,Q),J.source&&(U.rttCoords[J.source]=this._coordsDescendingInvStr[J.source][U.tileID.key])}}return Wa(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),ln[S]}return!1}}const co={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Ls=ye,uo={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:Er,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:M.a.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},fa=D=>{D.touchstart=D.dragStart,D.touchmoveWindow=D.dragMove,D.touchend=D.dragEnd},ho={showCompass:!0,showZoom:!0,visualizePitch:!1};class po{constructor(y,S,I=!1){this.mousedown=N=>{this.startMouse(M.e({},N,{ctrlKey:!0,preventDefault:()=>N.preventDefault()}),ce.mousePos(this.element,N)),ce.addEventListener(window,"mousemove",this.mousemove),ce.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=N=>{this.moveMouse(N,ce.mousePos(this.element,N))},this.mouseup=N=>{this.mouseRotate.dragEnd(N),this.mousePitch&&this.mousePitch.dragEnd(N),this.offTemp()},this.touchstart=N=>{N.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ce.touchPos(this.element,N.targetTouches)[0],this.startTouch(N,this._startPos),ce.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),ce.addEventListener(window,"touchend",this.touchend))},this.touchmove=N=>{N.targetTouches.length!==1?this.reset():(this._lastPos=ce.touchPos(this.element,N.targetTouches)[0],this.moveTouch(N,this._lastPos))},this.touchend=N=>{N.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const C=y.dragRotate._mouseRotate.getClickTolerance(),z=y.dragRotate._mousePitch.getClickTolerance();this.element=S,this.mouseRotate=as({clickTolerance:C,enable:!0}),this.touchRotate=(({enable:N,clickTolerance:U,bearingDegreesPerPixelMoved:Z=.8})=>{const K=new eo;return new Hr({clickTolerance:U,move:(J,Q)=>({bearingDelta:(Q.x-J.x)*Z}),moveStateManager:K,enable:N,assignEvents:fa})})({clickTolerance:C,enable:!0}),this.map=y,I&&(this.mousePitch=to({clickTolerance:z,enable:!0}),this.touchPitch=(({enable:N,clickTolerance:U,pitchDegreesPerPixelMoved:Z=-.5})=>{const K=new eo;return new Hr({clickTolerance:U,move:(J,Q)=>({pitchDelta:(Q.y-J.y)*Z}),moveStateManager:K,enable:N,assignEvents:fa})})({clickTolerance:z,enable:!0})),ce.addEventListener(S,"mousedown",this.mousedown),ce.addEventListener(S,"touchstart",this.touchstart,{passive:!1}),ce.addEventListener(S,"touchcancel",this.reset)}startMouse(y,S){this.mouseRotate.dragStart(y,S),this.mousePitch&&this.mousePitch.dragStart(y,S),ce.disableDrag()}startTouch(y,S){this.touchRotate.dragStart(y,S),this.touchPitch&&this.touchPitch.dragStart(y,S),ce.disableDrag()}moveMouse(y,S){const I=this.map,{bearingDelta:C}=this.mouseRotate.dragMove(y,S)||{};if(C&&I.setBearing(I.getBearing()+C),this.mousePitch){const{pitchDelta:z}=this.mousePitch.dragMove(y,S)||{};z&&I.setPitch(I.getPitch()+z)}}moveTouch(y,S){const I=this.map,{bearingDelta:C}=this.touchRotate.dragMove(y,S)||{};if(C&&I.setBearing(I.getBearing()+C),this.touchPitch){const{pitchDelta:z}=this.touchPitch.dragMove(y,S)||{};z&&I.setPitch(I.getPitch()+z)}}off(){const y=this.element;ce.removeEventListener(y,"mousedown",this.mousedown),ce.removeEventListener(y,"touchstart",this.touchstart,{passive:!1}),ce.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),ce.removeEventListener(window,"touchend",this.touchend),ce.removeEventListener(y,"touchcancel",this.reset),this.offTemp()}offTemp(){ce.enableDrag(),ce.removeEventListener(window,"mousemove",this.mousemove),ce.removeEventListener(window,"mouseup",this.mouseup),ce.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),ce.removeEventListener(window,"touchend",this.touchend)}}let Gr;function ma(D,y,S){const I=new M.M(D.lng,D.lat);if(D=new M.M(D.lng,D.lat),y){const C=new M.M(D.lng-360,D.lat),z=new M.M(D.lng+360,D.lat),N=S.locationPoint(D).distSqr(y);S.locationPoint(C).distSqr(y)<N?D=C:S.locationPoint(z).distSqr(y)<N&&(D=z)}for(;Math.abs(D.lng-S.center.lng)>180;){const C=S.locationPoint(D);if(C.x>=0&&C.y>=0&&C.x<=S.width&&C.y<=S.height)break;D.lng>S.center.lng?D.lng-=360:D.lng+=360}return D.lng!==I.lng&&S.locationPoint(D).y>S.height/2-S.getHorizon()?D:I}const Fs={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function ga(D,y,S){const I=D.classList;for(const C in Fs)I.remove(`maplibregl-${S}-anchor-${C}`);I.add(`maplibregl-${S}-anchor-${y}`)}class ls extends M.E{constructor(y){if(super(),this._onKeyPress=S=>{const I=S.code,C=S.charCode||S.keyCode;I!=="Space"&&I!=="Enter"&&C!==32&&C!==13||this.togglePopup()},this._onMapClick=S=>{const I=S.originalEvent.target,C=this._element;this._popup&&(I===C||C.contains(I))&&this.togglePopup()},this._update=S=>{var I;if(!this._map)return;const C=this._map.loaded()&&!this._map.isMoving();((S==null?void 0:S.type)==="terrain"||(S==null?void 0:S.type)==="render"&&!C)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?ma(this._lngLat,this._flatPos,this._map.transform):(I=this._lngLat)===null||I===void 0?void 0:I.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let z="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?z=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(z=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let N="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?N="rotateX(0deg)":this._pitchAlignment==="map"&&(N=`rotateX(${this._map.getPitch()}deg)`),S&&S.type!=="moveend"||(this._pos=this._pos.round()),ce.setTransform(this._element,`${Fs[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${N} ${z}`),we.frameAsync(new AbortController).then(()=>{this._updateOpacity(S&&S.type==="moveend")}).catch(()=>{})},this._onMove=S=>{if(!this._isDragging){const I=this._clickTolerance||this._map._clickTolerance;this._isDragging=S.point.dist(this._pointerdownPos)>=I}this._isDragging&&(this._pos=S.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new M.k("dragstart"))),this.fire(new M.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new M.k("dragend")),this._state="inactive"},this._addDragHandler=S=>{this._element.contains(S.originalEvent.target)&&(S.preventDefault(),this._positionDelta=S.point.sub(this._pos).add(this._offset),this._pointerdownPos=S.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=y&&y.anchor||"center",this._color=y&&y.color||"#3FB1CE",this._scale=y&&y.scale||1,this._draggable=y&&y.draggable||!1,this._clickTolerance=y&&y.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=y&&y.rotation||0,this._rotationAlignment=y&&y.rotationAlignment||"auto",this._pitchAlignment=y&&y.pitchAlignment&&y.pitchAlignment!=="auto"?y.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(y==null?void 0:y.opacity,y==null?void 0:y.opacityWhenCovered),y&&y.element)this._element=y.element,this._offset=M.P.convert(y&&y.offset||[0,0]);else{this._defaultMarker=!0,this._element=ce.create("div"),this._element.setAttribute("aria-label","Map marker");const S=ce.createNS("http://www.w3.org/2000/svg","svg"),I=41,C=27;S.setAttributeNS(null,"display","block"),S.setAttributeNS(null,"height",`${I}px`),S.setAttributeNS(null,"width",`${C}px`),S.setAttributeNS(null,"viewBox",`0 0 ${C} ${I}`);const z=ce.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"stroke","none"),z.setAttributeNS(null,"stroke-width","1"),z.setAttributeNS(null,"fill","none"),z.setAttributeNS(null,"fill-rule","evenodd");const N=ce.createNS("http://www.w3.org/2000/svg","g");N.setAttributeNS(null,"fill-rule","nonzero");const U=ce.createNS("http://www.w3.org/2000/svg","g");U.setAttributeNS(null,"transform","translate(3.0, 29.0)"),U.setAttributeNS(null,"fill","#000000");const Z=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Se of Z){const De=ce.createNS("http://www.w3.org/2000/svg","ellipse");De.setAttributeNS(null,"opacity","0.04"),De.setAttributeNS(null,"cx","10.5"),De.setAttributeNS(null,"cy","5.80029008"),De.setAttributeNS(null,"rx",Se.rx),De.setAttributeNS(null,"ry",Se.ry),U.appendChild(De)}const K=ce.createNS("http://www.w3.org/2000/svg","g");K.setAttributeNS(null,"fill",this._color);const J=ce.createNS("http://www.w3.org/2000/svg","path");J.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),K.appendChild(J);const Q=ce.createNS("http://www.w3.org/2000/svg","g");Q.setAttributeNS(null,"opacity","0.25"),Q.setAttributeNS(null,"fill","#000000");const ne=ce.createNS("http://www.w3.org/2000/svg","path");ne.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Q.appendChild(ne);const fe=ce.createNS("http://www.w3.org/2000/svg","g");fe.setAttributeNS(null,"transform","translate(6.0, 7.0)"),fe.setAttributeNS(null,"fill","#FFFFFF");const de=ce.createNS("http://www.w3.org/2000/svg","g");de.setAttributeNS(null,"transform","translate(8.0, 8.0)");const ge=ce.createNS("http://www.w3.org/2000/svg","circle");ge.setAttributeNS(null,"fill","#000000"),ge.setAttributeNS(null,"opacity","0.25"),ge.setAttributeNS(null,"cx","5.5"),ge.setAttributeNS(null,"cy","5.5"),ge.setAttributeNS(null,"r","5.4999962");const le=ce.createNS("http://www.w3.org/2000/svg","circle");le.setAttributeNS(null,"fill","#FFFFFF"),le.setAttributeNS(null,"cx","5.5"),le.setAttributeNS(null,"cy","5.5"),le.setAttributeNS(null,"r","5.4999962"),de.appendChild(ge),de.appendChild(le),N.appendChild(U),N.appendChild(K),N.appendChild(Q),N.appendChild(fe),N.appendChild(de),S.appendChild(N),S.setAttributeNS(null,"height",I*this._scale+"px"),S.setAttributeNS(null,"width",C*this._scale+"px"),this._element.appendChild(S),this._offset=M.P.convert(y&&y.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",S=>{S.preventDefault()}),this._element.addEventListener("mousedown",S=>{S.preventDefault()}),ga(this._element,this._anchor,"marker"),y&&y.className)for(const S of y.className.split(" "))this._element.classList.add(S);this._popup=null}addTo(y){return this.remove(),this._map=y,y.getCanvasContainer().appendChild(this._element),y.on("move",this._update),y.on("moveend",this._update),y.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),ce.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(y){return this._lngLat=M.M.convert(y),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(y){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),y){if(!("offset"in y.options)){const C=Math.abs(13.5)/Math.SQRT2;y.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[C,-1*(38.1-13.5+C)],"bottom-right":[-C,-1*(38.1-13.5+C)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=y,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const y=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:y?(y.isOpen()?y.remove():(y.setLngLat(this._lngLat),y.addTo(this._map)),this):this}_updateOpacity(y=!1){var S,I;if(!(!((S=this._map)===null||S===void 0)&&S.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(y)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const C=this._map,z=C.terrain.depthAtPoint(this._pos),N=C.terrain.getElevationForLngLatZoom(this._lngLat,C.transform.tileZoom);if(C.transform.lngLatToCameraDepth(this._lngLat,N)-z<.006)return void(this._element.style.opacity=this._opacity);const U=-this._offset.y/C.transform._pixelPerMeter,Z=Math.sin(C.getPitch()*Math.PI/180)*U,K=C.terrain.depthAtPoint(new M.P(this._pos.x,this._pos.y-this._offset.y)),J=C.transform.lngLatToCameraDepth(this._lngLat,N+Z)-K>.006;!((I=this._popup)===null||I===void 0)&&I.isOpen()&&J&&this._popup.remove(),this._element.style.opacity=J?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(y){return this._offset=M.P.convert(y),this._update(),this}addClassName(y){this._element.classList.add(y)}removeClassName(y){this._element.classList.remove(y)}toggleClassName(y){return this._element.classList.toggle(y)}setDraggable(y){return this._draggable=!!y,this._map&&(y?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(y){return this._rotation=y||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(y){return this._rotationAlignment=y||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(y){return this._pitchAlignment=y&&y!=="auto"?y:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(y,S){return y===void 0&&S===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),y!==void 0&&(this._opacity=y),S!==void 0&&(this._opacityWhenCovered=S),this._map&&this._updateOpacity(!0),this}}const fo={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let cs=0,cn=!1;const mo={maxWidth:100,unit:"metric"};function _a(D,y,S){const I=S&&S.maxWidth||100,C=D._container.clientHeight/2,z=D.unproject([0,C]),N=D.unproject([I,C]),U=z.distanceTo(N);if(S&&S.unit==="imperial"){const Z=3.2808*U;Z>5280?Pn(y,I,Z/5280,D._getUIString("ScaleControl.Miles")):Pn(y,I,Z,D._getUIString("ScaleControl.Feet"))}else S&&S.unit==="nautical"?Pn(y,I,U/1852,D._getUIString("ScaleControl.NauticalMiles")):U>=1e3?Pn(y,I,U/1e3,D._getUIString("ScaleControl.Kilometers")):Pn(y,I,U,D._getUIString("ScaleControl.Meters"))}function Pn(D,y,S,I){const C=function(z){const N=Math.pow(10,`${Math.floor(z)}`.length-1);let U=z/N;return U=U>=10?10:U>=5?5:U>=3?3:U>=2?2:U>=1?1:function(Z){const K=Math.pow(10,Math.ceil(-Math.log(Z)/Math.LN10));return Math.round(Z*K)/K}(U),N*U}(S);D.style.width=y*(C/S)+"px",D.innerHTML=`${C}&nbsp;${I}`}const go={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},_o=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function yo(D){if(D){if(typeof D=="number"){const y=Math.round(Math.abs(D)/Math.SQRT2);return{center:new M.P(0,0),top:new M.P(0,D),"top-left":new M.P(y,y),"top-right":new M.P(-y,y),bottom:new M.P(0,-D),"bottom-left":new M.P(y,-y),"bottom-right":new M.P(-y,-y),left:new M.P(D,0),right:new M.P(-D,0)}}if(D instanceof M.P||Array.isArray(D)){const y=M.P.convert(D);return{center:y,top:y,"top-left":y,"top-right":y,bottom:y,"bottom-left":y,"bottom-right":y,left:y,right:y}}return{center:M.P.convert(D.center||[0,0]),top:M.P.convert(D.top||[0,0]),"top-left":M.P.convert(D["top-left"]||[0,0]),"top-right":M.P.convert(D["top-right"]||[0,0]),bottom:M.P.convert(D.bottom||[0,0]),"bottom-left":M.P.convert(D["bottom-left"]||[0,0]),"bottom-right":M.P.convert(D["bottom-right"]||[0,0]),left:M.P.convert(D.left||[0,0]),right:M.P.convert(D.right||[0,0])}}return yo(new M.P(0,0))}const Sl=ye;$.AJAXError=M.be,$.Evented=M.E,$.LngLat=M.M,$.MercatorCoordinate=M.Y,$.Point=M.P,$.addProtocol=M.bf,$.config=M.a,$.removeProtocol=M.bg,$.AttributionControl=bl,$.BoxZoomHandler=ss,$.CanvasSource=Vn,$.CooperativeGesturesHandler=pt,$.DoubleClickZoomHandler=ao,$.DragPanHandler=Sr,$.DragRotateHandler=ks,$.EdgeInsets=Ps,$.FullscreenControl=class extends M.E{constructor(D={}){super(),this._onFullscreenChange=()=>{var y;let S=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((y=S==null?void 0:S.shadowRoot)===null||y===void 0)&&y.fullscreenElement;)S=S.shadowRoot.fullscreenElement;S===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,D&&D.container&&(D.container instanceof HTMLElement?this._container=D.container:M.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(D){return this._map=D,this._container||(this._container=this._map.getContainer()),this._controlContainer=ce.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){ce.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const D=this._fullscreenButton=ce.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);ce.create("span","maplibregl-ctrl-icon",D).setAttribute("aria-hidden","true"),D.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const D=this._getTitle();this._fullscreenButton.setAttribute("aria-label",D),this._fullscreenButton.title=D}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new M.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new M.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},$.GeoJSONSource=Dt,$.GeolocateControl=class extends M.E{constructor(D){super(),this._onSuccess=y=>{if(this._map){if(this._isOutOfMapMaxBounds(y))return this._setErrorState(),this.fire(new M.k("outofmaxbounds",y)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=y,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(y),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(y),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new M.k("geolocate",y)),this._finish()}},this._updateCamera=y=>{const S=new M.M(y.coords.longitude,y.coords.latitude),I=y.coords.accuracy,C=this._map.getBearing(),z=M.e({bearing:C},this.options.fitBoundsOptions),N=mi.fromLngLat(S,I);this._map.fitBounds(N,z,{geolocateSource:!0})},this._updateMarker=y=>{if(y){const S=new M.M(y.coords.longitude,y.coords.latitude);this._accuracyCircleMarker.setLngLat(S).addTo(this._map),this._userLocationDotMarker.setLngLat(S).addTo(this._map),this._accuracy=y.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=y=>{if(this._map){if(this.options.trackUserLocation)if(y.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const S=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=S,this._geolocateButton.setAttribute("aria-label",S),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(y.code===3&&cn)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new M.k("error",y)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=y=>{if(this._map){if(this._container.addEventListener("contextmenu",S=>S.preventDefault()),this._geolocateButton=ce.create("button","maplibregl-ctrl-geolocate",this._container),ce.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",y===!1){M.w("Geolocation support is not available so the GeolocateControl will be disabled.");const S=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=S,this._geolocateButton.setAttribute("aria-label",S)}else{const S=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=S,this._geolocateButton.setAttribute("aria-label",S)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ce.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new ls({element:this._dotElement}),this._circleElement=ce.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ls({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",S=>{S.geolocateSource||this._watchState!=="ACTIVE_LOCK"||S.originalEvent&&S.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new M.k("trackuserlocationend")))})}},this.options=M.e({},fo,D)}onAdd(D){return this._map=D,this._container=ce.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(){return M._(this,arguments,void 0,function*(y=!1){if(Gr!==void 0&&!y)return Gr;if(window.navigator.permissions===void 0)return Gr=!!window.navigator.geolocation,Gr;try{Gr=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Gr=!!window.navigator.geolocation}return Gr})}().then(y=>this._setupUI(y)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),ce.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,cs=0,cn=!1}_isOutOfMapMaxBounds(D){const y=this._map.getMaxBounds(),S=D.coords;return y&&(S.longitude<y.getWest()||S.longitude>y.getEast()||S.latitude<y.getSouth()||S.latitude>y.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const D=this._map.getBounds(),y=D.getSouthEast(),S=D.getNorthEast(),I=y.distanceTo(S),C=Math.ceil(this._accuracy/(I/this._map._container.clientHeight)*2);this._circleElement.style.width=`${C}px`,this._circleElement.style.height=`${C}px`}trigger(){if(!this._setup)return M.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new M.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":cs--,cn=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new M.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new M.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let D;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),cs++,cs>1?(D={maximumAge:6e5,timeout:0},cn=!0):(D=this.options.positionOptions,cn=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,D)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},$.Hash=Ya,$.ImageSource=kr,$.KeyboardHandler=Kt,$.LngLatBounds=mi,$.LogoControl=os,$.Map=class extends vl{constructor(D){if(M.bc.mark(M.bd.create),(D=M.e({},uo,D)).minZoom!=null&&D.maxZoom!=null&&D.minZoom>D.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(D.minPitch!=null&&D.maxPitch!=null&&D.minPitch>D.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(D.minPitch!=null&&D.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(D.maxPitch!=null&&D.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new la(D.minZoom,D.maxZoom,D.minPitch,D.maxPitch,D.renderWorldCopies),{bearingSnap:D.bearingSnap}),this._contextLost=y=>{y.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new M.k("webglcontextlost",{originalEvent:y}))},this._contextRestored=y=>{this._setupPainter(),this.resize(),this._update(),this.fire(new M.k("webglcontextrestored",{originalEvent:y}))},this._onMapScroll=y=>{if(y.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=D.interactive,this._maxTileCacheSize=D.maxTileCacheSize,this._maxTileCacheZoomLevels=D.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=D.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=D.preserveDrawingBuffer,this._antialias=D.antialias,this._trackResize=D.trackResize,this._bearingSnap=D.bearingSnap,this._refreshExpiredTiles=D.refreshExpiredTiles,this._fadeDuration=D.fadeDuration,this._crossSourceCollisions=D.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=D.collectResourceTiming,this._renderTaskQueue=new ii,this._controls=[],this._mapId=M.a3(),this._locale=M.e({},co,D.locale),this._clickTolerance=D.clickTolerance,this._overridePixelRatio=D.pixelRatio,this._maxCanvasSize=D.maxCanvasSize,this.transformCameraUpdate=D.transformCameraUpdate,this._imageQueueHandle=Ft.addThrottleControl(()=>this.isMoving()),this._requestManager=new Ci(D.transformRequest),typeof D.container=="string"){if(this._container=document.getElementById(D.container),!this._container)throw new Error(`Container '${D.container}' not found.`)}else{if(!(D.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=D.container}if(D.maxBounds&&this.setMaxBounds(D.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let y=!1;const S=Xa(I=>{this._trackResize&&!this._removed&&this.resize(I)._update()},50);this._resizeObserver=new ResizeObserver(I=>{y?S(I):y=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Ki(this,D),this._hash=D.hash&&new Ya(typeof D.hash=="string"&&D.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:D.center,zoom:D.zoom,bearing:D.bearing,pitch:D.pitch}),D.bounds&&(this.resize(),this.fitBounds(D.bounds,M.e({},D.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=D.localIdeographFontFamily,this._validateStyle=D.validateStyle,D.style&&this.setStyle(D.style,{localIdeographFontFamily:D.localIdeographFontFamily}),D.attributionControl&&this.addControl(new bl(typeof D.attributionControl=="boolean"?void 0:D.attributionControl)),D.maplibreLogo&&this.addControl(new os,D.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",y=>{this._update(y.dataType==="style"),this.fire(new M.k(`${y.dataType}data`,y))}),this.on("dataloading",y=>{this.fire(new M.k(`${y.dataType}dataloading`,y))}),this.on("dataabort",y=>{this.fire(new M.k("sourcedataabort",y))})}_getMapId(){return this._mapId}addControl(D,y){if(y===void 0&&(y=D.getDefaultPosition?D.getDefaultPosition():"top-right"),!D||!D.onAdd)return this.fire(new M.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const S=D.onAdd(this);this._controls.push(D);const I=this._controlPositions[y];return y.indexOf("bottom")!==-1?I.insertBefore(S,I.firstChild):I.appendChild(S),this}removeControl(D){if(!D||!D.onRemove)return this.fire(new M.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const y=this._controls.indexOf(D);return y>-1&&this._controls.splice(y,1),D.onRemove(this),this}hasControl(D){return this._controls.indexOf(D)>-1}calculateCameraOptionsFromTo(D,y,S,I){return I==null&&this.terrain&&(I=this.terrain.getElevationForLngLatZoom(S,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(D,y,S,I)}resize(D){var y;const S=this._containerDimensions(),I=S[0],C=S[1],z=this._getClampedPixelRatio(I,C);if(this._resizeCanvas(I,C,z),this.painter.resize(I,C,z),this.painter.overLimit()){const U=this.painter.context.gl;this._maxCanvasSize=[U.drawingBufferWidth,U.drawingBufferHeight];const Z=this._getClampedPixelRatio(I,C);this._resizeCanvas(I,C,Z),this.painter.resize(I,C,Z)}this.transform.resize(I,C),(y=this._requestedCameraState)===null||y===void 0||y.resize(I,C);const N=!this._moving;return N&&(this.stop(),this.fire(new M.k("movestart",D)).fire(new M.k("move",D))),this.fire(new M.k("resize",D)),N&&this.fire(new M.k("moveend",D)),this}_getClampedPixelRatio(D,y){const{0:S,1:I}=this._maxCanvasSize,C=this.getPixelRatio(),z=D*C,N=y*C;return Math.min(z>S?S/z:1,N>I?I/N:1)*C}getPixelRatio(){var D;return(D=this._overridePixelRatio)!==null&&D!==void 0?D:devicePixelRatio}setPixelRatio(D){this._overridePixelRatio=D,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(D){return this.transform.setMaxBounds(mi.convert(D)),this._update()}setMinZoom(D){if((D=D??-2)>=-2&&D<=this.transform.maxZoom)return this.transform.minZoom=D,this._update(),this.getZoom()<D&&this.setZoom(D),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(D){if((D=D??22)>=this.transform.minZoom)return this.transform.maxZoom=D,this._update(),this.getZoom()>D&&this.setZoom(D),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(D){if((D=D??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(D>=0&&D<=this.transform.maxPitch)return this.transform.minPitch=D,this._update(),this.getPitch()<D&&this.setPitch(D),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(D){if((D=D??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(D>=this.transform.minPitch)return this.transform.maxPitch=D,this._update(),this.getPitch()>D&&this.setPitch(D),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(D){return this.transform.renderWorldCopies=D,this._update()}project(D){return this.transform.locationPoint(M.M.convert(D),this.style&&this.terrain)}unproject(D){return this.transform.pointLocation(M.P.convert(D),this.terrain)}isMoving(){var D;return this._moving||((D=this.handlers)===null||D===void 0?void 0:D.isMoving())}isZooming(){var D;return this._zooming||((D=this.handlers)===null||D===void 0?void 0:D.isZooming())}isRotating(){var D;return this._rotating||((D=this.handlers)===null||D===void 0?void 0:D.isRotating())}_createDelegatedListener(D,y,S){if(D==="mouseenter"||D==="mouseover"){let I=!1;return{layer:y,listener:S,delegates:{mousemove:z=>{const N=this.getLayer(y)?this.queryRenderedFeatures(z.point,{layers:[y]}):[];N.length?I||(I=!0,S.call(this,new Si(D,this,z.originalEvent,{features:N}))):I=!1},mouseout:()=>{I=!1}}}}if(D==="mouseleave"||D==="mouseout"){let I=!1;return{layer:y,listener:S,delegates:{mousemove:N=>{(this.getLayer(y)?this.queryRenderedFeatures(N.point,{layers:[y]}):[]).length?I=!0:I&&(I=!1,S.call(this,new Si(D,this,N.originalEvent)))},mouseout:N=>{I&&(I=!1,S.call(this,new Si(D,this,N.originalEvent)))}}}}{const I=C=>{const z=this.getLayer(y)?this.queryRenderedFeatures(C.point,{layers:[y]}):[];z.length&&(C.features=z,S.call(this,C),delete C.features)};return{layer:y,listener:S,delegates:{[D]:I}}}}on(D,y,S){if(S===void 0)return super.on(D,y);const I=this._createDelegatedListener(D,y,S);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[D]=this._delegatedListeners[D]||[],this._delegatedListeners[D].push(I);for(const C in I.delegates)this.on(C,I.delegates[C]);return this}once(D,y,S){if(S===void 0)return super.once(D,y);const I=this._createDelegatedListener(D,y,S);for(const C in I.delegates)this.once(C,I.delegates[C]);return this}off(D,y,S){return S===void 0?super.off(D,y):(this._delegatedListeners&&this._delegatedListeners[D]&&(I=>{const C=this._delegatedListeners[D];for(let z=0;z<C.length;z++){const N=C[z];if(N.layer===y&&N.listener===S){for(const U in N.delegates)this.off(U,N.delegates[U]);return C.splice(z,1),this}}})(),this)}queryRenderedFeatures(D,y){if(!this.style)return[];let S;const I=D instanceof M.P||Array.isArray(D),C=I?D:[[0,0],[this.transform.width,this.transform.height]];if(y=y||(I?{}:D)||{},C instanceof M.P||typeof C[0]=="number")S=[M.P.convert(C)];else{const z=M.P.convert(C[0]),N=M.P.convert(C[1]);S=[z,new M.P(N.x,z.y),N,new M.P(z.x,N.y),z]}return this.style.queryRenderedFeatures(S,y,this.transform)}querySourceFeatures(D,y){return this.style.querySourceFeatures(D,y)}setStyle(D,y){return(y=M.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},y)).diff!==!1&&y.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&D?(this._diffStyle(D,y),this):(this._localIdeographFontFamily=y.localIdeographFontFamily,this._updateStyle(D,y))}setTransformRequest(D){return this._requestManager.setTransformRequest(D),this}_getUIString(D){const y=this._locale[D];if(y==null)throw new Error(`Missing UI string '${D}'`);return y}_updateStyle(D,y){if(y.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(D,y));const S=this.style&&y.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!D)),D?(this.style=new Hs(this,y||{}),this.style.setEventedParent(this,{style:this.style}),typeof D=="string"?this.style.loadURL(D,y,S):this.style.loadJSON(D,y,S),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Hs(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(D,y){if(typeof D=="string"){const S=this._requestManager.transformRequest(D,Nt.Style);M.h(S,new AbortController).then(I=>{this._updateDiff(I.data,y)}).catch(I=>{I&&this.fire(new M.j(I))})}else typeof D=="object"&&this._updateDiff(D,y)}_updateDiff(D,y){try{this.style.setState(D,y)&&this._update(!0)}catch(S){M.w(`Unable to perform style diff: ${S.message||S.error||S}.  Rebuilding the style from scratch.`),this._updateStyle(D,y)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():M.w("There is no style added to the map.")}addSource(D,y){return this._lazyInitEmptyStyle(),this.style.addSource(D,y),this._update(!0)}isSourceLoaded(D){const y=this.style&&this.style.sourceCaches[D];if(y!==void 0)return y.loaded();this.fire(new M.j(new Error(`There is no source with ID '${D}'`)))}setTerrain(D){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),D){const y=this.style.sourceCaches[D.source];if(!y)throw new Error(`cannot load terrain, because there exists no source with ID: ${D.source}`);this.terrain===null&&y.reload();for(const S in this.style._layers){const I=this.style._layers[S];I.type==="hillshade"&&I.source===D.source&&M.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Bs(this.painter,y,D),this.painter.renderToTexture=new lo(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=S=>{S.dataType==="style"?this.terrain.sourceCache.freeRtt():S.dataType==="source"&&S.tile&&(S.sourceId!==D.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(S.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new M.k("terrain",{terrain:D})),this}getTerrain(){var D,y;return(y=(D=this.terrain)===null||D===void 0?void 0:D.options)!==null&&y!==void 0?y:null}areTilesLoaded(){const D=this.style&&this.style.sourceCaches;for(const y in D){const S=D[y]._tiles;for(const I in S){const C=S[I];if(C.state!=="loaded"&&C.state!=="errored")return!1}}return!0}removeSource(D){return this.style.removeSource(D),this._update(!0)}getSource(D){return this.style.getSource(D)}addImage(D,y,S={}){const{pixelRatio:I=1,sdf:C=!1,stretchX:z,stretchY:N,content:U}=S;if(this._lazyInitEmptyStyle(),!(y instanceof HTMLImageElement||M.b(y))){if(y.width===void 0||y.height===void 0)return this.fire(new M.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:Z,height:K,data:J}=y,Q=y;return this.style.addImage(D,{data:new M.R({width:Z,height:K},new Uint8Array(J)),pixelRatio:I,stretchX:z,stretchY:N,content:U,sdf:C,version:0,userImage:Q}),Q.onAdd&&Q.onAdd(this,D),this}}{const{width:Z,height:K,data:J}=we.getImageData(y);this.style.addImage(D,{data:new M.R({width:Z,height:K},J),pixelRatio:I,stretchX:z,stretchY:N,content:U,sdf:C,version:0})}}updateImage(D,y){const S=this.style.getImage(D);if(!S)return this.fire(new M.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const I=y instanceof HTMLImageElement||M.b(y)?we.getImageData(y):y,{width:C,height:z,data:N}=I;if(C===void 0||z===void 0)return this.fire(new M.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(C!==S.data.width||z!==S.data.height)return this.fire(new M.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const U=!(y instanceof HTMLImageElement||M.b(y));return S.data.replace(N,U),this.style.updateImage(D,S),this}getImage(D){return this.style.getImage(D)}hasImage(D){return D?!!this.style.getImage(D):(this.fire(new M.j(new Error("Missing required image id"))),!1)}removeImage(D){this.style.removeImage(D)}loadImage(D){return Ft.getImage(this._requestManager.transformRequest(D,Nt.Image),new AbortController)}listImages(){return this.style.listImages()}addLayer(D,y){return this._lazyInitEmptyStyle(),this.style.addLayer(D,y),this._update(!0)}moveLayer(D,y){return this.style.moveLayer(D,y),this._update(!0)}removeLayer(D){return this.style.removeLayer(D),this._update(!0)}getLayer(D){return this.style.getLayer(D)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(D,y,S){return this.style.setLayerZoomRange(D,y,S),this._update(!0)}setFilter(D,y,S={}){return this.style.setFilter(D,y,S),this._update(!0)}getFilter(D){return this.style.getFilter(D)}setPaintProperty(D,y,S,I={}){return this.style.setPaintProperty(D,y,S,I),this._update(!0)}getPaintProperty(D,y){return this.style.getPaintProperty(D,y)}setLayoutProperty(D,y,S,I={}){return this.style.setLayoutProperty(D,y,S,I),this._update(!0)}getLayoutProperty(D,y){return this.style.getLayoutProperty(D,y)}setGlyphs(D,y={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(D,y),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(D,y,S={}){return this._lazyInitEmptyStyle(),this.style.addSprite(D,y,S,I=>{I||this._update(!0)}),this}removeSprite(D){return this._lazyInitEmptyStyle(),this.style.removeSprite(D),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(D,y={}){return this._lazyInitEmptyStyle(),this.style.setSprite(D,y,S=>{S||this._update(!0)}),this}setLight(D,y={}){return this._lazyInitEmptyStyle(),this.style.setLight(D,y),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(D,y){return this.style.setFeatureState(D,y),this._update()}removeFeatureState(D,y){return this.style.removeFeatureState(D,y),this._update()}getFeatureState(D){return this.style.getFeatureState(D)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let D=0,y=0;return this._container&&(D=this._container.clientWidth||400,y=this._container.clientHeight||300),[D,y]}_setupContainer(){const D=this._container;D.classList.add("maplibregl-map");const y=this._canvasContainer=ce.create("div","maplibregl-canvas-container",D);this._interactive&&y.classList.add("maplibregl-interactive"),this._canvas=ce.create("canvas","maplibregl-canvas",y),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const S=this._containerDimensions(),I=this._getClampedPixelRatio(S[0],S[1]);this._resizeCanvas(S[0],S[1],I);const C=this._controlContainer=ce.create("div","maplibregl-control-container",D),z=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(N=>{z[N]=ce.create("div",`maplibregl-ctrl-${N} `,C)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(D,y,S){this._canvas.width=Math.floor(S*D),this._canvas.height=Math.floor(S*y),this._canvas.style.width=`${D}px`,this._canvas.style.height=`${y}px`}_setupPainter(){const D={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let y=null;this._canvas.addEventListener("webglcontextcreationerror",I=>{y={requestedAttributes:D},I&&(y.statusMessage=I.statusMessage,y.type=I.type)},{once:!0});const S=this._canvas.getContext("webgl2",D)||this._canvas.getContext("webgl",D);if(!S){const I="Failed to initialize WebGL";throw y?(y.message=I,new Error(JSON.stringify(y))):new Error(I)}this.painter=new is(S,this.transform),$e.testSupport(S)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(D){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||D,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(D){return this._update(),this._renderTaskQueue.add(D)}_cancelRenderFrame(D){this._renderTaskQueue.remove(D)}_render(D){const y=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(D),this._removed)return;let S=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const C=this.transform.zoom,z=we.now();this.style.zoomHistory.update(C,z);const N=new M.a8(C,{now:z,fadeDuration:y,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),U=N.crossFadingFactor();U===1&&U===this._crossFadingFactor||(S=!0,this._crossFadingFactor=U),this.style.update(N)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,y,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:y,showPadding:this.showPadding}),this.fire(new M.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,M.bc.mark(M.bd.load),this.fire(new M.k("load"))),this.style&&(this.style.hasTransitions()||S)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const I=this._sourcesDirty||this._styleDirty||this._placementDirty;return I||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new M.k("idle")),!this._loaded||this._fullyLoaded||I||(this._fullyLoaded=!0,M.bc.mark(M.bd.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var D;this._hash&&this._hash.remove();for(const S of this._controls)S.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Ft.removeThrottleControl(this._imageQueueHandle),(D=this._resizeObserver)===null||D===void 0||D.disconnect();const y=this.painter.context.gl.getExtension("WEBGL_lose_context");y&&y.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),ce.remove(this._canvasContainer),ce.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),M.bc.clearMetrics(),this._removed=!0,this.fire(new M.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,we.frameAsync(this._frameRequest).then(D=>{M.bc.frame(D),this._frameRequest=null,this._render(D)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(D){this._showTileBoundaries!==D&&(this._showTileBoundaries=D,this._update())}get showPadding(){return!!this._showPadding}set showPadding(D){this._showPadding!==D&&(this._showPadding=D,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(D){this._showCollisionBoxes!==D&&(this._showCollisionBoxes=D,D?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(D){this._showOverdrawInspector!==D&&(this._showOverdrawInspector=D,this._update())}get repaint(){return!!this._repaint}set repaint(D){this._repaint!==D&&(this._repaint=D,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(D){this._vertices=D,this._update()}get version(){return Ls}getCameraTargetElevation(){return this.transform.elevation}},$.MapMouseEvent=Si,$.MapTouchEvent=ns,$.MapWheelEvent=_r,$.Marker=ls,$.NavigationControl=class{constructor(D){this._updateZoomButtons=()=>{const y=this._map.getZoom(),S=y===this._map.getMaxZoom(),I=y===this._map.getMinZoom();this._zoomInButton.disabled=S,this._zoomOutButton.disabled=I,this._zoomInButton.setAttribute("aria-disabled",S.toString()),this._zoomOutButton.setAttribute("aria-disabled",I.toString())},this._rotateCompassArrow=()=>{const y=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=y},this._setButtonTitle=(y,S)=>{const I=this._map._getUIString(`NavigationControl.${S}`);y.title=I,y.setAttribute("aria-label",I)},this.options=M.e({},ho,D),this._container=ce.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",y=>y.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",y=>this._map.zoomIn({},{originalEvent:y})),ce.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",y=>this._map.zoomOut({},{originalEvent:y})),ce.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",y=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:y}):this._map.resetNorth({},{originalEvent:y})}),this._compassIcon=ce.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(D){return this._map=D,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new po(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){ce.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(D,y){const S=ce.create("button",D,this._container);return S.type="button",S.addEventListener("click",y),S}},$.Popup=class extends M.E{constructor(D){super(),this.remove=()=>(this._content&&ce.remove(this._content),this._container&&(ce.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new M.k("close"))),this),this._onMouseUp=y=>{this._update(y.point)},this._onMouseMove=y=>{this._update(y.point)},this._onDrag=y=>{this._update(y.point)},this._update=y=>{var S;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=ce.create("div","maplibregl-popup",this._map.getContainer()),this._tip=ce.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const U of this.options.className.split(" "))this._container.classList.add(U);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?ma(this._lngLat,this._flatPos,this._map.transform):(S=this._lngLat)===null||S===void 0?void 0:S.wrap(),this._trackPointer&&!y)return;const I=this._flatPos=this._pos=this._trackPointer&&y?y:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&y?y:this._map.transform.locationPoint(this._lngLat));let C=this.options.anchor;const z=yo(this.options.offset);if(!C){const U=this._container.offsetWidth,Z=this._container.offsetHeight;let K;K=I.y+z.bottom.y<Z?["top"]:I.y>this._map.transform.height-Z?["bottom"]:[],I.x<U/2?K.push("left"):I.x>this._map.transform.width-U/2&&K.push("right"),C=K.length===0?"bottom":K.join("-")}let N=I.add(z[C]);this.options.subpixelPositioning||(N=N.round()),ce.setTransform(this._container,`${Fs[C]} translate(${N.x}px,${N.y}px)`),ga(this._container,C,"popup")},this._onClose=()=>{this.remove()},this.options=M.e(Object.create(go),D)}addTo(D){return this._map&&this.remove(),this._map=D,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new M.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(D){return this._lngLat=M.M.convert(D),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(D){return this.setDOMContent(document.createTextNode(D))}setHTML(D){const y=document.createDocumentFragment(),S=document.createElement("body");let I;for(S.innerHTML=D;I=S.firstChild,I;)y.appendChild(I);return this.setDOMContent(y)}getMaxWidth(){var D;return(D=this._container)===null||D===void 0?void 0:D.style.maxWidth}setMaxWidth(D){return this.options.maxWidth=D,this._update(),this}setDOMContent(D){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=ce.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(D),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(D){this._container&&this._container.classList.add(D)}removeClassName(D){this._container&&this._container.classList.remove(D)}setOffset(D){return this.options.offset=D,this._update(),this}toggleClassName(D){if(this._container)return this._container.classList.toggle(D)}setSubpixelPositioning(D){this.options.subpixelPositioning=D}_createCloseButton(){this.options.closeButton&&(this._closeButton=ce.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const D=this._container.querySelector(_o);D&&D.focus()}},$.RasterDEMTileSource=ys,$.RasterTileSource=_n,$.ScaleControl=class{constructor(D){this._onMove=()=>{_a(this._map,this._container,this.options)},this.setUnit=y=>{this.options.unit=y,_a(this._map,this._container,this.options)},this.options=M.e({},mo,D)}getDefaultPosition(){return"bottom-left"}onAdd(D){return this._map=D,this._container=ce.create("div","maplibregl-ctrl maplibregl-ctrl-scale",D.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){ce.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},$.ScrollZoomHandler=so,$.Style=Hs,$.TerrainControl=class{constructor(D){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=D}onAdd(D){return this._map=D,this._container=ce.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=ce.create("button","maplibregl-ctrl-terrain",this._container),ce.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){ce.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},$.TwoFingersTouchPitchHandler=yl,$.TwoFingersTouchRotateHandler=ro,$.TwoFingersTouchZoomHandler=ua,$.TwoFingersTouchZoomRotateHandler=ut,$.VectorTileSource=Le,$.VideoSource=Un,$.addSourceType=(D,y)=>M._(void 0,void 0,void 0,function*(){if(yn(D))throw new Error(`A source type called "${D}" already exists.`);((S,I)=>{qn[S]=I})(D,y)}),$.clearPrewarmedResources=function(){const D=qr;D&&(D.isPreloaded()&&D.numActive()===1?(D.release(fn),qr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},$.getMaxParallelImageRequests=function(){return M.a.MAX_PARALLEL_IMAGE_REQUESTS},$.getRTLTextPluginStatus=function(){return rr().getRTLTextPluginStatus()},$.getVersion=function(){return Sl},$.getWorkerCount=function(){return Dr.workerCount},$.getWorkerUrl=function(){return M.a.WORKER_URL},$.importScriptInWorkers=function(D){return Qr().broadcast("importScript",D)},$.prewarm=function(){br().acquire(fn)},$.setMaxParallelImageRequests=function(D){M.a.MAX_PARALLEL_IMAGE_REQUESTS=D},$.setRTLTextPlugin=function(D,y){return rr().setRTLTextPlugin(D,y)},$.setWorkerCount=function(D){Dr.workerCount=D},$.setWorkerUrl=function(D){M.a.WORKER_URL=D}});var H=R;return H})})(maplibreGl);var maplibreGlExports=maplibreGl.exports;const maplibregl=getDefaultExportFromCjs(maplibreGlExports);function getCurrentPosition(){return new Promise((E,A)=>{navigator.geolocation.getCurrentPosition(R=>E(R),R=>A(R))})}const _withScopeId=E=>(pushScopeId("data-v-e6afbbca"),E=E(),popScopeId(),E),_hoisted_1={class:"px-8 pt-6 pb-8 mb-4 bg-white rounded shadow-md"},_hoisted_2=_withScopeId(()=>createBaseVNode("p",{class:"text-2xl"},"Calcule su tarifa de taxi",-1)),_hoisted_3={class:"mb-4"},_hoisted_4=_withScopeId(()=>createBaseVNode("label",{class:"block mb-2 font-bold text-gray-700 text-md",for:"username"}," Punto de partida ",-1)),_hoisted_5={class:"flex"},_hoisted_6={class:"mb-4"},_hoisted_7=_withScopeId(()=>createBaseVNode("label",{class:"block mb-2 font-bold text-gray-700 text-md",for:"destinationInput"},"Punto de llegada ",-1)),_hoisted_8={class:"flex"},_hoisted_9={class:"flex items-center justify-around"},_hoisted_10=_withScopeId(()=>createBaseVNode("div",{class:"my-4"},[createBaseVNode("div",{id:"map"})],-1)),_hoisted_11={class:"px-8 pt-6 pb-8 mb-4 bg-white rounded shadow-md"},_hoisted_12=_withScopeId(()=>createBaseVNode("p",{class:"font-bold"},[createBaseVNode("i",{class:"pi pi-money-bill"}),createTextVNode(" Costo")],-1)),_hoisted_13={class:"m-0"},_hoisted_14=_withScopeId(()=>createBaseVNode("i",{class:"pi pi-map-marker"},null,-1)),_hoisted_15={class:"m-0"},_hoisted_16=_withScopeId(()=>createBaseVNode("i",{class:"pi pi-stopwatch"},null,-1)),_hoisted_17={class:"m-0"},_hoisted_18=_withScopeId(()=>createBaseVNode("i",{class:"pi pi-sun"},null,-1)),_hoisted_19={class:"m-0"},_hoisted_20=_withScopeId(()=>createBaseVNode("i",{class:"pi pi-moon"},null,-1)),mapName="TaxiGo",region="us-east-1",_sfc_main={__name:"taxi",setup(__props){let client,map;const runtimeConfig=useRuntimeConfig(),apiKey=runtimeConfig.public.AWS_LOCATION_SERVICE_KEY,loadingCurrentLocation=ref(!1);onMounted(async()=>{client=await initializeLocationClient(),map=new maplibregl.Map({container:"map",center:[-100.3175,25.6856],zoom:14,style:`https://maps.geo.${region}.amazonaws.com/maps/v0/maps/${mapName}/style-descriptor?key=${apiKey}`}),map.addControl(new maplibregl.NavigationControl),map.on("load",()=>{map.addSource("route_sample",{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[]}}}),map.addLayer({id:"route_sample",type:"line",source:"route_sample",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#FF0000","line-width":5,"line-opacity":.5}})})});const getCurrentLocation=async()=>{if("geolocation"in navigator)try{loadingCurrentLocation.value=!0;const E=await getCurrentPosition(),A=E.coords.latitude,R=E.coords.longitude;originInput.value="Mi ubicacion",originCoordinates.value=[A,R]}catch(E){console.log(E)}finally{loadingCurrentLocation.value=!1}},resetValues=()=>{originInput.value="",originSuggestionsResult.value=[],originSuggestionsText.value=[],originCoordinates.value=[],destinationInput.value="",destinationSuggestionsResult.value=[],destinationSuggestionsText.value=[],destinationCoordinates.value=[]},originInput=ref(""),originSuggestionsResult=ref([]),originSuggestionsText=ref([]),originCoordinates=ref([]),onOriginSearch=async E=>{try{const A=await searchPlaceForSuggestions(E.query,client);originSuggestionsResult.value=A.Results,originSuggestionsText.value=originSuggestionsResult.value.map(R=>R.Text)}catch(A){console.error("Error searching for places:",A)}},onOriginSelect=async E=>{try{const A=originSuggestionsResult.value.find(F=>F.Text===E.value).PlaceId,R=await getPlace(A,client);originCoordinates.value=R.Place.Geometry.Point}catch(A){console.error("Error getting place coordinates:",A)}},destinationInput=ref(""),destinationSuggestionsResult=ref([]),destinationSuggestionsText=ref([]),destinationCoordinates=ref([]),destinationSearch=async E=>{try{const A=await searchPlaceForSuggestions(E.query,client);destinationSuggestionsResult.value=A.Results,destinationSuggestionsText.value=destinationSuggestionsResult.value.map(R=>R.Text)}catch(A){console.error("Error searching for places:",A)}},onDestinationSelect=async E=>{try{const A=destinationSuggestionsResult.value.find(F=>F.Text===E.value).PlaceId,R=await getPlace(A,client);destinationCoordinates.value=R.Place.Geometry.Point}catch(A){console.error("Error getting place coordinates:",A)}},searchByVoice=async()=>{try{const E=await searchPlaceForText(destinationInput.value,client);console.log(E);const A=E.Results[0].Place;destinationCoordinates.value=A.Geometry.Point,destinationInput.value=A.Label}catch(E){console.error("Error searching for place:",E)}},loading=ref(!1),distance=ref(0),duration=ref(0),dayFare=ref(0),nightFare=ref(0),calculateFare=async()=>{loading.value=!0;try{const E=await calculateRoute(originCoordinates.value,destinationCoordinates.value,client);distance.value=E.Summary.Distance.toFixed(2),duration.value=E.Summary.DurationSeconds.toFixed(2);const[A,R]=getTaxiFare(distance.value,duration.value);dayFare.value=A,nightFare.value=R,drawRoute(E)}catch(E){console.error("Error calculating for route:",E)}finally{loading.value=!1}},drawRoute=E=>{let A=E.Legs[0].Geometry.LineString;map.getSource("route_sample").setData({type:"Feature",properties:{},geometry:{type:"LineString",coordinates:A}});let R=A.reduce((F,G)=>F.extend(G),new maplibregl.LngLatBounds(A[0],A[0]));map.fitBounds(R,{padding:20})},getAutoCompleteComponent=refName=>eval(refName),destinationRef=ref(null),startSpeechRecognition=()=>{getAutoCompleteComponent("destinationRef");const E=new window.webkitSpeechRecognition;E.lang="es-ES",E.onresult=A=>{const R=A.results[0][0].transcript;destinationInput.value=R,searchByVoice()},E.onerror=A=>{console.error("Error de reconocimiento:",A.error)},E.onend=()=>{console.log("Reconocimiento de voz finalizado")},E.start()};return(E,A)=>{const R=script,F=script$1,G=script$2;return openBlock(),createElementBlock(Fragment,null,[createBaseVNode("div",_hoisted_1,[_hoisted_2,createBaseVNode("div",_hoisted_3,[_hoisted_4,createBaseVNode("div",_hoisted_5,[createVNode(R,{"input-id":"originInput",modelValue:originInput.value,"onUpdate:modelValue":A[0]||(A[0]=H=>originInput.value=H),suggestions:originSuggestionsText.value,onComplete:onOriginSearch,onItemSelect:onOriginSelect,placeholder:"Centro de Monterrey ...",forceSelection:"",disabled:loadingCurrentLocation.value,class:"flex-1 mr-2"},null,8,["modelValue","suggestions","disabled"]),createVNode(F,{onClick:getCurrentLocation,loading:loadingCurrentLocation.value,icon:"pi pi-map-marker",severity:"danger"},null,8,["loading"])])]),createBaseVNode("div",_hoisted_6,[_hoisted_7,createBaseVNode("div",_hoisted_8,[createVNode(R,{"input-id":"destinationInput",modelValue:destinationInput.value,"onUpdate:modelValue":A[1]||(A[1]=H=>destinationInput.value=H),suggestions:destinationSuggestionsText.value,onComplete:destinationSearch,onItemSelect:onDestinationSelect,placeholder:"Centro de Guadalupe ...",forceSelection:"",class:"flex-1 mr-2",ref_key:"destinationRef",ref:destinationRef},null,8,["modelValue","suggestions"]),createVNode(F,{onClick:startSpeechRecognition,icon:"pi pi-microphone",severity:"warning"})])]),createBaseVNode("div",_hoisted_9,[createVNode(F,{label:"Limpiar",onClick:resetValues,outlined:""}),createVNode(F,{label:"Calcular",onClick:calculateFare,loading:loading.value},null,8,["loading"])]),_hoisted_10]),createBaseVNode("div",_hoisted_11,[createVNode(G,{header:"Header"},{header:withCtx(()=>[_hoisted_12]),default:withCtx(()=>[createBaseVNode("p",_hoisted_13,[_hoisted_14,createTextVNode(" Distancia: "+toDisplayString(distance.value)+"km ",1)]),createBaseVNode("p",_hoisted_15,[_hoisted_16,createTextVNode(" Duracion: "+toDisplayString(unref(convertTime)(duration.value)),1)]),createBaseVNode("p",_hoisted_17,[_hoisted_18,createTextVNode(" Durante el dia: $"+toDisplayString(dayFare.value),1)]),createBaseVNode("p",_hoisted_19,[_hoisted_20,createTextVNode(" Durante la noche: $"+toDisplayString(nightFare.value),1)])]),_:1})])],64)}}},taxi=_export_sfc(_sfc_main,[["__scopeId","data-v-e6afbbca"]]);export{taxi as default};
