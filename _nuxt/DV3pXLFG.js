import{_ as o_,o as l_,t as ad,v as c_,l as dm,T as pm,A as fm,x as Gt,y as qa,B as Wa,M as u_,r as ja,L as h_}from"./CKViNgqr.js";import mm from"./CWwowIoh.js";var d_=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function p_(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}function ea(s){if(s.__esModule)return s;var o=s.default;if(typeof o=="function"){var d=function y(){return this instanceof y?Reflect.construct(o,arguments,this.constructor):o.apply(this,arguments)};d.prototype=o.prototype}else d={};return Object.defineProperty(d,"__esModule",{value:!0}),Object.keys(s).forEach(function(y){var T=Object.getOwnPropertyDescriptor(s,y);Object.defineProperty(d,y,T.get?T:{enumerable:!0,get:function(){return s[y]}})}),d}var gm={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.1.2/LICENSE.txt
 */(function(s,o){(function(d,y){s.exports=y()})(d_,function(){var d={},y={};function T(x,h,K){if(y[x]=K,x==="index"){var O="var sharedModule = {}; ("+y.shared+")(sharedModule); ("+y.worker+")(sharedModule);",ie={};return y.shared(ie),y.index(d,ie),typeof window<"u"&&d.setWorkerUrl(window.URL.createObjectURL(new Blob([O],{type:"text/javascript"}))),d}}T("shared",["exports"],function(x){function h(i,e,r,a){return new(r||(r=Promise))(function(u,m){function g(E){try{w(a.next(E))}catch(C){m(C)}}function _(E){try{w(a.throw(E))}catch(C){m(C)}}function w(E){var C;E.done?u(E.value):(C=E.value,C instanceof r?C:new r(function(P){P(C)})).then(g,_)}w((a=a.apply(i,e||[])).next())})}function K(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}typeof SuppressedError=="function"&&SuppressedError;var O=ie;function ie(i,e){this.x=i,this.y=e}ie.prototype={clone:function(){return new ie(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,r=i.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),r=Math.sin(i),a=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=a,this},_rotateAround:function(i,e){var r=Math.cos(i),a=Math.sin(i),u=e.y+a*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-a*(this.y-e.y),this.y=u,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ie.convert=function(i){return i instanceof ie?i:Array.isArray(i)?new ie(i[0],i[1]):i};var Q=K(O),U=ye;function ye(i,e,r,a){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(a-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=e,this.p2x=r,this.p2y=a}ye.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,e){if(e===void 0&&(e=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,a=0;a<8;a++){var u=this.sampleCurveX(r)-i;if(Math.abs(u)<e)return r;var m=this.sampleCurveDerivativeX(r);if(Math.abs(m)<1e-6)break;r-=u/m}var g=0,_=1;for(r=i,a=0;a<20&&(u=this.sampleCurveX(r),!(Math.abs(u-i)<e));a++)i>u?g=r:_=r,r=.5*(_-g)+g;return r},solve:function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))}};var Te=K(U);let Pe,qe;function Ye(){return Pe==null&&(Pe=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Pe}function _t(){if(qe==null&&(qe=!1,Ye())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let a=0;a<5*5;a++){const u=4*a;e.fillStyle=`rgb(${u},${u+1},${u+2})`,e.fillRect(a%5,Math.floor(a/5),1,1)}const r=e.getImageData(0,0,5,5).data;for(let a=0;a<5*5*4;a++)if(a%4!=3&&r[a]!==a){qe=!0;break}}}return qe||!1}function gt(i,e,r,a){const u=new Te(i,e,r,a);return function(m){return u.solve(m)}}const xt=gt(.25,.1,.25,1);function pi(i,e,r){return Math.min(r,Math.max(e,i))}function ji(i,e,r){const a=r-e,u=((i-e)%a+a)%a+e;return u===e?r:u}function fi(i,...e){for(const r of e)for(const a in r)i[a]=r[a];return i}let dn=1;function Gr(i,e,r){const a={};for(const u in i)a[u]=e.call(r||this,i[u],u,i);return a}function ta(i,e,r){const a={};for(const u in i)e.call(r||this,i[u],u,i)&&(a[u]=i[u]);return a}function Pi(i){return Array.isArray(i)?i.map(Pi):typeof i=="object"&&i?Gr(i,Pi):i}const Ut={};function mi(i){Ut[i]||(typeof console<"u"&&console.warn(i),Ut[i]=!0)}function lr(i,e,r){return(r.y-i.y)*(e.x-i.x)>(e.y-i.y)*(r.x-i.x)}function pn(i){let e=0;for(let r,a,u=0,m=i.length,g=m-1;u<m;g=u++)r=i[u],a=i[g],e+=(a.x-r.x)*(r.y+a.y);return e}function zr(i){return typeof WorkerGlobalScope<"u"&&i!==void 0&&i instanceof WorkerGlobalScope}let Nn=null;function wr(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const As="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Hr(i,e,r,a,u){return h(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const m=new VideoFrame(i,{timestamp:0});try{const g=m==null?void 0:m.format;if(!g||!g.startsWith("BGR")&&!g.startsWith("RGB"))throw new Error(`Unrecognized format ${g}`);const _=g.startsWith("BGR"),w=new Uint8ClampedArray(a*u*4);if(yield m.copyTo(w,function(E,C,P,R,B){const F=4*Math.max(-C,0),V=(Math.max(0,P)-P)*R*4+F,Z=4*R,Y=Math.max(0,C),le=Math.max(0,P);return{rect:{x:Y,y:le,width:Math.min(E.width,C+R)-Y,height:Math.min(E.height,P+B)-le},layout:[{offset:V,stride:Z}]}}(i,e,r,a,u)),_)for(let E=0;E<w.length;E+=4){const C=w[E];w[E]=w[E+2],w[E+2]=C}return w}finally{m.close()}})}let Mi,ki;const fn="AbortError";function Sr(){return new Error(fn)}const mn={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Br(i){return mn.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))]}const cr="global-dispatcher";class ur extends Error{constructor(e,r,a,u){super(`AJAXError: ${r} (${e}): ${a}`),this.status=e,this.statusText=r,this.url=a,this.body=u}}const Un=()=>zr(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Zr=function(i,e){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){const a=Br(i.url);if(a)return a(i,e);if(zr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"getResource",data:i,targetMapId:cr},e)}if(!(/^file:/.test(r=i.url)||/^file:/.test(Un())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(a,u){return h(this,void 0,void 0,function*(){const m=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,cache:a.cache,referrer:Un(),signal:u.signal});a.type==="json"&&m.headers.set("Accept","application/json");const g=yield fetch(m);if(!g.ok){const E=yield g.blob();throw new ur(g.status,g.statusText,a.url,E)}let _;_=a.type==="arrayBuffer"||a.type==="image"?g.arrayBuffer():a.type==="json"?g.json():g.text();const w=yield _;if(u.signal.aborted)throw Sr();return{data:w,cacheControl:g.headers.get("Cache-Control"),expires:g.headers.get("Expires")}})}(i,e);if(zr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"getResource",data:i,mustQueue:!0,targetMapId:cr},e)}var r;return function(a,u){return new Promise((m,g)=>{const _=new XMLHttpRequest;_.open(a.method||"GET",a.url,!0),a.type!=="arrayBuffer"&&a.type!=="image"||(_.responseType="arraybuffer");for(const w in a.headers)_.setRequestHeader(w,a.headers[w]);a.type==="json"&&(_.responseType="text",_.setRequestHeader("Accept","application/json")),_.withCredentials=a.credentials==="include",_.onerror=()=>{g(new Error(_.statusText))},_.onload=()=>{if(!u.signal.aborted)if((_.status>=200&&_.status<300||_.status===0)&&_.response!==null){let w=_.response;if(a.type==="json")try{w=JSON.parse(_.response)}catch(E){return void g(E)}m({data:w,cacheControl:_.getResponseHeader("Cache-Control"),expires:_.getResponseHeader("Expires")})}else{const w=new Blob([_.response],{type:_.getResponseHeader("Content-Type")});g(new ur(_.status,_.statusText,a.url,w))}},u.signal.addEventListener("abort",()=>{_.abort(),g(Sr())}),_.send(a.body)})}(i,e)};function ia(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const e=new URL(i),r=window.location;return e.protocol===r.protocol&&e.host===r.host}function Wr(i,e,r){r[i]&&r[i].indexOf(e)!==-1||(r[i]=r[i]||[],r[i].push(e))}function Kr(i,e,r){if(r&&r[i]){const a=r[i].indexOf(e);a!==-1&&r[i].splice(a,1)}}class Xr{constructor(e,r={}){fi(this,r),this.type=e}}class Qt extends Xr{constructor(e,r={}){super("error",fi({error:e},r))}}class gn{on(e,r){return this._listeners=this._listeners||{},Wr(e,r,this._listeners),this}off(e,r){return Kr(e,r,this._listeners),Kr(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},Wr(e,r,this._oneTimeListeners),this):new Promise(a=>this.once(e,a))}fire(e,r){typeof e=="string"&&(e=new Xr(e,r||{}));const a=e.type;if(this.listens(a)){e.target=this;const u=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const _ of u)_.call(this,e);const m=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const _ of m)Kr(a,_,this._oneTimeListeners),_.call(this,e);const g=this._eventedParent;g&&(fi(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),g.fire(e))}else e instanceof Qt&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var fe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const yn=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Es(i,e){const r={};for(const a in i)a!=="ref"&&(r[a]=i[a]);return yn.forEach(a=>{a in e&&(r[a]=e[a])}),r}function ht(i,e){if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;for(let r=0;r<i.length;r++)if(!ht(i[r],e[r]))return!1;return!0}if(typeof i=="object"&&i!==null&&e!==null){if(typeof e!="object"||Object.keys(i).length!==Object.keys(e).length)return!1;for(const r in i)if(!ht(i[r],e[r]))return!1;return!0}return i===e}function ui(i,e){i.push(e)}function Tr(i,e,r){ui(r,{command:"addSource",args:[i,e[i]]})}function Vn(i,e,r){ui(e,{command:"removeSource",args:[i]}),r[i]=!0}function jn(i,e,r,a){Vn(i,r,a),Tr(i,e,r)}function qn(i,e,r){let a;for(a in i[r])if(Object.prototype.hasOwnProperty.call(i[r],a)&&a!=="data"&&!ht(i[r][a],e[r][a]))return!1;for(a in e[r])if(Object.prototype.hasOwnProperty.call(e[r],a)&&a!=="data"&&!ht(i[r][a],e[r][a]))return!1;return!0}function _n(i,e,r,a,u,m){i=i||{},e=e||{};for(const g in i)Object.prototype.hasOwnProperty.call(i,g)&&(ht(i[g],e[g])||r.push({command:m,args:[a,g,e[g],u]}));for(const g in e)Object.prototype.hasOwnProperty.call(e,g)&&!Object.prototype.hasOwnProperty.call(i,g)&&(ht(i[g],e[g])||r.push({command:m,args:[a,g,e[g],u]}))}function Gn(i){return i.id}function Is(i,e){return i[e.id]=e,i}class Me{constructor(e,r,a,u){this.message=(e?`${e}: `:"")+a,u&&(this.identifier=u),r!=null&&r.__line__&&(this.line=r.__line__)}}function qi(i,...e){for(const r of e)for(const a in r)i[a]=r[a];return i}class Di extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class Cs{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[a,u]of r)this.bindings[a]=u}concat(e){return new Cs(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const xn={kind:"null"},Ie={kind:"number"},nt={kind:"string"},et={kind:"boolean"},hi={kind:"color"},rr={kind:"object"},tt={kind:"value"},Yr={kind:"collator"},Lr={kind:"formatted"},G={kind:"padding"},D={kind:"resolvedImage"},z={kind:"variableAnchorOffsetCollection"};function $(i,e){return{kind:"array",itemType:i,N:e}}function j(i){if(i.kind==="array"){const e=j(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const re=[xn,Ie,nt,et,hi,Lr,rr,$(tt),G,D,z];function ne(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!ne(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const r of re)if(!ne(r,e))return null}}return`Expected ${j(i)} but found ${j(e)} instead.`}function oe(i,e){return e.some(r=>r.kind===i.kind)}function ee(i,e){return e.some(r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i)}function ce(i,e){return i.kind==="array"&&e.kind==="array"?i.itemType.kind===e.itemType.kind&&typeof i.N=="number":i.kind===e.kind}const be=.96422,me=.82521,_e=4/29,Ue=6/29,Ke=3*Ue*Ue,Ze=Ue*Ue*Ue,dt=Math.PI/180,Je=180/Math.PI;function Ct(i){return(i%=360)<0&&(i+=360),i}function St([i,e,r,a]){let u,m;const g=it((.2225045*(i=Ht(i))+.7168786*(e=Ht(e))+.0606169*(r=Ht(r)))/1);i===e&&e===r?u=m=g:(u=it((.4360747*i+.3850649*e+.1430804*r)/be),m=it((.0139322*i+.0971045*e+.7141733*r)/me));const _=116*g-16;return[_<0?0:_,500*(u-g),200*(g-m),a]}function Ht(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function it(i){return i>Ze?Math.pow(i,1/3):i/Ke+_e}function Ot([i,e,r,a]){let u=(i+16)/116,m=isNaN(e)?u:u+e/500,g=isNaN(r)?u:u-r/200;return u=1*Ri(u),m=be*Ri(m),g=me*Ri(g),[oi(3.1338561*m-1.6168667*u-.4906146*g),oi(-.9787684*m+1.9161415*u+.033454*g),oi(.0719453*m-.2289914*u+1.4052427*g),a]}function oi(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function Ri(i){return i>Ue?i*i*i:Ke*(i-_e)}function gi(i){return parseInt(i.padEnd(2,i),16)/255}function wi(i,e){return Gi(e?i/100:i,0,1)}function Gi(i,e,r){return Math.min(Math.max(e,i),r)}function Fl(i){return!i.some(Number.isNaN)}const _u={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class vt{constructor(e,r,a,u=1,m=!0){this.r=e,this.g=r,this.b=a,this.a=u,m||(this.r*=u,this.g*=u,this.b*=u,u||this.overwriteGetter("rgb",[e,r,a,u]))}static parse(e){if(e instanceof vt)return e;if(typeof e!="string")return;const r=function(a){if((a=a.toLowerCase().trim())==="transparent")return[0,0,0,0];const u=_u[a];if(u){const[g,_,w]=u;return[g/255,_/255,w/255,1]}if(a.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(a)){const g=a.length<6?1:2;let _=1;return[gi(a.slice(_,_+=g)),gi(a.slice(_,_+=g)),gi(a.slice(_,_+=g)),gi(a.slice(_,_+g)||"ff")]}if(a.startsWith("rgb")){const g=a.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(g){const[_,w,E,C,P,R,B,F,V,Z,Y,le]=g,J=[C||" ",B||" ",Z].join("");if(J==="  "||J==="  /"||J===",,"||J===",,,"){const se=[E,R,V].join(""),ge=se==="%%%"?100:se===""?255:0;if(ge){const xe=[Gi(+w/ge,0,1),Gi(+P/ge,0,1),Gi(+F/ge,0,1),Y?wi(+Y,le):1];if(Fl(xe))return xe}}return}}const m=a.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(m){const[g,_,w,E,C,P,R,B,F]=m,V=[w||" ",C||" ",R].join("");if(V==="  "||V==="  /"||V===",,"||V===",,,"){const Z=[+_,Gi(+E,0,100),Gi(+P,0,100),B?wi(+B,F):1];if(Fl(Z))return function([Y,le,J,se]){function ge(xe){const Be=(xe+Y/30)%12,Ne=le*Math.min(J,1-J);return J-Ne*Math.max(-1,Math.min(Be-3,9-Be,1))}return Y=Ct(Y),le/=100,J/=100,[ge(0),ge(8),ge(4),se]}(Z)}}}(e);return r?new vt(...r,!1):void 0}get rgb(){const{r:e,g:r,b:a,a:u}=this,m=u||1/0;return this.overwriteGetter("rgb",[e/m,r/m,a/m,u])}get hcl(){return this.overwriteGetter("hcl",function(e){const[r,a,u,m]=St(e),g=Math.sqrt(a*a+u*u);return[Math.round(1e4*g)?Ct(Math.atan2(u,a)*Je):NaN,g,r,m]}(this.rgb))}get lab(){return this.overwriteGetter("lab",St(this.rgb))}overwriteGetter(e,r){return Object.defineProperty(this,e,{value:r}),r}toString(){const[e,r,a,u]=this.rgb;return`rgba(${[e,r,a].map(m=>Math.round(255*m)).join(",")},${u})`}}vt.black=new vt(0,0,0,1),vt.white=new vt(1,1,1,1),vt.transparent=new vt(0,0,0,0),vt.red=new vt(1,0,0,1);class Ya{constructor(e,r,a){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ja{constructor(e,r,a,u,m){this.text=e,this.image=r,this.scale=a,this.fontStack=u,this.textColor=m}}class Hi{constructor(e){this.sections=e}static fromString(e){return new Hi([new Ja(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof Hi?e:Hi.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class Zi{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Zi)return e;if(typeof e=="number")return new Zi([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const r of e)if(typeof r!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new Zi(e)}}toString(){return JSON.stringify(this.values)}}const Ol=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class yi{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof yi)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let r=0;r<e.length;r+=2){const a=e[r],u=e[r+1];if(typeof a!="string"||!Ol.has(a)||!Array.isArray(u)||u.length!==2||typeof u[0]!="number"||typeof u[1]!="number")return}return new yi(e)}}toString(){return JSON.stringify(this.values)}}class nr{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new nr({name:e,available:!1}):null}}function $l(i,e,r,a){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[i,e,r,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[i,e,r,a]:[i,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Jr(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof vt||i instanceof Ya||i instanceof Hi||i instanceof Zi||i instanceof yi||i instanceof nr)return!0;if(Array.isArray(i)){for(const e of i)if(!Jr(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!Jr(i[e]))return!1;return!0}return!1}function Xt(i){if(i===null)return xn;if(typeof i=="string")return nt;if(typeof i=="boolean")return et;if(typeof i=="number")return Ie;if(i instanceof vt)return hi;if(i instanceof Ya)return Yr;if(i instanceof Hi)return Lr;if(i instanceof Zi)return G;if(i instanceof yi)return z;if(i instanceof nr)return D;if(Array.isArray(i)){const e=i.length;let r;for(const a of i){const u=Xt(a);if(r){if(r===u)continue;r=tt;break}r=u}return $(r||tt,e)}return rr}function Ps(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof vt||i instanceof Hi||i instanceof Zi||i instanceof yi||i instanceof nr?i.toString():JSON.stringify(i)}class vn{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Jr(e[1]))return r.error("invalid value");const a=e[1];let u=Xt(a);const m=r.expectedType;return u.kind!=="array"||u.N!==0||!m||m.kind!=="array"||typeof m.N=="number"&&m.N!==0||(u=m),new vn(u,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Vt{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const bn={string:nt,number:Ie,boolean:et,object:rr};class hr{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let a,u=1;const m=e[0];if(m==="array"){let _,w;if(e.length>2){const E=e[1];if(typeof E!="string"||!(E in bn)||E==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);_=bn[E],u++}else _=tt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);w=e[2],u++}a=$(_,w)}else{if(!bn[m])throw new Error(`Types doesn't contain name = ${m}`);a=bn[m]}const g=[];for(;u<e.length;u++){const _=r.parse(e[u],u,tt);if(!_)return null;g.push(_)}return new hr(a,g)}evaluate(e){for(let r=0;r<this.args.length;r++){const a=this.args[r].evaluate(e);if(!ne(this.type,Xt(a)))return a;if(r===this.args.length-1)throw new Vt(`Expected value to be of type ${j(this.type)}, but found ${j(Xt(a))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const ra={"to-boolean":et,"to-color":hi,"to-number":Ie,"to-string":nt};class Ar{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const a=e[0];if(!ra[a])throw new Error(`Can't parse ${a} as it is not part of the known types`);if((a==="to-boolean"||a==="to-string")&&e.length!==2)return r.error("Expected one argument.");const u=ra[a],m=[];for(let g=1;g<e.length;g++){const _=r.parse(e[g],g,tt);if(!_)return null;m.push(_)}return new Ar(u,m)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let r,a;for(const u of this.args){if(r=u.evaluate(e),a=null,r instanceof vt)return r;if(typeof r=="string"){const m=e.parseColor(r);if(m)return m}else if(Array.isArray(r)&&(a=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:$l(r[0],r[1],r[2],r[3]),!a))return new vt(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Vt(a||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(const a of this.args){r=a.evaluate(e);const u=Zi.parse(r);if(u)return u}throw new Vt(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(const a of this.args){r=a.evaluate(e);const u=yi.parse(r);if(u)return u}throw new Vt(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(const a of this.args){if(r=a.evaluate(e),r===null)return 0;const u=Number(r);if(!isNaN(u))return u}throw new Vt(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return Hi.fromString(Ps(this.args[0].evaluate(e)));case"resolvedImage":return nr.fromString(Ps(this.args[0].evaluate(e)));default:return Ps(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Qa=["Unknown","Point","LineString","Polygon"];class Hn{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Qa[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let r=this._parseColorCache[e];return r||(r=this._parseColorCache[e]=vt.parse(e)),r}}class yt{constructor(e,r,a=[],u,m=new Cs,g=[]){this.registry=e,this.path=a,this.key=a.map(_=>`[${_}]`).join(""),this.scope=m,this.errors=g,this.expectedType=u,this._isConstant=r}parse(e,r,a,u,m={}){return r?this.concat(r,a,u)._parse(e,m):this._parse(e,m)}_parse(e,r){function a(u,m,g){return g==="assert"?new hr(m,[u]):g==="coerce"?new Ar(m,[u]):u}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=e[0];if(typeof u!="string")return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const m=this.registry[u];if(m){let g=m.parse(e,this);if(!g)return null;if(this.expectedType){const _=this.expectedType,w=g.type;if(_.kind!=="string"&&_.kind!=="number"&&_.kind!=="boolean"&&_.kind!=="object"&&_.kind!=="array"||w.kind!=="value")if(_.kind!=="color"&&_.kind!=="formatted"&&_.kind!=="resolvedImage"||w.kind!=="value"&&w.kind!=="string")if(_.kind!=="padding"||w.kind!=="value"&&w.kind!=="number"&&w.kind!=="array")if(_.kind!=="variableAnchorOffsetCollection"||w.kind!=="value"&&w.kind!=="array"){if(this.checkSubtype(_,w))return null}else g=a(g,_,r.typeAnnotation||"coerce");else g=a(g,_,r.typeAnnotation||"coerce");else g=a(g,_,r.typeAnnotation||"coerce");else g=a(g,_,r.typeAnnotation||"assert")}if(!(g instanceof vn)&&g.type.kind!=="resolvedImage"&&this._isConstant(g)){const _=new Hn;try{g=new vn(g.type,g.evaluate(_))}catch(w){return this.error(w.message),null}}return g}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,a){const u=typeof e=="number"?this.path.concat(e):this.path,m=a?this.scope.concat(a):this.scope;return new yt(this.registry,this._isConstant,u,r||null,m,this.errors)}error(e,...r){const a=`${this.key}${r.map(u=>`[${u}]`).join("")}`;this.errors.push(new Di(a,e))}checkSubtype(e,r){const a=ne(e,r);return a&&this.error(a),a}}class na{constructor(e,r,a){this.type=Yr,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const a=e[1];if(typeof a!="object"||Array.isArray(a))return r.error("Collator options argument must be an object.");const u=r.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,et);if(!u)return null;const m=r.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,et);if(!m)return null;let g=null;return a.locale&&(g=r.parse(a.locale,1,nt),!g)?null:new na(u,m,g)}evaluate(e){return new Ya(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}const Er=8192;function eo(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function Ms(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function Nl(i,e){const r=(180+i[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(r*u*Er),Math.round(a*u*Er)]}function xu(i,e,r){const a=i[0]-e[0],u=i[1]-e[1],m=i[0]-r[0],g=i[1]-r[1];return a*g-m*u==0&&a*m<=0&&u*g<=0}function sa(i,e){let r=!1;for(let g=0,_=e.length;g<_;g++){const w=e[g];for(let E=0,C=w.length;E<C-1;E++){if(xu(i,w[E],w[E+1]))return!1;(u=w[E])[1]>(a=i)[1]!=(m=w[E+1])[1]>a[1]&&a[0]<(m[0]-u[0])*(a[1]-u[1])/(m[1]-u[1])+u[0]&&(r=!r)}}var a,u,m;return r}function Ul(i,e){for(let r=0;r<e.length;r++)if(sa(i,e[r]))return!0;return!1}function Vl(i,e,r,a){const u=a[0]-r[0],m=a[1]-r[1],g=(i[0]-r[0])*m-u*(i[1]-r[1]),_=(e[0]-r[0])*m-u*(e[1]-r[1]);return g>0&&_<0||g<0&&_>0}function vu(i,e,r){for(const E of r)for(let C=0;C<E.length-1;++C)if((_=[(g=E[C+1])[0]-(m=E[C])[0],g[1]-m[1]])[0]*(w=[(u=e)[0]-(a=i)[0],u[1]-a[1]])[1]-_[1]*w[0]!=0&&Vl(a,u,m,g)&&Vl(m,g,a,u))return!0;var a,u,m,g,_,w;return!1}function jl(i,e){for(let r=0;r<i.length;++r)if(!sa(i[r],e))return!1;for(let r=0;r<i.length-1;++r)if(vu(i[r],i[r+1],e))return!1;return!0}function bu(i,e){for(let r=0;r<e.length;r++)if(jl(i,e[r]))return!0;return!1}function aa(i,e,r){const a=[];for(let u=0;u<i.length;u++){const m=[];for(let g=0;g<i[u].length;g++){const _=Nl(i[u][g],r);eo(e,_),m.push(_)}a.push(m)}return a}function to(i,e,r){const a=[];for(let u=0;u<i.length;u++){const m=aa(i[u],e,r);a.push(m)}return a}function ql(i,e,r,a){if(i[0]<r[0]||i[0]>r[2]){const u=.5*a;let m=i[0]-r[0]>u?-a:r[0]-i[0]>u?a:0;m===0&&(m=i[0]-r[2]>u?-a:r[2]-i[0]>u?a:0),i[0]+=m}eo(e,i)}function Gl(i,e,r,a){const u=Math.pow(2,a.z)*Er,m=[a.x*Er,a.y*Er],g=[];for(const _ of i)for(const w of _){const E=[w.x+m[0],w.y+m[1]];ql(E,e,r,u),g.push(E)}return g}function oa(i,e,r,a){const u=Math.pow(2,a.z)*Er,m=[a.x*Er,a.y*Er],g=[];for(const w of i){const E=[];for(const C of w){const P=[C.x+m[0],C.y+m[1]];eo(e,P),E.push(P)}g.push(E)}if(e[2]-e[0]<=u/2){(_=e)[0]=_[1]=1/0,_[2]=_[3]=-1/0;for(const w of g)for(const E of w)ql(E,e,r,u)}var _;return g}class wn{constructor(e,r){this.type=et,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Jr(e[1])){const a=e[1];if(a.type==="FeatureCollection"){const u=[];for(const m of a.features){const{type:g,coordinates:_}=m.geometry;g==="Polygon"&&u.push(_),g==="MultiPolygon"&&u.push(..._)}if(u.length)return new wn(a,{type:"MultiPolygon",coordinates:u})}else if(a.type==="Feature"){const u=a.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new wn(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new wn(a,a)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,a){const u=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],g=r.canonicalID();if(a.type==="Polygon"){const _=aa(a.coordinates,m,g),w=Gl(r.geometry(),u,m,g);if(!Ms(u,m))return!1;for(const E of w)if(!sa(E,_))return!1}if(a.type==="MultiPolygon"){const _=to(a.coordinates,m,g),w=Gl(r.geometry(),u,m,g);if(!Ms(u,m))return!1;for(const E of w)if(!Ul(E,_))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,a){const u=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],g=r.canonicalID();if(a.type==="Polygon"){const _=aa(a.coordinates,m,g),w=oa(r.geometry(),u,m,g);if(!Ms(u,m))return!1;for(const E of w)if(!jl(E,_))return!1}if(a.type==="MultiPolygon"){const _=to(a.coordinates,m,g),w=oa(r.geometry(),u,m,g);if(!Ms(u,m))return!1;for(const E of w)if(!bu(E,_))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class la{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const a=e[1];return r.scope.has(a)?new la(a,r.scope.get(a)):r.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class sr{constructor(e,r,a,u){this.name=e,this.type=r,this._evaluate=a,this.args=u}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,r){const a=e[0],u=sr.definitions[a];if(!u)return r.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(u)?u[0]:u.type,g=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,_=g.filter(([E])=>!Array.isArray(E)||E.length===e.length-1);let w=null;for(const[E,C]of _){w=new yt(r.registry,ks,r.path,null,r.scope);const P=[];let R=!1;for(let B=1;B<e.length;B++){const F=e[B],V=Array.isArray(E)?E[B-1]:E.type,Z=w.parse(F,1+P.length,V);if(!Z){R=!0;break}P.push(Z)}if(!R)if(Array.isArray(E)&&E.length!==P.length)w.error(`Expected ${E.length} arguments, but found ${P.length} instead.`);else{for(let B=0;B<P.length;B++){const F=Array.isArray(E)?E[B]:E.type,V=P[B];w.concat(B+1).checkSubtype(F,V.type)}if(w.errors.length===0)return new sr(a,m,C,P)}}if(_.length===1)r.errors.push(...w.errors);else{const E=(_.length?_:g).map(([P])=>{return R=P,Array.isArray(R)?`(${R.map(j).join(", ")})`:`(${j(R.type)}...)`;var R}).join(" | "),C=[];for(let P=1;P<e.length;P++){const R=r.parse(e[P],1+C.length);if(!R)return null;C.push(j(R.type))}r.error(`Expected arguments of type ${E}, but found (${C.join(", ")}) instead.`)}return null}static register(e,r){sr.definitions=r;for(const a in r)e[a]=sr}}function ks(i){if(i instanceof la)return ks(i.boundExpression);if(i instanceof sr&&i.name==="error"||i instanceof na||i instanceof wn)return!1;const e=i instanceof Ar||i instanceof hr;let r=!0;return i.eachChild(a=>{r=e?r&&ks(a):r&&a instanceof vn}),!!r&&Ds(i)&&ca(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Ds(i){if(i instanceof sr&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof wn)return!1;let e=!0;return i.eachChild(r=>{e&&!Ds(r)&&(e=!1)}),e}function Rs(i){if(i instanceof sr&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(r=>{e&&!Rs(r)&&(e=!1)}),e}function ca(i,e){if(i instanceof sr&&e.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild(a=>{r&&!ca(a,e)&&(r=!1)}),r}function zs(i,e){const r=i.length-1;let a,u,m=0,g=r,_=0;for(;m<=g;)if(_=Math.floor((m+g)/2),a=i[_],u=i[_+1],a<=e){if(_===r||e<u)return _;m=_+1}else{if(!(a>e))throw new Vt("Input is not a number.");g=_-1}return 0}class Zn{constructor(e,r,a){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[u,m]of a)this.labels.push(u),this.outputs.push(m)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const a=r.parse(e[1],1,Ie);if(!a)return null;const u=[];let m=null;r.expectedType&&r.expectedType.kind!=="value"&&(m=r.expectedType);for(let g=1;g<e.length;g+=2){const _=g===1?-1/0:e[g],w=e[g+1],E=g,C=g+1;if(typeof _!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(u.length&&u[u.length-1][0]>=_)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',E);const P=r.parse(w,C,m);if(!P)return null;m=m||P.type,u.push([_,P])}return new Zn(m,a,u)}evaluate(e){const r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(e);const u=this.input.evaluate(e);if(u<=r[0])return a[0].evaluate(e);const m=r.length;return u>=r[m-1]?a[m-1].evaluate(e):a[zs(r,u)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function wu(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Su=Hl;function Hl(i,e,r,a){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(a-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=e,this.p2x=r,this.p2y=a}Hl.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,e){if(e===void 0&&(e=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,a=0;a<8;a++){var u=this.sampleCurveX(r)-i;if(Math.abs(u)<e)return r;var m=this.sampleCurveDerivativeX(r);if(Math.abs(m)<1e-6)break;r-=u/m}var g=0,_=1;for(r=i,a=0;a<20&&(u=this.sampleCurveX(r),!(Math.abs(u-i)<e));a++)i>u?g=r:_=r,r=.5*(_-g)+g;return r},solve:function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))}};var Tu=wu(Su);function Sn(i,e,r){return i+r*(e-i)}function ua(i,e,r){return i.map((a,u)=>Sn(a,e[u],r))}const Wi={number:Sn,color:function(i,e,r,a="rgb"){switch(a){case"rgb":{const[u,m,g,_]=ua(i.rgb,e.rgb,r);return new vt(u,m,g,_,!1)}case"hcl":{const[u,m,g,_]=i.hcl,[w,E,C,P]=e.hcl;let R,B;if(isNaN(u)||isNaN(w))isNaN(u)?isNaN(w)?R=NaN:(R=w,g!==1&&g!==0||(B=E)):(R=u,C!==1&&C!==0||(B=m));else{let le=w-u;w>u&&le>180?le-=360:w<u&&u-w>180&&(le+=360),R=u+r*le}const[F,V,Z,Y]=function([le,J,se,ge]){return le=isNaN(le)?0:le*dt,Ot([se,Math.cos(le)*J,Math.sin(le)*J,ge])}([R,B??Sn(m,E,r),Sn(g,C,r),Sn(_,P,r)]);return new vt(F,V,Z,Y,!1)}case"lab":{const[u,m,g,_]=Ot(ua(i.lab,e.lab,r));return new vt(u,m,g,_,!1)}}},array:ua,padding:function(i,e,r){return new Zi(ua(i.values,e.values,r))},variableAnchorOffsetCollection:function(i,e,r){const a=i.values,u=e.values;if(a.length!==u.length)throw new Vt(`Cannot interpolate values of different length. from: ${i.toString()}, to: ${e.toString()}`);const m=[];for(let g=0;g<a.length;g+=2){if(a[g]!==u[g])throw new Vt(`Cannot interpolate values containing mismatched anchors. from[${g}]: ${a[g]}, to[${g}]: ${u[g]}`);m.push(a[g]);const[_,w]=a[g+1],[E,C]=u[g+1];m.push([Sn(_,E,r),Sn(w,C,r)])}return new yi(m)}};class Si{constructor(e,r,a,u,m){this.type=e,this.operator=r,this.interpolation=a,this.input=u,this.labels=[],this.outputs=[];for(const[g,_]of m)this.labels.push(g),this.outputs.push(_)}static interpolationFactor(e,r,a,u){let m=0;if(e.name==="exponential")m=Wn(r,e.base,a,u);else if(e.name==="linear")m=Wn(r,1,a,u);else if(e.name==="cubic-bezier"){const g=e.controlPoints;m=new Tu(g[0],g[1],g[2],g[3]).solve(Wn(r,1,a,u))}return m}static parse(e,r){let[a,u,m,...g]=e;if(!Array.isArray(u)||u.length===0)return r.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const E=u[1];if(typeof E!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:E}}else{if(u[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const E=u.slice(1);if(E.length!==4||E.some(C=>typeof C!="number"||C<0||C>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:E}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(m=r.parse(m,2,Ie),!m)return null;const _=[];let w=null;a==="interpolate-hcl"||a==="interpolate-lab"?w=hi:r.expectedType&&r.expectedType.kind!=="value"&&(w=r.expectedType);for(let E=0;E<g.length;E+=2){const C=g[E],P=g[E+1],R=E+3,B=E+4;if(typeof C!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',R);if(_.length&&_[_.length-1][0]>=C)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',R);const F=r.parse(P,B,w);if(!F)return null;w=w||F.type,_.push([C,F])}return ce(w,Ie)||ce(w,hi)||ce(w,G)||ce(w,z)||ce(w,$(Ie))?new Si(w,a,u,m,_):r.error(`Type ${j(w)} is not interpolatable.`)}evaluate(e){const r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(e);const u=this.input.evaluate(e);if(u<=r[0])return a[0].evaluate(e);const m=r.length;if(u>=r[m-1])return a[m-1].evaluate(e);const g=zs(r,u),_=Si.interpolationFactor(this.interpolation,u,r[g],r[g+1]),w=a[g].evaluate(e),E=a[g+1].evaluate(e);switch(this.operator){case"interpolate":return Wi[this.type.kind](w,E,_);case"interpolate-hcl":return Wi.color(w,E,_,"hcl");case"interpolate-lab":return Wi.color(w,E,_,"lab")}}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Wn(i,e,r,a){const u=a-r,m=i-r;return u===0?0:e===1?m/u:(Math.pow(e,m)-1)/(Math.pow(e,u)-1)}class ft{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let a=null;const u=r.expectedType;u&&u.kind!=="value"&&(a=u);const m=[];for(const _ of e.slice(1)){const w=r.parse(_,1+m.length,a,void 0,{typeAnnotation:"omit"});if(!w)return null;a=a||w.type,m.push(w)}if(!a)throw new Error("No output type");const g=u&&m.some(_=>ne(u,_.type));return new ft(g?tt:a,m)}evaluate(e){let r,a=null,u=0;for(const m of this.args)if(u++,a=m.evaluate(e),a&&a instanceof nr&&!a.available&&(r||(r=a.name),a=null,u===this.args.length&&(a=r)),a!==null)break;return a}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}class ha{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const a=[];for(let m=1;m<e.length-1;m+=2){const g=e[m];if(typeof g!="string")return r.error(`Expected string, but found ${typeof g} instead.`,m);if(/[^a-zA-Z0-9_]/.test(g))return r.error("Variable names must contain only alphanumeric characters or '_'.",m);const _=r.parse(e[m+1],m+1);if(!_)return null;a.push([g,_])}const u=r.parse(e[e.length-1],e.length-1,r.expectedType,a);return u?new ha(a,u):null}outputDefined(){return this.result.outputDefined()}}class io{constructor(e,r,a){this.type=e,this.index=r,this.input=a}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,Ie),u=r.parse(e[2],2,$(r.expectedType||tt));return a&&u?new io(u.type.itemType,a,u):null}evaluate(e){const r=this.index.evaluate(e),a=this.input.evaluate(e);if(r<0)throw new Vt(`Array index out of bounds: ${r} < 0.`);if(r>=a.length)throw new Vt(`Array index out of bounds: ${r} > ${a.length-1}.`);if(r!==Math.floor(r))throw new Vt(`Array index must be an integer, but found ${r} instead.`);return a[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class ro{constructor(e,r){this.type=et,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,tt),u=r.parse(e[2],2,tt);return a&&u?oe(a.type,[et,nt,Ie,xn,tt])?new ro(a,u):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${j(a.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!a)return!1;if(!ee(r,["boolean","string","number","null"]))throw new Vt(`Expected first argument to be of type boolean, string, number or null, but found ${j(Xt(r))} instead.`);if(!ee(a,["string","array"]))throw new Vt(`Expected second argument to be of type array or string, but found ${j(Xt(a))} instead.`);return a.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class da{constructor(e,r,a){this.type=Ie,this.needle=e,this.haystack=r,this.fromIndex=a}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,tt),u=r.parse(e[2],2,tt);if(!a||!u)return null;if(!oe(a.type,[et,nt,Ie,xn,tt]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${j(a.type)} instead`);if(e.length===4){const m=r.parse(e[3],3,Ie);return m?new da(a,u,m):null}return new da(a,u)}evaluate(e){const r=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!ee(r,["boolean","string","number","null"]))throw new Vt(`Expected first argument to be of type boolean, string, number or null, but found ${j(Xt(r))} instead.`);if(!ee(a,["string","array"]))throw new Vt(`Expected second argument to be of type array or string, but found ${j(Xt(a))} instead.`);if(this.fromIndex){const u=this.fromIndex.evaluate(e);return a.indexOf(r,u)}return a.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class no{constructor(e,r,a,u,m,g){this.inputType=e,this.type=r,this.input=a,this.cases=u,this.outputs=m,this.otherwise=g}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let a,u;r.expectedType&&r.expectedType.kind!=="value"&&(u=r.expectedType);const m={},g=[];for(let E=2;E<e.length-1;E+=2){let C=e[E];const P=e[E+1];Array.isArray(C)||(C=[C]);const R=r.concat(E);if(C.length===0)return R.error("Expected at least one branch label.");for(const F of C){if(typeof F!="number"&&typeof F!="string")return R.error("Branch labels must be numbers or strings.");if(typeof F=="number"&&Math.abs(F)>Number.MAX_SAFE_INTEGER)return R.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof F=="number"&&Math.floor(F)!==F)return R.error("Numeric branch labels must be integer values.");if(a){if(R.checkSubtype(a,Xt(F)))return null}else a=Xt(F);if(m[String(F)]!==void 0)return R.error("Branch labels must be unique.");m[String(F)]=g.length}const B=r.parse(P,E,u);if(!B)return null;u=u||B.type,g.push(B)}const _=r.parse(e[1],1,tt);if(!_)return null;const w=r.parse(e[e.length-1],e.length-1,u);return w?_.type.kind!=="value"&&r.concat(1).checkSubtype(a,_.type)?null:new no(a,u,_,m,g,w):null}evaluate(e){const r=this.input.evaluate(e);return(Xt(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class so{constructor(e,r,a){this.type=e,this.branches=r,this.otherwise=a}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let a;r.expectedType&&r.expectedType.kind!=="value"&&(a=r.expectedType);const u=[];for(let g=1;g<e.length-1;g+=2){const _=r.parse(e[g],g,et);if(!_)return null;const w=r.parse(e[g+1],g+1,a);if(!w)return null;u.push([_,w]),a=a||w.type}const m=r.parse(e[e.length-1],e.length-1,a);if(!m)return null;if(!a)throw new Error("Can't infer output type");return new so(a,u,m)}evaluate(e){for(const[r,a]of this.branches)if(r.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,a]of this.branches)e(r),e(a);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}}class pa{constructor(e,r,a,u){this.type=e,this.input=r,this.beginIndex=a,this.endIndex=u}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,tt),u=r.parse(e[2],2,Ie);if(!a||!u)return null;if(!oe(a.type,[$(tt),nt,tt]))return r.error(`Expected first argument to be of type array or string, but found ${j(a.type)} instead`);if(e.length===4){const m=r.parse(e[3],3,Ie);return m?new pa(a.type,a,u,m):null}return new pa(a.type,a,u)}evaluate(e){const r=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!ee(r,["string","array"]))throw new Vt(`Expected first argument to be of type array or string, but found ${j(Xt(r))} instead.`);if(this.endIndex){const u=this.endIndex.evaluate(e);return r.slice(a,u)}return r.slice(a)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function Zl(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Wl(i,e,r,a){return a.compare(e,r)===0}function Kn(i,e,r){const a=i!=="=="&&i!=="!=";return class ym{constructor(m,g,_){this.type=et,this.lhs=m,this.rhs=g,this.collator=_,this.hasUntypedArgument=m.type.kind==="value"||g.type.kind==="value"}static parse(m,g){if(m.length!==3&&m.length!==4)return g.error("Expected two or three arguments.");const _=m[0];let w=g.parse(m[1],1,tt);if(!w)return null;if(!Zl(_,w.type))return g.concat(1).error(`"${_}" comparisons are not supported for type '${j(w.type)}'.`);let E=g.parse(m[2],2,tt);if(!E)return null;if(!Zl(_,E.type))return g.concat(2).error(`"${_}" comparisons are not supported for type '${j(E.type)}'.`);if(w.type.kind!==E.type.kind&&w.type.kind!=="value"&&E.type.kind!=="value")return g.error(`Cannot compare types '${j(w.type)}' and '${j(E.type)}'.`);a&&(w.type.kind==="value"&&E.type.kind!=="value"?w=new hr(E.type,[w]):w.type.kind!=="value"&&E.type.kind==="value"&&(E=new hr(w.type,[E])));let C=null;if(m.length===4){if(w.type.kind!=="string"&&E.type.kind!=="string"&&w.type.kind!=="value"&&E.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(C=g.parse(m[3],3,Yr),!C)return null}return new ym(w,E,C)}evaluate(m){const g=this.lhs.evaluate(m),_=this.rhs.evaluate(m);if(a&&this.hasUntypedArgument){const w=Xt(g),E=Xt(_);if(w.kind!==E.kind||w.kind!=="string"&&w.kind!=="number")throw new Vt(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${w.kind}, ${E.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const w=Xt(g),E=Xt(_);if(w.kind!=="string"||E.kind!=="string")return e(m,g,_)}return this.collator?r(m,g,_,this.collator.evaluate(m)):e(m,g,_)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}}}const Au=Kn("==",function(i,e,r){return e===r},Wl),Eu=Kn("!=",function(i,e,r){return e!==r},function(i,e,r,a){return!Wl(0,e,r,a)}),Iu=Kn("<",function(i,e,r){return e<r},function(i,e,r,a){return a.compare(e,r)<0}),Cu=Kn(">",function(i,e,r){return e>r},function(i,e,r,a){return a.compare(e,r)>0}),Pu=Kn("<=",function(i,e,r){return e<=r},function(i,e,r,a){return a.compare(e,r)<=0}),Mu=Kn(">=",function(i,e,r){return e>=r},function(i,e,r,a){return a.compare(e,r)>=0});class ao{constructor(e,r,a,u,m){this.type=nt,this.number=e,this.locale=r,this.currency=a,this.minFractionDigits=u,this.maxFractionDigits=m}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const a=r.parse(e[1],1,Ie);if(!a)return null;const u=e[2];if(typeof u!="object"||Array.isArray(u))return r.error("NumberFormat options argument must be an object.");let m=null;if(u.locale&&(m=r.parse(u.locale,1,nt),!m))return null;let g=null;if(u.currency&&(g=r.parse(u.currency,1,nt),!g))return null;let _=null;if(u["min-fraction-digits"]&&(_=r.parse(u["min-fraction-digits"],1,Ie),!_))return null;let w=null;return u["max-fraction-digits"]&&(w=r.parse(u["max-fraction-digits"],1,Ie),!w)?null:new ao(a,m,g,_,w)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class fa{constructor(e){this.type=Lr,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const a=e[1];if(!Array.isArray(a)&&typeof a=="object")return r.error("First argument must be an image or text section.");const u=[];let m=!1;for(let g=1;g<=e.length-1;++g){const _=e[g];if(m&&typeof _=="object"&&!Array.isArray(_)){m=!1;let w=null;if(_["font-scale"]&&(w=r.parse(_["font-scale"],1,Ie),!w))return null;let E=null;if(_["text-font"]&&(E=r.parse(_["text-font"],1,$(nt)),!E))return null;let C=null;if(_["text-color"]&&(C=r.parse(_["text-color"],1,hi),!C))return null;const P=u[u.length-1];P.scale=w,P.font=E,P.textColor=C}else{const w=r.parse(e[g],1,tt);if(!w)return null;const E=w.type.kind;if(E!=="string"&&E!=="value"&&E!=="null"&&E!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,u.push({content:w,scale:null,font:null,textColor:null})}}return new fa(u)}evaluate(e){return new Hi(this.sections.map(r=>{const a=r.content.evaluate(e);return Xt(a)===D?new Ja("",a,null,null,null):new Ja(Ps(a),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}}class oo{constructor(e){this.type=D,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");const a=r.parse(e[1],1,nt);return a?new oo(a):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),a=nr.fromString(r);return a&&e.availableImages&&(a.available=e.availableImages.indexOf(r)>-1),a}eachChild(e){e(this.input)}outputDefined(){return!1}}class lo{constructor(e){this.type=Ie,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const a=r.parse(e[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${j(a.type)} instead.`):new lo(a):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new Vt(`Expected value to be of type string or array, but found ${j(Xt(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const Xn={"==":Au,"!=":Eu,">":Cu,"<":Iu,">=":Mu,"<=":Pu,array:hr,at:io,boolean:hr,case:so,coalesce:ft,collator:na,format:fa,image:oo,in:ro,"index-of":da,interpolate:Si,"interpolate-hcl":Si,"interpolate-lab":Si,length:lo,let:ha,literal:vn,match:no,number:hr,"number-format":ao,object:hr,slice:pa,step:Zn,string:hr,"to-boolean":Ar,"to-color":Ar,"to-number":Ar,"to-string":Ar,var:la,within:wn};function Kl(i,[e,r,a,u]){e=e.evaluate(i),r=r.evaluate(i),a=a.evaluate(i);const m=u?u.evaluate(i):1,g=$l(e,r,a,m);if(g)throw new Vt(g);return new vt(e/255,r/255,a/255,m,!1)}function Xl(i,e){return i in e}function co(i,e){const r=e[i];return r===void 0?null:r}function Tn(i){return{type:i}}function Yl(i){return{result:"success",value:i}}function Yn(i){return{result:"error",value:i}}function Jn(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function Jl(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function uo(i){return!!i.expression&&i.expression.interpolated}function mt(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function Qn(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function ku(i){return i}function Ql(i,e){const r=e.type==="color",a=i.stops&&typeof i.stops[0][0]=="object",u=a||!(a||i.property!==void 0),m=i.type||(uo(e)?"exponential":"interval");if(r||e.type==="padding"){const C=r?vt.parse:Zi.parse;(i=qi({},i)).stops&&(i.stops=i.stops.map(P=>[P[0],C(P[1])])),i.default=C(i.default?i.default:e.default)}if(i.colorSpace&&(g=i.colorSpace)!=="rgb"&&g!=="hcl"&&g!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var g;let _,w,E;if(m==="exponential")_=ec;else if(m==="interval")_=Zt;else if(m==="categorical"){_=Du,w=Object.create(null);for(const C of i.stops)w[C[0]]=C[1];E=typeof i.stops[0][0]}else{if(m!=="identity")throw new Error(`Unknown function type "${m}"`);_=pt}if(a){const C={},P=[];for(let F=0;F<i.stops.length;F++){const V=i.stops[F],Z=V[0].zoom;C[Z]===void 0&&(C[Z]={zoom:Z,type:i.type,property:i.property,default:i.default,stops:[]},P.push(Z)),C[Z].stops.push([V[0].value,V[1]])}const R=[];for(const F of P)R.push([C[F].zoom,Ql(C[F],e)]);const B={name:"linear"};return{kind:"composite",interpolationType:B,interpolationFactor:Si.interpolationFactor.bind(void 0,B),zoomStops:R.map(F=>F[0]),evaluate:({zoom:F},V)=>ec({stops:R,base:i.base},e,F).evaluate(F,V)}}if(u){const C=m==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:C,interpolationFactor:Si.interpolationFactor.bind(void 0,C),zoomStops:i.stops.map(P=>P[0]),evaluate:({zoom:P})=>_(i,e,P,w,E)}}return{kind:"source",evaluate(C,P){const R=P&&P.properties?P.properties[i.property]:void 0;return R===void 0?Bs(i.default,e.default):_(i,e,R,w,E)}}}function Bs(i,e,r){return i!==void 0?i:e!==void 0?e:r!==void 0?r:void 0}function Du(i,e,r,a,u){return Bs(typeof r===u?a[r]:void 0,i.default,e.default)}function Zt(i,e,r){if(mt(r)!=="number")return Bs(i.default,e.default);const a=i.stops.length;if(a===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[a-1][0])return i.stops[a-1][1];const u=zs(i.stops.map(m=>m[0]),r);return i.stops[u][1]}function ec(i,e,r){const a=i.base!==void 0?i.base:1;if(mt(r)!=="number")return Bs(i.default,e.default);const u=i.stops.length;if(u===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[u-1][0])return i.stops[u-1][1];const m=zs(i.stops.map(C=>C[0]),r),g=function(C,P,R,B){const F=B-R,V=C-R;return F===0?0:P===1?V/F:(Math.pow(P,V)-1)/(Math.pow(P,F)-1)}(r,a,i.stops[m][0],i.stops[m+1][0]),_=i.stops[m][1],w=i.stops[m+1][1],E=Wi[e.type]||ku;return typeof _.evaluate=="function"?{evaluate(...C){const P=_.evaluate.apply(void 0,C),R=w.evaluate.apply(void 0,C);if(P!==void 0&&R!==void 0)return E(P,R,g,i.colorSpace)}}:E(_,w,g,i.colorSpace)}function pt(i,e,r){switch(e.type){case"color":r=vt.parse(r);break;case"formatted":r=Hi.fromString(r.toString());break;case"resolvedImage":r=nr.fromString(r.toString());break;case"padding":r=Zi.parse(r);break;default:mt(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0)}return Bs(r,i.default,e.default)}sr.register(Xn,{error:[{kind:"error"},[nt],(i,[e])=>{throw new Vt(e.evaluate(i))}],typeof:[nt,[tt],(i,[e])=>j(Xt(e.evaluate(i)))],"to-rgba":[$(Ie,4),[hi],(i,[e])=>{const[r,a,u,m]=e.evaluate(i).rgb;return[255*r,255*a,255*u,m]}],rgb:[hi,[Ie,Ie,Ie],Kl],rgba:[hi,[Ie,Ie,Ie,Ie],Kl],has:{type:et,overloads:[[[nt],(i,[e])=>Xl(e.evaluate(i),i.properties())],[[nt,rr],(i,[e,r])=>Xl(e.evaluate(i),r.evaluate(i))]]},get:{type:tt,overloads:[[[nt],(i,[e])=>co(e.evaluate(i),i.properties())],[[nt,rr],(i,[e,r])=>co(e.evaluate(i),r.evaluate(i))]]},"feature-state":[tt,[nt],(i,[e])=>co(e.evaluate(i),i.featureState||{})],properties:[rr,[],i=>i.properties()],"geometry-type":[nt,[],i=>i.geometryType()],id:[tt,[],i=>i.id()],zoom:[Ie,[],i=>i.globals.zoom],"heatmap-density":[Ie,[],i=>i.globals.heatmapDensity||0],"line-progress":[Ie,[],i=>i.globals.lineProgress||0],accumulated:[tt,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Ie,Tn(Ie),(i,e)=>{let r=0;for(const a of e)r+=a.evaluate(i);return r}],"*":[Ie,Tn(Ie),(i,e)=>{let r=1;for(const a of e)r*=a.evaluate(i);return r}],"-":{type:Ie,overloads:[[[Ie,Ie],(i,[e,r])=>e.evaluate(i)-r.evaluate(i)],[[Ie],(i,[e])=>-e.evaluate(i)]]},"/":[Ie,[Ie,Ie],(i,[e,r])=>e.evaluate(i)/r.evaluate(i)],"%":[Ie,[Ie,Ie],(i,[e,r])=>e.evaluate(i)%r.evaluate(i)],ln2:[Ie,[],()=>Math.LN2],pi:[Ie,[],()=>Math.PI],e:[Ie,[],()=>Math.E],"^":[Ie,[Ie,Ie],(i,[e,r])=>Math.pow(e.evaluate(i),r.evaluate(i))],sqrt:[Ie,[Ie],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[Ie,[Ie],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[Ie,[Ie],(i,[e])=>Math.log(e.evaluate(i))],log2:[Ie,[Ie],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[Ie,[Ie],(i,[e])=>Math.sin(e.evaluate(i))],cos:[Ie,[Ie],(i,[e])=>Math.cos(e.evaluate(i))],tan:[Ie,[Ie],(i,[e])=>Math.tan(e.evaluate(i))],asin:[Ie,[Ie],(i,[e])=>Math.asin(e.evaluate(i))],acos:[Ie,[Ie],(i,[e])=>Math.acos(e.evaluate(i))],atan:[Ie,[Ie],(i,[e])=>Math.atan(e.evaluate(i))],min:[Ie,Tn(Ie),(i,e)=>Math.min(...e.map(r=>r.evaluate(i)))],max:[Ie,Tn(Ie),(i,e)=>Math.max(...e.map(r=>r.evaluate(i)))],abs:[Ie,[Ie],(i,[e])=>Math.abs(e.evaluate(i))],round:[Ie,[Ie],(i,[e])=>{const r=e.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[Ie,[Ie],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[Ie,[Ie],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[et,[nt,tt],(i,[e,r])=>i.properties()[e.value]===r.value],"filter-id-==":[et,[tt],(i,[e])=>i.id()===e.value],"filter-type-==":[et,[nt],(i,[e])=>i.geometryType()===e.value],"filter-<":[et,[nt,tt],(i,[e,r])=>{const a=i.properties()[e.value],u=r.value;return typeof a==typeof u&&a<u}],"filter-id-<":[et,[tt],(i,[e])=>{const r=i.id(),a=e.value;return typeof r==typeof a&&r<a}],"filter->":[et,[nt,tt],(i,[e,r])=>{const a=i.properties()[e.value],u=r.value;return typeof a==typeof u&&a>u}],"filter-id->":[et,[tt],(i,[e])=>{const r=i.id(),a=e.value;return typeof r==typeof a&&r>a}],"filter-<=":[et,[nt,tt],(i,[e,r])=>{const a=i.properties()[e.value],u=r.value;return typeof a==typeof u&&a<=u}],"filter-id-<=":[et,[tt],(i,[e])=>{const r=i.id(),a=e.value;return typeof r==typeof a&&r<=a}],"filter->=":[et,[nt,tt],(i,[e,r])=>{const a=i.properties()[e.value],u=r.value;return typeof a==typeof u&&a>=u}],"filter-id->=":[et,[tt],(i,[e])=>{const r=i.id(),a=e.value;return typeof r==typeof a&&r>=a}],"filter-has":[et,[tt],(i,[e])=>e.value in i.properties()],"filter-has-id":[et,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[et,[$(nt)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[et,[$(tt)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[et,[nt,$(tt)],(i,[e,r])=>r.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[et,[nt,$(tt)],(i,[e,r])=>function(a,u,m,g){for(;m<=g;){const _=m+g>>1;if(u[_]===a)return!0;u[_]>a?g=_-1:m=_+1}return!1}(i.properties()[e.value],r.value,0,r.value.length-1)],all:{type:et,overloads:[[[et,et],(i,[e,r])=>e.evaluate(i)&&r.evaluate(i)],[Tn(et),(i,e)=>{for(const r of e)if(!r.evaluate(i))return!1;return!0}]]},any:{type:et,overloads:[[[et,et],(i,[e,r])=>e.evaluate(i)||r.evaluate(i)],[Tn(et),(i,e)=>{for(const r of e)if(r.evaluate(i))return!0;return!1}]]},"!":[et,[et],(i,[e])=>!e.evaluate(i)],"is-supported-script":[et,[nt],(i,[e])=>{const r=i.globals&&i.globals.isSupportedScript;return!r||r(e.evaluate(i))}],upcase:[nt,[nt],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[nt,[nt],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[nt,Tn(tt),(i,e)=>e.map(r=>Ps(r.evaluate(i))).join("")],"resolved-locale":[nt,[Yr],(i,[e])=>e.evaluate(i).resolvedLocale()]});class Ls{constructor(e,r){var a;this.expression=e,this._warningHistory={},this._evaluator=new Hn,this._defaultValue=r?(a=r).type==="color"&&Qn(a.default)?new vt(0,0,0,0):a.type==="color"?vt.parse(a.default)||null:a.type==="padding"?Zi.parse(a.default)||null:a.type==="variableAnchorOffsetCollection"?yi.parse(a.default)||null:a.default===void 0?null:a.default:null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,a,u,m,g){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=a,this._evaluator.canonical=u,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g,this.expression.evaluate(this._evaluator)}evaluate(e,r,a,u,m,g){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=a||null,this._evaluator.canonical=u,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g||null;try{const _=this.expression.evaluate(this._evaluator);if(_==null||typeof _=="number"&&_!=_)return this._defaultValue;if(this._enumValues&&!(_ in this._enumValues))throw new Vt(`Expected value to be one of ${Object.keys(this._enumValues).map(w=>JSON.stringify(w)).join(", ")}, but found ${JSON.stringify(_)} instead.`);return _}catch(_){return this._warningHistory[_.message]||(this._warningHistory[_.message]=!0,typeof console<"u"&&console.warn(_.message)),this._defaultValue}}}function Et(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in Xn}function Tt(i,e){const r=new yt(Xn,ks,[],e?function(u){const m={color:hi,string:nt,number:Ie,enum:nt,boolean:et,formatted:Lr,padding:G,resolvedImage:D,variableAnchorOffsetCollection:z};return u.type==="array"?$(m[u.value]||tt,u.length):m[u.type]}(e):void 0),a=r.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return a?Yl(new Ls(a,e)):Yn(r.errors)}class es{constructor(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!Rs(r.expression)}evaluateWithoutErrorHandling(e,r,a,u,m,g){return this._styleExpression.evaluateWithoutErrorHandling(e,r,a,u,m,g)}evaluate(e,r,a,u,m,g){return this._styleExpression.evaluate(e,r,a,u,m,g)}}class ma{constructor(e,r,a,u){this.kind=e,this.zoomStops=a,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!Rs(r.expression),this.interpolationType=u}evaluateWithoutErrorHandling(e,r,a,u,m,g){return this._styleExpression.evaluateWithoutErrorHandling(e,r,a,u,m,g)}evaluate(e,r,a,u,m,g){return this._styleExpression.evaluate(e,r,a,u,m,g)}interpolationFactor(e,r,a){return this.interpolationType?Si.interpolationFactor(this.interpolationType,e,r,a):0}}function tc(i,e){const r=Tt(i,e);if(r.result==="error")return r;const a=r.value.expression,u=Ds(a);if(!u&&!Jn(e))return Yn([new Di("","data expressions not supported")]);const m=ca(a,["zoom"]);if(!m&&!Jl(e))return Yn([new Di("","zoom expressions not supported")]);const g=ya(a);return g||m?g instanceof Di?Yn([g]):g instanceof Si&&!uo(e)?Yn([new Di("",'"interpolate" expressions cannot be used with this property')]):Yl(g?new ma(u?"camera":"composite",r.value,g.labels,g instanceof Si?g.interpolation:void 0):new es(u?"constant":"source",r.value)):Yn([new Di("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ga{constructor(e,r){this._parameters=e,this._specification=r,qi(this,Ql(this._parameters,this._specification))}static deserialize(e){return new ga(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function ya(i){let e=null;if(i instanceof ha)e=ya(i.result);else if(i instanceof ft){for(const r of i.args)if(e=ya(r),e)break}else(i instanceof Zn||i instanceof Si)&&i.input instanceof sr&&i.input.name==="zoom"&&(e=i);return e instanceof Di||i.eachChild(r=>{const a=ya(r);a instanceof Di?e=a:!e&&a?e=new Di("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&a&&e!==a&&(e=new Di("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function ho(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!ho(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const ic={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function _a(i){if(i==null)return{filter:()=>!0,needGeometry:!1};ho(i)||(i=ts(i));const e=Tt(i,ic);if(e.result==="error")throw new Error(e.value.map(r=>`${r.key}: ${r.message}`).join(", "));return{filter:(r,a,u)=>e.value.evaluate(r,a,{},u),needGeometry:po(i)}}function rc(i,e){return i<e?-1:i>e?1:0}function po(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let e=1;e<i.length;e++)if(po(i[e]))return!0;return!1}function ts(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?fo(i[1],i[2],"=="):e==="!="?xa(fo(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?fo(i[1],i[2],e):e==="any"?(r=i.slice(1),["any"].concat(r.map(ts))):e==="all"?["all"].concat(i.slice(1).map(ts)):e==="none"?["all"].concat(i.slice(1).map(ts).map(xa)):e==="in"?nc(i[1],i.slice(2)):e==="!in"?xa(nc(i[1],i.slice(2))):e==="has"?sc(i[1]):e==="!has"?xa(sc(i[1])):e!=="within"||i;var r}function fo(i,e,r){switch(i){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,i,e]}}function nc(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",i,["literal",e.sort(rc)]]:["filter-in-small",i,["literal",e]]}}function sc(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function xa(i){return["!",i]}function mo(i){const e=typeof i;if(e==="number"||e==="boolean"||e==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let u="[";for(const m of i)u+=`${mo(m)},`;return`${u}]`}const r=Object.keys(i).sort();let a="{";for(let u=0;u<r.length;u++)a+=`${JSON.stringify(r[u])}:${mo(i[r[u]])},`;return`${a}}`}function Ru(i){let e="";for(const r of yn)e+=`/${mo(i[r])}`;return e}function ac(i){const e=i.value;return e?[new Me(i.key,e,"constants have been deprecated as of v8")]:[]}function jt(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Qr(i){if(Array.isArray(i))return i.map(Qr);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const r in i)e[r]=Qr(i[r]);return e}return jt(i)}function Ki(i){const e=i.key,r=i.value,a=i.valueSpec||{},u=i.objectElementValidators||{},m=i.style,g=i.styleSpec,_=i.validateSpec;let w=[];const E=mt(r);if(E!=="object")return[new Me(e,r,`object expected, ${E} found`)];for(const C in r){const P=C.split(".")[0],R=a[P]||a["*"];let B;if(u[P])B=u[P];else if(a[P])B=_;else if(u["*"])B=u["*"];else{if(!a["*"]){w.push(new Me(e,r[C],`unknown property "${C}"`));continue}B=_}w=w.concat(B({key:(e&&`${e}.`)+C,value:r[C],valueSpec:R,style:m,styleSpec:g,object:r,objectKey:C,validateSpec:_},r))}for(const C in a)u[C]||a[C].required&&a[C].default===void 0&&r[C]===void 0&&w.push(new Me(e,r,`missing required property "${C}"`));return w}function is(i){const e=i.value,r=i.valueSpec,a=i.style,u=i.styleSpec,m=i.key,g=i.arrayElementValidator||i.validateSpec;if(mt(e)!=="array")return[new Me(m,e,`array expected, ${mt(e)} found`)];if(r.length&&e.length!==r.length)return[new Me(m,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new Me(m,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let _={type:r.value,values:r.values};u.$version<7&&(_.function=r.function),mt(r.value)==="object"&&(_=r.value);let w=[];for(let E=0;E<e.length;E++)w=w.concat(g({array:e,arrayIndex:E,value:e[E],valueSpec:_,validateSpec:i.validateSpec,style:a,styleSpec:u,key:`${m}[${E}]`}));return w}function go(i){const e=i.key,r=i.value,a=i.valueSpec;let u=mt(r);return u==="number"&&r!=r&&(u="NaN"),u!=="number"?[new Me(e,r,`number expected, ${u} found`)]:"minimum"in a&&r<a.minimum?[new Me(e,r,`${r} is less than the minimum value ${a.minimum}`)]:"maximum"in a&&r>a.maximum?[new Me(e,r,`${r} is greater than the maximum value ${a.maximum}`)]:[]}function yo(i){const e=i.valueSpec,r=jt(i.value.type);let a,u,m,g={};const _=r!=="categorical"&&i.value.property===void 0,w=!_,E=mt(i.value.stops)==="array"&&mt(i.value.stops[0])==="array"&&mt(i.value.stops[0][0])==="object",C=Ki({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(B){if(r==="identity")return[new Me(B.key,B.value,'identity function may not have a "stops" property')];let F=[];const V=B.value;return F=F.concat(is({key:B.key,value:V,valueSpec:B.valueSpec,validateSpec:B.validateSpec,style:B.style,styleSpec:B.styleSpec,arrayElementValidator:P})),mt(V)==="array"&&V.length===0&&F.push(new Me(B.key,V,"array must have at least one stop")),F},default:function(B){return B.validateSpec({key:B.key,value:B.value,valueSpec:e,validateSpec:B.validateSpec,style:B.style,styleSpec:B.styleSpec})}}});return r==="identity"&&_&&C.push(new Me(i.key,i.value,'missing required property "property"')),r==="identity"||i.value.stops||C.push(new Me(i.key,i.value,'missing required property "stops"')),r==="exponential"&&i.valueSpec.expression&&!uo(i.valueSpec)&&C.push(new Me(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(w&&!Jn(i.valueSpec)?C.push(new Me(i.key,i.value,"property functions not supported")):_&&!Jl(i.valueSpec)&&C.push(new Me(i.key,i.value,"zoom functions not supported"))),r!=="categorical"&&!E||i.value.property!==void 0||C.push(new Me(i.key,i.value,'"property" property is required')),C;function P(B){let F=[];const V=B.value,Z=B.key;if(mt(V)!=="array")return[new Me(Z,V,`array expected, ${mt(V)} found`)];if(V.length!==2)return[new Me(Z,V,`array length 2 expected, length ${V.length} found`)];if(E){if(mt(V[0])!=="object")return[new Me(Z,V,`object expected, ${mt(V[0])} found`)];if(V[0].zoom===void 0)return[new Me(Z,V,"object stop key must have zoom")];if(V[0].value===void 0)return[new Me(Z,V,"object stop key must have value")];if(m&&m>jt(V[0].zoom))return[new Me(Z,V[0].zoom,"stop zoom values must appear in ascending order")];jt(V[0].zoom)!==m&&(m=jt(V[0].zoom),u=void 0,g={}),F=F.concat(Ki({key:`${Z}[0]`,value:V[0],valueSpec:{zoom:{}},validateSpec:B.validateSpec,style:B.style,styleSpec:B.styleSpec,objectElementValidators:{zoom:go,value:R}}))}else F=F.concat(R({key:`${Z}[0]`,value:V[0],valueSpec:{},validateSpec:B.validateSpec,style:B.style,styleSpec:B.styleSpec},V));return Et(Qr(V[1]))?F.concat([new Me(`${Z}[1]`,V[1],"expressions are not allowed in function stops.")]):F.concat(B.validateSpec({key:`${Z}[1]`,value:V[1],valueSpec:e,validateSpec:B.validateSpec,style:B.style,styleSpec:B.styleSpec}))}function R(B,F){const V=mt(B.value),Z=jt(B.value),Y=B.value!==null?B.value:F;if(a){if(V!==a)return[new Me(B.key,Y,`${V} stop domain type must match previous stop domain type ${a}`)]}else a=V;if(V!=="number"&&V!=="string"&&V!=="boolean")return[new Me(B.key,Y,"stop domain value must be a number, string, or boolean")];if(V!=="number"&&r!=="categorical"){let le=`number expected, ${V} found`;return Jn(e)&&r===void 0&&(le+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Me(B.key,Y,le)]}return r!=="categorical"||V!=="number"||isFinite(Z)&&Math.floor(Z)===Z?r!=="categorical"&&V==="number"&&u!==void 0&&Z<u?[new Me(B.key,Y,"stop domain values must appear in ascending order")]:(u=Z,r==="categorical"&&Z in g?[new Me(B.key,Y,"stop domain values must be unique")]:(g[Z]=!0,[])):[new Me(B.key,Y,`integer expected, found ${Z}`)]}}function rs(i){const e=(i.expressionContext==="property"?tc:Tt)(Qr(i.value),i.valueSpec);if(e.result==="error")return e.value.map(a=>new Me(`${i.key}${a.key}`,i.value,a.message));const r=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!r.outputDefined())return[new Me(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!Rs(r))return[new Me(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!Rs(r))return[new Me(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!ca(r,["zoom","feature-state"]))return[new Me(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!Ds(r))return[new Me(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function An(i){const e=i.key,r=i.value,a=i.valueSpec,u=[];return Array.isArray(a.values)?a.values.indexOf(jt(r))===-1&&u.push(new Me(e,r,`expected one of [${a.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(a.values).indexOf(jt(r))===-1&&u.push(new Me(e,r,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(r)} found`)),u}function ns(i){return ho(Qr(i.value))?rs(qi({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Fs(i)}function Fs(i){const e=i.value,r=i.key;if(mt(e)!=="array")return[new Me(r,e,`array expected, ${mt(e)} found`)];const a=i.styleSpec;let u,m=[];if(e.length<1)return[new Me(r,e,"filter array must have at least 1 element")];switch(m=m.concat(An({key:`${r}[0]`,value:e[0],valueSpec:a.filter_operator,style:i.style,styleSpec:i.styleSpec})),jt(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&jt(e[1])==="$type"&&m.push(new Me(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&m.push(new Me(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(u=mt(e[1]),u!=="string"&&m.push(new Me(`${r}[1]`,e[1],`string expected, ${u} found`)));for(let g=2;g<e.length;g++)u=mt(e[g]),jt(e[1])==="$type"?m=m.concat(An({key:`${r}[${g}]`,value:e[g],valueSpec:a.geometry_type,style:i.style,styleSpec:i.styleSpec})):u!=="string"&&u!=="number"&&u!=="boolean"&&m.push(new Me(`${r}[${g}]`,e[g],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let g=1;g<e.length;g++)m=m.concat(Fs({key:`${r}[${g}]`,value:e[g],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":u=mt(e[1]),e.length!==2?m.push(new Me(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):u!=="string"&&m.push(new Me(`${r}[1]`,e[1],`string expected, ${u} found`));break;case"within":u=mt(e[1]),e.length!==2?m.push(new Me(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):u!=="object"&&m.push(new Me(`${r}[1]`,e[1],`object expected, ${u} found`))}return m}function _o(i,e){const r=i.key,a=i.validateSpec,u=i.style,m=i.styleSpec,g=i.value,_=i.objectKey,w=m[`${e}_${i.layerType}`];if(!w)return[];const E=_.match(/^(.*)-transition$/);if(e==="paint"&&E&&w[E[1]]&&w[E[1]].transition)return a({key:r,value:g,valueSpec:m.transition,style:u,styleSpec:m});const C=i.valueSpec||w[_];if(!C)return[new Me(r,g,`unknown property "${_}"`)];let P;if(mt(g)==="string"&&Jn(C)&&!C.tokens&&(P=/^{([^}]+)}$/.exec(g)))return[new Me(r,g,`"${_}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(P[1])} }\`.`)];const R=[];return i.layerType==="symbol"&&(_==="text-field"&&u&&!u.glyphs&&R.push(new Me(r,g,'use of "text-field" requires a style "glyphs" property')),_==="text-font"&&Qn(Qr(g))&&jt(g.type)==="identity"&&R.push(new Me(r,g,'"text-font" does not support identity functions'))),R.concat(a({key:i.key,value:g,valueSpec:C,style:u,styleSpec:m,expressionContext:"property",propertyType:e,propertyKey:_}))}function va(i){return _o(i,"paint")}function xo(i){return _o(i,"layout")}function vo(i){let e=[];const r=i.value,a=i.key,u=i.style,m=i.styleSpec;r.type||r.ref||e.push(new Me(a,r,'either "type" or "ref" is required'));let g=jt(r.type);const _=jt(r.ref);if(r.id){const w=jt(r.id);for(let E=0;E<i.arrayIndex;E++){const C=u.layers[E];jt(C.id)===w&&e.push(new Me(a,r.id,`duplicate layer id "${r.id}", previously used at line ${C.id.__line__}`))}}if("ref"in r){let w;["type","source","source-layer","filter","layout"].forEach(E=>{E in r&&e.push(new Me(a,r[E],`"${E}" is prohibited for ref layers`))}),u.layers.forEach(E=>{jt(E.id)===_&&(w=E)}),w?w.ref?e.push(new Me(a,r.ref,"ref cannot reference another ref layer")):g=jt(w.type):e.push(new Me(a,r.ref,`ref layer "${_}" not found`))}else if(g!=="background")if(r.source){const w=u.sources&&u.sources[r.source],E=w&&jt(w.type);w?E==="vector"&&g==="raster"?e.push(new Me(a,r.source,`layer "${r.id}" requires a raster source`)):E!=="raster-dem"&&g==="hillshade"?e.push(new Me(a,r.source,`layer "${r.id}" requires a raster-dem source`)):E==="raster"&&g!=="raster"?e.push(new Me(a,r.source,`layer "${r.id}" requires a vector source`)):E!=="vector"||r["source-layer"]?E==="raster-dem"&&g!=="hillshade"?e.push(new Me(a,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):g!=="line"||!r.paint||!r.paint["line-gradient"]||E==="geojson"&&w.lineMetrics||e.push(new Me(a,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Me(a,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new Me(a,r.source,`source "${r.source}" not found`))}else e.push(new Me(a,r,'missing required property "source"'));return e=e.concat(Ki({key:a,value:r,valueSpec:m.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${a}.type`,value:r.type,valueSpec:m.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:r,objectKey:"type"}),filter:ns,layout:w=>Ki({layer:r,key:w.key,value:w.value,style:w.style,styleSpec:w.styleSpec,validateSpec:w.validateSpec,objectElementValidators:{"*":E=>xo(qi({layerType:g},E))}}),paint:w=>Ki({layer:r,key:w.key,value:w.value,style:w.style,styleSpec:w.styleSpec,validateSpec:w.validateSpec,objectElementValidators:{"*":E=>va(qi({layerType:g},E))}})}})),e}function Ir(i){const e=i.value,r=i.key,a=mt(e);return a!=="string"?[new Me(r,e,`string expected, ${a} found`)]:[]}const oc={promoteId:function({key:i,value:e}){if(mt(e)==="string")return Ir({key:i,value:e});{const r=[];for(const a in e)r.push(...Ir({key:`${i}.${a}`,value:e[a]}));return r}}};function lc(i){const e=i.value,r=i.key,a=i.styleSpec,u=i.style,m=i.validateSpec;if(!e.type)return[new Me(r,e,'"type" is required')];const g=jt(e.type);let _;switch(g){case"vector":case"raster":return _=Ki({key:r,value:e,valueSpec:a[`source_${g.replace("-","_")}`],style:i.style,styleSpec:a,objectElementValidators:oc,validateSpec:m}),_;case"raster-dem":return _=function(w){var E;const C=(E=w.sourceName)!==null&&E!==void 0?E:"",P=w.value,R=w.styleSpec,B=R.source_raster_dem,F=w.style;let V=[];const Z=mt(P);if(P===void 0)return V;if(Z!=="object")return V.push(new Me("source_raster_dem",P,`object expected, ${Z} found`)),V;const Y=jt(P.encoding)==="custom",le=["redFactor","greenFactor","blueFactor","baseShift"],J=w.value.encoding?`"${w.value.encoding}"`:"Default";for(const se in P)!Y&&le.includes(se)?V.push(new Me(se,P[se],`In "${C}": "${se}" is only valid when "encoding" is set to "custom". ${J} encoding found`)):B[se]?V=V.concat(w.validateSpec({key:se,value:P[se],valueSpec:B[se],validateSpec:w.validateSpec,style:F,styleSpec:R})):V.push(new Me(se,P[se],`unknown property "${se}"`));return V}({sourceName:r,value:e,style:i.style,styleSpec:a,validateSpec:m}),_;case"geojson":if(_=Ki({key:r,value:e,valueSpec:a.source_geojson,style:u,styleSpec:a,validateSpec:m,objectElementValidators:oc}),e.cluster)for(const w in e.clusterProperties){const[E,C]=e.clusterProperties[w],P=typeof E=="string"?[E,["accumulated"],["get",w]]:E;_.push(...rs({key:`${r}.${w}.map`,value:C,validateSpec:m,expressionContext:"cluster-map"})),_.push(...rs({key:`${r}.${w}.reduce`,value:P,validateSpec:m,expressionContext:"cluster-reduce"}))}return _;case"video":return Ki({key:r,value:e,valueSpec:a.source_video,style:u,validateSpec:m,styleSpec:a});case"image":return Ki({key:r,value:e,valueSpec:a.source_image,style:u,validateSpec:m,styleSpec:a});case"canvas":return[new Me(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return An({key:`${r}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:u,validateSpec:m,styleSpec:a})}}function cc(i){const e=i.value,r=i.styleSpec,a=r.light,u=i.style;let m=[];const g=mt(e);if(e===void 0)return m;if(g!=="object")return m=m.concat([new Me("light",e,`object expected, ${g} found`)]),m;for(const _ in e){const w=_.match(/^(.*)-transition$/);m=m.concat(w&&a[w[1]]&&a[w[1]].transition?i.validateSpec({key:_,value:e[_],valueSpec:r.transition,validateSpec:i.validateSpec,style:u,styleSpec:r}):a[_]?i.validateSpec({key:_,value:e[_],valueSpec:a[_],validateSpec:i.validateSpec,style:u,styleSpec:r}):[new Me(_,e[_],`unknown property "${_}"`)])}return m}function uc(i){const e=i.value,r=i.styleSpec,a=r.sky,u=i.style,m=mt(e);if(e===void 0)return[];if(m!=="object")return[new Me("sky",e,`object expected, ${m} found`)];let g=[];for(const _ in e)g=g.concat(a[_]?li({key:_,value:e[_],valueSpec:a[_],style:u,styleSpec:r}):[new Me(_,e[_],`unknown property "${_}"`)]);return g}function hc(i){const e=i.value,r=i.styleSpec,a=r.terrain,u=i.style;let m=[];const g=mt(e);if(e===void 0)return m;if(g!=="object")return m=m.concat([new Me("terrain",e,`object expected, ${g} found`)]),m;for(const _ in e)m=m.concat(a[_]?i.validateSpec({key:_,value:e[_],valueSpec:a[_],validateSpec:i.validateSpec,style:u,styleSpec:r}):[new Me(_,e[_],`unknown property "${_}"`)]);return m}function Os(i){let e=[];const r=i.value,a=i.key;if(Array.isArray(r)){const u=[],m=[];for(const g in r)r[g].id&&u.includes(r[g].id)&&e.push(new Me(a,r,`all the sprites' ids must be unique, but ${r[g].id} is duplicated`)),u.push(r[g].id),r[g].url&&m.includes(r[g].url)&&e.push(new Me(a,r,`all the sprites' URLs must be unique, but ${r[g].url} is duplicated`)),m.push(r[g].url),e=e.concat(Ki({key:`${a}[${g}]`,value:r[g],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return e}return Ir({key:a,value:r})}const $s={"*":()=>[],array:is,boolean:function(i){const e=i.value,r=i.key,a=mt(e);return a!=="boolean"?[new Me(r,e,`boolean expected, ${a} found`)]:[]},number:go,color:function(i){const e=i.key,r=i.value,a=mt(r);return a!=="string"?[new Me(e,r,`color expected, ${a} found`)]:vt.parse(String(r))?[]:[new Me(e,r,`color expected, "${r}" found`)]},constants:ac,enum:An,filter:ns,function:yo,layer:vo,object:Ki,source:lc,light:cc,sky:uc,terrain:hc,string:Ir,formatted:function(i){return Ir(i).length===0?[]:rs(i)},resolvedImage:function(i){return Ir(i).length===0?[]:rs(i)},padding:function(i){const e=i.key,r=i.value;if(mt(r)==="array"){if(r.length<1||r.length>4)return[new Me(e,r,`padding requires 1 to 4 values; ${r.length} values found`)];const a={type:"number"};let u=[];for(let m=0;m<r.length;m++)u=u.concat(i.validateSpec({key:`${e}[${m}]`,value:r[m],validateSpec:i.validateSpec,valueSpec:a}));return u}return go({key:e,value:r,valueSpec:{}})},variableAnchorOffsetCollection:function(i){const e=i.key,r=i.value,a=mt(r),u=i.styleSpec;if(a!=="array"||r.length<1||r.length%2!=0)return[new Me(e,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let m=[];for(let g=0;g<r.length;g+=2)m=m.concat(An({key:`${e}[${g}]`,value:r[g],valueSpec:u.layout_symbol["text-anchor"]})),m=m.concat(is({key:`${e}[${g+1}]`,value:r[g+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:u}));return m},sprite:Os};function li(i){const e=i.value,r=i.valueSpec,a=i.styleSpec;return i.validateSpec=li,r.expression&&Qn(jt(e))?yo(i):r.expression&&Et(Qr(e))?rs(i):r.type&&$s[r.type]?$s[r.type](i):Ki(qi({},i,{valueSpec:r.type?a[r.type]:r}))}function ss(i){const e=i.value,r=i.key,a=Ir(i);return a.length||(e.indexOf("{fontstack}")===-1&&a.push(new Me(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&a.push(new Me(r,e,'"glyphs" url must include a "{range}" token'))),a}function ar(i,e=fe){let r=[];return r=r.concat(li({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,validateSpec:li,objectElementValidators:{glyphs:ss,"*":()=>[]}})),i.constants&&(r=r.concat(ac({key:"constants",value:i.constants,style:i,styleSpec:e,validateSpec:li}))),dc(r)}function Cr(i){return function(e){return i({...e,validateSpec:li})}}function dc(i){return[].concat(i).sort((e,r)=>e.line-r.line)}function zi(i){return function(...e){return dc(i.apply(this,e))}}ar.source=zi(Cr(lc)),ar.sprite=zi(Cr(Os)),ar.glyphs=zi(Cr(ss)),ar.light=zi(Cr(cc)),ar.sky=zi(Cr(uc)),ar.terrain=zi(Cr(hc)),ar.layer=zi(Cr(vo)),ar.filter=zi(Cr(ns)),ar.paintProperty=zi(Cr(va)),ar.layoutProperty=zi(Cr(xo));const as=ar,bo=as.light,zu=as.paintProperty,wo=as.layoutProperty;function pc(i,e){let r=!1;if(e&&e.length)for(const a of e)i.fire(new Qt(new Error(a.message))),r=!0;return r}class Fr{constructor(e,r,a){const u=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const g=new Int32Array(this.arrayBuffer);e=g[0],this.d=(r=g[1])+2*(a=g[2]);for(let w=0;w<this.d*this.d;w++){const E=g[3+w],C=g[3+w+1];u.push(E===C?null:g.subarray(E,C))}const _=g[3+u.length+1];this.keys=g.subarray(g[3+u.length],_),this.bboxes=g.subarray(_),this.insert=this._insertReadonly}else{this.d=r+2*a;for(let g=0;g<this.d*this.d;g++)u.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=e,this.padding=a,this.scale=r/e,this.uid=0;const m=a/r*e;this.min=-m,this.max=e+m}insert(e,r,a,u,m){this._forEachCell(r,a,u,m,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(r),this.bboxes.push(a),this.bboxes.push(u),this.bboxes.push(m)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,r,a,u,m,g){this.cells[m].push(g)}query(e,r,a,u,m){const g=this.min,_=this.max;if(e<=g&&r<=g&&_<=a&&_<=u&&!m)return Array.prototype.slice.call(this.keys);{const w=[];return this._forEachCell(e,r,a,u,this._queryCell,w,{},m),w}}_queryCell(e,r,a,u,m,g,_,w){const E=this.cells[m];if(E!==null){const C=this.keys,P=this.bboxes;for(let R=0;R<E.length;R++){const B=E[R];if(_[B]===void 0){const F=4*B;(w?w(P[F+0],P[F+1],P[F+2],P[F+3]):e<=P[F+2]&&r<=P[F+3]&&a>=P[F+0]&&u>=P[F+1])?(_[B]=!0,g.push(C[B])):_[B]=!1}}}}_forEachCell(e,r,a,u,m,g,_,w){const E=this._convertToCellCoord(e),C=this._convertToCellCoord(r),P=this._convertToCellCoord(a),R=this._convertToCellCoord(u);for(let B=E;B<=P;B++)for(let F=C;F<=R;F++){const V=this.d*F+B;if((!w||w(this._convertFromCellCoord(B),this._convertFromCellCoord(F),this._convertFromCellCoord(B+1),this._convertFromCellCoord(F+1)))&&m.call(this,e,r,a,u,V,g,_,w))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,r=3+this.cells.length+1+1;let a=0;for(let g=0;g<this.cells.length;g++)a+=this.cells[g].length;const u=new Int32Array(r+a+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;let m=r;for(let g=0;g<e.length;g++){const _=e[g];u[3+g]=m,u.set(_,m),m+=_.length}return u[3+e.length]=m,u.set(this.keys,m),m+=this.keys.length,u[3+e.length+1]=m,u.set(this.bboxes,m),m+=this.bboxes.length,u.buffer}static serialize(e,r){const a=e.toArrayBuffer();return r&&r.push(a),{buffer:a}}static deserialize(e){return new Fr(e.buffer)}}const en={};function Oe(i,e,r={}){if(en[i])throw new Error(`${i} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),en[i]={klass:e,omit:r.omit||[],shallow:r.shallow||[]}}Oe("Object",Object),Oe("TransferableGridIndex",Fr),Oe("Color",vt),Oe("Error",Error),Oe("AJAXError",ur),Oe("ResolvedImage",nr),Oe("StylePropertyFunction",ga),Oe("StyleExpression",Ls,{omit:["_evaluator"]}),Oe("ZoomDependentExpression",ma),Oe("ZoomConstantExpression",es),Oe("CompoundExpression",sr,{omit:["_evaluate"]});for(const i in Xn)Xn[i]._classRegistryKey||Oe(`Expression_${i}`,Xn[i]);function So(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function En(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||i instanceof Error)return i;if(So(i)||wr(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){const r=i;return e&&e.push(r.buffer),r}if(i instanceof ImageData)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const r=[];for(const a of i)r.push(En(a,e));return r}if(typeof i=="object"){const r=i.constructor,a=r._classRegistryKey;if(!a)throw new Error(`can't serialize object of unregistered class ${r.name}`);if(!en[a])throw new Error(`${a} is not registered.`);const u=r.serialize?r.serialize(i,e):{};if(r.serialize){if(e&&u===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const m in i){if(!i.hasOwnProperty(m)||en[a].omit.indexOf(m)>=0)continue;const g=i[m];u[m]=en[a].shallow.indexOf(m)>=0?g:En(g,e)}i instanceof Error&&(u.message=i.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(u.$name=a),u}throw new Error("can't serialize object of type "+typeof i)}function os(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||i instanceof Error||So(i)||wr(i)||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(os);if(typeof i=="object"){const e=i.$name||"Object";if(!en[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:r}=en[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(i);const a=Object.create(r.prototype);for(const u of Object.keys(i)){if(u==="$name")continue;const m=i[u];a[u]=en[e].shallow.indexOf(u)>=0?m:os(m)}return a}throw new Error("can't deserialize object of type "+typeof i)}class To{constructor(){this.first=!0}update(e,r){const a=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=a,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=a,!0):(this.lastFloorZoom>a?(this.lastIntegerZoom=a+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<a&&(this.lastIntegerZoom=a,this.lastIntegerZoomTime=r),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=a,!0))}}const Le={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function Ns(i){for(const e of i)if(wa(e.charCodeAt(0)))return!0;return!1}function ba(i){for(const e of i)if(!fc(e.charCodeAt(0)))return!1;return!0}function fc(i){return!(Le.Arabic(i)||Le["Arabic Supplement"](i)||Le["Arabic Extended-A"](i)||Le["Arabic Presentation Forms-A"](i)||Le["Arabic Presentation Forms-B"](i))}function wa(i){return!(i!==746&&i!==747&&(i<4352||!(Le["Bopomofo Extended"](i)||Le.Bopomofo(i)||Le["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||Le["CJK Compatibility Ideographs"](i)||Le["CJK Compatibility"](i)||Le["CJK Radicals Supplement"](i)||Le["CJK Strokes"](i)||!(!Le["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||Le["CJK Unified Ideographs Extension A"](i)||Le["CJK Unified Ideographs"](i)||Le["Enclosed CJK Letters and Months"](i)||Le["Hangul Compatibility Jamo"](i)||Le["Hangul Jamo Extended-A"](i)||Le["Hangul Jamo Extended-B"](i)||Le["Hangul Jamo"](i)||Le["Hangul Syllables"](i)||Le.Hiragana(i)||Le["Ideographic Description Characters"](i)||Le.Kanbun(i)||Le["Kangxi Radicals"](i)||Le["Katakana Phonetic Extensions"](i)||Le.Katakana(i)&&i!==12540||!(!Le["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!Le["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||Le["Unified Canadian Aboriginal Syllabics"](i)||Le["Unified Canadian Aboriginal Syllabics Extended"](i)||Le["Vertical Forms"](i)||Le["Yijing Hexagram Symbols"](i)||Le["Yi Syllables"](i)||Le["Yi Radicals"](i))))}function Ao(i){return!(wa(i)||function(e){return!!(Le["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Le["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Le["Letterlike Symbols"](e)||Le["Number Forms"](e)||Le["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Le["Control Pictures"](e)&&e!==9251||Le["Optical Character Recognition"](e)||Le["Enclosed Alphanumerics"](e)||Le["Geometric Shapes"](e)||Le["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Le["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Le["CJK Symbols and Punctuation"](e)||Le.Katakana(e)||Le["Private Use Area"](e)||Le["CJK Compatibility Forms"](e)||Le["Small Form Variants"](e)||Le["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function Eo(i){return i>=1424&&i<=2303||Le["Arabic Presentation Forms-A"](i)||Le["Arabic Presentation Forms-B"](i)}function Io(i,e){return!(!e&&Eo(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||Le.Khmer(i))}function mc(i){for(const e of i)if(Eo(e.charCodeAt(0)))return!0;return!1}const In=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(i){this.pluginStatus=i.pluginStatus,this.pluginURL=i.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(i){this.applyArabicShaping=i.applyArabicShaping,this.processBidirectionalText=i.processBidirectionalText,this.processStyledBidirectionalText=i.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Pt{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new To,this.transition={})}isSupportedScript(e){return function(r,a){for(const u of r)if(!Io(u.charCodeAt(0),a))return!1;return!0}(e,In.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,r=e-Math.floor(e),a=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*a}:{fromScale:.5,toScale:1,t:1-(1-a)*r}}}class Sa{constructor(e,r){this.property=e,this.value=r,this.expression=function(a,u){if(Qn(a))return new ga(a,u);if(Et(a)){const m=tc(a,u);if(m.result==="error")throw new Error(m.value.map(g=>`${g.key}: ${g.message}`).join(", "));return m.value}{let m=a;return u.type==="color"&&typeof a=="string"?m=vt.parse(a):u.type!=="padding"||typeof a!="number"&&!Array.isArray(a)?u.type==="variableAnchorOffsetCollection"&&Array.isArray(a)&&(m=yi.parse(a)):m=Zi.parse(a),{kind:"constant",evaluate:()=>m}}}(r===void 0?e.specification.default:r,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,a){return this.property.possiblyEvaluate(this,e,r,a)}}class Ta{constructor(e){this.property=e,this.value=new Sa(e,void 0)}transitioned(e,r){return new Po(this.property,this.value,r,fi({},e.transition,this.transition),e.now)}untransitioned(){return new Po(this.property,this.value,null,{},0)}}class Co{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Pi(this._values[e].value.value)}setValue(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Ta(this._values[e].property)),this._values[e].value=new Sa(this._values[e].property,r===null?void 0:Pi(r))}getTransition(e){return Pi(this._values[e].transition)}setTransition(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Ta(this._values[e].property)),this._values[e].transition=Pi(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const a=this.getValue(r);a!==void 0&&(e[r]=a);const u=this.getTransition(r);u!==void 0&&(e[`${r}-transition`]=u)}return e}transitioned(e,r){const a=new gc(this._properties);for(const u of Object.keys(this._values))a._values[u]=this._values[u].transitioned(e,r._values[u]);return a}untransitioned(){const e=new gc(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class Po{constructor(e,r,a,u,m){this.property=e,this.value=r,this.begin=m+u.delay||0,this.end=this.begin+u.duration||0,e.specification.transition&&(u.delay||u.duration)&&(this.prior=a)}possiblyEvaluate(e,r,a){const u=e.now||0,m=this.value.possiblyEvaluate(e,r,a),g=this.prior;if(g){if(u>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(u<this.begin)return g.possiblyEvaluate(e,r,a);{const _=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(e,r,a),m,function(w){if(w<=0)return 0;if(w>=1)return 1;const E=w*w,C=E*w;return 4*(w<.5?C:3*(w-E)+C-.75)}(_))}}return m}}class gc{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,a){const u=new Us(this._properties);for(const m of Object.keys(this._values))u._values[m]=this._values[m].possiblyEvaluate(e,r,a);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Bu{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}hasValue(e){return this._values[e].value!==void 0}getValue(e){return Pi(this._values[e].value)}setValue(e,r){this._values[e]=new Sa(this._values[e].property,r===null?void 0:Pi(r))}serialize(){const e={};for(const r of Object.keys(this._values)){const a=this.getValue(r);a!==void 0&&(e[r]=a)}return e}possiblyEvaluate(e,r,a){const u=new Us(this._properties);for(const m of Object.keys(this._values))u._values[m]=this._values[m].possiblyEvaluate(e,r,a);return u}}class dr{constructor(e,r,a){this.property=e,this.value=r,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,a,u){return this.property.evaluate(this.value,this.parameters,e,r,a,u)}}class Us{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class je{constructor(e){this.specification=e}possiblyEvaluate(e,r){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(r)}interpolate(e,r,a){const u=Wi[this.specification.type];return u?u(e,r,a):e}}class He{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,a,u){return new dr(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},a,u)}:e.expression,r)}interpolate(e,r,a){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new dr(this,{kind:"constant",value:void 0},e.parameters);const u=Wi[this.specification.type];if(u){const m=u(e.value.value,r.value.value,a);return new dr(this,{kind:"constant",value:m},e.parameters)}return e}evaluate(e,r,a,u,m,g){return e.kind==="constant"?e.value:e.evaluate(r,a,u,m,g)}}class Cn extends He{possiblyEvaluate(e,r,a,u){if(e.value===void 0)return new dr(this,{kind:"constant",value:void 0},r);if(e.expression.kind==="constant"){const m=e.expression.evaluate(r,null,{},a,u),g=e.property.specification.type==="resolvedImage"&&typeof m!="string"?m.name:m,_=this._calculate(g,g,g,r);return new dr(this,{kind:"constant",value:_},r)}if(e.expression.kind==="camera"){const m=this._calculate(e.expression.evaluate({zoom:r.zoom-1}),e.expression.evaluate({zoom:r.zoom}),e.expression.evaluate({zoom:r.zoom+1}),r);return new dr(this,{kind:"constant",value:m},r)}return new dr(this,e.expression,r)}evaluate(e,r,a,u,m,g){if(e.kind==="source"){const _=e.evaluate(r,a,u,m,g);return this._calculate(_,_,_,r)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(r.zoom)-1},a,u),e.evaluate({zoom:Math.floor(r.zoom)},a,u),e.evaluate({zoom:Math.floor(r.zoom)+1},a,u),r):e.value}_calculate(e,r,a,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:a,to:r}}interpolate(e){return e}}class Mo{constructor(e){this.specification=e}possiblyEvaluate(e,r,a,u){if(e.value!==void 0){if(e.expression.kind==="constant"){const m=e.expression.evaluate(r,null,{},a,u);return this._calculate(m,m,m,r)}return this._calculate(e.expression.evaluate(new Pt(Math.floor(r.zoom-1),r)),e.expression.evaluate(new Pt(Math.floor(r.zoom),r)),e.expression.evaluate(new Pt(Math.floor(r.zoom+1),r)),r)}}_calculate(e,r,a,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:a,to:r}}interpolate(e){return e}}class Vs{constructor(e){this.specification=e}possiblyEvaluate(e,r,a,u){return!!e.expression.evaluate(r,null,{},a,u)}interpolate(){return!1}}class Bi{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in e){const a=e[r];a.specification.overridable&&this.overridableProperties.push(r);const u=this.defaultPropertyValues[r]=new Sa(a,void 0),m=this.defaultTransitionablePropertyValues[r]=new Ta(a);this.defaultTransitioningPropertyValues[r]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=u.possiblyEvaluate({})}}}Oe("DataDrivenProperty",He),Oe("DataConstantProperty",je),Oe("CrossFadedDataDrivenProperty",Cn),Oe("CrossFadedProperty",Mo),Oe("ColorRampProperty",Vs);const yc="-transition";class pr extends gn{constructor(e,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new Bu(r.layout)),r.paint)){this._transitionablePaint=new Co(r.paint);for(const a in e.paint)this.setPaintProperty(a,e.paint[a],{validate:!1});for(const a in e.layout)this.setLayoutProperty(a,e.layout[a],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Us(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r,a={}){r!=null&&this._validate(wo,`layers.${this.id}.layout.${e}`,e,r,a)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,r):this.visibility=r)}getPaintProperty(e){return e.endsWith(yc)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,a={}){if(r!=null&&this._validate(zu,`layers.${this.id}.paint.${e}`,e,r,a))return!1;if(e.endsWith(yc))return this._transitionablePaint.setTransition(e.slice(0,-11),r||void 0),!1;{const u=this._transitionablePaint._values[e],m=u.property.specification["property-type"]==="cross-faded-data-driven",g=u.value.isDataDriven(),_=u.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const w=this._transitionablePaint._values[e].value;return w.isDataDriven()||g||m||this._handleOverridablePaintPropertyUpdate(e,_,w)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,r,a){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),ta(e,(r,a)=>!(r===void 0||a==="layout"&&!Object.keys(r).length||a==="paint"&&!Object.keys(r).length))}_validate(e,r,a,u,m={}){return(!m||m.validate!==!1)&&pc(this,e.call(as,{key:r,layerType:this.type,objectKey:a,value:u,styleSpec:fe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof dr&&Jn(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}const _c={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ls{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class $t{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Wt(i,e=1){let r=0,a=0;return{members:i.map(u=>{const m=_c[u.type].BYTES_PER_ELEMENT,g=r=xc(r,Math.max(e,m)),_=u.components||1;return a=Math.max(a,m),r+=m*_,{name:u.name,type:u.type,components:_,offset:g}}),size:xc(r,Math.max(a,e)),alignment:e}}function xc(i,e){return Math.ceil(i/e)*e}class js extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const u=2*e;return this.int16[u+0]=r,this.int16[u+1]=a,e}}js.prototype.bytesPerElement=4,Oe("StructArrayLayout2i4",js);class Aa extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,a)}emplace(e,r,a,u){const m=3*e;return this.int16[m+0]=r,this.int16[m+1]=a,this.int16[m+2]=u,e}}Aa.prototype.bytesPerElement=6,Oe("StructArrayLayout3i6",Aa);class tn extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,u){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,a,u)}emplace(e,r,a,u,m){const g=4*e;return this.int16[g+0]=r,this.int16[g+1]=a,this.int16[g+2]=u,this.int16[g+3]=m,e}}tn.prototype.bytesPerElement=8,Oe("StructArrayLayout4i8",tn);class ko extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,u,m,g){const _=this.length;return this.resize(_+1),this.emplace(_,e,r,a,u,m,g)}emplace(e,r,a,u,m,g,_){const w=6*e;return this.int16[w+0]=r,this.int16[w+1]=a,this.int16[w+2]=u,this.int16[w+3]=m,this.int16[w+4]=g,this.int16[w+5]=_,e}}ko.prototype.bytesPerElement=12,Oe("StructArrayLayout2i4i12",ko);class Do extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,u,m,g){const _=this.length;return this.resize(_+1),this.emplace(_,e,r,a,u,m,g)}emplace(e,r,a,u,m,g,_){const w=4*e,E=8*e;return this.int16[w+0]=r,this.int16[w+1]=a,this.uint8[E+4]=u,this.uint8[E+5]=m,this.uint8[E+6]=g,this.uint8[E+7]=_,e}}Do.prototype.bytesPerElement=8,Oe("StructArrayLayout2i4ub8",Do);class qs extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const u=2*e;return this.float32[u+0]=r,this.float32[u+1]=a,e}}qs.prototype.bytesPerElement=8,Oe("StructArrayLayout2f8",qs);class Ro extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,u,m,g,_,w,E,C){const P=this.length;return this.resize(P+1),this.emplace(P,e,r,a,u,m,g,_,w,E,C)}emplace(e,r,a,u,m,g,_,w,E,C,P){const R=10*e;return this.uint16[R+0]=r,this.uint16[R+1]=a,this.uint16[R+2]=u,this.uint16[R+3]=m,this.uint16[R+4]=g,this.uint16[R+5]=_,this.uint16[R+6]=w,this.uint16[R+7]=E,this.uint16[R+8]=C,this.uint16[R+9]=P,e}}Ro.prototype.bytesPerElement=20,Oe("StructArrayLayout10ui20",Ro);class Ea extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,u,m,g,_,w,E,C,P,R){const B=this.length;return this.resize(B+1),this.emplace(B,e,r,a,u,m,g,_,w,E,C,P,R)}emplace(e,r,a,u,m,g,_,w,E,C,P,R,B){const F=12*e;return this.int16[F+0]=r,this.int16[F+1]=a,this.int16[F+2]=u,this.int16[F+3]=m,this.uint16[F+4]=g,this.uint16[F+5]=_,this.uint16[F+6]=w,this.uint16[F+7]=E,this.int16[F+8]=C,this.int16[F+9]=P,this.int16[F+10]=R,this.int16[F+11]=B,e}}Ea.prototype.bytesPerElement=24,Oe("StructArrayLayout4i4ui4i24",Ea);class zo extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,a)}emplace(e,r,a,u){const m=3*e;return this.float32[m+0]=r,this.float32[m+1]=a,this.float32[m+2]=u,e}}zo.prototype.bytesPerElement=12,Oe("StructArrayLayout3f12",zo);class Bo extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}Bo.prototype.bytesPerElement=4,Oe("StructArrayLayout1ul4",Bo);class Or extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,u,m,g,_,w,E){const C=this.length;return this.resize(C+1),this.emplace(C,e,r,a,u,m,g,_,w,E)}emplace(e,r,a,u,m,g,_,w,E,C){const P=10*e,R=5*e;return this.int16[P+0]=r,this.int16[P+1]=a,this.int16[P+2]=u,this.int16[P+3]=m,this.int16[P+4]=g,this.int16[P+5]=_,this.uint32[R+3]=w,this.uint16[P+8]=E,this.uint16[P+9]=C,e}}Or.prototype.bytesPerElement=20,Oe("StructArrayLayout6i1ul2ui20",Or);class Ia extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,u,m,g){const _=this.length;return this.resize(_+1),this.emplace(_,e,r,a,u,m,g)}emplace(e,r,a,u,m,g,_){const w=6*e;return this.int16[w+0]=r,this.int16[w+1]=a,this.int16[w+2]=u,this.int16[w+3]=m,this.int16[w+4]=g,this.int16[w+5]=_,e}}Ia.prototype.bytesPerElement=12,Oe("StructArrayLayout2i2i2i12",Ia);class Gs extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,u,m){const g=this.length;return this.resize(g+1),this.emplace(g,e,r,a,u,m)}emplace(e,r,a,u,m,g){const _=4*e,w=8*e;return this.float32[_+0]=r,this.float32[_+1]=a,this.float32[_+2]=u,this.int16[w+6]=m,this.int16[w+7]=g,e}}Gs.prototype.bytesPerElement=16,Oe("StructArrayLayout2f1f2i16",Gs);class Ca extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,a,u)}emplace(e,r,a,u,m){const g=12*e,_=3*e;return this.uint8[g+0]=r,this.uint8[g+1]=a,this.float32[_+1]=u,this.float32[_+2]=m,e}}Ca.prototype.bytesPerElement=12,Oe("StructArrayLayout2ub2f12",Ca);class cs extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,a)}emplace(e,r,a,u){const m=3*e;return this.uint16[m+0]=r,this.uint16[m+1]=a,this.uint16[m+2]=u,e}}cs.prototype.bytesPerElement=6,Oe("StructArrayLayout3ui6",cs);class Lo extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u,m,g,_,w,E,C,P,R,B,F,V,Z,Y){const le=this.length;return this.resize(le+1),this.emplace(le,e,r,a,u,m,g,_,w,E,C,P,R,B,F,V,Z,Y)}emplace(e,r,a,u,m,g,_,w,E,C,P,R,B,F,V,Z,Y,le){const J=24*e,se=12*e,ge=48*e;return this.int16[J+0]=r,this.int16[J+1]=a,this.uint16[J+2]=u,this.uint16[J+3]=m,this.uint32[se+2]=g,this.uint32[se+3]=_,this.uint32[se+4]=w,this.uint16[J+10]=E,this.uint16[J+11]=C,this.uint16[J+12]=P,this.float32[se+7]=R,this.float32[se+8]=B,this.uint8[ge+36]=F,this.uint8[ge+37]=V,this.uint8[ge+38]=Z,this.uint32[se+10]=Y,this.int16[J+22]=le,e}}Lo.prototype.bytesPerElement=48,Oe("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Lo);class us extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u,m,g,_,w,E,C,P,R,B,F,V,Z,Y,le,J,se,ge,xe,Be,Ne,ze,Re,Ce,$e){const De=this.length;return this.resize(De+1),this.emplace(De,e,r,a,u,m,g,_,w,E,C,P,R,B,F,V,Z,Y,le,J,se,ge,xe,Be,Ne,ze,Re,Ce,$e)}emplace(e,r,a,u,m,g,_,w,E,C,P,R,B,F,V,Z,Y,le,J,se,ge,xe,Be,Ne,ze,Re,Ce,$e,De){const Ee=32*e,Ge=16*e;return this.int16[Ee+0]=r,this.int16[Ee+1]=a,this.int16[Ee+2]=u,this.int16[Ee+3]=m,this.int16[Ee+4]=g,this.int16[Ee+5]=_,this.int16[Ee+6]=w,this.int16[Ee+7]=E,this.uint16[Ee+8]=C,this.uint16[Ee+9]=P,this.uint16[Ee+10]=R,this.uint16[Ee+11]=B,this.uint16[Ee+12]=F,this.uint16[Ee+13]=V,this.uint16[Ee+14]=Z,this.uint16[Ee+15]=Y,this.uint16[Ee+16]=le,this.uint16[Ee+17]=J,this.uint16[Ee+18]=se,this.uint16[Ee+19]=ge,this.uint16[Ee+20]=xe,this.uint16[Ee+21]=Be,this.uint16[Ee+22]=Ne,this.uint32[Ge+12]=ze,this.float32[Ge+13]=Re,this.float32[Ge+14]=Ce,this.uint16[Ee+30]=$e,this.uint16[Ee+31]=De,e}}us.prototype.bytesPerElement=64,Oe("StructArrayLayout8i15ui1ul2f2ui64",us);class rn extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}rn.prototype.bytesPerElement=4,Oe("StructArrayLayout1f4",rn);class Fo extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,a)}emplace(e,r,a,u){const m=3*e;return this.uint16[6*e+0]=r,this.float32[m+1]=a,this.float32[m+2]=u,e}}Fo.prototype.bytesPerElement=12,Oe("StructArrayLayout1ui2f12",Fo);class Pa extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,a)}emplace(e,r,a,u){const m=4*e;return this.uint32[2*e+0]=r,this.uint16[m+2]=a,this.uint16[m+3]=u,e}}Pa.prototype.bytesPerElement=8,Oe("StructArrayLayout1ul2ui8",Pa);class Pn extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const u=2*e;return this.uint16[u+0]=r,this.uint16[u+1]=a,e}}Pn.prototype.bytesPerElement=4,Oe("StructArrayLayout2ui4",Pn);class Oo extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}Oo.prototype.bytesPerElement=2,Oe("StructArrayLayout1ui2",Oo);class $o extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,a,u)}emplace(e,r,a,u,m){const g=4*e;return this.float32[g+0]=r,this.float32[g+1]=a,this.float32[g+2]=u,this.float32[g+3]=m,e}}$o.prototype.bytesPerElement=16,Oe("StructArrayLayout4f16",$o);class No extends ls{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new Q(this.anchorPointX,this.anchorPointY)}}No.prototype.size=20;class vc extends Or{get(e){return new No(this,e)}}Oe("CollisionBoxArray",vc);class p extends ls{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}p.prototype.size=48;class t extends Lo{get(e){return new p(this,e)}}Oe("PlacedSymbolArray",t);class n extends ls{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}n.prototype.size=64;class l extends us{get(e){return new n(this,e)}}Oe("SymbolInstanceArray",l);class c extends rn{getoffsetX(e){return this.float32[1*e+0]}}Oe("GlyphOffsetArray",c);class f extends Aa{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Oe("SymbolLineVertexArray",f);class v extends ls{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}v.prototype.size=12;class b extends Fo{get(e){return new v(this,e)}}Oe("TextAnchorOffsetArray",b);class A extends ls{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}A.prototype.size=8;class I extends Pa{get(e){return new A(this,e)}}Oe("FeatureIndexArray",I);class M extends js{}class k extends js{}class L extends js{}class H extends ko{}class q extends Do{}class W extends qs{}class N extends Ro{}class te extends Ea{}class ue extends zo{}class X extends Bo{}class ae extends Ia{}class he extends Ca{}class de extends cs{}class pe extends Pn{}const Se=Wt([{name:"a_pos",components:2,type:"Int16"}],4),{members:ve}=Se;class we{constructor(e=[]){this.segments=e}prepareSegment(e,r,a,u){let m=this.segments[this.segments.length-1];return e>we.MAX_VERTEX_ARRAY_LENGTH&&mi(`Max vertices per segment is ${we.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!m||m.vertexLength+e>we.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==u)&&(m={vertexOffset:r.length,primitiveOffset:a.length,vertexLength:0,primitiveLength:0},u!==void 0&&(m.sortKey=u),this.segments.push(m)),m}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,a,u){return new we([{vertexOffset:e,primitiveOffset:r,vertexLength:a,primitiveLength:u,vaos:{},sortKey:0}])}}function Fe(i,e){return 256*(i=pi(Math.floor(i),0,255))+pi(Math.floor(e),0,255)}we.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Oe("SegmentVector",we);const Qe=Wt([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var ke={exports:{}},We={exports:{}};We.exports=function(i,e){var r,a,u,m,g,_,w,E;for(a=i.length-(r=3&i.length),u=e,g=3432918353,_=461845907,E=0;E<a;)w=255&i.charCodeAt(E)|(255&i.charCodeAt(++E))<<8|(255&i.charCodeAt(++E))<<16|(255&i.charCodeAt(++E))<<24,++E,u=27492+(65535&(m=5*(65535&(u=(u^=w=(65535&(w=(w=(65535&w)*g+(((w>>>16)*g&65535)<<16)&4294967295)<<15|w>>>17))*_+(((w>>>16)*_&65535)<<16)&4294967295)<<13|u>>>19))+((5*(u>>>16)&65535)<<16)&4294967295))+((58964+(m>>>16)&65535)<<16);switch(w=0,r){case 3:w^=(255&i.charCodeAt(E+2))<<16;case 2:w^=(255&i.charCodeAt(E+1))<<8;case 1:u^=w=(65535&(w=(w=(65535&(w^=255&i.charCodeAt(E)))*g+(((w>>>16)*g&65535)<<16)&4294967295)<<15|w>>>17))*_+(((w>>>16)*_&65535)<<16)&4294967295}return u^=i.length,u=2246822507*(65535&(u^=u>>>16))+((2246822507*(u>>>16)&65535)<<16)&4294967295,u=3266489909*(65535&(u^=u>>>13))+((3266489909*(u>>>16)&65535)<<16)&4294967295,(u^=u>>>16)>>>0};var rt=We.exports,ct={exports:{}};ct.exports=function(i,e){for(var r,a=i.length,u=e^a,m=0;a>=4;)r=1540483477*(65535&(r=255&i.charCodeAt(m)|(255&i.charCodeAt(++m))<<8|(255&i.charCodeAt(++m))<<16|(255&i.charCodeAt(++m))<<24))+((1540483477*(r>>>16)&65535)<<16),u=1540483477*(65535&u)+((1540483477*(u>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),a-=4,++m;switch(a){case 3:u^=(255&i.charCodeAt(m+2))<<16;case 2:u^=(255&i.charCodeAt(m+1))<<8;case 1:u=1540483477*(65535&(u^=255&i.charCodeAt(m)))+((1540483477*(u>>>16)&65535)<<16)}return u=1540483477*(65535&(u^=u>>>13))+((1540483477*(u>>>16)&65535)<<16),(u^=u>>>15)>>>0};var Xe=rt,st=ct.exports;ke.exports=Xe,ke.exports.murmur3=Xe,ke.exports.murmur2=st;var at=K(ke.exports);class Ft{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,a,u){this.ids.push(At(e)),this.positions.push(r,a,u)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=At(e);let a=0,u=this.ids.length-1;for(;a<u;){const g=a+u>>1;this.ids[g]>=r?u=g:a=g+1}const m=[];for(;this.ids[a]===r;)m.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return m}static serialize(e,r){const a=new Float64Array(e.ids),u=new Uint32Array(e.positions);return Li(a,u,0,a.length-1),r&&r.push(a.buffer,u.buffer),{ids:a,positions:u}}static deserialize(e){const r=new Ft;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function At(i){const e=+i;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:at(String(i))}function Li(i,e,r,a){for(;r<a;){const u=i[r+a>>1];let m=r-1,g=a+1;for(;;){do m++;while(i[m]<u);do g--;while(i[g]>u);if(m>=g)break;Yt(i,m,g),Yt(e,3*m,3*g),Yt(e,3*m+1,3*g+1),Yt(e,3*m+2,3*g+2)}g-r<a-g?(Li(i,e,r,g),r=g+1):(Li(i,e,g+1,a),a=g)}}function Yt(i,e,r){const a=i[e];i[e]=i[r],i[r]=a}Oe("FeaturePositionMap",Ft);class It{constructor(e,r){this.gl=e.gl,this.location=r}}class _i extends It{constructor(e,r){super(e,r),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class fr extends It{constructor(e,r){super(e,r),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Pr extends It{constructor(e,r){super(e,r),this.current=vt.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Mn=new Float32Array(16);function kn(i){return[Fe(255*i.r,255*i.g),Fe(255*i.b,255*i.a)]}class Mr{constructor(e,r,a){this.value=e,this.uniformNames=r.map(u=>`u_${u}`),this.type=a}setUniform(e,r,a){e.set(a.constantOr(this.value))}getBinding(e,r,a){return this.type==="color"?new Pr(e,r):new _i(e,r)}}class mr{constructor(e,r){this.uniformNames=r.map(a=>`u_${a}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=e.tlbr}setUniform(e,r,a,u){const m=u==="u_pattern_to"?this.patternTo:u==="u_pattern_from"?this.patternFrom:u==="u_pixel_ratio_to"?this.pixelRatioTo:u==="u_pixel_ratio_from"?this.pixelRatioFrom:null;m&&e.set(m)}getBinding(e,r,a){return a.substr(0,9)==="u_pattern"?new fr(e,r):new _i(e,r)}}class Nt{constructor(e,r,a,u){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=r.map(m=>({name:`a_${m}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(e,r,a,u,m){const g=this.paintVertexArray.length,_=this.expression.evaluate(new Pt(0),r,{},u,[],m);this.paintVertexArray.resize(e),this._setPaintValue(g,e,_)}updatePaintArray(e,r,a,u){const m=this.expression.evaluate({zoom:0},a,u);this._setPaintValue(e,r,m)}_setPaintValue(e,r,a){if(this.type==="color"){const u=kn(a);for(let m=e;m<r;m++)this.paintVertexArray.emplace(m,u[0],u[1])}else{for(let u=e;u<r;u++)this.paintVertexArray.emplace(u,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Mt{constructor(e,r,a,u,m,g){this.expression=e,this.uniformNames=r.map(_=>`u_${_}_t`),this.type=a,this.useIntegerZoom=u,this.zoom=m,this.maxValue=0,this.paintVertexAttributes=r.map(_=>({name:`a_${_}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(e,r,a,u,m){const g=this.expression.evaluate(new Pt(this.zoom),r,{},u,[],m),_=this.expression.evaluate(new Pt(this.zoom+1),r,{},u,[],m),w=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(w,e,g,_)}updatePaintArray(e,r,a,u){const m=this.expression.evaluate({zoom:this.zoom},a,u),g=this.expression.evaluate({zoom:this.zoom+1},a,u);this._setPaintValue(e,r,m,g)}_setPaintValue(e,r,a,u){if(this.type==="color"){const m=kn(a),g=kn(u);for(let _=e;_<r;_++)this.paintVertexArray.emplace(_,m[0],m[1],g[0],g[1])}else{for(let m=e;m<r;m++)this.paintVertexArray.emplace(m,a,u);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r){const a=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,u=pi(this.expression.interpolationFactor(a,this.zoom,this.zoom+1),0,1);e.set(u)}getBinding(e,r,a){return new _i(e,r)}}class qt{constructor(e,r,a,u,m,g){this.expression=e,this.type=r,this.useIntegerZoom=a,this.zoom=u,this.layerId=g,this.zoomInPaintVertexArray=new m,this.zoomOutPaintVertexArray=new m}populatePaintArray(e,r,a){const u=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(u,e,r.patterns&&r.patterns[this.layerId],a)}updatePaintArray(e,r,a,u,m){this._setPaintValues(e,r,a.patterns&&a.patterns[this.layerId],m)}_setPaintValues(e,r,a,u){if(!u||!a)return;const{min:m,mid:g,max:_}=a,w=u[m],E=u[g],C=u[_];if(w&&E&&C)for(let P=e;P<r;P++)this.zoomInPaintVertexArray.emplace(P,E.tl[0],E.tl[1],E.br[0],E.br[1],w.tl[0],w.tl[1],w.br[0],w.br[1],E.pixelRatio,w.pixelRatio),this.zoomOutPaintVertexArray.emplace(P,E.tl[0],E.tl[1],E.br[0],E.br[1],C.tl[0],C.tl[1],C.br[0],C.br[1],E.pixelRatio,C.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,Qe.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,Qe.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class hs{constructor(e,r,a){this.binders={},this._buffers=[];const u=[];for(const m in e.paint._values){if(!a(m))continue;const g=e.paint.get(m);if(!(g instanceof dr&&Jn(g.property.specification)))continue;const _=ci(m,e.type),w=g.value,E=g.property.specification.type,C=g.property.useIntegerZoom,P=g.property.specification["property-type"],R=P==="cross-faded"||P==="cross-faded-data-driven";if(w.kind==="constant")this.binders[m]=R?new mr(w.value,_):new Mr(w.value,_,E),u.push(`/u_${m}`);else if(w.kind==="source"||R){const B=Xi(m,E,"source");this.binders[m]=R?new qt(w,E,C,r,B,e.id):new Nt(w,_,E,B),u.push(`/a_${m}`)}else{const B=Xi(m,E,"composite");this.binders[m]=new Mt(w,_,E,C,r,B),u.push(`/z_${m}`)}}this.cacheKey=u.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof Nt||r instanceof Mt?r.maxValue:0}populatePaintArrays(e,r,a,u,m){for(const g in this.binders){const _=this.binders[g];(_ instanceof Nt||_ instanceof Mt||_ instanceof qt)&&_.populatePaintArray(e,r,a,u,m)}}setConstantPatternPositions(e,r){for(const a in this.binders){const u=this.binders[a];u instanceof mr&&u.setConstantPatternPositions(e,r)}}updatePaintArrays(e,r,a,u,m){let g=!1;for(const _ in e){const w=r.getPositions(_);for(const E of w){const C=a.feature(E.index);for(const P in this.binders){const R=this.binders[P];if((R instanceof Nt||R instanceof Mt||R instanceof qt)&&R.expression.isStateDependent===!0){const B=u.paint.get(P);R.expression=B.value,R.updatePaintArray(E.start,E.end,C,e[_],m),g=!0}}}}return g}defines(){const e=[];for(const r in this.binders){const a=this.binders[r];(a instanceof Mr||a instanceof mr)&&e.push(...a.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const a=this.binders[r];if(a instanceof Nt||a instanceof Mt)for(let u=0;u<a.paintVertexAttributes.length;u++)e.push(a.paintVertexAttributes[u].name);else if(a instanceof qt)for(let u=0;u<Qe.members.length;u++)e.push(Qe.members[u].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const a=this.binders[r];if(a instanceof Mr||a instanceof mr||a instanceof Mt)for(const u of a.uniformNames)e.push(u)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,r){const a=[];for(const u in this.binders){const m=this.binders[u];if(m instanceof Mr||m instanceof mr||m instanceof Mt){for(const g of m.uniformNames)if(r[g]){const _=m.getBinding(e,r[g],g);a.push({name:g,property:u,binding:_})}}}return a}setUniforms(e,r,a,u){for(const{name:m,property:g,binding:_}of r)this.binders[g].setUniform(_,u,a.get(g),m)}updatePaintBuffers(e){this._buffers=[];for(const r in this.binders){const a=this.binders[r];if(e&&a instanceof qt){const u=e.fromScale===2?a.zoomInPaintVertexBuffer:a.zoomOutPaintVertexBuffer;u&&this._buffers.push(u)}else(a instanceof Nt||a instanceof Mt)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}}upload(e){for(const r in this.binders){const a=this.binders[r];(a instanceof Nt||a instanceof Mt||a instanceof qt)&&a.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof Nt||r instanceof Mt||r instanceof qt)&&r.destroy()}}}class Dt{constructor(e,r,a=()=>!0){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new hs(u,r,a);this.needsUpload=!1,this._featureMap=new Ft,this._bufferOffset=0}populatePaintArrays(e,r,a,u,m,g){for(const _ in this.programConfigurations)this.programConfigurations[_].populatePaintArrays(e,r,u,m,g);r.id!==void 0&&this._featureMap.add(r.id,a,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,a,u){for(const m of a)this.needsUpload=this.programConfigurations[m.id].updatePaintArrays(e,this._featureMap,r,m,u)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function ci(i,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}function Xi(i,e,r){const a={color:{source:qs,composite:$o},number:{source:rn,composite:qs}},u=function(m){return{"line-pattern":{source:N,composite:N},"fill-pattern":{source:N,composite:N},"fill-extrusion-pattern":{source:N,composite:N}}[m]}(i);return u&&u[r]||a[e][r]}Oe("ConstantBinder",Mr),Oe("CrossFadedConstantBinder",mr),Oe("SourceExpressionBinder",Nt),Oe("CrossFadedCompositeBinder",qt),Oe("CompositeExpressionBinder",Mt),Oe("ProgramConfiguration",hs,{omit:["_buffers"]}),Oe("ProgramConfigurationSet",Dt);const lt=8192,Uo=Math.pow(2,14)-1,bc=-Uo-1;function Dn(i){const e=lt/i.extent,r=i.loadGeometry();for(let a=0;a<r.length;a++){const u=r[a];for(let m=0;m<u.length;m++){const g=u[m],_=Math.round(g.x*e),w=Math.round(g.y*e);g.x=pi(_,bc,Uo),g.y=pi(w,bc,Uo),(_<g.x||_>g.x+1||w<g.y||w>g.y+1)&&mi("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function Rn(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?Dn(i):[]}}function Ma(i,e,r,a,u){i.emplaceBack(2*e+(a+1)/2,2*r+(u+1)/2)}class Vo{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new k,this.indexArray=new de,this.segments=new we,this.programConfigurations=new Dt(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,a){const u=this.layers[0],m=[];let g=null,_=!1;u.type==="circle"&&(g=u.layout.get("circle-sort-key"),_=!g.isConstant());for(const{feature:w,id:E,index:C,sourceLayerIndex:P}of e){const R=this.layers[0]._featureFilter.needGeometry,B=Rn(w,R);if(!this.layers[0]._featureFilter.filter(new Pt(this.zoom),B,a))continue;const F=_?g.evaluate(B,{},a):void 0,V={id:E,properties:w.properties,type:w.type,sourceLayerIndex:P,index:C,geometry:R?B.geometry:Dn(w),patterns:{},sortKey:F};m.push(V)}_&&m.sort((w,E)=>w.sortKey-E.sortKey);for(const w of m){const{geometry:E,index:C,sourceLayerIndex:P}=w,R=e[C].feature;this.addFeature(w,E,C,a),r.featureIndex.insert(R,E,C,P,this.index)}}update(e,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ve),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,a,u){for(const m of r)for(const g of m){const _=g.x,w=g.y;if(_<0||_>=lt||w<0||w>=lt)continue;const E=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),C=E.vertexLength;Ma(this.layoutVertexArray,_,w,-1,-1),Ma(this.layoutVertexArray,_,w,1,-1),Ma(this.layoutVertexArray,_,w,1,1),Ma(this.layoutVertexArray,_,w,-1,1),this.indexArray.emplaceBack(C,C+1,C+2),this.indexArray.emplaceBack(C,C+3,C+2),E.vertexLength+=4,E.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},u)}}function zn(i,e){for(let r=0;r<i.length;r++)if(ka(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(ka(i,e[r]))return!0;return!!Hs(i,e)}function wc(i,e,r){return!!ka(i,e)||!!Zs(e,i,r)}function jo(i,e){if(i.length===1)return Ad(e,i[0]);for(let r=0;r<e.length;r++){const a=e[r];for(let u=0;u<a.length;u++)if(ka(i,a[u]))return!0}for(let r=0;r<i.length;r++)if(Ad(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(Hs(i,e[r]))return!0;return!1}function Sc(i,e,r){if(i.length>1){if(Hs(i,e))return!0;for(let a=0;a<e.length;a++)if(Zs(e[a],i,r))return!0}for(let a=0;a<i.length;a++)if(Zs(i[a],e,r))return!0;return!1}function Hs(i,e){if(i.length===0||e.length===0)return!1;for(let r=0;r<i.length-1;r++){const a=i[r],u=i[r+1];for(let m=0;m<e.length-1;m++)if(Tc(a,u,e[m],e[m+1]))return!0}return!1}function Tc(i,e,r,a){return lr(i,r,a)!==lr(e,r,a)&&lr(i,e,r)!==lr(i,e,a)}function Zs(i,e,r){const a=r*r;if(e.length===1)return i.distSqr(e[0])<a;for(let u=1;u<e.length;u++)if(Td(i,e[u-1],e[u])<a)return!0;return!1}function Td(i,e,r){const a=e.distSqr(r);if(a===0)return i.distSqr(e);const u=((i.x-e.x)*(r.x-e.x)+(i.y-e.y)*(r.y-e.y))/a;return i.distSqr(u<0?e:u>1?r:r.sub(e)._mult(u)._add(e))}function Ad(i,e){let r,a,u,m=!1;for(let g=0;g<i.length;g++){r=i[g];for(let _=0,w=r.length-1;_<r.length;w=_++)a=r[_],u=r[w],a.y>e.y!=u.y>e.y&&e.x<(u.x-a.x)*(e.y-a.y)/(u.y-a.y)+a.x&&(m=!m)}return m}function ka(i,e){let r=!1;for(let a=0,u=i.length-1;a<i.length;u=a++){const m=i[a],g=i[u];m.y>e.y!=g.y>e.y&&e.x<(g.x-m.x)*(e.y-m.y)/(g.y-m.y)+m.x&&(r=!r)}return r}function yg(i,e,r){const a=r[0],u=r[2];if(i.x<a.x&&e.x<a.x||i.x>u.x&&e.x>u.x||i.y<a.y&&e.y<a.y||i.y>u.y&&e.y>u.y)return!1;const m=lr(i,e,r[0]);return m!==lr(i,e,r[1])||m!==lr(i,e,r[2])||m!==lr(i,e,r[3])}function qo(i,e,r){const a=e.paint.get(i).value;return a.kind==="constant"?a.value:r.programConfigurations.get(e.id).getMaxValue(i)}function Ac(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function Ec(i,e,r,a,u){if(!e[0]&&!e[1])return i;const m=Q.convert(e)._mult(u);r==="viewport"&&m._rotate(-a);const g=[];for(let _=0;_<i.length;_++)g.push(i[_].sub(m));return g}let Ed,Id;Oe("CircleBucket",Vo,{omit:["layers"]});var _g={get paint(){return Id=Id||new Bi({"circle-radius":new He(fe.paint_circle["circle-radius"]),"circle-color":new He(fe.paint_circle["circle-color"]),"circle-blur":new He(fe.paint_circle["circle-blur"]),"circle-opacity":new He(fe.paint_circle["circle-opacity"]),"circle-translate":new je(fe.paint_circle["circle-translate"]),"circle-translate-anchor":new je(fe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new je(fe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new je(fe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new He(fe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new He(fe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new He(fe.paint_circle["circle-stroke-opacity"])})},get layout(){return Ed=Ed||new Bi({"circle-sort-key":new He(fe.layout_circle["circle-sort-key"])})}},Fi=1e-6,Da=typeof Float32Array<"u"?Float32Array:Array;function Lu(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Cd(i,e,r){var a=e[0],u=e[1],m=e[2],g=e[3],_=e[4],w=e[5],E=e[6],C=e[7],P=e[8],R=e[9],B=e[10],F=e[11],V=e[12],Z=e[13],Y=e[14],le=e[15],J=r[0],se=r[1],ge=r[2],xe=r[3];return i[0]=J*a+se*_+ge*P+xe*V,i[1]=J*u+se*w+ge*R+xe*Z,i[2]=J*m+se*E+ge*B+xe*Y,i[3]=J*g+se*C+ge*F+xe*le,i[4]=(J=r[4])*a+(se=r[5])*_+(ge=r[6])*P+(xe=r[7])*V,i[5]=J*u+se*w+ge*R+xe*Z,i[6]=J*m+se*E+ge*B+xe*Y,i[7]=J*g+se*C+ge*F+xe*le,i[8]=(J=r[8])*a+(se=r[9])*_+(ge=r[10])*P+(xe=r[11])*V,i[9]=J*u+se*w+ge*R+xe*Z,i[10]=J*m+se*E+ge*B+xe*Y,i[11]=J*g+se*C+ge*F+xe*le,i[12]=(J=r[12])*a+(se=r[13])*_+(ge=r[14])*P+(xe=r[15])*V,i[13]=J*u+se*w+ge*R+xe*Z,i[14]=J*m+se*E+ge*B+xe*Y,i[15]=J*g+se*C+ge*F+xe*le,i}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var Go,xg=Cd;function Ic(i,e,r){var a=e[0],u=e[1],m=e[2],g=e[3];return i[0]=r[0]*a+r[4]*u+r[8]*m+r[12]*g,i[1]=r[1]*a+r[5]*u+r[9]*m+r[13]*g,i[2]=r[2]*a+r[6]*u+r[10]*m+r[14]*g,i[3]=r[3]*a+r[7]*u+r[11]*m+r[15]*g,i}Go=new Da(4),Da!=Float32Array&&(Go[0]=0,Go[1]=0,Go[2]=0,Go[3]=0);class vg extends pr{constructor(e){super(e,_g)}createBucket(e){return new Vo(e)}queryRadius(e){const r=e;return qo("circle-radius",this,r)+qo("circle-stroke-width",this,r)+Ac(this.paint.get("circle-translate"))}queryIntersectsFeature(e,r,a,u,m,g,_,w){const E=Ec(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),g.angle,_),C=this.paint.get("circle-radius").evaluate(r,a)+this.paint.get("circle-stroke-width").evaluate(r,a),P=this.paint.get("circle-pitch-alignment")==="map",R=P?E:function(F,V){return F.map(Z=>Pd(Z,V))}(E,w),B=P?C*_:C;for(const F of u)for(const V of F){const Z=P?V:Pd(V,w);let Y=B;const le=Ic([],[V.x,V.y,0,1],w);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Y*=le[3]/g.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Y*=g.cameraToCenterDistance/le[3]),wc(R,Z,Y))return!0}return!1}}function Pd(i,e){const r=Ic([],[i.x,i.y,0,1],e);return new Q(r[0]/r[3],r[1]/r[3])}class Md extends Vo{}let kd;Oe("HeatmapBucket",Md,{omit:["layers"]});var bg={get paint(){return kd=kd||new Bi({"heatmap-radius":new He(fe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new He(fe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new je(fe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Vs(fe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new je(fe.paint_heatmap["heatmap-opacity"])})}};function Fu(i,{width:e,height:r},a,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*r*a)throw new RangeError(`mismatched image size. expected: ${u.length} but got: ${e*r*a}`)}else u=new Uint8Array(e*r*a);return i.width=e,i.height=r,i.data=u,i}function Dd(i,{width:e,height:r},a){if(e===i.width&&r===i.height)return;const u=Fu({},{width:e,height:r},a);Ou(i,u,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,r)},a),i.width=e,i.height=r,i.data=u.data}function Ou(i,e,r,a,u,m){if(u.width===0||u.height===0)return e;if(u.width>i.width||u.height>i.height||r.x>i.width-u.width||r.y>i.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||a.x>e.width-u.width||a.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const g=i.data,_=e.data;if(g===_)throw new Error("srcData equals dstData, so image is already copied");for(let w=0;w<u.height;w++){const E=((r.y+w)*i.width+r.x)*m,C=((a.y+w)*e.width+a.x)*m;for(let P=0;P<u.width*m;P++)_[C+P]=g[E+P]}return e}class Ho{constructor(e,r){Fu(this,e,1,r)}resize(e){Dd(this,e,1)}clone(){return new Ho({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,a,u,m){Ou(e,r,a,u,m,1)}}class gr{constructor(e,r){Fu(this,e,4,r)}resize(e){Dd(this,e,4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new gr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,a,u,m){Ou(e,r,a,u,m,4)}}function Rd(i){const e={},r=i.resolution||256,a=i.clips?i.clips.length:1,u=i.image||new gr({width:r,height:a});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const m=(g,_,w)=>{e[i.evaluationKey]=w;const E=i.expression.evaluate(e);u.data[g+_+0]=Math.floor(255*E.r/E.a),u.data[g+_+1]=Math.floor(255*E.g/E.a),u.data[g+_+2]=Math.floor(255*E.b/E.a),u.data[g+_+3]=Math.floor(255*E.a)};if(i.clips)for(let g=0,_=0;g<a;++g,_+=4*r)for(let w=0,E=0;w<r;w++,E+=4){const C=w/(r-1),{start:P,end:R}=i.clips[g];m(_,E,P*(1-C)+R*C)}else for(let g=0,_=0;g<r;g++,_+=4)m(0,_,g/(r-1));return u}Oe("AlphaImage",Ho),Oe("RGBAImage",gr);class wg extends pr{createBucket(e){return new Md(e)}constructor(e){super(e,bg),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Rd({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let zd;var Sg={get paint(){return zd=zd||new Bi({"hillshade-illumination-direction":new je(fe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new je(fe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new je(fe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new je(fe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new je(fe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new je(fe.paint_hillshade["hillshade-accent-color"])})}};class Tg extends pr{constructor(e){super(e,Sg)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const Ag=Wt([{name:"a_pos",components:2,type:"Int16"}],4),{members:Eg}=Ag;var $u={exports:{}};function Cc(i,e,r){r=r||2;var a,u,m,g,_,w,E,C=e&&e.length,P=C?e[0]*r:i.length,R=Bd(i,0,P,r,!0),B=[];if(!R||R.next===R.prev)return B;if(C&&(R=function(V,Z,Y,le){var J,se,ge,xe=[];for(J=0,se=Z.length;J<se;J++)(ge=Bd(V,Z[J]*le,J<se-1?Z[J+1]*le:V.length,le,!1))===ge.next&&(ge.steiner=!0),xe.push(zg(ge));for(xe.sort(kg),J=0;J<xe.length;J++)Y=Dg(xe[J],Y);return Y}(i,e,R,r)),i.length>80*r){a=m=i[0],u=g=i[1];for(var F=r;F<P;F+=r)(_=i[F])<a&&(a=_),(w=i[F+1])<u&&(u=w),_>m&&(m=_),w>g&&(g=w);E=(E=Math.max(m-a,g-u))!==0?32767/E:0}return Zo(R,B,r,a,u,E,0),B}function Bd(i,e,r,a,u){var m,g;if(u===Vu(i,e,r,a)>0)for(m=e;m<r;m+=a)g=Od(m,i[m],i[m+1],g);else for(m=r-a;m>=e;m-=a)g=Od(m,i[m],i[m+1],g);return g&&Pc(g,g.next)&&(Ko(g),g=g.next),g}function Ws(i,e){if(!i)return i;e||(e=i);var r,a=i;do if(r=!1,a.steiner||!Pc(a,a.next)&&Kt(a.prev,a,a.next)!==0)a=a.next;else{if(Ko(a),(a=e=a.prev)===a.next)break;r=!0}while(r||a!==e);return e}function Zo(i,e,r,a,u,m,g){if(i){!g&&m&&function(C,P,R,B){var F=C;do F.z===0&&(F.z=Nu(F.x,F.y,P,R,B)),F.prevZ=F.prev,F.nextZ=F.next,F=F.next;while(F!==C);F.prevZ.nextZ=null,F.prevZ=null,function(V){var Z,Y,le,J,se,ge,xe,Be,Ne=1;do{for(Y=V,V=null,se=null,ge=0;Y;){for(ge++,le=Y,xe=0,Z=0;Z<Ne&&(xe++,le=le.nextZ);Z++);for(Be=Ne;xe>0||Be>0&&le;)xe!==0&&(Be===0||!le||Y.z<=le.z)?(J=Y,Y=Y.nextZ,xe--):(J=le,le=le.nextZ,Be--),se?se.nextZ=J:V=J,J.prevZ=se,se=J;Y=le}se.nextZ=null,Ne*=2}while(ge>1)}(F)}(i,a,u,m);for(var _,w,E=i;i.prev!==i.next;)if(_=i.prev,w=i.next,m?Cg(i,a,u,m):Ig(i))e.push(_.i/r|0),e.push(i.i/r|0),e.push(w.i/r|0),Ko(i),i=w.next,E=w.next;else if((i=w)===E){g?g===1?Zo(i=Pg(Ws(i),e,r),e,r,a,u,m,2):g===2&&Mg(i,e,r,a,u,m):Zo(Ws(i),e,r,a,u,m,1);break}}}function Ig(i){var e=i.prev,r=i,a=i.next;if(Kt(e,r,a)>=0)return!1;for(var u=e.x,m=r.x,g=a.x,_=e.y,w=r.y,E=a.y,C=u<m?u<g?u:g:m<g?m:g,P=_<w?_<E?_:E:w<E?w:E,R=u>m?u>g?u:g:m>g?m:g,B=_>w?_>E?_:E:w>E?w:E,F=a.next;F!==e;){if(F.x>=C&&F.x<=R&&F.y>=P&&F.y<=B&&Ra(u,_,m,w,g,E,F.x,F.y)&&Kt(F.prev,F,F.next)>=0)return!1;F=F.next}return!0}function Cg(i,e,r,a){var u=i.prev,m=i,g=i.next;if(Kt(u,m,g)>=0)return!1;for(var _=u.x,w=m.x,E=g.x,C=u.y,P=m.y,R=g.y,B=_<w?_<E?_:E:w<E?w:E,F=C<P?C<R?C:R:P<R?P:R,V=_>w?_>E?_:E:w>E?w:E,Z=C>P?C>R?C:R:P>R?P:R,Y=Nu(B,F,e,r,a),le=Nu(V,Z,e,r,a),J=i.prevZ,se=i.nextZ;J&&J.z>=Y&&se&&se.z<=le;){if(J.x>=B&&J.x<=V&&J.y>=F&&J.y<=Z&&J!==u&&J!==g&&Ra(_,C,w,P,E,R,J.x,J.y)&&Kt(J.prev,J,J.next)>=0||(J=J.prevZ,se.x>=B&&se.x<=V&&se.y>=F&&se.y<=Z&&se!==u&&se!==g&&Ra(_,C,w,P,E,R,se.x,se.y)&&Kt(se.prev,se,se.next)>=0))return!1;se=se.nextZ}for(;J&&J.z>=Y;){if(J.x>=B&&J.x<=V&&J.y>=F&&J.y<=Z&&J!==u&&J!==g&&Ra(_,C,w,P,E,R,J.x,J.y)&&Kt(J.prev,J,J.next)>=0)return!1;J=J.prevZ}for(;se&&se.z<=le;){if(se.x>=B&&se.x<=V&&se.y>=F&&se.y<=Z&&se!==u&&se!==g&&Ra(_,C,w,P,E,R,se.x,se.y)&&Kt(se.prev,se,se.next)>=0)return!1;se=se.nextZ}return!0}function Pg(i,e,r){var a=i;do{var u=a.prev,m=a.next.next;!Pc(u,m)&&Ld(u,a,a.next,m)&&Wo(u,m)&&Wo(m,u)&&(e.push(u.i/r|0),e.push(a.i/r|0),e.push(m.i/r|0),Ko(a),Ko(a.next),a=i=m),a=a.next}while(a!==i);return Ws(a)}function Mg(i,e,r,a,u,m){var g=i;do{for(var _=g.next.next;_!==g.prev;){if(g.i!==_.i&&Bg(g,_)){var w=Fd(g,_);return g=Ws(g,g.next),w=Ws(w,w.next),Zo(g,e,r,a,u,m,0),void Zo(w,e,r,a,u,m,0)}_=_.next}g=g.next}while(g!==i)}function kg(i,e){return i.x-e.x}function Dg(i,e){var r=function(u,m){var g,_=m,w=u.x,E=u.y,C=-1/0;do{if(E<=_.y&&E>=_.next.y&&_.next.y!==_.y){var P=_.x+(E-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(P<=w&&P>C&&(C=P,g=_.x<_.next.x?_:_.next,P===w))return g}_=_.next}while(_!==m);if(!g)return null;var R,B=g,F=g.x,V=g.y,Z=1/0;_=g;do w>=_.x&&_.x>=F&&w!==_.x&&Ra(E<V?w:C,E,F,V,E<V?C:w,E,_.x,_.y)&&(R=Math.abs(E-_.y)/(w-_.x),Wo(_,u)&&(R<Z||R===Z&&(_.x>g.x||_.x===g.x&&Rg(g,_)))&&(g=_,Z=R)),_=_.next;while(_!==B);return g}(i,e);if(!r)return e;var a=Fd(r,i);return Ws(a,a.next),Ws(r,r.next)}function Rg(i,e){return Kt(i.prev,i,e.prev)<0&&Kt(e.next,i,i.next)<0}function Nu(i,e,r,a,u){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-r)*u|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-a)*u|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function zg(i){var e=i,r=i;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==i);return r}function Ra(i,e,r,a,u,m,g,_){return(u-g)*(e-_)>=(i-g)*(m-_)&&(i-g)*(a-_)>=(r-g)*(e-_)&&(r-g)*(m-_)>=(u-g)*(a-_)}function Bg(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(r,a){var u=r;do{if(u.i!==r.i&&u.next.i!==r.i&&u.i!==a.i&&u.next.i!==a.i&&Ld(u,u.next,r,a))return!0;u=u.next}while(u!==r);return!1}(i,e)&&(Wo(i,e)&&Wo(e,i)&&function(r,a){var u=r,m=!1,g=(r.x+a.x)/2,_=(r.y+a.y)/2;do u.y>_!=u.next.y>_&&u.next.y!==u.y&&g<(u.next.x-u.x)*(_-u.y)/(u.next.y-u.y)+u.x&&(m=!m),u=u.next;while(u!==r);return m}(i,e)&&(Kt(i.prev,i,e.prev)||Kt(i,e.prev,e))||Pc(i,e)&&Kt(i.prev,i,i.next)>0&&Kt(e.prev,e,e.next)>0)}function Kt(i,e,r){return(e.y-i.y)*(r.x-e.x)-(e.x-i.x)*(r.y-e.y)}function Pc(i,e){return i.x===e.x&&i.y===e.y}function Ld(i,e,r,a){var u=kc(Kt(i,e,r)),m=kc(Kt(i,e,a)),g=kc(Kt(r,a,i)),_=kc(Kt(r,a,e));return u!==m&&g!==_||!(u!==0||!Mc(i,r,e))||!(m!==0||!Mc(i,a,e))||!(g!==0||!Mc(r,i,a))||!(_!==0||!Mc(r,e,a))}function Mc(i,e,r){return e.x<=Math.max(i.x,r.x)&&e.x>=Math.min(i.x,r.x)&&e.y<=Math.max(i.y,r.y)&&e.y>=Math.min(i.y,r.y)}function kc(i){return i>0?1:i<0?-1:0}function Wo(i,e){return Kt(i.prev,i,i.next)<0?Kt(i,e,i.next)>=0&&Kt(i,i.prev,e)>=0:Kt(i,e,i.prev)<0||Kt(i,i.next,e)<0}function Fd(i,e){var r=new Uu(i.i,i.x,i.y),a=new Uu(e.i,e.x,e.y),u=i.next,m=e.prev;return i.next=e,e.prev=i,r.next=u,u.prev=r,a.next=r,r.prev=a,m.next=a,a.prev=m,a}function Od(i,e,r,a){var u=new Uu(i,e,r);return a?(u.next=a.next,u.prev=a,a.next.prev=u,a.next=u):(u.prev=u,u.next=u),u}function Ko(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Uu(i,e,r){this.i=i,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Vu(i,e,r,a){for(var u=0,m=e,g=r-a;m<r;m+=a)u+=(i[g]-i[m])*(i[m+1]+i[g+1]),g=m;return u}$u.exports=Cc,$u.exports.default=Cc,Cc.deviation=function(i,e,r,a){var u=e&&e.length,m=Math.abs(Vu(i,0,u?e[0]*r:i.length,r));if(u)for(var g=0,_=e.length;g<_;g++)m-=Math.abs(Vu(i,e[g]*r,g<_-1?e[g+1]*r:i.length,r));var w=0;for(g=0;g<a.length;g+=3){var E=a[g]*r,C=a[g+1]*r,P=a[g+2]*r;w+=Math.abs((i[E]-i[P])*(i[C+1]-i[E+1])-(i[E]-i[C])*(i[P+1]-i[E+1]))}return m===0&&w===0?0:Math.abs((w-m)/m)},Cc.flatten=function(i){for(var e=i[0][0].length,r={vertices:[],holes:[],dimensions:e},a=0,u=0;u<i.length;u++){for(var m=0;m<i[u].length;m++)for(var g=0;g<e;g++)r.vertices.push(i[u][m][g]);u>0&&r.holes.push(a+=i[u-1].length)}return r};var $d=K($u.exports);function Lg(i,e,r,a,u){Nd(i,e,r||0,a||i.length-1,u||Fg)}function Nd(i,e,r,a,u){for(;a>r;){if(a-r>600){var m=a-r+1,g=e-r+1,_=Math.log(m),w=.5*Math.exp(2*_/3),E=.5*Math.sqrt(_*w*(m-w)/m)*(g-m/2<0?-1:1);Nd(i,e,Math.max(r,Math.floor(e-g*w/m+E)),Math.min(a,Math.floor(e+(m-g)*w/m+E)),u)}var C=i[e],P=r,R=a;for(Xo(i,r,e),u(i[a],C)>0&&Xo(i,r,a);P<R;){for(Xo(i,P,R),P++,R--;u(i[P],C)<0;)P++;for(;u(i[R],C)>0;)R--}u(i[r],C)===0?Xo(i,r,R):Xo(i,++R,a),R<=e&&(r=R+1),e<=R&&(a=R-1)}}function Xo(i,e,r){var a=i[e];i[e]=i[r],i[r]=a}function Fg(i,e){return i<e?-1:i>e?1:0}function ju(i,e){const r=i.length;if(r<=1)return[i];const a=[];let u,m;for(let g=0;g<r;g++){const _=pn(i[g]);_!==0&&(i[g].area=Math.abs(_),m===void 0&&(m=_<0),m===_<0?(u&&a.push(u),u=[i[g]]):u.push(i[g]))}if(u&&a.push(u),e>1)for(let g=0;g<a.length;g++)a[g].length<=e||(Lg(a[g],e,1,a[g].length-1,Og),a[g]=a[g].slice(0,e));return a}function Og(i,e){return e.area-i.area}function qu(i,e,r){const a=r.patternDependencies;let u=!1;for(const m of e){const g=m.paint.get(`${i}-pattern`);g.isConstant()||(u=!0);const _=g.constantOr(null);_&&(u=!0,a[_.to]=!0,a[_.from]=!0)}return u}function Gu(i,e,r,a,u){const m=u.patternDependencies;for(const g of e){const _=g.paint.get(`${i}-pattern`).value;if(_.kind!=="constant"){let w=_.evaluate({zoom:a-1},r,{},u.availableImages),E=_.evaluate({zoom:a},r,{},u.availableImages),C=_.evaluate({zoom:a+1},r,{},u.availableImages);w=w&&w.name?w.name:w,E=E&&E.name?E.name:E,C=C&&C.name?C.name:C,m[w]=!0,m[E]=!0,m[C]=!0,r.patterns[g.id]={min:w,mid:E,max:C}}}return r}class Hu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new L,this.indexArray=new de,this.indexArray2=new pe,this.programConfigurations=new Dt(e.layers,e.zoom),this.segments=new we,this.segments2=new we,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,a){this.hasPattern=qu("fill",this.layers,r);const u=this.layers[0].layout.get("fill-sort-key"),m=!u.isConstant(),g=[];for(const{feature:_,id:w,index:E,sourceLayerIndex:C}of e){const P=this.layers[0]._featureFilter.needGeometry,R=Rn(_,P);if(!this.layers[0]._featureFilter.filter(new Pt(this.zoom),R,a))continue;const B=m?u.evaluate(R,{},a,r.availableImages):void 0,F={id:w,properties:_.properties,type:_.type,sourceLayerIndex:C,index:E,geometry:P?R.geometry:Dn(_),patterns:{},sortKey:B};g.push(F)}m&&g.sort((_,w)=>_.sortKey-w.sortKey);for(const _ of g){const{geometry:w,index:E,sourceLayerIndex:C}=_;if(this.hasPattern){const P=Gu("fill",this.layers,_,this.zoom,r);this.patternFeatures.push(P)}else this.addFeature(_,w,E,a,{});r.featureIndex.insert(e[E].feature,w,E,C,this.index)}}update(e,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a)}addFeatures(e,r,a){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,r,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Eg),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,a,u,m){for(const g of ju(r,500)){let _=0;for(const B of g)_+=B.length;const w=this.segments.prepareSegment(_,this.layoutVertexArray,this.indexArray),E=w.vertexLength,C=[],P=[];for(const B of g){if(B.length===0)continue;B!==g[0]&&P.push(C.length/2);const F=this.segments2.prepareSegment(B.length,this.layoutVertexArray,this.indexArray2),V=F.vertexLength;this.layoutVertexArray.emplaceBack(B[0].x,B[0].y),this.indexArray2.emplaceBack(V+B.length-1,V),C.push(B[0].x),C.push(B[0].y);for(let Z=1;Z<B.length;Z++)this.layoutVertexArray.emplaceBack(B[Z].x,B[Z].y),this.indexArray2.emplaceBack(V+Z-1,V+Z),C.push(B[Z].x),C.push(B[Z].y);F.vertexLength+=B.length,F.primitiveLength+=B.length}const R=$d(C,P);for(let B=0;B<R.length;B+=3)this.indexArray.emplaceBack(E+R[B],E+R[B+1],E+R[B+2]);w.vertexLength+=_,w.primitiveLength+=R.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,m,u)}}let Ud,Vd;Oe("FillBucket",Hu,{omit:["layers","patternFeatures"]});var $g={get paint(){return Vd=Vd||new Bi({"fill-antialias":new je(fe.paint_fill["fill-antialias"]),"fill-opacity":new He(fe.paint_fill["fill-opacity"]),"fill-color":new He(fe.paint_fill["fill-color"]),"fill-outline-color":new He(fe.paint_fill["fill-outline-color"]),"fill-translate":new je(fe.paint_fill["fill-translate"]),"fill-translate-anchor":new je(fe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Cn(fe.paint_fill["fill-pattern"])})},get layout(){return Ud=Ud||new Bi({"fill-sort-key":new He(fe.layout_fill["fill-sort-key"])})}};class Ng extends pr{constructor(e){super(e,$g)}recalculate(e,r){super.recalculate(e,r);const a=this.paint._values["fill-outline-color"];a.value.kind==="constant"&&a.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new Hu(e)}queryRadius(){return Ac(this.paint.get("fill-translate"))}queryIntersectsFeature(e,r,a,u,m,g,_){return jo(Ec(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),g.angle,_),u)}isTileClipped(){return!0}}const Ug=Wt([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Vg=Wt([{name:"a_centroid",components:2,type:"Int16"}],4),{members:jg}=Ug;var ds={},qg=O,jd=za;function za(i,e,r,a,u){this.properties={},this.extent=r,this.type=0,this._pbf=i,this._geometry=-1,this._keys=a,this._values=u,i.readFields(Gg,this,e)}function Gg(i,e,r){i==1?e.id=r.readVarint():i==2?function(a,u){for(var m=a.readVarint()+a.pos;a.pos<m;){var g=u._keys[a.readVarint()],_=u._values[a.readVarint()];u.properties[g]=_}}(r,e):i==3?e.type=r.readVarint():i==4&&(e._geometry=r.pos)}function Hg(i){for(var e,r,a=0,u=0,m=i.length,g=m-1;u<m;g=u++)a+=((r=i[g]).x-(e=i[u]).x)*(e.y+r.y);return a}za.types=["Unknown","Point","LineString","Polygon"],za.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,r=i.readVarint()+i.pos,a=1,u=0,m=0,g=0,_=[];i.pos<r;){if(u<=0){var w=i.readVarint();a=7&w,u=w>>3}if(u--,a===1||a===2)m+=i.readSVarint(),g+=i.readSVarint(),a===1&&(e&&_.push(e),e=[]),e.push(new qg(m,g));else{if(a!==7)throw new Error("unknown command "+a);e&&e.push(e[0].clone())}}return e&&_.push(e),_},za.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,r=1,a=0,u=0,m=0,g=1/0,_=-1/0,w=1/0,E=-1/0;i.pos<e;){if(a<=0){var C=i.readVarint();r=7&C,a=C>>3}if(a--,r===1||r===2)(u+=i.readSVarint())<g&&(g=u),u>_&&(_=u),(m+=i.readSVarint())<w&&(w=m),m>E&&(E=m);else if(r!==7)throw new Error("unknown command "+r)}return[g,w,_,E]},za.prototype.toGeoJSON=function(i,e,r){var a,u,m=this.extent*Math.pow(2,r),g=this.extent*i,_=this.extent*e,w=this.loadGeometry(),E=za.types[this.type];function C(B){for(var F=0;F<B.length;F++){var V=B[F];B[F]=[360*(V.x+g)/m-180,360/Math.PI*Math.atan(Math.exp((180-360*(V.y+_)/m)*Math.PI/180))-90]}}switch(this.type){case 1:var P=[];for(a=0;a<w.length;a++)P[a]=w[a][0];C(w=P);break;case 2:for(a=0;a<w.length;a++)C(w[a]);break;case 3:for(w=function(B){var F=B.length;if(F<=1)return[B];for(var V,Z,Y=[],le=0;le<F;le++){var J=Hg(B[le]);J!==0&&(Z===void 0&&(Z=J<0),Z===J<0?(V&&Y.push(V),V=[B[le]]):V.push(B[le]))}return V&&Y.push(V),Y}(w),a=0;a<w.length;a++)for(u=0;u<w[a].length;u++)C(w[a][u])}w.length===1?w=w[0]:E="Multi"+E;var R={type:"Feature",geometry:{type:E,coordinates:w},properties:this.properties};return"id"in this&&(R.id=this.id),R};var Zg=jd,qd=Gd;function Gd(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(Wg,this,e),this.length=this._features.length}function Wg(i,e,r){i===15?e.version=r.readVarint():i===1?e.name=r.readString():i===5?e.extent=r.readVarint():i===2?e._features.push(r.pos):i===3?e._keys.push(r.readString()):i===4&&e._values.push(function(a){for(var u=null,m=a.readVarint()+a.pos;a.pos<m;){var g=a.readVarint()>>3;u=g===1?a.readString():g===2?a.readFloat():g===3?a.readDouble():g===4?a.readVarint64():g===5?a.readVarint():g===6?a.readSVarint():g===7?a.readBoolean():null}return u}(r))}Gd.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new Zg(this._pbf,e,this.extent,this._keys,this._values)};var Kg=qd;function Xg(i,e,r){if(i===3){var a=new Kg(r,r.readVarint()+r.pos);a.length&&(e[a.name]=a)}}ds.VectorTile=function(i,e){this.layers=i.readFields(Xg,{},e)},ds.VectorTileFeature=jd,ds.VectorTileLayer=qd;const Yg=ds.VectorTileFeature.types,Zu=Math.pow(2,13);function Yo(i,e,r,a,u,m,g,_){i.emplaceBack(e,r,2*Math.floor(a*Zu)+g,u*Zu*2,m*Zu*2,Math.round(_))}class Wu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new H,this.centroidVertexArray=new M,this.indexArray=new de,this.programConfigurations=new Dt(e.layers,e.zoom),this.segments=new we,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,a){this.features=[],this.hasPattern=qu("fill-extrusion",this.layers,r);for(const{feature:u,id:m,index:g,sourceLayerIndex:_}of e){const w=this.layers[0]._featureFilter.needGeometry,E=Rn(u,w);if(!this.layers[0]._featureFilter.filter(new Pt(this.zoom),E,a))continue;const C={id:m,sourceLayerIndex:_,index:g,geometry:w?E.geometry:Dn(u),properties:u.properties,type:u.type,patterns:{}};this.hasPattern?this.features.push(Gu("fill-extrusion",this.layers,C,this.zoom,r)):this.addFeature(C,C.geometry,g,a,{}),r.featureIndex.insert(u,C.geometry,g,_,this.index,!0)}}addFeatures(e,r,a){for(const u of this.features){const{geometry:m}=u;this.addFeature(u,m,u.index,r,a)}}update(e,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,jg),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Vg.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,r,a,u,m){const g={x:0,y:0,vertexCount:0};for(const _ of ju(r,500)){let w=0;for(const F of _)w+=F.length;let E=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const F of _){if(F.length===0||Qg(F))continue;let V=0;for(let Z=0;Z<F.length;Z++){const Y=F[Z];if(Z>=1){const le=F[Z-1];if(!Jg(Y,le)){E.vertexLength+4>we.MAX_VERTEX_ARRAY_LENGTH&&(E=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const J=Y.sub(le)._perp()._unit(),se=le.dist(Y);V+se>32768&&(V=0),Yo(this.layoutVertexArray,Y.x,Y.y,J.x,J.y,0,0,V),Yo(this.layoutVertexArray,Y.x,Y.y,J.x,J.y,0,1,V),g.x+=2*Y.x,g.y+=2*Y.y,g.vertexCount+=2,V+=se,Yo(this.layoutVertexArray,le.x,le.y,J.x,J.y,0,0,V),Yo(this.layoutVertexArray,le.x,le.y,J.x,J.y,0,1,V),g.x+=2*le.x,g.y+=2*le.y,g.vertexCount+=2;const ge=E.vertexLength;this.indexArray.emplaceBack(ge,ge+2,ge+1),this.indexArray.emplaceBack(ge+1,ge+2,ge+3),E.vertexLength+=4,E.primitiveLength+=2}}}}if(E.vertexLength+w>we.MAX_VERTEX_ARRAY_LENGTH&&(E=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray)),Yg[e.type]!=="Polygon")continue;const C=[],P=[],R=E.vertexLength;for(const F of _)if(F.length!==0){F!==_[0]&&P.push(C.length/2);for(let V=0;V<F.length;V++){const Z=F[V];Yo(this.layoutVertexArray,Z.x,Z.y,0,0,1,1,0),g.x+=Z.x,g.y+=Z.y,g.vertexCount+=1,C.push(Z.x),C.push(Z.y)}}const B=$d(C,P);for(let F=0;F<B.length;F+=3)this.indexArray.emplaceBack(R+B[F],R+B[F+2],R+B[F+1]);E.primitiveLength+=B.length/3,E.vertexLength+=w}for(let _=0;_<g.vertexCount;_++)this.centroidVertexArray.emplaceBack(Math.floor(g.x/g.vertexCount),Math.floor(g.y/g.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,m,u)}}function Jg(i,e){return i.x===e.x&&(i.x<0||i.x>lt)||i.y===e.y&&(i.y<0||i.y>lt)}function Qg(i){return i.every(e=>e.x<0)||i.every(e=>e.x>lt)||i.every(e=>e.y<0)||i.every(e=>e.y>lt)}let Hd;Oe("FillExtrusionBucket",Wu,{omit:["layers","features"]});var ey={get paint(){return Hd=Hd||new Bi({"fill-extrusion-opacity":new je(fe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new He(fe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new je(fe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new je(fe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Cn(fe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new He(fe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new He(fe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new je(fe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class ty extends pr{constructor(e){super(e,ey)}createBucket(e){return new Wu(e)}queryRadius(){return Ac(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(e,r,a,u,m,g,_,w){const E=Ec(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),g.angle,_),C=this.paint.get("fill-extrusion-height").evaluate(r,a),P=this.paint.get("fill-extrusion-base").evaluate(r,a),R=function(F,V,Z,Y){const le=[];for(const J of F){const se=[J.x,J.y,0,1];Ic(se,se,V),le.push(new Q(se[0]/se[3],se[1]/se[3]))}return le}(E,w),B=function(F,V,Z,Y){const le=[],J=[],se=Y[8]*V,ge=Y[9]*V,xe=Y[10]*V,Be=Y[11]*V,Ne=Y[8]*Z,ze=Y[9]*Z,Re=Y[10]*Z,Ce=Y[11]*Z;for(const $e of F){const De=[],Ee=[];for(const Ge of $e){const Ve=Ge.x,ot=Ge.y,kt=Y[0]*Ve+Y[4]*ot+Y[12],Rt=Y[1]*Ve+Y[5]*ot+Y[13],ti=Y[2]*Ve+Y[6]*ot+Y[14],or=Y[3]*Ve+Y[7]*ot+Y[15],Oi=ti+xe,Jt=or+Be,di=kt+Ne,vi=Rt+ze,$i=ti+Re,Ni=or+Ce,ii=new Q((kt+se)/Jt,(Rt+ge)/Jt);ii.z=Oi/Jt,De.push(ii);const ri=new Q(di/Ni,vi/Ni);ri.z=$i/Ni,Ee.push(ri)}le.push(De),J.push(Ee)}return[le,J]}(u,P,C,w);return function(F,V,Z){let Y=1/0;jo(Z,V)&&(Y=Zd(Z,V[0]));for(let le=0;le<V.length;le++){const J=V[le],se=F[le];for(let ge=0;ge<J.length-1;ge++){const xe=J[ge],Be=[xe,J[ge+1],se[ge+1],se[ge],xe];zn(Z,Be)&&(Y=Math.min(Y,Zd(Z,Be)))}}return Y!==1/0&&Y}(B[0],B[1],R)}}function Jo(i,e){return i.x*e.x+i.y*e.y}function Zd(i,e){if(i.length===1){let r=0;const a=e[r++];let u;for(;!u||a.equals(u);)if(u=e[r++],!u)return 1/0;for(;r<e.length;r++){const m=e[r],g=i[0],_=u.sub(a),w=m.sub(a),E=g.sub(a),C=Jo(_,_),P=Jo(_,w),R=Jo(w,w),B=Jo(E,_),F=Jo(E,w),V=C*R-P*P,Z=(R*B-P*F)/V,Y=(C*F-P*B)/V,le=a.z*(1-Z-Y)+u.z*Z+m.z*Y;if(isFinite(le))return le}return 1/0}{let r=1/0;for(const a of e)r=Math.min(r,a.z);return r}}const iy=Wt([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:ry}=iy,ny=Wt([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:sy}=ny,ay=ds.VectorTileFeature.types,oy=Math.cos(Math.PI/180*37.5),Wd=Math.pow(2,14)/.5;class Ku{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new q,this.layoutVertexArray2=new W,this.indexArray=new de,this.programConfigurations=new Dt(e.layers,e.zoom),this.segments=new we,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,a){this.hasPattern=qu("line",this.layers,r);const u=this.layers[0].layout.get("line-sort-key"),m=!u.isConstant(),g=[];for(const{feature:_,id:w,index:E,sourceLayerIndex:C}of e){const P=this.layers[0]._featureFilter.needGeometry,R=Rn(_,P);if(!this.layers[0]._featureFilter.filter(new Pt(this.zoom),R,a))continue;const B=m?u.evaluate(R,{},a):void 0,F={id:w,properties:_.properties,type:_.type,sourceLayerIndex:C,index:E,geometry:P?R.geometry:Dn(_),patterns:{},sortKey:B};g.push(F)}m&&g.sort((_,w)=>_.sortKey-w.sortKey);for(const _ of g){const{geometry:w,index:E,sourceLayerIndex:C}=_;if(this.hasPattern){const P=Gu("line",this.layers,_,this.zoom,r);this.patternFeatures.push(P)}else this.addFeature(_,w,E,a,{});r.featureIndex.insert(e[E].feature,w,E,C,this.index)}}update(e,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a)}addFeatures(e,r,a){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,r,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,sy)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ry),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,a,u,m){const g=this.layers[0].layout,_=g.get("line-join").evaluate(e,{}),w=g.get("line-cap"),E=g.get("line-miter-limit"),C=g.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const P of r)this.addLine(P,e,_,w,E,C);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,m,u)}addLine(e,r,a,u,m,g){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Y=0;Y<e.length-1;Y++)this.totalDistance+=e[Y].dist(e[Y+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const _=ay[r.type]==="Polygon";let w=e.length;for(;w>=2&&e[w-1].equals(e[w-2]);)w--;let E=0;for(;E<w-1&&e[E].equals(e[E+1]);)E++;if(w<(_?3:2))return;a==="bevel"&&(m=1.05);const C=this.overscaling<=16?15*lt/(512*this.overscaling):0,P=this.segments.prepareSegment(10*w,this.layoutVertexArray,this.indexArray);let R,B,F,V,Z;this.e1=this.e2=-1,_&&(R=e[w-2],Z=e[E].sub(R)._unit()._perp());for(let Y=E;Y<w;Y++){if(F=Y===w-1?_?e[E+1]:void 0:e[Y+1],F&&e[Y].equals(F))continue;Z&&(V=Z),R&&(B=R),R=e[Y],Z=F?F.sub(R)._unit()._perp():V,V=V||Z;let le=V.add(Z);le.x===0&&le.y===0||le._unit();const J=V.x*Z.x+V.y*Z.y,se=le.x*Z.x+le.y*Z.y,ge=se!==0?1/se:1/0,xe=2*Math.sqrt(2-2*se),Be=se<oy&&B&&F,Ne=V.x*Z.y-V.y*Z.x>0;if(Be&&Y>E){const Ce=R.dist(B);if(Ce>2*C){const $e=R.sub(R.sub(B)._mult(C/Ce)._round());this.updateDistance(B,$e),this.addCurrentVertex($e,V,0,0,P),B=$e}}const ze=B&&F;let Re=ze?a:_?"butt":u;if(ze&&Re==="round"&&(ge<g?Re="miter":ge<=2&&(Re="fakeround")),Re==="miter"&&ge>m&&(Re="bevel"),Re==="bevel"&&(ge>2&&(Re="flipbevel"),ge<m&&(Re="miter")),B&&this.updateDistance(B,R),Re==="miter")le._mult(ge),this.addCurrentVertex(R,le,0,0,P);else if(Re==="flipbevel"){if(ge>100)le=Z.mult(-1);else{const Ce=ge*V.add(Z).mag()/V.sub(Z).mag();le._perp()._mult(Ce*(Ne?-1:1))}this.addCurrentVertex(R,le,0,0,P),this.addCurrentVertex(R,le.mult(-1),0,0,P)}else if(Re==="bevel"||Re==="fakeround"){const Ce=-Math.sqrt(ge*ge-1),$e=Ne?Ce:0,De=Ne?0:Ce;if(B&&this.addCurrentVertex(R,V,$e,De,P),Re==="fakeround"){const Ee=Math.round(180*xe/Math.PI/20);for(let Ge=1;Ge<Ee;Ge++){let Ve=Ge/Ee;if(Ve!==.5){const kt=Ve-.5;Ve+=Ve*kt*(Ve-1)*((1.0904+J*(J*(3.55645-1.43519*J)-3.2452))*kt*kt+(.848013+J*(.215638*J-1.06021)))}const ot=Z.sub(V)._mult(Ve)._add(V)._unit()._mult(Ne?-1:1);this.addHalfVertex(R,ot.x,ot.y,!1,Ne,0,P)}}F&&this.addCurrentVertex(R,Z,-$e,-De,P)}else if(Re==="butt")this.addCurrentVertex(R,le,0,0,P);else if(Re==="square"){const Ce=B?1:-1;this.addCurrentVertex(R,le,Ce,Ce,P)}else Re==="round"&&(B&&(this.addCurrentVertex(R,V,0,0,P),this.addCurrentVertex(R,V,1,1,P,!0)),F&&(this.addCurrentVertex(R,Z,-1,-1,P,!0),this.addCurrentVertex(R,Z,0,0,P)));if(Be&&Y<w-1){const Ce=R.dist(F);if(Ce>2*C){const $e=R.add(F.sub(R)._mult(C/Ce)._round());this.updateDistance(R,$e),this.addCurrentVertex($e,Z,0,0,P),R=$e}}}}addCurrentVertex(e,r,a,u,m,g=!1){const _=r.y*u-r.x,w=-r.y-r.x*u;this.addHalfVertex(e,r.x+r.y*a,r.y-r.x*a,g,!1,a,m),this.addHalfVertex(e,_,w,g,!0,-u,m),this.distance>Wd/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,r,a,u,m,g))}addHalfVertex({x:e,y:r},a,u,m,g,_,w){const E=.5*(this.lineClips?this.scaledDistance*(Wd-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(m?1:0),(r<<1)+(g?1:0),Math.round(63*a)+128,Math.round(63*u)+128,1+(_===0?0:_<0?-1:1)|(63&E)<<2,E>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const C=w.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,C),w.primitiveLength++),g?this.e2=C:this.e1=C}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}let Kd,Xd;Oe("LineBucket",Ku,{omit:["layers","patternFeatures"]});var Yd={get paint(){return Xd=Xd||new Bi({"line-opacity":new He(fe.paint_line["line-opacity"]),"line-color":new He(fe.paint_line["line-color"]),"line-translate":new je(fe.paint_line["line-translate"]),"line-translate-anchor":new je(fe.paint_line["line-translate-anchor"]),"line-width":new He(fe.paint_line["line-width"]),"line-gap-width":new He(fe.paint_line["line-gap-width"]),"line-offset":new He(fe.paint_line["line-offset"]),"line-blur":new He(fe.paint_line["line-blur"]),"line-dasharray":new Mo(fe.paint_line["line-dasharray"]),"line-pattern":new Cn(fe.paint_line["line-pattern"]),"line-gradient":new Vs(fe.paint_line["line-gradient"])})},get layout(){return Kd=Kd||new Bi({"line-cap":new je(fe.layout_line["line-cap"]),"line-join":new He(fe.layout_line["line-join"]),"line-miter-limit":new je(fe.layout_line["line-miter-limit"]),"line-round-limit":new je(fe.layout_line["line-round-limit"]),"line-sort-key":new He(fe.layout_line["line-sort-key"])})}};class ly extends He{possiblyEvaluate(e,r){return r=new Pt(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(e,r)}evaluate(e,r,a,u){return r=fi({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(e,r,a,u)}}let Dc;class cy extends pr{constructor(e){super(e,Yd),this.gradientVersion=0,Dc||(Dc=new ly(Yd.paint.properties["line-width"].specification),Dc.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const r=this.gradientExpression();this.stepInterpolant=!!function(a){return a._styleExpression!==void 0}(r)&&r._styleExpression.expression instanceof Zn,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,r){super.recalculate(e,r),this.paint._values["line-floorwidth"]=Dc.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new Ku(e)}queryRadius(e){const r=e,a=Jd(qo("line-width",this,r),qo("line-gap-width",this,r)),u=qo("line-offset",this,r);return a/2+Math.abs(u)+Ac(this.paint.get("line-translate"))}queryIntersectsFeature(e,r,a,u,m,g,_){const w=Ec(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),g.angle,_),E=_/2*Jd(this.paint.get("line-width").evaluate(r,a),this.paint.get("line-gap-width").evaluate(r,a)),C=this.paint.get("line-offset").evaluate(r,a);return C&&(u=function(P,R){const B=[];for(let F=0;F<P.length;F++){const V=P[F],Z=[];for(let Y=0;Y<V.length;Y++){const le=V[Y-1],J=V[Y],se=V[Y+1],ge=Y===0?new Q(0,0):J.sub(le)._unit()._perp(),xe=Y===V.length-1?new Q(0,0):se.sub(J)._unit()._perp(),Be=ge._add(xe)._unit(),Ne=Be.x*xe.x+Be.y*xe.y;Ne!==0&&Be._mult(1/Ne),Z.push(Be._mult(R)._add(J))}B.push(Z)}return B}(u,C*_)),function(P,R,B){for(let F=0;F<R.length;F++){const V=R[F];if(P.length>=3){for(let Z=0;Z<V.length;Z++)if(ka(P,V[Z]))return!0}if(Sc(P,V,B))return!0}return!1}(w,u,E)}isTileClipped(){return!0}}function Jd(i,e){return e>0?e+2*i:i}const uy=Wt([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),hy=Wt([{name:"a_projected_pos",components:3,type:"Float32"}],4);Wt([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const dy=Wt([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Wt([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Qd=Wt([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),py=Wt([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function fy(i,e,r){return i.sections.forEach(a=>{a.text=function(u,m,g){const _=m.layout.get("text-transform").evaluate(g,{});return _==="uppercase"?u=u.toLocaleUpperCase():_==="lowercase"&&(u=u.toLocaleLowerCase()),In.applyArabicShaping&&(u=In.applyArabicShaping(u)),u}(a.text,e,r)}),i}Wt([{name:"triangle",components:3,type:"Uint16"}]),Wt([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Wt([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Wt([{type:"Float32",name:"offsetX"}]),Wt([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Wt([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Qo={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var ei=24,ep=bt,tp=function(i,e,r,a,u){var m,g,_=8*u-a-1,w=(1<<_)-1,E=w>>1,C=-7,P=r?u-1:0,R=r?-1:1,B=i[e+P];for(P+=R,m=B&(1<<-C)-1,B>>=-C,C+=_;C>0;m=256*m+i[e+P],P+=R,C-=8);for(g=m&(1<<-C)-1,m>>=-C,C+=a;C>0;g=256*g+i[e+P],P+=R,C-=8);if(m===0)m=1-E;else{if(m===w)return g?NaN:1/0*(B?-1:1);g+=Math.pow(2,a),m-=E}return(B?-1:1)*g*Math.pow(2,m-a)},ip=function(i,e,r,a,u,m){var g,_,w,E=8*m-u-1,C=(1<<E)-1,P=C>>1,R=u===23?Math.pow(2,-24)-Math.pow(2,-77):0,B=a?0:m-1,F=a?1:-1,V=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(_=isNaN(e)?1:0,g=C):(g=Math.floor(Math.log(e)/Math.LN2),e*(w=Math.pow(2,-g))<1&&(g--,w*=2),(e+=g+P>=1?R/w:R*Math.pow(2,1-P))*w>=2&&(g++,w/=2),g+P>=C?(_=0,g=C):g+P>=1?(_=(e*w-1)*Math.pow(2,u),g+=P):(_=e*Math.pow(2,P-1)*Math.pow(2,u),g=0));u>=8;i[r+B]=255&_,B+=F,_/=256,u-=8);for(g=g<<u|_,E+=u;E>0;i[r+B]=255&g,B+=F,g/=256,E-=8);i[r+B-F]|=128*V};function bt(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}bt.Varint=0,bt.Fixed64=1,bt.Bytes=2,bt.Fixed32=5;var Xu=4294967296,rp=1/Xu,np=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Bn(i){return i.type===bt.Bytes?i.readVarint()+i.pos:i.pos+1}function Ba(i,e,r){return r?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function sp(i,e,r){var a=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(a);for(var u=r.pos-1;u>=i;u--)r.buf[u+a]=r.buf[u]}function my(i,e){for(var r=0;r<i.length;r++)e.writeVarint(i[r])}function gy(i,e){for(var r=0;r<i.length;r++)e.writeSVarint(i[r])}function yy(i,e){for(var r=0;r<i.length;r++)e.writeFloat(i[r])}function _y(i,e){for(var r=0;r<i.length;r++)e.writeDouble(i[r])}function xy(i,e){for(var r=0;r<i.length;r++)e.writeBoolean(i[r])}function vy(i,e){for(var r=0;r<i.length;r++)e.writeFixed32(i[r])}function by(i,e){for(var r=0;r<i.length;r++)e.writeSFixed32(i[r])}function wy(i,e){for(var r=0;r<i.length;r++)e.writeFixed64(i[r])}function Sy(i,e){for(var r=0;r<i.length;r++)e.writeSFixed64(i[r])}function Rc(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function La(i,e,r){i[r]=e,i[r+1]=e>>>8,i[r+2]=e>>>16,i[r+3]=e>>>24}function ap(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}bt.prototype={destroy:function(){this.buf=null},readFields:function(i,e,r){for(r=r||this.length;this.pos<r;){var a=this.readVarint(),u=a>>3,m=this.pos;this.type=7&a,i(u,e,this),this.pos===m&&this.skip(a)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=Rc(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=ap(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=Rc(this.buf,this.pos)+Rc(this.buf,this.pos+4)*Xu;return this.pos+=8,i},readSFixed64:function(){var i=Rc(this.buf,this.pos)+ap(this.buf,this.pos+4)*Xu;return this.pos+=8,i},readFloat:function(){var i=tp(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=tp(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,r,a=this.buf;return e=127&(r=a[this.pos++]),r<128?e:(e|=(127&(r=a[this.pos++]))<<7,r<128?e:(e|=(127&(r=a[this.pos++]))<<14,r<128?e:(e|=(127&(r=a[this.pos++]))<<21,r<128?e:function(u,m,g){var _,w,E=g.buf;if(_=(112&(w=E[g.pos++]))>>4,w<128||(_|=(127&(w=E[g.pos++]))<<3,w<128)||(_|=(127&(w=E[g.pos++]))<<10,w<128)||(_|=(127&(w=E[g.pos++]))<<17,w<128)||(_|=(127&(w=E[g.pos++]))<<24,w<128)||(_|=(1&(w=E[g.pos++]))<<31,w<128))return Ba(u,_,m);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=a[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&np?function(r,a,u){return np.decode(r.subarray(a,u))}(this.buf,e,i):function(r,a,u){for(var m="",g=a;g<u;){var _,w,E,C=r[g],P=null,R=C>239?4:C>223?3:C>191?2:1;if(g+R>u)break;R===1?C<128&&(P=C):R===2?(192&(_=r[g+1]))==128&&(P=(31&C)<<6|63&_)<=127&&(P=null):R===3?(w=r[g+2],(192&(_=r[g+1]))==128&&(192&w)==128&&((P=(15&C)<<12|(63&_)<<6|63&w)<=2047||P>=55296&&P<=57343)&&(P=null)):R===4&&(w=r[g+2],E=r[g+3],(192&(_=r[g+1]))==128&&(192&w)==128&&(192&E)==128&&((P=(15&C)<<18|(63&_)<<12|(63&w)<<6|63&E)<=65535||P>=1114112)&&(P=null)),P===null?(P=65533,R=1):P>65535&&(P-=65536,m+=String.fromCharCode(P>>>10&1023|55296),P=56320|1023&P),m+=String.fromCharCode(P),g+=R}return m}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==bt.Bytes)return i.push(this.readVarint(e));var r=Bn(this);for(i=i||[];this.pos<r;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==bt.Bytes)return i.push(this.readSVarint());var e=Bn(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==bt.Bytes)return i.push(this.readBoolean());var e=Bn(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==bt.Bytes)return i.push(this.readFloat());var e=Bn(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==bt.Bytes)return i.push(this.readDouble());var e=Bn(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==bt.Bytes)return i.push(this.readFixed32());var e=Bn(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==bt.Bytes)return i.push(this.readSFixed32());var e=Bn(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==bt.Bytes)return i.push(this.readFixed64());var e=Bn(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==bt.Bytes)return i.push(this.readSFixed64());var e=Bn(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===bt.Varint)for(;this.buf[this.pos++]>127;);else if(e===bt.Bytes)this.pos=this.readVarint()+this.pos;else if(e===bt.Fixed32)this.pos+=4;else{if(e!==bt.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),La(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),La(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),La(this.buf,-1&i,this.pos),La(this.buf,Math.floor(i*rp),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),La(this.buf,-1&i,this.pos),La(this.buf,Math.floor(i*rp),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,r){var a,u;if(e>=0?(a=e%4294967296|0,u=e/4294967296|0):(u=~(-e/4294967296),4294967295^(a=~(-e%4294967296))?a=a+1|0:(a=0,u=u+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(m,g,_){_.buf[_.pos++]=127&m|128,m>>>=7,_.buf[_.pos++]=127&m|128,m>>>=7,_.buf[_.pos++]=127&m|128,m>>>=7,_.buf[_.pos++]=127&m|128,_.buf[_.pos]=127&(m>>>=7)}(a,0,r),function(m,g){var _=(7&m)<<4;g.buf[g.pos++]|=_|((m>>>=3)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m)))))}(u,r)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(a,u,m){for(var g,_,w=0;w<u.length;w++){if((g=u.charCodeAt(w))>55295&&g<57344){if(!_){g>56319||w+1===u.length?(a[m++]=239,a[m++]=191,a[m++]=189):_=g;continue}if(g<56320){a[m++]=239,a[m++]=191,a[m++]=189,_=g;continue}g=_-55296<<10|g-56320|65536,_=null}else _&&(a[m++]=239,a[m++]=191,a[m++]=189,_=null);g<128?a[m++]=g:(g<2048?a[m++]=g>>6|192:(g<65536?a[m++]=g>>12|224:(a[m++]=g>>18|240,a[m++]=g>>12&63|128),a[m++]=g>>6&63|128),a[m++]=63&g|128)}return m}(this.buf,i,this.pos);var r=this.pos-e;r>=128&&sp(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(i){this.realloc(4),ip(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),ip(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=i[r]},writeRawMessage:function(i,e){this.pos++;var r=this.pos;i(e,this);var a=this.pos-r;a>=128&&sp(r,a,this),this.pos=r-1,this.writeVarint(a),this.pos+=a},writeMessage:function(i,e,r){this.writeTag(i,bt.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,my,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,gy,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,xy,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,yy,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,_y,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,vy,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,by,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,wy,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,Sy,e)},writeBytesField:function(i,e){this.writeTag(i,bt.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,bt.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,bt.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,bt.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,bt.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,bt.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,bt.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,bt.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,bt.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,bt.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,!!e)}};var Yu=K(ep);const Ju=3;function Ty(i,e,r){i===1&&r.readMessage(Ay,e)}function Ay(i,e,r){if(i===3){const{id:a,bitmap:u,width:m,height:g,left:_,top:w,advance:E}=r.readMessage(Ey,{});e.push({id:a,bitmap:new Ho({width:m+2*Ju,height:g+2*Ju},u),metrics:{width:m,height:g,left:_,top:w,advance:E}})}}function Ey(i,e,r){i===1?e.id=r.readVarint():i===2?e.bitmap=r.readBytes():i===3?e.width=r.readVarint():i===4?e.height=r.readVarint():i===5?e.left=r.readSVarint():i===6?e.top=r.readSVarint():i===7&&(e.advance=r.readVarint())}const op=Ju;function lp(i){let e=0,r=0;for(const g of i)e+=g.w*g.h,r=Math.max(r,g.w);i.sort((g,_)=>_.h-g.h);const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let u=0,m=0;for(const g of i)for(let _=a.length-1;_>=0;_--){const w=a[_];if(!(g.w>w.w||g.h>w.h)){if(g.x=w.x,g.y=w.y,m=Math.max(m,g.y+g.h),u=Math.max(u,g.x+g.w),g.w===w.w&&g.h===w.h){const E=a.pop();_<a.length&&(a[_]=E)}else g.h===w.h?(w.x+=g.w,w.w-=g.w):g.w===w.w?(w.y+=g.h,w.h-=g.h):(a.push({x:w.x+g.w,y:w.y,w:w.w-g.w,h:g.h}),w.y+=g.h,w.h-=g.h);break}}return{w:u,h:m,fill:e/(u*m)||0}}const Yi=1;class Qu{constructor(e,{pixelRatio:r,version:a,stretchX:u,stretchY:m,content:g}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=u,this.stretchY=m,this.content=g,this.version=a}get tl(){return[this.paddedRect.x+Yi,this.paddedRect.y+Yi]}get br(){return[this.paddedRect.x+this.paddedRect.w-Yi,this.paddedRect.y+this.paddedRect.h-Yi]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Yi)/this.pixelRatio,(this.paddedRect.h-2*Yi)/this.pixelRatio]}}class cp{constructor(e,r){const a={},u={};this.haveRenderCallbacks=[];const m=[];this.addImages(e,a,m),this.addImages(r,u,m);const{w:g,h:_}=lp(m),w=new gr({width:g||1,height:_||1});for(const E in e){const C=e[E],P=a[E].paddedRect;gr.copy(C.data,w,{x:0,y:0},{x:P.x+Yi,y:P.y+Yi},C.data)}for(const E in r){const C=r[E],P=u[E].paddedRect,R=P.x+Yi,B=P.y+Yi,F=C.data.width,V=C.data.height;gr.copy(C.data,w,{x:0,y:0},{x:R,y:B},C.data),gr.copy(C.data,w,{x:0,y:V-1},{x:R,y:B-1},{width:F,height:1}),gr.copy(C.data,w,{x:0,y:0},{x:R,y:B+V},{width:F,height:1}),gr.copy(C.data,w,{x:F-1,y:0},{x:R-1,y:B},{width:1,height:V}),gr.copy(C.data,w,{x:0,y:0},{x:R+F,y:B},{width:1,height:V})}this.image=w,this.iconPositions=a,this.patternPositions=u}addImages(e,r,a){for(const u in e){const m=e[u],g={x:0,y:0,w:m.data.width+2*Yi,h:m.data.height+2*Yi};a.push(g),r[u]=new Qu(g,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(e,r){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const a in e.updatedImages)this.patchUpdatedImage(this.iconPositions[a],e.getImage(a),r),this.patchUpdatedImage(this.patternPositions[a],e.getImage(a),r)}patchUpdatedImage(e,r,a){if(!e||!r||e.version===r.version)return;e.version=r.version;const[u,m]=e.tl;a.update(r.data,void 0,{x:u,y:m})}}var ps;Oe("ImagePosition",Qu),Oe("ImageAtlas",cp),x.ah=void 0,(ps=x.ah||(x.ah={}))[ps.none=0]="none",ps[ps.horizontal=1]="horizontal",ps[ps.vertical=2]="vertical",ps[ps.horizontalOnly=3]="horizontalOnly";const el=-17;class tl{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){const a=new tl;return a.scale=e||1,a.fontStack=r,a}static forImage(e){const r=new tl;return r.imageName=e,r}}class Fa{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){const a=new Fa;for(let u=0;u<e.sections.length;u++){const m=e.sections[u];m.image?a.addImageSection(m):a.addTextSection(m,r)}return a}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let r="";for(let a=0;a<e.length;a++){const u=e.charCodeAt(a+1)||null,m=e.charCodeAt(a-1)||null;r+=u&&Ao(u)&&!Qo[e[a+1]]||m&&Ao(m)&&!Qo[e[a-1]]||!Qo[e[a]]?e[a]:Qo[e[a]]}return r}(this.text)}trim(){let e=0;for(let a=0;a<this.text.length&&Bc[this.text.charCodeAt(a)];a++)e++;let r=this.text.length;for(let a=this.text.length-1;a>=0&&a>=e&&Bc[this.text.charCodeAt(a)];a--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const a=new Fa;return a.text=this.text.substring(e,r),a.sectionIndex=this.sectionIndex.slice(e,r),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(tl.forText(e.scale,e.fontStack||r));const a=this.sections.length-1;for(let u=0;u<e.text.length;++u)this.sectionIndex.push(a)}addImageSection(e){const r=e.image?e.image.name:"";if(r.length===0)return void mi("Can't add FormattedSection with an empty image.");const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCharCode(a),this.sections.push(tl.forImage(r)),this.sectionIndex.push(this.sections.length-1)):mi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function zc(i,e,r,a,u,m,g,_,w,E,C,P,R,B,F,V){const Z=Fa.fromFeature(i,u);let Y;P===x.ah.vertical&&Z.verticalizePunctuation();const{processBidirectionalText:le,processStyledBidirectionalText:J}=In;if(le&&Z.sections.length===1){Y=[];const xe=le(Z.toString(),eh(Z,E,m,e,a,B,F));for(const Be of xe){const Ne=new Fa;Ne.text=Be,Ne.sections=Z.sections;for(let ze=0;ze<Be.length;ze++)Ne.sectionIndex.push(0);Y.push(Ne)}}else if(J){Y=[];const xe=J(Z.text,Z.sectionIndex,eh(Z,E,m,e,a,B,F));for(const Be of xe){const Ne=new Fa;Ne.text=Be[0],Ne.sectionIndex=Be[1],Ne.sections=Z.sections,Y.push(Ne)}}else Y=function(xe,Be){const Ne=[],ze=xe.text;let Re=0;for(const Ce of Be)Ne.push(xe.substring(Re,Ce)),Re=Ce;return Re<ze.length&&Ne.push(xe.substring(Re,ze.length)),Ne}(Z,eh(Z,E,m,e,a,B,F));const se=[],ge={positionedLines:se,text:Z.toString(),top:C[1],bottom:C[1],left:C[0],right:C[0],writingMode:P,iconsInText:!1,verticalizable:!1};return function(xe,Be,Ne,ze,Re,Ce,$e,De,Ee,Ge,Ve,ot){let kt=0,Rt=el,ti=0,or=0;const Oi=De==="right"?1:De==="left"?0:.5;let Jt=0;for(const ii of Re){ii.trim();const ri=ii.getMaxScale(),Ti=(ri-1)*ei,Ui={positionedGlyphs:[],lineOffset:0};xe.positionedLines[Jt]=Ui;const Ai=Ui.positionedGlyphs;let Ji=0;if(!ii.length()){Rt+=Ce,++Jt;continue}for(let ni=0;ni<ii.length();ni++){const ut=ii.getSection(ni),Ei=ii.getSectionIndex(ni),bi=ii.getCharCode(ni);let si=0,kr=null,$r=null,Nr=null,Ln=ei;const Dr=!(Ee===x.ah.horizontal||!Ve&&!wa(bi)||Ve&&(Bc[bi]||(di=bi,Le.Arabic(di)||Le["Arabic Supplement"](di)||Le["Arabic Extended-A"](di)||Le["Arabic Presentation Forms-A"](di)||Le["Arabic Presentation Forms-B"](di))));if(ut.imageName){const _r=ze[ut.imageName];if(!_r)continue;Nr=ut.imageName,xe.iconsInText=xe.iconsInText||!0,$r=_r.paddedRect;const er=_r.displaySize;ut.scale=ut.scale*ei/ot,kr={width:er[0],height:er[1],left:Yi,top:-op,advance:Dr?er[1]:er[0]},si=Ti+(ei-er[1]*ut.scale),Ln=kr.advance;const Fn=Dr?er[0]*ut.scale-ei*ri:er[1]*ut.scale-ei*ri;Fn>0&&Fn>Ji&&(Ji=Fn)}else{const _r=Ne[ut.fontStack],er=_r&&_r[bi];if(er&&er.rect)$r=er.rect,kr=er.metrics;else{const Fn=Be[ut.fontStack],al=Fn&&Fn[bi];if(!al)continue;kr=al.metrics}si=(ri-ut.scale)*ei}Dr?(xe.verticalizable=!0,Ai.push({glyph:bi,imageName:Nr,x:kt,y:Rt+si,vertical:Dr,scale:ut.scale,fontStack:ut.fontStack,sectionIndex:Ei,metrics:kr,rect:$r}),kt+=Ln*ut.scale+Ge):(Ai.push({glyph:bi,imageName:Nr,x:kt,y:Rt+si,vertical:Dr,scale:ut.scale,fontStack:ut.fontStack,sectionIndex:Ei,metrics:kr,rect:$r}),kt+=kr.advance*ut.scale+Ge)}Ai.length!==0&&(ti=Math.max(kt-Ge,ti),Py(Ai,0,Ai.length-1,Oi,Ji)),kt=0;const Qi=Ce*ri+Ji;Ui.lineOffset=Math.max(Ji,Ti),Rt+=Qi,or=Math.max(Qi,or),++Jt}var di;const vi=Rt-el,{horizontalAlign:$i,verticalAlign:Ni}=th($e);(function(ii,ri,Ti,Ui,Ai,Ji,Qi,ni,ut){const Ei=(ri-Ti)*Ai;let bi=0;bi=Ji!==Qi?-ni*Ui-el:(-Ui*ut+.5)*Qi;for(const si of ii)for(const kr of si.positionedGlyphs)kr.x+=Ei,kr.y+=bi})(xe.positionedLines,Oi,$i,Ni,ti,or,Ce,vi,Re.length),xe.top+=-Ni*vi,xe.bottom=xe.top+vi,xe.left+=-$i*ti,xe.right=xe.left+ti}(ge,e,r,a,Y,g,_,w,P,E,R,V),!function(xe){for(const Be of xe)if(Be.positionedGlyphs.length!==0)return!1;return!0}(se)&&ge}const Bc={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Iy={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function up(i,e,r,a,u,m){if(e.imageName){const g=a[e.imageName];return g?g.displaySize[0]*e.scale*ei/m+u:0}{const g=r[e.fontStack],_=g&&g[i];return _?_.metrics.advance*e.scale+u:0}}function hp(i,e,r,a){const u=Math.pow(i-e,2);return a?i<e?u/2:2*u:u+Math.abs(r)*r}function Cy(i,e,r){let a=0;return i===10&&(a-=1e4),r&&(a+=150),i!==40&&i!==65288||(a+=50),e!==41&&e!==65289||(a+=50),a}function dp(i,e,r,a,u,m){let g=null,_=hp(e,r,u,m);for(const w of a){const E=hp(e-w.x,r,u,m)+w.badness;E<=_&&(g=w,_=E)}return{index:i,x:e,priorBreak:g,badness:_}}function pp(i){return i?pp(i.priorBreak).concat(i.index):[]}function eh(i,e,r,a,u,m,g){if(m!=="point")return[];if(!i)return[];const _=[],w=function(R,B,F,V,Z,Y){let le=0;for(let J=0;J<R.length();J++){const se=R.getSection(J);le+=up(R.getCharCode(J),se,V,Z,B,Y)}return le/Math.max(1,Math.ceil(le/F))}(i,e,r,a,u,g),E=i.text.indexOf("")>=0;let C=0;for(let R=0;R<i.length();R++){const B=i.getSection(R),F=i.getCharCode(R);if(Bc[F]||(C+=up(F,B,a,u,e,g)),R<i.length()-1){const V=!((P=F)<11904||!(Le["Bopomofo Extended"](P)||Le.Bopomofo(P)||Le["CJK Compatibility Forms"](P)||Le["CJK Compatibility Ideographs"](P)||Le["CJK Compatibility"](P)||Le["CJK Radicals Supplement"](P)||Le["CJK Strokes"](P)||Le["CJK Symbols and Punctuation"](P)||Le["CJK Unified Ideographs Extension A"](P)||Le["CJK Unified Ideographs"](P)||Le["Enclosed CJK Letters and Months"](P)||Le["Halfwidth and Fullwidth Forms"](P)||Le.Hiragana(P)||Le["Ideographic Description Characters"](P)||Le["Kangxi Radicals"](P)||Le["Katakana Phonetic Extensions"](P)||Le.Katakana(P)||Le["Vertical Forms"](P)||Le["Yi Radicals"](P)||Le["Yi Syllables"](P)));(Iy[F]||V||B.imageName)&&_.push(dp(R+1,C,w,_,Cy(F,i.getCharCode(R+1),V&&E),!1))}}var P;return pp(dp(i.length(),C,w,_,0,!0))}function th(i){let e=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function Py(i,e,r,a,u){if(!a&&!u)return;const m=i[r],g=(i[r].x+m.metrics.advance*m.scale)*a;for(let _=e;_<=r;_++)i[_].x-=g,i[_].y+=u}function My(i,e,r){const{horizontalAlign:a,verticalAlign:u}=th(r),m=e[0]-i.displaySize[0]*a,g=e[1]-i.displaySize[1]*u;return{image:i,top:g,bottom:g+i.displaySize[1],left:m,right:m+i.displaySize[0]}}function fp(i,e,r,a,u,m){const g=i.image;let _;if(g.content){const Z=g.content,Y=g.pixelRatio||1;_=[Z[0]/Y,Z[1]/Y,g.displaySize[0]-Z[2]/Y,g.displaySize[1]-Z[3]/Y]}const w=e.left*m,E=e.right*m;let C,P,R,B;r==="width"||r==="both"?(B=u[0]+w-a[3],P=u[0]+E+a[1]):(B=u[0]+(w+E-g.displaySize[0])/2,P=B+g.displaySize[0]);const F=e.top*m,V=e.bottom*m;return r==="height"||r==="both"?(C=u[1]+F-a[0],R=u[1]+V+a[2]):(C=u[1]+(F+V-g.displaySize[1])/2,R=C+g.displaySize[1]),{image:g,top:C,right:P,bottom:R,left:B,collisionPadding:_}}const il=255,nn=128,fs=il*nn;function mp(i,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Pt(i+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:a,interpolationType:u}=r;let m=0;for(;m<a.length&&a[m]<=i;)m++;m=Math.max(0,m-1);let g=m;for(;g<a.length&&a[g]<i+1;)g++;g=Math.min(a.length-1,g);const _=a[m],w=a[g];return r.kind==="composite"?{kind:"composite",minZoom:_,maxZoom:w,interpolationType:u}:{kind:"camera",minZoom:_,maxZoom:w,minSize:r.evaluate(new Pt(_)),maxSize:r.evaluate(new Pt(w)),interpolationType:u}}}function ih(i,e,r){let a="never";const u=i.get(e);return u?a=u:i.get(r)&&(a="always"),a}const ky=ds.VectorTileFeature.types,Dy=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Lc(i,e,r,a,u,m,g,_,w,E,C,P,R){const B=_?Math.min(fs,Math.round(_[0])):0,F=_?Math.min(fs,Math.round(_[1])):0;i.emplaceBack(e,r,Math.round(32*a),Math.round(32*u),m,g,(B<<1)+(w?1:0),F,16*E,16*C,256*P,256*R)}function rh(i,e,r){i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r)}function Ry(i){for(const e of i.sections)if(mc(e.text))return!0;return!1}class nh{constructor(e){this.layoutVertexArray=new te,this.indexArray=new de,this.programConfigurations=e,this.segments=new we,this.dynamicLayoutVertexArray=new ue,this.opacityVertexArray=new X,this.hasVisibleVertices=!1,this.placedSymbolArray=new t}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,a,u){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,uy.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,hy.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Dy,!0),this.opacityVertexBuffer.itemSize=1),(a||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Oe("SymbolBuffers",nh);class sh{constructor(e,r,a){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new a,this.segments=new we,this.collisionVertexArray=new he}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,dy.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Oe("CollisionBuffers",sh);class Oa{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(g=>g.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Lu([]),this.placementViewportMatrix=Lu([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=mp(this.zoom,r["text-size"]),this.iconSizeData=mp(this.zoom,r["icon-size"]);const a=this.layers[0].layout,u=a.get("symbol-sort-key"),m=a.get("symbol-z-order");this.canOverlap=ih(a,"text-overlap","text-allow-overlap")!=="never"||ih(a,"icon-overlap","icon-allow-overlap")!=="never"||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&!u.isConstant(),this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,a.get("symbol-placement")==="point"&&(this.writingModes=a.get("text-writing-mode").map(g=>x.ah[g])),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=e.sourceID}createArrays(){this.text=new nh(new Dt(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new nh(new Dt(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new c,this.lineVertexArray=new f,this.symbolInstances=new l,this.textAnchorOffsets=new b}calculateGlyphDependencies(e,r,a,u,m){for(let g=0;g<e.length;g++)if(r[e.charCodeAt(g)]=!0,(a||u)&&m){const _=Qo[e.charAt(g)];_&&(r[_.charCodeAt(0)]=!0)}}populate(e,r,a){const u=this.layers[0],m=u.layout,g=m.get("text-font"),_=m.get("text-field"),w=m.get("icon-image"),E=(_.value.kind!=="constant"||_.value.value instanceof Hi&&!_.value.value.isEmpty()||_.value.value.toString().length>0)&&(g.value.kind!=="constant"||g.value.value.length>0),C=w.value.kind!=="constant"||!!w.value.value||Object.keys(w.parameters).length>0,P=m.get("symbol-sort-key");if(this.features=[],!E&&!C)return;const R=r.iconDependencies,B=r.glyphDependencies,F=r.availableImages,V=new Pt(this.zoom);for(const{feature:Z,id:Y,index:le,sourceLayerIndex:J}of e){const se=u._featureFilter.needGeometry,ge=Rn(Z,se);if(!u._featureFilter.filter(V,ge,a))continue;let xe,Be;if(se||(ge.geometry=Dn(Z)),E){const ze=u.getValueAndResolveTokens("text-field",ge,a,F),Re=Hi.factory(ze),Ce=this.hasRTLText=this.hasRTLText||Ry(Re);(!Ce||In.getRTLTextPluginStatus()==="unavailable"||Ce&&In.isParsed())&&(xe=fy(Re,u,ge))}if(C){const ze=u.getValueAndResolveTokens("icon-image",ge,a,F);Be=ze instanceof nr?ze:nr.fromString(ze)}if(!xe&&!Be)continue;const Ne=this.sortFeaturesByKey?P.evaluate(ge,{},a):void 0;if(this.features.push({id:Y,text:xe,icon:Be,index:le,sourceLayerIndex:J,geometry:ge.geometry,properties:Z.properties,type:ky[Z.type],sortKey:Ne}),Be&&(R[Be.name]=!0),xe){const ze=g.evaluate(ge,{},a).join(","),Re=m.get("text-rotation-alignment")!=="viewport"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(x.ah.vertical)>=0;for(const Ce of xe.sections)if(Ce.image)R[Ce.image.name]=!0;else{const $e=Ns(xe.toString()),De=Ce.fontStack||ze,Ee=B[De]=B[De]||{};this.calculateGlyphDependencies(Ce.text,Ee,Re,this.allowVerticalPlacement,$e)}}}m.get("symbol-placement")==="line"&&(this.features=function(Z){const Y={},le={},J=[];let se=0;function ge(ze){J.push(Z[ze]),se++}function xe(ze,Re,Ce){const $e=le[ze];return delete le[ze],le[Re]=$e,J[$e].geometry[0].pop(),J[$e].geometry[0]=J[$e].geometry[0].concat(Ce[0]),$e}function Be(ze,Re,Ce){const $e=Y[Re];return delete Y[Re],Y[ze]=$e,J[$e].geometry[0].shift(),J[$e].geometry[0]=Ce[0].concat(J[$e].geometry[0]),$e}function Ne(ze,Re,Ce){const $e=Ce?Re[0][Re[0].length-1]:Re[0][0];return`${ze}:${$e.x}:${$e.y}`}for(let ze=0;ze<Z.length;ze++){const Re=Z[ze],Ce=Re.geometry,$e=Re.text?Re.text.toString():null;if(!$e){ge(ze);continue}const De=Ne($e,Ce),Ee=Ne($e,Ce,!0);if(De in le&&Ee in Y&&le[De]!==Y[Ee]){const Ge=Be(De,Ee,Ce),Ve=xe(De,Ee,J[Ge].geometry);delete Y[De],delete le[Ee],le[Ne($e,J[Ve].geometry,!0)]=Ve,J[Ge].geometry=null}else De in le?xe(De,Ee,Ce):Ee in Y?Be(De,Ee,Ce):(ge(ze),Y[De]=se-1,le[Ee]=se-1)}return J.filter(ze=>ze.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Z,Y)=>Z.sortKey-Y.sortKey)}update(e,r,a){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,a),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,a))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const a=this.lineVertexArray.length;if(e.segment!==void 0){let u=e.dist(r[e.segment+1]),m=e.dist(r[e.segment]);const g={};for(let _=e.segment+1;_<r.length;_++)g[_]={x:r[_].x,y:r[_].y,tileUnitDistanceFromAnchor:u},_<r.length-1&&(u+=r[_+1].dist(r[_]));for(let _=e.segment||0;_>=0;_--)g[_]={x:r[_].x,y:r[_].y,tileUnitDistanceFromAnchor:m},_>0&&(m+=r[_-1].dist(r[_]));for(let _=0;_<r.length;_++){const w=g[_];this.lineVertexArray.emplaceBack(w.x,w.y,w.tileUnitDistanceFromAnchor)}}return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(e,r,a,u,m,g,_,w,E,C,P,R){const B=e.indexArray,F=e.layoutVertexArray,V=e.segments.prepareSegment(4*r.length,F,B,this.canOverlap?g.sortKey:void 0),Z=this.glyphOffsetArray.length,Y=V.vertexLength,le=this.allowVerticalPlacement&&_===x.ah.vertical?Math.PI/2:0,J=g.text&&g.text.sections;for(let se=0;se<r.length;se++){const{tl:ge,tr:xe,bl:Be,br:Ne,tex:ze,pixelOffsetTL:Re,pixelOffsetBR:Ce,minFontScaleX:$e,minFontScaleY:De,glyphOffset:Ee,isSDF:Ge,sectionIndex:Ve}=r[se],ot=V.vertexLength,kt=Ee[1];Lc(F,w.x,w.y,ge.x,kt+ge.y,ze.x,ze.y,a,Ge,Re.x,Re.y,$e,De),Lc(F,w.x,w.y,xe.x,kt+xe.y,ze.x+ze.w,ze.y,a,Ge,Ce.x,Re.y,$e,De),Lc(F,w.x,w.y,Be.x,kt+Be.y,ze.x,ze.y+ze.h,a,Ge,Re.x,Ce.y,$e,De),Lc(F,w.x,w.y,Ne.x,kt+Ne.y,ze.x+ze.w,ze.y+ze.h,a,Ge,Ce.x,Ce.y,$e,De),rh(e.dynamicLayoutVertexArray,w,le),B.emplaceBack(ot,ot+1,ot+2),B.emplaceBack(ot+1,ot+2,ot+3),V.vertexLength+=4,V.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ee[0]),se!==r.length-1&&Ve===r[se+1].sectionIndex||e.programConfigurations.populatePaintArrays(F.length,g,g.index,{},R,J&&J[Ve])}e.placedSymbolArray.emplaceBack(w.x,w.y,Z,this.glyphOffsetArray.length-Z,Y,E,C,w.segment,a?a[0]:0,a?a[1]:0,u[0],u[1],_,0,!1,0,P)}_addCollisionDebugVertex(e,r,a,u,m,g){return r.emplaceBack(0,0),e.emplaceBack(a.x,a.y,u,m,Math.round(g.x),Math.round(g.y))}addCollisionDebugVertices(e,r,a,u,m,g,_){const w=m.segments.prepareSegment(4,m.layoutVertexArray,m.indexArray),E=w.vertexLength,C=m.layoutVertexArray,P=m.collisionVertexArray,R=_.anchorX,B=_.anchorY;this._addCollisionDebugVertex(C,P,g,R,B,new Q(e,r)),this._addCollisionDebugVertex(C,P,g,R,B,new Q(a,r)),this._addCollisionDebugVertex(C,P,g,R,B,new Q(a,u)),this._addCollisionDebugVertex(C,P,g,R,B,new Q(e,u)),w.vertexLength+=4;const F=m.indexArray;F.emplaceBack(E,E+1),F.emplaceBack(E+1,E+2),F.emplaceBack(E+2,E+3),F.emplaceBack(E+3,E),w.primitiveLength+=4}addDebugCollisionBoxes(e,r,a,u){for(let m=e;m<r;m++){const g=this.collisionBoxArray.get(m);this.addCollisionDebugVertices(g.x1,g.y1,g.x2,g.y2,u?this.textCollisionBox:this.iconCollisionBox,g.anchorPoint,a)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new sh(ae,Qd.members,pe),this.iconCollisionBox=new sh(ae,Qd.members,pe);for(let e=0;e<this.symbolInstances.length;e++){const r=this.symbolInstances.get(e);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(e,r,a,u,m,g,_,w,E){const C={};for(let P=r;P<a;P++){const R=e.get(P);C.textBox={x1:R.x1,y1:R.y1,x2:R.x2,y2:R.y2,anchorPointX:R.anchorPointX,anchorPointY:R.anchorPointY},C.textFeatureIndex=R.featureIndex;break}for(let P=u;P<m;P++){const R=e.get(P);C.verticalTextBox={x1:R.x1,y1:R.y1,x2:R.x2,y2:R.y2,anchorPointX:R.anchorPointX,anchorPointY:R.anchorPointY},C.verticalTextFeatureIndex=R.featureIndex;break}for(let P=g;P<_;P++){const R=e.get(P);C.iconBox={x1:R.x1,y1:R.y1,x2:R.x2,y2:R.y2,anchorPointX:R.anchorPointX,anchorPointY:R.anchorPointY},C.iconFeatureIndex=R.featureIndex;break}for(let P=w;P<E;P++){const R=e.get(P);C.verticalIconBox={x1:R.x1,y1:R.y1,x2:R.x2,y2:R.y2,anchorPointX:R.anchorPointX,anchorPointY:R.anchorPointY},C.verticalIconFeatureIndex=R.featureIndex;break}return C}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const a=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const a=e.placedSymbolArray.get(r),u=a.vertexStartIndex+4*a.numGlyphs;for(let m=a.vertexStartIndex;m<u;m+=4)e.indexArray.emplaceBack(m,m+1,m+2),e.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),a=Math.cos(e),u=[],m=[],g=[];for(let _=0;_<this.symbolInstances.length;++_){g.push(_);const w=this.symbolInstances.get(_);u.push(0|Math.round(r*w.anchorX+a*w.anchorY)),m.push(w.featureIndex)}return g.sort((_,w)=>u[_]-u[w]||m[w]-m[_]),g}addToSortKeyRanges(e,r){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===r?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const a=this.symbolInstances.get(r);this.featureSortOrder.push(a.featureIndex),[a.rightJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.leftJustifiedTextSymbolIndex].forEach((u,m,g)=>{u>=0&&g.indexOf(u)===m&&this.addIndicesForPlacedSymbol(this.text,u)}),a.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,a.verticalPlacedTextSymbolIndex),a.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.placedIconSymbolIndex),a.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let gp,yp;Oe("SymbolBucket",Oa,{omit:["layers","collisionBoxArray","features","compareText"]}),Oa.MAX_GLYPHS=65535,Oa.addDynamicAttributes=rh;var ah={get paint(){return yp=yp||new Bi({"icon-opacity":new He(fe.paint_symbol["icon-opacity"]),"icon-color":new He(fe.paint_symbol["icon-color"]),"icon-halo-color":new He(fe.paint_symbol["icon-halo-color"]),"icon-halo-width":new He(fe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new He(fe.paint_symbol["icon-halo-blur"]),"icon-translate":new je(fe.paint_symbol["icon-translate"]),"icon-translate-anchor":new je(fe.paint_symbol["icon-translate-anchor"]),"text-opacity":new He(fe.paint_symbol["text-opacity"]),"text-color":new He(fe.paint_symbol["text-color"],{runtimeType:hi,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new He(fe.paint_symbol["text-halo-color"]),"text-halo-width":new He(fe.paint_symbol["text-halo-width"]),"text-halo-blur":new He(fe.paint_symbol["text-halo-blur"]),"text-translate":new je(fe.paint_symbol["text-translate"]),"text-translate-anchor":new je(fe.paint_symbol["text-translate-anchor"])})},get layout(){return gp=gp||new Bi({"symbol-placement":new je(fe.layout_symbol["symbol-placement"]),"symbol-spacing":new je(fe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new je(fe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new He(fe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new je(fe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new je(fe.layout_symbol["icon-allow-overlap"]),"icon-overlap":new je(fe.layout_symbol["icon-overlap"]),"icon-ignore-placement":new je(fe.layout_symbol["icon-ignore-placement"]),"icon-optional":new je(fe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new je(fe.layout_symbol["icon-rotation-alignment"]),"icon-size":new He(fe.layout_symbol["icon-size"]),"icon-text-fit":new je(fe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new je(fe.layout_symbol["icon-text-fit-padding"]),"icon-image":new He(fe.layout_symbol["icon-image"]),"icon-rotate":new He(fe.layout_symbol["icon-rotate"]),"icon-padding":new He(fe.layout_symbol["icon-padding"]),"icon-keep-upright":new je(fe.layout_symbol["icon-keep-upright"]),"icon-offset":new He(fe.layout_symbol["icon-offset"]),"icon-anchor":new He(fe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new je(fe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new je(fe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new je(fe.layout_symbol["text-rotation-alignment"]),"text-field":new He(fe.layout_symbol["text-field"]),"text-font":new He(fe.layout_symbol["text-font"]),"text-size":new He(fe.layout_symbol["text-size"]),"text-max-width":new He(fe.layout_symbol["text-max-width"]),"text-line-height":new je(fe.layout_symbol["text-line-height"]),"text-letter-spacing":new He(fe.layout_symbol["text-letter-spacing"]),"text-justify":new He(fe.layout_symbol["text-justify"]),"text-radial-offset":new He(fe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new je(fe.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new He(fe.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new He(fe.layout_symbol["text-anchor"]),"text-max-angle":new je(fe.layout_symbol["text-max-angle"]),"text-writing-mode":new je(fe.layout_symbol["text-writing-mode"]),"text-rotate":new He(fe.layout_symbol["text-rotate"]),"text-padding":new je(fe.layout_symbol["text-padding"]),"text-keep-upright":new je(fe.layout_symbol["text-keep-upright"]),"text-transform":new He(fe.layout_symbol["text-transform"]),"text-offset":new He(fe.layout_symbol["text-offset"]),"text-allow-overlap":new je(fe.layout_symbol["text-allow-overlap"]),"text-overlap":new je(fe.layout_symbol["text-overlap"]),"text-ignore-placement":new je(fe.layout_symbol["text-ignore-placement"]),"text-optional":new je(fe.layout_symbol["text-optional"])})}};class _p{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:xn,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Oe("FormatSectionOverride",_p,{omit:["defaultValue"]});class Fc extends pr{constructor(e){super(e,ah)}recalculate(e,r){if(super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const a=this.layout.get("text-writing-mode");if(a){const u=[];for(const m of a)u.indexOf(m)<0&&u.push(m);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,r,a,u){const m=this.layout.get(e).evaluate(r,{},a,u),g=this._unevaluatedLayout._values[e];return g.isDataDriven()||Et(g.value)||!m?m:function(_,w){return w.replace(/{([^{}]+)}/g,(E,C)=>_&&C in _?String(_[C]):"")}(r.properties,m)}createBucket(e){return new Oa(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of ah.paint.overridableProperties){if(!Fc.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),a=new _p(r),u=new Ls(a,r.property.specification);let m=null;m=r.value.kind==="constant"||r.value.kind==="source"?new es("source",u):new ma("composite",u,r.value.zoomStops),this.paint._values[e]=new dr(r.property,m,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,a){return!(!this.layout||r.isDataDriven()||a.isDataDriven())&&Fc.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const a=e.get("text-field"),u=ah.paint.properties[r];let m=!1;const g=_=>{for(const w of _)if(u.overrides&&u.overrides.hasOverride(w))return void(m=!0)};if(a.value.kind==="constant"&&a.value.value instanceof Hi)g(a.value.value.sections);else if(a.value.kind==="source"){const _=E=>{m||(E instanceof vn&&Xt(E.value)===Lr?g(E.value.sections):E instanceof fa?g(E.sections):E.eachChild(_))},w=a.value;w._styleExpression&&_(w._styleExpression.expression)}return m}}let xp;var zy={get paint(){return xp=xp||new Bi({"background-color":new je(fe.paint_background["background-color"]),"background-pattern":new Mo(fe.paint_background["background-pattern"]),"background-opacity":new je(fe.paint_background["background-opacity"])})}};class By extends pr{constructor(e){super(e,zy)}}let vp;var Ly={get paint(){return vp=vp||new Bi({"raster-opacity":new je(fe.paint_raster["raster-opacity"]),"raster-hue-rotate":new je(fe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new je(fe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new je(fe.paint_raster["raster-brightness-max"]),"raster-saturation":new je(fe.paint_raster["raster-saturation"]),"raster-contrast":new je(fe.paint_raster["raster-contrast"]),"raster-resampling":new je(fe.paint_raster["raster-resampling"]),"raster-fade-duration":new je(fe.paint_raster["raster-fade-duration"])})}};class Fy extends pr{constructor(e){super(e,Ly)}}class Oy extends pr{constructor(e){super(e,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class $y{constructor(e){this._methodToThrottle=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const oh=63710088e-1;class ms{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ms(ji(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,a=this.lat*r,u=e.lat*r,m=Math.sin(a)*Math.sin(u)+Math.cos(a)*Math.cos(u)*Math.cos((e.lng-this.lng)*r);return oh*Math.acos(Math.min(m,1))}static convert(e){if(e instanceof ms)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new ms(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new ms(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const bp=2*Math.PI*oh;function wp(i){return bp*Math.cos(i*Math.PI/180)}function Sp(i){return(180+i)/360}function Tp(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Ap(i,e){return i/wp(e)}function lh(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class Oc{constructor(e,r,a=0){this.x=+e,this.y=+r,this.z=+a}static fromLngLat(e,r=0){const a=ms.convert(e);return new Oc(Sp(a.lng),Tp(a.lat),Ap(r,a.lat))}toLngLat(){return new ms(360*this.x-180,lh(this.y))}toAltitude(){return this.z*wp(lh(this.y))}meterInMercatorCoordinateUnits(){return 1/bp*(e=lh(this.y),1/Math.cos(e*Math.PI/180));var e}}function Ep(i,e,r){var a=2*Math.PI*6378137/256/Math.pow(2,r);return[i*a-2*Math.PI*6378137/2,e*a-2*Math.PI*6378137/2]}class ch{constructor(e,r,a){if(e<0||e>25||a<0||a>=Math.pow(2,e)||r<0||r>=Math.pow(2,e))throw new Error(`x=${r}, y=${a}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=r,this.y=a,this.key=rl(0,e,e,r,a)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r,a){const u=(g=this.y,_=this.z,w=Ep(256*(m=this.x),256*(g=Math.pow(2,_)-g-1),_),E=Ep(256*(m+1),256*(g+1),_),w[0]+","+w[1]+","+E[0]+","+E[1]);var m,g,_,w,E;const C=function(P,R,B){let F,V="";for(let Z=P;Z>0;Z--)F=1<<Z-1,V+=(R&F?1:0)+(B&F?2:0);return V}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,C).replace(/{bbox-epsg-3857}/g,u)}isChildOf(e){const r=this.z-e.z;return r>0&&e.x===this.x>>r&&e.y===this.y>>r}getTilePoint(e){const r=Math.pow(2,this.z);return new Q((e.x*r-this.x)*lt,(e.y*r-this.y)*lt)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Ip{constructor(e,r){this.wrap=e,this.canonical=r,this.key=rl(e,r.z,r.z,r.x,r.y)}}class yr{constructor(e,r,a,u,m){if(e<a)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${a}`);this.overscaledZ=e,this.wrap=r,this.canonical=new ch(a,+u,+m),this.key=rl(r,e,a,u,m)}clone(){return new yr(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-e;return e>this.canonical.z?new yr(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new yr(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const a=this.canonical.z-e;return e>this.canonical.z?rl(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y):rl(this.wrap*+r,e,e,this.canonical.x>>a,this.canonical.y>>a)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new yr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,a=2*this.canonical.x,u=2*this.canonical.y;return[new yr(r,this.wrap,r,a,u),new yr(r,this.wrap,r,a+1,u),new yr(r,this.wrap,r,a,u+1),new yr(r,this.wrap,r,a+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new yr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new yr(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Ip(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new Oc(e.x-this.wrap,e.y))}}function rl(i,e,r,a,u){(i*=2)<0&&(i=-1*i-1);const m=1<<r;return(m*m*i+m*u+a).toString(36)+r.toString(36)+e.toString(36)}Oe("CanonicalTileID",ch),Oe("OverscaledTileID",yr,{omit:["posMatrix"]});class Cp{constructor(e,r,a,u=1,m=1,g=1,_=0){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(a&&!["mapbox","terrarium","custom"].includes(a))return void mi(`"${a}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=r.height;const w=this.dim=r.height-2;switch(this.data=new Uint32Array(r.data.buffer),a){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=u,this.greenFactor=m,this.blueFactor=g,this.baseShift=_;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let E=0;E<w;E++)this.data[this._idx(-1,E)]=this.data[this._idx(0,E)],this.data[this._idx(w,E)]=this.data[this._idx(w-1,E)],this.data[this._idx(E,-1)]=this.data[this._idx(E,0)],this.data[this._idx(E,w)]=this.data[this._idx(E,w-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(w,-1)]=this.data[this._idx(w-1,0)],this.data[this._idx(-1,w)]=this.data[this._idx(0,w-1)],this.data[this._idx(w,w)]=this.data[this._idx(w-1,w-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let E=0;E<w;E++)for(let C=0;C<w;C++){const P=this.get(E,C);P>this.max&&(this.max=P),P<this.min&&(this.min=P)}}get(e,r){const a=new Uint8Array(this.data.buffer),u=4*this._idx(e,r);return this.unpack(a[u],a[u+1],a[u+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}unpack(e,r,a){return e*this.redFactor+r*this.greenFactor+a*this.blueFactor-this.baseShift}getPixels(){return new gr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,r,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=r*this.dim,m=r*this.dim+this.dim,g=a*this.dim,_=a*this.dim+this.dim;switch(r){case-1:u=m-1;break;case 1:m=u+1}switch(a){case-1:g=_-1;break;case 1:_=g+1}const w=-r*this.dim,E=-a*this.dim;for(let C=g;C<_;C++)for(let P=u;P<m;P++)this.data[this._idx(P,C)]=e.data[this._idx(P+w,C+E)]}}Oe("DEMData",Cp);class Pp{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const a=e[r];this._stringToNumber[a]=r,this._numberToString[r]=a}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class Mp{constructor(e,r,a,u,m){this.type="Feature",this._vectorTileFeature=e,e._z=r,e._x=a,e._y=u,this.properties=e.properties,this.id=m}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(e[r]=this[r]);return e}}class kp{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Fr(lt,16,0),this.grid3D=new Fr(lt,16,0),this.featureIndexArray=new I,this.promoteId=r}insert(e,r,a,u,m,g){const _=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,u,m);const w=g?this.grid3D:this.grid;for(let E=0;E<r.length;E++){const C=r[E],P=[1/0,1/0,-1/0,-1/0];for(let R=0;R<C.length;R++){const B=C[R];P[0]=Math.min(P[0],B.x),P[1]=Math.min(P[1],B.y),P[2]=Math.max(P[2],B.x),P[3]=Math.max(P[3],B.y)}P[0]<lt&&P[1]<lt&&P[2]>=0&&P[3]>=0&&w.insert(_,P[0],P[1],P[2],P[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new ds.VectorTile(new Yu(this.rawTileData)).layers,this.sourceLayerCoder=new Pp(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,r,a,u){this.loadVTLayers();const m=e.params||{},g=lt/e.tileSize/e.scale,_=_a(m.filter),w=e.queryGeometry,E=e.queryPadding*g,C=Rp(w),P=this.grid.query(C.minX-E,C.minY-E,C.maxX+E,C.maxY+E),R=Rp(e.cameraQueryGeometry),B=this.grid3D.query(R.minX-E,R.minY-E,R.maxX+E,R.maxY+E,(Z,Y,le,J)=>function(se,ge,xe,Be,Ne){for(const Re of se)if(ge<=Re.x&&xe<=Re.y&&Be>=Re.x&&Ne>=Re.y)return!0;const ze=[new Q(ge,xe),new Q(ge,Ne),new Q(Be,Ne),new Q(Be,xe)];if(se.length>2){for(const Re of ze)if(ka(se,Re))return!0}for(let Re=0;Re<se.length-1;Re++)if(yg(se[Re],se[Re+1],ze))return!0;return!1}(e.cameraQueryGeometry,Z-E,Y-E,le+E,J+E));for(const Z of B)P.push(Z);P.sort(Ny);const F={};let V;for(let Z=0;Z<P.length;Z++){const Y=P[Z];if(Y===V)continue;V=Y;const le=this.featureIndexArray.get(Y);let J=null;this.loadMatchingFeature(F,le.bucketIndex,le.sourceLayerIndex,le.featureIndex,_,m.layers,m.availableImages,r,a,u,(se,ge,xe)=>(J||(J=Dn(se)),ge.queryIntersectsFeature(w,se,xe,J,this.z,e.transform,g,e.pixelPosMatrix)))}return F}loadMatchingFeature(e,r,a,u,m,g,_,w,E,C,P){const R=this.bucketLayerIDs[r];if(g&&!function(Z,Y){for(let le=0;le<Z.length;le++)if(Y.indexOf(Z[le])>=0)return!0;return!1}(g,R))return;const B=this.sourceLayerCoder.decode(a),F=this.vtLayers[B].feature(u);if(m.needGeometry){const Z=Rn(F,!0);if(!m.filter(new Pt(this.tileID.overscaledZ),Z,this.tileID.canonical))return}else if(!m.filter(new Pt(this.tileID.overscaledZ),F))return;const V=this.getId(F,B);for(let Z=0;Z<R.length;Z++){const Y=R[Z];if(g&&g.indexOf(Y)<0)continue;const le=w[Y];if(!le)continue;let J={};V&&C&&(J=C.getState(le.sourceLayer||"_geojsonTileLayer",V));const se=fi({},E[Y]);se.paint=Dp(se.paint,le.paint,F,J,_),se.layout=Dp(se.layout,le.layout,F,J,_);const ge=!P||P(F,le,J);if(!ge)continue;const xe=new Mp(F,this.z,this.x,this.y,V);xe.layer=se;let Be=e[Y];Be===void 0&&(Be=e[Y]=[]),Be.push({featureIndex:u,feature:xe,intersectionZ:ge})}}lookupSymbolFeatures(e,r,a,u,m,g,_,w){const E={};this.loadVTLayers();const C=_a(m);for(const P of e)this.loadMatchingFeature(E,a,u,P,C,g,_,w,r);return E}hasLayer(e){for(const r of this.bucketLayerIDs)for(const a of r)if(e===a)return!0;return!1}getId(e,r){let a=e.id;return this.promoteId&&(a=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof a=="boolean"&&(a=Number(a))),a}}function Dp(i,e,r,a,u){return Gr(i,(m,g)=>{const _=e instanceof Us?e.get(g):null;return _&&_.evaluate?_.evaluate(r,a,u):_})}function Rp(i){let e=1/0,r=1/0,a=-1/0,u=-1/0;for(const m of i)e=Math.min(e,m.x),r=Math.min(r,m.y),a=Math.max(a,m.x),u=Math.max(u,m.y);return{minX:e,minY:r,maxX:a,maxY:u}}function Ny(i,e){return e-i}function zp(i,e,r,a,u){const m=[];for(let g=0;g<i.length;g++){const _=i[g];let w;for(let E=0;E<_.length-1;E++){let C=_[E],P=_[E+1];C.x<e&&P.x<e||(C.x<e?C=new Q(e,C.y+(e-C.x)/(P.x-C.x)*(P.y-C.y))._round():P.x<e&&(P=new Q(e,C.y+(e-C.x)/(P.x-C.x)*(P.y-C.y))._round()),C.y<r&&P.y<r||(C.y<r?C=new Q(C.x+(r-C.y)/(P.y-C.y)*(P.x-C.x),r)._round():P.y<r&&(P=new Q(C.x+(r-C.y)/(P.y-C.y)*(P.x-C.x),r)._round()),C.x>=a&&P.x>=a||(C.x>=a?C=new Q(a,C.y+(a-C.x)/(P.x-C.x)*(P.y-C.y))._round():P.x>=a&&(P=new Q(a,C.y+(a-C.x)/(P.x-C.x)*(P.y-C.y))._round()),C.y>=u&&P.y>=u||(C.y>=u?C=new Q(C.x+(u-C.y)/(P.y-C.y)*(P.x-C.x),u)._round():P.y>=u&&(P=new Q(C.x+(u-C.y)/(P.y-C.y)*(P.x-C.x),u)._round()),w&&C.equals(w[w.length-1])||(w=[C],m.push(w)),w.push(P)))))}}return m}Oe("FeatureIndex",kp,{omit:["rawTileData","sourceLayerCoder"]});class gs extends Q{constructor(e,r,a,u){super(e,r),this.angle=a,u!==void 0&&(this.segment=u)}clone(){return new gs(this.x,this.y,this.angle,this.segment)}}function Bp(i,e,r,a,u){if(e.segment===void 0||r===0)return!0;let m=e,g=e.segment+1,_=0;for(;_>-r/2;){if(g--,g<0)return!1;_-=i[g].dist(m),m=i[g]}_+=i[g].dist(i[g+1]),g++;const w=[];let E=0;for(;_<r/2;){const C=i[g],P=i[g+1];if(!P)return!1;let R=i[g-1].angleTo(C)-C.angleTo(P);for(R=Math.abs((R+3*Math.PI)%(2*Math.PI)-Math.PI),w.push({distance:_,angleDelta:R}),E+=R;_-w[0].distance>a;)E-=w.shift().angleDelta;if(E>u)return!1;g++,_+=C.dist(P)}return!0}function Lp(i){let e=0;for(let r=0;r<i.length-1;r++)e+=i[r].dist(i[r+1]);return e}function Fp(i,e,r){return i?.6*e*r:0}function Op(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function Uy(i,e,r,a,u,m){const g=Fp(r,u,m),_=Op(r,a)*m;let w=0;const E=Lp(i)/2;for(let C=0;C<i.length-1;C++){const P=i[C],R=i[C+1],B=P.dist(R);if(w+B>E){const F=(E-w)/B,V=Wi.number(P.x,R.x,F),Z=Wi.number(P.y,R.y,F),Y=new gs(V,Z,R.angleTo(P),C);return Y._round(),!g||Bp(i,Y,_,g,e)?Y:void 0}w+=B}}function Vy(i,e,r,a,u,m,g,_,w){const E=Fp(a,m,g),C=Op(a,u),P=C*g,R=i[0].x===0||i[0].x===w||i[0].y===0||i[0].y===w;return e-P<e/4&&(e=P+e/4),$p(i,R?e/2*_%e:(C/2+2*m)*g*_%e,e,E,r,P,R,!1,w)}function $p(i,e,r,a,u,m,g,_,w){const E=m/2,C=Lp(i);let P=0,R=e-r,B=[];for(let F=0;F<i.length-1;F++){const V=i[F],Z=i[F+1],Y=V.dist(Z),le=Z.angleTo(V);for(;R+r<P+Y;){R+=r;const J=(R-P)/Y,se=Wi.number(V.x,Z.x,J),ge=Wi.number(V.y,Z.y,J);if(se>=0&&se<w&&ge>=0&&ge<w&&R-E>=0&&R+E<=C){const xe=new gs(se,ge,le,F);xe._round(),a&&!Bp(i,xe,m,a,u)||B.push(xe)}}P+=Y}return _||B.length||g||(B=$p(i,P/2,r,a,u,m,g,!0,w)),B}Oe("Anchor",gs);const $a=Yi;function Np(i,e,r,a){const u=[],m=i.image,g=m.pixelRatio,_=m.paddedRect.w-2*$a,w=m.paddedRect.h-2*$a,E=i.right-i.left,C=i.bottom-i.top,P=m.stretchX||[[0,_]],R=m.stretchY||[[0,w]],B=(Ce,$e)=>Ce+$e[1]-$e[0],F=P.reduce(B,0),V=R.reduce(B,0),Z=_-F,Y=w-V;let le=0,J=F,se=0,ge=V,xe=0,Be=Z,Ne=0,ze=Y;if(m.content&&a){const Ce=m.content;le=$c(P,0,Ce[0]),se=$c(R,0,Ce[1]),J=$c(P,Ce[0],Ce[2]),ge=$c(R,Ce[1],Ce[3]),xe=Ce[0]-le,Ne=Ce[1]-se,Be=Ce[2]-Ce[0]-J,ze=Ce[3]-Ce[1]-ge}const Re=(Ce,$e,De,Ee)=>{const Ge=Nc(Ce.stretch-le,J,E,i.left),Ve=Uc(Ce.fixed-xe,Be,Ce.stretch,F),ot=Nc($e.stretch-se,ge,C,i.top),kt=Uc($e.fixed-Ne,ze,$e.stretch,V),Rt=Nc(De.stretch-le,J,E,i.left),ti=Uc(De.fixed-xe,Be,De.stretch,F),or=Nc(Ee.stretch-se,ge,C,i.top),Oi=Uc(Ee.fixed-Ne,ze,Ee.stretch,V),Jt=new Q(Ge,ot),di=new Q(Rt,ot),vi=new Q(Rt,or),$i=new Q(Ge,or),Ni=new Q(Ve/g,kt/g),ii=new Q(ti/g,Oi/g),ri=e*Math.PI/180;if(ri){const Ai=Math.sin(ri),Ji=Math.cos(ri),Qi=[Ji,-Ai,Ai,Ji];Jt._matMult(Qi),di._matMult(Qi),$i._matMult(Qi),vi._matMult(Qi)}const Ti=Ce.stretch+Ce.fixed,Ui=$e.stretch+$e.fixed;return{tl:Jt,tr:di,bl:$i,br:vi,tex:{x:m.paddedRect.x+$a+Ti,y:m.paddedRect.y+$a+Ui,w:De.stretch+De.fixed-Ti,h:Ee.stretch+Ee.fixed-Ui},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ni,pixelOffsetBR:ii,minFontScaleX:Be/g/E,minFontScaleY:ze/g/C,isSDF:r}};if(a&&(m.stretchX||m.stretchY)){const Ce=Up(P,Z,F),$e=Up(R,Y,V);for(let De=0;De<Ce.length-1;De++){const Ee=Ce[De],Ge=Ce[De+1];for(let Ve=0;Ve<$e.length-1;Ve++)u.push(Re(Ee,$e[Ve],Ge,$e[Ve+1]))}}else u.push(Re({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:_+1},{fixed:0,stretch:w+1}));return u}function $c(i,e,r){let a=0;for(const u of i)a+=Math.max(e,Math.min(r,u[1]))-Math.max(e,Math.min(r,u[0]));return a}function Up(i,e,r){const a=[{fixed:-$a,stretch:0}];for(const[u,m]of i){const g=a[a.length-1];a.push({fixed:u-g.stretch,stretch:g.stretch}),a.push({fixed:u-g.stretch,stretch:g.stretch+(m-u)})}return a.push({fixed:e+$a,stretch:r}),a}function Nc(i,e,r,a){return i/e*r+a}function Uc(i,e,r,a){return i-e*r/a}class Vc{constructor(e,r,a,u,m,g,_,w,E,C){if(this.boxStartIndex=e.length,E){let P=g.top,R=g.bottom;const B=g.collisionPadding;B&&(P-=B[1],R+=B[3]);let F=R-P;F>0&&(F=Math.max(10,F),this.circleDiameter=F)}else{let P=g.top*_-w[0],R=g.bottom*_+w[2],B=g.left*_-w[3],F=g.right*_+w[1];const V=g.collisionPadding;if(V&&(B-=V[0]*_,P-=V[1]*_,F+=V[2]*_,R+=V[3]*_),C){const Z=new Q(B,P),Y=new Q(F,P),le=new Q(B,R),J=new Q(F,R),se=C*Math.PI/180;Z._rotate(se),Y._rotate(se),le._rotate(se),J._rotate(se),B=Math.min(Z.x,Y.x,le.x,J.x),F=Math.max(Z.x,Y.x,le.x,J.x),P=Math.min(Z.y,Y.y,le.y,J.y),R=Math.max(Z.y,Y.y,le.y,J.y)}e.emplaceBack(r.x,r.y,B,P,F,R,a,u,m)}this.boxEndIndex=e.length}}class jy{constructor(e=[],r=qy){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:a}=this,u=r[e];for(;e>0;){const m=e-1>>1,g=r[m];if(a(u,g)>=0)break;r[e]=g,e=m}r[e]=u}_down(e){const{data:r,compare:a}=this,u=this.length>>1,m=r[e];for(;e<u;){let g=1+(e<<1),_=r[g];const w=g+1;if(w<this.length&&a(r[w],_)<0&&(g=w,_=r[w]),a(_,m)>=0)break;r[e]=_,e=g}r[e]=m}}function qy(i,e){return i<e?-1:i>e?1:0}function Gy(i,e=1,r=!1){let a=1/0,u=1/0,m=-1/0,g=-1/0;const _=i[0];for(let B=0;B<_.length;B++){const F=_[B];(!B||F.x<a)&&(a=F.x),(!B||F.y<u)&&(u=F.y),(!B||F.x>m)&&(m=F.x),(!B||F.y>g)&&(g=F.y)}const w=Math.min(m-a,g-u);let E=w/2;const C=new jy([],Hy);if(w===0)return new Q(a,u);for(let B=a;B<m;B+=w)for(let F=u;F<g;F+=w)C.push(new Na(B+E,F+E,E,i));let P=function(B){let F=0,V=0,Z=0;const Y=B[0];for(let le=0,J=Y.length,se=J-1;le<J;se=le++){const ge=Y[le],xe=Y[se],Be=ge.x*xe.y-xe.x*ge.y;V+=(ge.x+xe.x)*Be,Z+=(ge.y+xe.y)*Be,F+=3*Be}return new Na(V/F,Z/F,0,B)}(i),R=C.length;for(;C.length;){const B=C.pop();(B.d>P.d||!P.d)&&(P=B,r&&console.log("found best %d after %d probes",Math.round(1e4*B.d)/1e4,R)),B.max-P.d<=e||(E=B.h/2,C.push(new Na(B.p.x-E,B.p.y-E,E,i)),C.push(new Na(B.p.x+E,B.p.y-E,E,i)),C.push(new Na(B.p.x-E,B.p.y+E,E,i)),C.push(new Na(B.p.x+E,B.p.y+E,E,i)),R+=4)}return r&&(console.log(`num probes: ${R}`),console.log(`best distance: ${P.d}`)),P.p}function Hy(i,e){return e.max-i.max}function Na(i,e,r,a){this.p=new Q(i,e),this.h=r,this.d=function(u,m){let g=!1,_=1/0;for(let w=0;w<m.length;w++){const E=m[w];for(let C=0,P=E.length,R=P-1;C<P;R=C++){const B=E[C],F=E[R];B.y>u.y!=F.y>u.y&&u.x<(F.x-B.x)*(u.y-B.y)/(F.y-B.y)+B.x&&(g=!g),_=Math.min(_,Td(u,B,F))}}return(g?1:-1)*Math.sqrt(_)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}var xi;x.ap=void 0,(xi=x.ap||(x.ap={}))[xi.center=1]="center",xi[xi.left=2]="left",xi[xi.right=3]="right",xi[xi.top=4]="top",xi[xi.bottom=5]="bottom",xi[xi["top-left"]=6]="top-left",xi[xi["top-right"]=7]="top-right",xi[xi["bottom-left"]=8]="bottom-left",xi[xi["bottom-right"]=9]="bottom-right";const ys=7,uh=Number.POSITIVE_INFINITY;function Vp(i,e){return e[1]!==uh?function(r,a,u){let m=0,g=0;switch(a=Math.abs(a),u=Math.abs(u),r){case"top-right":case"top-left":case"top":g=u-ys;break;case"bottom-right":case"bottom-left":case"bottom":g=-u+ys}switch(r){case"top-right":case"bottom-right":case"right":m=-a;break;case"top-left":case"bottom-left":case"left":m=a}return[m,g]}(i,e[0],e[1]):function(r,a){let u=0,m=0;a<0&&(a=0);const g=a/Math.SQRT2;switch(r){case"top-right":case"top-left":m=g-ys;break;case"bottom-right":case"bottom-left":m=-g+ys;break;case"bottom":m=-a+ys;break;case"top":m=a-ys}switch(r){case"top-right":case"bottom-right":u=-g;break;case"top-left":case"bottom-left":u=g;break;case"left":u=a;break;case"right":u=-a}return[u,m]}(i,e[0])}function jp(i,e,r){var a;const u=i.layout,m=(a=u.get("text-variable-anchor-offset"))===null||a===void 0?void 0:a.evaluate(e,{},r);if(m){const _=m.values,w=[];for(let E=0;E<_.length;E+=2){const C=w[E]=_[E],P=_[E+1].map(R=>R*ei);C.startsWith("top")?P[1]-=ys:C.startsWith("bottom")&&(P[1]+=ys),w[E+1]=P}return new yi(w)}const g=u.get("text-variable-anchor");if(g){let _;_=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[u.get("text-radial-offset").evaluate(e,{},r)*ei,uh]:u.get("text-offset").evaluate(e,{},r).map(E=>E*ei);const w=[];for(const E of g)w.push(E,Vp(E,_));return new yi(w)}return null}function hh(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Zy(i,e,r,a,u,m,g,_,w,E,C){let P=m.textMaxSize.evaluate(e,{});P===void 0&&(P=g);const R=i.layers[0].layout,B=R.get("icon-offset").evaluate(e,{},C),F=Gp(r.horizontal),V=g/24,Z=i.tilePixelRatio*V,Y=i.tilePixelRatio*P/24,le=i.tilePixelRatio*_,J=i.tilePixelRatio*R.get("symbol-spacing"),se=R.get("text-padding")*i.tilePixelRatio,ge=function(Ee,Ge,Ve,ot=1){const kt=Ee.get("icon-padding").evaluate(Ge,{},Ve),Rt=kt&&kt.values;return[Rt[0]*ot,Rt[1]*ot,Rt[2]*ot,Rt[3]*ot]}(R,e,C,i.tilePixelRatio),xe=R.get("text-max-angle")/180*Math.PI,Be=R.get("text-rotation-alignment")!=="viewport"&&R.get("symbol-placement")!=="point",Ne=R.get("icon-rotation-alignment")==="map"&&R.get("symbol-placement")!=="point",ze=R.get("symbol-placement"),Re=J/2,Ce=R.get("icon-text-fit");let $e;a&&Ce!=="none"&&(i.allowVerticalPlacement&&r.vertical&&($e=fp(a,r.vertical,Ce,R.get("icon-text-fit-padding"),B,V)),F&&(a=fp(a,F,Ce,R.get("icon-text-fit-padding"),B,V)));const De=(Ee,Ge)=>{Ge.x<0||Ge.x>=lt||Ge.y<0||Ge.y>=lt||function(Ve,ot,kt,Rt,ti,or,Oi,Jt,di,vi,$i,Ni,ii,ri,Ti,Ui,Ai,Ji,Qi,ni,ut,Ei,bi,si,kr){const $r=Ve.addToLineVertexArray(ot,kt);let Nr,Ln,Dr,_r,er=0,Fn=0,al=0,Kp=0,xh=-1,vh=-1;const On={};let Xp=at("");if(Ve.allowVerticalPlacement&&Rt.vertical){const Ii=Jt.layout.get("text-rotate").evaluate(ut,{},si)+90;Dr=new Vc(di,ot,vi,$i,Ni,Rt.vertical,ii,ri,Ti,Ii),Oi&&(_r=new Vc(di,ot,vi,$i,Ni,Oi,Ai,Ji,Ti,Ii))}if(ti){const Ii=Jt.layout.get("icon-rotate").evaluate(ut,{}),xr=Jt.layout.get("icon-text-fit")!=="none",Ks=Np(ti,Ii,bi,xr),Vr=Oi?Np(Oi,Ii,bi,xr):void 0;Ln=new Vc(di,ot,vi,$i,Ni,ti,Ai,Ji,!1,Ii),er=4*Ks.length;const Xs=Ve.iconSizeData;let sn=null;Xs.kind==="source"?(sn=[nn*Jt.layout.get("icon-size").evaluate(ut,{})],sn[0]>fs&&mi(`${Ve.layerIds[0]}: Value for "icon-size" is >= ${il}. Reduce your "icon-size".`)):Xs.kind==="composite"&&(sn=[nn*Ei.compositeIconSizes[0].evaluate(ut,{},si),nn*Ei.compositeIconSizes[1].evaluate(ut,{},si)],(sn[0]>fs||sn[1]>fs)&&mi(`${Ve.layerIds[0]}: Value for "icon-size" is >= ${il}. Reduce your "icon-size".`)),Ve.addSymbols(Ve.icon,Ks,sn,ni,Qi,ut,x.ah.none,ot,$r.lineStartIndex,$r.lineLength,-1,si),xh=Ve.icon.placedSymbolArray.length-1,Vr&&(Fn=4*Vr.length,Ve.addSymbols(Ve.icon,Vr,sn,ni,Qi,ut,x.ah.vertical,ot,$r.lineStartIndex,$r.lineLength,-1,si),vh=Ve.icon.placedSymbolArray.length-1)}const Yp=Object.keys(Rt.horizontal);for(const Ii of Yp){const xr=Rt.horizontal[Ii];if(!Nr){Xp=at(xr.text);const Vr=Jt.layout.get("text-rotate").evaluate(ut,{},si);Nr=new Vc(di,ot,vi,$i,Ni,xr,ii,ri,Ti,Vr)}const Ks=xr.positionedLines.length===1;if(al+=qp(Ve,ot,xr,or,Jt,Ti,ut,Ui,$r,Rt.vertical?x.ah.horizontal:x.ah.horizontalOnly,Ks?Yp:[Ii],On,xh,Ei,si),Ks)break}Rt.vertical&&(Kp+=qp(Ve,ot,Rt.vertical,or,Jt,Ti,ut,Ui,$r,x.ah.vertical,["vertical"],On,vh,Ei,si));const Xy=Nr?Nr.boxStartIndex:Ve.collisionBoxArray.length,Yy=Nr?Nr.boxEndIndex:Ve.collisionBoxArray.length,Jy=Dr?Dr.boxStartIndex:Ve.collisionBoxArray.length,Qy=Dr?Dr.boxEndIndex:Ve.collisionBoxArray.length,e_=Ln?Ln.boxStartIndex:Ve.collisionBoxArray.length,t_=Ln?Ln.boxEndIndex:Ve.collisionBoxArray.length,i_=_r?_r.boxStartIndex:Ve.collisionBoxArray.length,r_=_r?_r.boxEndIndex:Ve.collisionBoxArray.length;let Ur=-1;const qc=(Ii,xr)=>Ii&&Ii.circleDiameter?Math.max(Ii.circleDiameter,xr):xr;Ur=qc(Nr,Ur),Ur=qc(Dr,Ur),Ur=qc(Ln,Ur),Ur=qc(_r,Ur);const Jp=Ur>-1?1:0;Jp&&(Ur*=kr/ei),Ve.glyphOffsetArray.length>=Oa.MAX_GLYPHS&&mi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ut.sortKey!==void 0&&Ve.addToSortKeyRanges(Ve.symbolInstances.length,ut.sortKey);const n_=jp(Jt,ut,si),[s_,a_]=function(Ii,xr){const Ks=Ii.length,Vr=xr==null?void 0:xr.values;if((Vr==null?void 0:Vr.length)>0)for(let Xs=0;Xs<Vr.length;Xs+=2){const sn=Vr[Xs+1];Ii.emplaceBack(x.ap[Vr[Xs]],sn[0],sn[1])}return[Ks,Ii.length]}(Ve.textAnchorOffsets,n_);Ve.symbolInstances.emplaceBack(ot.x,ot.y,On.right>=0?On.right:-1,On.center>=0?On.center:-1,On.left>=0?On.left:-1,On.vertical||-1,xh,vh,Xp,Xy,Yy,Jy,Qy,e_,t_,i_,r_,vi,al,Kp,er,Fn,Jp,0,ii,Ur,s_,a_)}(i,Ge,Ee,r,a,u,$e,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,Z,[se,se,se,se],Be,w,le,ge,Ne,B,e,m,E,C,g)};if(ze==="line")for(const Ee of zp(e.geometry,0,0,lt,lt)){const Ge=Vy(Ee,J,xe,r.vertical||F,a,24,Y,i.overscaling,lt);for(const Ve of Ge)F&&Wy(i,F.text,Re,Ve)||De(Ee,Ve)}else if(ze==="line-center"){for(const Ee of e.geometry)if(Ee.length>1){const Ge=Uy(Ee,xe,r.vertical||F,a,24,Y);Ge&&De(Ee,Ge)}}else if(e.type==="Polygon")for(const Ee of ju(e.geometry,0)){const Ge=Gy(Ee,16);De(Ee[0],new gs(Ge.x,Ge.y,0))}else if(e.type==="LineString")for(const Ee of e.geometry)De(Ee,new gs(Ee[0].x,Ee[0].y,0));else if(e.type==="Point")for(const Ee of e.geometry)for(const Ge of Ee)De([Ge],new gs(Ge.x,Ge.y,0))}function qp(i,e,r,a,u,m,g,_,w,E,C,P,R,B,F){const V=function(le,J,se,ge,xe,Be,Ne,ze){const Re=ge.layout.get("text-rotate").evaluate(Be,{})*Math.PI/180,Ce=[];for(const $e of J.positionedLines)for(const De of $e.positionedGlyphs){if(!De.rect)continue;const Ee=De.rect||{};let Ge=op+1,Ve=!0,ot=1,kt=0;const Rt=(xe||ze)&&De.vertical,ti=De.metrics.advance*De.scale/2;if(ze&&J.verticalizable&&(kt=$e.lineOffset/2-(De.imageName?-(ei-De.metrics.width*De.scale)/2:(De.scale-1)*ei)),De.imageName){const ni=Ne[De.imageName];Ve=ni.sdf,ot=ni.pixelRatio,Ge=Yi/ot}const or=xe?[De.x+ti,De.y]:[0,0];let Oi=xe?[0,0]:[De.x+ti+se[0],De.y+se[1]-kt],Jt=[0,0];Rt&&(Jt=Oi,Oi=[0,0]);const di=De.metrics.isDoubleResolution?2:1,vi=(De.metrics.left-Ge)*De.scale-ti+Oi[0],$i=(-De.metrics.top-Ge)*De.scale+Oi[1],Ni=vi+Ee.w/di*De.scale/ot,ii=$i+Ee.h/di*De.scale/ot,ri=new Q(vi,$i),Ti=new Q(Ni,$i),Ui=new Q(vi,ii),Ai=new Q(Ni,ii);if(Rt){const ni=new Q(-ti,ti-el),ut=-Math.PI/2,Ei=ei/2-ti,bi=new Q(5-el-Ei,-(De.imageName?Ei:0)),si=new Q(...Jt);ri._rotateAround(ut,ni)._add(bi)._add(si),Ti._rotateAround(ut,ni)._add(bi)._add(si),Ui._rotateAround(ut,ni)._add(bi)._add(si),Ai._rotateAround(ut,ni)._add(bi)._add(si)}if(Re){const ni=Math.sin(Re),ut=Math.cos(Re),Ei=[ut,-ni,ni,ut];ri._matMult(Ei),Ti._matMult(Ei),Ui._matMult(Ei),Ai._matMult(Ei)}const Ji=new Q(0,0),Qi=new Q(0,0);Ce.push({tl:ri,tr:Ti,bl:Ui,br:Ai,tex:Ee,writingMode:J.writingMode,glyphOffset:or,sectionIndex:De.sectionIndex,isSDF:Ve,pixelOffsetTL:Ji,pixelOffsetBR:Qi,minFontScaleX:0,minFontScaleY:0})}return Ce}(0,r,_,u,m,g,a,i.allowVerticalPlacement),Z=i.textSizeData;let Y=null;Z.kind==="source"?(Y=[nn*u.layout.get("text-size").evaluate(g,{})],Y[0]>fs&&mi(`${i.layerIds[0]}: Value for "text-size" is >= ${il}. Reduce your "text-size".`)):Z.kind==="composite"&&(Y=[nn*B.compositeTextSizes[0].evaluate(g,{},F),nn*B.compositeTextSizes[1].evaluate(g,{},F)],(Y[0]>fs||Y[1]>fs)&&mi(`${i.layerIds[0]}: Value for "text-size" is >= ${il}. Reduce your "text-size".`)),i.addSymbols(i.text,V,Y,_,m,g,E,e,w.lineStartIndex,w.lineLength,R,F);for(const le of C)P[le]=i.text.placedSymbolArray.length-1;return 4*V.length}function Gp(i){for(const e in i)return i[e];return null}function Wy(i,e,r,a){const u=i.compareText;if(e in u){const m=u[e];for(let g=m.length-1;g>=0;g--)if(a.dist(m[g])<r)return!0}else u[e]=[];return u[e].push(a),!1}const Hp=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class dh{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,a]=new Uint8Array(e,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const u=a>>4;if(u!==1)throw new Error(`Got v${u} data when expected v1.`);const m=Hp[15&a];if(!m)throw new Error("Unrecognized array type.");const[g]=new Uint16Array(e,2,1),[_]=new Uint32Array(e,4,1);return new dh(_,g,m,e)}constructor(e,r=64,a=Float64Array,u){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=a,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const m=Hp.indexOf(this.ArrayType),g=2*e*this.ArrayType.BYTES_PER_ELEMENT,_=e*this.IndexArrayType.BYTES_PER_ELEMENT,w=(8-_%8)%8;if(m<0)throw new Error(`Unexpected typed array class: ${a}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+_+w,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+g+_+w),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+_+w,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+m]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e)}add(e,r){const a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=e,this.coords[this._pos++]=r,a}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return ph(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,r,a,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:g,nodeSize:_}=this,w=[0,m.length-1,0],E=[];for(;w.length;){const C=w.pop()||0,P=w.pop()||0,R=w.pop()||0;if(P-R<=_){for(let Z=R;Z<=P;Z++){const Y=g[2*Z],le=g[2*Z+1];Y>=e&&Y<=a&&le>=r&&le<=u&&E.push(m[Z])}continue}const B=R+P>>1,F=g[2*B],V=g[2*B+1];F>=e&&F<=a&&V>=r&&V<=u&&E.push(m[B]),(C===0?e<=F:r<=V)&&(w.push(R),w.push(B-1),w.push(1-C)),(C===0?a>=F:u>=V)&&(w.push(B+1),w.push(P),w.push(1-C))}return E}within(e,r,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:m,nodeSize:g}=this,_=[0,u.length-1,0],w=[],E=a*a;for(;_.length;){const C=_.pop()||0,P=_.pop()||0,R=_.pop()||0;if(P-R<=g){for(let Z=R;Z<=P;Z++)Wp(m[2*Z],m[2*Z+1],e,r)<=E&&w.push(u[Z]);continue}const B=R+P>>1,F=m[2*B],V=m[2*B+1];Wp(F,V,e,r)<=E&&w.push(u[B]),(C===0?e-a<=F:r-a<=V)&&(_.push(R),_.push(B-1),_.push(1-C)),(C===0?e+a>=F:r+a>=V)&&(_.push(B+1),_.push(P),_.push(1-C))}return w}}function ph(i,e,r,a,u,m){if(u-a<=r)return;const g=a+u>>1;Zp(i,e,g,a,u,m),ph(i,e,r,a,g-1,1-m),ph(i,e,r,g+1,u,1-m)}function Zp(i,e,r,a,u,m){for(;u>a;){if(u-a>600){const E=u-a+1,C=r-a+1,P=Math.log(E),R=.5*Math.exp(2*P/3),B=.5*Math.sqrt(P*R*(E-R)/E)*(C-E/2<0?-1:1);Zp(i,e,r,Math.max(a,Math.floor(r-C*R/E+B)),Math.min(u,Math.floor(r+(E-C)*R/E+B)),m)}const g=e[2*r+m];let _=a,w=u;for(nl(i,e,a,r),e[2*u+m]>g&&nl(i,e,a,u);_<w;){for(nl(i,e,_,w),_++,w--;e[2*_+m]<g;)_++;for(;e[2*w+m]>g;)w--}e[2*a+m]===g?nl(i,e,a,w):(w++,nl(i,e,w,u)),w<=r&&(a=w+1),r<=w&&(u=w-1)}}function nl(i,e,r,a){fh(i,r,a),fh(e,2*r,2*a),fh(e,2*r+1,2*a+1)}function fh(i,e,r){const a=i[e];i[e]=i[r],i[r]=a}function Wp(i,e,r,a){const u=i-r,m=e-a;return u*u+m*m}var mh;x.bd=void 0,(mh=x.bd||(x.bd={})).create="create",mh.load="load",mh.fullLoad="fullLoad";let jc=null,sl=[];const gh=1e3/60,yh="loadTime",_h="fullLoadTime",Ky={mark(i){performance.mark(i)},frame(i){const e=i;jc!=null&&sl.push(e-jc),jc=e},clearMetrics(){jc=null,sl=[],performance.clearMeasures(yh),performance.clearMeasures(_h);for(const i in x.bd)performance.clearMarks(x.bd[i])},getPerformanceMetrics(){performance.measure(yh,x.bd.create,x.bd.load),performance.measure(_h,x.bd.create,x.bd.fullLoad);const i=performance.getEntriesByName(yh)[0].duration,e=performance.getEntriesByName(_h)[0].duration,r=sl.length,a=1/(sl.reduce((m,g)=>m+g,0)/r/1e3),u=sl.filter(m=>m>gh).reduce((m,g)=>m+(g-gh)/gh,0);return{loadTime:i,fullLoadTime:e,fps:a,percentDroppedFrames:u/(r+u)*100,totalFrames:r}}};x.$=we,x.A=Da,x.B=function(i){if(Nn==null){const e=i.navigator?i.navigator.userAgent:null;Nn=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Nn},x.C=class{constructor(i,e){this.target=i,this.mapId=e,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new $y(()=>this.process()),this.subscription=function(r,a,u,m){return r.addEventListener(a,u,!1),{unsubscribe:()=>{r.removeEventListener(a,u,!1)}}}(this.target,"message",r=>this.receive(r)),this.globalScope=zr(self)?i:window}registerMessageHandler(i,e){this.messageHandlers[i]=e}sendAsync(i,e){return new Promise((r,a)=>{const u=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[u]={resolve:r,reject:a},e&&e.signal.addEventListener("abort",()=>{delete this.resolveRejects[u];const _={id:u,type:"<cancel>",origin:location.origin,targetMapId:i.targetMapId,sourceMapId:this.mapId};this.target.postMessage(_)},{once:!0});const m=[],g=Object.assign(Object.assign({},i),{id:u,sourceMapId:this.mapId,origin:location.origin,data:En(i.data,m)});this.target.postMessage(g,{transfer:m})})}receive(i){const e=i.data,r=e.id;if(!(e.origin!=="file://"&&location.origin!=="file://"&&e.origin!==location.origin||e.targetMapId&&this.mapId!==e.targetMapId)){if(e.type==="<cancel>"){delete this.tasks[r];const a=this.abortControllers[r];return delete this.abortControllers[r],void(a&&a.abort())}if(zr(self)||e.mustQueue)return this.tasks[r]=e,this.taskQueue.push(r),void this.invoker.trigger();this.processTask(r,e)}}process(){if(this.taskQueue.length===0)return;const i=this.taskQueue.shift(),e=this.tasks[i];delete this.tasks[i],this.taskQueue.length>0&&this.invoker.trigger(),e&&this.processTask(i,e)}processTask(i,e){return h(this,void 0,void 0,function*(){if(e.type==="<response>"){const u=this.resolveRejects[i];return delete this.resolveRejects[i],u?void(e.error?u.reject(os(e.error)):u.resolve(os(e.data))):void 0}if(!this.messageHandlers[e.type])return void this.completeTask(i,new Error(`Could not find a registered handler for ${e.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const r=os(e.data),a=new AbortController;this.abortControllers[i]=a;try{const u=yield this.messageHandlers[e.type](e.sourceMapId,r,a);this.completeTask(i,null,u)}catch(u){this.completeTask(i,u)}})}completeTask(i,e,r){const a=[];delete this.abortControllers[i];const u={id:i,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:e?En(e):null,data:En(r,a)};this.target.postMessage(u,{transfer:a})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},x.D=je,x.E=gn,x.F=function(){var i=new Da(16);return Da!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},x.G=cr,x.H=function(i,e,r){var a,u,m,g,_,w,E,C,P,R,B,F,V=r[0],Z=r[1],Y=r[2];return e===i?(i[12]=e[0]*V+e[4]*Z+e[8]*Y+e[12],i[13]=e[1]*V+e[5]*Z+e[9]*Y+e[13],i[14]=e[2]*V+e[6]*Z+e[10]*Y+e[14],i[15]=e[3]*V+e[7]*Z+e[11]*Y+e[15]):(u=e[1],m=e[2],g=e[3],_=e[4],w=e[5],E=e[6],C=e[7],P=e[8],R=e[9],B=e[10],F=e[11],i[0]=a=e[0],i[1]=u,i[2]=m,i[3]=g,i[4]=_,i[5]=w,i[6]=E,i[7]=C,i[8]=P,i[9]=R,i[10]=B,i[11]=F,i[12]=a*V+_*Z+P*Y+e[12],i[13]=u*V+w*Z+R*Y+e[13],i[14]=m*V+E*Z+B*Y+e[14],i[15]=g*V+C*Z+F*Y+e[15]),i},x.I=Qu,x.J=function(i,e,r){var a=r[0],u=r[1],m=r[2];return i[0]=e[0]*a,i[1]=e[1]*a,i[2]=e[2]*a,i[3]=e[3]*a,i[4]=e[4]*u,i[5]=e[5]*u,i[6]=e[6]*u,i[7]=e[7]*u,i[8]=e[8]*m,i[9]=e[9]*m,i[10]=e[10]*m,i[11]=e[11]*m,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},x.K=Cd,x.L=function(i,e){const r={};for(let a=0;a<e.length;a++){const u=e[a];u in i&&(r[u]=i[u])}return r},x.M=ms,x.N=Sp,x.O=Tp,x.P=Q,x.Q=yr,x.R=gr,x.S=Ye,x.T=Co,x.U=_t,x.V=Hr,x.W=lt,x.X=Wt,x.Y=Oc,x.Z=class extends tn{},x._=h,x.a=mn,x.a$=function(i,e,r){return i[0]=e[0]*r[0],i[1]=e[1]*r[1],i[2]=e[2]*r[2],i[3]=e[3]*r[3],i},x.a0=ch,x.a1=Me,x.a2=i=>{const e=window.document.createElement("video");return e.muted=!0,new Promise(r=>{e.onloadstart=()=>{r(e)};for(const a of i){const u=window.document.createElement("source");ia(a)||(e.crossOrigin="Anonymous"),u.src=a,e.appendChild(u)}})},x.a3=function(){return dn++},x.a4=vc,x.a5=Oa,x.a6=_a,x.a7=Rn,x.a8=Pt,x.a9=Mp,x.aA=Pi,x.aB=function(i,e){if(!i)return[{command:"setStyle",args:[e]}];let r=[];try{if(!ht(i.version,e.version))return[{command:"setStyle",args:[e]}];ht(i.center,e.center)||r.push({command:"setCenter",args:[e.center]}),ht(i.zoom,e.zoom)||r.push({command:"setZoom",args:[e.zoom]}),ht(i.bearing,e.bearing)||r.push({command:"setBearing",args:[e.bearing]}),ht(i.pitch,e.pitch)||r.push({command:"setPitch",args:[e.pitch]}),ht(i.sprite,e.sprite)||r.push({command:"setSprite",args:[e.sprite]}),ht(i.glyphs,e.glyphs)||r.push({command:"setGlyphs",args:[e.glyphs]}),ht(i.transition,e.transition)||r.push({command:"setTransition",args:[e.transition]}),ht(i.light,e.light)||r.push({command:"setLight",args:[e.light]}),ht(i.terrain,e.terrain)||r.push({command:"setTerrain",args:[e.terrain]}),ht(i.sky,e.sky)||r.push({command:"setSky",args:[e.sky]});const a={},u=[];(function(g,_,w,E){let C;for(C in _=_||{},g=g||{})Object.prototype.hasOwnProperty.call(g,C)&&(Object.prototype.hasOwnProperty.call(_,C)||Vn(C,w,E));for(C in _)Object.prototype.hasOwnProperty.call(_,C)&&(Object.prototype.hasOwnProperty.call(g,C)?ht(g[C],_[C])||(g[C].type==="geojson"&&_[C].type==="geojson"&&qn(g,_,C)?ui(w,{command:"setGeoJSONSourceData",args:[C,_[C].data]}):jn(C,_,w,E)):Tr(C,_,w))})(i.sources,e.sources,u,a);const m=[];i.layers&&i.layers.forEach(g=>{"source"in g&&a[g.source]?r.push({command:"removeLayer",args:[g.id]}):m.push(g)}),r=r.concat(u),function(g,_,w){_=_||[];const E=(g=g||[]).map(Gn),C=_.map(Gn),P=g.reduce(Is,{}),R=_.reduce(Is,{}),B=E.slice(),F=Object.create(null);let V,Z,Y,le,J;for(let se=0,ge=0;se<E.length;se++)V=E[se],Object.prototype.hasOwnProperty.call(R,V)?ge++:(ui(w,{command:"removeLayer",args:[V]}),B.splice(B.indexOf(V,ge),1));for(let se=0,ge=0;se<C.length;se++)V=C[C.length-1-se],B[B.length-1-se]!==V&&(Object.prototype.hasOwnProperty.call(P,V)?(ui(w,{command:"removeLayer",args:[V]}),B.splice(B.lastIndexOf(V,B.length-ge),1)):ge++,le=B[B.length-se],ui(w,{command:"addLayer",args:[R[V],le]}),B.splice(B.length-se,0,V),F[V]=!0);for(let se=0;se<C.length;se++)if(V=C[se],Z=P[V],Y=R[V],!F[V]&&!ht(Z,Y))if(ht(Z.source,Y.source)&&ht(Z["source-layer"],Y["source-layer"])&&ht(Z.type,Y.type)){for(J in _n(Z.layout,Y.layout,w,V,null,"setLayoutProperty"),_n(Z.paint,Y.paint,w,V,null,"setPaintProperty"),ht(Z.filter,Y.filter)||ui(w,{command:"setFilter",args:[V,Y.filter]}),ht(Z.minzoom,Y.minzoom)&&ht(Z.maxzoom,Y.maxzoom)||ui(w,{command:"setLayerZoomRange",args:[V,Y.minzoom,Y.maxzoom]}),Z)Object.prototype.hasOwnProperty.call(Z,J)&&J!=="layout"&&J!=="paint"&&J!=="filter"&&J!=="metadata"&&J!=="minzoom"&&J!=="maxzoom"&&(J.indexOf("paint.")===0?_n(Z[J],Y[J],w,V,J.slice(6),"setPaintProperty"):ht(Z[J],Y[J])||ui(w,{command:"setLayerProperty",args:[V,J,Y[J]]}));for(J in Y)Object.prototype.hasOwnProperty.call(Y,J)&&!Object.prototype.hasOwnProperty.call(Z,J)&&J!=="layout"&&J!=="paint"&&J!=="filter"&&J!=="metadata"&&J!=="minzoom"&&J!=="maxzoom"&&(J.indexOf("paint.")===0?_n(Z[J],Y[J],w,V,J.slice(6),"setPaintProperty"):ht(Z[J],Y[J])||ui(w,{command:"setLayerProperty",args:[V,J,Y[J]]}))}else ui(w,{command:"removeLayer",args:[V]}),le=B[B.lastIndexOf(V)+1],ui(w,{command:"addLayer",args:[Y,le]})}(m,e.layers,r)}catch(a){console.warn("Unable to compute style diff:",a),r=[{command:"setStyle",args:[e]}]}return r},x.aC=function(i){const e=[],r=i.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},x.aD=function i(e,r){if(Array.isArray(e)){if(!Array.isArray(r)||e.length!==r.length)return!1;for(let a=0;a<e.length;a++)if(!i(e[a],r[a]))return!1;return!0}if(typeof e=="object"&&e!==null&&r!==null){if(typeof r!="object"||Object.keys(e).length!==Object.keys(r).length)return!1;for(const a in e)if(!i(e[a],r[a]))return!1;return!0}return e===r},x.aE=Gr,x.aF=ta,x.aG=class extends It{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},x.aH=_i,x.aI=class extends It{constructor(i,e){super(i,e),this.current=Mn}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},x.aJ=fr,x.aK=class extends It{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},x.aL=class extends It{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},x.aM=Pr,x.aN=function(i,e,r,a,u,m,g){var _=1/(e-r),w=1/(a-u),E=1/(m-g);return i[0]=-2*_,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*w,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*E,i[11]=0,i[12]=(e+r)*_,i[13]=(u+a)*w,i[14]=(g+m)*E,i[15]=1,i},x.aO=vt,x.aP=xg,x.aQ=class extends Gs{},x.aR=py,x.aS=class extends cs{},x.aT=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},x.aU=Rd,x.aV=M,x.aW=class extends Oo{},x.aX=de,x.aY=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]&&i[4]===e[4]&&i[5]===e[5]&&i[6]===e[6]&&i[7]===e[7]&&i[8]===e[8]&&i[9]===e[9]&&i[10]===e[10]&&i[11]===e[11]&&i[12]===e[12]&&i[13]===e[13]&&i[14]===e[14]&&i[15]===e[15]},x.aZ=function(i,e){var r=i[0],a=i[1],u=i[2],m=i[3],g=i[4],_=i[5],w=i[6],E=i[7],C=i[8],P=i[9],R=i[10],B=i[11],F=i[12],V=i[13],Z=i[14],Y=i[15],le=e[0],J=e[1],se=e[2],ge=e[3],xe=e[4],Be=e[5],Ne=e[6],ze=e[7],Re=e[8],Ce=e[9],$e=e[10],De=e[11],Ee=e[12],Ge=e[13],Ve=e[14],ot=e[15];return Math.abs(r-le)<=Fi*Math.max(1,Math.abs(r),Math.abs(le))&&Math.abs(a-J)<=Fi*Math.max(1,Math.abs(a),Math.abs(J))&&Math.abs(u-se)<=Fi*Math.max(1,Math.abs(u),Math.abs(se))&&Math.abs(m-ge)<=Fi*Math.max(1,Math.abs(m),Math.abs(ge))&&Math.abs(g-xe)<=Fi*Math.max(1,Math.abs(g),Math.abs(xe))&&Math.abs(_-Be)<=Fi*Math.max(1,Math.abs(_),Math.abs(Be))&&Math.abs(w-Ne)<=Fi*Math.max(1,Math.abs(w),Math.abs(Ne))&&Math.abs(E-ze)<=Fi*Math.max(1,Math.abs(E),Math.abs(ze))&&Math.abs(C-Re)<=Fi*Math.max(1,Math.abs(C),Math.abs(Re))&&Math.abs(P-Ce)<=Fi*Math.max(1,Math.abs(P),Math.abs(Ce))&&Math.abs(R-$e)<=Fi*Math.max(1,Math.abs(R),Math.abs($e))&&Math.abs(B-De)<=Fi*Math.max(1,Math.abs(B),Math.abs(De))&&Math.abs(F-Ee)<=Fi*Math.max(1,Math.abs(F),Math.abs(Ee))&&Math.abs(V-Ge)<=Fi*Math.max(1,Math.abs(V),Math.abs(Ge))&&Math.abs(Z-Ve)<=Fi*Math.max(1,Math.abs(Z),Math.abs(Ve))&&Math.abs(Y-ot)<=Fi*Math.max(1,Math.abs(Y),Math.abs(ot))},x.a_=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},x.aa=function(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,a,u,m)=>{const g=u||m;return e[a]=!g||g.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e},x.ab=function(i,e){const r=[];for(const a in i)a in e||r.push(a);return r},x.ac=pi,x.ad=function(i,e,r){var a=Math.sin(r),u=Math.cos(r),m=e[0],g=e[1],_=e[2],w=e[3],E=e[4],C=e[5],P=e[6],R=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=m*u+E*a,i[1]=g*u+C*a,i[2]=_*u+P*a,i[3]=w*u+R*a,i[4]=E*u-m*a,i[5]=C*u-g*a,i[6]=P*u-_*a,i[7]=R*u-w*a,i},x.ae=function(i){var e=new Da(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},x.af=Ic,x.ag=function(i,e){let r=0,a=0;if(i.kind==="constant")a=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:u,minZoom:m,maxZoom:g}=i,_=u?pi(Si.interpolationFactor(u,e,m,g),0,1):0;i.kind==="camera"?a=Wi.number(i.minSize,i.maxSize,_):r=_}return{uSizeT:r,uSize:a}},x.ai=function(i,{uSize:e,uSizeT:r},{lowerSize:a,upperSize:u}){return i.kind==="source"?a/nn:i.kind==="composite"?Wi.number(a/nn,u/nn,r):e},x.aj=rh,x.ak=function(i,e,r,a){const u=e.y-i.y,m=e.x-i.x,g=a.y-r.y,_=a.x-r.x,w=g*m-_*u;if(w===0)return null;const E=(_*(i.y-r.y)-g*(i.x-r.x))/w;return new Q(i.x+E*m,i.y+E*u)},x.al=zp,x.am=zn,x.an=Lu,x.ao=ei,x.aq=ih,x.ar=function(i,e){var r=e[0],a=e[1],u=e[2],m=e[3],g=e[4],_=e[5],w=e[6],E=e[7],C=e[8],P=e[9],R=e[10],B=e[11],F=e[12],V=e[13],Z=e[14],Y=e[15],le=r*_-a*g,J=r*w-u*g,se=r*E-m*g,ge=a*w-u*_,xe=a*E-m*_,Be=u*E-m*w,Ne=C*V-P*F,ze=C*Z-R*F,Re=C*Y-B*F,Ce=P*Z-R*V,$e=P*Y-B*V,De=R*Y-B*Z,Ee=le*De-J*$e+se*Ce+ge*Re-xe*ze+Be*Ne;return Ee?(i[0]=(_*De-w*$e+E*Ce)*(Ee=1/Ee),i[1]=(u*$e-a*De-m*Ce)*Ee,i[2]=(V*Be-Z*xe+Y*ge)*Ee,i[3]=(R*xe-P*Be-B*ge)*Ee,i[4]=(w*Re-g*De-E*ze)*Ee,i[5]=(r*De-u*Re+m*ze)*Ee,i[6]=(Z*se-F*Be-Y*J)*Ee,i[7]=(C*Be-R*se+B*J)*Ee,i[8]=(g*$e-_*Re+E*Ne)*Ee,i[9]=(a*Re-r*$e-m*Ne)*Ee,i[10]=(F*xe-V*se+Y*le)*Ee,i[11]=(P*se-C*xe-B*le)*Ee,i[12]=(_*ze-g*Ce-w*Ne)*Ee,i[13]=(r*Ce-a*ze+u*Ne)*Ee,i[14]=(V*J-F*ge-Z*le)*Ee,i[15]=(C*ge-P*J+R*le)*Ee,i):null},x.as=hh,x.at=th,x.au=dh,x.av=function(){const i={},e=fe.$version;for(const r in fe.$root){const a=fe.$root[r];if(a.required){let u=null;u=r==="version"?e:a.type==="array"?[]:{},u!=null&&(i[r]=u)}}return i},x.aw=To,x.ax=Un,x.ay=function(i){i=i.slice();const e=Object.create(null);for(let r=0;r<i.length;r++)e[i[r].id]=i[r];for(let r=0;r<i.length;r++)"ref"in i[r]&&(i[r]=Es(i[r],e[i[r].ref]));return i},x.az=function(i){if(i.type==="custom")return new Oy(i);switch(i.type){case"background":return new By(i);case"circle":return new vg(i);case"fill":return new Ng(i);case"fill-extrusion":return new ty(i);case"heatmap":return new wg(i);case"hillshade":return new Tg(i);case"line":return new cy(i);case"raster":return new Fy(i);case"symbol":return new Fc(i)}},x.b=wr,x.b0=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]*e[3]},x.b1=ji,x.b2=Ip,x.b3=Ap,x.b4=function(i,e,r,a,u){var m,g=1/Math.tan(e/2);return i[0]=g/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=g,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,u!=null&&u!==1/0?(i[10]=(u+a)*(m=1/(a-u)),i[14]=2*u*a*m):(i[10]=-1,i[14]=-2*a),i},x.b5=function(i,e,r){var a=Math.sin(r),u=Math.cos(r),m=e[4],g=e[5],_=e[6],w=e[7],E=e[8],C=e[9],P=e[10],R=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=m*u+E*a,i[5]=g*u+C*a,i[6]=_*u+P*a,i[7]=w*u+R*a,i[8]=E*u-m*a,i[9]=C*u-g*a,i[10]=P*u-_*a,i[11]=R*u-w*a,i},x.b6=gt,x.b7=xt,x.b8=function(i){return i*Math.PI/180},x.b9=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},x.bA=In,x.ba=class extends Aa{},x.bb=oh,x.bc=Ky,x.be=ur,x.bf=function(i,e){mn.REGISTERED_PROTOCOLS[i]=e},x.bg=function(i){delete mn.REGISTERED_PROTOCOLS[i]},x.bh=function(i,e){const r={};for(let u=0;u<i.length;u++){const m=e&&e[i[u].id]||Ru(i[u]);e&&(e[i[u].id]=m);let g=r[m];g||(g=r[m]=[]),g.push(i[u])}const a=[];for(const u in r)a.push(r[u]);return a},x.bi=Oe,x.bj=Pp,x.bk=kp,x.bl=cp,x.bm=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=lt/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const e=i.bucket.layers[0],r=e.layout,a=e._unevaluatedLayout._values,u={layoutIconSize:a["icon-size"].possiblyEvaluate(new Pt(i.bucket.zoom+1),i.canonical),layoutTextSize:a["text-size"].possiblyEvaluate(new Pt(i.bucket.zoom+1),i.canonical),textMaxSize:a["text-size"].possiblyEvaluate(new Pt(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:E,maxZoom:C}=i.bucket.textSizeData;u.compositeTextSizes=[a["text-size"].possiblyEvaluate(new Pt(E),i.canonical),a["text-size"].possiblyEvaluate(new Pt(C),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:E,maxZoom:C}=i.bucket.iconSizeData;u.compositeIconSizes=[a["icon-size"].possiblyEvaluate(new Pt(E),i.canonical),a["icon-size"].possiblyEvaluate(new Pt(C),i.canonical)]}const m=r.get("text-line-height")*ei,g=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",_=r.get("text-keep-upright"),w=r.get("text-size");for(const E of i.bucket.features){const C=r.get("text-font").evaluate(E,{},i.canonical).join(","),P=w.evaluate(E,{},i.canonical),R=u.layoutTextSize.evaluate(E,{},i.canonical),B=u.layoutIconSize.evaluate(E,{},i.canonical),F={horizontal:{},vertical:void 0},V=E.text;let Z,Y=[0,0];if(V){const se=V.toString(),ge=r.get("text-letter-spacing").evaluate(E,{},i.canonical)*ei,xe=ba(se)?ge:0,Be=r.get("text-anchor").evaluate(E,{},i.canonical),Ne=jp(e,E,i.canonical);if(!Ne){const De=r.get("text-radial-offset").evaluate(E,{},i.canonical);Y=De?Vp(Be,[De*ei,uh]):r.get("text-offset").evaluate(E,{},i.canonical).map(Ee=>Ee*ei)}let ze=g?"center":r.get("text-justify").evaluate(E,{},i.canonical);const Re=r.get("symbol-placement"),Ce=Re==="point"?r.get("text-max-width").evaluate(E,{},i.canonical)*ei:0,$e=()=>{i.bucket.allowVerticalPlacement&&Ns(se)&&(F.vertical=zc(V,i.glyphMap,i.glyphPositions,i.imagePositions,C,Ce,m,Be,"left",xe,Y,x.ah.vertical,!0,Re,R,P))};if(!g&&Ne){const De=new Set;if(ze==="auto")for(let Ge=0;Ge<Ne.values.length;Ge+=2)De.add(hh(Ne.values[Ge]));else De.add(ze);let Ee=!1;for(const Ge of De)if(!F.horizontal[Ge])if(Ee)F.horizontal[Ge]=F.horizontal[0];else{const Ve=zc(V,i.glyphMap,i.glyphPositions,i.imagePositions,C,Ce,m,"center",Ge,xe,Y,x.ah.horizontal,!1,Re,R,P);Ve&&(F.horizontal[Ge]=Ve,Ee=Ve.positionedLines.length===1)}$e()}else{ze==="auto"&&(ze=hh(Be));const De=zc(V,i.glyphMap,i.glyphPositions,i.imagePositions,C,Ce,m,Be,ze,xe,Y,x.ah.horizontal,!1,Re,R,P);De&&(F.horizontal[ze]=De),$e(),Ns(se)&&g&&_&&(F.vertical=zc(V,i.glyphMap,i.glyphPositions,i.imagePositions,C,Ce,m,Be,ze,xe,Y,x.ah.vertical,!1,Re,R,P))}}let le=!1;if(E.icon&&E.icon.name){const se=i.imageMap[E.icon.name];se&&(Z=My(i.imagePositions[E.icon.name],r.get("icon-offset").evaluate(E,{},i.canonical),r.get("icon-anchor").evaluate(E,{},i.canonical)),le=!!se.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=le:i.bucket.sdfIcons!==le&&mi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(se.pixelRatio!==i.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const J=Gp(F.horizontal)||F.vertical;i.bucket.iconsInText=!!J&&J.iconsInText,(J||Z)&&Zy(i.bucket,E,F,Z,i.imageMap,u,R,B,Y,le,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},x.bn=Ku,x.bo=Hu,x.bp=Wu,x.bq=ds,x.br=Yu,x.bs=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},x.bt=function(i,e,r,a,u){return h(this,void 0,void 0,function*(){if(_t())try{return yield Hr(i,e,r,a,u)}catch{}return function(m,g,_,w,E){const C=m.width,P=m.height;Mi&&ki||(Mi=new OffscreenCanvas(C,P),ki=Mi.getContext("2d",{willReadFrequently:!0})),Mi.width=C,Mi.height=P,ki.drawImage(m,0,0,C,P);const R=ki.getImageData(g,_,w,E);return ki.clearRect(0,0,C,P),R.data}(i,e,r,a,u)})},x.bu=Cp,x.bv=K,x.bw=O,x.bx=ep,x.by=Tt,x.bz=function(i){return i.message===fn},x.c=Sr,x.d=i=>h(void 0,void 0,void 0,function*(){if(i.byteLength===0)return createImageBitmap(new ImageData(1,1));const e=new Blob([new Uint8Array(i)],{type:"image/png"});try{return createImageBitmap(e)}catch(r){throw new Error(`Could not load image because of ${r.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),x.e=fi,x.f=i=>new Promise((e,r)=>{const a=new Image;a.onload=()=>{e(a),URL.revokeObjectURL(a.src),a.onload=null,window.requestAnimationFrame(()=>{a.src=As})},a.onerror=()=>r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const u=new Blob([new Uint8Array(i)],{type:"image/png"});a.src=i.byteLength?URL.createObjectURL(u):As}),x.g=Br,x.h=(i,e)=>Zr(fi(i,{type:"json"}),e),x.i=zr,x.j=Qt,x.k=Xr,x.l=(i,e)=>Zr(fi(i,{type:"arrayBuffer"}),e),x.m=Zr,x.n=function(i){return new Yu(i).readFields(Ty,[])},x.o=Ho,x.p=lp,x.q=Bi,x.r=bo,x.s=ia,x.t=pc,x.u=Le,x.v=fe,x.w=mi,x.x=as,x.y=function([i,e,r]){return e+=90,e*=Math.PI/180,r*=Math.PI/180,{x:i*Math.cos(e)*Math.sin(r),y:i*Math.sin(e)*Math.sin(r),z:i*Math.cos(r)}},x.z=Wi}),T("worker",["./shared"],function(x){class h{constructor(D){this.keyCache={},D&&this.replace(D)}replace(D){this._layerConfigs={},this._layers={},this.update(D,[])}update(D,z){for(const j of D){this._layerConfigs[j.id]=j;const re=this._layers[j.id]=x.az(j);re._featureFilter=x.a6(re.filter),this.keyCache[j.id]&&delete this.keyCache[j.id]}for(const j of z)delete this.keyCache[j],delete this._layerConfigs[j],delete this._layers[j];this.familiesBySource={};const $=x.bh(Object.values(this._layerConfigs),this.keyCache);for(const j of $){const re=j.map(me=>this._layers[me.id]),ne=re[0];if(ne.visibility==="none")continue;const oe=ne.source||"";let ee=this.familiesBySource[oe];ee||(ee=this.familiesBySource[oe]={});const ce=ne.sourceLayer||"_geojsonTileLayer";let be=ee[ce];be||(be=ee[ce]=[]),be.push(re)}}}class K{constructor(D){const z={},$=[];for(const oe in D){const ee=D[oe],ce=z[oe]={};for(const be in ee){const me=ee[+be];if(!me||me.bitmap.width===0||me.bitmap.height===0)continue;const _e={x:0,y:0,w:me.bitmap.width+2,h:me.bitmap.height+2};$.push(_e),ce[be]={rect:_e,metrics:me.metrics}}}const{w:j,h:re}=x.p($),ne=new x.o({width:j||1,height:re||1});for(const oe in D){const ee=D[oe];for(const ce in ee){const be=ee[+ce];if(!be||be.bitmap.width===0||be.bitmap.height===0)continue;const me=z[oe][ce].rect;x.o.copy(be.bitmap,ne,{x:0,y:0},{x:me.x+1,y:me.y+1},be.bitmap)}}this.image=ne,this.positions=z}}x.bi("GlyphAtlas",K);class O{constructor(D){this.tileID=new x.Q(D.tileID.overscaledZ,D.tileID.wrap,D.tileID.canonical.z,D.tileID.canonical.x,D.tileID.canonical.y),this.uid=D.uid,this.zoom=D.zoom,this.pixelRatio=D.pixelRatio,this.tileSize=D.tileSize,this.source=D.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=D.showCollisionBoxes,this.collectResourceTiming=!!D.collectResourceTiming,this.returnDependencies=!!D.returnDependencies,this.promoteId=D.promoteId,this.inFlightDependencies=[]}parse(D,z,$,j){return x._(this,void 0,void 0,function*(){this.status="parsing",this.data=D,this.collisionBoxArray=new x.a4;const re=new x.bj(Object.keys(D.layers).sort()),ne=new x.bk(this.tileID,this.promoteId);ne.bucketLayerIDs=[];const oe={},ee={featureIndex:ne,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:$},ce=z.familiesBySource[this.source];for(const it in ce){const Ot=D.layers[it];if(!Ot)continue;Ot.version===1&&x.w(`Vector tile source "${this.source}" layer "${it}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const oi=re.encode(it),Ri=[];for(let gi=0;gi<Ot.length;gi++){const wi=Ot.feature(gi),Gi=ne.getId(wi,it);Ri.push({feature:wi,id:Gi,index:gi,sourceLayerIndex:oi})}for(const gi of ce[it]){const wi=gi[0];wi.source!==this.source&&x.w(`layer.source = ${wi.source} does not equal this.source = ${this.source}`),wi.minzoom&&this.zoom<Math.floor(wi.minzoom)||wi.maxzoom&&this.zoom>=wi.maxzoom||wi.visibility!=="none"&&(ie(gi,this.zoom,$),(oe[wi.id]=wi.createBucket({index:ne.bucketLayerIDs.length,layers:gi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:oi,sourceID:this.source})).populate(Ri,ee,this.tileID.canonical),ne.bucketLayerIDs.push(gi.map(Gi=>Gi.id)))}}const be=x.aE(ee.glyphDependencies,it=>Object.keys(it).map(Number));this.inFlightDependencies.forEach(it=>it==null?void 0:it.abort()),this.inFlightDependencies=[];let me=Promise.resolve({});if(Object.keys(be).length){const it=new AbortController;this.inFlightDependencies.push(it),me=j.sendAsync({type:"getGlyphs",data:{stacks:be,source:this.source,tileID:this.tileID,type:"glyphs"}},it)}const _e=Object.keys(ee.iconDependencies);let Ue=Promise.resolve({});if(_e.length){const it=new AbortController;this.inFlightDependencies.push(it),Ue=j.sendAsync({type:"getImages",data:{icons:_e,source:this.source,tileID:this.tileID,type:"icons"}},it)}const Ke=Object.keys(ee.patternDependencies);let Ze=Promise.resolve({});if(Ke.length){const it=new AbortController;this.inFlightDependencies.push(it),Ze=j.sendAsync({type:"getImages",data:{icons:Ke,source:this.source,tileID:this.tileID,type:"patterns"}},it)}const[dt,Je,Ct]=yield Promise.all([me,Ue,Ze]),St=new K(dt),Ht=new x.bl(Je,Ct);for(const it in oe){const Ot=oe[it];Ot instanceof x.a5?(ie(Ot.layers,this.zoom,$),x.bm({bucket:Ot,glyphMap:dt,glyphPositions:St.positions,imageMap:Je,imagePositions:Ht.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Ot.hasPattern&&(Ot instanceof x.bn||Ot instanceof x.bo||Ot instanceof x.bp)&&(ie(Ot.layers,this.zoom,$),Ot.addFeatures(ee,this.tileID.canonical,Ht.patternPositions))}return this.status="done",{buckets:Object.values(oe).filter(it=>!it.isEmpty()),featureIndex:ne,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:St.image,imageAtlas:Ht,glyphMap:this.returnDependencies?dt:null,iconMap:this.returnDependencies?Je:null,glyphPositions:this.returnDependencies?St.positions:null}})}}function ie(G,D,z){const $=new x.a8(D);for(const j of G)j.recalculate($,z)}class Q{constructor(D,z,$){this.actor=D,this.layerIndex=z,this.availableImages=$,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(D,z){return x._(this,void 0,void 0,function*(){const $=yield x.l(D.request,z);try{return{vectorTile:new x.bq.VectorTile(new x.br($.data)),rawData:$.data,cacheControl:$.cacheControl,expires:$.expires}}catch(j){const re=new Uint8Array($.data);let ne=`Unable to parse the tile at ${D.request.url}, `;throw ne+=re[0]===31&&re[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${j.messge}`,new Error(ne)}})}loadTile(D){return x._(this,void 0,void 0,function*(){const z=D.uid,$=!!(D&&D.request&&D.request.collectResourceTiming)&&new x.bs(D.request),j=new O(D);this.loading[z]=j;const re=new AbortController;j.abort=re;try{const ne=yield this.loadVectorTile(D,re);if(delete this.loading[z],!ne)return null;const oe=ne.rawData,ee={};ne.expires&&(ee.expires=ne.expires),ne.cacheControl&&(ee.cacheControl=ne.cacheControl);const ce={};if($){const me=$.finish();me&&(ce.resourceTiming=JSON.parse(JSON.stringify(me)))}j.vectorTile=ne.vectorTile;const be=j.parse(ne.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[z]=j,this.fetching[z]={rawTileData:oe,cacheControl:ee,resourceTiming:ce};try{const me=yield be;return x.e({rawTileData:oe.slice(0)},me,ee,ce)}finally{delete this.fetching[z]}}catch(ne){throw delete this.loading[z],j.status="done",this.loaded[z]=j,ne}})}reloadTile(D){return x._(this,void 0,void 0,function*(){const z=D.uid;if(!this.loaded||!this.loaded[z])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const $=this.loaded[z];if($.showCollisionBoxes=D.showCollisionBoxes,$.status==="parsing"){const j=yield $.parse($.vectorTile,this.layerIndex,this.availableImages,this.actor);let re;if(this.fetching[z]){const{rawTileData:ne,cacheControl:oe,resourceTiming:ee}=this.fetching[z];delete this.fetching[z],re=x.e({rawTileData:ne.slice(0)},j,oe,ee)}else re=j;return re}if($.status==="done"&&$.vectorTile)return $.parse($.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(D){return x._(this,void 0,void 0,function*(){const z=this.loading,$=D.uid;z&&z[$]&&z[$].abort&&(z[$].abort.abort(),delete z[$])})}removeTile(D){return x._(this,void 0,void 0,function*(){this.loaded&&this.loaded[D.uid]&&delete this.loaded[D.uid]})}}class U{constructor(){this.loaded={}}loadTile(D){return x._(this,void 0,void 0,function*(){const{uid:z,encoding:$,rawImageData:j,redFactor:re,greenFactor:ne,blueFactor:oe,baseShift:ee}=D,ce=j.width+2,be=j.height+2,me=x.b(j)?new x.R({width:ce,height:be},yield x.bt(j,-1,-1,ce,be)):j,_e=new x.bu(z,me,$,re,ne,oe,ee);return this.loaded=this.loaded||{},this.loaded[z]=_e,_e})}removeTile(D){const z=this.loaded,$=D.uid;z&&z[$]&&delete z[$]}}function ye(G,D){if(G.length!==0){Te(G[0],D);for(var z=1;z<G.length;z++)Te(G[z],!D)}}function Te(G,D){for(var z=0,$=0,j=0,re=G.length,ne=re-1;j<re;ne=j++){var oe=(G[j][0]-G[ne][0])*(G[ne][1]+G[j][1]),ee=z+oe;$+=Math.abs(z)>=Math.abs(oe)?z-ee+oe:oe-ee+z,z=ee}z+$>=0!=!!D&&G.reverse()}var Pe=x.bv(function G(D,z){var $,j=D&&D.type;if(j==="FeatureCollection")for($=0;$<D.features.length;$++)G(D.features[$],z);else if(j==="GeometryCollection")for($=0;$<D.geometries.length;$++)G(D.geometries[$],z);else if(j==="Feature")G(D.geometry,z);else if(j==="Polygon")ye(D.coordinates,z);else if(j==="MultiPolygon")for($=0;$<D.coordinates.length;$++)ye(D.coordinates[$],z);return D});const qe=x.bq.VectorTileFeature.prototype.toGeoJSON;var Ye={exports:{}},_t=x.bw,gt=x.bq.VectorTileFeature,xt=pi;function pi(G,D){this.options=D||{},this.features=G,this.length=G.length}function ji(G,D){this.id=typeof G.id=="number"?G.id:void 0,this.type=G.type,this.rawGeometry=G.type===1?[G.geometry]:G.geometry,this.properties=G.tags,this.extent=D||4096}pi.prototype.feature=function(G){return new ji(this.features[G],this.options.extent)},ji.prototype.loadGeometry=function(){var G=this.rawGeometry;this.geometry=[];for(var D=0;D<G.length;D++){for(var z=G[D],$=[],j=0;j<z.length;j++)$.push(new _t(z[j][0],z[j][1]));this.geometry.push($)}return this.geometry},ji.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var G=this.geometry,D=1/0,z=-1/0,$=1/0,j=-1/0,re=0;re<G.length;re++)for(var ne=G[re],oe=0;oe<ne.length;oe++){var ee=ne[oe];D=Math.min(D,ee.x),z=Math.max(z,ee.x),$=Math.min($,ee.y),j=Math.max(j,ee.y)}return[D,$,z,j]},ji.prototype.toGeoJSON=gt.prototype.toGeoJSON;var fi=x.bx,dn=xt;function Gr(G){var D=new fi;return function(z,$){for(var j in z.layers)$.writeMessage(3,ta,z.layers[j])}(G,D),D.finish()}function ta(G,D){var z;D.writeVarintField(15,G.version||1),D.writeStringField(1,G.name||""),D.writeVarintField(5,G.extent||4096);var $={keys:[],values:[],keycache:{},valuecache:{}};for(z=0;z<G.length;z++)$.feature=G.feature(z),D.writeMessage(2,Pi,$);var j=$.keys;for(z=0;z<j.length;z++)D.writeStringField(3,j[z]);var re=$.values;for(z=0;z<re.length;z++)D.writeMessage(4,zr,re[z])}function Pi(G,D){var z=G.feature;z.id!==void 0&&D.writeVarintField(1,z.id),D.writeMessage(2,Ut,G),D.writeVarintField(3,z.type),D.writeMessage(4,pn,z)}function Ut(G,D){var z=G.feature,$=G.keys,j=G.values,re=G.keycache,ne=G.valuecache;for(var oe in z.properties){var ee=z.properties[oe],ce=re[oe];if(ee!==null){ce===void 0&&($.push(oe),re[oe]=ce=$.length-1),D.writeVarint(ce);var be=typeof ee;be!=="string"&&be!=="boolean"&&be!=="number"&&(ee=JSON.stringify(ee));var me=be+":"+ee,_e=ne[me];_e===void 0&&(j.push(ee),ne[me]=_e=j.length-1),D.writeVarint(_e)}}}function mi(G,D){return(D<<3)+(7&G)}function lr(G){return G<<1^G>>31}function pn(G,D){for(var z=G.loadGeometry(),$=G.type,j=0,re=0,ne=z.length,oe=0;oe<ne;oe++){var ee=z[oe],ce=1;$===1&&(ce=ee.length),D.writeVarint(mi(1,ce));for(var be=$===3?ee.length-1:ee.length,me=0;me<be;me++){me===1&&$!==1&&D.writeVarint(mi(2,be-1));var _e=ee[me].x-j,Ue=ee[me].y-re;D.writeVarint(lr(_e)),D.writeVarint(lr(Ue)),j+=_e,re+=Ue}$===3&&D.writeVarint(mi(7,1))}}function zr(G,D){var z=typeof G;z==="string"?D.writeStringField(1,G):z==="boolean"?D.writeBooleanField(7,G):z==="number"&&(G%1!=0?D.writeDoubleField(3,G):G<0?D.writeSVarintField(6,G):D.writeVarintField(5,G))}Ye.exports=Gr,Ye.exports.fromVectorTileJs=Gr,Ye.exports.fromGeojsonVt=function(G,D){D=D||{};var z={};for(var $ in G)z[$]=new dn(G[$].features,D),z[$].name=$,z[$].version=D.version,z[$].extent=D.extent;return Gr({layers:z})},Ye.exports.GeoJSONWrapper=dn;var Nn=x.bv(Ye.exports);const wr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:G=>G},As=Math.fround||(Hr=new Float32Array(1),G=>(Hr[0]=+G,Hr[0]));var Hr;const Mi=3,ki=5,fn=6;class Sr{constructor(D){this.options=Object.assign(Object.create(wr),D),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(D){const{log:z,minZoom:$,maxZoom:j}=this.options;z&&console.time("total time");const re=`prepare ${D.length} points`;z&&console.time(re),this.points=D;const ne=[];for(let ee=0;ee<D.length;ee++){const ce=D[ee];if(!ce.geometry)continue;const[be,me]=ce.geometry.coordinates,_e=As(cr(be)),Ue=As(ur(me));ne.push(_e,Ue,1/0,ee,-1,1),this.options.reduce&&ne.push(0)}let oe=this.trees[j+1]=this._createTree(ne);z&&console.timeEnd(re);for(let ee=j;ee>=$;ee--){const ce=+Date.now();oe=this.trees[ee]=this._createTree(this._cluster(oe,ee)),z&&console.log("z%d: %d clusters in %dms",ee,oe.numItems,+Date.now()-ce)}return z&&console.timeEnd("total time"),this}getClusters(D,z){let $=((D[0]+180)%360+360)%360-180;const j=Math.max(-90,Math.min(90,D[1]));let re=D[2]===180?180:((D[2]+180)%360+360)%360-180;const ne=Math.max(-90,Math.min(90,D[3]));if(D[2]-D[0]>=360)$=-180,re=180;else if($>re){const me=this.getClusters([$,j,180,ne],z),_e=this.getClusters([-180,j,re,ne],z);return me.concat(_e)}const oe=this.trees[this._limitZoom(z)],ee=oe.range(cr($),ur(ne),cr(re),ur(j)),ce=oe.data,be=[];for(const me of ee){const _e=this.stride*me;be.push(ce[_e+ki]>1?mn(ce,_e,this.clusterProps):this.points[ce[_e+Mi]])}return be}getChildren(D){const z=this._getOriginId(D),$=this._getOriginZoom(D),j="No cluster with the specified id.",re=this.trees[$];if(!re)throw new Error(j);const ne=re.data;if(z*this.stride>=ne.length)throw new Error(j);const oe=this.options.radius/(this.options.extent*Math.pow(2,$-1)),ee=re.within(ne[z*this.stride],ne[z*this.stride+1],oe),ce=[];for(const be of ee){const me=be*this.stride;ne[me+4]===D&&ce.push(ne[me+ki]>1?mn(ne,me,this.clusterProps):this.points[ne[me+Mi]])}if(ce.length===0)throw new Error(j);return ce}getLeaves(D,z,$){const j=[];return this._appendLeaves(j,D,z=z||10,$=$||0,0),j}getTile(D,z,$){const j=this.trees[this._limitZoom(D)],re=Math.pow(2,D),{extent:ne,radius:oe}=this.options,ee=oe/ne,ce=($-ee)/re,be=($+1+ee)/re,me={features:[]};return this._addTileFeatures(j.range((z-ee)/re,ce,(z+1+ee)/re,be),j.data,z,$,re,me),z===0&&this._addTileFeatures(j.range(1-ee/re,ce,1,be),j.data,re,$,re,me),z===re-1&&this._addTileFeatures(j.range(0,ce,ee/re,be),j.data,-1,$,re,me),me.features.length?me:null}getClusterExpansionZoom(D){let z=this._getOriginZoom(D)-1;for(;z<=this.options.maxZoom;){const $=this.getChildren(D);if(z++,$.length!==1)break;D=$[0].properties.cluster_id}return z}_appendLeaves(D,z,$,j,re){const ne=this.getChildren(z);for(const oe of ne){const ee=oe.properties;if(ee&&ee.cluster?re+ee.point_count<=j?re+=ee.point_count:re=this._appendLeaves(D,ee.cluster_id,$,j,re):re<j?re++:D.push(oe),D.length===$)break}return re}_createTree(D){const z=new x.au(D.length/this.stride|0,this.options.nodeSize,Float32Array);for(let $=0;$<D.length;$+=this.stride)z.add(D[$],D[$+1]);return z.finish(),z.data=D,z}_addTileFeatures(D,z,$,j,re,ne){for(const oe of D){const ee=oe*this.stride,ce=z[ee+ki]>1;let be,me,_e;if(ce)be=Br(z,ee,this.clusterProps),me=z[ee],_e=z[ee+1];else{const Ze=this.points[z[ee+Mi]];be=Ze.properties;const[dt,Je]=Ze.geometry.coordinates;me=cr(dt),_e=ur(Je)}const Ue={type:1,geometry:[[Math.round(this.options.extent*(me*re-$)),Math.round(this.options.extent*(_e*re-j))]],tags:be};let Ke;Ke=ce||this.options.generateId?z[ee+Mi]:this.points[z[ee+Mi]].id,Ke!==void 0&&(Ue.id=Ke),ne.features.push(Ue)}}_limitZoom(D){return Math.max(this.options.minZoom,Math.min(Math.floor(+D),this.options.maxZoom+1))}_cluster(D,z){const{radius:$,extent:j,reduce:re,minPoints:ne}=this.options,oe=$/(j*Math.pow(2,z)),ee=D.data,ce=[],be=this.stride;for(let me=0;me<ee.length;me+=be){if(ee[me+2]<=z)continue;ee[me+2]=z;const _e=ee[me],Ue=ee[me+1],Ke=D.within(ee[me],ee[me+1],oe),Ze=ee[me+ki];let dt=Ze;for(const Je of Ke){const Ct=Je*be;ee[Ct+2]>z&&(dt+=ee[Ct+ki])}if(dt>Ze&&dt>=ne){let Je,Ct=_e*Ze,St=Ue*Ze,Ht=-1;const it=((me/be|0)<<5)+(z+1)+this.points.length;for(const Ot of Ke){const oi=Ot*be;if(ee[oi+2]<=z)continue;ee[oi+2]=z;const Ri=ee[oi+ki];Ct+=ee[oi]*Ri,St+=ee[oi+1]*Ri,ee[oi+4]=it,re&&(Je||(Je=this._map(ee,me,!0),Ht=this.clusterProps.length,this.clusterProps.push(Je)),re(Je,this._map(ee,oi)))}ee[me+4]=it,ce.push(Ct/dt,St/dt,1/0,it,-1,dt),re&&ce.push(Ht)}else{for(let Je=0;Je<be;Je++)ce.push(ee[me+Je]);if(dt>1)for(const Je of Ke){const Ct=Je*be;if(!(ee[Ct+2]<=z)){ee[Ct+2]=z;for(let St=0;St<be;St++)ce.push(ee[Ct+St])}}}}return ce}_getOriginId(D){return D-this.points.length>>5}_getOriginZoom(D){return(D-this.points.length)%32}_map(D,z,$){if(D[z+ki]>1){const ne=this.clusterProps[D[z+fn]];return $?Object.assign({},ne):ne}const j=this.points[D[z+Mi]].properties,re=this.options.map(j);return $&&re===j?Object.assign({},re):re}}function mn(G,D,z){return{type:"Feature",id:G[D+Mi],properties:Br(G,D,z),geometry:{type:"Point",coordinates:[($=G[D],360*($-.5)),Un(G[D+1])]}};var $}function Br(G,D,z){const $=G[D+ki],j=$>=1e4?`${Math.round($/1e3)}k`:$>=1e3?Math.round($/100)/10+"k":$,re=G[D+fn],ne=re===-1?{}:Object.assign({},z[re]);return Object.assign(ne,{cluster:!0,cluster_id:G[D+Mi],point_count:$,point_count_abbreviated:j})}function cr(G){return G/360+.5}function ur(G){const D=Math.sin(G*Math.PI/180),z=.5-.25*Math.log((1+D)/(1-D))/Math.PI;return z<0?0:z>1?1:z}function Un(G){const D=(180-360*G)*Math.PI/180;return 360*Math.atan(Math.exp(D))/Math.PI-90}function Zr(G,D,z,$){for(var j,re=$,ne=z-D>>1,oe=z-D,ee=G[D],ce=G[D+1],be=G[z],me=G[z+1],_e=D+3;_e<z;_e+=3){var Ue=ia(G[_e],G[_e+1],ee,ce,be,me);if(Ue>re)j=_e,re=Ue;else if(Ue===re){var Ke=Math.abs(_e-ne);Ke<oe&&(j=_e,oe=Ke)}}re>$&&(j-D>3&&Zr(G,D,j,$),G[j+2]=re,z-j>3&&Zr(G,j,z,$))}function ia(G,D,z,$,j,re){var ne=j-z,oe=re-$;if(ne!==0||oe!==0){var ee=((G-z)*ne+(D-$)*oe)/(ne*ne+oe*oe);ee>1?(z=j,$=re):ee>0&&(z+=ne*ee,$+=oe*ee)}return(ne=G-z)*ne+(oe=D-$)*oe}function Wr(G,D,z,$){var j={id:G===void 0?null:G,type:D,geometry:z,tags:$,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(re){var ne=re.geometry,oe=re.type;if(oe==="Point"||oe==="MultiPoint"||oe==="LineString")Kr(re,ne);else if(oe==="Polygon"||oe==="MultiLineString")for(var ee=0;ee<ne.length;ee++)Kr(re,ne[ee]);else if(oe==="MultiPolygon")for(ee=0;ee<ne.length;ee++)for(var ce=0;ce<ne[ee].length;ce++)Kr(re,ne[ee][ce])}(j),j}function Kr(G,D){for(var z=0;z<D.length;z+=3)G.minX=Math.min(G.minX,D[z]),G.minY=Math.min(G.minY,D[z+1]),G.maxX=Math.max(G.maxX,D[z]),G.maxY=Math.max(G.maxY,D[z+1])}function Xr(G,D,z,$){if(D.geometry){var j=D.geometry.coordinates,re=D.geometry.type,ne=Math.pow(z.tolerance/((1<<z.maxZoom)*z.extent),2),oe=[],ee=D.id;if(z.promoteId?ee=D.properties[z.promoteId]:z.generateId&&(ee=$||0),re==="Point")Qt(j,oe);else if(re==="MultiPoint")for(var ce=0;ce<j.length;ce++)Qt(j[ce],oe);else if(re==="LineString")gn(j,oe,ne,!1);else if(re==="MultiLineString"){if(z.lineMetrics){for(ce=0;ce<j.length;ce++)gn(j[ce],oe=[],ne,!1),G.push(Wr(ee,"LineString",oe,D.properties));return}fe(j,oe,ne,!1)}else if(re==="Polygon")fe(j,oe,ne,!0);else{if(re!=="MultiPolygon"){if(re==="GeometryCollection"){for(ce=0;ce<D.geometry.geometries.length;ce++)Xr(G,{id:ee,geometry:D.geometry.geometries[ce],properties:D.properties},z,$);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ce=0;ce<j.length;ce++){var be=[];fe(j[ce],be,ne,!0),oe.push(be)}}G.push(Wr(ee,re,oe,D.properties))}}function Qt(G,D){D.push(yn(G[0])),D.push(Es(G[1])),D.push(0)}function gn(G,D,z,$){for(var j,re,ne=0,oe=0;oe<G.length;oe++){var ee=yn(G[oe][0]),ce=Es(G[oe][1]);D.push(ee),D.push(ce),D.push(0),oe>0&&(ne+=$?(j*ce-ee*re)/2:Math.sqrt(Math.pow(ee-j,2)+Math.pow(ce-re,2))),j=ee,re=ce}var be=D.length-3;D[2]=1,Zr(D,0,be,z),D[be+2]=1,D.size=Math.abs(ne),D.start=0,D.end=D.size}function fe(G,D,z,$){for(var j=0;j<G.length;j++){var re=[];gn(G[j],re,z,$),D.push(re)}}function yn(G){return G/360+.5}function Es(G){var D=Math.sin(G*Math.PI/180),z=.5-.25*Math.log((1+D)/(1-D))/Math.PI;return z<0?0:z>1?1:z}function ht(G,D,z,$,j,re,ne,oe){if($/=D,re>=(z/=D)&&ne<$)return G;if(ne<z||re>=$)return null;for(var ee=[],ce=0;ce<G.length;ce++){var be=G[ce],me=be.geometry,_e=be.type,Ue=j===0?be.minX:be.minY,Ke=j===0?be.maxX:be.maxY;if(Ue>=z&&Ke<$)ee.push(be);else if(!(Ke<z||Ue>=$)){var Ze=[];if(_e==="Point"||_e==="MultiPoint")ui(me,Ze,z,$,j);else if(_e==="LineString")Tr(me,Ze,z,$,j,!1,oe.lineMetrics);else if(_e==="MultiLineString")jn(me,Ze,z,$,j,!1);else if(_e==="Polygon")jn(me,Ze,z,$,j,!0);else if(_e==="MultiPolygon")for(var dt=0;dt<me.length;dt++){var Je=[];jn(me[dt],Je,z,$,j,!0),Je.length&&Ze.push(Je)}if(Ze.length){if(oe.lineMetrics&&_e==="LineString"){for(dt=0;dt<Ze.length;dt++)ee.push(Wr(be.id,_e,Ze[dt],be.tags));continue}_e!=="LineString"&&_e!=="MultiLineString"||(Ze.length===1?(_e="LineString",Ze=Ze[0]):_e="MultiLineString"),_e!=="Point"&&_e!=="MultiPoint"||(_e=Ze.length===3?"Point":"MultiPoint"),ee.push(Wr(be.id,_e,Ze,be.tags))}}}return ee.length?ee:null}function ui(G,D,z,$,j){for(var re=0;re<G.length;re+=3){var ne=G[re+j];ne>=z&&ne<=$&&(D.push(G[re]),D.push(G[re+1]),D.push(G[re+2]))}}function Tr(G,D,z,$,j,re,ne){for(var oe,ee,ce=Vn(G),be=j===0?_n:Gn,me=G.start,_e=0;_e<G.length-3;_e+=3){var Ue=G[_e],Ke=G[_e+1],Ze=G[_e+2],dt=G[_e+3],Je=G[_e+4],Ct=j===0?Ue:Ke,St=j===0?dt:Je,Ht=!1;ne&&(oe=Math.sqrt(Math.pow(Ue-dt,2)+Math.pow(Ke-Je,2))),Ct<z?St>z&&(ee=be(ce,Ue,Ke,dt,Je,z),ne&&(ce.start=me+oe*ee)):Ct>$?St<$&&(ee=be(ce,Ue,Ke,dt,Je,$),ne&&(ce.start=me+oe*ee)):qn(ce,Ue,Ke,Ze),St<z&&Ct>=z&&(ee=be(ce,Ue,Ke,dt,Je,z),Ht=!0),St>$&&Ct<=$&&(ee=be(ce,Ue,Ke,dt,Je,$),Ht=!0),!re&&Ht&&(ne&&(ce.end=me+oe*ee),D.push(ce),ce=Vn(G)),ne&&(me+=oe)}var it=G.length-3;Ue=G[it],Ke=G[it+1],Ze=G[it+2],(Ct=j===0?Ue:Ke)>=z&&Ct<=$&&qn(ce,Ue,Ke,Ze),it=ce.length-3,re&&it>=3&&(ce[it]!==ce[0]||ce[it+1]!==ce[1])&&qn(ce,ce[0],ce[1],ce[2]),ce.length&&D.push(ce)}function Vn(G){var D=[];return D.size=G.size,D.start=G.start,D.end=G.end,D}function jn(G,D,z,$,j,re){for(var ne=0;ne<G.length;ne++)Tr(G[ne],D,z,$,j,re,!1)}function qn(G,D,z,$){G.push(D),G.push(z),G.push($)}function _n(G,D,z,$,j,re){var ne=(re-D)/($-D);return G.push(re),G.push(z+(j-z)*ne),G.push(1),ne}function Gn(G,D,z,$,j,re){var ne=(re-z)/(j-z);return G.push(D+($-D)*ne),G.push(re),G.push(1),ne}function Is(G,D){for(var z=[],$=0;$<G.length;$++){var j,re=G[$],ne=re.type;if(ne==="Point"||ne==="MultiPoint"||ne==="LineString")j=Me(re.geometry,D);else if(ne==="MultiLineString"||ne==="Polygon"){j=[];for(var oe=0;oe<re.geometry.length;oe++)j.push(Me(re.geometry[oe],D))}else if(ne==="MultiPolygon")for(j=[],oe=0;oe<re.geometry.length;oe++){for(var ee=[],ce=0;ce<re.geometry[oe].length;ce++)ee.push(Me(re.geometry[oe][ce],D));j.push(ee)}z.push(Wr(re.id,ne,j,re.tags))}return z}function Me(G,D){var z=[];z.size=G.size,G.start!==void 0&&(z.start=G.start,z.end=G.end);for(var $=0;$<G.length;$+=3)z.push(G[$]+D,G[$+1],G[$+2]);return z}function qi(G,D){if(G.transformed)return G;var z,$,j,re=1<<G.z,ne=G.x,oe=G.y;for(z=0;z<G.features.length;z++){var ee=G.features[z],ce=ee.geometry,be=ee.type;if(ee.geometry=[],be===1)for($=0;$<ce.length;$+=2)ee.geometry.push(Di(ce[$],ce[$+1],D,re,ne,oe));else for($=0;$<ce.length;$++){var me=[];for(j=0;j<ce[$].length;j+=2)me.push(Di(ce[$][j],ce[$][j+1],D,re,ne,oe));ee.geometry.push(me)}}return G.transformed=!0,G}function Di(G,D,z,$,j,re){return[Math.round(z*(G*$-j)),Math.round(z*(D*$-re))]}function Cs(G,D,z,$,j){for(var re=D===j.maxZoom?0:j.tolerance/((1<<D)*j.extent),ne={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:z,y:$,z:D,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},oe=0;oe<G.length;oe++){ne.numFeatures++,xn(ne,G[oe],re,j);var ee=G[oe].minX,ce=G[oe].minY,be=G[oe].maxX,me=G[oe].maxY;ee<ne.minX&&(ne.minX=ee),ce<ne.minY&&(ne.minY=ce),be>ne.maxX&&(ne.maxX=be),me>ne.maxY&&(ne.maxY=me)}return ne}function xn(G,D,z,$){var j=D.geometry,re=D.type,ne=[];if(re==="Point"||re==="MultiPoint")for(var oe=0;oe<j.length;oe+=3)ne.push(j[oe]),ne.push(j[oe+1]),G.numPoints++,G.numSimplified++;else if(re==="LineString")Ie(ne,j,G,z,!1,!1);else if(re==="MultiLineString"||re==="Polygon")for(oe=0;oe<j.length;oe++)Ie(ne,j[oe],G,z,re==="Polygon",oe===0);else if(re==="MultiPolygon")for(var ee=0;ee<j.length;ee++){var ce=j[ee];for(oe=0;oe<ce.length;oe++)Ie(ne,ce[oe],G,z,!0,oe===0)}if(ne.length){var be=D.tags||null;if(re==="LineString"&&$.lineMetrics){for(var me in be={},D.tags)be[me]=D.tags[me];be.mapbox_clip_start=j.start/j.size,be.mapbox_clip_end=j.end/j.size}var _e={geometry:ne,type:re==="Polygon"||re==="MultiPolygon"?3:re==="LineString"||re==="MultiLineString"?2:1,tags:be};D.id!==null&&(_e.id=D.id),G.features.push(_e)}}function Ie(G,D,z,$,j,re){var ne=$*$;if($>0&&D.size<(j?ne:$))z.numPoints+=D.length/3;else{for(var oe=[],ee=0;ee<D.length;ee+=3)($===0||D[ee+2]>ne)&&(z.numSimplified++,oe.push(D[ee]),oe.push(D[ee+1])),z.numPoints++;j&&function(ce,be){for(var me=0,_e=0,Ue=ce.length,Ke=Ue-2;_e<Ue;Ke=_e,_e+=2)me+=(ce[_e]-ce[Ke])*(ce[_e+1]+ce[Ke+1]);if(me>0===be)for(_e=0,Ue=ce.length;_e<Ue/2;_e+=2){var Ze=ce[_e],dt=ce[_e+1];ce[_e]=ce[Ue-2-_e],ce[_e+1]=ce[Ue-1-_e],ce[Ue-2-_e]=Ze,ce[Ue-1-_e]=dt}}(oe,re),G.push(oe)}}function nt(G,D){var z=(D=this.options=function(j,re){for(var ne in re)j[ne]=re[ne];return j}(Object.create(this.options),D)).debug;if(z&&console.time("preprocess data"),D.maxZoom<0||D.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(D.promoteId&&D.generateId)throw new Error("promoteId and generateId cannot be used together.");var $=function(j,re){var ne=[];if(j.type==="FeatureCollection")for(var oe=0;oe<j.features.length;oe++)Xr(ne,j.features[oe],re,oe);else Xr(ne,j.type==="Feature"?j:{geometry:j},re);return ne}(G,D);this.tiles={},this.tileCoords=[],z&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",D.indexMaxZoom,D.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),$=function(j,re){var ne=re.buffer/re.extent,oe=j,ee=ht(j,1,-1-ne,ne,0,-1,2,re),ce=ht(j,1,1-ne,2+ne,0,-1,2,re);return(ee||ce)&&(oe=ht(j,1,-ne,1+ne,0,-1,2,re)||[],ee&&(oe=Is(ee,1).concat(oe)),ce&&(oe=oe.concat(Is(ce,-1)))),oe}($,D),$.length&&this.splitTile($,0,0,0),z&&($.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function et(G,D,z){return 32*((1<<G)*z+D)+G}function hi(G,D){return D?G.properties[D]:G.id}function rr(G,D){if(G==null)return!0;if(G.type==="Feature")return hi(G,D)!=null;if(G.type==="FeatureCollection"){const z=new Set;for(const $ of G.features){const j=hi($,D);if(j==null||z.has(j))return!1;z.add(j)}return!0}return!1}function tt(G,D){const z=new Map;if(G!=null)if(G.type==="Feature")z.set(hi(G,D),G);else for(const $ of G.features)z.set(hi($,D),$);return z}nt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},nt.prototype.splitTile=function(G,D,z,$,j,re,ne){for(var oe=[G,D,z,$],ee=this.options,ce=ee.debug;oe.length;){$=oe.pop(),z=oe.pop(),D=oe.pop(),G=oe.pop();var be=1<<D,me=et(D,z,$),_e=this.tiles[me];if(!_e&&(ce>1&&console.time("creation"),_e=this.tiles[me]=Cs(G,D,z,$,ee),this.tileCoords.push({z:D,x:z,y:$}),ce)){ce>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",D,z,$,_e.numFeatures,_e.numPoints,_e.numSimplified),console.timeEnd("creation"));var Ue="z"+D;this.stats[Ue]=(this.stats[Ue]||0)+1,this.total++}if(_e.source=G,j){if(D===ee.maxZoom||D===j)continue;var Ke=1<<j-D;if(z!==Math.floor(re/Ke)||$!==Math.floor(ne/Ke))continue}else if(D===ee.indexMaxZoom||_e.numPoints<=ee.indexMaxPoints)continue;if(_e.source=null,G.length!==0){ce>1&&console.time("clipping");var Ze,dt,Je,Ct,St,Ht,it=.5*ee.buffer/ee.extent,Ot=.5-it,oi=.5+it,Ri=1+it;Ze=dt=Je=Ct=null,St=ht(G,be,z-it,z+oi,0,_e.minX,_e.maxX,ee),Ht=ht(G,be,z+Ot,z+Ri,0,_e.minX,_e.maxX,ee),G=null,St&&(Ze=ht(St,be,$-it,$+oi,1,_e.minY,_e.maxY,ee),dt=ht(St,be,$+Ot,$+Ri,1,_e.minY,_e.maxY,ee),St=null),Ht&&(Je=ht(Ht,be,$-it,$+oi,1,_e.minY,_e.maxY,ee),Ct=ht(Ht,be,$+Ot,$+Ri,1,_e.minY,_e.maxY,ee),Ht=null),ce>1&&console.timeEnd("clipping"),oe.push(Ze||[],D+1,2*z,2*$),oe.push(dt||[],D+1,2*z,2*$+1),oe.push(Je||[],D+1,2*z+1,2*$),oe.push(Ct||[],D+1,2*z+1,2*$+1)}}},nt.prototype.getTile=function(G,D,z){var $=this.options,j=$.extent,re=$.debug;if(G<0||G>24)return null;var ne=1<<G,oe=et(G,D=(D%ne+ne)%ne,z);if(this.tiles[oe])return qi(this.tiles[oe],j);re>1&&console.log("drilling down to z%d-%d-%d",G,D,z);for(var ee,ce=G,be=D,me=z;!ee&&ce>0;)ce--,be=Math.floor(be/2),me=Math.floor(me/2),ee=this.tiles[et(ce,be,me)];return ee&&ee.source?(re>1&&console.log("found parent tile z%d-%d-%d",ce,be,me),re>1&&console.time("drilling down"),this.splitTile(ee.source,ce,be,me,G,D,z),re>1&&console.timeEnd("drilling down"),this.tiles[oe]?qi(this.tiles[oe],j):null):null};class Yr extends Q{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(D,z){return x._(this,void 0,void 0,function*(){const $=D.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const j=this._geoJSONIndex.getTile($.z,$.x,$.y);if(!j)return null;const re=new class{constructor(oe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=x.W,this.length=oe.length,this._features=oe}feature(oe){return new class{constructor(ee){this._feature=ee,this.extent=x.W,this.type=ee.type,this.properties=ee.tags,"id"in ee&&!isNaN(ee.id)&&(this.id=parseInt(ee.id,10))}loadGeometry(){if(this._feature.type===1){const ee=[];for(const ce of this._feature.geometry)ee.push([new x.P(ce[0],ce[1])]);return ee}{const ee=[];for(const ce of this._feature.geometry){const be=[];for(const me of ce)be.push(new x.P(me[0],me[1]));ee.push(be)}return ee}}toGeoJSON(ee,ce,be){return qe.call(this,ee,ce,be)}}(this._features[oe])}}(j.features);let ne=Nn(re);return ne.byteOffset===0&&ne.byteLength===ne.buffer.byteLength||(ne=new Uint8Array(ne)),{vectorTile:re,rawData:ne.buffer}})}loadData(D){return x._(this,void 0,void 0,function*(){var z;(z=this._pendingRequest)===null||z===void 0||z.abort();const $=!!(D&&D.request&&D.request.collectResourceTiming)&&new x.bs(D.request);this._pendingRequest=new AbortController;try{let j=yield this.loadGeoJSON(D,this._pendingRequest);if(delete this._pendingRequest,typeof j!="object")throw new Error(`Input data given to '${D.source}' is not a valid GeoJSON object.`);if(Pe(j,!0),D.filter){const ne=x.by(D.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ne.result==="error")throw new Error(ne.value.map(ee=>`${ee.key}: ${ee.message}`).join(", "));j={type:"FeatureCollection",features:j.features.filter(ee=>ne.value.evaluate({zoom:0},ee))}}this._geoJSONIndex=D.cluster?new Sr(function({superclusterOptions:ne,clusterProperties:oe}){if(!oe||!ne)return ne;const ee={},ce={},be={accumulated:null,zoom:0},me={properties:null},_e=Object.keys(oe);for(const Ue of _e){const[Ke,Ze]=oe[Ue],dt=x.by(Ze),Je=x.by(typeof Ke=="string"?[Ke,["accumulated"],["get",Ue]]:Ke);ee[Ue]=dt.value,ce[Ue]=Je.value}return ne.map=Ue=>{me.properties=Ue;const Ke={};for(const Ze of _e)Ke[Ze]=ee[Ze].evaluate(be,me);return Ke},ne.reduce=(Ue,Ke)=>{me.properties=Ke;for(const Ze of _e)be.accumulated=Ue[Ze],Ue[Ze]=ce[Ze].evaluate(be,me)},ne}(D)).load(j.features):function(ne,oe){return new nt(ne,oe)}(j,D.geojsonVtOptions),this.loaded={};const re={};if($){const ne=$.finish();ne&&(re.resourceTiming={},re.resourceTiming[D.source]=JSON.parse(JSON.stringify(ne)))}return re}catch(j){if(delete this._pendingRequest,x.bz(j))return{abandoned:!0};throw j}})}reloadTile(D){const z=this.loaded;return z&&z[D.uid]?super.reloadTile(D):this.loadTile(D)}loadGeoJSON(D,z){return x._(this,void 0,void 0,function*(){const{promoteId:$}=D;if(D.request){const j=yield x.h(D.request,z);return this._dataUpdateable=rr(j.data,$)?tt(j.data,$):void 0,j.data}if(typeof D.data=="string")try{const j=JSON.parse(D.data);return this._dataUpdateable=rr(j,$)?tt(j,$):void 0,j}catch{throw new Error(`Input data given to '${D.source}' is not a valid GeoJSON object.`)}if(!D.dataDiff)throw new Error(`Input data given to '${D.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${D.source}`);return function(j,re,ne){var oe,ee,ce,be;if(re.removeAll&&j.clear(),re.remove)for(const me of re.remove)j.delete(me);if(re.add)for(const me of re.add){const _e=hi(me,ne);_e!=null&&j.set(_e,me)}if(re.update)for(const me of re.update){let _e=j.get(me.id);if(_e==null)continue;const Ue=!me.removeAllProperties&&(((oe=me.removeProperties)===null||oe===void 0?void 0:oe.length)>0||((ee=me.addOrUpdateProperties)===null||ee===void 0?void 0:ee.length)>0);if((me.newGeometry||me.removeAllProperties||Ue)&&(_e=Object.assign({},_e),j.set(me.id,_e),Ue&&(_e.properties=Object.assign({},_e.properties))),me.newGeometry&&(_e.geometry=me.newGeometry),me.removeAllProperties)_e.properties={};else if(((ce=me.removeProperties)===null||ce===void 0?void 0:ce.length)>0)for(const Ke of me.removeProperties)Object.prototype.hasOwnProperty.call(_e.properties,Ke)&&delete _e.properties[Ke];if(((be=me.addOrUpdateProperties)===null||be===void 0?void 0:be.length)>0)for(const{key:Ke,value:Ze}of me.addOrUpdateProperties)_e.properties[Ke]=Ze}}(this._dataUpdateable,D.dataDiff,$),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(D){return x._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(D){return this._geoJSONIndex.getClusterExpansionZoom(D.clusterId)}getClusterChildren(D){return this._geoJSONIndex.getChildren(D.clusterId)}getClusterLeaves(D){return this._geoJSONIndex.getLeaves(D.clusterId,D.limit,D.offset)}}class Lr{constructor(D){this.self=D,this.actor=new x.C(D),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(z,$)=>{if(this.externalWorkerSourceTypes[z])throw new Error(`Worker source with name "${z}" already registered.`);this.externalWorkerSourceTypes[z]=$},this.self.addProtocol=x.bf,this.self.removeProtocol=x.bg,this.self.registerRTLTextPlugin=z=>{if(x.bA.isParsed())throw new Error("RTL text plugin already registered.");x.bA.setMethods(z)},this.actor.registerMessageHandler("loadDEMTile",(z,$)=>this._getDEMWorkerSource(z,$.source).loadTile($)),this.actor.registerMessageHandler("removeDEMTile",(z,$)=>x._(this,void 0,void 0,function*(){this._getDEMWorkerSource(z,$.source).removeTile($)})),this.actor.registerMessageHandler("getClusterExpansionZoom",(z,$)=>x._(this,void 0,void 0,function*(){return this._getWorkerSource(z,$.type,$.source).getClusterExpansionZoom($)})),this.actor.registerMessageHandler("getClusterChildren",(z,$)=>x._(this,void 0,void 0,function*(){return this._getWorkerSource(z,$.type,$.source).getClusterChildren($)})),this.actor.registerMessageHandler("getClusterLeaves",(z,$)=>x._(this,void 0,void 0,function*(){return this._getWorkerSource(z,$.type,$.source).getClusterLeaves($)})),this.actor.registerMessageHandler("loadData",(z,$)=>this._getWorkerSource(z,$.type,$.source).loadData($)),this.actor.registerMessageHandler("loadTile",(z,$)=>this._getWorkerSource(z,$.type,$.source).loadTile($)),this.actor.registerMessageHandler("reloadTile",(z,$)=>this._getWorkerSource(z,$.type,$.source).reloadTile($)),this.actor.registerMessageHandler("abortTile",(z,$)=>this._getWorkerSource(z,$.type,$.source).abortTile($)),this.actor.registerMessageHandler("removeTile",(z,$)=>this._getWorkerSource(z,$.type,$.source).removeTile($)),this.actor.registerMessageHandler("removeSource",(z,$)=>x._(this,void 0,void 0,function*(){if(!this.workerSources[z]||!this.workerSources[z][$.type]||!this.workerSources[z][$.type][$.source])return;const j=this.workerSources[z][$.type][$.source];delete this.workerSources[z][$.type][$.source],j.removeSource!==void 0&&j.removeSource($)})),this.actor.registerMessageHandler("removeMap",z=>x._(this,void 0,void 0,function*(){delete this.layerIndexes[z],delete this.availableImages[z],delete this.workerSources[z],delete this.demWorkerSources[z]})),this.actor.registerMessageHandler("setReferrer",(z,$)=>x._(this,void 0,void 0,function*(){this.referrer=$})),this.actor.registerMessageHandler("syncRTLPluginState",(z,$)=>this._syncRTLPluginState(z,$)),this.actor.registerMessageHandler("importScript",(z,$)=>x._(this,void 0,void 0,function*(){this.self.importScripts($)})),this.actor.registerMessageHandler("setImages",(z,$)=>this._setImages(z,$)),this.actor.registerMessageHandler("updateLayers",(z,$)=>x._(this,void 0,void 0,function*(){this._getLayerIndex(z).update($.layers,$.removedIds)})),this.actor.registerMessageHandler("setLayers",(z,$)=>x._(this,void 0,void 0,function*(){this._getLayerIndex(z).replace($)}))}_setImages(D,z){return x._(this,void 0,void 0,function*(){this.availableImages[D]=z;for(const $ in this.workerSources[D]){const j=this.workerSources[D][$];for(const re in j)j[re].availableImages=z}})}_syncRTLPluginState(D,z){return x._(this,void 0,void 0,function*(){if(x.bA.isParsed())return x.bA.getState();if(z.pluginStatus!=="loading")return x.bA.setState(z),z;const $=z.pluginURL;if(this.self.importScripts($),x.bA.isParsed()){const j={pluginStatus:"loaded",pluginURL:$};return x.bA.setState(j),j}throw x.bA.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${$}`)})}_getAvailableImages(D){let z=this.availableImages[D];return z||(z=[]),z}_getLayerIndex(D){let z=this.layerIndexes[D];return z||(z=this.layerIndexes[D]=new h),z}_getWorkerSource(D,z,$){if(this.workerSources[D]||(this.workerSources[D]={}),this.workerSources[D][z]||(this.workerSources[D][z]={}),!this.workerSources[D][z][$]){const j={sendAsync:(re,ne)=>(re.targetMapId=D,this.actor.sendAsync(re,ne))};switch(z){case"vector":this.workerSources[D][z][$]=new Q(j,this._getLayerIndex(D),this._getAvailableImages(D));break;case"geojson":this.workerSources[D][z][$]=new Yr(j,this._getLayerIndex(D),this._getAvailableImages(D));break;default:this.workerSources[D][z][$]=new this.externalWorkerSourceTypes[z](j,this._getLayerIndex(D),this._getAvailableImages(D))}}return this.workerSources[D][z][$]}_getDEMWorkerSource(D,z){return this.demWorkerSources[D]||(this.demWorkerSources[D]={}),this.demWorkerSources[D][z]||(this.demWorkerSources[D][z]=new U),this.demWorkerSources[D][z]}}return x.i(self)&&(self.worker=new Lr(self)),Lr}),T("index",["exports","./shared"],function(x,h){var K="4.1.2";let O,ie;const Q={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:p=>new Promise((t,n)=>{const l=requestAnimationFrame(t);p.signal.addEventListener("abort",()=>{cancelAnimationFrame(l),n(h.c())})}),getImageData(p,t=0){return this.getImageCanvasContext(p).getImageData(-t,-t,p.width+2*t,p.height+2*t)},getImageCanvasContext(p){const t=window.document.createElement("canvas"),n=t.getContext("2d",{willReadFrequently:!0});if(!n)throw new Error("failed to create canvas 2d context");return t.width=p.width,t.height=p.height,n.drawImage(p,0,0,p.width,p.height),n},resolveURL:p=>(O||(O=document.createElement("a")),O.href=p,O.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(ie==null&&(ie=matchMedia("(prefers-reduced-motion: reduce)")),ie.matches)}};class U{static testProp(t){if(!U.docStyle)return t[0];for(let n=0;n<t.length;n++)if(t[n]in U.docStyle)return t[n];return t[0]}static create(t,n,l){const c=window.document.createElement(t);return n!==void 0&&(c.className=n),l&&l.appendChild(c),c}static createNS(t,n){return window.document.createElementNS(t,n)}static disableDrag(){U.docStyle&&U.selectProp&&(U.userSelect=U.docStyle[U.selectProp],U.docStyle[U.selectProp]="none")}static enableDrag(){U.docStyle&&U.selectProp&&(U.docStyle[U.selectProp]=U.userSelect)}static setTransform(t,n){t.style[U.transformProp]=n}static addEventListener(t,n,l,c={}){t.addEventListener(n,l,"passive"in c?c:c.capture)}static removeEventListener(t,n,l,c={}){t.removeEventListener(n,l,"passive"in c?c:c.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",U.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",U.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",U.suppressClickInternal,!0)},0)}static getScale(t){const n=t.getBoundingClientRect();return{x:n.width/t.offsetWidth||1,y:n.height/t.offsetHeight||1,boundingClientRect:n}}static getPoint(t,n,l){const c=n.boundingClientRect;return new h.P((l.clientX-c.left)/n.x-t.clientLeft,(l.clientY-c.top)/n.y-t.clientTop)}static mousePos(t,n){const l=U.getScale(t);return U.getPoint(t,l,n)}static touchPos(t,n){const l=[],c=U.getScale(t);for(let f=0;f<n.length;f++)l.push(U.getPoint(t,c,n[f]));return l}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}U.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,U.selectProp=U.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),U.transformProp=U.testProp(["transform","WebkitTransform"]);const ye={supported:!1,testSupport:function(p){!qe&&Pe&&(Ye?_t(p):Te=p)}};let Te,Pe,qe=!1,Ye=!1;function _t(p){const t=p.createTexture();p.bindTexture(p.TEXTURE_2D,t);try{if(p.texImage2D(p.TEXTURE_2D,0,p.RGBA,p.RGBA,p.UNSIGNED_BYTE,Pe),p.isContextLost())return;ye.supported=!0}catch{}p.deleteTexture(t),qe=!0}var gt,xt;typeof document<"u"&&(Pe=document.createElement("img"),Pe.onload=function(){Te&&_t(Te),Te=null,Ye=!0},Pe.onerror=function(){qe=!0,Te=null},Pe.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(p){let t,n,l,c;p.resetRequestQueue=()=>{t=[],n=0,l=0,c={}},p.addThrottleControl=A=>{const I=l++;return c[I]=A,I},p.removeThrottleControl=A=>{delete c[A],v()},p.getImage=(A,I,M=!0)=>new Promise((k,L)=>{ye.supported&&(A.headers||(A.headers={}),A.headers.accept="image/webp,*/*"),h.e(A,{type:"image"}),t.push({abortController:I,requestParameters:A,supportImageRefresh:M,state:"queued",onError:H=>{L(H)},onSuccess:H=>{k(H)}}),v()});const f=A=>h._(this,void 0,void 0,function*(){A.state="running";const{requestParameters:I,supportImageRefresh:M,onError:k,onSuccess:L,abortController:H}=A,q=M===!1&&!h.i(self)&&!h.g(I.url)&&(!I.headers||Object.keys(I.headers).reduce((te,ue)=>te&&ue==="accept",!0));n++;const W=q?b(I,H):h.m(I,H);try{const te=yield W;delete A.abortController,A.state="completed",te.data instanceof HTMLImageElement||h.b(te.data)?L(te):te.data&&L({data:yield(N=te.data,typeof createImageBitmap=="function"?h.d(N):h.f(N)),cacheControl:te.cacheControl,expires:te.expires})}catch(te){delete A.abortController,k(te)}finally{n--,v()}var N}),v=()=>{const A=(()=>{for(const I of Object.keys(c))if(c[I]())return!0;return!1})()?h.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:h.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let I=n;I<A&&t.length>0;I++){const M=t.shift();M.abortController.signal.aborted?I--:f(M)}},b=(A,I)=>new Promise((M,k)=>{const L=new Image,H=A.url,q=A.credentials;q&&q==="include"?L.crossOrigin="use-credentials":(q&&q==="same-origin"||!h.s(H))&&(L.crossOrigin="anonymous"),I.signal.addEventListener("abort",()=>{L.src="",k(h.c())}),L.fetchPriority="high",L.onload=()=>{L.onerror=L.onload=null,M({data:L})},L.onerror=()=>{L.onerror=L.onload=null,I.signal.aborted||k(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},L.src=H})}(gt||(gt={})),gt.resetRequestQueue(),function(p){p.Glyphs="Glyphs",p.Image="Image",p.Source="Source",p.SpriteImage="SpriteImage",p.SpriteJSON="SpriteJSON",p.Style="Style",p.Tile="Tile",p.Unknown="Unknown"}(xt||(xt={}));class pi{constructor(t){this._transformRequestFn=t}transformRequest(t,n){return this._transformRequestFn&&this._transformRequestFn(t,n)||{url:t}}normalizeSpriteURL(t,n,l){const c=function(f){const v=f.match(ji);if(!v)throw new Error(`Unable to parse URL "${f}"`);return{protocol:v[1],authority:v[2],path:v[3]||"/",params:v[4]?v[4].split("&"):[]}}(t);return c.path+=`${n}${l}`,function(f){const v=f.params.length?`?${f.params.join("&")}`:"";return`${f.protocol}://${f.authority}${f.path}${v}`}(c)}setTransformRequest(t){this._transformRequestFn=t}}const ji=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function fi(p){var t=new h.A(3);return t[0]=p[0],t[1]=p[1],t[2]=p[2],t}var dn,Gr=function(p,t,n){return p[0]=t[0]-n[0],p[1]=t[1]-n[1],p[2]=t[2]-n[2],p};dn=new h.A(3),h.A!=Float32Array&&(dn[0]=0,dn[1]=0,dn[2]=0);var ta=function(p){var t=p[0],n=p[1];return t*t+n*n};function Pi(p){const t=[];if(typeof p=="string")t.push({id:"default",url:p});else if(p&&p.length>0){const n=[];for(const{id:l,url:c}of p){const f=`${l}${c}`;n.indexOf(f)===-1&&(n.push(f),t.push({id:l,url:c}))}}return t}(function(){var p=new h.A(2);h.A!=Float32Array&&(p[0]=0,p[1]=0)})();class Ut{constructor(t,n,l,c){this.context=t,this.format=l,this.texture=t.gl.createTexture(),this.update(n,c)}update(t,n,l){const{width:c,height:f}=t,v=!(this.size&&this.size[0]===c&&this.size[1]===f||l),{context:b}=this,{gl:A}=b;if(this.useMipmap=!!(n&&n.useMipmap),A.bindTexture(A.TEXTURE_2D,this.texture),b.pixelStoreUnpackFlipY.set(!1),b.pixelStoreUnpack.set(1),b.pixelStoreUnpackPremultiplyAlpha.set(this.format===A.RGBA&&(!n||n.premultiply!==!1)),v)this.size=[c,f],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||h.b(t)?A.texImage2D(A.TEXTURE_2D,0,this.format,this.format,A.UNSIGNED_BYTE,t):A.texImage2D(A.TEXTURE_2D,0,this.format,c,f,0,this.format,A.UNSIGNED_BYTE,t.data);else{const{x:I,y:M}=l||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||h.b(t)?A.texSubImage2D(A.TEXTURE_2D,0,I,M,A.RGBA,A.UNSIGNED_BYTE,t):A.texSubImage2D(A.TEXTURE_2D,0,I,M,c,f,A.RGBA,A.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&A.generateMipmap(A.TEXTURE_2D)}bind(t,n,l){const{context:c}=this,{gl:f}=c;f.bindTexture(f.TEXTURE_2D,this.texture),l!==f.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(l=f.LINEAR),t!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,t),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,l||t),this.filter=t),n!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,n),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function mi(p){const{userImage:t}=p;return!!(t&&t.render&&t.render())&&(p.data.replace(new Uint8Array(t.data.buffer)),!0)}class lr extends h.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new h.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:n,promiseResolve:l}of this.requestors)l(this._getImagesForIds(n));this.requestors=[]}}getImage(t){const n=this.images[t];if(n&&!n.data&&n.spriteData){const l=n.spriteData;n.data=new h.R({width:l.width,height:l.height},l.context.getImageData(l.x,l.y,l.width,l.height).data),n.spriteData=null}return n}addImage(t,n){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,n)&&(this.images[t]=n)}_validate(t,n){let l=!0;const c=n.data||n.spriteData;return this._validateStretch(n.stretchX,c&&c.width)||(this.fire(new h.j(new Error(`Image "${t}" has invalid "stretchX" value`))),l=!1),this._validateStretch(n.stretchY,c&&c.height)||(this.fire(new h.j(new Error(`Image "${t}" has invalid "stretchY" value`))),l=!1),this._validateContent(n.content,n)||(this.fire(new h.j(new Error(`Image "${t}" has invalid "content" value`))),l=!1),l}_validateStretch(t,n){if(!t)return!0;let l=0;for(const c of t){if(c[0]<l||c[1]<c[0]||n<c[1])return!1;l=c[1]}return!0}_validateContent(t,n){if(!t)return!0;if(t.length!==4)return!1;const l=n.spriteData,c=l&&l.width||n.data.width,f=l&&l.height||n.data.height;return!(t[0]<0||c<t[0]||t[1]<0||f<t[1]||t[2]<0||c<t[2]||t[3]<0||f<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,n,l=!0){const c=this.getImage(t);if(l&&(c.data.width!==n.data.width||c.data.height!==n.data.height))throw new Error(`size mismatch between old image (${c.data.width}x${c.data.height}) and new image (${n.data.width}x${n.data.height}).`);n.version=c.version+1,this.images[t]=n,this.updatedImages[t]=!0}removeImage(t){const n=this.images[t];delete this.images[t],delete this.patterns[t],n.userImage&&n.userImage.onRemove&&n.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise((n,l)=>{let c=!0;if(!this.isLoaded())for(const f of t)this.images[f]||(c=!1);this.isLoaded()||c?n(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:n})})}_getImagesForIds(t){const n={};for(const l of t){let c=this.getImage(l);c||(this.fire(new h.k("styleimagemissing",{id:l})),c=this.getImage(l)),c?n[l]={data:c.data.clone(),pixelRatio:c.pixelRatio,sdf:c.sdf,version:c.version,stretchX:c.stretchX,stretchY:c.stretchY,content:c.content,hasRenderCallback:!!(c.userImage&&c.userImage.render)}:h.w(`Image "${l}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return n}getPixelSize(){const{width:t,height:n}=this.atlasImage;return{width:t,height:n}}getPattern(t){const n=this.patterns[t],l=this.getImage(t);if(!l)return null;if(n&&n.position.version===l.version)return n.position;if(n)n.position.version=l.version;else{const c={w:l.data.width+2,h:l.data.height+2,x:0,y:0},f=new h.I(c,l);this.patterns[t]={bin:c,position:f}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const n=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Ut(t,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const f in this.patterns)t.push(this.patterns[f].bin);const{w:n,h:l}=h.p(t),c=this.atlasImage;c.resize({width:n||1,height:l||1});for(const f in this.patterns){const{bin:v}=this.patterns[f],b=v.x+1,A=v.y+1,I=this.getImage(f).data,M=I.width,k=I.height;h.R.copy(I,c,{x:0,y:0},{x:b,y:A},{width:M,height:k}),h.R.copy(I,c,{x:0,y:k-1},{x:b,y:A-1},{width:M,height:1}),h.R.copy(I,c,{x:0,y:0},{x:b,y:A+k},{width:M,height:1}),h.R.copy(I,c,{x:M-1,y:0},{x:b-1,y:A},{width:1,height:k}),h.R.copy(I,c,{x:0,y:0},{x:b+M,y:A},{width:1,height:k})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const n of t){if(this.callbackDispatchedThisFrame[n])continue;this.callbackDispatchedThisFrame[n]=!0;const l=this.getImage(n);l||h.w(`Image with ID: "${n}" was not found`),mi(l)&&this.updateImage(n,l)}}}const pn=1e20;function zr(p,t,n,l,c,f,v,b,A){for(let I=t;I<t+l;I++)Nn(p,n*f+I,f,c,v,b,A);for(let I=n;I<n+c;I++)Nn(p,I*f+t,1,l,v,b,A)}function Nn(p,t,n,l,c,f,v){f[0]=0,v[0]=-pn,v[1]=pn,c[0]=p[t];for(let b=1,A=0,I=0;b<l;b++){c[b]=p[t+b*n];const M=b*b;do{const k=f[A];I=(c[b]-c[k]+M-k*k)/(b-k)/2}while(I<=v[A]&&--A>-1);A++,f[A]=b,v[A]=I,v[A+1]=pn}for(let b=0,A=0;b<l;b++){for(;v[A+1]<b;)A++;const I=f[A],M=b-I;p[t+b*n]=c[I]+M*M}}class wr{constructor(t,n){this.requestManager=t,this.localIdeographFontFamily=n,this.entries={}}setURL(t){this.url=t}getGlyphs(t){return h._(this,void 0,void 0,function*(){const n=[];for(const f in t)for(const v of t[f])n.push(this._getAndCacheGlyphsPromise(f,v));const l=yield Promise.all(n),c={};for(const{stack:f,id:v,glyph:b}of l)c[f]||(c[f]={}),c[f][v]=b&&{id:b.id,bitmap:b.bitmap.clone(),metrics:b.metrics};return c})}_getAndCacheGlyphsPromise(t,n){return h._(this,void 0,void 0,function*(){let l=this.entries[t];l||(l=this.entries[t]={glyphs:{},requests:{},ranges:{}});let c=l.glyphs[n];if(c!==void 0)return{stack:t,id:n,glyph:c};if(c=this._tinySDF(l,t,n),c)return l.glyphs[n]=c,{stack:t,id:n,glyph:c};const f=Math.floor(n/256);if(256*f>65535)throw new Error("glyphs > 65535 not supported");if(l.ranges[f])return{stack:t,id:n,glyph:c};if(!this.url)throw new Error("glyphsUrl is not set");if(!l.requests[f]){const b=wr.loadGlyphRange(t,f,this.url,this.requestManager);l.requests[f]=b}const v=yield l.requests[f];for(const b in v)this._doesCharSupportLocalGlyph(+b)||(l.glyphs[+b]=v[+b]);return l.ranges[f]=!0,{stack:t,id:n,glyph:v[n]||null}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(h.u["CJK Unified Ideographs"](t)||h.u["Hangul Syllables"](t)||h.u.Hiragana(t)||h.u.Katakana(t))}_tinySDF(t,n,l){const c=this.localIdeographFontFamily;if(!c||!this._doesCharSupportLocalGlyph(l))return;let f=t.tinySDF;if(!f){let b="400";/bold/i.test(n)?b="900":/medium/i.test(n)?b="500":/light/i.test(n)&&(b="200"),f=t.tinySDF=new wr.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:c,fontWeight:b})}const v=f.draw(String.fromCharCode(l));return{id:l,bitmap:new h.o({width:v.width||60,height:v.height||60},v.data),metrics:{width:v.glyphWidth/2||24,height:v.glyphHeight/2||24,left:v.glyphLeft/2+.5||0,top:v.glyphTop/2-27.5||-8,advance:v.glyphAdvance/2||24,isDoubleResolution:!0}}}}wr.loadGlyphRange=function(p,t,n,l){return h._(this,void 0,void 0,function*(){const c=256*t,f=c+255,v=l.transformRequest(n.replace("{fontstack}",p).replace("{range}",`${c}-${f}`),xt.Glyphs),b=yield h.l(v,new AbortController);if(!b||!b.data)throw new Error(`Could not load glyph range. range: ${t}, ${c}-${f}`);const A={};for(const I of h.n(b.data))A[I.id]=I;return A})},wr.TinySDF=class{constructor({fontSize:p=24,buffer:t=3,radius:n=8,cutoff:l=.25,fontFamily:c="sans-serif",fontWeight:f="normal",fontStyle:v="normal"}={}){this.buffer=t,this.cutoff=l,this.radius=n;const b=this.size=p+4*t,A=this._createCanvas(b),I=this.ctx=A.getContext("2d",{willReadFrequently:!0});I.font=`${v} ${f} ${p}px ${c}`,I.textBaseline="alphabetic",I.textAlign="left",I.fillStyle="black",this.gridOuter=new Float64Array(b*b),this.gridInner=new Float64Array(b*b),this.f=new Float64Array(b),this.z=new Float64Array(b+1),this.v=new Uint16Array(b)}_createCanvas(p){const t=document.createElement("canvas");return t.width=t.height=p,t}draw(p){const{width:t,actualBoundingBoxAscent:n,actualBoundingBoxDescent:l,actualBoundingBoxLeft:c,actualBoundingBoxRight:f}=this.ctx.measureText(p),v=Math.ceil(n),b=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(f-c))),A=Math.min(this.size-this.buffer,v+Math.ceil(l)),I=b+2*this.buffer,M=A+2*this.buffer,k=Math.max(I*M,0),L=new Uint8ClampedArray(k),H={data:L,width:I,height:M,glyphWidth:b,glyphHeight:A,glyphTop:v,glyphLeft:0,glyphAdvance:t};if(b===0||A===0)return H;const{ctx:q,buffer:W,gridInner:N,gridOuter:te}=this;q.clearRect(W,W,b,A),q.fillText(p,W,W+v);const ue=q.getImageData(W,W,b,A);te.fill(pn,0,k),N.fill(0,0,k);for(let X=0;X<A;X++)for(let ae=0;ae<b;ae++){const he=ue.data[4*(X*b+ae)+3]/255;if(he===0)continue;const de=(X+W)*I+ae+W;if(he===1)te[de]=0,N[de]=pn;else{const pe=.5-he;te[de]=pe>0?pe*pe:0,N[de]=pe<0?pe*pe:0}}zr(te,0,0,I,M,I,this.f,this.v,this.z),zr(N,W,W,b,A,I,this.f,this.v,this.z);for(let X=0;X<k;X++){const ae=Math.sqrt(te[X])-Math.sqrt(N[X]);L[X]=Math.round(255-255*(ae/this.radius+this.cutoff))}return H}};class As{constructor(){this.specification=h.v.light.position}possiblyEvaluate(t,n){return h.y(t.expression.evaluate(n))}interpolate(t,n,l){return{x:h.z.number(t.x,n.x,l),y:h.z.number(t.y,n.y,l),z:h.z.number(t.z,n.z,l)}}}let Hr;class Mi extends h.E{constructor(t){super(),Hr=Hr||new h.q({anchor:new h.D(h.v.light.anchor),position:new As,color:new h.D(h.v.light.color),intensity:new h.D(h.v.light.intensity)}),this._transitionable=new h.T(Hr),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,n={}){if(!this._validate(h.r,t,n))for(const l in t){const c=t[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),c):this._transitionable.setValue(l,c)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,n,l){return(!l||l.validate!==!1)&&h.t(this,t.call(h.x,{value:n,style:{glyphs:!0,sprite:!0},styleSpec:h.v}))}}class ki{constructor(t,n){this.width=t,this.height=n,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,n){const l=t.join(",")+String(n);return this.dashEntry[l]||(this.dashEntry[l]=this.addDash(t,n)),this.dashEntry[l]}getDashRanges(t,n,l){const c=[];let f=t.length%2==1?-t[t.length-1]*l:0,v=t[0]*l,b=!0;c.push({left:f,right:v,isDash:b,zeroLength:t[0]===0});let A=t[0];for(let I=1;I<t.length;I++){b=!b;const M=t[I];f=A*l,A+=M,v=A*l,c.push({left:f,right:v,isDash:b,zeroLength:M===0})}return c}addRoundDash(t,n,l){const c=n/2;for(let f=-l;f<=l;f++){const v=this.width*(this.nextRow+l+f);let b=0,A=t[b];for(let I=0;I<this.width;I++){I/A.right>1&&(A=t[++b]);const M=Math.abs(I-A.left),k=Math.abs(I-A.right),L=Math.min(M,k);let H;const q=f/l*(c+1);if(A.isDash){const W=c-Math.abs(q);H=Math.sqrt(L*L+W*W)}else H=c-Math.sqrt(L*L+q*q);this.data[v+I]=Math.max(0,Math.min(255,H+128))}}}addRegularDash(t){for(let b=t.length-1;b>=0;--b){const A=t[b],I=t[b+1];A.zeroLength?t.splice(b,1):I&&I.isDash===A.isDash&&(I.left=A.left,t.splice(b,1))}const n=t[0],l=t[t.length-1];n.isDash===l.isDash&&(n.left=l.left-this.width,l.right=n.right+this.width);const c=this.width*this.nextRow;let f=0,v=t[f];for(let b=0;b<this.width;b++){b/v.right>1&&(v=t[++f]);const A=Math.abs(b-v.left),I=Math.abs(b-v.right),M=Math.min(A,I);this.data[c+b]=Math.max(0,Math.min(255,(v.isDash?M:-M)+128))}}addDash(t,n){const l=n?7:0,c=2*l+1;if(this.nextRow+c>this.height)return h.w("LineAtlas out of space"),null;let f=0;for(let b=0;b<t.length;b++)f+=t[b];if(f!==0){const b=this.width/f,A=this.getDashRanges(t,this.width,b);n?this.addRoundDash(A,b,l):this.addRegularDash(A)}const v={y:(this.nextRow+l+.5)/this.height,height:2*l/this.height,width:f};return this.nextRow+=c,this.dirty=!0,v}bind(t){const n=t.gl;this.texture?(n.bindTexture(n.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,n.texSubImage2D(n.TEXTURE_2D,0,0,0,this.width,this.height,n.ALPHA,n.UNSIGNED_BYTE,this.data))):(this.texture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,this.texture),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texImage2D(n.TEXTURE_2D,0,n.ALPHA,this.width,this.height,0,n.ALPHA,n.UNSIGNED_BYTE,this.data))}}const fn="maplibre_preloaded_worker_pool";class Sr{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Sr.workerCount;)this.workers.push(new Worker(h.a.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[fn]}numActive(){return Object.keys(this.active).length}}const mn=Math.floor(Q.hardwareConcurrency/2);let Br,cr;function ur(){return Br||(Br=new Sr),Br}Sr.workerCount=h.B(globalThis)?Math.max(Math.min(mn,3),1):1;class Un{constructor(t,n){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=n;const l=this.workerPool.acquire(n);for(let c=0;c<l.length;c++){const f=new h.C(l[c],n);f.name=`Worker ${c}`,this.actors.push(f)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,n){const l=[];for(const c of this.actors)l.push(c.sendAsync({type:t,data:n}));return Promise.all(l)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach(n=>{n.remove()}),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,n){for(const l of this.actors)l.registerMessageHandler(t,n)}}function Zr(){return cr||(cr=new Un(ur(),h.G),cr.registerMessageHandler("getResource",(p,t,n)=>h.m(t,n))),cr}function ia(p,t){const n=h.F();return h.H(n,n,[1,1,0]),h.J(n,n,[.5*p.width,.5*p.height,1]),h.K(n,n,p.calculatePosMatrix(t.toUnwrapped()))}function Wr(p,t,n,l,c,f){const v=function(k,L,H){if(k)for(const q of k){const W=L[q];if(W&&W.source===H&&W.type==="fill-extrusion")return!0}else for(const q in L){const W=L[q];if(W.source===H&&W.type==="fill-extrusion")return!0}return!1}(c&&c.layers,t,p.id),b=f.maxPitchScaleFactor(),A=p.tilesIn(l,b,v);A.sort(Kr);const I=[];for(const k of A)I.push({wrappedTileID:k.tileID.wrapped().key,queryResults:k.tile.queryRenderedFeatures(t,n,p._state,k.queryGeometry,k.cameraQueryGeometry,k.scale,c,f,b,ia(p.transform,k.tileID))});const M=function(k){const L={},H={};for(const q of k){const W=q.queryResults,N=q.wrappedTileID,te=H[N]=H[N]||{};for(const ue in W){const X=W[ue],ae=te[ue]=te[ue]||{},he=L[ue]=L[ue]||[];for(const de of X)ae[de.featureIndex]||(ae[de.featureIndex]=!0,he.push(de))}}return L}(I);for(const k in M)M[k].forEach(L=>{const H=L.feature,q=p.getFeatureState(H.layer["source-layer"],H.id);H.source=H.layer.source,H.layer["source-layer"]&&(H.sourceLayer=H.layer["source-layer"]),H.state=q});return M}function Kr(p,t){const n=p.tileID,l=t.tileID;return n.overscaledZ-l.overscaledZ||n.canonical.y-l.canonical.y||n.wrap-l.wrap||n.canonical.x-l.canonical.x}function Xr(p,t,n){return h._(this,void 0,void 0,function*(){let l=p;if(p.url?l=(yield h.h(t.transformRequest(p.url,xt.Source),n)).data:yield Q.frameAsync(n),!l)return null;const c=h.L(h.e(l,p),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in l&&l.vector_layers&&(c.vectorLayerIds=l.vector_layers.map(f=>f.id)),c})}class Qt{constructor(t,n){t&&(n?this.setSouthWest(t).setNorthEast(n):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof h.M?new h.M(t.lng,t.lat):h.M.convert(t),this}setSouthWest(t){return this._sw=t instanceof h.M?new h.M(t.lng,t.lat):h.M.convert(t),this}extend(t){const n=this._sw,l=this._ne;let c,f;if(t instanceof h.M)c=t,f=t;else{if(!(t instanceof Qt))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Qt.convert(t)):this.extend(h.M.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(h.M.convert(t)):this;if(c=t._sw,f=t._ne,!c||!f)return this}return n||l?(n.lng=Math.min(c.lng,n.lng),n.lat=Math.min(c.lat,n.lat),l.lng=Math.max(f.lng,l.lng),l.lat=Math.max(f.lat,l.lat)):(this._sw=new h.M(c.lng,c.lat),this._ne=new h.M(f.lng,f.lat)),this}getCenter(){return new h.M((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new h.M(this.getWest(),this.getNorth())}getSouthEast(){return new h.M(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:n,lat:l}=h.M.convert(t);let c=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&c}static convert(t){return t instanceof Qt?t:t&&new Qt(t)}static fromLngLat(t,n=0){const l=360*n/40075017,c=l/Math.cos(Math.PI/180*t.lat);return new Qt(new h.M(t.lng-c,t.lat-l),new h.M(t.lng+c,t.lat+l))}}class gn{constructor(t,n,l){this.bounds=Qt.convert(this.validateBounds(t)),this.minzoom=n||0,this.maxzoom=l||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const n=Math.pow(2,t.z),l=Math.floor(h.N(this.bounds.getWest())*n),c=Math.floor(h.O(this.bounds.getNorth())*n),f=Math.ceil(h.N(this.bounds.getEast())*n),v=Math.ceil(h.O(this.bounds.getSouth())*n);return t.x>=l&&t.x<f&&t.y>=c&&t.y<v}}class fe extends h.E{constructor(t,n,l,c){if(super(),this.id=t,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,h.e(this,h.L(n,["url","scheme","tileSize","promoteId"])),this._options=h.e({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(c)}load(){return h._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new h.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield Xr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),t&&(h.e(this,t),t.bounds&&(this.tileBounds=new gn(t.bounds,this.minzoom,this.maxzoom)),this.fire(new h.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.k("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this.fire(new h.j(t))}})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return h.e({},this._options)}loadTile(t){return h._(this,void 0,void 0,function*(){const n=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l={request:this.map._requestManager.transformRequest(n,xt.Tile),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};l.request.collectResourceTiming=this._collectResourceTiming;let c="reloadTile";if(t.actor&&t.state!=="expired"){if(t.state==="loading")return new Promise((f,v)=>{t.reloadPromise={resolve:f,reject:v}})}else t.actor=this.dispatcher.getActor(),c="loadTile";t.abortController=new AbortController;try{const f=yield t.actor.sendAsync({type:c,data:l},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,f)}catch(f){if(delete t.abortController,t.aborted)return;if(f&&f.status!==404)throw f;this._afterTileLoadWorkerResponse(t,null)}})}_afterTileLoadWorkerResponse(t,n){if(n&&n.resourceTiming&&(t.resourceTiming=n.resourceTiming),n&&this.map._refreshExpiredTiles&&t.setExpiryData(n),t.loadVectorData(n,this.map.painter),t.reloadPromise){const l=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(l.resolve).catch(l.reject)}}abortTile(t){return h._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"abortTile",data:{uid:t.uid,type:this.type,source:this.id}}))})}unloadTile(t){return h._(this,void 0,void 0,function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"removeTile",data:{uid:t.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class yn extends h.E{constructor(t,n,l,c){super(),this.id=t,this.dispatcher=l,this.setEventedParent(c),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=h.e({type:"raster"},n),h.e(this,h.L(n,["url","scheme","tileSize"]))}load(){return h._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new h.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield Xr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,t&&(h.e(this,t),t.bounds&&(this.tileBounds=new gn(t.bounds,this.minzoom,this.maxzoom)),this.fire(new h.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.k("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this.fire(new h.j(t))}})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}serialize(){return h.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return h._(this,void 0,void 0,function*(){const n=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const l=yield gt.getImage(this.map._requestManager.transformRequest(n,xt.Tile),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(l&&l.data){this.map._refreshExpiredTiles&&l.cacheControl&&l.expires&&t.setExpiryData({cacheControl:l.cacheControl,expires:l.expires});const c=this.map.painter.context,f=c.gl,v=l.data;t.texture=this.map.painter.getTileTexture(v.width),t.texture?t.texture.update(v,{useMipmap:!0}):(t.texture=new Ut(c,v,f.RGBA,{useMipmap:!0}),t.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE,f.LINEAR_MIPMAP_NEAREST),c.extTextureFilterAnisotropic&&f.texParameterf(f.TEXTURE_2D,c.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,c.extTextureFilterAnisotropicMax)),t.state="loaded"}}catch(l){if(delete t.abortController,t.aborted)t.state="unloaded";else if(l)throw t.state="errored",l}})}abortTile(t){return h._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)})}unloadTile(t){return h._(this,void 0,void 0,function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)})}hasTransition(){return!1}}class Es extends yn{constructor(t,n,l,c){super(t,n,l,c),this.type="raster-dem",this.maxzoom=22,this._options=h.e({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox",this.redFactor=n.redFactor,this.greenFactor=n.greenFactor,this.blueFactor=n.blueFactor,this.baseShift=n.baseShift}loadTile(t){return h._(this,void 0,void 0,function*(){const n=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l=this.map._requestManager.transformRequest(n,xt.Tile);t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const c=yield gt.getImage(l,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(c&&c.data){const f=c.data;this.map._refreshExpiredTiles&&c.cacheControl&&c.expires&&t.setExpiryData({cacheControl:c.cacheControl,expires:c.expires});const v=h.b(f)&&h.S()?f:yield this.readImageNow(f),b={type:this.type,uid:t.uid,source:this.id,rawImageData:v,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||t.state==="expired"){t.actor=this.dispatcher.getActor();const A=yield t.actor.sendAsync({type:"loadDEMTile",data:b});t.dem=A,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(c){if(delete t.abortController,t.aborted)t.state="unloaded";else if(c)throw t.state="errored",c}})}readImageNow(t){return h._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&h.U()){const n=t.width+2,l=t.height+2;try{return new h.R({width:n,height:l},yield h.V(t,-1,-1,n,l))}catch{}}return Q.getImageData(t,1)})}_getNeighboringTiles(t){const n=t.canonical,l=Math.pow(2,n.z),c=(n.x-1+l)%l,f=n.x===0?t.wrap-1:t.wrap,v=(n.x+1+l)%l,b=n.x+1===l?t.wrap+1:t.wrap,A={};return A[new h.Q(t.overscaledZ,f,n.z,c,n.y).key]={backfilled:!1},A[new h.Q(t.overscaledZ,b,n.z,v,n.y).key]={backfilled:!1},n.y>0&&(A[new h.Q(t.overscaledZ,f,n.z,c,n.y-1).key]={backfilled:!1},A[new h.Q(t.overscaledZ,t.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},A[new h.Q(t.overscaledZ,b,n.z,v,n.y-1).key]={backfilled:!1}),n.y+1<l&&(A[new h.Q(t.overscaledZ,f,n.z,c,n.y+1).key]={backfilled:!1},A[new h.Q(t.overscaledZ,t.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},A[new h.Q(t.overscaledZ,b,n.z,v,n.y+1).key]={backfilled:!1}),A}unloadTile(t){return h._(this,void 0,void 0,function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"removeDEMTile",data:{type:this.type,uid:t.uid,source:this.id}}))})}}class ht extends h.E{constructor(t,n,l,c){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=l.getActor(),this.setEventedParent(c),this._data=n.data,this._options=h.e({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const f=h.W/this.tileSize;this.workerOptions=h.e({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*f,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*f,extent:h.W,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:h.W,radius:(n.clusterRadius||50)*f,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return h._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData(),this}updateData(t){return this._updateWorkerData(t),this}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t&&(t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=t.clusterRadius),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=t.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"getClusterExpansionZoom",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"getClusterChildren",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,n,l){return this.actor.sendAsync({type:"getClusterLeaves",data:{type:this.type,source:this.id,clusterId:t,limit:n,offset:l}})}_updateWorkerData(t){return h._(this,void 0,void 0,function*(){const n=h.e({type:this.type},this.workerOptions);t?n.dataDiff=t:typeof this._data=="string"?(n.request=this.map._requestManager.transformRequest(Q.resolveURL(this._data),xt.Source),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new h.k("dataloading",{dataType:"source"}));try{const l=yield this.actor.sendAsync({type:"loadData",data:n});if(this._pendingLoads--,this._removed||l.abandoned)return void this.fire(new h.k("dataabort",{dataType:"source"}));let c=null;l.resourceTiming&&l.resourceTiming[this.id]&&(c=l.resourceTiming[this.id].slice(0));const f={dataType:"source"};this._collectResourceTiming&&c&&c.length>0&&h.e(f,{resourceTiming:c}),this.fire(new h.k("data",Object.assign(Object.assign({},f),{sourceDataType:"metadata"}))),this.fire(new h.k("data",Object.assign(Object.assign({},f),{sourceDataType:"content"})))}catch(l){if(this._pendingLoads--,this._removed)return void this.fire(new h.k("dataabort",{dataType:"source"}));this.fire(new h.j(l))}})}loaded(){return this._pendingLoads===0}loadTile(t){return h._(this,void 0,void 0,function*(){const n=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const l={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.abortController=new AbortController;const c=yield this.actor.sendAsync({type:n,data:l},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(c,this.map.painter,n==="reloadTile")})}abortTile(t){return h._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0})}unloadTile(t){return h._(this,void 0,void 0,function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"removeTile",data:{uid:t.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"removeSource",data:{type:this.type,source:this.id}})}serialize(){return h.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var ui=h.X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Tr extends h.E{constructor(t,n,l,c){super(),this.id=t,this.dispatcher=l,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(c),this.options=n}load(t){return h._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new h.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const n=yield gt.getImage(this.map._requestManager.transformRequest(this.url,xt.Image),this._request);this._request=null,this._loaded=!0,n&&n.data&&(this.image=n.data,t&&(this.coordinates=t),this._finishLoading())}catch(n){this._request=null,this.fire(new h.j(n))}})}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new h.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const n=t.map(h.Y.fromLngLat);this.tileID=function(c){let f=1/0,v=1/0,b=-1/0,A=-1/0;for(const L of c)f=Math.min(f,L.x),v=Math.min(v,L.y),b=Math.max(b,L.x),A=Math.max(A,L.y);const I=Math.max(b-f,A-v),M=Math.max(0,Math.floor(-Math.log(I)/Math.LN2)),k=Math.pow(2,M);return new h.a0(M,Math.floor((f+b)/2*k),Math.floor((v+A)/2*k))}(n),this.minzoom=this.maxzoom=this.tileID.z;const l=n.map(c=>this.tileID.getTilePoint(c)._round());return this._boundsArray=new h.Z,this._boundsArray.emplaceBack(l[0].x,l[0].y,0,0),this._boundsArray.emplaceBack(l[1].x,l[1].y,h.W,0),this._boundsArray.emplaceBack(l[3].x,l[3].y,0,h.W),this._boundsArray.emplaceBack(l[2].x,l[2].y,h.W,h.W),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new h.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,n=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,ui.members)),this.boundsSegments||(this.boundsSegments=h.$.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Ut(t,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let l=!1;for(const c in this.tiles){const f=this.tiles[c];f.state!=="loaded"&&(f.state="loaded",f.texture=this.texture,l=!0)}l&&this.fire(new h.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return h._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Vn extends Tr{constructor(t,n,l,c){super(t,n,l,c),this.roundZoom=!0,this.type="video",this.options=n}load(){return h._(this,void 0,void 0,function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const n of t.urls)this.urls.push(this.map._requestManager.transformRequest(n,xt.Source).url);try{const n=yield h.a2(this.urls);if(this._loaded=!0,!n)return;this.video=n,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(n){this.fire(new h.j(n))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const n=this.video.seekable;t<n.start(0)||t>n.end(0)?this.fire(new h.j(new h.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,n=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,ui.members)),this.boundsSegments||(this.boundsSegments=h.$.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new Ut(t,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let l=!1;for(const c in this.tiles){const f=this.tiles[c];f.state!=="loaded"&&(f.state="loaded",f.texture=this.texture,l=!0)}l&&this.fire(new h.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class jn extends Tr{constructor(t,n,l,c){super(t,n,l,c),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(f=>!Array.isArray(f)||f.length!==2||f.some(v=>typeof v!="number"))||this.fire(new h.j(new h.a1(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new h.j(new h.a1(`sources.${t}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new h.j(new h.a1(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new h.j(new h.a1(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new h.j(new h.a1(`sources.${t}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){return h._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new h.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context,l=n.gl;this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,ui.members)),this.boundsSegments||(this.boundsSegments=h.$.simpleSegment(0,0,4,2)),this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Ut(n,this.canvas,l.RGBA,{premultiply:!0});let c=!1;for(const f in this.tiles){const v=this.tiles[f];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,c=!0)}c&&this.fire(new h.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const qn={},_n=p=>{switch(p){case"geojson":return ht;case"image":return Tr;case"raster":return yn;case"raster-dem":return Es;case"vector":return fe;case"video":return Vn;case"canvas":return jn}return qn[p]},Gn="RTLPluginLoaded";class Is extends h.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Zr()}_syncState(t){return this.status=t,this.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:t,pluginURL:this.url}).catch(n=>{throw this.status="error",n})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(t){return h._(this,arguments,void 0,function*(n,l=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=Q.resolveURL(n),!this.url)throw new Error(`requested url ${n} is invalid`);if(this.status==="unavailable"){if(!l)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return h._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new h.k(Gn))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Me=null;function qi(){return Me||(Me=new Is),Me}class Di{constructor(t,n){this.timeAdded=0,this.fadeEndTime=0,this.tileID=t,this.uid=h.a3(),this.uses=0,this.tileSize=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const n=t+this.timeAdded;n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,n,l){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(c,f){const v={};if(!f)return v;for(const b of c){const A=b.layerIds.map(I=>f.getLayer(I)).filter(Boolean);if(A.length!==0){b.layers=A,b.stateDependentLayerIds&&(b.stateDependentLayers=b.stateDependentLayerIds.map(I=>A.filter(M=>M.id===I)[0]));for(const I of A)v[I.id]=b}}return v}(t.buckets,n.style),this.hasSymbolBuckets=!1;for(const c in this.buckets){const f=this.buckets[c];if(f instanceof h.a5){if(this.hasSymbolBuckets=!0,!l)break;f.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const c in this.buckets){const f=this.buckets[c];if(f instanceof h.a5&&f.hasRTLText){this.hasRTLText=!0,qi().lazyLoad();break}}this.queryPadding=0;for(const c in this.buckets){const f=this.buckets[c];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(c).queryRadius(f))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new h.a4}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const l in this.buckets){const c=this.buckets[l];c.uploadPending()&&c.upload(t)}const n=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Ut(t,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Ut(t,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,n,l,c,f,v,b,A,I,M){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:c,cameraQueryGeometry:f,scale:v,tileSize:this.tileSize,pixelPosMatrix:M,transform:A,params:b,queryPadding:this.queryPadding*I},t,n,l):{}}querySourceFeatures(t,n){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const c=l.loadVTLayers(),f=n&&n.sourceLayer?n.sourceLayer:"",v=c._geojsonTileLayer||c[f];if(!v)return;const b=h.a6(n&&n.filter),{z:A,x:I,y:M}=this.tileID.canonical,k={z:A,x:I,y:M};for(let L=0;L<v.length;L++){const H=v.feature(L);if(b.needGeometry){const N=h.a7(H,!0);if(!b.filter(new h.a8(this.tileID.overscaledZ),N,this.tileID.canonical))continue}else if(!b.filter(new h.a8(this.tileID.overscaledZ),H))continue;const q=l.getId(H,f),W=new h.a9(H,A,I,M,q);W.tile=k,t.push(W)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const n=this.expirationTime;if(t.cacheControl){const l=h.aa(t.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const l=Date.now();let c=!1;if(this.expirationTime>l)c=!1;else if(n)if(this.expirationTime<n)c=!0;else{const f=this.expirationTime-n;f?this.expirationTime=l+Math.max(f,3e4):c=!0}else c=!0;c?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const l=this.latestFeatureIndex.loadVTLayers();for(const c in this.buckets){if(!n.style.hasLayer(c))continue;const f=this.buckets[c],v=f.layers[0].sourceLayer||"_geojsonTileLayer",b=l[v],A=t[v];if(!b||!A||Object.keys(A).length===0)continue;f.update(A,b,this.imageAtlas&&this.imageAtlas.patternPositions||{});const I=n&&n.style&&n.style.getLayer(c);I&&(this.queryPadding=Math.max(this.queryPadding,I.queryRadius(f)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=Q.now()+t}setDependencies(t,n){const l={};for(const c of n)l[c]=!0;this.dependencies[t]=l}hasDependency(t,n){for(const l of t){const c=this.dependencies[l];if(c){for(const f of n)if(c[f])return!0}}return!1}}class Cs{constructor(t,n){this.max=t,this.onRemove=n,this.reset()}reset(){for(const t in this.data)for(const n of this.data[t])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(t,n,l){const c=t.wrapped().key;this.data[c]===void 0&&(this.data[c]=[]);const f={value:n,timeout:void 0};if(l!==void 0&&(f.timeout=setTimeout(()=>{this.remove(t,f)},l)),this.data[c].push(f),this.order.push(c),this.order.length>this.max){const v=this._getAndRemoveByKey(this.order[0]);v&&this.onRemove(v)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const n=this.data[t].shift();return n.timeout&&clearTimeout(n.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),n.value}getByKey(t){const n=this.data[t];return n?n[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,n){if(!this.has(t))return this;const l=t.wrapped().key,c=n===void 0?0:this.data[l].indexOf(n),f=this.data[l][c];return this.data[l].splice(c,1),f.timeout&&clearTimeout(f.timeout),this.data[l].length===0&&delete this.data[l],this.onRemove(f.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(t){const n=[];for(const l in this.data)for(const c of this.data[l])t(c.value)||n.push(c);for(const l of n)this.remove(l.value.tileID,l)}}class xn{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,n,l){const c=String(n);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][c]=this.stateChanges[t][c]||{},h.e(this.stateChanges[t][c],l),this.deletedStates[t]===null){this.deletedStates[t]={};for(const f in this.state[t])f!==c&&(this.deletedStates[t][f]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][c]===null){this.deletedStates[t][c]={};for(const f in this.state[t][c])l[f]||(this.deletedStates[t][c][f]=null)}else for(const f in l)this.deletedStates[t]&&this.deletedStates[t][c]&&this.deletedStates[t][c][f]===null&&delete this.deletedStates[t][c][f]}removeFeatureState(t,n,l){if(this.deletedStates[t]===null)return;const c=String(n);if(this.deletedStates[t]=this.deletedStates[t]||{},l&&n!==void 0)this.deletedStates[t][c]!==null&&(this.deletedStates[t][c]=this.deletedStates[t][c]||{},this.deletedStates[t][c][l]=null);else if(n!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][c])for(l in this.deletedStates[t][c]={},this.stateChanges[t][c])this.deletedStates[t][c][l]=null;else this.deletedStates[t][c]=null;else this.deletedStates[t]=null}getState(t,n){const l=String(n),c=h.e({},(this.state[t]||{})[l],(this.stateChanges[t]||{})[l]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const f=this.deletedStates[t][n];if(f===null)return{};for(const v in f)delete c[v]}return c}initializeTileState(t,n){t.setFeatureState(this.state,n)}coalesceChanges(t,n){const l={};for(const c in this.stateChanges){this.state[c]=this.state[c]||{};const f={};for(const v in this.stateChanges[c])this.state[c][v]||(this.state[c][v]={}),h.e(this.state[c][v],this.stateChanges[c][v]),f[v]=this.state[c][v];l[c]=f}for(const c in this.deletedStates){this.state[c]=this.state[c]||{};const f={};if(this.deletedStates[c]===null)for(const v in this.state[c])f[v]={},this.state[c][v]={};else for(const v in this.deletedStates[c]){if(this.deletedStates[c][v]===null)this.state[c][v]={};else for(const b of Object.keys(this.deletedStates[c][v]))delete this.state[c][v][b];f[v]=this.state[c][v]}l[c]=l[c]||{},h.e(l[c],f)}if(this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0)for(const c in t)t[c].setFeatureState(l,n)}}class Ie extends h.E{constructor(t,n,l){super(),this.id=t,this.dispatcher=l,this.on("data",c=>{c.dataType==="source"&&c.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&c.dataType==="source"&&c.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((c,f,v,b)=>{const A=new(_n(f.type))(c,f,v,b);if(A.id!==c)throw new Error(`Expected Source id to be ${c} instead of ${A.id}`);return A})(t,n,l,this),this._tiles={},this._cache=new Cs(0,c=>this._unloadTile(c)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new xn,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t in this._tiles){const n=this._tiles[t];if(n.state!=="loaded"&&n.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,n,l){return h._(this,void 0,void 0,function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,n,l)}catch(c){t.state="errored",c.status!==404?this._source.fire(new h.j(c,{tile:t})):this.update(this.transform,this.terrain)}})}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new h.k("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const l=this._tiles[n];l.upload(t),l.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(nt).map(t=>t.key)}getRenderableIds(t){const n=[];for(const l in this._tiles)this._isIdRenderable(l,t)&&n.push(this._tiles[l]);return t?n.sort((l,c)=>{const f=l.tileID,v=c.tileID,b=new h.P(f.canonical.x,f.canonical.y)._rotate(this.transform.angle),A=new h.P(v.canonical.x,v.canonical.y)._rotate(this.transform.angle);return f.overscaledZ-v.overscaledZ||A.y-b.y||A.x-b.x}).map(l=>l.tileID.key):n.map(l=>l.tileID).sort(nt).map(l=>l.key)}hasRenderableParent(t){const n=this.findLoadedParent(t,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(t,n){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(n||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(t,"reloading")}}_reloadTile(t,n){return h._(this,void 0,void 0,function*(){const l=this._tiles[t];l&&(l.state!=="loading"&&(l.state=n),yield this._loadTile(l,t,n))})}_tileLoaded(t,n,l){t.timeAdded=Q.now(),l==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(n,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new h.k("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const n=this.getRenderableIds();for(let c=0;c<n.length;c++){const f=n[c];if(t.neighboringTiles&&t.neighboringTiles[f]){const v=this.getTileByID(f);l(t,v),l(v,t)}}function l(c,f){c.needsHillshadePrepare=!0,c.needsTerrainPrepare=!0;let v=f.tileID.canonical.x-c.tileID.canonical.x;const b=f.tileID.canonical.y-c.tileID.canonical.y,A=Math.pow(2,c.tileID.canonical.z),I=f.tileID.key;v===0&&b===0||Math.abs(b)>1||(Math.abs(v)>1&&(Math.abs(v+A)===1?v+=A:Math.abs(v-A)===1&&(v-=A)),f.dem&&c.dem&&(c.dem.backfillBorder(f.dem,v,b),c.neighboringTiles&&c.neighboringTiles[I]&&(c.neighboringTiles[I].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,n,l,c){for(const f in this._tiles){let v=this._tiles[f];if(c[f]||!v.hasData()||v.tileID.overscaledZ<=n||v.tileID.overscaledZ>l)continue;let b=v.tileID;for(;v&&v.tileID.overscaledZ>n+1;){const I=v.tileID.scaledTo(v.tileID.overscaledZ-1);v=this._tiles[I.key],v&&v.hasData()&&(b=I)}let A=b;for(;A.overscaledZ>n;)if(A=A.scaledTo(A.overscaledZ-1),t[A.key]){c[b.key]=b;break}}}findLoadedParent(t,n){if(t.key in this._loadedParentTiles){const l=this._loadedParentTiles[t.key];return l&&l.tileID.overscaledZ>=n?l:null}for(let l=t.overscaledZ-1;l>=n;l--){const c=t.scaledTo(l),f=this._getLoadedTile(c);if(f)return f}}_getLoadedTile(t){const n=this._tiles[t.key];return n&&n.hasData()?n:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const n=Math.ceil(t.width/this._source.tileSize)+1,l=Math.ceil(t.height/this._source.tileSize)+1,c=Math.floor(n*l*(this._maxTileCacheZoomLevels===null?h.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),f=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,c):c;this._cache.setMaxSize(f)}handleWrapJump(t){const n=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,n){const l={};for(const c in this._tiles){const f=this._tiles[c];f.tileID=f.tileID.unwrapTo(f.tileID.wrap+n),l[f.tileID.key]=f}this._tiles=l;for(const c in this._timers)clearTimeout(this._timers[c]),delete this._timers[c];for(const c in this._tiles)this._setTileReloadTimer(c,this._tiles[c])}}update(t,n){if(this.transform=t,this.terrain=n,!this._sourceLoaded||this._paused)return;let l;this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?l=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(M=>new h.Q(M.canonical.z,M.wrap,M.canonical.z,M.canonical.x,M.canonical.y)):(l=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:n}),this._source.hasTile&&(l=l.filter(M=>this._source.hasTile(M)))):l=[];const c=t.coveringZoomLevel(this._source),f=Math.max(c-Ie.maxOverzooming,this._source.minzoom),v=Math.max(c+Ie.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const M={};for(const k of l)if(k.canonical.z>this._source.minzoom){const L=k.scaledTo(k.canonical.z-1);M[L.key]=L;const H=k.scaledTo(Math.max(this._source.minzoom,Math.min(k.canonical.z,5)));M[H.key]=H}l=l.concat(Object.values(M))}const b=l.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,b&&this.fire(new h.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const A=this._updateRetainedTiles(l,c);if(et(this._source.type)){const M={},k={},L=Object.keys(A),H=Q.now();for(const q of L){const W=A[q],N=this._tiles[q];if(!N||N.fadeEndTime!==0&&N.fadeEndTime<=H)continue;const te=this.findLoadedParent(W,f);te&&(this._addTile(te.tileID),M[te.tileID.key]=te.tileID),k[q]=W}this._retainLoadedChildren(k,c,v,A);for(const q in M)A[q]||(this._coveredTiles[q]=!0,A[q]=M[q]);if(n){const q={},W={};for(const N of l)this._tiles[N.key].hasData()?q[N.key]=N:W[N.key]=N;for(const N in W){const te=W[N].children(this._source.maxzoom);this._tiles[te[0].key]&&this._tiles[te[1].key]&&this._tiles[te[2].key]&&this._tiles[te[3].key]&&(q[te[0].key]=A[te[0].key]=te[0],q[te[1].key]=A[te[1].key]=te[1],q[te[2].key]=A[te[2].key]=te[2],q[te[3].key]=A[te[3].key]=te[3],delete W[N])}for(const N in W){const te=this.findLoadedParent(W[N],this._source.minzoom);if(te){q[te.tileID.key]=A[te.tileID.key]=te.tileID;for(const ue in q)q[ue].isChildOf(te.tileID)&&delete q[ue]}}for(const N in this._tiles)q[N]||(this._coveredTiles[N]=!0)}}for(const M in A)this._tiles[M].clearFadeHold();const I=h.ab(this._tiles,A);for(const M of I){const k=this._tiles[M];k.hasSymbolBuckets&&!k.holdingForFade()?k.setHoldDuration(this.map._fadeDuration):k.hasSymbolBuckets&&!k.symbolFadeFinished()||this._removeTile(M)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,n){const l={},c={},f=Math.max(n-Ie.maxOverzooming,this._source.minzoom),v=Math.max(n+Ie.maxUnderzooming,this._source.minzoom),b={};for(const A of t){const I=this._addTile(A);l[A.key]=A,I.hasData()||n<this._source.maxzoom&&(b[A.key]=A)}this._retainLoadedChildren(b,n,v,l);for(const A of t){let I=this._tiles[A.key];if(I.hasData())continue;if(n+1>this._source.maxzoom){const k=A.children(this._source.maxzoom)[0],L=this.getTile(k);if(L&&L.hasData()){l[k.key]=k;continue}}else{const k=A.children(this._source.maxzoom);if(l[k[0].key]&&l[k[1].key]&&l[k[2].key]&&l[k[3].key])continue}let M=I.wasRequested();for(let k=A.overscaledZ-1;k>=f;--k){const L=A.scaledTo(k);if(c[L.key])break;if(c[L.key]=!0,I=this.getTile(L),!I&&M&&(I=this._addTile(L)),I){const H=I.hasData();if((M||H)&&(l[L.key]=L),M=I.wasRequested(),H)break}}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const n=[];let l,c=this._tiles[t].tileID;for(;c.overscaledZ>0;){if(c.key in this._loadedParentTiles){l=this._loadedParentTiles[c.key];break}n.push(c.key);const f=c.scaledTo(c.overscaledZ-1);if(l=this._getLoadedTile(f),l)break;c=f}for(const f of n)this._loadedParentTiles[f]=l}}_addTile(t){let n=this._tiles[t.key];if(n)return n;n=this._cache.getAndRemove(t),n&&(this._setTileReloadTimer(t.key,n),n.tileID=t,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,n)));const l=n;return n||(n=new Di(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(n,t.key,n.state)),n.uses++,this._tiles[t.key]=n,l||this._source.fire(new h.k("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n}_setTileReloadTimer(t,n){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const l=n.getExpiryTimeout();l&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},l))}_removeTile(t){const n=this._tiles[t];n&&(n.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),n.uses>0||(n.hasData()&&n.state!=="reloading"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,n,l){const c=[],f=this.transform;if(!f)return c;const v=l?f.getCameraQueryGeometry(t):t,b=t.map(q=>f.pointCoordinate(q,this.terrain)),A=v.map(q=>f.pointCoordinate(q,this.terrain)),I=this.getIds();let M=1/0,k=1/0,L=-1/0,H=-1/0;for(const q of A)M=Math.min(M,q.x),k=Math.min(k,q.y),L=Math.max(L,q.x),H=Math.max(H,q.y);for(let q=0;q<I.length;q++){const W=this._tiles[I[q]];if(W.holdingForFade())continue;const N=W.tileID,te=Math.pow(2,f.zoom-W.tileID.overscaledZ),ue=n*W.queryPadding*h.W/W.tileSize/te,X=[N.getTilePoint(new h.Y(M,k)),N.getTilePoint(new h.Y(L,H))];if(X[0].x-ue<h.W&&X[0].y-ue<h.W&&X[1].x+ue>=0&&X[1].y+ue>=0){const ae=b.map(de=>N.getTilePoint(de)),he=A.map(de=>N.getTilePoint(de));c.push({tile:W,tileID:N,queryGeometry:ae,cameraQueryGeometry:he,scale:te})}}return c}getVisibleCoordinates(t){const n=this.getRenderableIds(t).map(l=>this._tiles[l].tileID);for(const l of n)l.posMatrix=this.transform.calculatePosMatrix(l.toUnwrapped());return n}hasTransition(){if(this._source.hasTransition())return!0;if(et(this._source.type)){const t=Q.now();for(const n in this._tiles)if(this._tiles[n].fadeEndTime>=t)return!0}return!1}setFeatureState(t,n,l){this._state.updateState(t=t||"_geojsonTileLayer",n,l)}removeFeatureState(t,n,l){this._state.removeFeatureState(t=t||"_geojsonTileLayer",n,l)}getFeatureState(t,n){return this._state.getState(t=t||"_geojsonTileLayer",n)}setDependencies(t,n,l){const c=this._tiles[t];c&&c.setDependencies(n,l)}reloadTilesForDependencies(t,n){for(const l in this._tiles)this._tiles[l].hasDependency(t,n)&&this._reloadTile(l,"reloading");this._cache.filter(l=>!l.hasDependency(t,n))}}function nt(p,t){const n=Math.abs(2*p.wrap)-+(p.wrap<0),l=Math.abs(2*t.wrap)-+(t.wrap<0);return p.overscaledZ-t.overscaledZ||l-n||t.canonical.y-p.canonical.y||t.canonical.x-p.canonical.x}function et(p){return p==="raster"||p==="image"||p==="video"}Ie.maxOverzooming=10,Ie.maxUnderzooming=3;class hi{constructor(t,n){this.reset(t,n)}reset(t,n){this.points=t||[],this._distances=[0];for(let l=1;l<this.points.length;l++)this._distances[l]=this._distances[l-1]+this.points[l].dist(this.points[l-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(n||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=h.ac(t,0,1);let n=1,l=this._distances[n];const c=t*this.paddedLength+this.padding;for(;l<c&&n<this._distances.length;)l=this._distances[++n];const f=n-1,v=this._distances[f],b=l-v,A=b>0?(c-v)/b:0;return this.points[f].mult(1-A).add(this.points[n].mult(A))}}function rr(p,t){let n=!0;return p==="always"||p!=="never"&&t!=="never"||(n=!1),n}class tt{constructor(t,n,l){const c=this.boxCells=[],f=this.circleCells=[];this.xCellCount=Math.ceil(t/l),this.yCellCount=Math.ceil(n/l);for(let v=0;v<this.xCellCount*this.yCellCount;v++)c.push([]),f.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=n,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/n,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,n,l,c,f){this._forEachCell(n,l,c,f,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(n),this.bboxes.push(l),this.bboxes.push(c),this.bboxes.push(f)}insertCircle(t,n,l,c){this._forEachCell(n-c,l-c,n+c,l+c,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(n),this.circles.push(l),this.circles.push(c)}_insertBoxCell(t,n,l,c,f,v){this.boxCells[f].push(v)}_insertCircleCell(t,n,l,c,f,v){this.circleCells[f].push(v)}_query(t,n,l,c,f,v,b){if(l<0||t>this.width||c<0||n>this.height)return[];const A=[];if(t<=0&&n<=0&&this.width<=l&&this.height<=c){if(f)return[{key:null,x1:t,y1:n,x2:l,y2:c}];for(let I=0;I<this.boxKeys.length;I++)A.push({key:this.boxKeys[I],x1:this.bboxes[4*I],y1:this.bboxes[4*I+1],x2:this.bboxes[4*I+2],y2:this.bboxes[4*I+3]});for(let I=0;I<this.circleKeys.length;I++){const M=this.circles[3*I],k=this.circles[3*I+1],L=this.circles[3*I+2];A.push({key:this.circleKeys[I],x1:M-L,y1:k-L,x2:M+L,y2:k+L})}}else this._forEachCell(t,n,l,c,this._queryCell,A,{hitTest:f,overlapMode:v,seenUids:{box:{},circle:{}}},b);return A}query(t,n,l,c){return this._query(t,n,l,c,!1,null)}hitTest(t,n,l,c,f,v){return this._query(t,n,l,c,!0,f,v).length>0}hitTestCircle(t,n,l,c,f){const v=t-l,b=t+l,A=n-l,I=n+l;if(b<0||v>this.width||I<0||A>this.height)return!1;const M=[];return this._forEachCell(v,A,b,I,this._queryCellCircle,M,{hitTest:!0,overlapMode:c,circle:{x:t,y:n,radius:l},seenUids:{box:{},circle:{}}},f),M.length>0}_queryCell(t,n,l,c,f,v,b,A){const{seenUids:I,hitTest:M,overlapMode:k}=b,L=this.boxCells[f];if(L!==null){const q=this.bboxes;for(const W of L)if(!I.box[W]){I.box[W]=!0;const N=4*W,te=this.boxKeys[W];if(t<=q[N+2]&&n<=q[N+3]&&l>=q[N+0]&&c>=q[N+1]&&(!A||A(te))&&(!M||!rr(k,te.overlapMode))&&(v.push({key:te,x1:q[N],y1:q[N+1],x2:q[N+2],y2:q[N+3]}),M))return!0}}const H=this.circleCells[f];if(H!==null){const q=this.circles;for(const W of H)if(!I.circle[W]){I.circle[W]=!0;const N=3*W,te=this.circleKeys[W];if(this._circleAndRectCollide(q[N],q[N+1],q[N+2],t,n,l,c)&&(!A||A(te))&&(!M||!rr(k,te.overlapMode))){const ue=q[N],X=q[N+1],ae=q[N+2];if(v.push({key:te,x1:ue-ae,y1:X-ae,x2:ue+ae,y2:X+ae}),M)return!0}}}return!1}_queryCellCircle(t,n,l,c,f,v,b,A){const{circle:I,seenUids:M,overlapMode:k}=b,L=this.boxCells[f];if(L!==null){const q=this.bboxes;for(const W of L)if(!M.box[W]){M.box[W]=!0;const N=4*W,te=this.boxKeys[W];if(this._circleAndRectCollide(I.x,I.y,I.radius,q[N+0],q[N+1],q[N+2],q[N+3])&&(!A||A(te))&&!rr(k,te.overlapMode))return v.push(!0),!0}}const H=this.circleCells[f];if(H!==null){const q=this.circles;for(const W of H)if(!M.circle[W]){M.circle[W]=!0;const N=3*W,te=this.circleKeys[W];if(this._circlesCollide(q[N],q[N+1],q[N+2],I.x,I.y,I.radius)&&(!A||A(te))&&!rr(k,te.overlapMode))return v.push(!0),!0}}}_forEachCell(t,n,l,c,f,v,b,A){const I=this._convertToXCellCoord(t),M=this._convertToYCellCoord(n),k=this._convertToXCellCoord(l),L=this._convertToYCellCoord(c);for(let H=I;H<=k;H++)for(let q=M;q<=L;q++)if(f.call(this,t,n,l,c,this.xCellCount*q+H,v,b,A))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,n,l,c,f,v){const b=c-t,A=f-n,I=l+v;return I*I>b*b+A*A}_circleAndRectCollide(t,n,l,c,f,v,b){const A=(v-c)/2,I=Math.abs(t-(c+A));if(I>A+l)return!1;const M=(b-f)/2,k=Math.abs(n-(f+M));if(k>M+l)return!1;if(I<=A||k<=M)return!0;const L=I-A,H=k-M;return L*L+H*H<=l*l}}function Yr(p,t,n,l,c){const f=h.F();return t?(h.J(f,f,[1/c,1/c,1]),n||h.ad(f,f,l.angle)):h.K(f,l.labelPlaneMatrix,p),f}function Lr(p,t,n,l,c){if(t){const f=h.ae(p);return h.J(f,f,[c,c,1]),n||h.ad(f,f,-l.angle),f}return l.glCoordMatrix}function G(p,t,n){let l;n?(l=[p.x,p.y,n(p.x,p.y),1],h.af(l,l,t)):(l=[p.x,p.y,0,1],Ke(l,l,t));const c=l[3];return{point:new h.P(l[0]/c,l[1]/c),signedDistanceFromCamera:c}}function D(p,t){return .5+p/t*.5}function z(p,t){const n=p[0]/p[3],l=p[1]/p[3];return n>=-t[0]&&n<=t[0]&&l>=-t[1]&&l<=t[1]}function $(p,t,n,l,c,f,v,b,A,I){const M=l?p.textSizeData:p.iconSizeData,k=h.ag(M,n.transform.zoom),L=[256/n.width*2+1,256/n.height*2+1],H=l?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;H.clear();const q=p.lineVertexArray,W=l?p.text.placedSymbolArray:p.icon.placedSymbolArray,N=n.transform.width/n.transform.height;let te=!1;for(let ue=0;ue<W.length;ue++){const X=W.get(ue);if(X.hidden||X.writingMode===h.ah.vertical&&!te){Ue(X.numGlyphs,H);continue}let ae;if(te=!1,I?(ae=[X.anchorX,X.anchorY,I(X.anchorX,X.anchorY),1],h.af(ae,ae,t)):(ae=[X.anchorX,X.anchorY,0,1],Ke(ae,ae,t)),!z(ae,L)){Ue(X.numGlyphs,H);continue}const he=D(n.transform.cameraToCenterDistance,ae[3]),de=h.ai(M,k,X),pe=v?de/he:de*he,Se=new h.P(X.anchorX,X.anchorY),ve=G(Se,c,I).point,we={projections:{},offsets:{}},Fe=ne(X,pe,!1,b,t,c,f,p.glyphOffsetArray,q,H,ve,Se,we,N,A,I);te=Fe.useVertical,(Fe.notEnoughRoom||te||Fe.needsFlipping&&ne(X,pe,!0,b,t,c,f,p.glyphOffsetArray,q,H,ve,Se,we,N,A,I).notEnoughRoom)&&Ue(X.numGlyphs,H)}l?p.text.dynamicLayoutVertexBuffer.updateData(H):p.icon.dynamicLayoutVertexBuffer.updateData(H)}function j(p,t,n,l,c,f,v,b,A,I,M,k,L){const H=b.glyphStartIndex+b.numGlyphs,q=b.lineStartIndex,W=b.lineStartIndex+b.lineLength,N=t.getoffsetX(b.glyphStartIndex),te=t.getoffsetX(H-1),ue=me(p*N,n,l,c,f,v,b.segment,q,W,A,I,M,k,L);if(!ue)return null;const X=me(p*te,n,l,c,f,v,b.segment,q,W,A,I,M,k,L);return X?{first:ue,last:X}:null}function re(p,t,n,l){return p===h.ah.horizontal&&Math.abs(n.y-t.y)>Math.abs(n.x-t.x)*l?{useVertical:!0}:(p===h.ah.vertical?t.y<n.y:t.x>n.x)?{needsFlipping:!0}:null}function ne(p,t,n,l,c,f,v,b,A,I,M,k,L,H,q,W){const N=t/24,te=p.lineOffsetX*N,ue=p.lineOffsetY*N;let X;if(p.numGlyphs>1){const ae=p.glyphStartIndex+p.numGlyphs,he=p.lineStartIndex,de=p.lineStartIndex+p.lineLength,pe=j(N,b,te,ue,n,M,k,p,A,f,L,q,W);if(!pe)return{notEnoughRoom:!0};const Se=G(pe.first.point,v,W).point,ve=G(pe.last.point,v,W).point;if(l&&!n){const we=re(p.writingMode,Se,ve,H);if(we)return we}X=[pe.first];for(let we=p.glyphStartIndex+1;we<ae-1;we++)X.push(me(N*b.getoffsetX(we),te,ue,n,M,k,p.segment,he,de,A,f,L,q,W));X.push(pe.last)}else{if(l&&!n){const he=G(k,c,W).point,de=p.lineStartIndex+p.segment+1,pe=new h.P(A.getx(de),A.gety(de)),Se=G(pe,c,W),ve=Se.signedDistanceFromCamera>0?Se.point:oe(k,pe,he,1,c,W),we=re(p.writingMode,he,ve,H);if(we)return we}const ae=me(N*b.getoffsetX(p.glyphStartIndex),te,ue,n,M,k,p.segment,p.lineStartIndex,p.lineStartIndex+p.lineLength,A,f,L,q,W);if(!ae)return{notEnoughRoom:!0};X=[ae]}for(const ae of X)h.aj(I,ae.point,ae.angle);return{}}function oe(p,t,n,l,c,f){const v=G(p.add(p.sub(t)._unit()),c,f).point,b=n.sub(v);return n.add(b._mult(l/b.mag()))}function ee(p,t){const{projectionCache:n,lineVertexArray:l,labelPlaneMatrix:c,tileAnchorPoint:f,distanceFromAnchor:v,getElevation:b,previousVertex:A,direction:I,absOffsetX:M}=t;if(n.projections[p])return n.projections[p];const k=new h.P(l.getx(p),l.gety(p)),L=G(k,c,b);if(L.signedDistanceFromCamera>0)return n.projections[p]=L.point,L.point;const H=p-I;return oe(v===0?f:new h.P(l.getx(H),l.gety(H)),k,A,M-v+1,c,b)}function ce(p,t,n){return p._unit()._perp()._mult(t*n)}function be(p,t,n,l,c,f,v,b){const{projectionCache:A,direction:I}=b;if(A.offsets[p])return A.offsets[p];const M=n.add(t);if(p+I<l||p+I>=c)return A.offsets[p]=M,M;const k=ee(p+I,b),L=ce(k.sub(n),v,I),H=n.add(L),q=k.add(L);return A.offsets[p]=h.ak(f,M,H,q)||M,A.offsets[p]}function me(p,t,n,l,c,f,v,b,A,I,M,k,L,H){const q=l?p-t:p+t;let W=q>0?1:-1,N=0;l&&(W*=-1,N=Math.PI),W<0&&(N+=Math.PI);let te,ue,X=W>0?b+v:b+v+1,ae=c,he=c,de=0,pe=0;const Se=Math.abs(q),ve=[];let we;for(;de+pe<=Se;){if(X+=W,X<b||X>=A)return null;de+=pe,he=ae,ue=te;const ke={projectionCache:k,lineVertexArray:I,labelPlaneMatrix:M,tileAnchorPoint:f,distanceFromAnchor:de,getElevation:H,previousVertex:he,direction:W,absOffsetX:Se};if(ae=ee(X,ke),n===0)ve.push(he),we=ae.sub(he);else{let We;const rt=ae.sub(he);We=rt.mag()===0?ce(ee(X+W,ke).sub(ae),n,W):ce(rt,n,W),ue||(ue=he.add(We)),te=be(X,We,ae,b,A,ue,n,ke),ve.push(ue),we=te.sub(ue)}pe=we.mag()}const Fe=we._mult((Se-de)/pe)._add(ue||he),Qe=N+Math.atan2(ae.y-he.y,ae.x-he.x);return ve.push(Fe),{point:Fe,angle:L?Qe:0,path:ve}}const _e=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ue(p,t){for(let n=0;n<p;n++){const l=t.length;t.resize(l+4),t.float32.set(_e,3*l)}}function Ke(p,t,n){const l=t[0],c=t[1];return p[0]=n[0]*l+n[4]*c+n[12],p[1]=n[1]*l+n[5]*c+n[13],p[3]=n[3]*l+n[7]*c+n[15],p}const Ze=100;class dt{constructor(t,n=new tt(t.width+200,t.height+200,25),l=new tt(t.width+200,t.height+200,25)){this.transform=t,this.grid=n,this.ignoredGrid=l,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Ze,this.screenBottomBoundary=t.height+Ze,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,n,l,c,f,v){const b=this.projectAndGetPerspectiveRatio(c,t.anchorPointX,t.anchorPointY,v),A=l*b.perspectiveRatio,I=t.x1*A+b.point.x,M=t.y1*A+b.point.y,k=t.x2*A+b.point.x,L=t.y2*A+b.point.y;return!this.isInsideGrid(I,M,k,L)||n!=="always"&&this.grid.hitTest(I,M,k,L,n,f)||b.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[I,M,k,L],offscreen:this.isOffscreen(I,M,k,L)}}placeCollisionCircles(t,n,l,c,f,v,b,A,I,M,k,L,H,q){const W=[],N=new h.P(n.anchorX,n.anchorY),te=G(N,v,q),ue=D(this.transform.cameraToCenterDistance,te.signedDistanceFromCamera),X=(M?f/ue:f*ue)/h.ao,ae=G(N,b,q).point,he=j(X,c,n.lineOffsetX*X,n.lineOffsetY*X,!1,ae,N,n,l,b,{projections:{},offsets:{}},!1,q);let de=!1,pe=!1,Se=!0;if(he){const ve=.5*L*ue+H,we=new h.P(-100,-100),Fe=new h.P(this.screenRightBoundary,this.screenBottomBoundary),Qe=new hi,ke=he.first,We=he.last;let rt=[];for(let st=ke.path.length-1;st>=1;st--)rt.push(ke.path[st]);for(let st=1;st<We.path.length;st++)rt.push(We.path[st]);const ct=2.5*ve;if(A){const st=rt.map(at=>G(at,A,q));rt=st.some(at=>at.signedDistanceFromCamera<=0)?[]:st.map(at=>at.point)}let Xe=[];if(rt.length>0){const st=rt[0].clone(),at=rt[0].clone();for(let Ft=1;Ft<rt.length;Ft++)st.x=Math.min(st.x,rt[Ft].x),st.y=Math.min(st.y,rt[Ft].y),at.x=Math.max(at.x,rt[Ft].x),at.y=Math.max(at.y,rt[Ft].y);Xe=st.x>=we.x&&at.x<=Fe.x&&st.y>=we.y&&at.y<=Fe.y?[rt]:at.x<we.x||st.x>Fe.x||at.y<we.y||st.y>Fe.y?[]:h.al([rt],we.x,we.y,Fe.x,Fe.y)}for(const st of Xe){Qe.reset(st,.25*ve);let at=0;at=Qe.length<=.5*ve?1:Math.ceil(Qe.paddedLength/ct)+1;for(let Ft=0;Ft<at;Ft++){const At=Ft/Math.max(at-1,1),Li=Qe.lerp(At),Yt=Li.x+Ze,It=Li.y+Ze;W.push(Yt,It,ve,0);const _i=Yt-ve,fr=It-ve,Pr=Yt+ve,Mn=It+ve;if(Se=Se&&this.isOffscreen(_i,fr,Pr,Mn),pe=pe||this.isInsideGrid(_i,fr,Pr,Mn),t!=="always"&&this.grid.hitTestCircle(Yt,It,ve,t,k)&&(de=!0,!I))return{circles:[],offscreen:!1,collisionDetected:de}}}}return{circles:!I&&de||!pe||ue<this.perspectiveRatioCutoff?[]:W,offscreen:Se,collisionDetected:de}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const n=[];let l=1/0,c=1/0,f=-1/0,v=-1/0;for(const M of t){const k=new h.P(M.x+Ze,M.y+Ze);l=Math.min(l,k.x),c=Math.min(c,k.y),f=Math.max(f,k.x),v=Math.max(v,k.y),n.push(k)}const b=this.grid.query(l,c,f,v).concat(this.ignoredGrid.query(l,c,f,v)),A={},I={};for(const M of b){const k=M.key;if(A[k.bucketInstanceId]===void 0&&(A[k.bucketInstanceId]={}),A[k.bucketInstanceId][k.featureIndex])continue;const L=[new h.P(M.x1,M.y1),new h.P(M.x2,M.y1),new h.P(M.x2,M.y2),new h.P(M.x1,M.y2)];h.am(n,L)&&(A[k.bucketInstanceId][k.featureIndex]=!0,I[k.bucketInstanceId]===void 0&&(I[k.bucketInstanceId]=[]),I[k.bucketInstanceId].push(k.featureIndex))}return I}insertCollisionBox(t,n,l,c,f,v){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:f,collisionGroupID:v,overlapMode:n},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,n,l,c,f,v){const b=l?this.ignoredGrid:this.grid,A={bucketInstanceId:c,featureIndex:f,collisionGroupID:v,overlapMode:n};for(let I=0;I<t.length;I+=4)b.insertCircle(A,t[I],t[I+1],t[I+2])}projectAndGetPerspectiveRatio(t,n,l,c){let f;return c?(f=[n,l,c(n,l),1],h.af(f,f,t)):(f=[n,l,0,1],Ke(f,f,t)),{point:new h.P((f[0]/f[3]+1)/2*this.transform.width+Ze,(-f[1]/f[3]+1)/2*this.transform.height+Ze),perspectiveRatio:.5+this.transform.cameraToCenterDistance/f[3]*.5}}isOffscreen(t,n,l,c){return l<Ze||t>=this.screenRightBoundary||c<Ze||n>this.screenBottomBoundary}isInsideGrid(t,n,l,c){return l>=0&&t<this.gridRightBoundary&&c>=0&&n<this.gridBottomBoundary}getViewportMatrix(){const t=h.an([]);return h.H(t,t,[-100,-100,0]),t}}function Je(p,t,n){return t*(h.W/(p.tileSize*Math.pow(2,n-p.tileID.overscaledZ)))}class Ct{constructor(t,n,l,c){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?n:-n))):c&&l?1:0,this.placed=l}isHidden(){return this.opacity===0&&!this.placed}}class St{constructor(t,n,l,c,f){this.text=new Ct(t?t.text:null,n,l,f),this.icon=new Ct(t?t.icon:null,n,c,f)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ht{constructor(t,n,l){this.text=t,this.icon=n,this.skipFade=l}}class it{constructor(){this.invProjMatrix=h.F(),this.viewportMatrix=h.F(),this.circles=[]}}class Ot{constructor(t,n,l,c,f){this.bucketInstanceId=t,this.featureIndex=n,this.sourceLayerIndex=l,this.bucketIndex=c,this.tileID=f}}class oi{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const n=++this.maxGroupID;this.collisionGroups[t]={ID:n,predicate:l=>l.collisionGroupID===n}}return this.collisionGroups[t]}}function Ri(p,t,n,l,c){const{horizontalAlign:f,verticalAlign:v}=h.at(p);return new h.P(-(f-.5)*t+l[0]*c,-(v-.5)*n+l[1]*c)}function gi(p,t,n,l,c,f){const{x1:v,x2:b,y1:A,y2:I,anchorPointX:M,anchorPointY:k}=p,L=new h.P(t,n);return l&&L._rotate(c?f:-f),{x1:v+L.x,y1:A+L.y,x2:b+L.x,y2:I+L.y,anchorPointX:M,anchorPointY:k}}class wi{constructor(t,n,l,c,f){this.transform=t.clone(),this.terrain=n,this.collisionIndex=new dt(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new oi(c),this.collisionCircleArrays={},this.prevPlacement=f,f&&(f.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,n,l,c){const f=l.getBucket(n),v=l.latestFeatureIndex;if(!f||!v||n.id!==f.layerIds[0])return;const b=l.collisionBoxArray,A=f.layers[0].layout,I=Math.pow(2,this.transform.zoom-l.tileID.overscaledZ),M=l.tileSize/h.W,k=this.transform.calculatePosMatrix(l.tileID.toUnwrapped()),L=A.get("text-pitch-alignment")==="map",H=A.get("text-rotation-alignment")==="map",q=Je(l,1,this.transform.zoom),W=Yr(k,L,H,this.transform,q);let N=null;if(L){const ue=Lr(k,L,H,this.transform,q);N=h.K([],this.transform.labelPlaneMatrix,ue)}this.retainedQueryData[f.bucketInstanceId]=new Ot(f.bucketInstanceId,v,f.sourceLayerIndex,f.index,l.tileID);const te={bucket:f,layout:A,posMatrix:k,textLabelPlaneMatrix:W,labelToScreenMatrix:N,scale:I,textPixelRatio:M,holdingForFade:l.holdingForFade(),collisionBoxArray:b,partiallyEvaluatedTextSize:h.ag(f.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(f.sourceID)};if(c)for(const ue of f.sortKeyRanges){const{sortKey:X,symbolInstanceStart:ae,symbolInstanceEnd:he}=ue;t.push({sortKey:X,symbolInstanceStart:ae,symbolInstanceEnd:he,parameters:te})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:f.symbolInstances.length,parameters:te})}attemptAnchorPlacement(t,n,l,c,f,v,b,A,I,M,k,L,H,q,W,N){const te=h.ap[t.textAnchor],ue=[t.textOffset0,t.textOffset1],X=Ri(te,l,c,ue,f),ae=this.collisionIndex.placeCollisionBox(gi(n,X.x,X.y,v,b,this.transform.angle),k,A,I,M.predicate,N);if((!W||this.collisionIndex.placeCollisionBox(gi(W,X.x,X.y,v,b,this.transform.angle),k,A,I,M.predicate,N).box.length!==0)&&ae.box.length>0){let he;if(this.prevPlacement&&this.prevPlacement.variableOffsets[L.crossTileID]&&this.prevPlacement.placements[L.crossTileID]&&this.prevPlacement.placements[L.crossTileID].text&&(he=this.prevPlacement.variableOffsets[L.crossTileID].anchor),L.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[L.crossTileID]={textOffset:ue,width:l,height:c,anchor:te,textBoxScale:f,prevAnchor:he},this.markUsedJustification(H,te,L,q),H.allowVerticalPlacement&&(this.markUsedOrientation(H,q,L),this.placedOrientations[L.crossTileID]=q),{shift:X,placedGlyphBoxes:ae}}}placeLayerBucketPart(t,n,l){const{bucket:c,layout:f,posMatrix:v,textLabelPlaneMatrix:b,labelToScreenMatrix:A,textPixelRatio:I,holdingForFade:M,collisionBoxArray:k,partiallyEvaluatedTextSize:L,collisionGroup:H}=t.parameters,q=f.get("text-optional"),W=f.get("icon-optional"),N=h.aq(f,"text-overlap","text-allow-overlap"),te=N==="always",ue=h.aq(f,"icon-overlap","icon-allow-overlap"),X=ue==="always",ae=f.get("text-rotation-alignment")==="map",he=f.get("text-pitch-alignment")==="map",de=f.get("icon-text-fit")!=="none",pe=f.get("symbol-z-order")==="viewport-y",Se=te&&(X||!c.hasIconData()||W),ve=X&&(te||!c.hasTextData()||q);!c.collisionArrays&&k&&c.deserializeCollisionBoxes(k);const we=this.retainedQueryData[c.bucketInstanceId].tileID,Fe=this.terrain?(ke,We)=>this.terrain.getElevation(we,ke,We):null,Qe=(ke,We)=>{var rt,ct;if(n[ke.crossTileID])return;if(M)return void(this.placements[ke.crossTileID]=new Ht(!1,!1,!1));let Xe=!1,st=!1,at=!0,Ft=null,At={box:null,offscreen:null},Li={box:null,offscreen:null},Yt=null,It=null,_i=null,fr=0,Pr=0,Mn=0;We.textFeatureIndex?fr=We.textFeatureIndex:ke.useRuntimeCollisionCircles&&(fr=ke.featureIndex),We.verticalTextFeatureIndex&&(Pr=We.verticalTextFeatureIndex);const kn=We.textBox;if(kn){const Nt=Dt=>{let ci=h.ah.horizontal;if(c.allowVerticalPlacement&&!Dt&&this.prevPlacement){const Xi=this.prevPlacement.placedOrientations[ke.crossTileID];Xi&&(this.placedOrientations[ke.crossTileID]=Xi,ci=Xi,this.markUsedOrientation(c,ci,ke))}return ci},Mt=(Dt,ci)=>{if(c.allowVerticalPlacement&&ke.numVerticalGlyphVertices>0&&We.verticalTextBox){for(const Xi of c.writingModes)if(Xi===h.ah.vertical?(At=ci(),Li=At):At=Dt(),At&&At.box&&At.box.length)break}else At=Dt()},qt=ke.textAnchorOffsetStartIndex,hs=ke.textAnchorOffsetEndIndex;if(hs===qt){const Dt=(ci,Xi)=>{const lt=this.collisionIndex.placeCollisionBox(ci,N,I,v,H.predicate,Fe);return lt&&lt.box&&lt.box.length&&(this.markUsedOrientation(c,Xi,ke),this.placedOrientations[ke.crossTileID]=Xi),lt};Mt(()=>Dt(kn,h.ah.horizontal),()=>{const ci=We.verticalTextBox;return c.allowVerticalPlacement&&ke.numVerticalGlyphVertices>0&&ci?Dt(ci,h.ah.vertical):{box:null,offscreen:null}}),Nt(At&&At.box&&At.box.length)}else{let Dt=h.ap[(ct=(rt=this.prevPlacement)===null||rt===void 0?void 0:rt.variableOffsets[ke.crossTileID])===null||ct===void 0?void 0:ct.anchor];const ci=(lt,Uo,bc)=>{const Dn=lt.x2-lt.x1,Rn=lt.y2-lt.y1,Ma=ke.textBoxScale,Vo=de&&ue==="never"?Uo:null;let zn={box:[],offscreen:!1},wc=N==="never"?1:2,jo="never";Dt&&wc++;for(let Sc=0;Sc<wc;Sc++){for(let Hs=qt;Hs<hs;Hs++){const Tc=c.textAnchorOffsets.get(Hs);if(Dt&&Tc.textAnchor!==Dt)continue;const Zs=this.attemptAnchorPlacement(Tc,lt,Dn,Rn,Ma,ae,he,I,v,H,jo,ke,c,bc,Vo,Fe);if(Zs&&(zn=Zs.placedGlyphBoxes,zn&&zn.box&&zn.box.length))return Xe=!0,Ft=Zs.shift,zn}Dt?Dt=null:jo=N}return zn};Mt(()=>ci(kn,We.iconBox,h.ah.horizontal),()=>{const lt=We.verticalTextBox;return c.allowVerticalPlacement&&!(At&&At.box&&At.box.length)&&ke.numVerticalGlyphVertices>0&&lt?ci(lt,We.verticalIconBox,h.ah.vertical):{box:null,offscreen:null}}),At&&(Xe=At.box,at=At.offscreen);const Xi=Nt(At&&At.box);if(!Xe&&this.prevPlacement){const lt=this.prevPlacement.variableOffsets[ke.crossTileID];lt&&(this.variableOffsets[ke.crossTileID]=lt,this.markUsedJustification(c,lt.anchor,ke,Xi))}}}if(Yt=At,Xe=Yt&&Yt.box&&Yt.box.length>0,at=Yt&&Yt.offscreen,ke.useRuntimeCollisionCircles){const Nt=c.text.placedSymbolArray.get(ke.centerJustifiedTextSymbolIndex),Mt=h.ai(c.textSizeData,L,Nt),qt=f.get("text-padding");It=this.collisionIndex.placeCollisionCircles(N,Nt,c.lineVertexArray,c.glyphOffsetArray,Mt,v,b,A,l,he,H.predicate,ke.collisionCircleDiameter,qt,Fe),It.circles.length&&It.collisionDetected&&!l&&h.w("Collisions detected, but collision boxes are not shown"),Xe=te||It.circles.length>0&&!It.collisionDetected,at=at&&It.offscreen}if(We.iconFeatureIndex&&(Mn=We.iconFeatureIndex),We.iconBox){const Nt=Mt=>{const qt=de&&Ft?gi(Mt,Ft.x,Ft.y,ae,he,this.transform.angle):Mt;return this.collisionIndex.placeCollisionBox(qt,ue,I,v,H.predicate,Fe)};Li&&Li.box&&Li.box.length&&We.verticalIconBox?(_i=Nt(We.verticalIconBox),st=_i.box.length>0):(_i=Nt(We.iconBox),st=_i.box.length>0),at=at&&_i.offscreen}const Mr=q||ke.numHorizontalGlyphVertices===0&&ke.numVerticalGlyphVertices===0,mr=W||ke.numIconVertices===0;if(Mr||mr?mr?Mr||(st=st&&Xe):Xe=st&&Xe:st=Xe=st&&Xe,Xe&&Yt&&Yt.box&&this.collisionIndex.insertCollisionBox(Yt.box,N,f.get("text-ignore-placement"),c.bucketInstanceId,Li&&Li.box&&Pr?Pr:fr,H.ID),st&&_i&&this.collisionIndex.insertCollisionBox(_i.box,ue,f.get("icon-ignore-placement"),c.bucketInstanceId,Mn,H.ID),It&&(Xe&&this.collisionIndex.insertCollisionCircles(It.circles,N,f.get("text-ignore-placement"),c.bucketInstanceId,fr,H.ID),l)){const Nt=c.bucketInstanceId;let Mt=this.collisionCircleArrays[Nt];Mt===void 0&&(Mt=this.collisionCircleArrays[Nt]=new it);for(let qt=0;qt<It.circles.length;qt+=4)Mt.circles.push(It.circles[qt+0]),Mt.circles.push(It.circles[qt+1]),Mt.circles.push(It.circles[qt+2]),Mt.circles.push(It.collisionDetected?1:0)}if(ke.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(c.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[ke.crossTileID]=new Ht(Xe||Se,st||ve,at||c.justReloaded),n[ke.crossTileID]=!0};if(pe){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const ke=c.getSortedSymbolIndexes(this.transform.angle);for(let We=ke.length-1;We>=0;--We){const rt=ke[We];Qe(c.symbolInstances.get(rt),c.collisionArrays[rt])}}else for(let ke=t.symbolInstanceStart;ke<t.symbolInstanceEnd;ke++)Qe(c.symbolInstances.get(ke),c.collisionArrays[ke]);if(l&&c.bucketInstanceId in this.collisionCircleArrays){const ke=this.collisionCircleArrays[c.bucketInstanceId];h.ar(ke.invProjMatrix,v),ke.viewportMatrix=this.collisionIndex.getViewportMatrix()}c.justReloaded=!1}markUsedJustification(t,n,l,c){let f;f=c===h.ah.vertical?l.verticalPlacedTextSymbolIndex:{left:l.leftJustifiedTextSymbolIndex,center:l.centerJustifiedTextSymbolIndex,right:l.rightJustifiedTextSymbolIndex}[h.as(n)];const v=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex,l.verticalPlacedTextSymbolIndex];for(const b of v)b>=0&&(t.text.placedSymbolArray.get(b).crossTileID=f>=0&&b!==f?0:l.crossTileID)}markUsedOrientation(t,n,l){const c=n===h.ah.horizontal||n===h.ah.horizontalOnly?n:0,f=n===h.ah.vertical?n:0,v=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex];for(const b of v)t.text.placedSymbolArray.get(b).placedOrientation=c;l.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(l.verticalPlacedTextSymbolIndex).placedOrientation=f)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const n=this.prevPlacement;let l=!1;this.prevZoomAdjustment=n?n.zoomAdjustment(this.transform.zoom):0;const c=n?n.symbolFadeChange(t):1,f=n?n.opacities:{},v=n?n.variableOffsets:{},b=n?n.placedOrientations:{};for(const A in this.placements){const I=this.placements[A],M=f[A];M?(this.opacities[A]=new St(M,c,I.text,I.icon),l=l||I.text!==M.text.placed||I.icon!==M.icon.placed):(this.opacities[A]=new St(null,c,I.text,I.icon,I.skipFade),l=l||I.text||I.icon)}for(const A in f){const I=f[A];if(!this.opacities[A]){const M=new St(I,c,!1,!1);M.isHidden()||(this.opacities[A]=M,l=l||I.text.placed||I.icon.placed)}}for(const A in v)this.variableOffsets[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.variableOffsets[A]=v[A]);for(const A in b)this.placedOrientations[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.placedOrientations[A]=b[A]);if(n&&n.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");l?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=n?n.lastPlacementChangeTime:t)}updateLayerOpacities(t,n){const l={};for(const c of n){const f=c.getBucket(t);f&&c.latestFeatureIndex&&t.id===f.layerIds[0]&&this.updateBucketOpacities(f,l,c.collisionBoxArray)}}updateBucketOpacities(t,n,l){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const c=t.layers[0],f=c.layout,v=new St(null,0,!1,!1,!0),b=f.get("text-allow-overlap"),A=f.get("icon-allow-overlap"),I=c._unevaluatedLayout.hasValue("text-variable-anchor")||c._unevaluatedLayout.hasValue("text-variable-anchor-offset"),M=f.get("text-rotation-alignment")==="map",k=f.get("text-pitch-alignment")==="map",L=f.get("icon-text-fit")!=="none",H=new St(null,0,b&&(A||!t.hasIconData()||f.get("icon-optional")),A&&(b||!t.hasTextData()||f.get("text-optional")),!0);!t.collisionArrays&&l&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(l);const q=(W,N,te)=>{for(let ue=0;ue<N/4;ue++)W.opacityVertexArray.emplaceBack(te);W.hasVisibleVertices=W.hasVisibleVertices||te!==yi};for(let W=0;W<t.symbolInstances.length;W++){const N=t.symbolInstances.get(W),{numHorizontalGlyphVertices:te,numVerticalGlyphVertices:ue,crossTileID:X}=N;let ae=this.opacities[X];n[X]?ae=v:ae||(ae=H,this.opacities[X]=ae),n[X]=!0;const he=N.numIconVertices>0,de=this.placedOrientations[N.crossTileID],pe=de===h.ah.vertical,Se=de===h.ah.horizontal||de===h.ah.horizontalOnly;if(te>0||ue>0){const ve=Ol(ae.text);q(t.text,te,pe?yi:ve),q(t.text,ue,Se?yi:ve);const we=ae.text.isHidden();[N.rightJustifiedTextSymbolIndex,N.centerJustifiedTextSymbolIndex,N.leftJustifiedTextSymbolIndex].forEach(ke=>{ke>=0&&(t.text.placedSymbolArray.get(ke).hidden=we||pe?1:0)}),N.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(N.verticalPlacedTextSymbolIndex).hidden=we||Se?1:0);const Fe=this.variableOffsets[N.crossTileID];Fe&&this.markUsedJustification(t,Fe.anchor,N,de);const Qe=this.placedOrientations[N.crossTileID];Qe&&(this.markUsedJustification(t,"left",N,Qe),this.markUsedOrientation(t,Qe,N))}if(he){const ve=Ol(ae.icon),we=!(L&&N.verticalPlacedIconSymbolIndex&&pe);N.placedIconSymbolIndex>=0&&(q(t.icon,N.numIconVertices,we?ve:yi),t.icon.placedSymbolArray.get(N.placedIconSymbolIndex).hidden=ae.icon.isHidden()),N.verticalPlacedIconSymbolIndex>=0&&(q(t.icon,N.numVerticalIconVertices,we?yi:ve),t.icon.placedSymbolArray.get(N.verticalPlacedIconSymbolIndex).hidden=ae.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const ve=t.collisionArrays[W];if(ve){let we=new h.P(0,0);if(ve.textBox||ve.verticalTextBox){let Qe=!0;if(I){const ke=this.variableOffsets[X];ke?(we=Ri(ke.anchor,ke.width,ke.height,ke.textOffset,ke.textBoxScale),M&&we._rotate(k?this.transform.angle:-this.transform.angle)):Qe=!1}ve.textBox&&Gi(t.textCollisionBox.collisionVertexArray,ae.text.placed,!Qe||pe,we.x,we.y),ve.verticalTextBox&&Gi(t.textCollisionBox.collisionVertexArray,ae.text.placed,!Qe||Se,we.x,we.y)}const Fe=!!(!Se&&ve.verticalIconBox);ve.iconBox&&Gi(t.iconCollisionBox.collisionVertexArray,ae.icon.placed,Fe,L?we.x:0,L?we.y:0),ve.verticalIconBox&&Gi(t.iconCollisionBox.collisionVertexArray,ae.icon.placed,!Fe,L?we.x:0,L?we.y:0)}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){const W=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=W.invProjMatrix,t.placementViewportMatrix=W.viewportMatrix,t.collisionCircleArray=W.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,n){const l=this.zoomAtLastRecencyCheck===n?1-this.zoomAdjustment(n):1;return this.zoomAtLastRecencyCheck=n,this.commitTime+this.fadeDuration*l>t}setStale(){this.stale=!0}}function Gi(p,t,n,l,c){p.emplaceBack(t?1:0,n?1:0,l||0,c||0),p.emplaceBack(t?1:0,n?1:0,l||0,c||0),p.emplaceBack(t?1:0,n?1:0,l||0,c||0),p.emplaceBack(t?1:0,n?1:0,l||0,c||0)}const Fl=Math.pow(2,25),_u=Math.pow(2,24),vt=Math.pow(2,17),Ya=Math.pow(2,16),Ja=Math.pow(2,9),Hi=Math.pow(2,8),Zi=Math.pow(2,1);function Ol(p){if(p.opacity===0&&!p.placed)return 0;if(p.opacity===1&&p.placed)return 4294967295;const t=p.placed?1:0,n=Math.floor(127*p.opacity);return n*Fl+t*_u+n*vt+t*Ya+n*Ja+t*Hi+n*Zi+t}const yi=0;class nr{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,n,l,c,f){const v=this._bucketParts;for(;this._currentTileIndex<t.length;)if(n.getBucketParts(v,c,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,f())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,v.sort((b,A)=>b.sortKey-A.sortKey));this._currentPartIndex<v.length;)if(n.placeLayerBucketPart(v[this._currentPartIndex],this._seenCrossTileIDs,l),this._currentPartIndex++,f())return!0;return!1}}class $l{constructor(t,n,l,c,f,v,b,A){this.placement=new wi(t,n,v,b,A),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=f,this._done=!1}isDone(){return this._done}continuePlacement(t,n,l){const c=Q.now(),f=()=>!this._forceFullPlacement&&Q.now()-c>2;for(;this._currentPlacementIndex>=0;){const v=n[t[this._currentPlacementIndex]],b=this.placement.collisionIndex.transform.zoom;if(v.type==="symbol"&&(!v.minzoom||v.minzoom<=b)&&(!v.maxzoom||v.maxzoom>b)){if(this._inProgressLayer||(this._inProgressLayer=new nr(v)),this._inProgressLayer.continuePlacement(l[v.source],this.placement,this._showCollisionBoxes,v,f))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Jr=512/h.W/2;class Xt{constructor(t,n,l){this.tileID=t,this.bucketInstanceId=l,this._symbolsByKey={};const c=new Map;for(let f=0;f<n.length;f++){const v=n.get(f),b=v.key,A=c.get(b);A?A.push(v):c.set(b,[v])}for(const[f,v]of c){const b={positions:v.map(A=>({x:Math.floor(A.anchorX*Jr),y:Math.floor(A.anchorY*Jr)})),crossTileIDs:v.map(A=>A.crossTileID)};if(b.positions.length>128){const A=new h.au(b.positions.length,16,Uint16Array);for(const{x:I,y:M}of b.positions)A.add(I,M);A.finish(),delete b.positions,b.index=A}this._symbolsByKey[f]=b}}getScaledCoordinates(t,n){const{x:l,y:c,z:f}=this.tileID.canonical,{x:v,y:b,z:A}=n.canonical,I=Jr/Math.pow(2,A-f),M=(b*h.W+t.anchorY)*I,k=c*h.W*Jr;return{x:Math.floor((v*h.W+t.anchorX)*I-l*h.W*Jr),y:Math.floor(M-k)}}findMatches(t,n,l){const c=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z);for(let f=0;f<t.length;f++){const v=t.get(f);if(v.crossTileID)continue;const b=this._symbolsByKey[v.key];if(!b)continue;const A=this.getScaledCoordinates(v,n);if(b.index){const I=b.index.range(A.x-c,A.y-c,A.x+c,A.y+c).sort();for(const M of I){const k=b.crossTileIDs[M];if(!l[k]){l[k]=!0,v.crossTileID=k;break}}}else if(b.positions)for(let I=0;I<b.positions.length;I++){const M=b.positions[I],k=b.crossTileIDs[I];if(Math.abs(M.x-A.x)<=c&&Math.abs(M.y-A.y)<=c&&!l[k]){l[k]=!0,v.crossTileID=k;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:t})=>t)}}class Ps{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class vn{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const n=Math.round((t-this.lng)/360);if(n!==0)for(const l in this.indexes){const c=this.indexes[l],f={};for(const v in c){const b=c[v];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+n),f[b.tileID.key]=b}this.indexes[l]=f}this.lng=t}addBucket(t,n,l){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===n.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let f=0;f<n.symbolInstances.length;f++)n.symbolInstances.get(f).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const c=this.usedCrossTileIDs[t.overscaledZ];for(const f in this.indexes){const v=this.indexes[f];if(Number(f)>t.overscaledZ)for(const b in v){const A=v[b];A.tileID.isChildOf(t)&&A.findMatches(n.symbolInstances,t,c)}else{const b=v[t.scaledTo(Number(f)).key];b&&b.findMatches(n.symbolInstances,t,c)}}for(let f=0;f<n.symbolInstances.length;f++){const v=n.symbolInstances.get(f);v.crossTileID||(v.crossTileID=l.generate(),c[v.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Xt(t,n.symbolInstances,n.bucketInstanceId),!0}removeBucketCrossTileIDs(t,n){for(const l of n.getCrossTileIDsLists())for(const c of l)delete this.usedCrossTileIDs[t][c]}removeStaleBuckets(t){let n=!1;for(const l in this.indexes){const c=this.indexes[l];for(const f in c)t[c[f].bucketInstanceId]||(this.removeBucketCrossTileIDs(l,c[f]),delete c[f],n=!0)}return n}}class Vt{constructor(){this.layerIndexes={},this.crossTileIDs=new Ps,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,n,l){let c=this.layerIndexes[t.id];c===void 0&&(c=this.layerIndexes[t.id]=new vn);let f=!1;const v={};c.handleWrapJump(l);for(const b of n){const A=b.getBucket(t);A&&t.id===A.layerIds[0]&&(A.bucketInstanceId||(A.bucketInstanceId=++this.maxBucketInstanceId),c.addBucket(b.tileID,A,this.crossTileIDs)&&(f=!0),v[A.bucketInstanceId]=!0)}return c.removeStaleBuckets(v)&&(f=!0),f}pruneUnusedLayers(t){const n={};t.forEach(l=>{n[l]=!0});for(const l in this.layerIndexes)n[l]||delete this.layerIndexes[l]}}const bn=(p,t)=>h.t(p,t&&t.filter(n=>n.identifier!=="source.canvas")),hr=h.av();class ra extends h.E{constructor(t,n={}){super(),this._rtlPluginLoaded=()=>{for(const l in this.sourceCaches){const c=this.sourceCaches[l].getSource().type;c!=="vector"&&c!=="geojson"||this.sourceCaches[l].reload()}},this.map=t,this.dispatcher=new Un(ur(),t._getMapId()),this.dispatcher.registerMessageHandler("getGlyphs",(l,c)=>this.getGlyphs(l,c)),this.dispatcher.registerMessageHandler("getImages",(l,c)=>this.getImages(l,c)),this.imageManager=new lr,this.imageManager.setEventedParent(this),this.glyphManager=new wr(t._requestManager,n.localIdeographFontFamily),this.lineAtlas=new ki(256,512),this.crossTileSymbolIndex=new Vt,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new h.aw,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",h.ax()),qi().on(Gn,this._rtlPluginLoaded),this.on("data",l=>{if(l.dataType!=="source"||l.sourceDataType!=="metadata")return;const c=this.sourceCaches[l.sourceId];if(!c)return;const f=c.getSource();if(f&&f.vectorLayerIds)for(const v in this._layers){const b=this._layers[v];b.source===f.id&&this._validateLayer(b)}})}loadURL(t,n={},l){this.fire(new h.k("dataloading",{dataType:"style"})),n.validate=typeof n.validate!="boolean"||n.validate;const c=this.map._requestManager.transformRequest(t,xt.Style);this._loadStyleRequest=new AbortController,h.h(c,this._loadStyleRequest).then(f=>{this._loadStyleRequest=null,this._load(f.data,n,l)}).catch(f=>{this._loadStyleRequest=null,f&&this.fire(new h.j(f))})}loadJSON(t,n={},l){this.fire(new h.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,Q.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,n.validate=n.validate!==!1,this._load(t,n,l)}).catch(()=>{})}loadEmpty(){this.fire(new h.k("dataloading",{dataType:"style"})),this._load(hr,{validate:!1})}_load(t,n,l){var c;const f=n.transformStyle?n.transformStyle(l,t):t;if(!n.validate||!bn(this,h.x(f))){this._loaded=!0,this.stylesheet=f;for(const v in f.sources)this.addSource(v,f.sources[v],{validate:!1});f.sprite?this._loadSprite(f.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(f.glyphs),this._createLayers(),this.light=new Mi(this.stylesheet.light),this.map.setTerrain((c=this.stylesheet.terrain)!==null&&c!==void 0?c:null),this.fire(new h.k("data",{dataType:"style"})),this.fire(new h.k("style.load"))}}_createLayers(){const t=h.ay(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",t),this._order=t.map(n=>n.id),this._layers={},this._serializedLayers=null;for(const n of t){const l=h.az(n);l.setEventedParent(this,{layer:{id:n.id}}),this._layers[n.id]=l}}_loadSprite(t,n=!1,l=void 0){let c;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(f,v,b,A){return h._(this,void 0,void 0,function*(){const I=Pi(f),M=b>1?"@2x":"",k={},L={};for(const{id:H,url:q}of I){const W=v.transformRequest(v.normalizeSpriteURL(q,M,".json"),xt.SpriteJSON);k[H]=h.h(W,A);const N=v.transformRequest(v.normalizeSpriteURL(q,M,".png"),xt.SpriteImage);L[H]=gt.getImage(N,A)}return yield Promise.all([...Object.values(k),...Object.values(L)]),function(H,q){return h._(this,void 0,void 0,function*(){const W={};for(const N in H){W[N]={};const te=Q.getImageCanvasContext((yield q[N]).data),ue=(yield H[N]).data;for(const X in ue){const{width:ae,height:he,x:de,y:pe,sdf:Se,pixelRatio:ve,stretchX:we,stretchY:Fe,content:Qe}=ue[X];W[N][X]={data:null,pixelRatio:ve,sdf:Se,stretchX:we,stretchY:Fe,content:Qe,spriteData:{width:ae,height:he,x:de,y:pe,context:te}}}}return W})}(k,L)})}(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(f=>{if(this._spriteRequest=null,f)for(const v in f){this._spritesImagesIds[v]=[];const b=this._spritesImagesIds[v]?this._spritesImagesIds[v].filter(A=>!(A in f)):[];for(const A of b)this.imageManager.removeImage(A),this._changedImages[A]=!0;for(const A in f[v]){const I=v==="default"?A:`${v}:${A}`;this._spritesImagesIds[v].push(I),I in this.imageManager.images?this.imageManager.updateImage(I,f[v][A],!1):this.imageManager.addImage(I,f[v][A]),n&&(this._changedImages[I]=!0)}}}).catch(f=>{this._spriteRequest=null,c=f,this.fire(new h.j(c))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),n&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new h.k("data",{dataType:"style"})),l&&l(c)})}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new h.k("data",{dataType:"style"}))}_validateLayer(t){const n=this.sourceCaches[t.source];if(!n)return;const l=t.sourceLayer;if(!l)return;const c=n.getSource();(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(l)===-1)&&this.fire(new h.j(new Error(`Source layer "${l}" does not exist on source "${c.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t){const n=this._serializedAllLayers();if(!t||t.length===0)return Object.values(n);const l=[];for(const c of t)n[c]&&l.push(n[c]);return l}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const n=Object.keys(this._layers);for(const l of n){const c=this._layers[l];c.type!=="custom"&&(t[l]=c.serialize())}return t}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const n=this._changed;if(this._changed){const c=Object.keys(this._updatedLayers),f=Object.keys(this._removedLayers);(c.length||f.length)&&this._updateWorkerLayers(c,f);for(const v in this._updatedSources){const b=this._updatedSources[v];if(b==="reload")this._reloadSource(v);else{if(b!=="clear")throw new Error(`Invalid action ${b}`);this._clearSource(v)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const v in this._updatedPaintProps)this._layers[v].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates()}const l={};for(const c in this.sourceCaches){const f=this.sourceCaches[c];l[c]=f.used,f.used=!1}for(const c of this._order){const f=this._layers[c];f.recalculate(t,this._availableImages),!f.isHidden(t.zoom)&&f.source&&(this.sourceCaches[f.source].used=!0)}for(const c in l){const f=this.sourceCaches[c];l[c]!==f.used&&f.fire(new h.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:c}))}this.light.recalculate(t),this.z=t.zoom,n&&this.fire(new h.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const n in this.sourceCaches)this.sourceCaches[n].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,n){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(t),removedIds:n})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,n={}){var l;this._checkLoaded();const c=this.serialize();if(t=n.transformStyle?n.transformStyle(c,t):t,((l=n.validate)===null||l===void 0||l)&&bn(this,h.x(t)))return!1;(t=h.aA(t)).layers=h.ay(t.layers);const f=h.aB(c,t),v=this._getOperationsToPerform(f);if(v.unimplemented.length>0)throw new Error(`Unimplemented: ${v.unimplemented.join(", ")}.`);if(v.operations.length===0)return!1;for(const b of v.operations)b();return this.stylesheet=t,this._serializedLayers=null,!0}_getOperationsToPerform(t){const n=[],l=[];for(const c of t)switch(c.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":n.push(()=>this.addLayer.apply(this,c.args));break;case"removeLayer":n.push(()=>this.removeLayer.apply(this,c.args));break;case"setPaintProperty":n.push(()=>this.setPaintProperty.apply(this,c.args));break;case"setLayoutProperty":n.push(()=>this.setLayoutProperty.apply(this,c.args));break;case"setFilter":n.push(()=>this.setFilter.apply(this,c.args));break;case"addSource":n.push(()=>this.addSource.apply(this,c.args));break;case"removeSource":n.push(()=>this.removeSource.apply(this,c.args));break;case"setLayerZoomRange":n.push(()=>this.setLayerZoomRange.apply(this,c.args));break;case"setLight":n.push(()=>this.setLight.apply(this,c.args));break;case"setGeoJSONSourceData":n.push(()=>this.setGeoJSONSourceData.apply(this,c.args));break;case"setGlyphs":n.push(()=>this.setGlyphs.apply(this,c.args));break;case"setSprite":n.push(()=>this.setSprite.apply(this,c.args));break;case"setTerrain":n.push(()=>this.map.setTerrain.apply(this,c.args));break;case"setTransition":n.push(()=>{});break;default:l.push(c.command)}return{operations:n,unimplemented:l}}addImage(t,n){if(this.getImage(t))return this.fire(new h.j(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,n),this._afterImageUpdated(t)}updateImage(t,n){this.imageManager.updateImage(t,n)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new h.j(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new h.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,n,l={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(h.x.source,`sources.${t}`,n,null,l))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const c=this.sourceCaches[t]=new Ie(t,n,this.dispatcher);c.style=this,c.setEventedParent(this,()=>({isSourceLoaded:c.loaded(),source:c.serialize(),sourceId:t})),c.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const l in this._layers)if(this._layers[l].source===t)return this.fire(new h.j(new Error(`Source "${t}" cannot be removed while layer "${l}" is using it.`)));const n=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],n.fire(new h.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),n.setEventedParent(null),n.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,n){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const l=this.sourceCaches[t].getSource();if(l.type!=="geojson")throw new Error(`geojsonSource.type is ${l.type}, which is !== 'geojson`);l.setData(n),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,n,l={}){this._checkLoaded();const c=t.id;if(this.getLayer(c))return void this.fire(new h.j(new Error(`Layer "${c}" already exists on this map.`)));let f;if(t.type==="custom"){if(bn(this,h.aC(t)))return;f=h.az(t)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(c,t.source),t=h.aA(t),t=h.e(t,{source:c})),this._validate(h.x.layer,`layers.${c}`,t,{arrayIndex:-1},l))return;f=h.az(t),this._validateLayer(f),f.setEventedParent(this,{layer:{id:c}})}const v=n?this._order.indexOf(n):this._order.length;if(n&&v===-1)this.fire(new h.j(new Error(`Cannot add layer "${c}" before non-existing layer "${n}".`)));else{if(this._order.splice(v,0,c),this._layerOrderChanged=!0,this._layers[c]=f,this._removedLayers[c]&&f.source&&f.type!=="custom"){const b=this._removedLayers[c];delete this._removedLayers[c],b.type!==f.type?this._updatedSources[f.source]="clear":(this._updatedSources[f.source]="reload",this.sourceCaches[f.source].pause())}this._updateLayer(f),f.onAdd&&f.onAdd(this.map)}}moveLayer(t,n){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new h.j(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===n)return;const l=this._order.indexOf(t);this._order.splice(l,1);const c=n?this._order.indexOf(n):this._order.length;n&&c===-1?this.fire(new h.j(new Error(`Cannot move layer "${t}" before non-existing layer "${n}".`))):(this._order.splice(c,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const n=this._layers[t];if(!n)return void this.fire(new h.j(new Error(`Cannot remove non-existing layer "${t}".`)));n.setEventedParent(null);const l=this._order.indexOf(t);this._order.splice(l,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=n,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],n.onRemove&&n.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,n,l){this._checkLoaded();const c=this.getLayer(t);c?c.minzoom===n&&c.maxzoom===l||(n!=null&&(c.minzoom=n),l!=null&&(c.maxzoom=l),this._updateLayer(c)):this.fire(new h.j(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,n,l={}){this._checkLoaded();const c=this.getLayer(t);if(c){if(!h.aD(c.filter,n))return n==null?(c.filter=void 0,void this._updateLayer(c)):void(this._validate(h.x.filter,`layers.${c.id}.filter`,n,null,l)||(c.filter=h.aA(n),this._updateLayer(c)))}else this.fire(new h.j(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return h.aA(this.getLayer(t).filter)}setLayoutProperty(t,n,l,c={}){this._checkLoaded();const f=this.getLayer(t);f?h.aD(f.getLayoutProperty(n),l)||(f.setLayoutProperty(n,l,c),this._updateLayer(f)):this.fire(new h.j(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,n){const l=this.getLayer(t);if(l)return l.getLayoutProperty(n);this.fire(new h.j(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,n,l,c={}){this._checkLoaded();const f=this.getLayer(t);f?h.aD(f.getPaintProperty(n),l)||(f.setPaintProperty(n,l,c)&&this._updateLayer(f),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new h.j(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,n){return this.getLayer(t).getPaintProperty(n)}setFeatureState(t,n){this._checkLoaded();const l=t.source,c=t.sourceLayer,f=this.sourceCaches[l];if(f===void 0)return void this.fire(new h.j(new Error(`The source '${l}' does not exist in the map's style.`)));const v=f.getSource().type;v==="geojson"&&c?this.fire(new h.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):v!=="vector"||c?(t.id===void 0&&this.fire(new h.j(new Error("The feature id parameter must be provided."))),f.setFeatureState(c,t.id,n)):this.fire(new h.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,n){this._checkLoaded();const l=t.source,c=this.sourceCaches[l];if(c===void 0)return void this.fire(new h.j(new Error(`The source '${l}' does not exist in the map's style.`)));const f=c.getSource().type,v=f==="vector"?t.sourceLayer:void 0;f!=="vector"||v?n&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new h.j(new Error("A feature id is required to remove its specific state property."))):c.removeFeatureState(v,t.id,n):this.fire(new h.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const n=t.source,l=t.sourceLayer,c=this.sourceCaches[n];if(c!==void 0)return c.getSource().type!=="vector"||l?(t.id===void 0&&this.fire(new h.j(new Error("The feature id parameter must be provided."))),c.getFeatureState(l,t.id)):void this.fire(new h.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new h.j(new Error(`The source '${n}' does not exist in the map's style.`)))}getTransition(){return h.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=h.aE(this.sourceCaches,f=>f.serialize()),n=this._serializeByIds(this._order),l=this.map.getTerrain()||void 0,c=this.stylesheet;return h.aF({version:c.version,name:c.name,metadata:c.metadata,light:c.light,center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch,sprite:c.sprite,glyphs:c.glyphs,transition:c.transition,sources:t,layers:n,terrain:l},f=>f!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const n=v=>this._layers[v].type==="fill-extrusion",l={},c=[];for(let v=this._order.length-1;v>=0;v--){const b=this._order[v];if(n(b)){l[b]=v;for(const A of t){const I=A[b];if(I)for(const M of I)c.push(M)}}}c.sort((v,b)=>b.intersectionZ-v.intersectionZ);const f=[];for(let v=this._order.length-1;v>=0;v--){const b=this._order[v];if(n(b))for(let A=c.length-1;A>=0;A--){const I=c[A].feature;if(l[I.layer.id]<v)break;f.push(I),c.pop()}else for(const A of t){const I=A[b];if(I)for(const M of I)f.push(M.feature)}}return f}queryRenderedFeatures(t,n,l){n&&n.filter&&this._validate(h.x.filter,"queryRenderedFeatures.filter",n.filter,null,n);const c={};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new h.j(new Error("parameters.layers must be an Array."))),[];for(const b of n.layers){const A=this._layers[b];if(!A)return this.fire(new h.j(new Error(`The layer '${b}' does not exist in the map's style and cannot be queried for features.`))),[];c[A.source]=!0}}const f=[];n.availableImages=this._availableImages;const v=this._serializedAllLayers();for(const b in this.sourceCaches)n.layers&&!c[b]||f.push(Wr(this.sourceCaches[b],this._layers,v,t,n,l));return this.placement&&f.push(function(b,A,I,M,k,L,H){const q={},W=L.queryRenderedSymbols(M),N=[];for(const te of Object.keys(W).map(Number))N.push(H[te]);N.sort(Kr);for(const te of N){const ue=te.featureIndex.lookupSymbolFeatures(W[te.bucketInstanceId],A,te.bucketIndex,te.sourceLayerIndex,k.filter,k.layers,k.availableImages,b);for(const X in ue){const ae=q[X]=q[X]||[],he=ue[X];he.sort((de,pe)=>{const Se=te.featureSortOrder;if(Se){const ve=Se.indexOf(de.featureIndex);return Se.indexOf(pe.featureIndex)-ve}return pe.featureIndex-de.featureIndex});for(const de of he)ae.push(de)}}for(const te in q)q[te].forEach(ue=>{const X=ue.feature,ae=I[b[te].source].getFeatureState(X.layer["source-layer"],X.id);X.source=X.layer.source,X.layer["source-layer"]&&(X.sourceLayer=X.layer["source-layer"]),X.state=ae});return q}(this._layers,v,this.sourceCaches,t,n,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(f)}querySourceFeatures(t,n){n&&n.filter&&this._validate(h.x.filter,"querySourceFeatures.filter",n.filter,null,n);const l=this.sourceCaches[t];return l?function(c,f){const v=c.getRenderableIds().map(I=>c.getTileByID(I)),b=[],A={};for(let I=0;I<v.length;I++){const M=v[I],k=M.tileID.canonical.key;A[k]||(A[k]=!0,M.querySourceFeatures(b,f))}return b}(l,n):[]}getLight(){return this.light.getLight()}setLight(t,n={}){this._checkLoaded();const l=this.light.getLight();let c=!1;for(const v in t)if(!h.aD(t[v],l[v])){c=!0;break}if(!c)return;const f={now:Q.now(),transition:h.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,n),this.light.updateTransitions(f)}_validate(t,n,l,c,f={}){return(!f||f.validate!==!1)&&bn(this,t.call(h.x,h.e({key:n,style:this.serialize(),value:l,styleSpec:h.v},c)))}_remove(t=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),qi().off(Gn,this._rtlPluginLoaded);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this.sourceCaches){const l=this.sourceCaches[n];l.setEventedParent(null),l.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("removeMap",void 0),this.dispatcher.remove(t)}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const n in this.sourceCaches)this.sourceCaches[n].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,n,l,c,f=!1){let v=!1,b=!1;const A={};for(const I of this._order){const M=this._layers[I];if(M.type!=="symbol")continue;if(!A[M.source]){const L=this.sourceCaches[M.source];A[M.source]=L.getRenderableIds(!0).map(H=>L.getTileByID(H)).sort((H,q)=>q.tileID.overscaledZ-H.tileID.overscaledZ||(H.tileID.isLessThan(q.tileID)?-1:1))}const k=this.crossTileSymbolIndex.addLayer(M,A[M.source],t.center.lng);v=v||k}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((f=f||this._layerOrderChanged||l===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(Q.now(),t.zoom))&&(this.pauseablePlacement=new $l(t,this.map.terrain,this._order,f,n,l,c,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,A),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(Q.now()),b=!0),v&&this.pauseablePlacement.placement.setStale()),b||v)for(const I of this._order){const M=this._layers[I];M.type==="symbol"&&this.placement.updateLayerOpacities(M,A[M.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(Q.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,n){return h._(this,void 0,void 0,function*(){const l=yield this.imageManager.getImages(n.icons);this._updateTilesForChangedImages();const c=this.sourceCaches[n.source];return c&&c.setDependencies(n.tileID.key,n.type,n.icons),l})}getGlyphs(t,n){return h._(this,void 0,void 0,function*(){const l=yield this.glyphManager.getGlyphs(n.stacks),c=this.sourceCaches[n.source];return c&&c.setDependencies(n.tileID.key,n.type,[""]),l})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,n={}){this._checkLoaded(),t&&this._validate(h.x.glyphs,"glyphs",t,null,n)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}addSprite(t,n,l={},c){this._checkLoaded();const f=[{id:t,url:n}],v=[...Pi(this.stylesheet.sprite),...f];this._validate(h.x.sprite,"sprite",v,null,l)||(this.stylesheet.sprite=v,this._loadSprite(f,!0,c))}removeSprite(t){this._checkLoaded();const n=Pi(this.stylesheet.sprite);if(n.find(l=>l.id===t)){if(this._spritesImagesIds[t])for(const l of this._spritesImagesIds[t])this.imageManager.removeImage(l),this._changedImages[l]=!0;n.splice(n.findIndex(l=>l.id===t),1),this.stylesheet.sprite=n.length>0?n:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new h.k("data",{dataType:"style"}))}else this.fire(new h.j(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return Pi(this.stylesheet.sprite)}setSprite(t,n={},l){this._checkLoaded(),t&&this._validate(h.x.sprite,"sprite",t,null,n)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,l):(this._unloadSprite(),l&&l(null)))}}var Ar=h.X([{name:"a_pos",type:"Int16",components:2}]),Qa="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const Hn={prelude:yt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:yt(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:yt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:yt(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:yt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:yt(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:yt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:yt("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:yt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:yt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:yt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:yt(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:yt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:yt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:yt(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:yt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:yt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:yt(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:yt(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:yt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:yt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:yt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:yt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:yt(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:yt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:yt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:yt("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Qa),terrainDepth:yt("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Qa),terrainCoords:yt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Qa)};function yt(p,t){const n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,l=t.match(/attribute ([\w]+) ([\w]+)/g),c=p.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),f=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),v=f?f.concat(c):c,b={};return{fragmentSource:p=p.replace(n,(A,I,M,k,L)=>(b[L]=!0,I==="define"?`
#ifndef HAS_UNIFORM_u_${L}
varying ${M} ${k} ${L};
#else
uniform ${M} ${k} u_${L};
#endif
`:`
#ifdef HAS_UNIFORM_u_${L}
    ${M} ${k} ${L} = u_${L};
#endif
`)),vertexSource:t=t.replace(n,(A,I,M,k,L)=>{const H=k==="float"?"vec2":"vec4",q=L.match(/color/)?"color":H;return b[L]?I==="define"?`
#ifndef HAS_UNIFORM_u_${L}
uniform lowp float u_${L}_t;
attribute ${M} ${H} a_${L};
varying ${M} ${k} ${L};
#else
uniform ${M} ${k} u_${L};
#endif
`:q==="vec4"?`
#ifndef HAS_UNIFORM_u_${L}
    ${L} = a_${L};
#else
    ${M} ${k} ${L} = u_${L};
#endif
`:`
#ifndef HAS_UNIFORM_u_${L}
    ${L} = unpack_mix_${q}(a_${L}, u_${L}_t);
#else
    ${M} ${k} ${L} = u_${L};
#endif
`:I==="define"?`
#ifndef HAS_UNIFORM_u_${L}
uniform lowp float u_${L}_t;
attribute ${M} ${H} a_${L};
#else
uniform ${M} ${k} u_${L};
#endif
`:q==="vec4"?`
#ifndef HAS_UNIFORM_u_${L}
    ${M} ${k} ${L} = a_${L};
#else
    ${M} ${k} ${L} = u_${L};
#endif
`:`
#ifndef HAS_UNIFORM_u_${L}
    ${M} ${k} ${L} = unpack_mix_${q}(a_${L}, u_${L}_t);
#else
    ${M} ${k} ${L} = u_${L};
#endif
`}),staticAttributes:l,staticUniforms:v}}class na{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,n,l,c,f,v,b,A,I){this.context=t;let M=this.boundPaintVertexBuffers.length!==c.length;for(let k=0;!M&&k<c.length;k++)this.boundPaintVertexBuffers[k]!==c[k]&&(M=!0);!this.vao||this.boundProgram!==n||this.boundLayoutVertexBuffer!==l||M||this.boundIndexBuffer!==f||this.boundVertexOffset!==v||this.boundDynamicVertexBuffer!==b||this.boundDynamicVertexBuffer2!==A||this.boundDynamicVertexBuffer3!==I?this.freshBind(n,l,c,f,v,b,A,I):(t.bindVertexArray.set(this.vao),b&&b.bind(),f&&f.dynamicDraw&&f.bind(),A&&A.bind(),I&&I.bind())}freshBind(t,n,l,c,f,v,b,A){const I=t.numAttributes,M=this.context,k=M.gl;this.vao&&this.destroy(),this.vao=M.createVertexArray(),M.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=n,this.boundPaintVertexBuffers=l,this.boundIndexBuffer=c,this.boundVertexOffset=f,this.boundDynamicVertexBuffer=v,this.boundDynamicVertexBuffer2=b,this.boundDynamicVertexBuffer3=A,n.enableAttributes(k,t);for(const L of l)L.enableAttributes(k,t);v&&v.enableAttributes(k,t),b&&b.enableAttributes(k,t),A&&A.enableAttributes(k,t),n.bind(),n.setVertexAttribPointers(k,t,f);for(const L of l)L.bind(),L.setVertexAttribPointers(k,t,f);v&&(v.bind(),v.setVertexAttribPointers(k,t,f)),c&&c.bind(),b&&(b.bind(),b.setVertexAttribPointers(k,t,f)),A&&(A.bind(),A.setVertexAttribPointers(k,t,f)),M.currentNumAttributes=I}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function Er(p){const t=[];for(let n=0;n<p.length;n++){if(p[n]===null)continue;const l=p[n].split(" ");t.push(l.pop())}return t}class eo{constructor(t,n,l,c,f,v){const b=t.gl;this.program=b.createProgram();const A=Er(n.staticAttributes),I=l?l.getBinderAttributes():[],M=A.concat(I),k=Hn.prelude.staticUniforms?Er(Hn.prelude.staticUniforms):[],L=n.staticUniforms?Er(n.staticUniforms):[],H=l?l.getBinderUniforms():[],q=k.concat(L).concat(H),W=[];for(const de of q)W.indexOf(de)<0&&W.push(de);const N=l?l.defines():[];f&&N.push("#define OVERDRAW_INSPECTOR;"),v&&N.push("#define TERRAIN3D;");const te=N.concat(Hn.prelude.fragmentSource,n.fragmentSource).join(`
`),ue=N.concat(Hn.prelude.vertexSource,n.vertexSource).join(`
`),X=b.createShader(b.FRAGMENT_SHADER);if(b.isContextLost())return void(this.failedToCreate=!0);if(b.shaderSource(X,te),b.compileShader(X),!b.getShaderParameter(X,b.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${b.getShaderInfoLog(X)}`);b.attachShader(this.program,X);const ae=b.createShader(b.VERTEX_SHADER);if(b.isContextLost())return void(this.failedToCreate=!0);if(b.shaderSource(ae,ue),b.compileShader(ae),!b.getShaderParameter(ae,b.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${b.getShaderInfoLog(ae)}`);b.attachShader(this.program,ae),this.attributes={};const he={};this.numAttributes=M.length;for(let de=0;de<this.numAttributes;de++)M[de]&&(b.bindAttribLocation(this.program,de,M[de]),this.attributes[M[de]]=de);if(b.linkProgram(this.program),!b.getProgramParameter(this.program,b.LINK_STATUS))throw new Error(`Program failed to link: ${b.getProgramInfoLog(this.program)}`);b.deleteShader(ae),b.deleteShader(X);for(let de=0;de<W.length;de++){const pe=W[de];if(pe&&!he[pe]){const Se=b.getUniformLocation(this.program,pe);Se&&(he[pe]=Se)}}this.fixedUniforms=c(t,he),this.terrainUniforms=((de,pe)=>({u_depth:new h.aG(de,pe.u_depth),u_terrain:new h.aG(de,pe.u_terrain),u_terrain_dim:new h.aH(de,pe.u_terrain_dim),u_terrain_matrix:new h.aI(de,pe.u_terrain_matrix),u_terrain_unpack:new h.aJ(de,pe.u_terrain_unpack),u_terrain_exaggeration:new h.aH(de,pe.u_terrain_exaggeration)}))(t,he),this.binderUniforms=l?l.getUniforms(t,he):[]}draw(t,n,l,c,f,v,b,A,I,M,k,L,H,q,W,N,te,ue){const X=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(l),t.setStencilMode(c),t.setColorMode(f),t.setCullFace(v),A){t.activeTexture.set(X.TEXTURE2),X.bindTexture(X.TEXTURE_2D,A.depthTexture),t.activeTexture.set(X.TEXTURE3),X.bindTexture(X.TEXTURE_2D,A.texture);for(const he in this.terrainUniforms)this.terrainUniforms[he].set(A[he])}for(const he in this.fixedUniforms)this.fixedUniforms[he].set(b[he]);W&&W.setUniforms(t,this.binderUniforms,H,{zoom:q});let ae=0;switch(n){case X.LINES:ae=2;break;case X.TRIANGLES:ae=3;break;case X.LINE_STRIP:ae=1}for(const he of L.get()){const de=he.vaos||(he.vaos={});(de[I]||(de[I]=new na)).bind(t,this,M,W?W.getPaintVertexBuffers():[],k,he.vertexOffset,N,te,ue),X.drawElements(n,he.primitiveLength*ae,X.UNSIGNED_SHORT,he.primitiveOffset*ae*2)}}}function Ms(p,t,n){const l=1/Je(n,1,t.transform.tileZoom),c=Math.pow(2,n.tileID.overscaledZ),f=n.tileSize*Math.pow(2,t.transform.tileZoom)/c,v=f*(n.tileID.canonical.x+n.tileID.wrap*c),b=f*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_scale:[l,p.fromScale,p.toScale],u_fade:p.t,u_pixel_coord_upper:[v>>16,b>>16],u_pixel_coord_lower:[65535&v,65535&b]}}const Nl=(p,t,n,l)=>{const c=t.style.light,f=c.properties.get("position"),v=[f.x,f.y,f.z],b=function(){var I=new h.A(9);return h.A!=Float32Array&&(I[1]=0,I[2]=0,I[3]=0,I[5]=0,I[6]=0,I[7]=0),I[0]=1,I[4]=1,I[8]=1,I}();c.properties.get("anchor")==="viewport"&&function(I,M){var k=Math.sin(M),L=Math.cos(M);I[0]=L,I[1]=k,I[2]=0,I[3]=-k,I[4]=L,I[5]=0,I[6]=0,I[7]=0,I[8]=1}(b,-t.transform.angle),function(I,M,k){var L=M[0],H=M[1],q=M[2];I[0]=L*k[0]+H*k[3]+q*k[6],I[1]=L*k[1]+H*k[4]+q*k[7],I[2]=L*k[2]+H*k[5]+q*k[8]}(v,v,b);const A=c.properties.get("color");return{u_matrix:p,u_lightpos:v,u_lightintensity:c.properties.get("intensity"),u_lightcolor:[A.r,A.g,A.b],u_vertical_gradient:+n,u_opacity:l}},xu=(p,t,n,l,c,f,v)=>h.e(Nl(p,t,n,l),Ms(f,t,v),{u_height_factor:-Math.pow(2,c.overscaledZ)/v.tileSize/8}),sa=p=>({u_matrix:p}),Ul=(p,t,n,l)=>h.e(sa(p),Ms(n,t,l)),Vl=(p,t)=>({u_matrix:p,u_world:t}),vu=(p,t,n,l,c)=>h.e(Ul(p,t,n,l),{u_world:c}),jl=(p,t,n,l)=>{const c=p.transform;let f,v;if(l.paint.get("circle-pitch-alignment")==="map"){const b=Je(n,1,c.zoom);f=!0,v=[b,b]}else f=!1,v=c.pixelsToGLUnits;return{u_camera_to_center_distance:c.cameraToCenterDistance,u_scale_with_map:+(l.paint.get("circle-pitch-scale")==="map"),u_matrix:p.translatePosMatrix(t.posMatrix,n,l.paint.get("circle-translate"),l.paint.get("circle-translate-anchor")),u_pitch_with_map:+f,u_device_pixel_ratio:p.pixelRatio,u_extrude_scale:v}},bu=(p,t,n)=>{const l=Je(n,1,t.zoom),c=Math.pow(2,t.zoom-n.tileID.overscaledZ),f=n.tileID.overscaleFactor();return{u_matrix:p,u_camera_to_center_distance:t.cameraToCenterDistance,u_pixels_to_tile_units:l,u_extrude_scale:[t.pixelsToGLUnits[0]/(l*c),t.pixelsToGLUnits[1]/(l*c)],u_overscale_factor:f}},aa=(p,t,n=1)=>({u_matrix:p,u_color:t,u_overlay:0,u_overlay_scale:n}),to=p=>({u_matrix:p}),ql=(p,t,n,l)=>({u_matrix:p,u_extrude_scale:Je(t,1,n),u_intensity:l});function Gl(p,t){const n=Math.pow(2,t.canonical.z),l=t.canonical.y;return[new h.Y(0,l/n).toLngLat().lat,new h.Y(0,(l+1)/n).toLngLat().lat]}const oa=(p,t,n,l)=>{const c=p.transform;return{u_matrix:Ds(p,t,n,l),u_ratio:1/Je(t,1,c.zoom),u_device_pixel_ratio:p.pixelRatio,u_units_to_pixels:[1/c.pixelsToGLUnits[0],1/c.pixelsToGLUnits[1]]}},wn=(p,t,n,l,c)=>h.e(oa(p,t,n,c),{u_image:0,u_image_height:l}),la=(p,t,n,l,c)=>{const f=p.transform,v=ks(t,f);return{u_matrix:Ds(p,t,n,c),u_texsize:t.imageAtlasTexture.size,u_ratio:1/Je(t,1,f.zoom),u_device_pixel_ratio:p.pixelRatio,u_image:0,u_scale:[v,l.fromScale,l.toScale],u_fade:l.t,u_units_to_pixels:[1/f.pixelsToGLUnits[0],1/f.pixelsToGLUnits[1]]}},sr=(p,t,n,l,c,f)=>{const v=p.lineAtlas,b=ks(t,p.transform),A=n.layout.get("line-cap")==="round",I=v.getDash(l.from,A),M=v.getDash(l.to,A),k=I.width*c.fromScale,L=M.width*c.toScale;return h.e(oa(p,t,n,f),{u_patternscale_a:[b/k,-I.height/2],u_patternscale_b:[b/L,-M.height/2],u_sdfgamma:v.width/(256*Math.min(k,L)*p.pixelRatio)/2,u_image:0,u_tex_y_a:I.y,u_tex_y_b:M.y,u_mix:c.t})};function ks(p,t){return 1/Je(p,1,t.tileZoom)}function Ds(p,t,n,l){return p.translatePosMatrix(l?l.posMatrix:t.tileID.posMatrix,t,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const Rs=(p,t,n,l,c)=>{return{u_matrix:p,u_tl_parent:t,u_scale_parent:n,u_buffer_scale:1,u_fade_t:l.mix,u_opacity:l.opacity*c.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:c.paint.get("raster-brightness-min"),u_brightness_high:c.paint.get("raster-brightness-max"),u_saturation_factor:(v=c.paint.get("raster-saturation"),v>0?1-1/(1.001-v):-v),u_contrast_factor:(f=c.paint.get("raster-contrast"),f>0?1/(1-f):1+f),u_spin_weights:ca(c.paint.get("raster-hue-rotate"))};var f,v};function ca(p){p*=Math.PI/180;const t=Math.sin(p),n=Math.cos(p);return[(2*n+1)/3,(-Math.sqrt(3)*t-n+1)/3,(Math.sqrt(3)*t-n+1)/3]}const zs=(p,t,n,l,c,f,v,b,A,I)=>{const M=c.transform;return{u_is_size_zoom_constant:+(p==="constant"||p==="source"),u_is_size_feature_constant:+(p==="constant"||p==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:M.cameraToCenterDistance,u_pitch:M.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:M.width/M.height,u_fade_change:c.options.fadeDuration?c.symbolFadeChange:1,u_matrix:f,u_label_plane_matrix:v,u_coord_matrix:b,u_is_text:+A,u_pitch_with_map:+l,u_texsize:I,u_texture:0}},Zn=(p,t,n,l,c,f,v,b,A,I,M)=>{const k=c.transform;return h.e(zs(p,t,n,l,c,f,v,b,A,I),{u_gamma_scale:l?Math.cos(k._pitch)*k.cameraToCenterDistance:1,u_device_pixel_ratio:c.pixelRatio,u_is_halo:+M})},wu=(p,t,n,l,c,f,v,b,A,I)=>h.e(Zn(p,t,n,l,c,f,v,b,!0,A,!0),{u_texsize_icon:I,u_texture_icon:1}),Su=(p,t,n)=>({u_matrix:p,u_opacity:t,u_color:n}),Hl=(p,t,n,l,c,f)=>h.e(function(v,b,A,I){const M=A.imageManager.getPattern(v.from.toString()),k=A.imageManager.getPattern(v.to.toString()),{width:L,height:H}=A.imageManager.getPixelSize(),q=Math.pow(2,I.tileID.overscaledZ),W=I.tileSize*Math.pow(2,A.transform.tileZoom)/q,N=W*(I.tileID.canonical.x+I.tileID.wrap*q),te=W*I.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:M.tl,u_pattern_br_a:M.br,u_pattern_tl_b:k.tl,u_pattern_br_b:k.br,u_texsize:[L,H],u_mix:b.t,u_pattern_size_a:M.displaySize,u_pattern_size_b:k.displaySize,u_scale_a:b.fromScale,u_scale_b:b.toScale,u_tile_units_to_pixels:1/Je(I,1,A.transform.tileZoom),u_pixel_coord_upper:[N>>16,te>>16],u_pixel_coord_lower:[65535&N,65535&te]}}(l,f,n,c),{u_matrix:p,u_opacity:t}),Tu={fillExtrusion:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix),u_lightpos:new h.aK(p,t.u_lightpos),u_lightintensity:new h.aH(p,t.u_lightintensity),u_lightcolor:new h.aK(p,t.u_lightcolor),u_vertical_gradient:new h.aH(p,t.u_vertical_gradient),u_opacity:new h.aH(p,t.u_opacity)}),fillExtrusionPattern:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix),u_lightpos:new h.aK(p,t.u_lightpos),u_lightintensity:new h.aH(p,t.u_lightintensity),u_lightcolor:new h.aK(p,t.u_lightcolor),u_vertical_gradient:new h.aH(p,t.u_vertical_gradient),u_height_factor:new h.aH(p,t.u_height_factor),u_image:new h.aG(p,t.u_image),u_texsize:new h.aL(p,t.u_texsize),u_pixel_coord_upper:new h.aL(p,t.u_pixel_coord_upper),u_pixel_coord_lower:new h.aL(p,t.u_pixel_coord_lower),u_scale:new h.aK(p,t.u_scale),u_fade:new h.aH(p,t.u_fade),u_opacity:new h.aH(p,t.u_opacity)}),fill:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix)}),fillPattern:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix),u_image:new h.aG(p,t.u_image),u_texsize:new h.aL(p,t.u_texsize),u_pixel_coord_upper:new h.aL(p,t.u_pixel_coord_upper),u_pixel_coord_lower:new h.aL(p,t.u_pixel_coord_lower),u_scale:new h.aK(p,t.u_scale),u_fade:new h.aH(p,t.u_fade)}),fillOutline:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix),u_world:new h.aL(p,t.u_world)}),fillOutlinePattern:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix),u_world:new h.aL(p,t.u_world),u_image:new h.aG(p,t.u_image),u_texsize:new h.aL(p,t.u_texsize),u_pixel_coord_upper:new h.aL(p,t.u_pixel_coord_upper),u_pixel_coord_lower:new h.aL(p,t.u_pixel_coord_lower),u_scale:new h.aK(p,t.u_scale),u_fade:new h.aH(p,t.u_fade)}),circle:(p,t)=>({u_camera_to_center_distance:new h.aH(p,t.u_camera_to_center_distance),u_scale_with_map:new h.aG(p,t.u_scale_with_map),u_pitch_with_map:new h.aG(p,t.u_pitch_with_map),u_extrude_scale:new h.aL(p,t.u_extrude_scale),u_device_pixel_ratio:new h.aH(p,t.u_device_pixel_ratio),u_matrix:new h.aI(p,t.u_matrix)}),collisionBox:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix),u_camera_to_center_distance:new h.aH(p,t.u_camera_to_center_distance),u_pixels_to_tile_units:new h.aH(p,t.u_pixels_to_tile_units),u_extrude_scale:new h.aL(p,t.u_extrude_scale),u_overscale_factor:new h.aH(p,t.u_overscale_factor)}),collisionCircle:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix),u_inv_matrix:new h.aI(p,t.u_inv_matrix),u_camera_to_center_distance:new h.aH(p,t.u_camera_to_center_distance),u_viewport_size:new h.aL(p,t.u_viewport_size)}),debug:(p,t)=>({u_color:new h.aM(p,t.u_color),u_matrix:new h.aI(p,t.u_matrix),u_overlay:new h.aG(p,t.u_overlay),u_overlay_scale:new h.aH(p,t.u_overlay_scale)}),clippingMask:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix)}),heatmap:(p,t)=>({u_extrude_scale:new h.aH(p,t.u_extrude_scale),u_intensity:new h.aH(p,t.u_intensity),u_matrix:new h.aI(p,t.u_matrix)}),heatmapTexture:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix),u_world:new h.aL(p,t.u_world),u_image:new h.aG(p,t.u_image),u_color_ramp:new h.aG(p,t.u_color_ramp),u_opacity:new h.aH(p,t.u_opacity)}),hillshade:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix),u_image:new h.aG(p,t.u_image),u_latrange:new h.aL(p,t.u_latrange),u_light:new h.aL(p,t.u_light),u_shadow:new h.aM(p,t.u_shadow),u_highlight:new h.aM(p,t.u_highlight),u_accent:new h.aM(p,t.u_accent)}),hillshadePrepare:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix),u_image:new h.aG(p,t.u_image),u_dimension:new h.aL(p,t.u_dimension),u_zoom:new h.aH(p,t.u_zoom),u_unpack:new h.aJ(p,t.u_unpack)}),line:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix),u_ratio:new h.aH(p,t.u_ratio),u_device_pixel_ratio:new h.aH(p,t.u_device_pixel_ratio),u_units_to_pixels:new h.aL(p,t.u_units_to_pixels)}),lineGradient:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix),u_ratio:new h.aH(p,t.u_ratio),u_device_pixel_ratio:new h.aH(p,t.u_device_pixel_ratio),u_units_to_pixels:new h.aL(p,t.u_units_to_pixels),u_image:new h.aG(p,t.u_image),u_image_height:new h.aH(p,t.u_image_height)}),linePattern:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix),u_texsize:new h.aL(p,t.u_texsize),u_ratio:new h.aH(p,t.u_ratio),u_device_pixel_ratio:new h.aH(p,t.u_device_pixel_ratio),u_image:new h.aG(p,t.u_image),u_units_to_pixels:new h.aL(p,t.u_units_to_pixels),u_scale:new h.aK(p,t.u_scale),u_fade:new h.aH(p,t.u_fade)}),lineSDF:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix),u_ratio:new h.aH(p,t.u_ratio),u_device_pixel_ratio:new h.aH(p,t.u_device_pixel_ratio),u_units_to_pixels:new h.aL(p,t.u_units_to_pixels),u_patternscale_a:new h.aL(p,t.u_patternscale_a),u_patternscale_b:new h.aL(p,t.u_patternscale_b),u_sdfgamma:new h.aH(p,t.u_sdfgamma),u_image:new h.aG(p,t.u_image),u_tex_y_a:new h.aH(p,t.u_tex_y_a),u_tex_y_b:new h.aH(p,t.u_tex_y_b),u_mix:new h.aH(p,t.u_mix)}),raster:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix),u_tl_parent:new h.aL(p,t.u_tl_parent),u_scale_parent:new h.aH(p,t.u_scale_parent),u_buffer_scale:new h.aH(p,t.u_buffer_scale),u_fade_t:new h.aH(p,t.u_fade_t),u_opacity:new h.aH(p,t.u_opacity),u_image0:new h.aG(p,t.u_image0),u_image1:new h.aG(p,t.u_image1),u_brightness_low:new h.aH(p,t.u_brightness_low),u_brightness_high:new h.aH(p,t.u_brightness_high),u_saturation_factor:new h.aH(p,t.u_saturation_factor),u_contrast_factor:new h.aH(p,t.u_contrast_factor),u_spin_weights:new h.aK(p,t.u_spin_weights)}),symbolIcon:(p,t)=>({u_is_size_zoom_constant:new h.aG(p,t.u_is_size_zoom_constant),u_is_size_feature_constant:new h.aG(p,t.u_is_size_feature_constant),u_size_t:new h.aH(p,t.u_size_t),u_size:new h.aH(p,t.u_size),u_camera_to_center_distance:new h.aH(p,t.u_camera_to_center_distance),u_pitch:new h.aH(p,t.u_pitch),u_rotate_symbol:new h.aG(p,t.u_rotate_symbol),u_aspect_ratio:new h.aH(p,t.u_aspect_ratio),u_fade_change:new h.aH(p,t.u_fade_change),u_matrix:new h.aI(p,t.u_matrix),u_label_plane_matrix:new h.aI(p,t.u_label_plane_matrix),u_coord_matrix:new h.aI(p,t.u_coord_matrix),u_is_text:new h.aG(p,t.u_is_text),u_pitch_with_map:new h.aG(p,t.u_pitch_with_map),u_texsize:new h.aL(p,t.u_texsize),u_texture:new h.aG(p,t.u_texture)}),symbolSDF:(p,t)=>({u_is_size_zoom_constant:new h.aG(p,t.u_is_size_zoom_constant),u_is_size_feature_constant:new h.aG(p,t.u_is_size_feature_constant),u_size_t:new h.aH(p,t.u_size_t),u_size:new h.aH(p,t.u_size),u_camera_to_center_distance:new h.aH(p,t.u_camera_to_center_distance),u_pitch:new h.aH(p,t.u_pitch),u_rotate_symbol:new h.aG(p,t.u_rotate_symbol),u_aspect_ratio:new h.aH(p,t.u_aspect_ratio),u_fade_change:new h.aH(p,t.u_fade_change),u_matrix:new h.aI(p,t.u_matrix),u_label_plane_matrix:new h.aI(p,t.u_label_plane_matrix),u_coord_matrix:new h.aI(p,t.u_coord_matrix),u_is_text:new h.aG(p,t.u_is_text),u_pitch_with_map:new h.aG(p,t.u_pitch_with_map),u_texsize:new h.aL(p,t.u_texsize),u_texture:new h.aG(p,t.u_texture),u_gamma_scale:new h.aH(p,t.u_gamma_scale),u_device_pixel_ratio:new h.aH(p,t.u_device_pixel_ratio),u_is_halo:new h.aG(p,t.u_is_halo)}),symbolTextAndIcon:(p,t)=>({u_is_size_zoom_constant:new h.aG(p,t.u_is_size_zoom_constant),u_is_size_feature_constant:new h.aG(p,t.u_is_size_feature_constant),u_size_t:new h.aH(p,t.u_size_t),u_size:new h.aH(p,t.u_size),u_camera_to_center_distance:new h.aH(p,t.u_camera_to_center_distance),u_pitch:new h.aH(p,t.u_pitch),u_rotate_symbol:new h.aG(p,t.u_rotate_symbol),u_aspect_ratio:new h.aH(p,t.u_aspect_ratio),u_fade_change:new h.aH(p,t.u_fade_change),u_matrix:new h.aI(p,t.u_matrix),u_label_plane_matrix:new h.aI(p,t.u_label_plane_matrix),u_coord_matrix:new h.aI(p,t.u_coord_matrix),u_is_text:new h.aG(p,t.u_is_text),u_pitch_with_map:new h.aG(p,t.u_pitch_with_map),u_texsize:new h.aL(p,t.u_texsize),u_texsize_icon:new h.aL(p,t.u_texsize_icon),u_texture:new h.aG(p,t.u_texture),u_texture_icon:new h.aG(p,t.u_texture_icon),u_gamma_scale:new h.aH(p,t.u_gamma_scale),u_device_pixel_ratio:new h.aH(p,t.u_device_pixel_ratio),u_is_halo:new h.aG(p,t.u_is_halo)}),background:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix),u_opacity:new h.aH(p,t.u_opacity),u_color:new h.aM(p,t.u_color)}),backgroundPattern:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix),u_opacity:new h.aH(p,t.u_opacity),u_image:new h.aG(p,t.u_image),u_pattern_tl_a:new h.aL(p,t.u_pattern_tl_a),u_pattern_br_a:new h.aL(p,t.u_pattern_br_a),u_pattern_tl_b:new h.aL(p,t.u_pattern_tl_b),u_pattern_br_b:new h.aL(p,t.u_pattern_br_b),u_texsize:new h.aL(p,t.u_texsize),u_mix:new h.aH(p,t.u_mix),u_pattern_size_a:new h.aL(p,t.u_pattern_size_a),u_pattern_size_b:new h.aL(p,t.u_pattern_size_b),u_scale_a:new h.aH(p,t.u_scale_a),u_scale_b:new h.aH(p,t.u_scale_b),u_pixel_coord_upper:new h.aL(p,t.u_pixel_coord_upper),u_pixel_coord_lower:new h.aL(p,t.u_pixel_coord_lower),u_tile_units_to_pixels:new h.aH(p,t.u_tile_units_to_pixels)}),terrain:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix),u_texture:new h.aG(p,t.u_texture),u_ele_delta:new h.aH(p,t.u_ele_delta)}),terrainDepth:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix),u_ele_delta:new h.aH(p,t.u_ele_delta)}),terrainCoords:(p,t)=>({u_matrix:new h.aI(p,t.u_matrix),u_texture:new h.aG(p,t.u_texture),u_terrain_coords_id:new h.aH(p,t.u_terrain_coords_id),u_ele_delta:new h.aH(p,t.u_ele_delta)})};class Sn{constructor(t,n,l){this.context=t;const c=t.gl;this.buffer=c.createBuffer(),this.dynamicDraw=!!l,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),c.bufferData(c.ELEMENT_ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?c.DYNAMIC_DRAW:c.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const n=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ua={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Wi{constructor(t,n,l,c){this.length=n.length,this.attributes=l,this.itemSize=n.bytesPerElement,this.dynamicDraw=c,this.context=t;const f=t.gl;this.buffer=f.createBuffer(),t.bindVertexBuffer.set(this.buffer),f.bufferData(f.ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const n=this.context.gl;this.bind(),n.bufferSubData(n.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,n){for(let l=0;l<this.attributes.length;l++){const c=n.attributes[this.attributes[l].name];c!==void 0&&t.enableVertexAttribArray(c)}}setVertexAttribPointers(t,n,l){for(let c=0;c<this.attributes.length;c++){const f=this.attributes[c],v=n.attributes[f.name];v!==void 0&&t.vertexAttribPointer(v,f.components,t[ua[f.type]],!1,this.itemSize,f.offset+this.itemSize*(l||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Si=new WeakMap;function Wn(p){var t;if(Si.has(p))return Si.get(p);{const n=(t=p.getParameter(p.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return Si.set(p,n),n}}class ft{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ha extends ft{getDefault(){return h.aO.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class io extends ft{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class ro extends ft{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class da extends ft{getDefault(){return[!0,!0,!0,!0]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class no extends ft{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class so extends ft{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class pa extends ft{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const n=this.current;(t.func!==n.func||t.ref!==n.ref||t.mask!==n.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Zl extends ft{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Wl extends ft{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),this.current=t,this.dirty=!1}}class Kn extends ft{getDefault(){return[0,1]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Au extends ft{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),this.current=t,this.dirty=!1}}class Eu extends ft{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Iu extends ft{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.BLEND):n.disable(n.BLEND),this.current=t,this.dirty=!1}}class Cu extends ft{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class Pu extends ft{getDefault(){return h.aO.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Mu extends ft{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class ao extends ft{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.CULL_FACE):n.disable(n.CULL_FACE),this.current=t,this.dirty=!1}}class fa extends ft{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class oo extends ft{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class lo extends ft{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class Xn extends ft{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Kl extends ft{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Xl extends ft{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class co extends ft{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindRenderbuffer(n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Tn extends ft{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindTexture(n.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Yl extends ft{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindBuffer(n.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Yn extends ft{getDefault(){return null}set(t){const n=this.gl;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Jn extends ft{getDefault(){return null}set(t){var n;if(t===this.current&&!this.dirty)return;const l=this.gl;Wn(l)?l.bindVertexArray(t):(n=l.getExtension("OES_vertex_array_object"))===null||n===void 0||n.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class Jl extends ft{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class uo extends ft{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class mt extends ft{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Qn extends ft{constructor(t,n){super(t),this.context=t,this.parent=n}getDefault(){return null}}class ku extends Qn{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Ql extends Qn{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Bs extends Qn{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Du{constructor(t,n,l,c,f){this.context=t,this.width=n,this.height=l;const v=t.gl,b=this.framebuffer=v.createFramebuffer();if(this.colorAttachment=new ku(t,b),c)this.depthAttachment=f?new Bs(t,b):new Ql(t,b);else if(f)throw new Error("Stencil cannot be set without depth");if(v.checkFramebufferStatus(v.FRAMEBUFFER)!==v.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,n=this.colorAttachment.get();if(n&&t.deleteTexture(n),this.depthAttachment){const l=this.depthAttachment.get();l&&t.deleteRenderbuffer(l)}t.deleteFramebuffer(this.framebuffer)}}class Zt{constructor(t,n,l){this.blendFunction=t,this.blendColor=n,this.mask=l}}Zt.Replace=[1,0],Zt.disabled=new Zt(Zt.Replace,h.aO.transparent,[!1,!1,!1,!1]),Zt.unblended=new Zt(Zt.Replace,h.aO.transparent,[!0,!0,!0,!0]),Zt.alphaBlended=new Zt([1,771],h.aO.transparent,[!0,!0,!0,!0]);class ec{constructor(t){var n,l;if(this.gl=t,this.clearColor=new ha(this),this.clearDepth=new io(this),this.clearStencil=new ro(this),this.colorMask=new da(this),this.depthMask=new no(this),this.stencilMask=new so(this),this.stencilFunc=new pa(this),this.stencilOp=new Zl(this),this.stencilTest=new Wl(this),this.depthRange=new Kn(this),this.depthTest=new Au(this),this.depthFunc=new Eu(this),this.blend=new Iu(this),this.blendFunc=new Cu(this),this.blendColor=new Pu(this),this.blendEquation=new Mu(this),this.cullFace=new ao(this),this.cullFaceSide=new fa(this),this.frontFace=new oo(this),this.program=new lo(this),this.activeTexture=new Xn(this),this.viewport=new Kl(this),this.bindFramebuffer=new Xl(this),this.bindRenderbuffer=new co(this),this.bindTexture=new Tn(this),this.bindVertexBuffer=new Yl(this),this.bindElementBuffer=new Yn(this),this.bindVertexArray=new Jn(this),this.pixelStoreUnpack=new Jl(this),this.pixelStoreUnpackPremultiplyAlpha=new uo(this),this.pixelStoreUnpackFlipY=new mt(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),Wn(t)){this.HALF_FLOAT=t.HALF_FLOAT;const c=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(n=t.RGBA16F)!==null&&n!==void 0?n:c==null?void 0:c.RGBA16F_EXT,this.RGB16F=(l=t.RGB16F)!==null&&l!==void 0?l:c==null?void 0:c.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const c=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=c==null?void 0:c.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,n){return new Sn(this,t,n)}createVertexBuffer(t,n,l){return new Wi(this,t,n,l)}createRenderbuffer(t,n,l){const c=this.gl,f=c.createRenderbuffer();return this.bindRenderbuffer.set(f),c.renderbufferStorage(c.RENDERBUFFER,t,n,l),this.bindRenderbuffer.set(null),f}createFramebuffer(t,n,l,c){return new Du(this,t,n,l,c)}clear({color:t,depth:n,stencil:l}){const c=this.gl;let f=0;t&&(f|=c.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),n!==void 0&&(f|=c.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),l!==void 0&&(f|=c.STENCIL_BUFFER_BIT,this.clearStencil.set(l),this.stencilMask.set(255)),c.clear(f)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){h.aD(t.blendFunction,Zt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return Wn(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var n;return Wn(this.gl)?this.gl.deleteVertexArray(t):(n=this.gl.getExtension("OES_vertex_array_object"))===null||n===void 0?void 0:n.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}class pt{constructor(t,n,l){this.func=t,this.mask=n,this.range=l}}pt.ReadOnly=!1,pt.ReadWrite=!0,pt.disabled=new pt(519,pt.ReadOnly,[0,1]);const Ls=7680;class Et{constructor(t,n,l,c,f,v){this.test=t,this.ref=n,this.mask=l,this.fail=c,this.depthFail=f,this.pass=v}}Et.disabled=new Et({func:519,mask:0},0,0,Ls,Ls,Ls);class Tt{constructor(t,n,l){this.enable=t,this.mode=n,this.frontFace=l}}let es;function ma(p,t,n,l,c,f,v){const b=p.context,A=b.gl,I=p.useProgram("collisionBox"),M=[];let k=0,L=0;for(let X=0;X<l.length;X++){const ae=l[X],he=t.getTile(ae),de=he.getBucket(n);if(!de)continue;let pe=ae.posMatrix;c[0]===0&&c[1]===0||(pe=p.translatePosMatrix(ae.posMatrix,he,c,f));const Se=v?de.textCollisionBox:de.iconCollisionBox,ve=de.collisionCircleArray;if(ve.length>0){const we=h.F(),Fe=pe;h.aP(we,de.placementInvProjMatrix,p.transform.glCoordMatrix),h.aP(we,we,de.placementViewportMatrix),M.push({circleArray:ve,circleOffset:L,transform:Fe,invTransform:we,coord:ae}),k+=ve.length/4,L=k}Se&&I.draw(b,A.LINES,pt.disabled,Et.disabled,p.colorModeForRenderPass(),Tt.disabled,bu(pe,p.transform,he),p.style.map.terrain&&p.style.map.terrain.getTerrainData(ae),n.id,Se.layoutVertexBuffer,Se.indexBuffer,Se.segments,null,p.transform.zoom,null,null,Se.collisionVertexBuffer)}if(!v||!M.length)return;const H=p.useProgram("collisionCircle"),q=new h.aQ;q.resize(4*k),q._trim();let W=0;for(const X of M)for(let ae=0;ae<X.circleArray.length/4;ae++){const he=4*ae,de=X.circleArray[he+0],pe=X.circleArray[he+1],Se=X.circleArray[he+2],ve=X.circleArray[he+3];q.emplace(W++,de,pe,Se,ve,0),q.emplace(W++,de,pe,Se,ve,1),q.emplace(W++,de,pe,Se,ve,2),q.emplace(W++,de,pe,Se,ve,3)}(!es||es.length<2*k)&&(es=function(X){const ae=2*X,he=new h.aS;he.resize(ae),he._trim();for(let de=0;de<ae;de++){const pe=6*de;he.uint16[pe+0]=4*de+0,he.uint16[pe+1]=4*de+1,he.uint16[pe+2]=4*de+2,he.uint16[pe+3]=4*de+2,he.uint16[pe+4]=4*de+3,he.uint16[pe+5]=4*de+0}return he}(k));const N=b.createIndexBuffer(es,!0),te=b.createVertexBuffer(q,h.aR.members,!0);for(const X of M){const ae={u_matrix:X.transform,u_inv_matrix:X.invTransform,u_camera_to_center_distance:(ue=p.transform).cameraToCenterDistance,u_viewport_size:[ue.width,ue.height]};H.draw(b,A.TRIANGLES,pt.disabled,Et.disabled,p.colorModeForRenderPass(),Tt.disabled,ae,p.style.map.terrain&&p.style.map.terrain.getTerrainData(X.coord),n.id,te,N,h.$.simpleSegment(0,2*X.circleOffset,X.circleArray.length,X.circleArray.length/2),null,p.transform.zoom,null,null,null)}var ue;te.destroy(),N.destroy()}Tt.disabled=new Tt(!1,1029,2305),Tt.backCCW=new Tt(!0,1029,2305);const tc=h.an(new Float32Array(16));function ga(p,t,n,l,c,f){const{horizontalAlign:v,verticalAlign:b}=h.at(p);return new h.P((-(v-.5)*t/c+l[0])*f,(-(b-.5)*n/c+l[1])*f)}function ya(p,t,n,l,c,f,v,b,A,I,M){const k=p.text.placedSymbolArray,L=p.text.dynamicLayoutVertexArray,H=p.icon.dynamicLayoutVertexArray,q={};L.clear();for(let W=0;W<k.length;W++){const N=k.get(W),te=N.hidden||!N.crossTileID||p.allowVerticalPlacement&&!N.placedOrientation?null:l[N.crossTileID];if(te){const ue=new h.P(N.anchorX,N.anchorY),X=G(ue,n?v:f,M),ae=D(c.cameraToCenterDistance,X.signedDistanceFromCamera);let he=h.ai(p.textSizeData,A,N)*ae/h.ao;n&&(he*=p.tilePixelRatio/b);const{width:de,height:pe,anchor:Se,textOffset:ve,textBoxScale:we}=te,Fe=ga(Se,de,pe,ve,we,he),Qe=n?G(ue.add(Fe),f,M).point:X.point.add(t?Fe.rotate(-c.angle):Fe),ke=p.allowVerticalPlacement&&N.placedOrientation===h.ah.vertical?Math.PI/2:0;for(let We=0;We<N.numGlyphs;We++)h.aj(L,Qe,ke);I&&N.associatedIconIndex>=0&&(q[N.associatedIconIndex]={shiftedAnchor:Qe,angle:ke})}else Ue(N.numGlyphs,L)}if(I){H.clear();const W=p.icon.placedSymbolArray;for(let N=0;N<W.length;N++){const te=W.get(N);if(te.hidden)Ue(te.numGlyphs,H);else{const ue=q[N];if(ue)for(let X=0;X<te.numGlyphs;X++)h.aj(H,ue.shiftedAnchor,ue.angle);else Ue(te.numGlyphs,H)}}p.icon.dynamicLayoutVertexBuffer.updateData(H)}p.text.dynamicLayoutVertexBuffer.updateData(L)}function ho(p,t,n){return n.iconsInText&&t?"symbolTextAndIcon":p?"symbolSDF":"symbolIcon"}function ic(p,t,n,l,c,f,v,b,A,I,M,k){const L=p.context,H=L.gl,q=p.transform,W=b==="map",N=A==="map",te=b!=="viewport"&&n.layout.get("symbol-placement")!=="point",ue=W&&!N&&!te,X=!n.layout.get("symbol-sort-key").isConstant();let ae=!1;const he=p.depthModeForSublayer(0,pt.ReadOnly),de=n._unevaluatedLayout.hasValue("text-variable-anchor")||n._unevaluatedLayout.hasValue("text-variable-anchor-offset"),pe=[];for(const Se of l){const ve=t.getTile(Se),we=ve.getBucket(n);if(!we)continue;const Fe=c?we.text:we.icon;if(!Fe||!Fe.segments.get().length||!Fe.hasVisibleVertices)continue;const Qe=Fe.programConfigurations.get(n.id),ke=c||we.sdfIcons,We=c?we.textSizeData:we.iconSizeData,rt=N||q.pitch!==0,ct=p.useProgram(ho(ke,c,we),Qe),Xe=h.ag(We,q.zoom),st=p.style.map.terrain&&p.style.map.terrain.getTerrainData(Se);let at,Ft,At,Li,Yt=[0,0],It=null;if(c)Ft=ve.glyphAtlasTexture,At=H.LINEAR,at=ve.glyphAtlasTexture.size,we.iconsInText&&(Yt=ve.imageAtlasTexture.size,It=ve.imageAtlasTexture,Li=rt||p.options.rotating||p.options.zooming||We.kind==="composite"||We.kind==="camera"?H.LINEAR:H.NEAREST);else{const Dt=n.layout.get("icon-size").constantOr(0)!==1||we.iconsNeedLinear;Ft=ve.imageAtlasTexture,At=ke||p.options.rotating||p.options.zooming||Dt||rt?H.LINEAR:H.NEAREST,at=ve.imageAtlasTexture.size}const _i=Je(ve,1,p.transform.zoom),fr=Yr(Se.posMatrix,N,W,p.transform,_i),Pr=Lr(Se.posMatrix,N,W,p.transform,_i),Mn=de&&we.hasTextData(),kn=n.layout.get("icon-text-fit")!=="none"&&Mn&&we.hasIconData();if(te){const Dt=p.style.map.terrain?(Xi,lt)=>p.style.map.terrain.getElevation(Se,Xi,lt):null,ci=n.layout.get("text-rotation-alignment")==="map";$(we,Se.posMatrix,p,c,fr,Pr,N,I,ci,Dt)}const Mr=p.translatePosMatrix(Se.posMatrix,ve,f,v),mr=te||c&&de||kn?tc:fr,Nt=p.translatePosMatrix(Pr,ve,f,v,!0),Mt=ke&&n.paint.get(c?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let qt;qt=ke?we.iconsInText?wu(We.kind,Xe,ue,N,p,Mr,mr,Nt,at,Yt):Zn(We.kind,Xe,ue,N,p,Mr,mr,Nt,c,at,!0):zs(We.kind,Xe,ue,N,p,Mr,mr,Nt,c,at);const hs={program:ct,buffers:Fe,uniformValues:qt,atlasTexture:Ft,atlasTextureIcon:It,atlasInterpolation:At,atlasInterpolationIcon:Li,isSDF:ke,hasHalo:Mt};if(X&&we.canOverlap){ae=!0;const Dt=Fe.segments.get();for(const ci of Dt)pe.push({segments:new h.$([ci]),sortKey:ci.sortKey,state:hs,terrainData:st})}else pe.push({segments:Fe.segments,sortKey:0,state:hs,terrainData:st})}ae&&pe.sort((Se,ve)=>Se.sortKey-ve.sortKey);for(const Se of pe){const ve=Se.state;if(L.activeTexture.set(H.TEXTURE0),ve.atlasTexture.bind(ve.atlasInterpolation,H.CLAMP_TO_EDGE),ve.atlasTextureIcon&&(L.activeTexture.set(H.TEXTURE1),ve.atlasTextureIcon&&ve.atlasTextureIcon.bind(ve.atlasInterpolationIcon,H.CLAMP_TO_EDGE)),ve.isSDF){const we=ve.uniformValues;ve.hasHalo&&(we.u_is_halo=1,_a(ve.buffers,Se.segments,n,p,ve.program,he,M,k,we,Se.terrainData)),we.u_is_halo=0}_a(ve.buffers,Se.segments,n,p,ve.program,he,M,k,ve.uniformValues,Se.terrainData)}}function _a(p,t,n,l,c,f,v,b,A,I){const M=l.context;c.draw(M,M.gl.TRIANGLES,f,v,b,Tt.disabled,A,I,n.id,p.layoutVertexBuffer,p.indexBuffer,t,n.paint,l.transform.zoom,p.programConfigurations.get(n.id),p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer)}function rc(p,t,n,l,c){if(!n||!l||!l.imageAtlas)return;const f=l.imageAtlas.patternPositions;let v=f[n.to.toString()],b=f[n.from.toString()];if(!v&&b&&(v=b),!b&&v&&(b=v),!v||!b){const A=c.getPaintProperty(t);v=f[A],b=f[A]}v&&b&&p.setConstantPatternPositions(v,b)}function po(p,t,n,l,c,f,v){const b=p.context.gl,A="fill-pattern",I=n.paint.get(A),M=I&&I.constantOr(1),k=n.getCrossfadeParameters();let L,H,q,W,N;v?(H=M&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",L=b.LINES):(H=M?"fillPattern":"fill",L=b.TRIANGLES);const te=I.constantOr(null);for(const ue of l){const X=t.getTile(ue);if(M&&!X.patternsLoaded())continue;const ae=X.getBucket(n);if(!ae)continue;const he=ae.programConfigurations.get(n.id),de=p.useProgram(H,he),pe=p.style.map.terrain&&p.style.map.terrain.getTerrainData(ue);M&&(p.context.activeTexture.set(b.TEXTURE0),X.imageAtlasTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),he.updatePaintBuffers(k)),rc(he,A,te,X,n);const Se=pe?ue:null,ve=p.translatePosMatrix(Se?Se.posMatrix:ue.posMatrix,X,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor"));if(v){W=ae.indexBuffer2,N=ae.segments2;const we=[b.drawingBufferWidth,b.drawingBufferHeight];q=H==="fillOutlinePattern"&&M?vu(ve,p,k,X,we):Vl(ve,we)}else W=ae.indexBuffer,N=ae.segments,q=M?Ul(ve,p,k,X):sa(ve);de.draw(p.context,L,c,p.stencilModeForClipping(ue),f,Tt.disabled,q,pe,n.id,ae.layoutVertexBuffer,W,N,n.paint,p.transform.zoom,he)}}function ts(p,t,n,l,c,f,v){const b=p.context,A=b.gl,I="fill-extrusion-pattern",M=n.paint.get(I),k=M.constantOr(1),L=n.getCrossfadeParameters(),H=n.paint.get("fill-extrusion-opacity"),q=M.constantOr(null);for(const W of l){const N=t.getTile(W),te=N.getBucket(n);if(!te)continue;const ue=p.style.map.terrain&&p.style.map.terrain.getTerrainData(W),X=te.programConfigurations.get(n.id),ae=p.useProgram(k?"fillExtrusionPattern":"fillExtrusion",X);k&&(p.context.activeTexture.set(A.TEXTURE0),N.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),X.updatePaintBuffers(L)),rc(X,I,q,N,n);const he=p.translatePosMatrix(W.posMatrix,N,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),de=n.paint.get("fill-extrusion-vertical-gradient"),pe=k?xu(he,p,de,H,W,L,N):Nl(he,p,de,H);ae.draw(b,b.gl.TRIANGLES,c,f,v,Tt.backCCW,pe,ue,n.id,te.layoutVertexBuffer,te.indexBuffer,te.segments,n.paint,p.transform.zoom,X,p.style.map.terrain&&te.centroidVertexBuffer)}}function fo(p,t,n,l,c,f,v){const b=p.context,A=b.gl,I=n.fbo;if(!I)return;const M=p.useProgram("hillshade"),k=p.style.map.terrain&&p.style.map.terrain.getTerrainData(t);b.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,I.colorAttachment.get()),M.draw(b,A.TRIANGLES,c,f,v,Tt.disabled,((L,H,q,W)=>{const N=q.paint.get("hillshade-shadow-color"),te=q.paint.get("hillshade-highlight-color"),ue=q.paint.get("hillshade-accent-color");let X=q.paint.get("hillshade-illumination-direction")*(Math.PI/180);q.paint.get("hillshade-illumination-anchor")==="viewport"&&(X-=L.transform.angle);const ae=!L.options.moving;return{u_matrix:W?W.posMatrix:L.transform.calculatePosMatrix(H.tileID.toUnwrapped(),ae),u_image:0,u_latrange:Gl(0,H.tileID),u_light:[q.paint.get("hillshade-exaggeration"),X],u_shadow:N,u_highlight:te,u_accent:ue}})(p,n,l,k?t:null),k,l.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments)}function nc(p,t,n,l,c,f){const v=p.context,b=v.gl,A=t.dem;if(A&&A.data){const I=A.dim,M=A.stride,k=A.getPixels();if(v.activeTexture.set(b.TEXTURE1),v.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||p.getTileTexture(M),t.demTexture){const H=t.demTexture;H.update(k,{premultiply:!1}),H.bind(b.NEAREST,b.CLAMP_TO_EDGE)}else t.demTexture=new Ut(v,k,b.RGBA,{premultiply:!1}),t.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE);v.activeTexture.set(b.TEXTURE0);let L=t.fbo;if(!L){const H=new Ut(v,{width:I,height:I,data:null},b.RGBA);H.bind(b.LINEAR,b.CLAMP_TO_EDGE),L=t.fbo=v.createFramebuffer(I,I,!0,!1),L.colorAttachment.set(H.texture)}v.bindFramebuffer.set(L.framebuffer),v.viewport.set([0,0,I,I]),p.useProgram("hillshadePrepare").draw(v,b.TRIANGLES,l,c,f,Tt.disabled,((H,q)=>{const W=q.stride,N=h.F();return h.aN(N,0,h.W,-h.W,0,0,1),h.H(N,N,[0,-h.W,0]),{u_matrix:N,u_image:1,u_dimension:[W,W],u_zoom:H.overscaledZ,u_unpack:q.getUnpackVector()}})(t.tileID,A),null,n.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments),t.needsHillshadePrepare=!1}}function sc(p,t,n,l,c,f){const v=l.paint.get("raster-fade-duration");if(!f&&v>0){const b=Q.now(),A=(b-p.timeAdded)/v,I=t?(b-t.timeAdded)/v:-1,M=n.getSource(),k=c.coveringZoomLevel({tileSize:M.tileSize,roundZoom:M.roundZoom}),L=!t||Math.abs(t.tileID.overscaledZ-k)>Math.abs(p.tileID.overscaledZ-k),H=L&&p.refreshedUponExpiration?1:h.ac(L?A:1-I,0,1);return p.refreshedUponExpiration&&A>=1&&(p.refreshedUponExpiration=!1),t?{opacity:1,mix:1-H}:{opacity:H,mix:0}}return{opacity:1,mix:0}}const xa=new h.aO(1,0,0,1),mo=new h.aO(0,1,0,1),Ru=new h.aO(0,0,1,1),ac=new h.aO(1,0,1,1),jt=new h.aO(0,1,1,1);function Qr(p,t,n,l){is(p,0,t+n/2,p.transform.width,n,l)}function Ki(p,t,n,l){is(p,t-n/2,0,n,p.transform.height,l)}function is(p,t,n,l,c,f){const v=p.context,b=v.gl;b.enable(b.SCISSOR_TEST),b.scissor(t*p.pixelRatio,n*p.pixelRatio,l*p.pixelRatio,c*p.pixelRatio),v.clear({color:f}),b.disable(b.SCISSOR_TEST)}function go(p,t,n){const l=p.context,c=l.gl,f=n.posMatrix,v=p.useProgram("debug"),b=pt.disabled,A=Et.disabled,I=p.colorModeForRenderPass(),M="$debug",k=p.style.map.terrain&&p.style.map.terrain.getTerrainData(n);l.activeTexture.set(c.TEXTURE0);const L=t.getTileByID(n.key).latestRawTileData,H=Math.floor((L&&L.byteLength||0)/1024),q=t.getTile(n).tileSize,W=512/Math.min(q,512)*(n.overscaledZ/p.transform.zoom)*.5;let N=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(N+=` => ${n.overscaledZ}`),function(te,ue){te.initDebugOverlayCanvas();const X=te.debugOverlayCanvas,ae=te.context.gl,he=te.debugOverlayCanvas.getContext("2d");he.clearRect(0,0,X.width,X.height),he.shadowColor="white",he.shadowBlur=2,he.lineWidth=1.5,he.strokeStyle="white",he.textBaseline="top",he.font="bold 36px Open Sans, sans-serif",he.fillText(ue,5,5),he.strokeText(ue,5,5),te.debugOverlayTexture.update(X),te.debugOverlayTexture.bind(ae.LINEAR,ae.CLAMP_TO_EDGE)}(p,`${N} ${H}kB`),v.draw(l,c.TRIANGLES,b,A,Zt.alphaBlended,Tt.disabled,aa(f,h.aO.transparent,W),null,M,p.debugBuffer,p.quadTriangleIndexBuffer,p.debugSegments),v.draw(l,c.LINE_STRIP,b,A,I,Tt.disabled,aa(f,h.aO.red),k,M,p.debugBuffer,p.tileBorderIndexBuffer,p.debugSegments)}function yo(p,t,n){const l=p.context,c=l.gl,f=p.colorModeForRenderPass(),v=new pt(c.LEQUAL,pt.ReadWrite,p.depthRangeFor3D),b=p.useProgram("terrain"),A=t.getTerrainMesh();l.bindFramebuffer.set(null),l.viewport.set([0,0,p.width,p.height]);for(const I of n){const M=p.renderToTexture.getTexture(I),k=t.getTerrainData(I.tileID);l.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,M.texture);const L={u_matrix:p.transform.calculatePosMatrix(I.tileID.toUnwrapped()),u_texture:0,u_ele_delta:t.getMeshFrameDelta(p.transform.zoom)};b.draw(l,c.TRIANGLES,v,Et.disabled,f,Tt.backCCW,L,k,"terrain",A.vertexBuffer,A.indexBuffer,A.segments)}}class rs{constructor(t,n){this.context=new ec(t),this.transform=n,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:h.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Ie.maxUnderzooming+Ie.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Vt}resize(t,n,l){if(this.width=Math.floor(t*l),this.height=Math.floor(n*l),this.pixelRatio=l,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const c of this.style._order)this.style._layers[c].resize()}setup(){const t=this.context,n=new h.aV;n.emplaceBack(0,0),n.emplaceBack(h.W,0),n.emplaceBack(0,h.W),n.emplaceBack(h.W,h.W),this.tileExtentBuffer=t.createVertexBuffer(n,Ar.members),this.tileExtentSegments=h.$.simpleSegment(0,0,4,2);const l=new h.aV;l.emplaceBack(0,0),l.emplaceBack(h.W,0),l.emplaceBack(0,h.W),l.emplaceBack(h.W,h.W),this.debugBuffer=t.createVertexBuffer(l,Ar.members),this.debugSegments=h.$.simpleSegment(0,0,4,5);const c=new h.Z;c.emplaceBack(0,0,0,0),c.emplaceBack(h.W,0,h.W,0),c.emplaceBack(0,h.W,0,h.W),c.emplaceBack(h.W,h.W,h.W,h.W),this.rasterBoundsBuffer=t.createVertexBuffer(c,ui.members),this.rasterBoundsSegments=h.$.simpleSegment(0,0,4,2);const f=new h.aV;f.emplaceBack(0,0),f.emplaceBack(1,0),f.emplaceBack(0,1),f.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(f,Ar.members),this.viewportSegments=h.$.simpleSegment(0,0,4,2);const v=new h.aW;v.emplaceBack(0),v.emplaceBack(1),v.emplaceBack(3),v.emplaceBack(2),v.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(v);const b=new h.aX;b.emplaceBack(0,1,2),b.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(b);const A=this.context.gl;this.stencilClearMode=new Et({func:A.ALWAYS,mask:0},0,255,A.ZERO,A.ZERO,A.ZERO)}clearStencil(){const t=this.context,n=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const l=h.F();h.aN(l,0,this.width,this.height,0,0,1),h.J(l,l,[n.drawingBufferWidth,n.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,n.TRIANGLES,pt.disabled,this.stencilClearMode,Zt.disabled,Tt.disabled,to(l),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,n){if(this.currentStencilSource===t.source||!t.isTileClipped()||!n||!n.length)return;this.currentStencilSource=t.source;const l=this.context,c=l.gl;this.nextStencilID+n.length>256&&this.clearStencil(),l.setColorMode(Zt.disabled),l.setDepthMode(pt.disabled);const f=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const v of n){const b=this._tileClippingMaskIDs[v.key]=this.nextStencilID++,A=this.style.map.terrain&&this.style.map.terrain.getTerrainData(v);f.draw(l,c.TRIANGLES,pt.disabled,new Et({func:c.ALWAYS,mask:0},b,255,c.KEEP,c.KEEP,c.REPLACE),Zt.disabled,Tt.disabled,to(v.posMatrix),A,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,n=this.context.gl;return new Et({func:n.NOTEQUAL,mask:255},t,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(t){const n=this.context.gl;return new Et({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,n.KEEP,n.KEEP,n.REPLACE)}stencilConfigForOverlap(t){const n=this.context.gl,l=t.sort((v,b)=>b.overscaledZ-v.overscaledZ),c=l[l.length-1].overscaledZ,f=l[0].overscaledZ-c+1;if(f>1){this.currentStencilSource=void 0,this.nextStencilID+f>256&&this.clearStencil();const v={};for(let b=0;b<f;b++)v[b+c]=new Et({func:n.GEQUAL,mask:255},b+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=f,[v,l]}return[{[c]:Et.disabled},l]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Zt([t.CONSTANT_COLOR,t.ONE],new h.aO(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Zt.unblended:Zt.alphaBlended}depthModeForSublayer(t,n,l){if(!this.opaquePassEnabledForLayer())return pt.disabled;const c=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new pt(l||this.context.gl.LEQUAL,n,[c,c])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,n){this.style=t,this.options=n,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(Q.now()),this.imageManager.beginFrame();const l=this.style._order,c=this.style.sourceCaches,f={},v={},b={};for(const A in c){const I=c[A];I.used&&I.prepare(this.context),f[A]=I.getVisibleCoordinates(),v[A]=f[A].slice().reverse(),b[A]=I.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let A=0;A<l.length;A++)if(this.style._layers[l[A]].is3D()){this.opaquePassCutoff=A;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const A of l){const I=this.style._layers[A];if(!I.hasOffscreenPass()||I.isHidden(this.transform.zoom))continue;const M=v[I.source];(I.type==="custom"||M.length)&&this.renderLayer(this,c[I.source],I,M)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:n.showOverdrawInspector?h.aO.black:h.aO.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=l.length-1;this.currentLayer>=0;this.currentLayer--){const A=this.style._layers[l[this.currentLayer]],I=c[A.source],M=f[A.source];this._renderTileClippingMasks(A,M),this.renderLayer(this,I,A,M)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<l.length;this.currentLayer++){const A=this.style._layers[l[this.currentLayer]],I=c[A.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(A))continue;const M=(A.type==="symbol"?b:v)[A.source];this._renderTileClippingMasks(A,f[A.source]),this.renderLayer(this,I,A,M)}if(this.options.showTileBoundaries){const A=function(I,M){let k=null;const L=Object.values(I._layers).flatMap(N=>N.source&&!N.isHidden(M)?[I.sourceCaches[N.source]]:[]),H=L.filter(N=>N.getSource().type==="vector"),q=L.filter(N=>N.getSource().type!=="vector"),W=N=>{(!k||k.getSource().maxzoom<N.getSource().maxzoom)&&(k=N)};return H.forEach(N=>W(N)),k||q.forEach(N=>W(N)),k}(this.style,this.transform.zoom);A&&function(I,M,k){for(let L=0;L<k.length;L++)go(I,M,k[L])}(this,A,A.getVisibleCoordinates())}this.options.showPadding&&function(A){const I=A.transform.padding;Qr(A,A.transform.height-(I.top||0),3,xa),Qr(A,I.bottom||0,3,mo),Ki(A,I.left||0,3,Ru),Ki(A,A.transform.width-(I.right||0),3,ac);const M=A.transform.centerPoint;(function(k,L,H,q){is(k,L-1,H-10,2,20,q),is(k,L-10,H-1,20,2,q)})(A,M.x,A.transform.height-M.y,jt)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(t){if(!this.style||!this.style.map||!this.style.map.terrain)return;const n=this.terrainFacilitator.matrix,l=this.transform.projMatrix;let c=this.terrainFacilitator.dirty;c||(c=t?!h.aY(n,l):!h.aZ(n,l)),c||(c=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),c&&(h.a_(n,l),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(f,v){const b=f.context,A=b.gl,I=Zt.unblended,M=new pt(A.LEQUAL,pt.ReadWrite,[0,1]),k=v.getTerrainMesh(),L=v.sourceCache.getRenderableTiles(),H=f.useProgram("terrainDepth");b.bindFramebuffer.set(v.getFramebuffer("depth").framebuffer),b.viewport.set([0,0,f.width/devicePixelRatio,f.height/devicePixelRatio]),b.clear({color:h.aO.transparent,depth:1});for(const q of L){const W=v.getTerrainData(q.tileID),N={u_matrix:f.transform.calculatePosMatrix(q.tileID.toUnwrapped()),u_ele_delta:v.getMeshFrameDelta(f.transform.zoom)};H.draw(b,A.TRIANGLES,M,Et.disabled,I,Tt.backCCW,N,W,"terrain",k.vertexBuffer,k.indexBuffer,k.segments)}b.bindFramebuffer.set(null),b.viewport.set([0,0,f.width,f.height])}(this,this.style.map.terrain),function(f,v){const b=f.context,A=b.gl,I=Zt.unblended,M=new pt(A.LEQUAL,pt.ReadWrite,[0,1]),k=v.getTerrainMesh(),L=v.getCoordsTexture(),H=v.sourceCache.getRenderableTiles(),q=f.useProgram("terrainCoords");b.bindFramebuffer.set(v.getFramebuffer("coords").framebuffer),b.viewport.set([0,0,f.width/devicePixelRatio,f.height/devicePixelRatio]),b.clear({color:h.aO.transparent,depth:1}),v.coordsIndex=[];for(const W of H){const N=v.getTerrainData(W.tileID);b.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,L.texture);const te={u_matrix:f.transform.calculatePosMatrix(W.tileID.toUnwrapped()),u_terrain_coords_id:(255-v.coordsIndex.length)/255,u_texture:0,u_ele_delta:v.getMeshFrameDelta(f.transform.zoom)};q.draw(b,A.TRIANGLES,M,Et.disabled,I,Tt.backCCW,te,N,"terrain",k.vertexBuffer,k.indexBuffer,k.segments),v.coordsIndex.push(W.tileID.key)}b.bindFramebuffer.set(null),b.viewport.set([0,0,f.width,f.height])}(this,this.style.map.terrain))}renderLayer(t,n,l,c){if(!l.isHidden(this.transform.zoom)&&(l.type==="background"||l.type==="custom"||(c||[]).length))switch(this.id=l.id,l.type){case"symbol":(function(f,v,b,A,I){if(f.renderPass!=="translucent")return;const M=Et.disabled,k=f.colorModeForRenderPass();(b._unevaluatedLayout.hasValue("text-variable-anchor")||b._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(L,H,q,W,N,te,ue){const X=H.transform,ae=N==="map",he=te==="map";for(const de of L){const pe=W.getTile(de),Se=pe.getBucket(q);if(!Se||!Se.text||!Se.text.segments.get().length)continue;const ve=h.ag(Se.textSizeData,X.zoom),we=Je(pe,1,H.transform.zoom),Fe=Yr(de.posMatrix,he,ae,H.transform,we),Qe=q.layout.get("icon-text-fit")!=="none"&&Se.hasIconData();if(ve){const ke=Math.pow(2,X.zoom-pe.tileID.overscaledZ);ya(Se,ae,he,ue,X,Fe,de.posMatrix,ke,ve,Qe,H.style.map.terrain?(We,rt)=>H.style.map.terrain.getElevation(de,We,rt):null)}}}(A,f,b,v,b.layout.get("text-rotation-alignment"),b.layout.get("text-pitch-alignment"),I),b.paint.get("icon-opacity").constantOr(1)!==0&&ic(f,v,b,A,!1,b.paint.get("icon-translate"),b.paint.get("icon-translate-anchor"),b.layout.get("icon-rotation-alignment"),b.layout.get("icon-pitch-alignment"),b.layout.get("icon-keep-upright"),M,k),b.paint.get("text-opacity").constantOr(1)!==0&&ic(f,v,b,A,!0,b.paint.get("text-translate"),b.paint.get("text-translate-anchor"),b.layout.get("text-rotation-alignment"),b.layout.get("text-pitch-alignment"),b.layout.get("text-keep-upright"),M,k),v.map.showCollisionBoxes&&(ma(f,v,b,A,b.paint.get("text-translate"),b.paint.get("text-translate-anchor"),!0),ma(f,v,b,A,b.paint.get("icon-translate"),b.paint.get("icon-translate-anchor"),!1))})(t,n,l,c,this.style.placement.variableOffsets);break;case"circle":(function(f,v,b,A){if(f.renderPass!=="translucent")return;const I=b.paint.get("circle-opacity"),M=b.paint.get("circle-stroke-width"),k=b.paint.get("circle-stroke-opacity"),L=!b.layout.get("circle-sort-key").isConstant();if(I.constantOr(1)===0&&(M.constantOr(1)===0||k.constantOr(1)===0))return;const H=f.context,q=H.gl,W=f.depthModeForSublayer(0,pt.ReadOnly),N=Et.disabled,te=f.colorModeForRenderPass(),ue=[];for(let X=0;X<A.length;X++){const ae=A[X],he=v.getTile(ae),de=he.getBucket(b);if(!de)continue;const pe=de.programConfigurations.get(b.id),Se=f.useProgram("circle",pe),ve=de.layoutVertexBuffer,we=de.indexBuffer,Fe=f.style.map.terrain&&f.style.map.terrain.getTerrainData(ae),Qe={programConfiguration:pe,program:Se,layoutVertexBuffer:ve,indexBuffer:we,uniformValues:jl(f,ae,he,b),terrainData:Fe};if(L){const ke=de.segments.get();for(const We of ke)ue.push({segments:new h.$([We]),sortKey:We.sortKey,state:Qe})}else ue.push({segments:de.segments,sortKey:0,state:Qe})}L&&ue.sort((X,ae)=>X.sortKey-ae.sortKey);for(const X of ue){const{programConfiguration:ae,program:he,layoutVertexBuffer:de,indexBuffer:pe,uniformValues:Se,terrainData:ve}=X.state;he.draw(H,q.TRIANGLES,W,N,te,Tt.disabled,Se,ve,b.id,de,pe,X.segments,b.paint,f.transform.zoom,ae)}})(t,n,l,c);break;case"heatmap":(function(f,v,b,A){if(b.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){const I=f.context,M=I.gl,k=Et.disabled,L=new Zt([M.ONE,M.ONE],h.aO.transparent,[!0,!0,!0,!0]);(function(H,q,W){const N=H.gl;H.activeTexture.set(N.TEXTURE1),H.viewport.set([0,0,q.width/4,q.height/4]);let te=W.heatmapFbo;if(te)N.bindTexture(N.TEXTURE_2D,te.colorAttachment.get()),H.bindFramebuffer.set(te.framebuffer);else{const ue=N.createTexture();N.bindTexture(N.TEXTURE_2D,ue),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_WRAP_S,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_WRAP_T,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_MIN_FILTER,N.LINEAR),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_MAG_FILTER,N.LINEAR),te=W.heatmapFbo=H.createFramebuffer(q.width/4,q.height/4,!1,!1),function(X,ae,he,de){var pe,Se;const ve=X.gl,we=(pe=X.HALF_FLOAT)!==null&&pe!==void 0?pe:ve.UNSIGNED_BYTE,Fe=(Se=X.RGBA16F)!==null&&Se!==void 0?Se:ve.RGBA;ve.texImage2D(ve.TEXTURE_2D,0,Fe,ae.width/4,ae.height/4,0,ve.RGBA,we,null),de.colorAttachment.set(he)}(H,q,ue,te)}})(I,f,b),I.clear({color:h.aO.transparent});for(let H=0;H<A.length;H++){const q=A[H];if(v.hasRenderableParent(q))continue;const W=v.getTile(q),N=W.getBucket(b);if(!N)continue;const te=N.programConfigurations.get(b.id),ue=f.useProgram("heatmap",te),{zoom:X}=f.transform;ue.draw(I,M.TRIANGLES,pt.disabled,k,L,Tt.disabled,ql(q.posMatrix,W,X,b.paint.get("heatmap-intensity")),null,b.id,N.layoutVertexBuffer,N.indexBuffer,N.segments,b.paint,f.transform.zoom,te)}I.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),function(I,M){const k=I.context,L=k.gl,H=M.heatmapFbo;if(!H)return;k.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,H.colorAttachment.get()),k.activeTexture.set(L.TEXTURE1);let q=M.colorRampTexture;q||(q=M.colorRampTexture=new Ut(k,M.colorRamp,L.RGBA)),q.bind(L.LINEAR,L.CLAMP_TO_EDGE),I.useProgram("heatmapTexture").draw(k,L.TRIANGLES,pt.disabled,Et.disabled,I.colorModeForRenderPass(),Tt.disabled,((W,N,te,ue)=>{const X=h.F();h.aN(X,0,W.width,W.height,0,0,1);const ae=W.context.gl;return{u_matrix:X,u_world:[ae.drawingBufferWidth,ae.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:N.paint.get("heatmap-opacity")}})(I,M),null,M.id,I.viewportBuffer,I.quadTriangleIndexBuffer,I.viewportSegments,M.paint,I.transform.zoom)}(f,b))})(t,n,l,c);break;case"line":(function(f,v,b,A){if(f.renderPass!=="translucent")return;const I=b.paint.get("line-opacity"),M=b.paint.get("line-width");if(I.constantOr(1)===0||M.constantOr(1)===0)return;const k=f.depthModeForSublayer(0,pt.ReadOnly),L=f.colorModeForRenderPass(),H=b.paint.get("line-dasharray"),q=b.paint.get("line-pattern"),W=q.constantOr(1),N=b.paint.get("line-gradient"),te=b.getCrossfadeParameters(),ue=W?"linePattern":H?"lineSDF":N?"lineGradient":"line",X=f.context,ae=X.gl;let he=!0;for(const de of A){const pe=v.getTile(de);if(W&&!pe.patternsLoaded())continue;const Se=pe.getBucket(b);if(!Se)continue;const ve=Se.programConfigurations.get(b.id),we=f.context.program.get(),Fe=f.useProgram(ue,ve),Qe=he||Fe.program!==we,ke=f.style.map.terrain&&f.style.map.terrain.getTerrainData(de),We=q.constantOr(null);if(We&&pe.imageAtlas){const Xe=pe.imageAtlas,st=Xe.patternPositions[We.to.toString()],at=Xe.patternPositions[We.from.toString()];st&&at&&ve.setConstantPatternPositions(st,at)}const rt=ke?de:null,ct=W?la(f,pe,b,te,rt):H?sr(f,pe,b,H,te,rt):N?wn(f,pe,b,Se.lineClipsArray.length,rt):oa(f,pe,b,rt);if(W)X.activeTexture.set(ae.TEXTURE0),pe.imageAtlasTexture.bind(ae.LINEAR,ae.CLAMP_TO_EDGE),ve.updatePaintBuffers(te);else if(H&&(Qe||f.lineAtlas.dirty))X.activeTexture.set(ae.TEXTURE0),f.lineAtlas.bind(X);else if(N){const Xe=Se.gradients[b.id];let st=Xe.texture;if(b.gradientVersion!==Xe.version){let at=256;if(b.stepInterpolant){const Ft=v.getSource().maxzoom,At=de.canonical.z===Ft?Math.ceil(1<<f.transform.maxZoom-de.canonical.z):1;at=h.ac(h.aT(Se.maxLineLength/h.W*1024*At),256,X.maxTextureSize)}Xe.gradient=h.aU({expression:b.gradientExpression(),evaluationKey:"lineProgress",resolution:at,image:Xe.gradient||void 0,clips:Se.lineClipsArray}),Xe.texture?Xe.texture.update(Xe.gradient):Xe.texture=new Ut(X,Xe.gradient,ae.RGBA),Xe.version=b.gradientVersion,st=Xe.texture}X.activeTexture.set(ae.TEXTURE0),st.bind(b.stepInterpolant?ae.NEAREST:ae.LINEAR,ae.CLAMP_TO_EDGE)}Fe.draw(X,ae.TRIANGLES,k,f.stencilModeForClipping(de),L,Tt.disabled,ct,ke,b.id,Se.layoutVertexBuffer,Se.indexBuffer,Se.segments,b.paint,f.transform.zoom,ve,Se.layoutVertexBuffer2),he=!1}})(t,n,l,c);break;case"fill":(function(f,v,b,A){const I=b.paint.get("fill-color"),M=b.paint.get("fill-opacity");if(M.constantOr(1)===0)return;const k=f.colorModeForRenderPass(),L=b.paint.get("fill-pattern"),H=f.opaquePassEnabledForLayer()&&!L.constantOr(1)&&I.constantOr(h.aO.transparent).a===1&&M.constantOr(0)===1?"opaque":"translucent";if(f.renderPass===H){const q=f.depthModeForSublayer(1,f.renderPass==="opaque"?pt.ReadWrite:pt.ReadOnly);po(f,v,b,A,q,k,!1)}if(f.renderPass==="translucent"&&b.paint.get("fill-antialias")){const q=f.depthModeForSublayer(b.getPaintProperty("fill-outline-color")?2:0,pt.ReadOnly);po(f,v,b,A,q,k,!0)}})(t,n,l,c);break;case"fill-extrusion":(function(f,v,b,A){const I=b.paint.get("fill-extrusion-opacity");if(I!==0&&f.renderPass==="translucent"){const M=new pt(f.context.gl.LEQUAL,pt.ReadWrite,f.depthRangeFor3D);if(I!==1||b.paint.get("fill-extrusion-pattern").constantOr(1))ts(f,v,b,A,M,Et.disabled,Zt.disabled),ts(f,v,b,A,M,f.stencilModeFor3D(),f.colorModeForRenderPass());else{const k=f.colorModeForRenderPass();ts(f,v,b,A,M,Et.disabled,k)}}})(t,n,l,c);break;case"hillshade":(function(f,v,b,A){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent")return;const I=f.context,M=f.depthModeForSublayer(0,pt.ReadOnly),k=f.colorModeForRenderPass(),[L,H]=f.renderPass==="translucent"?f.stencilConfigForOverlap(A):[{},A];for(const q of H){const W=v.getTile(q);W.needsHillshadePrepare!==void 0&&W.needsHillshadePrepare&&f.renderPass==="offscreen"?nc(f,W,b,M,Et.disabled,k):f.renderPass==="translucent"&&fo(f,q,W,b,M,L[q.overscaledZ],k)}I.viewport.set([0,0,f.width,f.height])})(t,n,l,c);break;case"raster":(function(f,v,b,A){if(f.renderPass!=="translucent"||b.paint.get("raster-opacity")===0||!A.length)return;const I=f.context,M=I.gl,k=v.getSource(),L=f.useProgram("raster"),H=f.colorModeForRenderPass(),[q,W]=k instanceof Tr?[{},A]:f.stencilConfigForOverlap(A),N=W[W.length-1].overscaledZ,te=!f.options.moving;for(const ue of W){const X=f.depthModeForSublayer(ue.overscaledZ-N,b.paint.get("raster-opacity")===1?pt.ReadWrite:pt.ReadOnly,M.LESS),ae=v.getTile(ue);ae.registerFadeDuration(b.paint.get("raster-fade-duration"));const he=v.findLoadedParent(ue,0),de=sc(ae,he,v,b,f.transform,f.style.map.terrain);let pe,Se;const ve=b.paint.get("raster-resampling")==="nearest"?M.NEAREST:M.LINEAR;I.activeTexture.set(M.TEXTURE0),ae.texture.bind(ve,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),I.activeTexture.set(M.TEXTURE1),he?(he.texture.bind(ve,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),pe=Math.pow(2,he.tileID.overscaledZ-ae.tileID.overscaledZ),Se=[ae.tileID.canonical.x*pe%1,ae.tileID.canonical.y*pe%1]):ae.texture.bind(ve,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST);const we=f.style.map.terrain&&f.style.map.terrain.getTerrainData(ue),Fe=we?ue:null,Qe=Fe?Fe.posMatrix:f.transform.calculatePosMatrix(ue.toUnwrapped(),te),ke=Rs(Qe,Se||[0,0],pe||1,de,b);k instanceof Tr?L.draw(I,M.TRIANGLES,X,Et.disabled,H,Tt.disabled,ke,we,b.id,k.boundsBuffer,f.quadTriangleIndexBuffer,k.boundsSegments):L.draw(I,M.TRIANGLES,X,q[ue.overscaledZ],H,Tt.disabled,ke,we,b.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments)}})(t,n,l,c);break;case"background":(function(f,v,b,A){const I=b.paint.get("background-color"),M=b.paint.get("background-opacity");if(M===0)return;const k=f.context,L=k.gl,H=f.transform,q=H.tileSize,W=b.paint.get("background-pattern");if(f.isPatternMissing(W))return;const N=!W&&I.a===1&&M===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==N)return;const te=Et.disabled,ue=f.depthModeForSublayer(0,N==="opaque"?pt.ReadWrite:pt.ReadOnly),X=f.colorModeForRenderPass(),ae=f.useProgram(W?"backgroundPattern":"background"),he=A||H.coveringTiles({tileSize:q,terrain:f.style.map.terrain});W&&(k.activeTexture.set(L.TEXTURE0),f.imageManager.bind(f.context));const de=b.getCrossfadeParameters();for(const pe of he){const Se=A?pe.posMatrix:f.transform.calculatePosMatrix(pe.toUnwrapped()),ve=W?Hl(Se,M,f,W,{tileID:pe,tileSize:q},de):Su(Se,M,I),we=f.style.map.terrain&&f.style.map.terrain.getTerrainData(pe);ae.draw(k,L.TRIANGLES,ue,te,X,Tt.disabled,ve,we,b.id,f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}})(t,0,l,c);break;case"custom":(function(f,v,b){const A=f.context,I=b.implementation;if(f.renderPass==="offscreen"){const M=I.prerender;M&&(f.setCustomLayerDefaults(),A.setColorMode(f.colorModeForRenderPass()),M.call(I,A.gl,f.transform.customLayerMatrix()),A.setDirty(),f.setBaseState())}else if(f.renderPass==="translucent"){f.setCustomLayerDefaults(),A.setColorMode(f.colorModeForRenderPass()),A.setStencilMode(Et.disabled);const M=I.renderingMode==="3d"?new pt(f.context.gl.LEQUAL,pt.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,pt.ReadOnly);A.setDepthMode(M),I.render(A.gl,f.transform.customLayerMatrix()),A.setDirty(),f.setBaseState(),A.bindFramebuffer.set(null)}})(t,0,l)}}translatePosMatrix(t,n,l,c,f){if(!l[0]&&!l[1])return t;const v=f?c==="map"?this.transform.angle:0:c==="viewport"?-this.transform.angle:0;if(v){const I=Math.sin(v),M=Math.cos(v);l=[l[0]*M-l[1]*I,l[0]*I+l[1]*M]}const b=[f?l[0]:Je(n,l[0],this.transform.zoom),f?l[1]:Je(n,l[1],this.transform.zoom),0],A=new Float32Array(16);return h.H(A,t,b),A}saveTileTexture(t){const n=this._tileTextures[t.size[0]];n?n.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const n=this._tileTextures[t];return n&&n.length>0?n.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const n=this.imageManager.getPattern(t.from.toString()),l=this.imageManager.getPattern(t.to.toString());return!n||!l}useProgram(t,n){this.cache=this.cache||{};const l=t+(n?n.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[l]||(this.cache[l]=new eo(this.context,Hn[t],n,Tu[t],this._showOverdrawInspector,this.style.map.terrain)),this.cache[l]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Ut(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:n}=this.context.gl;return this.width!==t||this.height!==n}}class An{constructor(t,n){this.points=t,this.planes=n}static fromInvProjectionMatrix(t,n,l){const c=Math.pow(2,l),f=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(b=>{const A=1/(b=h.af([],b,t))[3]/n*c;return h.a$(b,b,[A,A,1/b[3],A])}),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(b=>{const A=function(L,H){var q=H[0],W=H[1],N=H[2],te=q*q+W*W+N*N;return te>0&&(te=1/Math.sqrt(te)),L[0]=H[0]*te,L[1]=H[1]*te,L[2]=H[2]*te,L}([],function(L,H,q){var W=H[0],N=H[1],te=H[2],ue=q[0],X=q[1],ae=q[2];return L[0]=N*ae-te*X,L[1]=te*ue-W*ae,L[2]=W*X-N*ue,L}([],Gr([],f[b[0]],f[b[1]]),Gr([],f[b[2]],f[b[1]]))),I=-((M=A)[0]*(k=f[b[1]])[0]+M[1]*k[1]+M[2]*k[2]);var M,k;return A.concat(I)});return new An(f,v)}}class ns{constructor(t,n){this.min=t,this.max=n,this.center=function(l,c,f){return l[0]=.5*c[0],l[1]=.5*c[1],l[2]=.5*c[2],l}([],function(l,c,f){return l[0]=c[0]+f[0],l[1]=c[1]+f[1],l[2]=c[2]+f[2],l}([],this.min,this.max))}quadrant(t){const n=[t%2==0,t<2],l=fi(this.min),c=fi(this.max);for(let f=0;f<n.length;f++)l[f]=n[f]?this.min[f]:this.center[f],c[f]=n[f]?this.center[f]:this.max[f];return c[2]=this.max[2],new ns(l,c)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const n=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let l=!0;for(let c=0;c<t.planes.length;c++){const f=t.planes[c];let v=0;for(let b=0;b<n.length;b++)h.b0(f,n[b])>=0&&v++;if(v===0)return 0;v!==n.length&&(l=!1)}if(l)return 2;for(let c=0;c<3;c++){let f=Number.MAX_VALUE,v=-Number.MAX_VALUE;for(let b=0;b<t.points.length;b++){const A=t.points[b][c]-this.min[c];f=Math.min(f,A),v=Math.max(v,A)}if(v<0||f>this.max[c]-this.min[c])return 0}return 1}}class Fs{constructor(t=0,n=0,l=0,c=0){if(isNaN(t)||t<0||isNaN(n)||n<0||isNaN(l)||l<0||isNaN(c)||c<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=n,this.left=l,this.right=c}interpolate(t,n,l){return n.top!=null&&t.top!=null&&(this.top=h.z.number(t.top,n.top,l)),n.bottom!=null&&t.bottom!=null&&(this.bottom=h.z.number(t.bottom,n.bottom,l)),n.left!=null&&t.left!=null&&(this.left=h.z.number(t.left,n.left,l)),n.right!=null&&t.right!=null&&(this.right=h.z.number(t.right,n.right,l)),this}getCenter(t,n){const l=h.ac((this.left+t-this.right)/2,0,t),c=h.ac((this.top+n-this.bottom)/2,0,n);return new h.P(l,c)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Fs(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const _o=85.051129;class va{constructor(t,n,l,c,f){this.tileSize=512,this._renderWorldCopies=f===void 0||!!f,this._minZoom=t||0,this._maxZoom=n||22,this._minPitch=l??0,this._maxPitch=c??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new h.M(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Fs,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const t=new va(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.apply(this),t}apply(t){this.tileSize=t.tileSize,this.latRange=t.latRange,this.width=t.width,this.height=t.height,this._center=t._center,this._elevation=t._elevation,this.minElevationForCurrentTile=t.minElevationForCurrentTile,this.zoom=t.zoom,this.angle=t.angle,this._fov=t._fov,this._pitch=t._pitch,this._unmodified=t._unmodified,this._edgeInsets=t._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new h.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const n=-h.b1(t,-180,180)*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=function(){var l=new h.A(4);return h.A!=Float32Array&&(l[1]=0,l[2]=0),l[0]=1,l[3]=1,l}(),function(l,c,f){var v=c[0],b=c[1],A=c[2],I=c[3],M=Math.sin(f),k=Math.cos(f);l[0]=v*k+A*M,l[1]=b*k+I*M,l[2]=v*-M+A*k,l[3]=b*-M+I*k}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const n=h.ac(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const n=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==n&&(this._unmodified=!1,this._zoom=n,this.tileZoom=Math.max(0,Math.floor(n)),this.scale=this.zoomScale(n),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,n,l){this._unmodified=!1,this._edgeInsets.interpolate(t,n,l),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const n=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,n)}getVisibleUnwrappedCoordinates(t){const n=[new h.b2(0,t)];if(this._renderWorldCopies){const l=this.pointCoordinate(new h.P(0,0)),c=this.pointCoordinate(new h.P(this.width,0)),f=this.pointCoordinate(new h.P(this.width,this.height)),v=this.pointCoordinate(new h.P(0,this.height)),b=Math.floor(Math.min(l.x,c.x,f.x,v.x)),A=Math.floor(Math.max(l.x,c.x,f.x,v.x)),I=1;for(let M=b-I;M<=A+I;M++)M!==0&&n.push(new h.b2(M,t))}return n}coveringTiles(t){var n,l;let c=this.coveringZoomLevel(t);const f=c;if(t.minzoom!==void 0&&c<t.minzoom)return[];t.maxzoom!==void 0&&c>t.maxzoom&&(c=t.maxzoom);const v=this.pointCoordinate(this.getCameraPoint()),b=h.Y.fromLngLat(this.center),A=Math.pow(2,c),I=[A*v.x,A*v.y,0],M=[A*b.x,A*b.y,0],k=An.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c);let L=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(L=c);const H=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,q=X=>({aabb:new ns([X*A,0,0],[(X+1)*A,A,0]),zoom:0,x:0,y:0,wrap:X,fullyVisible:!1}),W=[],N=[],te=c,ue=t.reparseOverscaled?f:c;if(this._renderWorldCopies)for(let X=1;X<=3;X++)W.push(q(-X)),W.push(q(X));for(W.push(q(0));W.length>0;){const X=W.pop(),ae=X.x,he=X.y;let de=X.fullyVisible;if(!de){const Fe=X.aabb.intersects(k);if(Fe===0)continue;de=Fe===2}const pe=t.terrain?I:M,Se=X.aabb.distanceX(pe),ve=X.aabb.distanceY(pe),we=Math.max(Math.abs(Se),Math.abs(ve));if(X.zoom===te||we>H+(1<<te-X.zoom)-2&&X.zoom>=L){const Fe=te-X.zoom,Qe=I[0]-.5-(ae<<Fe),ke=I[1]-.5-(he<<Fe);N.push({tileID:new h.Q(X.zoom===te?ue:X.zoom,X.wrap,X.zoom,ae,he),distanceSq:ta([M[0]-.5-ae,M[1]-.5-he]),tileDistanceToCamera:Math.sqrt(Qe*Qe+ke*ke)})}else for(let Fe=0;Fe<4;Fe++){const Qe=(ae<<1)+Fe%2,ke=(he<<1)+(Fe>>1),We=X.zoom+1;let rt=X.aabb.quadrant(Fe);if(t.terrain){const ct=new h.Q(We,X.wrap,We,Qe,ke),Xe=t.terrain.getMinMaxElevation(ct),st=(n=Xe.minElevation)!==null&&n!==void 0?n:this.elevation,at=(l=Xe.maxElevation)!==null&&l!==void 0?l:this.elevation;rt=new ns([rt.min[0],rt.min[1],st],[rt.max[0],rt.max[1],at])}W.push({aabb:rt,zoom:We,x:Qe,y:ke,wrap:X.wrap,fullyVisible:de})}}return N.sort((X,ae)=>X.distanceSq-ae.distanceSq).map(X=>X.tileID)}resize(t,n){this.width=t,this.height=n,this.pixelsToGLUnits=[2/t,-2/n],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const n=h.ac(t.lat,-85.051129,_o);return new h.P(h.N(t.lng)*this.worldSize,h.O(n)*this.worldSize)}unproject(t){return new h.Y(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(t){const n=this.elevation,l=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,c=this.pointLocation(this.centerPoint,t),f=t.getElevationForLngLatZoom(c,this.tileZoom);if(!(this.elevation-f))return;const v=l+n-f,b=Math.cos(this._pitch)*this.cameraToCenterDistance/v/h.b3(1,c.lat),A=this.scaleZoom(b/this.tileSize);this._elevation=f,this._center=c,this.zoom=A}setLocationAtPoint(t,n){const l=this.pointCoordinate(n),c=this.pointCoordinate(this.centerPoint),f=this.locationCoordinate(t),v=new h.Y(f.x-(l.x-c.x),f.y-(l.y-c.y));this.center=this.coordinateLocation(v),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,n){return n?this.coordinatePoint(this.locationCoordinate(t),n.getElevationForLngLatZoom(t,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,n){return this.coordinateLocation(this.pointCoordinate(t,n))}locationCoordinate(t){return h.Y.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t,n){if(n){const L=n.pointCoordinate(t);if(L!=null)return L}const l=[t.x,t.y,0,1],c=[t.x,t.y,1,1];h.af(l,l,this.pixelMatrixInverse),h.af(c,c,this.pixelMatrixInverse);const f=l[3],v=c[3],b=l[1]/f,A=c[1]/v,I=l[2]/f,M=c[2]/v,k=I===M?0:(0-I)/(M-I);return new h.Y(h.z.number(l[0]/f,c[0]/v,k)/this.worldSize,h.z.number(b,A,k)/this.worldSize)}coordinatePoint(t,n=0,l=this.pixelMatrix){const c=[t.x*this.worldSize,t.y*this.worldSize,n,1];return h.af(c,c,l),new h.P(c[0]/c[3],c[1]/c[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return new Qt().extend(this.pointLocation(new h.P(0,t))).extend(this.pointLocation(new h.P(this.width,t))).extend(this.pointLocation(new h.P(this.width,this.height))).extend(this.pointLocation(new h.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Qt([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,_o])}calculatePosMatrix(t,n=!1){const l=t.key,c=n?this._alignedPosMatrixCache:this._posMatrixCache;if(c[l])return c[l];const f=t.canonical,v=this.worldSize/this.zoomScale(f.z),b=f.x+Math.pow(2,f.z)*t.wrap,A=h.an(new Float64Array(16));return h.H(A,A,[b*v,f.y*v,0]),h.J(A,A,[v/h.W,v/h.W,1]),h.K(A,n?this.alignedProjMatrix:this.projMatrix,A),c[l]=new Float32Array(A),c[l]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(t,n){n=h.ac(+n,this.minZoom,this.maxZoom);const l={center:new h.M(t.lng,t.lat),zoom:n};let c=this.lngRange;if(!this._renderWorldCopies&&c===null){const X=179.9999999999;c=[-X,X]}const f=this.tileSize*this.zoomScale(l.zoom);let v=0,b=f,A=0,I=f,M=0,k=0;const{x:L,y:H}=this.size;if(this.latRange){const X=this.latRange;v=h.O(X[1])*f,b=h.O(X[0])*f,b-v<H&&(M=H/(b-v))}c&&(A=h.b1(h.N(c[0])*f,0,f),I=h.b1(h.N(c[1])*f,0,f),I<A&&(I+=f),I-A<L&&(k=L/(I-A)));const{x:q,y:W}=this.project.call({worldSize:f},t);let N,te;const ue=Math.max(k||0,M||0);if(ue){const X=new h.P(k?(I+A)/2:q,M?(b+v)/2:W);return l.center=this.unproject.call({worldSize:f},X).wrap(),l.zoom+=this.scaleZoom(ue),l}if(this.latRange){const X=H/2;W-X<v&&(te=v+X),W+X>b&&(te=b-X)}if(c){const X=(A+I)/2;let ae=q;this._renderWorldCopies&&(ae=h.b1(q,X-f/2,X+f/2));const he=L/2;ae-he<A&&(N=A+he),ae+he>I&&(N=I-he)}if(N!==void 0||te!==void 0){const X=new h.P(N??q,te??W);l.center=this.unproject.call({worldSize:f},X).wrap()}return l}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:n,zoom:l}=this.getConstrained(this.center,this.zoom);this.center=n,this.zoom=l,this._unmodified=t,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,n=this.point.x,l=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=h.b3(1,this.center.lat)*this.worldSize;let c=h.an(new Float64Array(16));h.J(c,c,[this.width/2,-this.height/2,1]),h.H(c,c,[1,-1,0]),this.labelPlaneMatrix=c,c=h.an(new Float64Array(16)),h.J(c,c,[1,-1,1]),h.H(c,c,[-1,-1,0]),h.J(c,c,[2/this.width,2/this.height,1]),this.glCoordMatrix=c;const f=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),v=Math.min(this.elevation,this.minElevationForCurrentTile),b=f-v*this._pixelPerMeter/Math.cos(this._pitch),A=v<0?b:f,I=Math.PI/2+this._pitch,M=this._fov*(.5+t.y/this.height),k=Math.sin(M)*A/Math.sin(h.ac(Math.PI-I-M,.01,Math.PI-.01)),L=this.getHorizon(),H=2*Math.atan(L/this.cameraToCenterDistance)*(.5+t.y/(2*L)),q=Math.sin(H)*A/Math.sin(h.ac(Math.PI-I-H,.01,Math.PI-.01)),W=Math.min(k,q),N=1.01*(Math.cos(Math.PI/2-this._pitch)*W+A),te=this.height/50;c=new Float64Array(16),h.b4(c,this._fov,this.width/this.height,te,N),c[8]=2*-t.x/this.width,c[9]=2*t.y/this.height,h.J(c,c,[1,-1,1]),h.H(c,c,[0,0,-this.cameraToCenterDistance]),h.b5(c,c,this._pitch),h.ad(c,c,this.angle),h.H(c,c,[-n,-l,0]),this.mercatorMatrix=h.J([],c,[this.worldSize,this.worldSize,this.worldSize]),h.J(c,c,[1,1,this._pixelPerMeter]),this.pixelMatrix=h.K(new Float64Array(16),this.labelPlaneMatrix,c),h.H(c,c,[0,0,-this.elevation]),this.projMatrix=c,this.invProjMatrix=h.ar([],c),this.pixelMatrix3D=h.K(new Float64Array(16),this.labelPlaneMatrix,c);const ue=this.width%2/2,X=this.height%2/2,ae=Math.cos(this.angle),he=Math.sin(this.angle),de=n-Math.round(n)+ae*ue+he*X,pe=l-Math.round(l)+ae*X+he*ue,Se=new Float64Array(c);if(h.H(Se,Se,[de>.5?de-1:de,pe>.5?pe-1:pe,0]),this.alignedProjMatrix=Se,c=h.ar(new Float64Array(16),this.pixelMatrix),!c)throw new Error("failed to invert matrix");this.pixelMatrixInverse=c,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new h.P(0,0)),n=[t.x*this.worldSize,t.y*this.worldSize,0,1];return h.af(n,n,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new h.P(0,t))}getCameraQueryGeometry(t){const n=this.getCameraPoint();if(t.length===1)return[t[0],n];{let l=n.x,c=n.y,f=n.x,v=n.y;for(const b of t)l=Math.min(l,b.x),c=Math.min(c,b.y),f=Math.max(f,b.x),v=Math.max(v,b.y);return[new h.P(l,c),new h.P(f,c),new h.P(f,v),new h.P(l,v),new h.P(l,c)]}}lngLatToCameraDepth(t,n){const l=this.locationCoordinate(t),c=[l.x*this.worldSize,l.y*this.worldSize,n,1];return h.af(c,c,this.projMatrix),c[2]/c[3]}}function xo(p,t){let n,l=!1,c=null,f=null;const v=()=>{c=null,l&&(p.apply(f,n),c=setTimeout(v,t),l=!1)};return(...b)=>(l=!0,f=this,n=b,c||v(),c)}class vo{constructor(t){this._getCurrentHash=()=>{const n=window.location.hash.replace("#","");if(this._hashName){let l;return n.split("&").map(c=>c.split("=")).forEach(c=>{c[0]===this._hashName&&(l=c)}),(l&&l[1]||"").split("/")}return n.split("/")},this._onHashChange=()=>{const n=this._getCurrentHash();if(n.length>=3&&!n.some(l=>isNaN(l))){const l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(n[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:l,pitch:+(n[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const n=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,n)}catch{}},this._updateHash=xo(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const n=this._map.getCenter(),l=Math.round(100*this._map.getZoom())/100,c=Math.ceil((l*Math.LN2+Math.log(512/360/.5))/Math.LN10),f=Math.pow(10,c),v=Math.round(n.lng*f)/f,b=Math.round(n.lat*f)/f,A=this._map.getBearing(),I=this._map.getPitch();let M="";if(M+=t?`/${v}/${b}/${l}`:`${l}/${b}/${v}`,(A||I)&&(M+="/"+Math.round(10*A)/10),I&&(M+=`/${Math.round(I)}`),this._hashName){const k=this._hashName;let L=!1;const H=window.location.hash.slice(1).split("&").map(q=>{const W=q.split("=")[0];return W===k?(L=!0,`${W}=${M}`):q}).filter(q=>q);return L||H.push(`${k}=${M}`),`#${H.join("&")}`}return`#${M}`}}const Ir={linearity:.3,easing:h.b6(0,0,.3,1)},oc=h.e({deceleration:2500,maxSpeed:1400},Ir),lc=h.e({deceleration:20,maxSpeed:1400},Ir),cc=h.e({deceleration:1e3,maxSpeed:360},Ir),uc=h.e({deceleration:1e3,maxSpeed:90},Ir);class hc{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:Q.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,n=Q.now();for(;t.length>0&&n-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const n={zoom:0,bearing:0,pitch:0,pan:new h.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:f}of this._inertiaBuffer)n.zoom+=f.zoomDelta||0,n.bearing+=f.bearingDelta||0,n.pitch+=f.pitchDelta||0,f.panDelta&&n.pan._add(f.panDelta),f.around&&(n.around=f.around),f.pinchAround&&(n.pinchAround=f.pinchAround);const l=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,c={};if(n.pan.mag()){const f=$s(n.pan.mag(),l,h.e({},oc,t||{}));c.offset=n.pan.mult(f.amount/n.pan.mag()),c.center=this._map.transform.center,Os(c,f)}if(n.zoom){const f=$s(n.zoom,l,lc);c.zoom=this._map.transform.zoom+f.amount,Os(c,f)}if(n.bearing){const f=$s(n.bearing,l,cc);c.bearing=this._map.transform.bearing+h.ac(f.amount,-179,179),Os(c,f)}if(n.pitch){const f=$s(n.pitch,l,uc);c.pitch=this._map.transform.pitch+f.amount,Os(c,f)}if(c.zoom||c.bearing){const f=n.pinchAround===void 0?n.around:n.pinchAround;c.around=f?this._map.unproject(f):this._map.getCenter()}return this.clear(),h.e(c,{noMoveStart:!0})}}function Os(p,t){(!p.duration||p.duration<t.duration)&&(p.duration=t.duration,p.easing=t.easing)}function $s(p,t,n){const{maxSpeed:l,linearity:c,deceleration:f}=n,v=h.ac(p*c/(t/1e3),-l,l),b=Math.abs(v)/(f*c);return{easing:n.easing,duration:1e3*b,amount:v*(b/2)}}class li extends h.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,l,c={}){const f=U.mousePos(n.getCanvas(),l),v=n.unproject(f);super(t,h.e({point:f,lngLat:v,originalEvent:l},c)),this._defaultPrevented=!1,this.target=n}}class ss extends h.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,l){const c=t==="touchend"?l.changedTouches:l.touches,f=U.touchPos(n.getCanvasContainer(),c),v=f.map(A=>n.unproject(A)),b=f.reduce((A,I,M,k)=>A.add(I.div(k.length)),new h.P(0,0));super(t,{points:f,point:b,lngLats:v,lngLat:n.unproject(b),originalEvent:l}),this._defaultPrevented=!1}}class ar extends h.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,l){super(t,{originalEvent:l}),this._defaultPrevented=!1}}class Cr{constructor(t,n){this._map=t,this._clickTolerance=n.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new ar(t.type,this._map,t))}mousedown(t,n){return this._mousedownPos=n,this._firePreventable(new li(t.type,this._map,t))}mouseup(t){this._map.fire(new li(t.type,this._map,t))}click(t,n){this._mousedownPos&&this._mousedownPos.dist(n)>=this._clickTolerance||this._map.fire(new li(t.type,this._map,t))}dblclick(t){return this._firePreventable(new li(t.type,this._map,t))}mouseover(t){this._map.fire(new li(t.type,this._map,t))}mouseout(t){this._map.fire(new li(t.type,this._map,t))}touchstart(t){return this._firePreventable(new ss(t.type,this._map,t))}touchmove(t){this._map.fire(new ss(t.type,this._map,t))}touchend(t){this._map.fire(new ss(t.type,this._map,t))}touchcancel(t){this._map.fire(new ss(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class dc{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new li(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new li("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new li(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class zi{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.pointLocation(h.P.convert(t),this._map.terrain)}}class as{constructor(t,n){this._map=t,this._tr=new zi(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=n.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,n){this.isEnabled()&&t.shiftKey&&t.button===0&&(U.disableDrag(),this._startPos=this._lastPos=n,this._active=!0)}mousemoveWindow(t,n){if(!this._active)return;const l=n;if(this._lastPos.equals(l)||!this._box&&l.dist(this._startPos)<this._clickTolerance)return;const c=this._startPos;this._lastPos=l,this._box||(this._box=U.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const f=Math.min(c.x,l.x),v=Math.max(c.x,l.x),b=Math.min(c.y,l.y),A=Math.max(c.y,l.y);U.setTransform(this._box,`translate(${f}px,${b}px)`),this._box.style.width=v-f+"px",this._box.style.height=A-b+"px"}mouseupWindow(t,n){if(!this._active||t.button!==0)return;const l=this._startPos,c=n;if(this.reset(),U.suppressClick(),l.x!==c.x||l.y!==c.y)return this._map.fire(new h.k("boxzoomend",{originalEvent:t})),{cameraAnimation:f=>f.fitScreenCoordinates(l,c,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(U.remove(this._box),this._box=null),U.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,n){return this._map.fire(new h.k(t,{originalEvent:n}))}}function bo(p,t){if(p.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${p.length}, points ${t.length}`);const n={};for(let l=0;l<p.length;l++)n[p[l].identifier]=t[l];return n}class zu{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,n,l){(this.centroid||l.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),l.length===this.numTouches&&(this.centroid=function(c){const f=new h.P(0,0);for(const v of c)f._add(v);return f.div(c.length)}(n),this.touches=bo(l,n)))}touchmove(t,n,l){if(this.aborted||!this.centroid)return;const c=bo(l,n);for(const f in this.touches){const v=c[f];(!v||v.dist(this.touches[f])>30)&&(this.aborted=!0)}}touchend(t,n,l){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),l.length===0){const c=!this.aborted&&this.centroid;if(this.reset(),c)return c}}}class wo{constructor(t){this.singleTap=new zu(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,n,l){this.singleTap.touchstart(t,n,l)}touchmove(t,n,l){this.singleTap.touchmove(t,n,l)}touchend(t,n,l){const c=this.singleTap.touchend(t,n,l);if(c){const f=t.timeStamp-this.lastTime<500,v=!this.lastTap||this.lastTap.dist(c)<30;if(f&&v||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=c,this.count===this.numTaps)return this.reset(),c}}}class pc{constructor(t){this._tr=new zi(t),this._zoomIn=new wo({numTouches:1,numTaps:2}),this._zoomOut=new wo({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,n,l){this._zoomIn.touchstart(t,n,l),this._zoomOut.touchstart(t,n,l)}touchmove(t,n,l){this._zoomIn.touchmove(t,n,l),this._zoomOut.touchmove(t,n,l)}touchend(t,n,l){const c=this._zoomIn.touchend(t,n,l),f=this._zoomOut.touchend(t,n,l),v=this._tr;return c?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:v.zoom+1,around:v.unproject(c)},{originalEvent:t})}):f?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:v.zoom-1,around:v.unproject(f)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Fr{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const n=this._moveFunction(...t);if(n.bearingDelta||n.pitchDelta||n.around||n.panDelta)return this._active=!0,n}dragStart(t,n){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=n.length?n[0]:n,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,n){if(!this.isEnabled())return;const l=this._lastPoint;if(!l)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const c=n.length?n[0]:n;return!this._moved&&c.dist(l)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=c,this._move(l,c))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&U.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const en={0:1,2:2};class Oe{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const n=U.mouseButton(t);this._eventButton=n}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!function(n,l){const c=en[l];return n.buttons===void 0||(n.buttons&c)!==c}(t,this._eventButton)}isValidEndEvent(t){return U.mouseButton(t)===this._eventButton}}class So{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}const En=p=>{p.mousedown=p.dragStart,p.mousemoveWindow=p.dragMove,p.mouseup=p.dragEnd,p.contextmenu=function(t){t.preventDefault()}},os=({enable:p,clickTolerance:t,bearingDegreesPerPixelMoved:n=.8})=>{const l=new Oe({checkCorrectEvent:c=>U.mouseButton(c)===0&&c.ctrlKey||U.mouseButton(c)===2});return new Fr({clickTolerance:t,move:(c,f)=>({bearingDelta:(f.x-c.x)*n}),moveStateManager:l,enable:p,assignEvents:En})},To=({enable:p,clickTolerance:t,pitchDegreesPerPixelMoved:n=-.5})=>{const l=new Oe({checkCorrectEvent:c=>U.mouseButton(c)===0&&c.ctrlKey||U.mouseButton(c)===2});return new Fr({clickTolerance:t,move:(c,f)=>({pitchDelta:(f.y-c.y)*n}),moveStateManager:l,enable:p,assignEvents:En})};class Le{constructor(t,n){this._clickTolerance=t.clickTolerance||1,this._map=n,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new h.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(t,n,l){return this._calculateTransform(t,n,l)}touchmove(t,n,l){if(this._active&&!(l.length<this.minTouchs()))return t.preventDefault(),this._calculateTransform(t,n,l)}touchend(t,n,l){this._calculateTransform(t,n,l),this._active&&l.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,n,l){l.length>0&&(this._active=!0);const c=bo(l,n),f=new h.P(0,0),v=new h.P(0,0);let b=0;for(const I in c){const M=c[I],k=this._touches[I];k&&(f._add(M),v._add(M.sub(k)),b++,c[I]=M)}if(this._touches=c,b<this.minTouchs()||!v.mag())return;const A=v.div(b);return this._sum._add(A),this._sum.mag()<this._clickTolerance?void 0:{around:f.div(b),panDelta:A}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ns{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,n,l){this._firstTwoTouches||l.length<2||(this._firstTwoTouches=[l[0].identifier,l[1].identifier],this._start([n[0],n[1]]))}touchmove(t,n,l){if(!this._firstTwoTouches)return;t.preventDefault();const[c,f]=this._firstTwoTouches,v=ba(l,n,c),b=ba(l,n,f);if(!v||!b)return;const A=this._aroundCenter?null:v.add(b).div(2);return this._move([v,b],A,t)}touchend(t,n,l){if(!this._firstTwoTouches)return;const[c,f]=this._firstTwoTouches,v=ba(l,n,c),b=ba(l,n,f);v&&b||(this._active&&U.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function ba(p,t,n){for(let l=0;l<p.length;l++)if(p[l].identifier===n)return t[l]}function fc(p,t){return Math.log(p/t)/Math.LN2}class wa extends Ns{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,n){const l=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(fc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:fc(this._distance,l),pinchAround:n}}}function Ao(p,t){return 180*p.angleWith(t)/Math.PI}class Eo extends Ns{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,n,l){const c=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Ao(this._vector,c),pinchAround:n}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const n=25/(Math.PI*this._minDiameter)*360,l=Ao(t,this._startVector);return Math.abs(l)<n}}function Io(p){return Math.abs(p.y)>Math.abs(p.x)}class mc extends Ns{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,n,l){super.touchstart(t,n,l),this._currentTouchCount=l.length}_start(t){this._lastPoints=t,Io(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,n,l){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const c=t[0].sub(this._lastPoints[0]),f=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(c,f,l.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(c.y+f.y)/2*-.5}):void 0}gestureBeginsVertically(t,n,l){if(this._valid!==void 0)return this._valid;const c=t.mag()>=2,f=n.mag()>=2;if(!c&&!f)return;if(!c||!f)return this._firstMove===void 0&&(this._firstMove=l),l-this._firstMove<100&&void 0;const v=t.y>0==n.y>0;return Io(t)&&Io(n)&&v}}const In={panStep:100,bearingStep:15,pitchStep:10};class Pt{constructor(t){this._tr=new zi(t);const n=In;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let n=0,l=0,c=0,f=0,v=0;switch(t.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:t.shiftKey?l=-1:(t.preventDefault(),f=-1);break;case 39:t.shiftKey?l=1:(t.preventDefault(),f=1);break;case 38:t.shiftKey?c=1:(t.preventDefault(),v=-1);break;case 40:t.shiftKey?c=-1:(t.preventDefault(),v=1);break;default:return}return this._rotationDisabled&&(l=0,c=0),{cameraAnimation:b=>{const A=this._tr;b.easeTo({duration:300,easeId:"keyboardHandler",easing:Sa,zoom:n?Math.round(A.zoom)+n*(t.shiftKey?2:1):A.zoom,bearing:A.bearing+l*this._bearingStep,pitch:A.pitch+c*this._pitchStep,offset:[-f*this._panStep,-v*this._panStep],center:A.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Sa(p){return p*(2-p)}const Ta=4.000244140625;class Co{constructor(t,n){this._onTimeout=l=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},this._map=t,this._tr=new zi(t),this._triggerRenderFrame=n,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!t[this._map.cooperativeGestures._bypassKey])return;let n=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const l=Q.now(),c=l-(this._lastWheelEventTime||0);this._lastWheelEventTime=l,n!==0&&n%Ta==0?this._type="wheel":n!==0&&Math.abs(n)<4?this._type="trackpad":c>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(c*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),t.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=t,this._delta-=n,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const n=U.mousePos(this._map.getCanvas(),t),l=this._tr;this._around=n.y>l.transform.height/2-l.transform.getHorizon()?h.M.convert(this._aroundCenter?l.center:l.unproject(n)):h.M.convert(l.center),this._aroundPoint=l.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(this._delta!==0){const b=this._type==="wheel"&&Math.abs(this._delta)>Ta?this._wheelZoomRate:this._defaultZoomRate;let A=2/(1+Math.exp(-Math.abs(this._delta*b)));this._delta<0&&A!==0&&(A=1/A);const I=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(I*A))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const n=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,l=this._startZoom,c=this._easing;let f,v=!1;if(this._type==="wheel"&&l&&c){const b=Math.min((Q.now()-this._lastWheelEventTime)/200,1),A=c(b);f=h.z.number(l,n,A),b<1?this._frameId||(this._frameId=!0):v=!0}else f=n,v=!0;return this._active=!0,v&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!v,zoomDelta:f-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let n=h.b7;if(this._prevEase){const l=this._prevEase,c=(Q.now()-l.start)/l.duration,f=l.easing(c+.01)-l.easing(c),v=.27/Math.sqrt(f*f+1e-4)*.01,b=Math.sqrt(.0729-v*v);n=h.b6(v,b,.25,1)}return this._prevEase={start:Q.now(),duration:t,easing:n},n}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Po{constructor(t,n){this._clickZoom=t,this._tapZoom=n}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class gc{constructor(t){this._tr=new zi(t),this.reset()}reset(){this._active=!1}dblclick(t,n){return t.preventDefault(),{cameraAnimation:l=>{l.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(n)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Bu{constructor(){this._tap=new wo({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,n,l){if(!this._swipePoint)if(this._tapTime){const c=n[0],f=t.timeStamp-this._tapTime<500,v=this._tapPoint.dist(c)<30;f&&v?l.length>0&&(this._swipePoint=c,this._swipeTouch=l[0].identifier):this.reset()}else this._tap.touchstart(t,n,l)}touchmove(t,n,l){if(this._tapTime){if(this._swipePoint){if(l[0].identifier!==this._swipeTouch)return;const c=n[0],f=c.y-this._swipePoint.y;return this._swipePoint=c,t.preventDefault(),this._active=!0,{zoomDelta:f/128}}}else this._tap.touchmove(t,n,l)}touchend(t,n,l){if(this._tapTime)this._swipePoint&&l.length===0&&this.reset();else{const c=this._tap.touchend(t,n,l);c&&(this._tapTime=t.timeStamp,this._tapPoint=c)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class dr{constructor(t,n,l){this._el=t,this._mousePan=n,this._touchPan=l}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Us{constructor(t,n,l){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=n,this._mousePitch=l}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class je{constructor(t,n,l,c){this._el=t,this._touchZoom=n,this._touchRotate=l,this._tapDragZoom=c,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class He{constructor(t,n){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=t,this._options=n,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=U.create("div","maplibregl-cooperative-gesture-screen",t);let n=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(n=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const l=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),c=document.createElement("div");c.className="maplibregl-desktop-message",c.textContent=n,this._container.appendChild(c);const f=document.createElement("div");f.className="maplibregl-mobile-message",f.textContent=l,this._container.appendChild(f),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(U.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(t){this._onCooperativeGesture(t.touches.length===1)}wheel(t){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!t[this._bypassKey])}_onCooperativeGesture(t){this._enabled&&t&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Cn=p=>p.zoom||p.drag||p.pitch||p.rotate;class Mo extends h.k{}function Vs(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class Bi{constructor(t,n){this.handleWindowEvent=c=>{this.handleEvent(c,`${c.type}Window`)},this.handleEvent=(c,f)=>{if(c.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const v=c.type==="renderFrame"?void 0:c,b={needsRenderFrame:!1},A={},I={},M=c.touches,k=M?this._getMapTouches(M):void 0,L=k?U.touchPos(this._map.getCanvas(),k):U.mousePos(this._map.getCanvas(),c);for(const{handlerName:W,handler:N,allowed:te}of this._handlers){if(!N.isEnabled())continue;let ue;this._blockedByActive(I,te,W)?N.reset():N[f||c.type]&&(ue=N[f||c.type](c,L,k),this.mergeHandlerResult(b,A,ue,W,v),ue&&ue.needsRenderFrame&&this._triggerRenderFrame()),(ue||N.isActive())&&(I[W]=N)}const H={};for(const W in this._previousActiveHandlers)I[W]||(H[W]=v);this._previousActiveHandlers=I,(Object.keys(H).length||Vs(b))&&(this._changes.push([b,A,H]),this._triggerRenderFrame()),(Object.keys(I).length||Vs(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:q}=b;q&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],q(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new hc(t),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(n);const l=this._el;this._listeners=[[l,"touchstart",{passive:!0}],[l,"touchmove",{passive:!1}],[l,"touchend",void 0],[l,"touchcancel",void 0],[l,"mousedown",void 0],[l,"mousemove",void 0],[l,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[l,"mouseover",void 0],[l,"mouseout",void 0],[l,"dblclick",void 0],[l,"click",void 0],[l,"keydown",{capture:!1}],[l,"keyup",void 0],[l,"wheel",{passive:!1}],[l,"contextmenu",void 0],[window,"blur",void 0]];for(const[c,f,v]of this._listeners)U.addEventListener(c,f,c===document?this.handleWindowEvent:this.handleEvent,v)}destroy(){for(const[t,n,l]of this._listeners)U.removeEventListener(t,n,t===document?this.handleWindowEvent:this.handleEvent,l)}_addDefaultHandlers(t){const n=this._map,l=n.getCanvasContainer();this._add("mapEvent",new Cr(n,t));const c=n.boxZoom=new as(n,t);this._add("boxZoom",c),t.interactive&&t.boxZoom&&c.enable();const f=n.cooperativeGestures=new He(n,t.cooperativeGestures);this._add("cooperativeGestures",f),t.cooperativeGestures&&f.enable();const v=new pc(n),b=new gc(n);n.doubleClickZoom=new Po(b,v),this._add("tapZoom",v),this._add("clickZoom",b),t.interactive&&t.doubleClickZoom&&n.doubleClickZoom.enable();const A=new Bu;this._add("tapDragZoom",A);const I=n.touchPitch=new mc(n);this._add("touchPitch",I),t.interactive&&t.touchPitch&&n.touchPitch.enable(t.touchPitch);const M=os(t),k=To(t);n.dragRotate=new Us(t,M,k),this._add("mouseRotate",M,["mousePitch"]),this._add("mousePitch",k,["mouseRotate"]),t.interactive&&t.dragRotate&&n.dragRotate.enable();const L=(({enable:ue,clickTolerance:X})=>{const ae=new Oe({checkCorrectEvent:he=>U.mouseButton(he)===0&&!he.ctrlKey});return new Fr({clickTolerance:X,move:(he,de)=>({around:de,panDelta:de.sub(he)}),activateOnStart:!0,moveStateManager:ae,enable:ue,assignEvents:En})})(t),H=new Le(t,n);n.dragPan=new dr(l,L,H),this._add("mousePan",L),this._add("touchPan",H,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&n.dragPan.enable(t.dragPan);const q=new Eo,W=new wa;n.touchZoomRotate=new je(l,W,q,A),this._add("touchRotate",q,["touchPan","touchZoom"]),this._add("touchZoom",W,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&n.touchZoomRotate.enable(t.touchZoomRotate);const N=n.scrollZoom=new Co(n,()=>this._triggerRenderFrame());this._add("scrollZoom",N,["mousePan"]),t.interactive&&t.scrollZoom&&n.scrollZoom.enable(t.scrollZoom);const te=n.keyboard=new Pt(n);this._add("keyboard",te),t.interactive&&t.keyboard&&n.keyboard.enable(),this._add("blockableMapEvent",new dc(n))}_add(t,n,l){this._handlers.push({handlerName:t,handler:n,allowed:l}),this._handlersById[t]=n}stop(t){if(!this._updatingCamera){for(const{handler:n}of this._handlers)n.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Cn(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,n,l){for(const c in t)if(c!==l&&(!n||n.indexOf(c)<0))return!0;return!1}_getMapTouches(t){const n=[];for(const l of t)this._el.contains(l.target)&&n.push(l);return n}mergeHandlerResult(t,n,l,c,f){if(!l)return;h.e(t,l);const v={handlerName:c,originalEvent:l.originalEvent||f};l.zoomDelta!==void 0&&(n.zoom=v),l.panDelta!==void 0&&(n.drag=v),l.pitchDelta!==void 0&&(n.pitch=v),l.bearingDelta!==void 0&&(n.rotate=v)}_applyChanges(){const t={},n={},l={};for(const[c,f,v]of this._changes)c.panDelta&&(t.panDelta=(t.panDelta||new h.P(0,0))._add(c.panDelta)),c.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+c.zoomDelta),c.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+c.bearingDelta),c.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+c.pitchDelta),c.around!==void 0&&(t.around=c.around),c.pinchAround!==void 0&&(t.pinchAround=c.pinchAround),c.noInertia&&(t.noInertia=c.noInertia),h.e(n,f),h.e(l,v);this._updateMapTransform(t,n,l),this._changes=[]}_updateMapTransform(t,n,l){const c=this._map,f=c._getTransformForUpdate(),v=c.terrain;if(!(Vs(t)||v&&this._terrainMovement))return this._fireEvents(n,l,!0);let{panDelta:b,zoomDelta:A,bearingDelta:I,pitchDelta:M,around:k,pinchAround:L}=t;L!==void 0&&(k=L),c._stop(!0),k=k||c.transform.centerPoint;const H=f.pointLocation(b?k.sub(b):k);I&&(f.bearing+=I),M&&(f.pitch+=M),A&&(f.zoom+=A),v?this._terrainMovement||!n.drag&&!n.zoom?n.drag&&this._terrainMovement?f.center=f.pointLocation(f.centerPoint.sub(b)):f.setLocationAtPoint(H,k):(this._terrainMovement=!0,this._map._elevationFreeze=!0,f.setLocationAtPoint(H,k),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,f.recalculateZoom(c.terrain)})):f.setLocationAtPoint(H,k),c._applyUpdatedTransform(f),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(n,l,!0)}_fireEvents(t,n,l){const c=Cn(this._eventsInProgress),f=Cn(t),v={};for(const M in t){const{originalEvent:k}=t[M];this._eventsInProgress[M]||(v[`${M}start`]=k),this._eventsInProgress[M]=t[M]}!c&&f&&this._fireEvent("movestart",f.originalEvent);for(const M in v)this._fireEvent(M,v[M]);f&&this._fireEvent("move",f.originalEvent);for(const M in t){const{originalEvent:k}=t[M];this._fireEvent(M,k)}const b={};let A;for(const M in this._eventsInProgress){const{handlerName:k,originalEvent:L}=this._eventsInProgress[M];this._handlersById[k].isActive()||(delete this._eventsInProgress[M],A=n[k]||L,b[`${M}end`]=A)}for(const M in b)this._fireEvent(M,b[M]);const I=Cn(this._eventsInProgress);if(l&&(c||f)&&!I){this._updatingCamera=!0;const M=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),k=L=>L!==0&&-this._bearingSnap<L&&L<this._bearingSnap;!M||!M.essential&&Q.prefersReducedMotion?(this._map.fire(new h.k("moveend",{originalEvent:A})),k(this._map.getBearing())&&this._map.resetNorth()):(k(M.bearing||this._map.getBearing())&&(M.bearing=0),M.freezeElevation=!0,this._map.easeTo(M,{originalEvent:A})),this._updatingCamera=!1}}_fireEvent(t,n){this._map.fire(new h.k(t,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new Mo("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class yc extends h.E{constructor(t,n){super(),this._renderFrameCallback=()=>{const l=Math.min((Q.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(l)),l<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=n.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new h.M(this.transform.center.lng,this.transform.center.lat)}setCenter(t,n){return this.jumpTo({center:t},n)}panBy(t,n,l){return t=h.P.convert(t).mult(-1),this.panTo(this.transform.center,h.e({offset:t},n),l)}panTo(t,n,l){return this.easeTo(h.e({center:t},n),l)}getZoom(){return this.transform.zoom}setZoom(t,n){return this.jumpTo({zoom:t},n),this}zoomTo(t,n,l){return this.easeTo(h.e({zoom:t},n),l)}zoomIn(t,n){return this.zoomTo(this.getZoom()+1,t,n),this}zoomOut(t,n){return this.zoomTo(this.getZoom()-1,t,n),this}getBearing(){return this.transform.bearing}setBearing(t,n){return this.jumpTo({bearing:t},n),this}getPadding(){return this.transform.padding}setPadding(t,n){return this.jumpTo({padding:t},n),this}rotateTo(t,n,l){return this.easeTo(h.e({bearing:t},n),l)}resetNorth(t,n){return this.rotateTo(0,h.e({duration:1e3},t),n),this}resetNorthPitch(t,n){return this.easeTo(h.e({bearing:0,pitch:0,duration:1e3},t),n),this}snapToNorth(t,n){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,n):this}getPitch(){return this.transform.pitch}setPitch(t,n){return this.jumpTo({pitch:t},n),this}cameraForBounds(t,n){t=Qt.convert(t);const l=n&&n.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),l,n)}_cameraForBoxAndBearing(t,n,l,c){const f={top:0,bottom:0,right:0,left:0};if(typeof(c=h.e({padding:f,offset:[0,0],maxZoom:this.transform.maxZoom},c)).padding=="number"){const Fe=c.padding;c.padding={top:Fe,bottom:Fe,right:Fe,left:Fe}}c.padding=h.e(f,c.padding);const v=this.transform,b=v.padding,A=new Qt(t,n),I=v.project(A.getNorthWest()),M=v.project(A.getNorthEast()),k=v.project(A.getSouthEast()),L=v.project(A.getSouthWest()),H=h.b8(-l),q=I.rotate(H),W=M.rotate(H),N=k.rotate(H),te=L.rotate(H),ue=new h.P(Math.max(q.x,W.x,te.x,N.x),Math.max(q.y,W.y,te.y,N.y)),X=new h.P(Math.min(q.x,W.x,te.x,N.x),Math.min(q.y,W.y,te.y,N.y)),ae=ue.sub(X),he=(v.width-(b.left+b.right+c.padding.left+c.padding.right))/ae.x,de=(v.height-(b.top+b.bottom+c.padding.top+c.padding.bottom))/ae.y;if(de<0||he<0)return void h.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const pe=Math.min(v.scaleZoom(v.scale*Math.min(he,de)),c.maxZoom),Se=h.P.convert(c.offset),ve=new h.P((c.padding.left-c.padding.right)/2,(c.padding.top-c.padding.bottom)/2).rotate(h.b8(l)),we=Se.add(ve).mult(v.scale/v.zoomScale(pe));return{center:v.unproject(I.add(k).div(2).sub(we)),zoom:pe,bearing:l}}fitBounds(t,n,l){return this._fitInternal(this.cameraForBounds(t,n),n,l)}fitScreenCoordinates(t,n,l,c,f){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(h.P.convert(t)),this.transform.pointLocation(h.P.convert(n)),l,c),c,f)}_fitInternal(t,n,l){return t?(delete(n=h.e(t,n)).padding,n.linear?this.easeTo(n,l):this.flyTo(n,l)):this}jumpTo(t,n){this.stop();const l=this._getTransformForUpdate();let c=!1,f=!1,v=!1;return"zoom"in t&&l.zoom!==+t.zoom&&(c=!0,l.zoom=+t.zoom),t.center!==void 0&&(l.center=h.M.convert(t.center)),"bearing"in t&&l.bearing!==+t.bearing&&(f=!0,l.bearing=+t.bearing),"pitch"in t&&l.pitch!==+t.pitch&&(v=!0,l.pitch=+t.pitch),t.padding==null||l.isPaddingEqual(t.padding)||(l.padding=t.padding),this._applyUpdatedTransform(l),this.fire(new h.k("movestart",n)).fire(new h.k("move",n)),c&&this.fire(new h.k("zoomstart",n)).fire(new h.k("zoom",n)).fire(new h.k("zoomend",n)),f&&this.fire(new h.k("rotatestart",n)).fire(new h.k("rotate",n)).fire(new h.k("rotateend",n)),v&&this.fire(new h.k("pitchstart",n)).fire(new h.k("pitch",n)).fire(new h.k("pitchend",n)),this.fire(new h.k("moveend",n))}calculateCameraOptionsFromTo(t,n,l,c=0){const f=h.Y.fromLngLat(t,n),v=h.Y.fromLngLat(l,c),b=v.x-f.x,A=v.y-f.y,I=v.z-f.z,M=Math.hypot(b,A,I);if(M===0)throw new Error("Can't calculate camera options with same From and To");const k=Math.hypot(b,A),L=this.transform.scaleZoom(this.transform.cameraToCenterDistance/M/this.transform.tileSize),H=180*Math.atan2(b,-A)/Math.PI;let q=180*Math.acos(k/M)/Math.PI;return q=I<0?90-q:90+q,{center:v.toLngLat(),zoom:L,pitch:q,bearing:H}}easeTo(t,n){var l;this._stop(!1,t.easeId),((t=h.e({offset:[0,0],duration:500,easing:h.b7},t)).animate===!1||!t.essential&&Q.prefersReducedMotion)&&(t.duration=0);const c=this._getTransformForUpdate(),f=this.getZoom(),v=this.getBearing(),b=this.getPitch(),A=this.getPadding(),I="bearing"in t?this._normalizeBearing(t.bearing,v):v,M="pitch"in t?+t.pitch:b,k="padding"in t?t.padding:c.padding,L=h.P.convert(t.offset);let H=c.centerPoint.add(L);const q=c.pointLocation(H),{center:W,zoom:N}=c.getConstrained(h.M.convert(t.center||q),(l=t.zoom)!==null&&l!==void 0?l:f);this._normalizeCenter(W);const te=c.project(q),ue=c.project(W).sub(te),X=c.zoomScale(N-f);let ae,he;t.around&&(ae=h.M.convert(t.around),he=c.locationPoint(ae));const de={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||N!==f,this._rotating=this._rotating||v!==I,this._pitching=this._pitching||M!==b,this._padding=!c.isPaddingEqual(k),this._easeId=t.easeId,this._prepareEase(n,t.noMoveStart,de),this.terrain&&this._prepareElevation(W),this._ease(pe=>{if(this._zooming&&(c.zoom=h.z.number(f,N,pe)),this._rotating&&(c.bearing=h.z.number(v,I,pe)),this._pitching&&(c.pitch=h.z.number(b,M,pe)),this._padding&&(c.interpolatePadding(A,k,pe),H=c.centerPoint.add(L)),this.terrain&&!t.freezeElevation&&this._updateElevation(pe),ae)c.setLocationAtPoint(ae,he);else{const Se=c.zoomScale(c.zoom-f),ve=N>f?Math.min(2,X):Math.max(.5,X),we=Math.pow(ve,1-pe),Fe=c.unproject(te.add(ue.mult(pe*we)).mult(Se));c.setLocationAtPoint(c.renderWorldCopies?Fe.wrap():Fe,H)}this._applyUpdatedTransform(c),this._fireMoveEvents(n)},pe=>{this.terrain&&this._finalizeElevation(),this._afterEase(n,pe)},t),this}_prepareEase(t,n,l={}){this._moving=!0,n||l.moving||this.fire(new h.k("movestart",t)),this._zooming&&!l.zooming&&this.fire(new h.k("zoomstart",t)),this._rotating&&!l.rotating&&this.fire(new h.k("rotatestart",t)),this._pitching&&!l.pitching&&this.fire(new h.k("pitchstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const n=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&n!==this._elevationTarget){const l=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(l-(n-(l*t+this._elevationStart))/(1-t)),this._elevationTarget=n}this.transform.elevation=h.z.number(this._elevationStart,this._elevationTarget,t)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(t){if(!this.transformCameraUpdate)return;const n=t.clone(),{center:l,zoom:c,pitch:f,bearing:v,elevation:b}=this.transformCameraUpdate(n);l&&(n.center=l),c!==void 0&&(n.zoom=c),f!==void 0&&(n.pitch=f),v!==void 0&&(n.bearing=v),b!==void 0&&(n.elevation=b),this.transform.apply(n)}_fireMoveEvents(t){this.fire(new h.k("move",t)),this._zooming&&this.fire(new h.k("zoom",t)),this._rotating&&this.fire(new h.k("rotate",t)),this._pitching&&this.fire(new h.k("pitch",t))}_afterEase(t,n){if(this._easeId&&n&&this._easeId===n)return;delete this._easeId;const l=this._zooming,c=this._rotating,f=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,l&&this.fire(new h.k("zoomend",t)),c&&this.fire(new h.k("rotateend",t)),f&&this.fire(new h.k("pitchend",t)),this.fire(new h.k("moveend",t))}flyTo(t,n){var l;if(!t.essential&&Q.prefersReducedMotion){const ct=h.L(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(ct,n)}this.stop(),t=h.e({offset:[0,0],speed:1.2,curve:1.42,easing:h.b7},t);const c=this._getTransformForUpdate(),f=this.getZoom(),v=this.getBearing(),b=this.getPitch(),A=this.getPadding(),I="bearing"in t?this._normalizeBearing(t.bearing,v):v,M="pitch"in t?+t.pitch:b,k="padding"in t?t.padding:c.padding,L=h.P.convert(t.offset);let H=c.centerPoint.add(L);const q=c.pointLocation(H),{center:W,zoom:N}=c.getConstrained(h.M.convert(t.center||q),(l=t.zoom)!==null&&l!==void 0?l:f);this._normalizeCenter(W);const te=c.zoomScale(N-f),ue=c.project(q),X=c.project(W).sub(ue);let ae=t.curve;const he=Math.max(c.width,c.height),de=he/te,pe=X.mag();if("minZoom"in t){const ct=h.ac(Math.min(t.minZoom,f,N),c.minZoom,c.maxZoom),Xe=he/c.zoomScale(ct-f);ae=Math.sqrt(Xe/pe*2)}const Se=ae*ae;function ve(ct){const Xe=(de*de-he*he+(ct?-1:1)*Se*Se*pe*pe)/(2*(ct?de:he)*Se*pe);return Math.log(Math.sqrt(Xe*Xe+1)-Xe)}function we(ct){return(Math.exp(ct)-Math.exp(-ct))/2}function Fe(ct){return(Math.exp(ct)+Math.exp(-ct))/2}const Qe=ve(!1);let ke=function(ct){return Fe(Qe)/Fe(Qe+ae*ct)},We=function(ct){return he*((Fe(Qe)*(we(Xe=Qe+ae*ct)/Fe(Xe))-we(Qe))/Se)/pe;var Xe},rt=(ve(!0)-Qe)/ae;if(Math.abs(pe)<1e-6||!isFinite(rt)){if(Math.abs(he-de)<1e-6)return this.easeTo(t,n);const ct=de<he?-1:1;rt=Math.abs(Math.log(de/he))/ae,We=function(){return 0},ke=function(Xe){return Math.exp(ct*ae*Xe)}}return t.duration="duration"in t?+t.duration:1e3*rt/("screenSpeed"in t?+t.screenSpeed/ae:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=v!==I,this._pitching=M!==b,this._padding=!c.isPaddingEqual(k),this._prepareEase(n,!1),this.terrain&&this._prepareElevation(W),this._ease(ct=>{const Xe=ct*rt,st=1/ke(Xe);c.zoom=ct===1?N:f+c.scaleZoom(st),this._rotating&&(c.bearing=h.z.number(v,I,ct)),this._pitching&&(c.pitch=h.z.number(b,M,ct)),this._padding&&(c.interpolatePadding(A,k,ct),H=c.centerPoint.add(L)),this.terrain&&!t.freezeElevation&&this._updateElevation(ct);const at=ct===1?W:c.unproject(ue.add(X.mult(We(Xe))).mult(st));c.setLocationAtPoint(c.renderWorldCopies?at.wrap():at,H),this._applyUpdatedTransform(c),this._fireMoveEvents(n)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(n)},t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,n){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const l=this._onEaseEnd;delete this._onEaseEnd,l.call(this,n)}if(!t){const l=this.handlers;l&&l.stop(!1)}return this}_ease(t,n,l){l.animate===!1||l.duration===0?(t(1),n()):(this._easeStart=Q.now(),this._easeOptions=l,this._onEaseFrame=t,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,n){t=h.b1(t,-180,180);const l=Math.abs(t-n);return Math.abs(t-360-n)<l&&(t-=360),Math.abs(t+360-n)<l&&(t+=360),t}_normalizeCenter(t){const n=this.transform;if(!n.renderWorldCopies||n.lngRange)return;const l=t.lng-n.center.lng;t.lng+=l>180?-360:l<-180?360:0}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLatZoom(h.M.convert(t),this.transform.tileZoom)-this.transform.elevation:null}}const pr={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class _c{constructor(t=pr){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=n=>{!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"&&n.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=U.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=U.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=U.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){U.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,n){const l=this._map._getUIString(`AttributionControl.${n}`);t.title=l,t.setAttribute("aria-label",l)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(c=>typeof c!="string"?"":c)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const c=this._map.style.stylesheet;this.styleOwner=c.owner,this.styleId=c.id}const n=this._map.style.sourceCaches;for(const c in n){const f=n[c];if(f.used||f.usedForTerrain){const v=f.getSource();v.attribution&&t.indexOf(v.attribution)<0&&t.push(v.attribution)}}t=t.filter(c=>String(c).trim()),t.sort((c,f)=>c.length-f.length),t=t.filter((c,f)=>{for(let v=f+1;v<t.length;v++)if(t[v].indexOf(c)>=0)return!1;return!0});const l=t.join(" | ");l!==this._attribHTML&&(this._attribHTML=l,t.length?(this._innerContainer.innerHTML=l,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class ls{constructor(t={}){this._updateCompact=()=>{const n=this._container.children;if(n.length){const l=n[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&l.classList.add("maplibregl-compact"):l.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=U.create("div","maplibregl-ctrl");const n=U.create("a","maplibregl-ctrl-logo");return n.target="_blank",n.rel="noopener nofollow",n.href="https://maplibre.org/",n.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),n.setAttribute("rel","noopener nofollow"),this._container.appendChild(n),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){U.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class $t{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const n=++this._id;return this._queue.push({callback:t,id:n,cancelled:!1}),n}remove(t){const n=this._currentlyRunning,l=n?this._queue.concat(n):this._queue;for(const c of l)if(c.id===t)return void(c.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const n=this._currentlyRunning=this._queue;this._queue=[];for(const l of n)if(!l.cancelled&&(l.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Wt=h.X([{name:"a_pos3d",type:"Int16",components:3}]);class xc extends h.E{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(t,n){this.sourceCache.update(t,n),this._renderableTilesKeys=[];const l={};for(const c of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:n}))l[c.key]=!0,this._renderableTilesKeys.push(c.key),this._tiles[c.key]||(c.posMatrix=new Float64Array(16),h.aN(c.posMatrix,0,h.W,0,h.W,0,1),this._tiles[c.key]=new Di(c,this.tileSize));for(const c in this._tiles)l[c]||delete this._tiles[c]}freeRtt(t){for(const n in this._tiles){const l=this._tiles[n];(!t||l.tileID.equals(t)||l.tileID.isChildOf(t)||t.isChildOf(l.tileID))&&(l.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t){const n={};for(const l of this._renderableTilesKeys){const c=this._tiles[l].tileID;if(c.canonical.equals(t.canonical)){const f=t.clone();f.posMatrix=new Float64Array(16),h.aN(f.posMatrix,0,h.W,0,h.W,0,1),n[l]=f}else if(c.canonical.isChildOf(t.canonical)){const f=t.clone();f.posMatrix=new Float64Array(16);const v=c.canonical.z-t.canonical.z,b=c.canonical.x-(c.canonical.x>>v<<v),A=c.canonical.y-(c.canonical.y>>v<<v),I=h.W>>v;h.aN(f.posMatrix,0,I,0,I,0,1),h.H(f.posMatrix,f.posMatrix,[-b*I,-A*I,0]),n[l]=f}else if(t.canonical.isChildOf(c.canonical)){const f=t.clone();f.posMatrix=new Float64Array(16);const v=t.canonical.z-c.canonical.z,b=t.canonical.x-(t.canonical.x>>v<<v),A=t.canonical.y-(t.canonical.y>>v<<v),I=h.W>>v;h.aN(f.posMatrix,0,h.W,0,h.W,0,1),h.H(f.posMatrix,f.posMatrix,[b*I,A*I,0]),h.J(f.posMatrix,f.posMatrix,[1/2**v,1/2**v,0]),n[l]=f}}return n}getSourceTile(t,n){const l=this.sourceCache._source;let c=t.overscaledZ-this.deltaZoom;if(c>l.maxzoom&&(c=l.maxzoom),c<l.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(c).key);let f=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!f||!f.dem)&&n)for(;c>=l.minzoom&&(!f||!f.dem);)f=this.sourceCache.getTileByID(t.scaledTo(c--).key);return f}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter(n=>n.timeAdded>=t)}}class js{constructor(t,n,l){this.painter=t,this.sourceCache=new xc(n),this.options=l,this.exaggeration=typeof l.exaggeration=="number"?l.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,n,l,c=h.W){var f;if(!(n>=0&&n<c&&l>=0&&l<c))return 0;const v=this.getTerrainData(t),b=(f=v.tile)===null||f===void 0?void 0:f.dem;if(!b)return 0;const A=function(q,W,N){var te=W[0],ue=W[1];return q[0]=N[0]*te+N[4]*ue+N[12],q[1]=N[1]*te+N[5]*ue+N[13],q}([],[n/c*h.W,l/c*h.W],v.u_terrain_matrix),I=[A[0]*b.dim,A[1]*b.dim],M=Math.floor(I[0]),k=Math.floor(I[1]),L=I[0]-M,H=I[1]-k;return b.get(M,k)*(1-L)*(1-H)+b.get(M+1,k)*L*(1-H)+b.get(M,k+1)*(1-L)*H+b.get(M+1,k+1)*L*H}getElevationForLngLatZoom(t,n){const{tileID:l,mercatorX:c,mercatorY:f}=this._getOverscaledTileIDFromLngLatZoom(t,n);return this.getElevation(l,c%h.W,f%h.W,h.W)}getElevation(t,n,l,c=h.W){return this.getDEMElevation(t,n,l,c)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const c=this.painter.context,f=new h.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Ut(c,f,c.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Ut(c,new h.R({width:1,height:1}),c.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=h.an([])}const n=this.sourceCache.getSourceTile(t,!0);if(n&&n.dem&&(!n.demTexture||n.needsTerrainPrepare)){const c=this.painter.context;n.demTexture=this.painter.getTileTexture(n.dem.stride),n.demTexture?n.demTexture.update(n.dem.getPixels(),{premultiply:!1}):n.demTexture=new Ut(c,n.dem.getPixels(),c.gl.RGBA,{premultiply:!1}),n.demTexture.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),n.needsTerrainPrepare=!1}const l=n&&n+n.tileID.key+t.key;if(l&&!this._demMatrixCache[l]){const c=this.sourceCache.sourceCache._source.maxzoom;let f=t.canonical.z-n.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=c?f=t.canonical.z-c:h.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const v=t.canonical.x-(t.canonical.x>>f<<f),b=t.canonical.y-(t.canonical.y>>f<<f),A=h.b9(new Float64Array(16),[1/(h.W<<f),1/(h.W<<f),0]);h.H(A,A,[v*h.W,b*h.W,0]),this._demMatrixCache[t.key]={matrix:A,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:n&&n.dem&&n.dem.dim||1,u_terrain_matrix:l?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:n&&n.dem&&n.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(n&&n.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:n}}getFramebuffer(t){const n=this.painter,l=n.width/devicePixelRatio,c=n.height/devicePixelRatio;return!this._fbo||this._fbo.width===l&&this._fbo.height===c||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Ut(n.context,{width:l,height:c,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Ut(n.context,{width:l,height:c,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=n.context.createFramebuffer(l,c,!0,!1),this._fbo.depthAttachment.set(n.context.createRenderbuffer(n.context.gl.DEPTH_COMPONENT16,l,c))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const n=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let f=0,v=0;f<this._coordsTextureSize;f++)for(let b=0;b<this._coordsTextureSize;b++,v+=4)n[v+0]=255&b,n[v+1]=255&f,n[v+2]=b>>8<<4|f>>8,n[v+3]=0;const l=new h.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(n.buffer)),c=new Ut(t,l,t.gl.RGBA,{premultiply:!1});return c.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=c,c}pointCoordinate(t){this.painter.maybeDrawDepthAndCoords(!0);const n=new Uint8Array(4),l=this.painter.context,c=l.gl;l.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),c.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,c.RGBA,c.UNSIGNED_BYTE,n),l.bindFramebuffer.set(null);const f=n[0]+(n[2]>>4<<8),v=n[1]+((15&n[2])<<8),b=this.coordsIndex[255-n[3]],A=b&&this.sourceCache.getTileByID(b);if(!A)return null;const I=this._coordsTextureSize,M=(1<<A.tileID.canonical.z)*I;return new h.Y((A.tileID.canonical.x*I+f)/M+A.tileID.wrap,(A.tileID.canonical.y*I+v)/M,this.getElevation(A.tileID,f,v,I))}depthAtPoint(t){const n=new Uint8Array(4),l=this.painter.context,c=l.gl;return l.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),c.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,c.RGBA,c.UNSIGNED_BYTE,n),l.bindFramebuffer.set(null),(n[0]/16777216+n[1]/65536+n[2]/256+n[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const t=this.painter.context,n=new h.ba,l=new h.aX,c=this.meshSize,f=h.W/c,v=c*c;for(let k=0;k<=c;k++)for(let L=0;L<=c;L++)n.emplaceBack(L*f,k*f,0);for(let k=0;k<v;k+=c+1)for(let L=0;L<c;L++)l.emplaceBack(L+k,c+L+k+1,c+L+k+2),l.emplaceBack(L+k,c+L+k+2,L+k+1);const b=n.length,A=b+2*(c+1);for(const k of[0,1])for(let L=0;L<=c;L++)for(const H of[0,1])n.emplaceBack(L*f,k*h.W,H);for(let k=0;k<2*c;k+=2)l.emplaceBack(A+k,A+k+1,A+k+3),l.emplaceBack(A+k,A+k+3,A+k+2),l.emplaceBack(b+k,b+k+3,b+k+1),l.emplaceBack(b+k,b+k+2,b+k+3);const I=n.length,M=I+2*(c+1);for(const k of[0,1])for(let L=0;L<=c;L++)for(const H of[0,1])n.emplaceBack(k*h.W,L*f,H);for(let k=0;k<2*c;k+=2)l.emplaceBack(I+k,I+k+1,I+k+3),l.emplaceBack(I+k,I+k+3,I+k+2),l.emplaceBack(M+k,M+k+3,M+k+1),l.emplaceBack(M+k,M+k+2,M+k+3);return this._mesh={indexBuffer:t.createIndexBuffer(l),vertexBuffer:t.createVertexBuffer(n,Wt.members),segments:h.$.simpleSegment(0,0,n.length,l.length)},this._mesh}getMeshFrameDelta(t){return 2*Math.PI*h.bb/Math.pow(2,t)/5}getMinTileElevationForLngLatZoom(t,n){var l;const{tileID:c}=this._getOverscaledTileIDFromLngLatZoom(t,n);return(l=this.getMinMaxElevation(c).minElevation)!==null&&l!==void 0?l:0}getMinMaxElevation(t){const n=this.getTerrainData(t).tile,l={minElevation:null,maxElevation:null};return n&&n.dem&&(l.minElevation=n.dem.min*this.exaggeration,l.maxElevation=n.dem.max*this.exaggeration),l}_getOverscaledTileIDFromLngLatZoom(t,n){const l=h.Y.fromLngLat(t.wrap()),c=(1<<n)*h.W,f=l.x*c,v=l.y*c,b=Math.floor(f/h.W),A=Math.floor(v/h.W);return{tileID:new h.Q(n,0,n,b,A),mercatorX:f,mercatorY:v}}}class Aa{constructor(t,n,l){this._context=t,this._size=n,this._tileSize=l,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const n=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),l=new Ut(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return l.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),n.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),n.colorAttachment.set(l.texture),{id:t,fbo:n,texture:l,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(n=>t.id!==n),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const n of this._recentlyUsed)if(!this._objects[n].inUse)return this._objects[n];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(t=>!t.inUse)===!1}}const tn={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class ko{constructor(t,n){this.painter=t,this.terrain=n,this.pool=new Aa(t.context,30,n.sourceCache.tileSize*n.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,n){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=t._order.filter(l=>!t._layers[l].isHidden(n)),this._coordsDescendingInv={};for(const l in t.sourceCaches){this._coordsDescendingInv[l]={};const c=t.sourceCaches[l].getVisibleCoordinates();for(const f of c){const v=this.terrain.sourceCache.getTerrainCoords(f);for(const b in v)this._coordsDescendingInv[l][b]||(this._coordsDescendingInv[l][b]=[]),this._coordsDescendingInv[l][b].push(v[b])}}this._coordsDescendingInvStr={};for(const l of t._order){const c=t._layers[l],f=c.source;if(tn[c.type]&&!this._coordsDescendingInvStr[f]){this._coordsDescendingInvStr[f]={};for(const v in this._coordsDescendingInv[f])this._coordsDescendingInvStr[f][v]=this._coordsDescendingInv[f][v].map(b=>b.key).sort().join()}}for(const l of this._renderableTiles)for(const c in this._coordsDescendingInvStr){const f=this._coordsDescendingInvStr[c][l.tileID.key];f&&f!==l.rttCoords[c]&&(l.rtt=[])}}renderLayer(t){if(t.isHidden(this.painter.transform.zoom))return!1;const n=t.type,l=this.painter,c=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(tn[n]&&(this._prevType&&tn[this._prevType]||this._stacks.push([]),this._prevType=n,this._stacks[this._stacks.length-1].push(t.id),!c))return!0;if(tn[this._prevType]||tn[n]&&c){this._prevType=n;const f=this._stacks.length-1,v=this._stacks[f]||[];for(const b of this._renderableTiles){if(this.pool.isFull()&&(yo(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(b),b.rtt[f]){const I=this.pool.getObjectForId(b.rtt[f].id);if(I.stamp===b.rtt[f].stamp){this.pool.useObject(I);continue}}const A=this.pool.getOrCreateFreeObject();this.pool.useObject(A),this.pool.stampObject(A),b.rtt[f]={id:A.id,stamp:A.stamp},l.context.bindFramebuffer.set(A.fbo.framebuffer),l.context.clear({color:h.aO.transparent,stencil:0}),l.currentStencilSource=void 0;for(let I=0;I<v.length;I++){const M=l.style._layers[v[I]],k=M.source?this._coordsDescendingInv[M.source][b.tileID.key]:[b.tileID];l.context.viewport.set([0,0,A.fbo.width,A.fbo.height]),l._renderTileClippingMasks(M,k),l.renderLayer(l,l.style.sourceCaches[M.source],M,k),M.source&&(b.rttCoords[M.source]=this._coordsDescendingInvStr[M.source][b.tileID.key])}}return yo(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),tn[n]}return!1}}const Do={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},qs=K,Ro={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:pr,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:h.a.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},Ea=p=>{p.touchstart=p.dragStart,p.touchmoveWindow=p.dragMove,p.touchend=p.dragEnd},zo={showCompass:!0,showZoom:!0,visualizePitch:!1};class Bo{constructor(t,n,l=!1){this.mousedown=v=>{this.startMouse(h.e({},v,{ctrlKey:!0,preventDefault:()=>v.preventDefault()}),U.mousePos(this.element,v)),U.addEventListener(window,"mousemove",this.mousemove),U.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=v=>{this.moveMouse(v,U.mousePos(this.element,v))},this.mouseup=v=>{this.mouseRotate.dragEnd(v),this.mousePitch&&this.mousePitch.dragEnd(v),this.offTemp()},this.touchstart=v=>{v.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=U.touchPos(this.element,v.targetTouches)[0],this.startTouch(v,this._startPos),U.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),U.addEventListener(window,"touchend",this.touchend))},this.touchmove=v=>{v.targetTouches.length!==1?this.reset():(this._lastPos=U.touchPos(this.element,v.targetTouches)[0],this.moveTouch(v,this._lastPos))},this.touchend=v=>{v.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const c=t.dragRotate._mouseRotate.getClickTolerance(),f=t.dragRotate._mousePitch.getClickTolerance();this.element=n,this.mouseRotate=os({clickTolerance:c,enable:!0}),this.touchRotate=(({enable:v,clickTolerance:b,bearingDegreesPerPixelMoved:A=.8})=>{const I=new So;return new Fr({clickTolerance:b,move:(M,k)=>({bearingDelta:(k.x-M.x)*A}),moveStateManager:I,enable:v,assignEvents:Ea})})({clickTolerance:c,enable:!0}),this.map=t,l&&(this.mousePitch=To({clickTolerance:f,enable:!0}),this.touchPitch=(({enable:v,clickTolerance:b,pitchDegreesPerPixelMoved:A=-.5})=>{const I=new So;return new Fr({clickTolerance:b,move:(M,k)=>({pitchDelta:(k.y-M.y)*A}),moveStateManager:I,enable:v,assignEvents:Ea})})({clickTolerance:f,enable:!0})),U.addEventListener(n,"mousedown",this.mousedown),U.addEventListener(n,"touchstart",this.touchstart,{passive:!1}),U.addEventListener(n,"touchcancel",this.reset)}startMouse(t,n){this.mouseRotate.dragStart(t,n),this.mousePitch&&this.mousePitch.dragStart(t,n),U.disableDrag()}startTouch(t,n){this.touchRotate.dragStart(t,n),this.touchPitch&&this.touchPitch.dragStart(t,n),U.disableDrag()}moveMouse(t,n){const l=this.map,{bearingDelta:c}=this.mouseRotate.dragMove(t,n)||{};if(c&&l.setBearing(l.getBearing()+c),this.mousePitch){const{pitchDelta:f}=this.mousePitch.dragMove(t,n)||{};f&&l.setPitch(l.getPitch()+f)}}moveTouch(t,n){const l=this.map,{bearingDelta:c}=this.touchRotate.dragMove(t,n)||{};if(c&&l.setBearing(l.getBearing()+c),this.touchPitch){const{pitchDelta:f}=this.touchPitch.dragMove(t,n)||{};f&&l.setPitch(l.getPitch()+f)}}off(){const t=this.element;U.removeEventListener(t,"mousedown",this.mousedown),U.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),U.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),U.removeEventListener(window,"touchend",this.touchend),U.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){U.enableDrag(),U.removeEventListener(window,"mousemove",this.mousemove),U.removeEventListener(window,"mouseup",this.mouseup),U.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),U.removeEventListener(window,"touchend",this.touchend)}}let Or;function Ia(p,t,n){const l=new h.M(p.lng,p.lat);if(p=new h.M(p.lng,p.lat),t){const c=new h.M(p.lng-360,p.lat),f=new h.M(p.lng+360,p.lat),v=n.locationPoint(p).distSqr(t);n.locationPoint(c).distSqr(t)<v?p=c:n.locationPoint(f).distSqr(t)<v&&(p=f)}for(;Math.abs(p.lng-n.center.lng)>180;){const c=n.locationPoint(p);if(c.x>=0&&c.y>=0&&c.x<=n.width&&c.y<=n.height)break;p.lng>n.center.lng?p.lng-=360:p.lng+=360}return p.lng!==l.lng&&n.locationPoint(p).y>n.height/2-n.getHorizon()?p:l}const Gs={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ca(p,t,n){const l=p.classList;for(const c in Gs)l.remove(`maplibregl-${n}-anchor-${c}`);l.add(`maplibregl-${n}-anchor-${t}`)}class cs extends h.E{constructor(t){if(super(),this._onKeyPress=n=>{const l=n.code,c=n.charCode||n.keyCode;l!=="Space"&&l!=="Enter"&&c!==32&&c!==13||this.togglePopup()},this._onMapClick=n=>{const l=n.originalEvent.target,c=this._element;this._popup&&(l===c||c.contains(l))&&this.togglePopup()},this._update=n=>{var l;if(!this._map)return;const c=this._map.loaded()&&!this._map.isMoving();((n==null?void 0:n.type)==="terrain"||(n==null?void 0:n.type)==="render"&&!c)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Ia(this._lngLat,this._flatPos,this._map.transform):(l=this._lngLat)===null||l===void 0?void 0:l.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let f="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?f=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(f=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let v="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?v="rotateX(0deg)":this._pitchAlignment==="map"&&(v=`rotateX(${this._map.getPitch()}deg)`),n&&n.type!=="moveend"||(this._pos=this._pos.round()),U.setTransform(this._element,`${Gs[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${v} ${f}`),Q.frameAsync(new AbortController).then(()=>{this._updateOpacity(n&&n.type==="moveend")}).catch(()=>{})},this._onMove=n=>{if(!this._isDragging){const l=this._clickTolerance||this._map._clickTolerance;this._isDragging=n.point.dist(this._pointerdownPos)>=l}this._isDragging&&(this._pos=n.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new h.k("dragstart"))),this.fire(new h.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new h.k("dragend")),this._state="inactive"},this._addDragHandler=n=>{this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(this._pos).add(this._offset),this._pointerdownPos=n.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(t==null?void 0:t.opacity,t==null?void 0:t.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=h.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=U.create("div"),this._element.setAttribute("aria-label","Map marker");const n=U.createNS("http://www.w3.org/2000/svg","svg"),l=41,c=27;n.setAttributeNS(null,"display","block"),n.setAttributeNS(null,"height",`${l}px`),n.setAttributeNS(null,"width",`${c}px`),n.setAttributeNS(null,"viewBox",`0 0 ${c} ${l}`);const f=U.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"stroke","none"),f.setAttributeNS(null,"stroke-width","1"),f.setAttributeNS(null,"fill","none"),f.setAttributeNS(null,"fill-rule","evenodd");const v=U.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"fill-rule","nonzero");const b=U.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"transform","translate(3.0, 29.0)"),b.setAttributeNS(null,"fill","#000000");const A=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const te of A){const ue=U.createNS("http://www.w3.org/2000/svg","ellipse");ue.setAttributeNS(null,"opacity","0.04"),ue.setAttributeNS(null,"cx","10.5"),ue.setAttributeNS(null,"cy","5.80029008"),ue.setAttributeNS(null,"rx",te.rx),ue.setAttributeNS(null,"ry",te.ry),b.appendChild(ue)}const I=U.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"fill",this._color);const M=U.createNS("http://www.w3.org/2000/svg","path");M.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),I.appendChild(M);const k=U.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"opacity","0.25"),k.setAttributeNS(null,"fill","#000000");const L=U.createNS("http://www.w3.org/2000/svg","path");L.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),k.appendChild(L);const H=U.createNS("http://www.w3.org/2000/svg","g");H.setAttributeNS(null,"transform","translate(6.0, 7.0)"),H.setAttributeNS(null,"fill","#FFFFFF");const q=U.createNS("http://www.w3.org/2000/svg","g");q.setAttributeNS(null,"transform","translate(8.0, 8.0)");const W=U.createNS("http://www.w3.org/2000/svg","circle");W.setAttributeNS(null,"fill","#000000"),W.setAttributeNS(null,"opacity","0.25"),W.setAttributeNS(null,"cx","5.5"),W.setAttributeNS(null,"cy","5.5"),W.setAttributeNS(null,"r","5.4999962");const N=U.createNS("http://www.w3.org/2000/svg","circle");N.setAttributeNS(null,"fill","#FFFFFF"),N.setAttributeNS(null,"cx","5.5"),N.setAttributeNS(null,"cy","5.5"),N.setAttributeNS(null,"r","5.4999962"),q.appendChild(W),q.appendChild(N),v.appendChild(b),v.appendChild(I),v.appendChild(k),v.appendChild(H),v.appendChild(q),n.appendChild(v),n.setAttributeNS(null,"height",l*this._scale+"px"),n.setAttributeNS(null,"width",c*this._scale+"px"),this._element.appendChild(n),this._offset=h.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",n=>{n.preventDefault()}),this._element.addEventListener("mousedown",n=>{n.preventDefault()}),Ca(this._element,this._anchor,"marker"),t&&t.className)for(const n of t.className.split(" "))this._element.classList.add(n);this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),U.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=h.M.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const c=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[c,-1*(38.1-13.5+c)],"bottom-right":[-c,-1*(38.1-13.5+c)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:t?(t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map)),this):this}_updateOpacity(t=!1){var n,l;if(!(!((n=this._map)===null||n===void 0)&&n.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const c=this._map,f=c.terrain.depthAtPoint(this._pos),v=c.terrain.getElevationForLngLatZoom(this._lngLat,c.transform.tileZoom);if(c.transform.lngLatToCameraDepth(this._lngLat,v)-f<.006)return void(this._element.style.opacity=this._opacity);const b=-this._offset.y/c.transform._pixelPerMeter,A=Math.sin(c.getPitch()*Math.PI/180)*b,I=c.terrain.depthAtPoint(new h.P(this._pos.x,this._pos.y-this._offset.y)),M=c.transform.lngLatToCameraDepth(this._lngLat,v+A)-I>.006;!((l=this._popup)===null||l===void 0)&&l.isOpen()&&M&&this._popup.remove(),this._element.style.opacity=M?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=h.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,n){return t===void 0&&n===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),t!==void 0&&(this._opacity=t),n!==void 0&&(this._opacityWhenCovered=n),this._map&&this._updateOpacity(!0),this}}const Lo={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let us=0,rn=!1;const Fo={maxWidth:100,unit:"metric"};function Pa(p,t,n){const l=n&&n.maxWidth||100,c=p._container.clientHeight/2,f=p.unproject([0,c]),v=p.unproject([l,c]),b=f.distanceTo(v);if(n&&n.unit==="imperial"){const A=3.2808*b;A>5280?Pn(t,l,A/5280,p._getUIString("ScaleControl.Miles")):Pn(t,l,A,p._getUIString("ScaleControl.Feet"))}else n&&n.unit==="nautical"?Pn(t,l,b/1852,p._getUIString("ScaleControl.NauticalMiles")):b>=1e3?Pn(t,l,b/1e3,p._getUIString("ScaleControl.Kilometers")):Pn(t,l,b,p._getUIString("ScaleControl.Meters"))}function Pn(p,t,n,l){const c=function(f){const v=Math.pow(10,`${Math.floor(f)}`.length-1);let b=f/v;return b=b>=10?10:b>=5?5:b>=3?3:b>=2?2:b>=1?1:function(A){const I=Math.pow(10,Math.ceil(-Math.log(A)/Math.LN10));return Math.round(A*I)/I}(b),v*b}(n);p.style.width=t*(c/n)+"px",p.innerHTML=`${c}&nbsp;${l}`}const Oo={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},$o=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function No(p){if(p){if(typeof p=="number"){const t=Math.round(Math.abs(p)/Math.SQRT2);return{center:new h.P(0,0),top:new h.P(0,p),"top-left":new h.P(t,t),"top-right":new h.P(-t,t),bottom:new h.P(0,-p),"bottom-left":new h.P(t,-t),"bottom-right":new h.P(-t,-t),left:new h.P(p,0),right:new h.P(-p,0)}}if(p instanceof h.P||Array.isArray(p)){const t=h.P.convert(p);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:h.P.convert(p.center||[0,0]),top:h.P.convert(p.top||[0,0]),"top-left":h.P.convert(p["top-left"]||[0,0]),"top-right":h.P.convert(p["top-right"]||[0,0]),bottom:h.P.convert(p.bottom||[0,0]),"bottom-left":h.P.convert(p["bottom-left"]||[0,0]),"bottom-right":h.P.convert(p["bottom-right"]||[0,0]),left:h.P.convert(p.left||[0,0]),right:h.P.convert(p.right||[0,0])}}return No(new h.P(0,0))}const vc=K;x.AJAXError=h.be,x.Evented=h.E,x.LngLat=h.M,x.MercatorCoordinate=h.Y,x.Point=h.P,x.addProtocol=h.bf,x.config=h.a,x.removeProtocol=h.bg,x.AttributionControl=_c,x.BoxZoomHandler=as,x.CanvasSource=jn,x.CooperativeGesturesHandler=He,x.DoubleClickZoomHandler=Po,x.DragPanHandler=dr,x.DragRotateHandler=Us,x.EdgeInsets=Fs,x.FullscreenControl=class extends h.E{constructor(p={}){super(),this._onFullscreenChange=()=>{var t;let n=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((t=n==null?void 0:n.shadowRoot)===null||t===void 0)&&t.fullscreenElement;)n=n.shadowRoot.fullscreenElement;n===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,p&&p.container&&(p.container instanceof HTMLElement?this._container=p.container:h.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=U.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){U.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const p=this._fullscreenButton=U.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);U.create("span","maplibregl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.title=p}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new h.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new h.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},x.GeoJSONSource=ht,x.GeolocateControl=class extends h.E{constructor(p){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new h.k("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new h.k("geolocate",t)),this._finish()}},this._updateCamera=t=>{const n=new h.M(t.coords.longitude,t.coords.latitude),l=t.coords.accuracy,c=this._map.getBearing(),f=h.e({bearing:c},this.options.fitBoundsOptions),v=Qt.fromLngLat(n,l);this._map.fitBounds(v,f,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const n=new h.M(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=t=>{if(this._map){if(this.options.trackUserLocation)if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&rn)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new h.k("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=t=>{if(this._map){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=U.create("button","maplibregl-ctrl-geolocate",this._container),U.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",t===!1){h.w("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=U.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new cs({element:this._dotElement}),this._circleElement=U.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new cs({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new h.k("trackuserlocationend")))})}},this.options=h.e({},Lo,p)}onAdd(p){return this._map=p,this._container=U.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(){return h._(this,arguments,void 0,function*(t=!1){if(Or!==void 0&&!t)return Or;if(window.navigator.permissions===void 0)return Or=!!window.navigator.geolocation,Or;try{Or=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Or=!!window.navigator.geolocation}return Or})}().then(t=>this._setupUI(t)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),U.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,us=0,rn=!1}_isOutOfMapMaxBounds(p){const t=this._map.getMaxBounds(),n=p.coords;return t&&(n.longitude<t.getWest()||n.longitude>t.getEast()||n.latitude<t.getSouth()||n.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const p=this._map.getBounds(),t=p.getSouthEast(),n=p.getNorthEast(),l=t.distanceTo(n),c=Math.ceil(this._accuracy/(l/this._map._container.clientHeight)*2);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}trigger(){if(!this._setup)return h.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new h.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":us--,rn=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new h.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new h.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let p;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),us++,us>1?(p={maximumAge:6e5,timeout:0},rn=!0):(p=this.options.positionOptions,rn=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,p)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},x.Hash=vo,x.ImageSource=Tr,x.KeyboardHandler=Pt,x.LngLatBounds=Qt,x.LogoControl=ls,x.Map=class extends yc{constructor(p){if(h.bc.mark(h.bd.create),(p=h.e({},Ro,p)).minZoom!=null&&p.maxZoom!=null&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(p.minPitch!=null&&p.maxPitch!=null&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(p.minPitch!=null&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(p.maxPitch!=null&&p.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new va(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies),{bearingSnap:p.bearingSnap}),this._contextLost=t=>{t.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new h.k("webglcontextlost",{originalEvent:t}))},this._contextRestored=t=>{this._setupPainter(),this.resize(),this._update(),this.fire(new h.k("webglcontextrestored",{originalEvent:t}))},this._onMapScroll=t=>{if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=p.interactive,this._maxTileCacheSize=p.maxTileCacheSize,this._maxTileCacheZoomLevels=p.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._crossSourceCollisions=p.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=p.collectResourceTiming,this._renderTaskQueue=new $t,this._controls=[],this._mapId=h.a3(),this._locale=h.e({},Do,p.locale),this._clickTolerance=p.clickTolerance,this._overridePixelRatio=p.pixelRatio,this._maxCanvasSize=p.maxCanvasSize,this.transformCameraUpdate=p.transformCameraUpdate,this._imageQueueHandle=gt.addThrottleControl(()=>this.isMoving()),this._requestManager=new pi(p.transformRequest),typeof p.container=="string"){if(this._container=document.getElementById(p.container),!this._container)throw new Error(`Container '${p.container}' not found.`)}else{if(!(p.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(p.maxBounds&&this.setMaxBounds(p.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let t=!1;const n=xo(l=>{this._trackResize&&!this._removed&&this.resize(l)._update()},50);this._resizeObserver=new ResizeObserver(l=>{t?n(l):t=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Bi(this,p),this._hash=p.hash&&new vo(typeof p.hash=="string"&&p.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch}),p.bounds&&(this.resize(),this.fitBounds(p.bounds,h.e({},p.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=p.localIdeographFontFamily,this._validateStyle=p.validateStyle,p.style&&this.setStyle(p.style,{localIdeographFontFamily:p.localIdeographFontFamily}),p.attributionControl&&this.addControl(new _c(typeof p.attributionControl=="boolean"?void 0:p.attributionControl)),p.maplibreLogo&&this.addControl(new ls,p.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",t=>{this._update(t.dataType==="style"),this.fire(new h.k(`${t.dataType}data`,t))}),this.on("dataloading",t=>{this.fire(new h.k(`${t.dataType}dataloading`,t))}),this.on("dataabort",t=>{this.fire(new h.k("sourcedataabort",t))})}_getMapId(){return this._mapId}addControl(p,t){if(t===void 0&&(t=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new h.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=p.onAdd(this);this._controls.push(p);const l=this._controlPositions[t];return t.indexOf("bottom")!==-1?l.insertBefore(n,l.firstChild):l.appendChild(n),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new h.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(p);return t>-1&&this._controls.splice(t,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}calculateCameraOptionsFromTo(p,t,n,l){return l==null&&this.terrain&&(l=this.terrain.getElevationForLngLatZoom(n,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(p,t,n,l)}resize(p){var t;const n=this._containerDimensions(),l=n[0],c=n[1],f=this._getClampedPixelRatio(l,c);if(this._resizeCanvas(l,c,f),this.painter.resize(l,c,f),this.painter.overLimit()){const b=this.painter.context.gl;this._maxCanvasSize=[b.drawingBufferWidth,b.drawingBufferHeight];const A=this._getClampedPixelRatio(l,c);this._resizeCanvas(l,c,A),this.painter.resize(l,c,A)}this.transform.resize(l,c),(t=this._requestedCameraState)===null||t===void 0||t.resize(l,c);const v=!this._moving;return v&&(this.stop(),this.fire(new h.k("movestart",p)).fire(new h.k("move",p))),this.fire(new h.k("resize",p)),v&&this.fire(new h.k("moveend",p)),this}_getClampedPixelRatio(p,t){const{0:n,1:l}=this._maxCanvasSize,c=this.getPixelRatio(),f=p*c,v=t*c;return Math.min(f>n?n/f:1,v>l?l/v:1)*c}getPixelRatio(){var p;return(p=this._overridePixelRatio)!==null&&p!==void 0?p:devicePixelRatio}setPixelRatio(p){this._overridePixelRatio=p,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(p){return this.transform.setMaxBounds(Qt.convert(p)),this._update()}setMinZoom(p){if((p=p??-2)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p&&this.setZoom(p),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p??22)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p&&this.setZoom(p),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p&&this.setPitch(p),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p&&this.setPitch(p),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this._update()}project(p){return this.transform.locationPoint(h.M.convert(p),this.style&&this.terrain)}unproject(p){return this.transform.pointLocation(h.P.convert(p),this.terrain)}isMoving(){var p;return this._moving||((p=this.handlers)===null||p===void 0?void 0:p.isMoving())}isZooming(){var p;return this._zooming||((p=this.handlers)===null||p===void 0?void 0:p.isZooming())}isRotating(){var p;return this._rotating||((p=this.handlers)===null||p===void 0?void 0:p.isRotating())}_createDelegatedListener(p,t,n){if(p==="mouseenter"||p==="mouseover"){let l=!1;return{layer:t,listener:n,delegates:{mousemove:f=>{const v=this.getLayer(t)?this.queryRenderedFeatures(f.point,{layers:[t]}):[];v.length?l||(l=!0,n.call(this,new li(p,this,f.originalEvent,{features:v}))):l=!1},mouseout:()=>{l=!1}}}}if(p==="mouseleave"||p==="mouseout"){let l=!1;return{layer:t,listener:n,delegates:{mousemove:v=>{(this.getLayer(t)?this.queryRenderedFeatures(v.point,{layers:[t]}):[]).length?l=!0:l&&(l=!1,n.call(this,new li(p,this,v.originalEvent)))},mouseout:v=>{l&&(l=!1,n.call(this,new li(p,this,v.originalEvent)))}}}}{const l=c=>{const f=this.getLayer(t)?this.queryRenderedFeatures(c.point,{layers:[t]}):[];f.length&&(c.features=f,n.call(this,c),delete c.features)};return{layer:t,listener:n,delegates:{[p]:l}}}}on(p,t,n){if(n===void 0)return super.on(p,t);const l=this._createDelegatedListener(p,t,n);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(l);for(const c in l.delegates)this.on(c,l.delegates[c]);return this}once(p,t,n){if(n===void 0)return super.once(p,t);const l=this._createDelegatedListener(p,t,n);for(const c in l.delegates)this.once(c,l.delegates[c]);return this}off(p,t,n){return n===void 0?super.off(p,t):(this._delegatedListeners&&this._delegatedListeners[p]&&(l=>{const c=this._delegatedListeners[p];for(let f=0;f<c.length;f++){const v=c[f];if(v.layer===t&&v.listener===n){for(const b in v.delegates)this.off(b,v.delegates[b]);return c.splice(f,1),this}}})(),this)}queryRenderedFeatures(p,t){if(!this.style)return[];let n;const l=p instanceof h.P||Array.isArray(p),c=l?p:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(l?{}:p)||{},c instanceof h.P||typeof c[0]=="number")n=[h.P.convert(c)];else{const f=h.P.convert(c[0]),v=h.P.convert(c[1]);n=[f,new h.P(v.x,f.y),v,new h.P(f.x,v.y),f]}return this.style.queryRenderedFeatures(n,t,this.transform)}querySourceFeatures(p,t){return this.style.querySourceFeatures(p,t)}setStyle(p,t){return(t=h.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&p?(this._diffStyle(p,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(p,t))}setTransformRequest(p){return this._requestManager.setTransformRequest(p),this}_getUIString(p){const t=this._locale[p];if(t==null)throw new Error(`Missing UI string '${p}'`);return t}_updateStyle(p,t){if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(p,t));const n=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!p)),p?(this.style=new ra(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof p=="string"?this.style.loadURL(p,t,n):this.style.loadJSON(p,t,n),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new ra(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(p,t){if(typeof p=="string"){const n=this._requestManager.transformRequest(p,xt.Style);h.h(n,new AbortController).then(l=>{this._updateDiff(l.data,t)}).catch(l=>{l&&this.fire(new h.j(l))})}else typeof p=="object"&&this._updateDiff(p,t)}_updateDiff(p,t){try{this.style.setState(p,t)&&this._update(!0)}catch(n){h.w(`Unable to perform style diff: ${n.message||n.error||n}.  Rebuilding the style from scratch.`),this._updateStyle(p,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():h.w("There is no style added to the map.")}addSource(p,t){return this._lazyInitEmptyStyle(),this.style.addSource(p,t),this._update(!0)}isSourceLoaded(p){const t=this.style&&this.style.sourceCaches[p];if(t!==void 0)return t.loaded();this.fire(new h.j(new Error(`There is no source with ID '${p}'`)))}setTerrain(p){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),p){const t=this.style.sourceCaches[p.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${p.source}`);this.terrain===null&&t.reload();for(const n in this.style._layers){const l=this.style._layers[n];l.type==="hillshade"&&l.source===p.source&&h.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new js(this.painter,t,p),this.painter.renderToTexture=new ko(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=n=>{n.dataType==="style"?this.terrain.sourceCache.freeRtt():n.dataType==="source"&&n.tile&&(n.sourceId!==p.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(n.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new h.k("terrain",{terrain:p})),this}getTerrain(){var p,t;return(t=(p=this.terrain)===null||p===void 0?void 0:p.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const p=this.style&&this.style.sourceCaches;for(const t in p){const n=p[t]._tiles;for(const l in n){const c=n[l];if(c.state!=="loaded"&&c.state!=="errored")return!1}}return!0}removeSource(p){return this.style.removeSource(p),this._update(!0)}getSource(p){return this.style.getSource(p)}addImage(p,t,n={}){const{pixelRatio:l=1,sdf:c=!1,stretchX:f,stretchY:v,content:b}=n;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||h.b(t))){if(t.width===void 0||t.height===void 0)return this.fire(new h.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:A,height:I,data:M}=t,k=t;return this.style.addImage(p,{data:new h.R({width:A,height:I},new Uint8Array(M)),pixelRatio:l,stretchX:f,stretchY:v,content:b,sdf:c,version:0,userImage:k}),k.onAdd&&k.onAdd(this,p),this}}{const{width:A,height:I,data:M}=Q.getImageData(t);this.style.addImage(p,{data:new h.R({width:A,height:I},M),pixelRatio:l,stretchX:f,stretchY:v,content:b,sdf:c,version:0})}}updateImage(p,t){const n=this.style.getImage(p);if(!n)return this.fire(new h.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const l=t instanceof HTMLImageElement||h.b(t)?Q.getImageData(t):t,{width:c,height:f,data:v}=l;if(c===void 0||f===void 0)return this.fire(new h.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(c!==n.data.width||f!==n.data.height)return this.fire(new h.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const b=!(t instanceof HTMLImageElement||h.b(t));return n.data.replace(v,b),this.style.updateImage(p,n),this}getImage(p){return this.style.getImage(p)}hasImage(p){return p?!!this.style.getImage(p):(this.fire(new h.j(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(p)}loadImage(p){return gt.getImage(this._requestManager.transformRequest(p,xt.Image),new AbortController)}listImages(){return this.style.listImages()}addLayer(p,t){return this._lazyInitEmptyStyle(),this.style.addLayer(p,t),this._update(!0)}moveLayer(p,t){return this.style.moveLayer(p,t),this._update(!0)}removeLayer(p){return this.style.removeLayer(p),this._update(!0)}getLayer(p){return this.style.getLayer(p)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(p,t,n){return this.style.setLayerZoomRange(p,t,n),this._update(!0)}setFilter(p,t,n={}){return this.style.setFilter(p,t,n),this._update(!0)}getFilter(p){return this.style.getFilter(p)}setPaintProperty(p,t,n,l={}){return this.style.setPaintProperty(p,t,n,l),this._update(!0)}getPaintProperty(p,t){return this.style.getPaintProperty(p,t)}setLayoutProperty(p,t,n,l={}){return this.style.setLayoutProperty(p,t,n,l),this._update(!0)}getLayoutProperty(p,t){return this.style.getLayoutProperty(p,t)}setGlyphs(p,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(p,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(p,t,n={}){return this._lazyInitEmptyStyle(),this.style.addSprite(p,t,n,l=>{l||this._update(!0)}),this}removeSprite(p){return this._lazyInitEmptyStyle(),this.style.removeSprite(p),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(p,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(p,t,n=>{n||this._update(!0)}),this}setLight(p,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(p,t),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(p,t){return this.style.setFeatureState(p,t),this._update()}removeFeatureState(p,t){return this.style.removeFeatureState(p,t),this._update()}getFeatureState(p){return this.style.getFeatureState(p)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let p=0,t=0;return this._container&&(p=this._container.clientWidth||400,t=this._container.clientHeight||300),[p,t]}_setupContainer(){const p=this._container;p.classList.add("maplibregl-map");const t=this._canvasContainer=U.create("div","maplibregl-canvas-container",p);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=U.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const n=this._containerDimensions(),l=this._getClampedPixelRatio(n[0],n[1]);this._resizeCanvas(n[0],n[1],l);const c=this._controlContainer=U.create("div","maplibregl-control-container",p),f=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{f[v]=U.create("div",`maplibregl-ctrl-${v} `,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,t,n){this._canvas.width=Math.floor(n*p),this._canvas.height=Math.floor(n*t),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const p={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let t=null;this._canvas.addEventListener("webglcontextcreationerror",l=>{t={requestedAttributes:p},l&&(t.statusMessage=l.statusMessage,t.type=l.type)},{once:!0});const n=this._canvas.getContext("webgl2",p)||this._canvas.getContext("webgl",p);if(!n){const l="Failed to initialize WebGL";throw t?(t.message=l,new Error(JSON.stringify(t))):new Error(l)}this.painter=new rs(n,this.transform),ye.testSupport(n)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(p){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_render(p){const t=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(p),this._removed)return;let n=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const c=this.transform.zoom,f=Q.now();this.style.zoomHistory.update(c,f);const v=new h.a8(c,{now:f,fadeDuration:t,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),b=v.crossFadingFactor();b===1&&b===this._crossFadingFactor||(n=!0,this._crossFadingFactor=b),this.style.update(v)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,t,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:t,showPadding:this.showPadding}),this.fire(new h.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,h.bc.mark(h.bd.load),this.fire(new h.k("load"))),this.style&&(this.style.hasTransitions()||n)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const l=this._sourcesDirty||this._styleDirty||this._placementDirty;return l||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new h.k("idle")),!this._loaded||this._fullyLoaded||l||(this._fullyLoaded=!0,h.bc.mark(h.bd.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var p;this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),gt.removeThrottleControl(this._imageQueueHandle),(p=this._resizeObserver)===null||p===void 0||p.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),U.remove(this._canvasContainer),U.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),h.bc.clearMetrics(),this._removed=!0,this.fire(new h.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,Q.frameAsync(this._frameRequest).then(p=>{h.bc.frame(p),this._frameRequest=null,this._render(p)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}get version(){return qs}getCameraTargetElevation(){return this.transform.elevation}},x.MapMouseEvent=li,x.MapTouchEvent=ss,x.MapWheelEvent=ar,x.Marker=cs,x.NavigationControl=class{constructor(p){this._updateZoomButtons=()=>{const t=this._map.getZoom(),n=t===this._map.getMaxZoom(),l=t===this._map.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())},this._rotateCompassArrow=()=>{const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=t},this._setButtonTitle=(t,n)=>{const l=this._map._getUIString(`NavigationControl.${n}`);t.title=l,t.setAttribute("aria-label",l)},this.options=h.e({},zo,p),this._container=U.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),U.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),U.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=U.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Bo(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){U.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(p,t){const n=U.create("button",p,this._container);return n.type="button",n.addEventListener("click",t),n}},x.Popup=class extends h.E{constructor(p){super(),this.remove=()=>(this._content&&U.remove(this._content),this._container&&(U.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new h.k("close"))),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{var n;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=U.create("div","maplibregl-popup",this._map.getContainer()),this._tip=U.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const b of this.options.className.split(" "))this._container.classList.add(b);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Ia(this._lngLat,this._flatPos,this._map.transform):(n=this._lngLat)===null||n===void 0?void 0:n.wrap(),this._trackPointer&&!t)return;const l=this._flatPos=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&t?t:this._map.transform.locationPoint(this._lngLat));let c=this.options.anchor;const f=No(this.options.offset);if(!c){const b=this._container.offsetWidth,A=this._container.offsetHeight;let I;I=l.y+f.bottom.y<A?["top"]:l.y>this._map.transform.height-A?["bottom"]:[],l.x<b/2?I.push("left"):l.x>this._map.transform.width-b/2&&I.push("right"),c=I.length===0?"bottom":I.join("-")}let v=l.add(f[c]);this.options.subpixelPositioning||(v=v.round()),U.setTransform(this._container,`${Gs[c]} translate(${v.x}px,${v.y}px)`),Ca(this._container,c,"popup")},this._onClose=()=>{this.remove()},this.options=h.e(Object.create(Oo),p)}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new h.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(p){return this._lngLat=h.M.convert(p),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(document.createTextNode(p))}setHTML(p){const t=document.createDocumentFragment(),n=document.createElement("body");let l;for(n.innerHTML=p;l=n.firstChild,l;)t.appendChild(l);return this.setDOMContent(t)}getMaxWidth(){var p;return(p=this._container)===null||p===void 0?void 0:p.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=U.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(p),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(p){this._container&&this._container.classList.add(p)}removeClassName(p){this._container&&this._container.classList.remove(p)}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){if(this._container)return this._container.classList.toggle(p)}setSubpixelPositioning(p){this.options.subpixelPositioning=p}_createCloseButton(){this.options.closeButton&&(this._closeButton=U.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector($o);p&&p.focus()}},x.RasterDEMTileSource=Es,x.RasterTileSource=yn,x.ScaleControl=class{constructor(p){this._onMove=()=>{Pa(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,Pa(this._map,this._container,this.options)},this.options=h.e({},Fo,p)}getDefaultPosition(){return"bottom-left"}onAdd(p){return this._map=p,this._container=U.create("div","maplibregl-ctrl maplibregl-ctrl-scale",p.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){U.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},x.ScrollZoomHandler=Co,x.Style=ra,x.TerrainControl=class{constructor(p){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=p}onAdd(p){return this._map=p,this._container=U.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=U.create("button","maplibregl-ctrl-terrain",this._container),U.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){U.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},x.TwoFingersTouchPitchHandler=mc,x.TwoFingersTouchRotateHandler=Eo,x.TwoFingersTouchZoomHandler=wa,x.TwoFingersTouchZoomRotateHandler=je,x.VectorTileSource=fe,x.VideoSource=Vn,x.addSourceType=(p,t)=>h._(void 0,void 0,void 0,function*(){if(_n(p))throw new Error(`A source type called "${p}" already exists.`);((n,l)=>{qn[n]=l})(p,t)}),x.clearPrewarmedResources=function(){const p=Br;p&&(p.isPreloaded()&&p.numActive()===1?(p.release(fn),Br=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},x.getMaxParallelImageRequests=function(){return h.a.MAX_PARALLEL_IMAGE_REQUESTS},x.getRTLTextPluginStatus=function(){return qi().getRTLTextPluginStatus()},x.getVersion=function(){return vc},x.getWorkerCount=function(){return Sr.workerCount},x.getWorkerUrl=function(){return h.a.WORKER_URL},x.importScriptInWorkers=function(p){return Zr().broadcast("importScript",p)},x.prewarm=function(){ur().acquire(fn)},x.setMaxParallelImageRequests=function(p){h.a.MAX_PARALLEL_IMAGE_REQUESTS=p},x.setRTLTextPlugin=function(p,t){return qi().setRTLTextPlugin(p,t)},x.setWorkerCount=function(p){Sr.workerCount=p},x.setWorkerUrl=function(p){h.a.WORKER_URL=p}});var S=d;return S})})(gm);var f_=gm.exports;const bh=p_(f_),m_={id:"map"},g_={__name:"map",setup(s,{expose:o}){const d=dm(),y=d.public.AWS_LOCATION_SERVICE_KEY,T=d.public.MAP_NAME,S=d.public.AWS_REGION;let x;return l_(async()=>{x=new bh.Map({container:"map",center:[-100.3175,25.6856],zoom:14,attributionControl:!1,style:`https://maps.geo.${S}.amazonaws.com/maps/v0/maps/${T}/style-descriptor?key=${y}`}),x.addControl(new bh.NavigationControl),x.on("load",()=>{x.addSource("route_sample",{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[]}}}),x.addLayer({id:"route_sample",type:"line",source:"route_sample",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#FF0000","line-width":5,"line-opacity":.5}})})}),o({drawRoute:K=>{x.getSource("route_sample").setData({type:"Feature",properties:{},geometry:{type:"LineString",coordinates:K}});let O=K.reduce((ie,Q)=>ie.extend(Q),new bh.LngLatBounds(K[0],K[0]));x.fitBounds(O,{padding:20})}}),(K,O)=>(ad(),c_("div",m_))}},MS=o_(g_,[["__scopeId","data-v-5fb1963c"]]),y_={class:"flex justify-between m-0 text-3xl"},__=Gt("span",null,[Gt("i",{class:"pi pi-sun"}),Wa(" Dia: ")],-1),x_={class:"flex justify-between m-0 text-3xl"},v_=Gt("span",null,[Gt("i",{class:"pi pi-moon"}),Wa(" Noche: ")],-1),b_={__name:"infoPrice",props:{fareCost:Object},setup(s){return(o,d)=>{const y=mm;return ad(),pm(y,{header:"Costo",class:"mx-3 mb-4 text-xl text-left"},{default:fm(()=>[Gt("p",y_,[__,Gt("span",null,"$"+qa(s.fareCost.day),1)]),Gt("p",x_,[v_,Gt("span",null,"$"+qa(s.fareCost.night),1)])]),_:1})}}},kS=b_,w_=y=>{var y=parseInt(y,10),o=Math.floor(y/3600),d=Math.floor((y-o*3600)/60),y=y-o*3600-d*60;return o?d?`${o}h ${d}m ${y}s`:`${o}h ${y}s`:d?`${d}m ${y}s`:`${y}s`},S_={class:"flex justify-between m-0"},T_=Gt("span",{class:"basis-1/2"},[Gt("i",{class:"pi pi-map-marker"}),Wa(" Origen:")],-1),A_={class:"text-right basis-1/2"},E_={class:"flex justify-between m-0"},I_=Gt("span",{class:"basis-1/2"},[Gt("i",{class:"pi pi-flag-fill"}),Wa(" Destino:")],-1),C_={class:"text-right basis-1/2"},P_={class:"flex justify-between m-0"},M_=Gt("span",null,[Gt("i",{class:"pi pi-arrows-h"}),Wa(" Distancia:")],-1),k_={class:"flex justify-between m-0"},D_=Gt("span",null,[Gt("i",{class:"pi pi-hourglass"}),Wa(" Duracion:")],-1),R_={__name:"infoRide",props:{originAddress:String,destinationAddress:String,distance:Number,duration:Number},setup(s){return(o,d)=>{const y=mm;return ad(),pm(y,{header:"Info Viaje",class:"mx-3 text-lg text-left"},{default:fm(()=>[Gt("p",S_,[T_,Gt("span",A_,qa(s.originAddress),1)]),Gt("p",E_,[I_,Gt("span",C_,qa(s.destinationAddress),1)]),Gt("p",P_,[M_,Gt("span",null,qa(s.distance)+"km",1)]),Gt("p",k_,[D_,Gt("span",null,qa(u_(w_)(s.duration)),1)])]),_:1})}}},DS=R_;function z_(){return new Promise((s,o)=>{navigator.geolocation.getCurrentPosition(d=>s(d),d=>o(d))})}function RS(){const s=ja(!1);return{loading:s,getUserLocation:async()=>{if("geolocation"in navigator)try{s.value=!0;const d=await z_(),y=d.coords.latitude;return[d.coords.longitude,y]}catch{throw Error("Error al obtener tu ubicacion")}finally{s.value=!1}else throw Error("Ubicacion no disponible")}}}const B_=(s,o,d)=>{let y,T,S,x=!1;const h=async()=>{T||(T=s());try{y=await T,S=!0,x=!1}finally{T=void 0}return y};return o===void 0?async K=>((!S||K!=null&&K.forceRefresh)&&(y=await h()),y):async K=>((!S||K!=null&&K.forceRefresh)&&(y=await h()),x?y:d&&!d(y)?(x=!0,y):(o(y)&&await h(),y))},L_=s=>{let o=s.httpHandler;return{setHttpHandler(d){o=d},httpHandler(){return o},updateHttpClientConfig(d,y){o.updateHttpClientConfig(d,y)},httpHandlerConfigs(){return o.httpHandlerConfigs()}}},F_=s=>({httpHandler:s.httpHandler()});var Qp;(function(s){s.HEADER="header",s.QUERY="query"})(Qp||(Qp={}));var ef;(function(s){s.HEADER="header",s.QUERY="query"})(ef||(ef={}));var Tl;(function(s){s.HTTP="http",s.HTTPS="https"})(Tl||(Tl={}));var Xc;(function(s){s.MD5="md5",s.CRC32="crc32",s.CRC32C="crc32c",s.SHA1="sha1",s.SHA256="sha256"})(Xc||(Xc={}));var tf;(function(s){s[s.HEADER=0]="HEADER",s[s.TRAILER=1]="TRAILER"})(tf||(tf={}));const Nh="__smithy_context";var rf;(function(s){s.PROFILE="profile",s.SSO_SESSION="sso-session",s.SERVICES="services"})(rf||(rf={}));var nf;(function(s){s.HTTP_0_9="http/0.9",s.HTTP_1_0="http/1.0",s.TDS_8_0="tds/8.0"})(nf||(nf={}));class un{constructor(o){this.method=o.method||"GET",this.hostname=o.hostname||"localhost",this.port=o.port,this.query=o.query||{},this.headers=o.headers||{},this.body=o.body,this.protocol=o.protocol?o.protocol.slice(-1)!==":"?`${o.protocol}:`:o.protocol:"https:",this.path=o.path?o.path.charAt(0)!=="/"?`/${o.path}`:o.path:"/",this.username=o.username,this.password=o.password,this.fragment=o.fragment}static isInstance(o){if(!o)return!1;const d=o;return"method"in d&&"protocol"in d&&"hostname"in d&&"path"in d&&typeof d.query=="object"&&typeof d.headers=="object"}clone(){const o=new un({...this,headers:{...this.headers}});return o.query&&(o.query=O_(o.query)),o}}function O_(s){return Object.keys(s).reduce((o,d)=>{const y=s[d];return{...o,[d]:Array.isArray(y)?[...y]:y}},{})}class Yc{constructor(o){this.statusCode=o.statusCode,this.reason=o.reason,this.headers=o.headers||{},this.body=o.body}static isInstance(o){if(!o)return!1;const d=o;return typeof d.statusCode=="number"&&typeof d.headers=="object"}}function su(s){return/^[a-z0-9][a-z0-9\.\-]*[a-z0-9]$/.test(s)}const Js=s=>encodeURIComponent(s).replace(/[!'()*]/g,$_),$_=s=>`%${s.charCodeAt(0).toString(16).toUpperCase()}`;function N_(s){const o=[];for(let d of Object.keys(s).sort()){const y=s[d];if(d=Js(d),Array.isArray(y))for(let T=0,S=y.length;T<S;T++)o.push(`${d}=${Js(y[T])}`);else{let T=d;(y||typeof y=="string")&&(T+=`=${Js(y)}`),o.push(T)}}return o.join("&")}function U_(s=0){return new Promise((o,d)=>{s&&setTimeout(()=>{const y=new Error(`Request did not complete within ${s} ms`);y.name="TimeoutError",d(y)},s)})}const V_={supported:typeof Request<"u"&&"keepalive"in new Request("https://[::1]")};class od{static create(o){return typeof(o==null?void 0:o.handle)=="function"?o:new od(o)}constructor(o){typeof o=="function"?this.configProvider=o().then(d=>d||{}):(this.config=o??{},this.configProvider=Promise.resolve(this.config))}destroy(){}async handle(o,{abortSignal:d}={}){this.config||(this.config=await this.configProvider);const y=this.config.requestTimeout,T=this.config.keepAlive===!0;if(d!=null&&d.aborted){const Pe=new Error("Request aborted");return Pe.name="AbortError",Promise.reject(Pe)}let S=o.path;const x=N_(o.query||{});x&&(S+=`?${x}`),o.fragment&&(S+=`#${o.fragment}`);let h="";if(o.username!=null||o.password!=null){const Pe=o.username??"",qe=o.password??"";h=`${Pe}:${qe}@`}const{port:K,method:O}=o,ie=`${o.protocol}//${h}${o.hostname}${K?`:${K}`:""}${S}`,U={body:O==="GET"||O==="HEAD"?void 0:o.body,headers:new Headers(o.headers),method:O};typeof AbortController<"u"&&(U.signal=d),V_.supported&&(U.keepalive=T);const ye=new Request(ie,U),Te=[fetch(ye).then(Pe=>{const qe=Pe.headers,Ye={};for(const gt of qe.entries())Ye[gt[0]]=gt[1];return Pe.body!=null?{response:new Yc({headers:Ye,reason:Pe.statusText,statusCode:Pe.status,body:Pe.body})}:Pe.blob().then(gt=>({response:new Yc({headers:Ye,reason:Pe.statusText,statusCode:Pe.status,body:gt})}))}),U_(y)];return d&&Te.push(new Promise((Pe,qe)=>{d.onabort=()=>{const Ye=new Error("Request aborted");Ye.name="AbortError",qe(Ye)}})),Promise.race(Te)}updateHttpClientConfig(o,d){this.config=void 0,this.configProvider=this.configProvider.then(y=>(y[o]=d,y))}httpHandlerConfigs(){return this.config??{}}}const bs={},Ka=new Array(64);for(let s=0,o=65,d=90;s+o<=d;s++){const y=String.fromCharCode(s+o);bs[y]=s,Ka[s]=y}for(let s=0,o=97,d=122;s+o<=d;s++){const y=String.fromCharCode(s+o),T=s+26;bs[y]=T,Ka[T]=y}for(let s=0;s<10;s++){bs[s.toString(10)]=s+52;const o=s.toString(10),d=s+52;bs[o]=d,Ka[d]=o}bs["+"]=62;Ka[62]="+";bs["/"]=63;Ka[63]="/";const Ga=6,vl=8,j_=63,ld=s=>{let o=s.length/4*3;s.slice(-2)==="=="?o-=2:s.slice(-1)==="="&&o--;const d=new ArrayBuffer(o),y=new DataView(d);for(let T=0;T<s.length;T+=4){let S=0,x=0;for(let O=T,ie=T+3;O<=ie;O++)if(s[O]!=="="){if(!(s[O]in bs))throw new TypeError(`Invalid character ${s[O]} in base64 string.`);S|=bs[s[O]]<<(ie-O)*Ga,x+=Ga}else S>>=Ga;const h=T/4*3;S>>=x%vl;const K=Math.floor(x/vl);for(let O=0;O<K;O++){const ie=(K-O-1)*vl;y.setUint8(h+O,(S&255<<ie)>>ie)}}return new Uint8Array(d)},Rl=s=>new TextEncoder().encode(s),bl=s=>typeof s=="string"?Rl(s):ArrayBuffer.isView(s)?new Uint8Array(s.buffer,s.byteOffset,s.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(s),cd=s=>{if(typeof s=="string")return s;if(typeof s!="object"||typeof s.byteOffset!="number"||typeof s.byteLength!="number")throw new Error("@smithy/util-utf8: toUtf8 encoder function only accepts string | Uint8Array.");return new TextDecoder("utf-8").decode(s)};function _m(s){let o;typeof s=="string"?o=Rl(s):o=s;const d=typeof o=="object"&&typeof o.length=="number",y=typeof o=="object"&&typeof o.byteOffset=="number"&&typeof o.byteLength=="number";if(!d&&!y)throw new Error("@smithy/util-base64: toBase64 encoder function only accepts string | Uint8Array.");let T="";for(let S=0;S<o.length;S+=3){let x=0,h=0;for(let O=S,ie=Math.min(S+3,o.length);O<ie;O++)x|=o[O]<<(ie-O-1)*vl,h+=vl;const K=Math.ceil(h/Ga);x<<=K*Ga-h;for(let O=1;O<=K;O++){const ie=(K-O)*Ga;T+=Ka[(x&j_<<ie)>>ie]}T+="==".slice(0,4-K)}return T}const q_=s=>typeof Blob=="function"&&s instanceof Blob?G_(s):H_(s);async function G_(s){const o=await Z_(s),d=ld(o);return new Uint8Array(d)}async function H_(s){let o=new Uint8Array(0);const d=s.getReader();let y=!1;for(;!y;){const{done:T,value:S}=await d.read();if(S){const x=o;o=new Uint8Array(x.length+S.length),o.set(x),o.set(S,x.length)}y=T}return o}function Z_(s){return new Promise((o,d)=>{const y=new FileReader;y.onloadend=()=>{if(y.readyState!==2)return d(new Error("Reader aborted too early"));const T=y.result??"",S=T.indexOf(","),x=S>-1?S+1:T.length;o(T.substring(x))},y.onabort=()=>d(new Error("Read aborted")),y.onerror=()=>d(y.error),y.readAsDataURL(s)})}class xm{trace(){}debug(){}info(){}warn(){}error(){}}const Ys=(s,o)=>{const d=[];if(s&&d.push(s),o)for(const y of o)d.push(y);return d},_s=(s,o)=>`${s||"anonymous"}${o&&o.length>0?` (a.k.a. ${o.join(",")})`:""}`,Jc=()=>{let s=[],o=[],d=!1;const y=new Set,T=Q=>Q.sort((U,ye)=>sf[ye.step]-sf[U.step]||af[ye.priority||"normal"]-af[U.priority||"normal"]),S=Q=>{let U=!1;const ye=Te=>{const Pe=Ys(Te.name,Te.aliases);if(Pe.includes(Q)){U=!0;for(const qe of Pe)y.delete(qe);return!1}return!0};return s=s.filter(ye),o=o.filter(ye),U},x=Q=>{let U=!1;const ye=Te=>{if(Te.middleware===Q){U=!0;for(const Pe of Ys(Te.name,Te.aliases))y.delete(Pe);return!1}return!0};return s=s.filter(ye),o=o.filter(ye),U},h=Q=>{var U;return s.forEach(ye=>{Q.add(ye.middleware,{...ye})}),o.forEach(ye=>{Q.addRelativeTo(ye.middleware,{...ye})}),(U=Q.identifyOnResolve)==null||U.call(Q,ie.identifyOnResolve()),Q},K=Q=>{const U=[];return Q.before.forEach(ye=>{ye.before.length===0&&ye.after.length===0?U.push(ye):U.push(...K(ye))}),U.push(Q),Q.after.reverse().forEach(ye=>{ye.before.length===0&&ye.after.length===0?U.push(ye):U.push(...K(ye))}),U},O=(Q=!1)=>{const U=[],ye=[],Te={};return s.forEach(qe=>{const Ye={...qe,before:[],after:[]};for(const _t of Ys(Ye.name,Ye.aliases))Te[_t]=Ye;U.push(Ye)}),o.forEach(qe=>{const Ye={...qe,before:[],after:[]};for(const _t of Ys(Ye.name,Ye.aliases))Te[_t]=Ye;ye.push(Ye)}),ye.forEach(qe=>{if(qe.toMiddleware){const Ye=Te[qe.toMiddleware];if(Ye===void 0){if(Q)return;throw new Error(`${qe.toMiddleware} is not found when adding ${_s(qe.name,qe.aliases)} middleware ${qe.relation} ${qe.toMiddleware}`)}qe.relation==="after"&&Ye.after.push(qe),qe.relation==="before"&&Ye.before.push(qe)}}),T(U).map(K).reduce((qe,Ye)=>(qe.push(...Ye),qe),[])},ie={add:(Q,U={})=>{const{name:ye,override:Te,aliases:Pe}=U,qe={step:"initialize",priority:"normal",middleware:Q,...U},Ye=Ys(ye,Pe);if(Ye.length>0){if(Ye.some(_t=>y.has(_t))){if(!Te)throw new Error(`Duplicate middleware name '${_s(ye,Pe)}'`);for(const _t of Ye){const gt=s.findIndex(pi=>{var ji;return pi.name===_t||((ji=pi.aliases)==null?void 0:ji.some(fi=>fi===_t))});if(gt===-1)continue;const xt=s[gt];if(xt.step!==qe.step||qe.priority!==xt.priority)throw new Error(`"${_s(xt.name,xt.aliases)}" middleware with ${xt.priority} priority in ${xt.step} step cannot be overridden by "${_s(ye,Pe)}" middleware with ${qe.priority} priority in ${qe.step} step.`);s.splice(gt,1)}}for(const _t of Ye)y.add(_t)}s.push(qe)},addRelativeTo:(Q,U)=>{const{name:ye,override:Te,aliases:Pe}=U,qe={middleware:Q,...U},Ye=Ys(ye,Pe);if(Ye.length>0){if(Ye.some(_t=>y.has(_t))){if(!Te)throw new Error(`Duplicate middleware name '${_s(ye,Pe)}'`);for(const _t of Ye){const gt=o.findIndex(pi=>{var ji;return pi.name===_t||((ji=pi.aliases)==null?void 0:ji.some(fi=>fi===_t))});if(gt===-1)continue;const xt=o[gt];if(xt.toMiddleware!==qe.toMiddleware||xt.relation!==qe.relation)throw new Error(`"${_s(xt.name,xt.aliases)}" middleware ${xt.relation} "${xt.toMiddleware}" middleware cannot be overridden by "${_s(ye,Pe)}" middleware ${qe.relation} "${qe.toMiddleware}" middleware.`);o.splice(gt,1)}}for(const _t of Ye)y.add(_t)}o.push(qe)},clone:()=>h(Jc()),use:Q=>{Q.applyToStack(ie)},remove:Q=>typeof Q=="string"?S(Q):x(Q),removeByTag:Q=>{let U=!1;const ye=Te=>{const{tags:Pe,name:qe,aliases:Ye}=Te;if(Pe&&Pe.includes(Q)){const _t=Ys(qe,Ye);for(const gt of _t)y.delete(gt);return U=!0,!1}return!0};return s=s.filter(ye),o=o.filter(ye),U},concat:Q=>{var ye;const U=h(Jc());return U.use(Q),U.identifyOnResolve(d||U.identifyOnResolve()||(((ye=Q.identifyOnResolve)==null?void 0:ye.call(Q))??!1)),U},applyToStack:h,identify:()=>O(!0).map(Q=>{const U=Q.step??Q.relation+" "+Q.toMiddleware;return _s(Q.name,Q.aliases)+" - "+U}),identifyOnResolve(Q){return typeof Q=="boolean"&&(d=Q),d},resolve:(Q,U)=>{for(const ye of O().map(Te=>Te.middleware).reverse())Q=ye(Q,U);return d&&console.log(ie.identify()),Q}};return ie},sf={initialize:5,serialize:4,build:3,finalizeRequest:2,deserialize:1},af={high:3,normal:2,low:1};class W_{constructor(o){this.middlewareStack=Jc(),this.config=o}send(o,d,y){const T=typeof d!="function"?d:void 0,S=typeof d=="function"?d:y,x=o.resolveMiddleware(this.middlewareStack,this.config,T);if(S)x(o).then(h=>S(null,h.output),h=>S(h)).catch(()=>{});else return x(o).then(h=>h.output)}destroy(){this.config.requestHandler.destroy&&this.config.requestHandler.destroy()}}function K_(s,o="utf-8"){return o==="base64"?_m(s):cd(s)}function X_(s,o){return o==="base64"?Qs.mutate(ld(s)):Qs.mutate(Rl(s))}class Qs extends Uint8Array{static fromString(o,d="utf-8"){switch(typeof o){case"string":return X_(o,d);default:throw new Error(`Unsupported conversion from ${typeof o} to Uint8ArrayBlobAdapter.`)}}static mutate(o){return Object.setPrototypeOf(o,Qs.prototype),o}transformToString(o="utf-8"){return K_(this,o)}}const vm={},Uh={};for(let s=0;s<256;s++){let o=s.toString(16).toLowerCase();o.length===1&&(o=`0${o}`),vm[s]=o,Uh[o]=s}function Y_(s){if(s.length%2!==0)throw new Error("Hex encoded strings must have an even number length");const o=new Uint8Array(s.length/2);for(let d=0;d<s.length;d+=2){const y=s.slice(d,d+2).toLowerCase();if(y in Uh)o[d/2]=Uh[y];else throw new Error(`Cannot decode unrecognized sequence ${y} as hexadecimal`)}return o}function Rr(s){let o="";for(let d=0;d<s.byteLength;d++)o+=vm[s[d]];return o}const J_=async(s=new Uint8Array,o)=>{if(s instanceof Uint8Array)return Qs.mutate(s);if(!s)return Qs.mutate(new Uint8Array);const d=o.streamCollector(s);return Qs.mutate(await d)};class zl{constructor(){this.middlewareStack=Jc()}static classBuilder(){return new Q_}resolveMiddlewareWithContext(o,d,y,{middlewareFn:T,clientName:S,commandName:x,inputFilterSensitiveLog:h,outputFilterSensitiveLog:K,smithyContext:O,additionalContext:ie,CommandCtor:Q}){for(const qe of T.bind(this)(Q,o,d,y))this.middlewareStack.use(qe);const U=o.concat(this.middlewareStack),{logger:ye}=d,Te={logger:ye,clientName:S,commandName:x,inputFilterSensitiveLog:h,outputFilterSensitiveLog:K,[Nh]:{...O},...ie},{requestHandler:Pe}=d;return U.resolve(qe=>Pe.handle(qe.request,y||{}),Te)}}class Q_{constructor(){this._init=()=>{},this._ep={},this._middlewareFn=()=>[],this._commandName="",this._clientName="",this._additionalContext={},this._smithyContext={},this._inputFilterSensitiveLog=o=>o,this._outputFilterSensitiveLog=o=>o,this._serializer=null,this._deserializer=null}init(o){this._init=o}ep(o){return this._ep=o,this}m(o){return this._middlewareFn=o,this}s(o,d,y={}){return this._smithyContext={service:o,operation:d,...y},this}c(o={}){return this._additionalContext=o,this}n(o,d){return this._clientName=o,this._commandName=d,this}f(o=y=>y,d=y=>y){return this._inputFilterSensitiveLog=o,this._outputFilterSensitiveLog=d,this}ser(o){return this._serializer=o,this}de(o){return this._deserializer=o,this}build(){const o=this;let d;return d=class extends zl{static getEndpointParameterInstructions(){return o._ep}constructor(...[y]){super(),this.serialize=o._serializer,this.deserialize=o._deserializer,this.input=y??{},o._init(this)}resolveMiddleware(y,T,S){return this.resolveMiddlewareWithContext(y,T,S,{CommandCtor:d,middlewareFn:o._middlewareFn,clientName:o._clientName,commandName:o._commandName,inputFilterSensitiveLog:o._inputFilterSensitiveLog,outputFilterSensitiveLog:o._outputFilterSensitiveLog,smithyContext:o._smithyContext,additionalContext:o._additionalContext})}}}}const Bt="***SensitiveInformation***",e0=s=>{if(s!=null){if(typeof s=="number"){if((s===0||s===1)&&eu.warn(Qc(`Expected boolean, got ${typeof s}: ${s}`)),s===0)return!1;if(s===1)return!0}if(typeof s=="string"){const o=s.toLowerCase();if((o==="false"||o==="true")&&eu.warn(Qc(`Expected boolean, got ${typeof s}: ${s}`)),o==="false")return!1;if(o==="true")return!0}if(typeof s=="boolean")return s;throw new TypeError(`Expected boolean, got ${typeof s}: ${s}`)}},t0=s=>{if(s!=null){if(typeof s=="string"){const o=parseFloat(s);if(!Number.isNaN(o))return String(o)!==String(s)&&eu.warn(Qc(`Expected number but observed string: ${s}`)),o}if(typeof s=="number")return s;throw new TypeError(`Expected number, got ${typeof s}: ${s}`)}},i0=s=>{if(s!=null){if(Number.isInteger(s)&&!Number.isNaN(s))return s;throw new TypeError(`Expected integer, got ${typeof s}: ${s}`)}},ud=s=>r0(s,32),r0=(s,o)=>{const d=i0(s);if(d!==void 0&&n0(d,o)!==d)throw new TypeError(`Expected ${o}-bit integer, got ${s}`);return d},n0=(s,o)=>{switch(o){case 32:return Int32Array.of(s)[0];case 16:return Int16Array.of(s)[0];case 8:return Int8Array.of(s)[0]}},au=(s,o)=>{if(s==null)throw o?new TypeError(`Expected a non-null value for ${o}`):new TypeError("Expected a non-null value");return s},ou=s=>{if(s==null)return;if(typeof s=="object"&&!Array.isArray(s))return s;const o=Array.isArray(s)?"array":typeof s;throw new TypeError(`Expected object, got ${o}: ${s}`)},wt=s=>{if(s!=null){if(typeof s=="string")return s;if(["boolean","number","bigint"].includes(typeof s))return eu.warn(Qc(`Expected string, got ${typeof s}: ${s}`)),String(s);throw new TypeError(`Expected string, got ${typeof s}: ${s}`)}},cn=s=>typeof s=="string"?s0(s):t0(s),s0=s=>{switch(s){case"NaN":return NaN;case"Infinity":return 1/0;case"-Infinity":return-1/0;default:throw new Error(`Unable to parse float value: ${s}`)}},Qc=s=>String(new TypeError(s).stack||s).split(`
`).slice(0,5).filter(o=>!o.includes("stackTraceWarning")).join(`
`),eu={warn:console.warn};class hd extends Error{constructor(o){super(o.message),Object.setPrototypeOf(this,hd.prototype),this.name=o.name,this.$fault=o.$fault,this.$metadata=o.$metadata}}const Ts=(s,o={})=>{Object.entries(o).filter(([,y])=>y!==void 0).forEach(([y,T])=>{(s[y]==null||s[y]==="")&&(s[y]=T)});const d=s.message||s.Message||"UnknownError";return s.message=d,delete s.Message,s},a0=({output:s,parsedBody:o,exceptionCtor:d,errorCode:y})=>{const T=l0(s),S=T.httpStatusCode?T.httpStatusCode+"":void 0,x=new d({name:(o==null?void 0:o.code)||(o==null?void 0:o.Code)||y||S||"UnknownError",$fault:"client",$metadata:T});throw Ts(x,o)},o0=s=>({output:o,parsedBody:d,errorCode:y})=>{a0({output:o,parsedBody:d,exceptionCtor:s,errorCode:y})},l0=s=>({httpStatusCode:s.statusCode,requestId:s.headers["x-amzn-requestid"]??s.headers["x-amzn-request-id"]??s.headers["x-amz-request-id"],extendedRequestId:s.headers["x-amz-id-2"],cfId:s.headers["x-amz-cf-id"]}),c0=s=>{switch(s){case"standard":return{retryMode:"standard",connectionTimeout:3100};case"in-region":return{retryMode:"standard",connectionTimeout:1100};case"cross-region":return{retryMode:"standard",connectionTimeout:3100};case"mobile":return{retryMode:"standard",connectionTimeout:3e4};default:return{}}},u0=s=>{const o=[];for(const d in Xc){const y=Xc[d];s[y]!==void 0&&o.push({algorithmId:()=>y,checksumConstructor:()=>s[y]})}return{_checksumAlgorithms:o,addChecksumAlgorithm(d){this._checksumAlgorithms.push(d)},checksumAlgorithms(){return this._checksumAlgorithms}}},h0=s=>{const o={};return s.checksumAlgorithms().forEach(d=>{o[d.algorithmId()]=d.checksumConstructor()}),o},d0=s=>{let o=s.retryStrategy;return{setRetryStrategy(d){o=d},retryStrategy(){return o}}},p0=s=>{const o={};return o.retryStrategy=s.retryStrategy(),o},f0=s=>({...u0(s),...d0(s)}),m0=s=>({...h0(s),...p0(s)});function of(s){return encodeURIComponent(s).replace(/[!'()*]/g,function(o){return"%"+o.charCodeAt(0).toString(16).toUpperCase()})}const Vh=function(){const s=Object.getPrototypeOf(this).constructor,o=Function.bind.apply(String,[null,...arguments]),d=new o;return Object.setPrototypeOf(d,s.prototype),d};Vh.prototype=Object.create(String.prototype,{constructor:{value:Vh,enumerable:!1,writable:!0,configurable:!0}});Object.setPrototypeOf(Vh,String);function Vi(s,o,d){let y,T,S;if(typeof o>"u"&&typeof d>"u")y={},S=s;else{if(y=s,typeof o=="function")return T=o,S=d,g0(y,T,S);S=o}for(const x of Object.keys(S)){if(!Array.isArray(S[x])){y[x]=S[x];continue}bm(y,null,S,x)}return y}const Lt=(s,o)=>{const d={};for(const y in o)bm(d,s,o,y);return d},g0=(s,o,d)=>Vi(s,Object.entries(d).reduce((y,[T,S])=>(Array.isArray(S)?y[T]=S:typeof S=="function"?y[T]=[o,S()]:y[T]=[o,S],y),{})),bm=(s,o,d,y)=>{if(o!==null){let x=d[y];typeof x=="function"&&(x=[,x]);const[h=y0,K=_0,O=y]=x;(typeof h=="function"&&h(o[O])||typeof h!="function"&&h)&&(s[y]=K(o[O]));return}let[T,S]=d[y];if(typeof S=="function"){let x;const h=T===void 0&&(x=S())!=null,K=typeof T=="function"&&!!T(void 0)||typeof T!="function"&&!!T;h?s[y]=x:K&&(s[y]=S())}else{const x=T===void 0&&S!=null,h=typeof T=="function"&&!!T(S)||typeof T!="function"&&!!T;(x||h)&&(s[y]=S)}},y0=s=>s!=null,_0=s=>s,x0=(s,o,d,y,T,S)=>{if(o!=null&&o[d]!==void 0){const x=y();if(x.length<=0)throw new Error("Empty value provided for input HTTP label: "+d+".");s=s.replace(T,S?x.split("/").map(h=>of(h)).join("/"):of(x))}else throw new Error("No value provided for input HTTP label: "+d+".");return s},Ha=s=>{if(s!==s)return"NaN";switch(s){case 1/0:return"Infinity";case-1/0:return"-Infinity";default:return s}},ir=s=>{if(s==null)return{};if(Array.isArray(s))return s.filter(o=>o!=null).map(ir);if(typeof s=="object"){const o={};for(const d of Object.keys(s))s[d]!=null&&(o[d]=ir(s[d]));return o}return s},v0=s=>{const o=[];for(let d=0,y=s.length;d<y;d++){const T=s.charCodeAt(d);if(T<128)o.push(T);else if(T<2048)o.push(T>>6|192,T&63|128);else if(d+1<s.length&&(T&64512)===55296&&(s.charCodeAt(d+1)&64512)===56320){const S=65536+((T&1023)<<10)+(s.charCodeAt(++d)&1023);o.push(S>>18|240,S>>12&63|128,S>>6&63|128,S&63|128)}else o.push(T>>12|224,T>>6&63|128,T&63|128)}return Uint8Array.from(o)},b0=s=>{let o="";for(let d=0,y=s.length;d<y;d++){const T=s[d];if(T<128)o+=String.fromCharCode(T);else if(192<=T&&T<224){const S=s[++d];o+=String.fromCharCode((T&31)<<6|S&63)}else if(240<=T&&T<365){const x="%"+[T,s[++d],s[++d],s[++d]].map(h=>h.toString(16)).join("%");o+=decodeURIComponent(x)}else o+=String.fromCharCode((T&15)<<12|(s[++d]&63)<<6|s[++d]&63)}return o};function w0(s){return new TextEncoder().encode(s)}function S0(s){return new TextDecoder("utf-8").decode(s)}const T0=s=>typeof TextEncoder=="function"?w0(s):v0(s),A0=s=>typeof TextDecoder=="function"?S0(s):b0(s),E0=Object.freeze(Object.defineProperty({__proto__:null,fromUtf8:T0,toUtf8:A0},Symbol.toStringTag,{value:"Module"})),wm=ea(E0),I0={};function C0(){return typeof window<"u"?window:typeof self<"u"?self:I0}const P0=Object.freeze(Object.defineProperty({__proto__:null,locateWindow:C0},Symbol.toStringTag,{value:"Module"})),dd=ea(P0),M0={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},Sm={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},ai={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},tr={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},xs={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"};class Ae{static getFirstMatch(o,d){const y=d.match(o);return y&&y.length>0&&y[1]||""}static getSecondMatch(o,d){const y=d.match(o);return y&&y.length>1&&y[2]||""}static matchAndReturnConst(o,d,y){if(o.test(d))return y}static getWindowsVersionName(o){switch(o){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}}static getMacOSVersionName(o){const d=o.split(".").splice(0,2).map(y=>parseInt(y,10)||0);if(d.push(0),d[0]===10)switch(d[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}}static getAndroidVersionName(o){const d=o.split(".").splice(0,2).map(y=>parseInt(y,10)||0);if(d.push(0),!(d[0]===1&&d[1]<5)){if(d[0]===1&&d[1]<6)return"Cupcake";if(d[0]===1&&d[1]>=6)return"Donut";if(d[0]===2&&d[1]<2)return"Eclair";if(d[0]===2&&d[1]===2)return"Froyo";if(d[0]===2&&d[1]>2)return"Gingerbread";if(d[0]===3)return"Honeycomb";if(d[0]===4&&d[1]<1)return"Ice Cream Sandwich";if(d[0]===4&&d[1]<4)return"Jelly Bean";if(d[0]===4&&d[1]>=4)return"KitKat";if(d[0]===5)return"Lollipop";if(d[0]===6)return"Marshmallow";if(d[0]===7)return"Nougat";if(d[0]===8)return"Oreo";if(d[0]===9)return"Pie"}}static getVersionPrecision(o){return o.split(".").length}static compareVersions(o,d,y=!1){const T=Ae.getVersionPrecision(o),S=Ae.getVersionPrecision(d);let x=Math.max(T,S),h=0;const K=Ae.map([o,d],O=>{const ie=x-Ae.getVersionPrecision(O),Q=O+new Array(ie+1).join(".0");return Ae.map(Q.split("."),U=>new Array(20-U.length).join("0")+U).reverse()});for(y&&(h=x-Math.min(T,S)),x-=1;x>=h;){if(K[0][x]>K[1][x])return 1;if(K[0][x]===K[1][x]){if(x===h)return 0;x-=1}else if(K[0][x]<K[1][x])return-1}}static map(o,d){const y=[];let T;if(Array.prototype.map)return Array.prototype.map.call(o,d);for(T=0;T<o.length;T+=1)y.push(d(o[T]));return y}static find(o,d){let y,T;if(Array.prototype.find)return Array.prototype.find.call(o,d);for(y=0,T=o.length;y<T;y+=1){const S=o[y];if(d(S,y))return S}}static assign(o,...d){const y=o;let T,S;if(Object.assign)return Object.assign(o,...d);for(T=0,S=d.length;T<S;T+=1){const x=d[T];typeof x=="object"&&x!==null&&Object.keys(x).forEach(K=>{y[K]=x[K]})}return o}static getBrowserAlias(o){return M0[o]}static getBrowserTypeByAlias(o){return Sm[o]||""}}const zt=/version\/(\d+(\.?_?\d+)+)/i,k0=[{test:[/googlebot/i],describe(s){const o={name:"Googlebot"},d=Ae.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,s)||Ae.getFirstMatch(zt,s);return d&&(o.version=d),o}},{test:[/opera/i],describe(s){const o={name:"Opera"},d=Ae.getFirstMatch(zt,s)||Ae.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,s);return d&&(o.version=d),o}},{test:[/opr\/|opios/i],describe(s){const o={name:"Opera"},d=Ae.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,s)||Ae.getFirstMatch(zt,s);return d&&(o.version=d),o}},{test:[/SamsungBrowser/i],describe(s){const o={name:"Samsung Internet for Android"},d=Ae.getFirstMatch(zt,s)||Ae.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,s);return d&&(o.version=d),o}},{test:[/Whale/i],describe(s){const o={name:"NAVER Whale Browser"},d=Ae.getFirstMatch(zt,s)||Ae.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,s);return d&&(o.version=d),o}},{test:[/MZBrowser/i],describe(s){const o={name:"MZ Browser"},d=Ae.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,s)||Ae.getFirstMatch(zt,s);return d&&(o.version=d),o}},{test:[/focus/i],describe(s){const o={name:"Focus"},d=Ae.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,s)||Ae.getFirstMatch(zt,s);return d&&(o.version=d),o}},{test:[/swing/i],describe(s){const o={name:"Swing"},d=Ae.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,s)||Ae.getFirstMatch(zt,s);return d&&(o.version=d),o}},{test:[/coast/i],describe(s){const o={name:"Opera Coast"},d=Ae.getFirstMatch(zt,s)||Ae.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,s);return d&&(o.version=d),o}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe(s){const o={name:"Opera Touch"},d=Ae.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,s)||Ae.getFirstMatch(zt,s);return d&&(o.version=d),o}},{test:[/yabrowser/i],describe(s){const o={name:"Yandex Browser"},d=Ae.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,s)||Ae.getFirstMatch(zt,s);return d&&(o.version=d),o}},{test:[/ucbrowser/i],describe(s){const o={name:"UC Browser"},d=Ae.getFirstMatch(zt,s)||Ae.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,s);return d&&(o.version=d),o}},{test:[/Maxthon|mxios/i],describe(s){const o={name:"Maxthon"},d=Ae.getFirstMatch(zt,s)||Ae.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,s);return d&&(o.version=d),o}},{test:[/epiphany/i],describe(s){const o={name:"Epiphany"},d=Ae.getFirstMatch(zt,s)||Ae.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,s);return d&&(o.version=d),o}},{test:[/puffin/i],describe(s){const o={name:"Puffin"},d=Ae.getFirstMatch(zt,s)||Ae.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,s);return d&&(o.version=d),o}},{test:[/sleipnir/i],describe(s){const o={name:"Sleipnir"},d=Ae.getFirstMatch(zt,s)||Ae.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,s);return d&&(o.version=d),o}},{test:[/k-meleon/i],describe(s){const o={name:"K-Meleon"},d=Ae.getFirstMatch(zt,s)||Ae.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,s);return d&&(o.version=d),o}},{test:[/micromessenger/i],describe(s){const o={name:"WeChat"},d=Ae.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,s)||Ae.getFirstMatch(zt,s);return d&&(o.version=d),o}},{test:[/qqbrowser/i],describe(s){const o={name:/qqbrowserlite/i.test(s)?"QQ Browser Lite":"QQ Browser"},d=Ae.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,s)||Ae.getFirstMatch(zt,s);return d&&(o.version=d),o}},{test:[/msie|trident/i],describe(s){const o={name:"Internet Explorer"},d=Ae.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,s);return d&&(o.version=d),o}},{test:[/\sedg\//i],describe(s){const o={name:"Microsoft Edge"},d=Ae.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,s);return d&&(o.version=d),o}},{test:[/edg([ea]|ios)/i],describe(s){const o={name:"Microsoft Edge"},d=Ae.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,s);return d&&(o.version=d),o}},{test:[/vivaldi/i],describe(s){const o={name:"Vivaldi"},d=Ae.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,s);return d&&(o.version=d),o}},{test:[/seamonkey/i],describe(s){const o={name:"SeaMonkey"},d=Ae.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,s);return d&&(o.version=d),o}},{test:[/sailfish/i],describe(s){const o={name:"Sailfish"},d=Ae.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,s);return d&&(o.version=d),o}},{test:[/silk/i],describe(s){const o={name:"Amazon Silk"},d=Ae.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,s);return d&&(o.version=d),o}},{test:[/phantom/i],describe(s){const o={name:"PhantomJS"},d=Ae.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,s);return d&&(o.version=d),o}},{test:[/slimerjs/i],describe(s){const o={name:"SlimerJS"},d=Ae.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,s);return d&&(o.version=d),o}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe(s){const o={name:"BlackBerry"},d=Ae.getFirstMatch(zt,s)||Ae.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,s);return d&&(o.version=d),o}},{test:[/(web|hpw)[o0]s/i],describe(s){const o={name:"WebOS Browser"},d=Ae.getFirstMatch(zt,s)||Ae.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,s);return d&&(o.version=d),o}},{test:[/bada/i],describe(s){const o={name:"Bada"},d=Ae.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,s);return d&&(o.version=d),o}},{test:[/tizen/i],describe(s){const o={name:"Tizen"},d=Ae.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,s)||Ae.getFirstMatch(zt,s);return d&&(o.version=d),o}},{test:[/qupzilla/i],describe(s){const o={name:"QupZilla"},d=Ae.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,s)||Ae.getFirstMatch(zt,s);return d&&(o.version=d),o}},{test:[/firefox|iceweasel|fxios/i],describe(s){const o={name:"Firefox"},d=Ae.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,s);return d&&(o.version=d),o}},{test:[/electron/i],describe(s){const o={name:"Electron"},d=Ae.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,s);return d&&(o.version=d),o}},{test:[/MiuiBrowser/i],describe(s){const o={name:"Miui"},d=Ae.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,s);return d&&(o.version=d),o}},{test:[/chromium/i],describe(s){const o={name:"Chromium"},d=Ae.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,s)||Ae.getFirstMatch(zt,s);return d&&(o.version=d),o}},{test:[/chrome|crios|crmo/i],describe(s){const o={name:"Chrome"},d=Ae.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,s);return d&&(o.version=d),o}},{test:[/GSA/i],describe(s){const o={name:"Google Search"},d=Ae.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,s);return d&&(o.version=d),o}},{test(s){const o=!s.test(/like android/i),d=s.test(/android/i);return o&&d},describe(s){const o={name:"Android Browser"},d=Ae.getFirstMatch(zt,s);return d&&(o.version=d),o}},{test:[/playstation 4/i],describe(s){const o={name:"PlayStation 4"},d=Ae.getFirstMatch(zt,s);return d&&(o.version=d),o}},{test:[/safari|applewebkit/i],describe(s){const o={name:"Safari"},d=Ae.getFirstMatch(zt,s);return d&&(o.version=d),o}},{test:[/.*/i],describe(s){const o=/^(.*)\/(.*) /,d=/^(.*)\/(.*)[ \t]\((.*)/,T=s.search("\\(")!==-1?d:o;return{name:Ae.getFirstMatch(T,s),version:Ae.getSecondMatch(T,s)}}}],D0=[{test:[/Roku\/DVP/],describe(s){const o=Ae.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,s);return{name:tr.Roku,version:o}}},{test:[/windows phone/i],describe(s){const o=Ae.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,s);return{name:tr.WindowsPhone,version:o}}},{test:[/windows /i],describe(s){const o=Ae.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,s),d=Ae.getWindowsVersionName(o);return{name:tr.Windows,version:o,versionName:d}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe(s){const o={name:tr.iOS},d=Ae.getSecondMatch(/(Version\/)(\d[\d.]+)/,s);return d&&(o.version=d),o}},{test:[/macintosh/i],describe(s){const o=Ae.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,s).replace(/[_\s]/g,"."),d=Ae.getMacOSVersionName(o),y={name:tr.MacOS,version:o};return d&&(y.versionName=d),y}},{test:[/(ipod|iphone|ipad)/i],describe(s){const o=Ae.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,s).replace(/[_\s]/g,".");return{name:tr.iOS,version:o}}},{test(s){const o=!s.test(/like android/i),d=s.test(/android/i);return o&&d},describe(s){const o=Ae.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,s),d=Ae.getAndroidVersionName(o),y={name:tr.Android,version:o};return d&&(y.versionName=d),y}},{test:[/(web|hpw)[o0]s/i],describe(s){const o=Ae.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,s),d={name:tr.WebOS};return o&&o.length&&(d.version=o),d}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe(s){const o=Ae.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,s)||Ae.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,s)||Ae.getFirstMatch(/\bbb(\d+)/i,s);return{name:tr.BlackBerry,version:o}}},{test:[/bada/i],describe(s){const o=Ae.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,s);return{name:tr.Bada,version:o}}},{test:[/tizen/i],describe(s){const o=Ae.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,s);return{name:tr.Tizen,version:o}}},{test:[/linux/i],describe(){return{name:tr.Linux}}},{test:[/CrOS/],describe(){return{name:tr.ChromeOS}}},{test:[/PlayStation 4/],describe(s){const o=Ae.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,s);return{name:tr.PlayStation4,version:o}}}],R0=[{test:[/googlebot/i],describe(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe(s){const o=Ae.getFirstMatch(/(can-l01)/i,s)&&"Nova",d={type:ai.mobile,vendor:"Huawei"};return o&&(d.model=o),d}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe(){return{type:ai.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe(){return{type:ai.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe(){return{type:ai.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe(){return{type:ai.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe(){return{type:ai.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe(){return{type:ai.tablet}}},{test(s){const o=s.test(/ipod|iphone/i),d=s.test(/like (ipod|iphone)/i);return o&&!d},describe(s){const o=Ae.getFirstMatch(/(ipod|iphone)/i,s);return{type:ai.mobile,vendor:"Apple",model:o}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe(){return{type:ai.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe(){return{type:ai.mobile}}},{test(s){return s.getBrowserName(!0)==="blackberry"},describe(){return{type:ai.mobile,vendor:"BlackBerry"}}},{test(s){return s.getBrowserName(!0)==="bada"},describe(){return{type:ai.mobile}}},{test(s){return s.getBrowserName()==="windows phone"},describe(){return{type:ai.mobile,vendor:"Microsoft"}}},{test(s){const o=Number(String(s.getOSVersion()).split(".")[0]);return s.getOSName(!0)==="android"&&o>=3},describe(){return{type:ai.tablet}}},{test(s){return s.getOSName(!0)==="android"},describe(){return{type:ai.mobile}}},{test(s){return s.getOSName(!0)==="macos"},describe(){return{type:ai.desktop,vendor:"Apple"}}},{test(s){return s.getOSName(!0)==="windows"},describe(){return{type:ai.desktop}}},{test(s){return s.getOSName(!0)==="linux"},describe(){return{type:ai.desktop}}},{test(s){return s.getOSName(!0)==="playstation 4"},describe(){return{type:ai.tv}}},{test(s){return s.getOSName(!0)==="roku"},describe(){return{type:ai.tv}}}],z0=[{test(s){return s.getBrowserName(!0)==="microsoft edge"},describe(s){if(/\sedg\//i.test(s))return{name:xs.Blink};const d=Ae.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,s);return{name:xs.EdgeHTML,version:d}}},{test:[/trident/i],describe(s){const o={name:xs.Trident},d=Ae.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,s);return d&&(o.version=d),o}},{test(s){return s.test(/presto/i)},describe(s){const o={name:xs.Presto},d=Ae.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,s);return d&&(o.version=d),o}},{test(s){const o=s.test(/gecko/i),d=s.test(/like gecko/i);return o&&!d},describe(s){const o={name:xs.Gecko},d=Ae.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,s);return d&&(o.version=d),o}},{test:[/(apple)?webkit\/537\.36/i],describe(){return{name:xs.Blink}}},{test:[/(apple)?webkit/i],describe(s){const o={name:xs.WebKit},d=Ae.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,s);return d&&(o.version=d),o}}];class lf{constructor(o,d=!1){if(o==null||o==="")throw new Error("UserAgent parameter can't be empty");this._ua=o,this.parsedResult={},d!==!0&&this.parse()}getUA(){return this._ua}test(o){return o.test(this._ua)}parseBrowser(){this.parsedResult.browser={};const o=Ae.find(k0,d=>{if(typeof d.test=="function")return d.test(this);if(d.test instanceof Array)return d.test.some(y=>this.test(y));throw new Error("Browser's test function is not valid")});return o&&(this.parsedResult.browser=o.describe(this.getUA())),this.parsedResult.browser}getBrowser(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()}getBrowserName(o){return o?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""}getBrowserVersion(){return this.getBrowser().version}getOS(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()}parseOS(){this.parsedResult.os={};const o=Ae.find(D0,d=>{if(typeof d.test=="function")return d.test(this);if(d.test instanceof Array)return d.test.some(y=>this.test(y));throw new Error("Browser's test function is not valid")});return o&&(this.parsedResult.os=o.describe(this.getUA())),this.parsedResult.os}getOSName(o){const{name:d}=this.getOS();return o?String(d).toLowerCase()||"":d||""}getOSVersion(){return this.getOS().version}getPlatform(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()}getPlatformType(o=!1){const{type:d}=this.getPlatform();return o?String(d).toLowerCase()||"":d||""}parsePlatform(){this.parsedResult.platform={};const o=Ae.find(R0,d=>{if(typeof d.test=="function")return d.test(this);if(d.test instanceof Array)return d.test.some(y=>this.test(y));throw new Error("Browser's test function is not valid")});return o&&(this.parsedResult.platform=o.describe(this.getUA())),this.parsedResult.platform}getEngine(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()}getEngineName(o){return o?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""}parseEngine(){this.parsedResult.engine={};const o=Ae.find(z0,d=>{if(typeof d.test=="function")return d.test(this);if(d.test instanceof Array)return d.test.some(y=>this.test(y));throw new Error("Browser's test function is not valid")});return o&&(this.parsedResult.engine=o.describe(this.getUA())),this.parsedResult.engine}parse(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this}getResult(){return Ae.assign({},this.parsedResult)}satisfies(o){const d={};let y=0;const T={};let S=0;if(Object.keys(o).forEach(h=>{const K=o[h];typeof K=="string"?(T[h]=K,S+=1):typeof K=="object"&&(d[h]=K,y+=1)}),y>0){const h=Object.keys(d),K=Ae.find(h,ie=>this.isOS(ie));if(K){const ie=this.satisfies(d[K]);if(ie!==void 0)return ie}const O=Ae.find(h,ie=>this.isPlatform(ie));if(O){const ie=this.satisfies(d[O]);if(ie!==void 0)return ie}}if(S>0){const h=Object.keys(T),K=Ae.find(h,O=>this.isBrowser(O,!0));if(K!==void 0)return this.compareVersion(T[K])}}isBrowser(o,d=!1){const y=this.getBrowserName().toLowerCase();let T=o.toLowerCase();const S=Ae.getBrowserTypeByAlias(T);return d&&S&&(T=S.toLowerCase()),T===y}compareVersion(o){let d=[0],y=o,T=!1;const S=this.getBrowserVersion();if(typeof S=="string")return o[0]===">"||o[0]==="<"?(y=o.substr(1),o[1]==="="?(T=!0,y=o.substr(2)):d=[],o[0]===">"?d.push(1):d.push(-1)):o[0]==="="?y=o.substr(1):o[0]==="~"&&(T=!0,y=o.substr(1)),d.indexOf(Ae.compareVersions(S,y,T))>-1}isOS(o){return this.getOSName(!0)===String(o).toLowerCase()}isPlatform(o){return this.getPlatformType(!0)===String(o).toLowerCase()}isEngine(o){return this.getEngineName(!0)===String(o).toLowerCase()}is(o,d=!1){return this.isBrowser(o,d)||this.isOS(o)||this.isPlatform(o)}some(o=[]){return o.some(d=>this.is(d))}}/*!
 * Bowser - a browser detector
 * https://github.com/lancedikson/bowser
 * MIT License | (c) Dustin Diaz 2012-2015
 * MIT License | (c) Denis Demchenko 2015-2019
 */class Tm{static getParser(o,d=!1){if(typeof o!="string")throw new Error("UserAgent should be a string");return new lf(o,d)}static parse(o){return new lf(o).getResult()}static get BROWSER_MAP(){return Sm}static get ENGINE_MAP(){return xs}static get OS_MAP(){return tr}static get PLATFORMS_MAP(){return ai}}async function B0(s){return{getLocationClientConfig:()=>({signer:{sign:async o=>{var d;return o.query=Object.assign({key:s},(d=o.query)!==null&&d!==void 0?d:{}),o}},credentials:async()=>({})})}}const L0=s=>o=>async d=>{if(!un.isInstance(d.request))return o(d);const{request:y}=d,{handlerProtocol:T=""}=s.requestHandler.metadata||{};if(T.indexOf("h2")>=0&&!y.headers[":authority"])delete y.headers.host,y.headers[":authority"]=y.hostname+(y.port?":"+y.port:"");else if(!y.headers.host){let S=y.hostname;y.port!=null&&(S+=`:${y.port}`),y.headers.host=S}return o(d)},F0={name:"hostHeaderMiddleware",step:"build",priority:"low",tags:["HOST"],override:!0},O0=s=>({applyToStack:o=>{o.add(L0(s),F0)}}),$0=()=>(s,o)=>async d=>{var y,T;try{const S=await s(d),{clientName:x,commandName:h,logger:K,dynamoDbDocumentClientOptions:O={}}=o,{overrideInputFilterSensitiveLog:ie,overrideOutputFilterSensitiveLog:Q}=O,U=ie??o.inputFilterSensitiveLog,ye=Q??o.outputFilterSensitiveLog,{$metadata:Te,...Pe}=S.output;return(y=K==null?void 0:K.info)==null||y.call(K,{clientName:x,commandName:h,input:U(d.input),output:ye(Pe),metadata:Te}),S}catch(S){const{clientName:x,commandName:h,logger:K,dynamoDbDocumentClientOptions:O={}}=o,{overrideInputFilterSensitiveLog:ie}=O,Q=ie??o.inputFilterSensitiveLog;throw(T=K==null?void 0:K.error)==null||T.call(K,{clientName:x,commandName:h,input:Q(d.input),error:S,metadata:S.$metadata}),S}},N0={name:"loggerMiddleware",tags:["LOGGER"],step:"initialize",override:!0},U0=s=>({applyToStack:o=>{o.add($0(),N0)}});var cf={};const uf="X-Amzn-Trace-Id",V0="AWS_LAMBDA_FUNCTION_NAME",j0="_X_AMZN_TRACE_ID",q0=s=>o=>async d=>{const{request:y}=d;if(!un.isInstance(y)||s.runtime!=="node"||y.headers.hasOwnProperty(uf))return o(d);const T=cf[V0],S=cf[j0],x=h=>typeof h=="string"&&h.length>0;return x(T)&&x(S)&&(y.headers[uf]=S),o({...d,request:y})},G0={step:"build",tags:["RECURSION_DETECTION"],name:"recursionDetectionMiddleware",override:!0,priority:"low"},H0=s=>({applyToStack:o=>{o.add(q0(s),G0)}});function Z0(s){return{...s,customUserAgent:typeof s.customUserAgent=="string"?[[s.customUserAgent]]:s.customUserAgent}}const W0=new RegExp("^(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}$"),Am=s=>W0.test(s)||s.startsWith("[")&&s.endsWith("]"),K0=new RegExp("^(?!.*-$)(?!-)[a-zA-Z0-9-]{1,63}$"),pd=(s,o=!1)=>{if(!o)return K0.test(s);const d=s.split(".");for(const y of d)if(!pd(y))return!1;return!0},tu={},Al="endpoints";function ws(s){return typeof s!="object"||s==null?s:"ref"in s?`$${ws(s.ref)}`:"fn"in s?`${s.fn}(${(s.argv||[]).map(ws).join(", ")})`:JSON.stringify(s,null,2)}class br extends Error{constructor(o){super(o),this.name="EndpointError"}}const X0=(s,o)=>s===o,Y0=s=>{const o=s.split("."),d=[];for(const y of o){const T=y.indexOf("[");if(T!==-1){if(y.indexOf("]")!==y.length-1)throw new br(`Path: '${s}' does not end with ']'`);const S=y.slice(T+1,-1);if(Number.isNaN(parseInt(S)))throw new br(`Invalid array index: '${S}' in path: '${s}'`);T!==0&&d.push(y.slice(0,T)),d.push(S)}else d.push(y)}return d},Em=(s,o)=>Y0(o).reduce((d,y)=>{if(typeof d!="object")throw new br(`Index '${y}' in '${o}' not found in '${JSON.stringify(s)}'`);return Array.isArray(d)?d[parseInt(y)]:d[y]},s),J0=s=>s!=null,Q0=s=>!s,wh={[Tl.HTTP]:80,[Tl.HTTPS]:443},ex=s=>{const o=(()=>{try{if(s instanceof URL)return s;if(typeof s=="object"&&"hostname"in s){const{hostname:U,port:ye,protocol:Te="",path:Pe="",query:qe={}}=s,Ye=new URL(`${Te}//${U}${ye?`:${ye}`:""}${Pe}`);return Ye.search=Object.entries(qe).map(([_t,gt])=>`${_t}=${gt}`).join("&"),Ye}return new URL(s)}catch{return null}})();if(!o)return console.error(`Unable to parse ${JSON.stringify(s)} as a whatwg URL.`),null;const d=o.href,{host:y,hostname:T,pathname:S,protocol:x,search:h}=o;if(h)return null;const K=x.slice(0,-1);if(!Object.values(Tl).includes(K))return null;const O=Am(T),ie=d.includes(`${y}:${wh[K]}`)||typeof s=="string"&&s.includes(`${y}:${wh[K]}`),Q=`${y}${ie?`:${wh[K]}`:""}`;return{scheme:K,authority:Q,path:S,normalizedPath:S.endsWith("/")?S:`${S}/`,isIp:O}},tx=(s,o)=>s===o,ix=(s,o,d,y)=>o>=d||s.length<d?null:y?s.substring(s.length-d,s.length-o):s.substring(o,d),rx=s=>encodeURIComponent(s).replace(/[!*'()]/g,o=>`%${o.charCodeAt(0).toString(16).toUpperCase()}`),nx={booleanEquals:X0,getAttr:Em,isSet:J0,isValidHostLabel:pd,not:Q0,parseURL:ex,stringEquals:tx,substring:ix,uriEncode:rx},Im=(s,o)=>{const d=[],y={...o.endpointParams,...o.referenceRecord};let T=0;for(;T<s.length;){const S=s.indexOf("{",T);if(S===-1){d.push(s.slice(T));break}d.push(s.slice(T,S));const x=s.indexOf("}",S);if(x===-1){d.push(s.slice(S));break}s[S+1]==="{"&&s[x+1]==="}"&&(d.push(s.slice(S+1,x)),T=x+2);const h=s.substring(S+1,x);if(h.includes("#")){const[K,O]=h.split("#");d.push(Em(y[K],O))}else d.push(y[h]);T=x+1}return d.join("")},sx=({ref:s},o)=>({...o.endpointParams,...o.referenceRecord})[s],lu=(s,o,d)=>{if(typeof s=="string")return Im(s,d);if(s.fn)return Cm(s,d);if(s.ref)return sx(s,d);throw new br(`'${o}': ${String(s)} is not a string, function or reference.`)},Cm=({fn:s,argv:o},d)=>{const y=o.map(S=>["boolean","number"].includes(typeof S)?S:lu(S,"arg",d)),T=s.split(".");return T[0]in tu&&T[1]!=null?tu[T[0]][T[1]](...y):nx[s](...y)},ax=({assign:s,...o},d)=>{var T,S;if(s&&s in d.referenceRecord)throw new br(`'${s}' is already defined in Reference Record.`);const y=Cm(o,d);return(S=(T=d.logger)==null?void 0:T.debug)==null||S.call(T,Al,`evaluateCondition: ${ws(o)} = ${ws(y)}`),{result:y===""?!0:!!y,...s!=null&&{toAssign:{name:s,value:y}}}},fd=(s=[],o)=>{var y,T;const d={};for(const S of s){const{result:x,toAssign:h}=ax(S,{...o,referenceRecord:{...o.referenceRecord,...d}});if(!x)return{result:x};h&&(d[h.name]=h.value,(T=(y=o.logger)==null?void 0:y.debug)==null||T.call(y,Al,`assign: ${h.name} := ${ws(h.value)}`))}return{result:!0,referenceRecord:d}},ox=(s,o)=>Object.entries(s).reduce((d,[y,T])=>({...d,[y]:T.map(S=>{const x=lu(S,"Header value entry",o);if(typeof x!="string")throw new br(`Header '${y}' value '${x}' is not a string`);return x})}),{}),Pm=(s,o)=>{if(Array.isArray(s))return s.map(d=>Pm(d,o));switch(typeof s){case"string":return Im(s,o);case"object":if(s===null)throw new br(`Unexpected endpoint property: ${s}`);return Mm(s,o);case"boolean":return s;default:throw new br(`Unexpected endpoint property type: ${typeof s}`)}},Mm=(s,o)=>Object.entries(s).reduce((d,[y,T])=>({...d,[y]:Pm(T,o)}),{}),lx=(s,o)=>{const d=lu(s,"Endpoint URL",o);if(typeof d=="string")try{return new URL(d)}catch(y){throw console.error(`Failed to construct URL with ${d}`,y),y}throw new br(`Endpoint URL must be a string, got ${typeof d}`)},cx=(s,o)=>{var ie,Q;const{conditions:d,endpoint:y}=s,{result:T,referenceRecord:S}=fd(d,o);if(!T)return;const x={...o,referenceRecord:{...o.referenceRecord,...S}},{url:h,properties:K,headers:O}=y;return(Q=(ie=o.logger)==null?void 0:ie.debug)==null||Q.call(ie,Al,`Resolving endpoint from template: ${ws(y)}`),{...O!=null&&{headers:ox(O,x)},...K!=null&&{properties:Mm(K,x)},url:lx(h,x)}},ux=(s,o)=>{const{conditions:d,error:y}=s,{result:T,referenceRecord:S}=fd(d,o);if(T)throw new br(lu(y,"Error",{...o,referenceRecord:{...o.referenceRecord,...S}}))},hx=(s,o)=>{const{conditions:d,rules:y}=s,{result:T,referenceRecord:S}=fd(d,o);if(T)return km(y,{...o,referenceRecord:{...o.referenceRecord,...S}})},km=(s,o)=>{for(const d of s)if(d.type==="endpoint"){const y=cx(d,o);if(y)return y}else if(d.type==="error")ux(d,o);else if(d.type==="tree"){const y=hx(d,o);if(y)return y}else throw new br(`Unknown endpoint rule: ${d}`);throw new br("Rules evaluation failed")},dx=(s,o)=>{var O,ie,Q,U,ye;const{endpointParams:d,logger:y}=o,{parameters:T,rules:S}=s;(ie=(O=o.logger)==null?void 0:O.debug)==null||ie.call(O,`${Al} Initial EndpointParams: ${ws(d)}`);const x=Object.entries(T).filter(([,Te])=>Te.default!=null).map(([Te,Pe])=>[Te,Pe.default]);if(x.length>0)for(const[Te,Pe]of x)d[Te]=d[Te]??Pe;const h=Object.entries(T).filter(([,Te])=>Te.required).map(([Te])=>Te);for(const Te of h)if(d[Te]==null)throw new br(`Missing required parameter: '${Te}'`);const K=km(S,{endpointParams:d,logger:y,referenceRecord:{}});if((Q=o.endpointParams)!=null&&Q.Endpoint)try{const Te=new URL(o.endpointParams.Endpoint),{protocol:Pe,port:qe}=Te;K.url.protocol=Pe,K.url.port=qe}catch{}return(ye=(U=o.logger)==null?void 0:U.debug)==null||ye.call(U,`${Al} Resolved endpoint: ${ws(K)}`),K},Dm=(s,o=!1)=>{if(o){for(const d of s.split("."))if(!Dm(d))return!1;return!0}return!(!pd(s)||s.length<3||s.length>63||s!==s.toLowerCase()||Am(s))},px=s=>{const o=s.split(":");if(o.length<6)return null;const[d,y,T,S,x,...h]=o;return d!=="arn"||y===""||T===""||h[0]===""?null:{partition:y,service:T,region:S,accountId:x,resourceId:h[0].includes("/")?h[0].split("/"):h}},fx=[{id:"aws",outputs:{dnsSuffix:"amazonaws.com",dualStackDnsSuffix:"api.aws",implicitGlobalRegion:"us-east-1",name:"aws",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^(us|eu|ap|sa|ca|me|af|il)\\-\\w+\\-\\d+$",regions:{"af-south-1":{description:"Africa (Cape Town)"},"ap-east-1":{description:"Asia Pacific (Hong Kong)"},"ap-northeast-1":{description:"Asia Pacific (Tokyo)"},"ap-northeast-2":{description:"Asia Pacific (Seoul)"},"ap-northeast-3":{description:"Asia Pacific (Osaka)"},"ap-south-1":{description:"Asia Pacific (Mumbai)"},"ap-south-2":{description:"Asia Pacific (Hyderabad)"},"ap-southeast-1":{description:"Asia Pacific (Singapore)"},"ap-southeast-2":{description:"Asia Pacific (Sydney)"},"ap-southeast-3":{description:"Asia Pacific (Jakarta)"},"ap-southeast-4":{description:"Asia Pacific (Melbourne)"},"aws-global":{description:"AWS Standard global region"},"ca-central-1":{description:"Canada (Central)"},"ca-west-1":{description:"Canada West (Calgary)"},"eu-central-1":{description:"Europe (Frankfurt)"},"eu-central-2":{description:"Europe (Zurich)"},"eu-north-1":{description:"Europe (Stockholm)"},"eu-south-1":{description:"Europe (Milan)"},"eu-south-2":{description:"Europe (Spain)"},"eu-west-1":{description:"Europe (Ireland)"},"eu-west-2":{description:"Europe (London)"},"eu-west-3":{description:"Europe (Paris)"},"il-central-1":{description:"Israel (Tel Aviv)"},"me-central-1":{description:"Middle East (UAE)"},"me-south-1":{description:"Middle East (Bahrain)"},"sa-east-1":{description:"South America (Sao Paulo)"},"us-east-1":{description:"US East (N. Virginia)"},"us-east-2":{description:"US East (Ohio)"},"us-west-1":{description:"US West (N. California)"},"us-west-2":{description:"US West (Oregon)"}}},{id:"aws-cn",outputs:{dnsSuffix:"amazonaws.com.cn",dualStackDnsSuffix:"api.amazonwebservices.com.cn",implicitGlobalRegion:"cn-northwest-1",name:"aws-cn",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^cn\\-\\w+\\-\\d+$",regions:{"aws-cn-global":{description:"AWS China global region"},"cn-north-1":{description:"China (Beijing)"},"cn-northwest-1":{description:"China (Ningxia)"}}},{id:"aws-us-gov",outputs:{dnsSuffix:"amazonaws.com",dualStackDnsSuffix:"api.aws",implicitGlobalRegion:"us-gov-west-1",name:"aws-us-gov",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^us\\-gov\\-\\w+\\-\\d+$",regions:{"aws-us-gov-global":{description:"AWS GovCloud (US) global region"},"us-gov-east-1":{description:"AWS GovCloud (US-East)"},"us-gov-west-1":{description:"AWS GovCloud (US-West)"}}},{id:"aws-iso",outputs:{dnsSuffix:"c2s.ic.gov",dualStackDnsSuffix:"c2s.ic.gov",implicitGlobalRegion:"us-iso-east-1",name:"aws-iso",supportsDualStack:!1,supportsFIPS:!0},regionRegex:"^us\\-iso\\-\\w+\\-\\d+$",regions:{"aws-iso-global":{description:"AWS ISO (US) global region"},"us-iso-east-1":{description:"US ISO East"},"us-iso-west-1":{description:"US ISO WEST"}}},{id:"aws-iso-b",outputs:{dnsSuffix:"sc2s.sgov.gov",dualStackDnsSuffix:"sc2s.sgov.gov",implicitGlobalRegion:"us-isob-east-1",name:"aws-iso-b",supportsDualStack:!1,supportsFIPS:!0},regionRegex:"^us\\-isob\\-\\w+\\-\\d+$",regions:{"aws-iso-b-global":{description:"AWS ISOB (US) global region"},"us-isob-east-1":{description:"US ISOB East (Ohio)"}}},{id:"aws-iso-e",outputs:{dnsSuffix:"cloud.adc-e.uk",dualStackDnsSuffix:"cloud.adc-e.uk",implicitGlobalRegion:"eu-isoe-west-1",name:"aws-iso-e",supportsDualStack:!1,supportsFIPS:!0},regionRegex:"^eu\\-isoe\\-\\w+\\-\\d+$",regions:{}},{id:"aws-iso-f",outputs:{dnsSuffix:"csp.hci.ic.gov",dualStackDnsSuffix:"csp.hci.ic.gov",implicitGlobalRegion:"us-isof-south-1",name:"aws-iso-f",supportsDualStack:!1,supportsFIPS:!0},regionRegex:"^us\\-isof\\-\\w+\\-\\d+$",regions:{}}],mx="1.1",gx={partitions:fx,version:mx};let yx=gx;const _x=s=>{const{partitions:o}=yx;for(const y of o){const{regions:T,outputs:S}=y;for(const[x,h]of Object.entries(T))if(x===s)return{...S,...h}}for(const y of o){const{regionRegex:T,outputs:S}=y;if(new RegExp(T).test(s))return{...S}}const d=o.find(y=>y.id==="aws");if(!d)throw new Error("Provided region was not found in the partition array or regex, and default partition with id 'aws' doesn't exist.");return{...d.outputs}},Rm={isVirtualHostableS3Bucket:Dm,parseArn:px,partition:_x};tu.aws=Rm;const hf="user-agent",Sh="x-amz-user-agent",df=" ",Th="/",xx=/[^\!\$\%\&\'\*\+\-\.\^\_\`\|\~\d\w]/g,vx=/[^\!\$\%\&\'\*\+\-\.\^\_\`\|\~\d\w\#]/g,pf="-",bx=s=>(o,d)=>async y=>{var Q,U;const{request:T}=y;if(!un.isInstance(T))return o(y);const{headers:S}=T,x=((Q=d==null?void 0:d.userAgent)==null?void 0:Q.map(Ah))||[],h=(await s.defaultUserAgentProvider()).map(Ah),K=((U=s==null?void 0:s.customUserAgent)==null?void 0:U.map(Ah))||[],O=[].concat([...h,...x,...K]).join(df),ie=[...h.filter(ye=>ye.startsWith("aws-sdk-")),...K].join(df);return s.runtime!=="browser"?(ie&&(S[Sh]=S[Sh]?`${S[hf]} ${ie}`:ie),S[hf]=O):S[Sh]=O,o({...y,request:T})},Ah=s=>{var x;const o=s[0].split(Th).map(h=>h.replace(xx,pf)).join(Th),d=(x=s[1])==null?void 0:x.replace(vx,pf),y=o.indexOf(Th),T=o.substring(0,y);let S=o.substring(y+1);return T==="api"&&(S=S.toLowerCase()),[T,S,d].filter(h=>h&&h.length>0).reduce((h,K,O)=>{switch(O){case 0:return K;case 1:return`${h}/${K}`;default:return`${h}#${K}`}},"")},wx={name:"getUserAgentMiddleware",step:"build",priority:"low",tags:["SET_USER_AGENT","USER_AGENT"],override:!0},Sx=s=>({applyToStack:o=>{o.add(bx(s),wx)}});var ff;(function(s){s.ENV="env",s.CONFIG="shared config entry"})(ff||(ff={}));const Tx=!1,Ax=!1,cu=s=>s[Nh]||(s[Nh]={}),vs=s=>{if(typeof s=="function")return s;const o=Promise.resolve(s);return()=>o},zm=s=>typeof s=="string"&&(s.startsWith("fips-")||s.endsWith("-fips")),mf=s=>zm(s)?["fips-aws-global","aws-fips"].includes(s)?"us-east-1":s.replace(/fips-(dkr-|prod-)?|-fips/,""):s,Ex=s=>{const{region:o,useFipsEndpoint:d}=s;if(!o)throw new Error("Region is missing");return{...s,region:async()=>{if(typeof o=="string")return mf(o);const y=await o();return mf(y)},useFipsEndpoint:async()=>{const y=typeof o=="string"?o:await o();return zm(y)?!0:typeof d!="function"?Promise.resolve(!!d):d()}}};function Ix(s){const o=new Map;for(const d of s)o.set(d.schemeId,d);return o}const Cx=(s,o)=>(d,y)=>async T=>{var O;const S=s.httpAuthSchemeProvider(await o.httpAuthSchemeParametersProvider(s,y,T.input)),x=Ix(s.httpAuthSchemes),h=cu(y),K=[];for(const ie of S){const Q=x.get(ie.schemeId);if(!Q){K.push(`HttpAuthScheme \`${ie.schemeId}\` was not enabled for this service.`);continue}const U=Q.identityProvider(await o.identityProviderConfigProvider(s));if(!U){K.push(`HttpAuthScheme \`${ie.schemeId}\` did not have an IdentityProvider configured.`);continue}const{identityProperties:ye={},signingProperties:Te={}}=((O=ie.propertiesExtractor)==null?void 0:O.call(ie,s,y))||{};ie.identityProperties=Object.assign(ie.identityProperties||{},ye),ie.signingProperties=Object.assign(ie.signingProperties||{},Te),h.selectedHttpAuthScheme={httpAuthOption:ie,identity:await U(ie.identityProperties),signer:Q.signer};break}if(!h.selectedHttpAuthScheme)throw new Error(K.join(`
`));return d(T)},Px=async s=>{const o=(s==null?void 0:s.Bucket)||"";if(typeof s.Bucket=="string"&&(s.Bucket=o.replace(/#/g,encodeURIComponent("#")).replace(/\?/g,encodeURIComponent("?"))),zx(o)){if(s.ForcePathStyle===!0)throw new Error("Path-style addressing cannot be used with ARN buckets")}else(!Rx(o)||o.indexOf(".")!==-1&&!String(s.Endpoint).startsWith("http:")||o.toLowerCase()!==o||o.length<3)&&(s.ForcePathStyle=!0);return s.DisableMultiRegionAccessPoints&&(s.disableMultiRegionAccessPoints=!0,s.DisableMRAP=!0),s},Mx=/^[a-z0-9][a-z0-9\.\-]{1,61}[a-z0-9]$/,kx=/(\d+\.){3}\d+/,Dx=/\.\./,Rx=s=>Mx.test(s)&&!kx.test(s)&&!Dx.test(s),zx=s=>{const[o,d,y,T,S,x]=s.split(":"),h=o==="arn"&&s.split(":").length>=6,K=[o,d,y,S,x].filter(Boolean).length===5;if(h&&!K)throw new Error(`Invalid ARN: ${s} was an invalid ARN.`);return o==="arn"&&!!d&&!!y&&!!S&&!!x},Bx=(s,o,d)=>{const y=async()=>{const T=d[s]??d[o];return typeof T=="function"?T():T};return s==="credentialScope"||o==="CredentialScope"?async()=>{const T=typeof d.credentials=="function"?await d.credentials():d.credentials;return(T==null?void 0:T.credentialScope)??(T==null?void 0:T.CredentialScope)}:s==="endpoint"||o==="endpoint"?async()=>{const T=await y();if(T&&typeof T=="object"){if("url"in T)return T.url.href;if("hostname"in T){const{protocol:S,hostname:x,port:h,path:K}=T;return`${S}//${x}${h?":"+h:""}${K}`}}return T}:y},Lx=async s=>{};function Fx(s){const o={};if(s=s.replace(/^\?/,""),s)for(const d of s.split("&")){let[y,T=null]=d.split("=");y=decodeURIComponent(y),T&&(T=decodeURIComponent(T)),y in o?Array.isArray(o[y])?o[y].push(T):o[y]=[o[y],T]:o[y]=T}return o}const iu=s=>{if(typeof s=="string")return iu(new URL(s));const{hostname:o,pathname:d,port:y,protocol:T,search:S}=s;let x;return S&&(x=Fx(S)),{hostname:o,port:y?parseInt(y):void 0,protocol:T,path:d,query:x}},Bm=s=>typeof s=="object"?"url"in s?iu(s.url):s:iu(s),Ox=async(s,o,d,y)=>{if(!d.endpoint){const x=await Lx(d.serviceId||"");x&&(d.endpoint=()=>Promise.resolve(Bm(x)))}const T=await $x(s,o,d);if(typeof d.endpointProvider!="function")throw new Error("config.endpointProvider is not set.");return d.endpointProvider(T,y)},$x=async(s,o,d)=>{var S;const y={},T=((S=o==null?void 0:o.getEndpointParameterInstructions)==null?void 0:S.call(o))||{};for(const[x,h]of Object.entries(T))switch(h.type){case"staticContextParams":y[x]=h.value;break;case"contextParams":y[x]=s[h.name];break;case"clientContextParams":case"builtInParams":y[x]=await Bx(h.name,x,d)();break;default:throw new Error("Unrecognized endpoint parameter instruction: "+JSON.stringify(h))}return Object.keys(T).length===0&&Object.assign(y,d),String(d.serviceId).toLowerCase()==="s3"&&await Px(y),y},Nx=({config:s,instructions:o})=>(d,y)=>async T=>{var h,K,O;const S=await Ox(T.input,{getEndpointParameterInstructions(){return o}},{...s},y);y.endpointV2=S,y.authSchemes=(h=S.properties)==null?void 0:h.authSchemes;const x=(K=y.authSchemes)==null?void 0:K[0];if(x){y.signing_region=x.signingRegion,y.signing_service=x.signingName;const ie=cu(y),Q=(O=ie==null?void 0:ie.selectedHttpAuthScheme)==null?void 0:O.httpAuthOption;Q&&(Q.signingProperties=Object.assign(Q.signingProperties||{},{signing_region:x.signingRegion,signingRegion:x.signingRegion,signing_service:x.signingName,signingName:x.signingName,signingRegionSet:x.signingRegionSet},x.properties))}return d({...T})},Ux=(s,o)=>(d,y)=>async T=>{const{response:S}=await d(T);try{const x=await o(S,s);return{response:S,output:x}}catch(x){if(Object.defineProperty(x,"$response",{value:S}),!("$metadata"in x)){const h="Deserialization error: to see the raw response, inspect the hidden field {error}.$response on this object.";x.message+=`
  `+h,typeof x.$responseBodyText<"u"&&x.$response&&(x.$response.body=x.$responseBodyText)}throw x}},Vx=(s,o)=>(d,y)=>async T=>{var h;const S=(h=y.endpointV2)!=null&&h.url&&s.urlParser?async()=>s.urlParser(y.endpointV2.url):s.endpoint;if(!S)throw new Error("No valid endpoint provider available.");const x=await o(T.input,{...s,endpoint:S});return d({...T,request:x})},jx={name:"deserializerMiddleware",step:"deserialize",tags:["DESERIALIZER"],override:!0},md={name:"serializerMiddleware",step:"serialize",tags:["SERIALIZER"],override:!0};function uu(s,o,d){return{applyToStack:y=>{y.add(Ux(s,d),jx),y.add(Vx(s,o),md)}}}const Lm={step:"serialize",tags:["ENDPOINT_PARAMETERS","ENDPOINT_V2","ENDPOINT"],name:"endpointV2Middleware",override:!0,relation:"before",toMiddleware:md.name},hu=(s,o)=>({applyToStack:d=>{d.addRelativeTo(Nx({config:s,instructions:o}),Lm)}}),qx=s=>{const o=s.tls??!0,{endpoint:d}=s,y=d!=null?async()=>Bm(await vs(d)()):void 0;return{...s,endpoint:y,tls:o,isCustomEndpoint:!!d,useDualstackEndpoint:vs(s.useDualstackEndpoint??!1),useFipsEndpoint:vs(s.useFipsEndpoint??!1)}},Gx={step:"serialize",tags:["HTTP_AUTH_SCHEME"],name:"httpAuthSchemeMiddleware",override:!0,relation:"before",toMiddleware:Lm.name},Hx=(s,{httpAuthSchemeParametersProvider:o,identityProviderConfigProvider:d})=>({applyToStack:y=>{y.addRelativeTo(Cx(s,{httpAuthSchemeParametersProvider:o,identityProviderConfigProvider:d}),Gx)}});md.name;const Zx=s=>o=>{throw o},Wx=(s,o)=>{},Kx=s=>(o,d)=>async y=>{if(!un.isInstance(y.request))return o(y);const S=cu(d).selectedHttpAuthScheme;if(!S)throw new Error("No HttpAuthScheme was selected: unable to sign request");const{httpAuthOption:{signingProperties:x={}},identity:h,signer:K}=S,O=await o({...y,request:await K.sign(y.request,h,x)}).catch((K.errorHandler||Zx)(x));return(K.successHandler||Wx)(O.response,x),O};var Za;(function(s){s.STANDARD="standard",s.ADAPTIVE="adaptive"})(Za||(Za={}));const ru=3,Xx=Za.STANDARD,Yx=["BandwidthLimitExceeded","EC2ThrottledException","LimitExceededException","PriorRequestNotComplete","ProvisionedThroughputExceededException","RequestLimitExceeded","RequestThrottled","RequestThrottledException","SlowDown","ThrottledException","Throttling","ThrottlingException","TooManyRequestsException","TransactionInProgressException"],Jx=["TimeoutError","RequestTimeout","RequestTimeoutException"],Qx=[500,502,503,504],ev=["ECONNRESET","ECONNREFUSED","EPIPE","ETIMEDOUT"],tv=s=>{var o;return(o=s.$metadata)==null?void 0:o.clockSkewCorrected},Fm=s=>{var o,d;return((o=s.$metadata)==null?void 0:o.httpStatusCode)===429||Yx.includes(s.name)||((d=s.$retryable)==null?void 0:d.throttling)==!0},Om=s=>{var o;return tv(s)||Jx.includes(s.name)||ev.includes((s==null?void 0:s.code)||"")||Qx.includes(((o=s.$metadata)==null?void 0:o.httpStatusCode)||0)},iv=s=>{var o;if(((o=s.$metadata)==null?void 0:o.httpStatusCode)!==void 0){const d=s.$metadata.httpStatusCode;return 500<=d&&d<=599&&!Om(s)}return!1};class rv{constructor(o){this.currentCapacity=0,this.enabled=!1,this.lastMaxRate=0,this.measuredTxRate=0,this.requestCount=0,this.lastTimestamp=0,this.timeWindow=0,this.beta=(o==null?void 0:o.beta)??.7,this.minCapacity=(o==null?void 0:o.minCapacity)??1,this.minFillRate=(o==null?void 0:o.minFillRate)??.5,this.scaleConstant=(o==null?void 0:o.scaleConstant)??.4,this.smooth=(o==null?void 0:o.smooth)??.8;const d=this.getCurrentTimeInSeconds();this.lastThrottleTime=d,this.lastTxRateBucket=Math.floor(this.getCurrentTimeInSeconds()),this.fillRate=this.minFillRate,this.maxCapacity=this.minCapacity}getCurrentTimeInSeconds(){return Date.now()/1e3}async getSendToken(){return this.acquireTokenBucket(1)}async acquireTokenBucket(o){if(this.enabled){if(this.refillTokenBucket(),o>this.currentCapacity){const d=(o-this.currentCapacity)/this.fillRate*1e3;await new Promise(y=>setTimeout(y,d))}this.currentCapacity=this.currentCapacity-o}}refillTokenBucket(){const o=this.getCurrentTimeInSeconds();if(!this.lastTimestamp){this.lastTimestamp=o;return}const d=(o-this.lastTimestamp)*this.fillRate;this.currentCapacity=Math.min(this.maxCapacity,this.currentCapacity+d),this.lastTimestamp=o}updateClientSendingRate(o){let d;if(this.updateMeasuredRate(),Fm(o)){const T=this.enabled?Math.min(this.measuredTxRate,this.fillRate):this.measuredTxRate;this.lastMaxRate=T,this.calculateTimeWindow(),this.lastThrottleTime=this.getCurrentTimeInSeconds(),d=this.cubicThrottle(T),this.enableTokenBucket()}else this.calculateTimeWindow(),d=this.cubicSuccess(this.getCurrentTimeInSeconds());const y=Math.min(d,2*this.measuredTxRate);this.updateTokenBucketRate(y)}calculateTimeWindow(){this.timeWindow=this.getPrecise(Math.pow(this.lastMaxRate*(1-this.beta)/this.scaleConstant,1/3))}cubicThrottle(o){return this.getPrecise(o*this.beta)}cubicSuccess(o){return this.getPrecise(this.scaleConstant*Math.pow(o-this.lastThrottleTime-this.timeWindow,3)+this.lastMaxRate)}enableTokenBucket(){this.enabled=!0}updateTokenBucketRate(o){this.refillTokenBucket(),this.fillRate=Math.max(o,this.minFillRate),this.maxCapacity=Math.max(o,this.minCapacity),this.currentCapacity=Math.min(this.currentCapacity,this.maxCapacity)}updateMeasuredRate(){const o=this.getCurrentTimeInSeconds(),d=Math.floor(o*2)/2;if(this.requestCount++,d>this.lastTxRateBucket){const y=this.requestCount/(d-this.lastTxRateBucket);this.measuredTxRate=this.getPrecise(y*this.smooth+this.measuredTxRate*(1-this.smooth)),this.requestCount=0,this.lastTxRateBucket=d}}getPrecise(o){return parseFloat(o.toFixed(8))}}const jh=100,$m=20*1e3,nv=500,gf=500,sv=5,av=10,ov=1,lv="amz-sdk-invocation-id",cv="amz-sdk-request",uv=()=>{let s=jh;return{computeNextBackoffDelay:y=>Math.floor(Math.min($m,Math.random()*2**y*s)),setDelayBase:y=>{s=y}}},yf=({retryDelay:s,retryCount:o,retryCost:d})=>({getRetryCount:()=>o,getRetryDelay:()=>Math.min($m,s),getRetryCost:()=>d});class Nm{constructor(o){this.maxAttempts=o,this.mode=Za.STANDARD,this.capacity=gf,this.retryBackoffStrategy=uv(),this.maxAttemptsProvider=typeof o=="function"?o:async()=>o}async acquireInitialRetryToken(o){return yf({retryDelay:jh,retryCount:0})}async refreshRetryTokenForRetry(o,d){const y=await this.getMaxAttempts();if(this.shouldRetry(o,d,y)){const T=d.errorType;this.retryBackoffStrategy.setDelayBase(T==="THROTTLING"?nv:jh);const S=this.retryBackoffStrategy.computeNextBackoffDelay(o.getRetryCount()),x=d.retryAfterHint?Math.max(d.retryAfterHint.getTime()-Date.now()||0,S):S,h=this.getCapacityCost(T);return this.capacity-=h,yf({retryDelay:x,retryCount:o.getRetryCount()+1,retryCost:h})}throw new Error("No retry token available")}recordSuccess(o){this.capacity=Math.max(gf,this.capacity+(o.getRetryCost()??ov))}getCapacity(){return this.capacity}async getMaxAttempts(){try{return await this.maxAttemptsProvider()}catch{return console.warn(`Max attempts provider could not resolve. Using default of ${ru}`),ru}}shouldRetry(o,d,y){return o.getRetryCount()+1<y&&this.capacity>=this.getCapacityCost(d.errorType)&&this.isRetryableError(d.errorType)}getCapacityCost(o){return o==="TRANSIENT"?av:sv}isRetryableError(o){return o==="THROTTLING"||o==="TRANSIENT"}}class hv{constructor(o,d){this.maxAttemptsProvider=o,this.mode=Za.ADAPTIVE;const{rateLimiter:y}=d??{};this.rateLimiter=y??new rv,this.standardRetryStrategy=new Nm(o)}async acquireInitialRetryToken(o){return await this.rateLimiter.getSendToken(),this.standardRetryStrategy.acquireInitialRetryToken(o)}async refreshRetryTokenForRetry(o,d){return this.rateLimiter.updateClientSendingRate(d),this.standardRetryStrategy.refreshRetryTokenForRetry(o,d)}recordSuccess(o){this.rateLimiter.updateClientSendingRate({}),this.standardRetryStrategy.recordSuccess(o)}}let Gc;const dv=new Uint8Array(16);function pv(){if(!Gc&&(Gc=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Gc))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Gc(dv)}const Ci=[];for(let s=0;s<256;++s)Ci.push((s+256).toString(16).slice(1));function fv(s,o=0){return Ci[s[o+0]]+Ci[s[o+1]]+Ci[s[o+2]]+Ci[s[o+3]]+"-"+Ci[s[o+4]]+Ci[s[o+5]]+"-"+Ci[s[o+6]]+Ci[s[o+7]]+"-"+Ci[s[o+8]]+Ci[s[o+9]]+"-"+Ci[s[o+10]]+Ci[s[o+11]]+Ci[s[o+12]]+Ci[s[o+13]]+Ci[s[o+14]]+Ci[s[o+15]]}const mv=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),_f={randomUUID:mv};function gv(s,o,d){if(_f.randomUUID&&!o&&!s)return _f.randomUUID();s=s||{};const y=s.random||(s.rng||pv)();if(y[6]=y[6]&15|64,y[8]=y[8]&63|128,o){d=d||0;for(let T=0;T<16;++T)o[d+T]=y[T];return o}return fv(y)}const yv=s=>s instanceof Error?s:s instanceof Object?Object.assign(new Error,s):typeof s=="string"?new Error(s):new Error(`AWS SDK error wrapper for ${s}`),_v=s=>{const{retryStrategy:o}=s,d=vs(s.maxAttempts??ru);return{...s,maxAttempts:d,retryStrategy:async()=>o||(await vs(s.retryMode)()===Za.ADAPTIVE?new hv(d):new Nm(d))}},xv=s=>(s==null?void 0:s.body)instanceof ReadableStream,vv=s=>(o,d)=>async y=>{var x;let T=await s.retryStrategy();const S=await s.maxAttempts();if(bv(T)){T=T;let h=await T.acquireInitialRetryToken(d.partition_id),K=new Error,O=0,ie=0;const{request:Q}=y,U=un.isInstance(Q);for(U&&(Q.headers[lv]=gv());;)try{U&&(Q.headers[cv]=`attempt=${O+1}; max=${S}`);const{response:ye,output:Te}=await o(y);return T.recordSuccess(h),Te.$metadata.attempts=O+1,Te.$metadata.totalRetryDelay=ie,{response:ye,output:Te}}catch(ye){const Te=wv(ye);if(K=yv(ye),U&&xv(Q))throw(x=d.logger instanceof xm?console:d.logger)==null||x.warn("An error was encountered in a non-retryable streaming request."),K;try{h=await T.refreshRetryTokenForRetry(h,Te)}catch{throw K.$metadata||(K.$metadata={}),K.$metadata.attempts=O+1,K.$metadata.totalRetryDelay=ie,K}O=h.getRetryCount();const Pe=h.getRetryDelay();ie+=Pe,await new Promise(qe=>setTimeout(qe,Pe))}}else return T=T,T!=null&&T.mode&&(d.userAgent=[...d.userAgent||[],["cfg/retry-mode",T.mode]]),T.retry(o,y)},bv=s=>typeof s.acquireInitialRetryToken<"u"&&typeof s.refreshRetryTokenForRetry<"u"&&typeof s.recordSuccess<"u",wv=s=>{const o={error:s,errorType:Sv(s)},d=Av(s.$response);return d&&(o.retryAfterHint=d),o},Sv=s=>Fm(s)?"THROTTLING":Om(s)?"TRANSIENT":iv(s)?"SERVER_ERROR":"CLIENT_ERROR",Um={name:"retryMiddleware",tags:["RETRY"],step:"finalizeRequest",priority:"high",override:!0},Tv=s=>({applyToStack:o=>{o.add(vv(s),Um)}}),Av=s=>{if(!Yc.isInstance(s))return;const o=Object.keys(s.headers).find(S=>S.toLowerCase()==="retry-after");if(!o)return;const d=s.headers[o],y=Number(d);return Number.isNaN(y)?new Date(d):new Date(y*1e3)},Ev={step:"finalizeRequest",tags:["HTTP_SIGNING"],name:"httpSigningMiddleware",aliases:["apiKeyMiddleware","tokenMiddleware","awsAuthMiddleware"],override:!0,relation:"after",toMiddleware:Um.name},Iv=s=>({applyToStack:o=>{o.addRelativeTo(Kx(),Ev)}});class Cv{constructor(o){this.authSchemes=new Map;for(const[d,y]of Object.entries(o))y!==void 0&&this.authSchemes.set(d,y)}getIdentityProvider(o){return this.authSchemes.get(o)}}const Pv=s=>o=>Vm(o)&&o.expiration.getTime()-Date.now()<s,Mv=3e5,kv=Pv(Mv),Vm=s=>s.expiration!==void 0,Dv=(s,o,d)=>{if(s===void 0)return;const y=typeof s!="function"?async()=>Promise.resolve(s):s;let T,S,x,h=!1;const K=async O=>{S||(S=y(O));try{T=await S,x=!0,h=!1}finally{S=void 0}return T};return o===void 0?async O=>((!x||O!=null&&O.forceRefresh)&&(T=await K(O)),T):async O=>((!x||O!=null&&O.forceRefresh)&&(T=await K(O)),h?T:d(T)?(o(T)&&await K(O),T):(h=!0,T))},Hc=s=>{if(typeof s=="function")return s;const o=Promise.resolve(s);return()=>o};function du(s,o){return new Rv(s,o)}class Rv{constructor(o,d){this.input=o,this.context=d,this.query={},this.method="",this.headers={},this.path="",this.body=null,this.hostname="",this.resolvePathStack=[]}async build(){const{hostname:o,protocol:d="https",port:y,path:T}=await this.context.endpoint();this.path=T;for(const S of this.resolvePathStack)S(this.path);return new un({protocol:d,hostname:this.hostname||o,port:y,method:this.method,path:this.path,query:this.query,body:this.body,headers:this.headers})}hn(o){return this.hostname=o,this}bp(o){return this.resolvePathStack.push(d=>{this.path=`${d!=null&&d.endsWith("/")?d.slice(0,-1):d||""}`+o}),this}p(o,d,y,T){return this.resolvePathStack.push(S=>{this.path=x0(S,this.input,o,d,y,T)}),this}h(o){return this.headers=o,this}q(o){return this.query=o,this}b(o){return this.body=o,this}m(o){return this.method=o,this}}const xf="content-length";function zv(s){return o=>async d=>{const y=d.request;if(un.isInstance(y)){const{body:T,headers:S}=y;if(T&&Object.keys(S).map(x=>x.toLowerCase()).indexOf(xf)===-1)try{const x=s(T);y.headers={...y.headers,[xf]:String(x)}}catch{}}return o({...d,request:y})}}const Bv={step:"build",tags:["SET_CONTENT_LENGTH","CONTENT_LENGTH"],name:"contentLengthMiddleware",override:!0},Lv=s=>({applyToStack:o=>{o.add(zv(s.bodyLengthChecker),Bv)}}),vf=s=>{var o,d;return Yc.isInstance(s)?((o=s.headers)==null?void 0:o.date)??((d=s.headers)==null?void 0:d.Date):void 0},jm=s=>new Date(Date.now()+s),Fv=(s,o)=>Math.abs(jm(o).getTime()-s)>=3e5,bf=(s,o)=>{const d=Date.parse(s);return Fv(d,o)?d-Date.now():o},wl=(s,o)=>{if(!o)throw new Error(`Property \`${s}\` is not resolved for AWS SDK SigV4Auth`);return o},Ov=async s=>{var K,O,ie;const o=wl("context",s.context),d=wl("config",s.config),y=(ie=(O=(K=o.endpointV2)==null?void 0:K.properties)==null?void 0:O.authSchemes)==null?void 0:ie[0],S=await wl("signer",d.signer)(y),x=s==null?void 0:s.signingRegion,h=s==null?void 0:s.signingName;return{config:d,signer:S,signingRegion:x,signingName:h}};class $v{async sign(o,d,y){if(!un.isInstance(o))throw new Error("The request is not an instance of `HttpRequest` and cannot be signed");const{config:T,signer:S,signingRegion:x,signingName:h}=await Ov(y);return await S.sign(o,{signingDate:jm(T.systemClockOffset),signingRegion:x,signingService:h})}errorHandler(o){return d=>{const y=d.ServerTime??vf(d.$response);if(y){const T=wl("config",o.config),S=T.systemClockOffset;T.systemClockOffset=bf(y,T.systemClockOffset),T.systemClockOffset!==S&&d.$metadata&&(d.$metadata.clockSkewCorrected=!0)}throw d}}successHandler(o,d){const y=vf(o);if(y){const T=wl("config",d.config);T.systemClockOffset=bf(y,T.systemClockOffset)}}}var Eh={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var qh=function(s,o){return qh=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,y){d.__proto__=y}||function(d,y){for(var T in y)y.hasOwnProperty(T)&&(d[T]=y[T])},qh(s,o)};function Nv(s,o){qh(s,o);function d(){this.constructor=s}s.prototype=o===null?Object.create(o):(d.prototype=o.prototype,new d)}var Gh=function(){return Gh=Object.assign||function(o){for(var d,y=1,T=arguments.length;y<T;y++){d=arguments[y];for(var S in d)Object.prototype.hasOwnProperty.call(d,S)&&(o[S]=d[S])}return o},Gh.apply(this,arguments)};function Uv(s,o){var d={};for(var y in s)Object.prototype.hasOwnProperty.call(s,y)&&o.indexOf(y)<0&&(d[y]=s[y]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var T=0,y=Object.getOwnPropertySymbols(s);T<y.length;T++)o.indexOf(y[T])<0&&Object.prototype.propertyIsEnumerable.call(s,y[T])&&(d[y[T]]=s[y[T]]);return d}function Vv(s,o,d,y){var T=arguments.length,S=T<3?o:y===null?y=Object.getOwnPropertyDescriptor(o,d):y,x;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")S=Reflect.decorate(s,o,d,y);else for(var h=s.length-1;h>=0;h--)(x=s[h])&&(S=(T<3?x(S):T>3?x(o,d,S):x(o,d))||S);return T>3&&S&&Object.defineProperty(o,d,S),S}function jv(s,o){return function(d,y){o(d,y,s)}}function qv(s,o){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,o)}function Gv(s,o,d,y){function T(S){return S instanceof d?S:new d(function(x){x(S)})}return new(d||(d=Promise))(function(S,x){function h(ie){try{O(y.next(ie))}catch(Q){x(Q)}}function K(ie){try{O(y.throw(ie))}catch(Q){x(Q)}}function O(ie){ie.done?S(ie.value):T(ie.value).then(h,K)}O((y=y.apply(s,o||[])).next())})}function Hv(s,o){var d={label:0,sent:function(){if(S[0]&1)throw S[1];return S[1]},trys:[],ops:[]},y,T,S,x;return x={next:h(0),throw:h(1),return:h(2)},typeof Symbol=="function"&&(x[Symbol.iterator]=function(){return this}),x;function h(O){return function(ie){return K([O,ie])}}function K(O){if(y)throw new TypeError("Generator is already executing.");for(;d;)try{if(y=1,T&&(S=O[0]&2?T.return:O[0]?T.throw||((S=T.return)&&S.call(T),0):T.next)&&!(S=S.call(T,O[1])).done)return S;switch(T=0,S&&(O=[O[0]&2,S.value]),O[0]){case 0:case 1:S=O;break;case 4:return d.label++,{value:O[1],done:!1};case 5:d.label++,T=O[1],O=[0];continue;case 7:O=d.ops.pop(),d.trys.pop();continue;default:if(S=d.trys,!(S=S.length>0&&S[S.length-1])&&(O[0]===6||O[0]===2)){d=0;continue}if(O[0]===3&&(!S||O[1]>S[0]&&O[1]<S[3])){d.label=O[1];break}if(O[0]===6&&d.label<S[1]){d.label=S[1],S=O;break}if(S&&d.label<S[2]){d.label=S[2],d.ops.push(O);break}S[2]&&d.ops.pop(),d.trys.pop();continue}O=o.call(s,d)}catch(ie){O=[6,ie],T=0}finally{y=S=0}if(O[0]&5)throw O[1];return{value:O[0]?O[1]:void 0,done:!0}}}function Zv(s,o,d,y){y===void 0&&(y=d),s[y]=o[d]}function Wv(s,o){for(var d in s)d!=="default"&&!o.hasOwnProperty(d)&&(o[d]=s[d])}function Hh(s){var o=typeof Symbol=="function"&&Symbol.iterator,d=o&&s[o],y=0;if(d)return d.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&y>=s.length&&(s=void 0),{value:s&&s[y++],done:!s}}};throw new TypeError(o?"Object is not iterable.":"Symbol.iterator is not defined.")}function qm(s,o){var d=typeof Symbol=="function"&&s[Symbol.iterator];if(!d)return s;var y=d.call(s),T,S=[],x;try{for(;(o===void 0||o-- >0)&&!(T=y.next()).done;)S.push(T.value)}catch(h){x={error:h}}finally{try{T&&!T.done&&(d=y.return)&&d.call(y)}finally{if(x)throw x.error}}return S}function Kv(){for(var s=[],o=0;o<arguments.length;o++)s=s.concat(qm(arguments[o]));return s}function Xv(){for(var s=0,o=0,d=arguments.length;o<d;o++)s+=arguments[o].length;for(var y=Array(s),T=0,o=0;o<d;o++)for(var S=arguments[o],x=0,h=S.length;x<h;x++,T++)y[T]=S[x];return y}function El(s){return this instanceof El?(this.v=s,this):new El(s)}function Yv(s,o,d){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var y=d.apply(s,o||[]),T,S=[];return T={},x("next"),x("throw"),x("return"),T[Symbol.asyncIterator]=function(){return this},T;function x(U){y[U]&&(T[U]=function(ye){return new Promise(function(Te,Pe){S.push([U,ye,Te,Pe])>1||h(U,ye)})})}function h(U,ye){try{K(y[U](ye))}catch(Te){Q(S[0][3],Te)}}function K(U){U.value instanceof El?Promise.resolve(U.value.v).then(O,ie):Q(S[0][2],U)}function O(U){h("next",U)}function ie(U){h("throw",U)}function Q(U,ye){U(ye),S.shift(),S.length&&h(S[0][0],S[0][1])}}function Jv(s){var o,d;return o={},y("next"),y("throw",function(T){throw T}),y("return"),o[Symbol.iterator]=function(){return this},o;function y(T,S){o[T]=s[T]?function(x){return(d=!d)?{value:El(s[T](x)),done:T==="return"}:S?S(x):x}:S}}function Qv(s){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o=s[Symbol.asyncIterator],d;return o?o.call(s):(s=typeof Hh=="function"?Hh(s):s[Symbol.iterator](),d={},y("next"),y("throw"),y("return"),d[Symbol.asyncIterator]=function(){return this},d);function y(S){d[S]=s[S]&&function(x){return new Promise(function(h,K){x=s[S](x),T(h,K,x.done,x.value)})}}function T(S,x,h,K){Promise.resolve(K).then(function(O){S({value:O,done:h})},x)}}function eb(s,o){return Object.defineProperty?Object.defineProperty(s,"raw",{value:o}):s.raw=o,s}function tb(s){if(s&&s.__esModule)return s;var o={};if(s!=null)for(var d in s)Object.hasOwnProperty.call(s,d)&&(o[d]=s[d]);return o.default=s,o}function ib(s){return s&&s.__esModule?s:{default:s}}function rb(s,o){if(!o.has(s))throw new TypeError("attempted to get private field on non-instance");return o.get(s)}function nb(s,o,d){if(!o.has(s))throw new TypeError("attempted to set private field on non-instance");return o.set(s,d),d}const sb=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return Gh},__asyncDelegator:Jv,__asyncGenerator:Yv,__asyncValues:Qv,__await:El,__awaiter:Gv,__classPrivateFieldGet:rb,__classPrivateFieldSet:nb,__createBinding:Zv,__decorate:Vv,__exportStar:Wv,__extends:Nv,__generator:Hv,__importDefault:ib,__importStar:tb,__makeTemplateObject:eb,__metadata:qv,__param:jv,__read:qm,__rest:Uv,__spread:Kv,__spreadArrays:Xv,__values:Hh},Symbol.toStringTag,{value:"Module"})),Gm=ea(sb);var Ih={},ol={},wf;function ab(){if(wf)return ol;wf=1,Object.defineProperty(ol,"__esModule",{value:!0}),ol.convertToBuffer=void 0;var s=wm,o=typeof Buffer<"u"&&Buffer.from?function(y){return Buffer.from(y,"utf8")}:s.fromUtf8;function d(y){return y instanceof Uint8Array?y:typeof y=="string"?o(y):ArrayBuffer.isView(y)?new Uint8Array(y.buffer,y.byteOffset,y.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(y)}return ol.convertToBuffer=d,ol}var ll={},Sf;function ob(){if(Sf)return ll;Sf=1,Object.defineProperty(ll,"__esModule",{value:!0}),ll.isEmptyData=void 0;function s(o){return typeof o=="string"?o.length===0:o.byteLength===0}return ll.isEmptyData=s,ll}var cl={},Tf;function lb(){if(Tf)return cl;Tf=1,Object.defineProperty(cl,"__esModule",{value:!0}),cl.numToUint8=void 0;function s(o){return new Uint8Array([(o&4278190080)>>24,(o&16711680)>>16,(o&65280)>>8,o&255])}return cl.numToUint8=s,cl}var ul={},Af;function cb(){if(Af)return ul;Af=1,Object.defineProperty(ul,"__esModule",{value:!0}),ul.uint32ArrayFrom=void 0;function s(o){if(!Uint32Array.from){for(var d=new Uint32Array(o.length),y=0;y<o.length;)d[y]=o[y],y+=1;return d}return Uint32Array.from(o)}return ul.uint32ArrayFrom=s,ul}var Ef;function Bl(){return Ef||(Ef=1,function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.uint32ArrayFrom=s.numToUint8=s.isEmptyData=s.convertToBuffer=void 0;var o=ab();Object.defineProperty(s,"convertToBuffer",{enumerable:!0,get:function(){return o.convertToBuffer}});var d=ob();Object.defineProperty(s,"isEmptyData",{enumerable:!0,get:function(){return d.isEmptyData}});var y=lb();Object.defineProperty(s,"numToUint8",{enumerable:!0,get:function(){return y.numToUint8}});var T=cb();Object.defineProperty(s,"uint32ArrayFrom",{enumerable:!0,get:function(){return T.uint32ArrayFrom}})}(Ih)),Ih}var hl={},If;function ub(){if(If)return hl;If=1,Object.defineProperty(hl,"__esModule",{value:!0}),hl.AwsCrc32=void 0;var s=Gm,o=Bl(),d=Hm(),y=function(){function T(){this.crc32=new d.Crc32}return T.prototype.update=function(S){(0,o.isEmptyData)(S)||this.crc32.update((0,o.convertToBuffer)(S))},T.prototype.digest=function(){return s.__awaiter(this,void 0,void 0,function(){return s.__generator(this,function(S){return[2,(0,o.numToUint8)(this.crc32.digest())]})})},T.prototype.reset=function(){this.crc32=new d.Crc32},T}();return hl.AwsCrc32=y,hl}var Cf;function Hm(){return Cf||(Cf=1,function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.AwsCrc32=s.Crc32=s.crc32=void 0;var o=Gm,d=Bl();function y(K){return new T().update(K).digest()}s.crc32=y;var T=function(){function K(){this.checksum=4294967295}return K.prototype.update=function(O){var ie,Q;try{for(var U=o.__values(O),ye=U.next();!ye.done;ye=U.next()){var Te=ye.value;this.checksum=this.checksum>>>8^x[(this.checksum^Te)&255]}}catch(Pe){ie={error:Pe}}finally{try{ye&&!ye.done&&(Q=U.return)&&Q.call(U)}finally{if(ie)throw ie.error}}return this},K.prototype.digest=function(){return(this.checksum^4294967295)>>>0},K}();s.Crc32=T;var S=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],x=(0,d.uint32ArrayFrom)(S),h=ub();Object.defineProperty(s,"AwsCrc32",{enumerable:!0,get:function(){return h.AwsCrc32}})}(Eh)),Eh}Hm();class Sl{constructor(o){if(this.bytes=o,o.byteLength!==8)throw new Error("Int64 buffers must be exactly 8 bytes")}static fromNumber(o){if(o>9223372036854776e3||o<-9223372036854776e3)throw new Error(`${o} is too large (or, if negative, too small) to represent as an Int64`);const d=new Uint8Array(8);for(let y=7,T=Math.abs(Math.round(o));y>-1&&T>0;y--,T/=256)d[y]=T;return o<0&&Pf(d),new Sl(d)}valueOf(){const o=this.bytes.slice(0),d=o[0]&128;return d&&Pf(o),parseInt(Rr(o),16)*(d?-1:1)}toString(){return String(this.valueOf())}}function Pf(s){for(let o=0;o<8;o++)s[o]^=255;for(let o=7;o>-1&&(s[o]++,s[o]===0);o--);}class hb{constructor(o,d){this.toUtf8=o,this.fromUtf8=d}format(o){const d=[];for(const S of Object.keys(o)){const x=this.fromUtf8(S);d.push(Uint8Array.from([x.byteLength]),x,this.formatHeaderValue(o[S]))}const y=new Uint8Array(d.reduce((S,x)=>S+x.byteLength,0));let T=0;for(const S of d)y.set(S,T),T+=S.byteLength;return y}formatHeaderValue(o){switch(o.type){case"boolean":return Uint8Array.from([o.value?0:1]);case"byte":return Uint8Array.from([2,o.value]);case"short":const d=new DataView(new ArrayBuffer(3));return d.setUint8(0,3),d.setInt16(1,o.value,!1),new Uint8Array(d.buffer);case"integer":const y=new DataView(new ArrayBuffer(5));return y.setUint8(0,4),y.setInt32(1,o.value,!1),new Uint8Array(y.buffer);case"long":const T=new Uint8Array(9);return T[0]=5,T.set(o.value.bytes,1),T;case"binary":const S=new DataView(new ArrayBuffer(3+o.value.byteLength));S.setUint8(0,6),S.setUint16(1,o.value.byteLength,!1);const x=new Uint8Array(S.buffer);return x.set(o.value,3),x;case"string":const h=this.fromUtf8(o.value),K=new DataView(new ArrayBuffer(3+h.byteLength));K.setUint8(0,7),K.setUint16(1,h.byteLength,!1);const O=new Uint8Array(K.buffer);return O.set(h,3),O;case"timestamp":const ie=new Uint8Array(9);return ie[0]=8,ie.set(Sl.fromNumber(o.value.valueOf()).bytes,1),ie;case"uuid":if(!vb.test(o.value))throw new Error(`Invalid UUID received: ${o.value}`);const Q=new Uint8Array(17);return Q[0]=9,Q.set(Y_(o.value.replace(/\-/g,"")),1),Q}}parse(o){const d={};let y=0;for(;y<o.byteLength;){const T=o.getUint8(y++),S=this.toUtf8(new Uint8Array(o.buffer,o.byteOffset+y,T));switch(y+=T,o.getUint8(y++)){case 0:d[S]={type:kf,value:!0};break;case 1:d[S]={type:kf,value:!1};break;case 2:d[S]={type:db,value:o.getInt8(y++)};break;case 3:d[S]={type:pb,value:o.getInt16(y,!1)},y+=2;break;case 4:d[S]={type:fb,value:o.getInt32(y,!1)},y+=4;break;case 5:d[S]={type:mb,value:new Sl(new Uint8Array(o.buffer,o.byteOffset+y,8))},y+=8;break;case 6:const x=o.getUint16(y,!1);y+=2,d[S]={type:gb,value:new Uint8Array(o.buffer,o.byteOffset+y,x)},y+=x;break;case 7:const h=o.getUint16(y,!1);y+=2,d[S]={type:yb,value:this.toUtf8(new Uint8Array(o.buffer,o.byteOffset+y,h))},y+=h;break;case 8:d[S]={type:_b,value:new Date(new Sl(new Uint8Array(o.buffer,o.byteOffset+y,8)).valueOf())},y+=8;break;case 9:const K=new Uint8Array(o.buffer,o.byteOffset+y,16);y+=16,d[S]={type:xb,value:`${Rr(K.subarray(0,4))}-${Rr(K.subarray(4,6))}-${Rr(K.subarray(6,8))}-${Rr(K.subarray(8,10))}-${Rr(K.subarray(10))}`};break;default:throw new Error("Unrecognized header type tag")}}return d}}var Mf;(function(s){s[s.boolTrue=0]="boolTrue",s[s.boolFalse=1]="boolFalse",s[s.byte=2]="byte",s[s.short=3]="short",s[s.integer=4]="integer",s[s.long=5]="long",s[s.byteArray=6]="byteArray",s[s.string=7]="string",s[s.timestamp=8]="timestamp",s[s.uuid=9]="uuid"})(Mf||(Mf={}));const kf="boolean",db="byte",pb="short",fb="integer",mb="long",gb="binary",yb="string",_b="timestamp",xb="uuid",vb=/^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$/,bb="X-Amz-Algorithm",wb="X-Amz-Credential",Zm="X-Amz-Date",Sb="X-Amz-SignedHeaders",Tb="X-Amz-Expires",Wm="X-Amz-Signature",Km="X-Amz-Security-Token",Xm="authorization",Ym=Zm.toLowerCase(),Ab="date",Eb=[Xm,Ym,Ab],Ib=Wm.toLowerCase(),Zh="x-amz-content-sha256",Cb=Km.toLowerCase(),Pb={authorization:!0,"cache-control":!0,connection:!0,expect:!0,from:!0,"keep-alive":!0,"max-forwards":!0,pragma:!0,referer:!0,te:!0,trailer:!0,"transfer-encoding":!0,upgrade:!0,"user-agent":!0,"x-amzn-trace-id":!0},Mb=/^proxy-/,kb=/^sec-/,Ch="AWS4-HMAC-SHA256",Db="AWS4-HMAC-SHA256-PAYLOAD",Rb="UNSIGNED-PAYLOAD",zb=50,Jm="aws4_request",Bb=60*60*24*7,Zc={},Ph=[],Mh=(s,o,d)=>`${s}/${o}/${d}/${Jm}`,Lb=async(s,o,d,y,T)=>{const S=await Df(s,o.secretAccessKey,o.accessKeyId),x=`${d}:${y}:${T}:${Rr(S)}:${o.sessionToken}`;if(x in Zc)return Zc[x];for(Ph.push(x);Ph.length>zb;)delete Zc[Ph.shift()];let h=`AWS4${o.secretAccessKey}`;for(const K of[d,y,T,Jm])h=await Df(s,h,K);return Zc[x]=h},Df=(s,o,d)=>{const y=new s(o);return y.update(bl(d)),y.digest()},Rf=({headers:s},o,d)=>{const y={};for(const T of Object.keys(s).sort()){if(s[T]==null)continue;const S=T.toLowerCase();(S in Pb||o!=null&&o.has(S)||Mb.test(S)||kb.test(S))&&(!d||d&&!d.has(S))||(y[S]=s[T].trim().replace(/\s+/g," "))}return y},Fb=({query:s={}})=>{const o=[],d={};for(const y of Object.keys(s).sort()){if(y.toLowerCase()===Ib)continue;o.push(y);const T=s[y];typeof T=="string"?d[y]=`${Js(y)}=${Js(T)}`:Array.isArray(T)&&(d[y]=T.slice(0).reduce((S,x)=>S.concat([`${Js(y)}=${Js(x)}`]),[]).sort().join("&"))}return o.map(y=>d[y]).filter(y=>y).join("&")},Ob=s=>typeof ArrayBuffer=="function"&&s instanceof ArrayBuffer||Object.prototype.toString.call(s)==="[object ArrayBuffer]",kh=async({headers:s,body:o},d)=>{for(const y of Object.keys(s))if(y.toLowerCase()===Zh)return s[y];if(o==null)return"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855";if(typeof o=="string"||ArrayBuffer.isView(o)||Ob(o)){const y=new d;return y.update(bl(o)),Rr(await y.digest())}return Rb},$b=(s,o)=>{s=s.toLowerCase();for(const d of Object.keys(o))if(s===d.toLowerCase())return!0;return!1},Qm=({headers:s,query:o,...d})=>({...d,headers:{...s},query:o?Nb(o):void 0}),Nb=s=>Object.keys(s).reduce((o,d)=>{const y=s[d];return{...o,[d]:Array.isArray(y)?[...y]:y}},{}),Ub=(s,o={})=>{var T;const{headers:d,query:y={}}=typeof s.clone=="function"?s.clone():Qm(s);for(const S of Object.keys(d)){const x=S.toLowerCase();x.slice(0,6)==="x-amz-"&&!((T=o.unhoistableHeaders)!=null&&T.has(x))&&(y[S]=d[S],delete d[S])}return{...s,headers:d,query:y}},zf=s=>{s=typeof s.clone=="function"?s.clone():Qm(s);for(const o of Object.keys(s.headers))Eb.indexOf(o.toLowerCase())>-1&&delete s.headers[o];return s},Vb=s=>jb(s).toISOString().replace(/\.\d{3}Z$/,"Z"),jb=s=>typeof s=="number"?new Date(s*1e3):typeof s=="string"?Number(s)?new Date(Number(s)*1e3):new Date(s):s;class Bf{constructor({applyChecksum:o,credentials:d,region:y,service:T,sha256:S,uriEscapePath:x=!0}){this.headerMarshaller=new hb(cd,Rl),this.service=T,this.sha256=S,this.uriEscapePath=x,this.applyChecksum=typeof o=="boolean"?o:!0,this.regionProvider=vs(y),this.credentialProvider=vs(d)}async presign(o,d={}){const{signingDate:y=new Date,expiresIn:T=3600,unsignableHeaders:S,unhoistableHeaders:x,signableHeaders:h,signingRegion:K,signingService:O}=d,ie=await this.credentialProvider();this.validateResolvedCredentials(ie);const Q=K??await this.regionProvider(),{longDate:U,shortDate:ye}=Wc(y);if(T>Bb)return Promise.reject("Signature version 4 presigned URLs must have an expiration date less than one week in the future");const Te=Mh(ye,Q,O??this.service),Pe=Ub(zf(o),{unhoistableHeaders:x});ie.sessionToken&&(Pe.query[Km]=ie.sessionToken),Pe.query[bb]=Ch,Pe.query[wb]=`${ie.accessKeyId}/${Te}`,Pe.query[Zm]=U,Pe.query[Tb]=T.toString(10);const qe=Rf(Pe,S,h);return Pe.query[Sb]=Lf(qe),Pe.query[Wm]=await this.getSignature(U,Te,this.getSigningKey(ie,Q,ye,O),this.createCanonicalRequest(Pe,qe,await kh(o,this.sha256))),Pe}async sign(o,d){return typeof o=="string"?this.signString(o,d):o.headers&&o.payload?this.signEvent(o,d):o.message?this.signMessage(o,d):this.signRequest(o,d)}async signEvent({headers:o,payload:d},{signingDate:y=new Date,priorSignature:T,signingRegion:S,signingService:x}){const h=S??await this.regionProvider(),{shortDate:K,longDate:O}=Wc(y),ie=Mh(K,h,x??this.service),Q=await kh({headers:{},body:d},this.sha256),U=new this.sha256;U.update(o);const ye=Rr(await U.digest()),Te=[Db,O,ie,T,ye,Q].join(`
`);return this.signString(Te,{signingDate:y,signingRegion:h,signingService:x})}async signMessage(o,{signingDate:d=new Date,signingRegion:y,signingService:T}){return this.signEvent({headers:this.headerMarshaller.format(o.message.headers),payload:o.message.body},{signingDate:d,signingRegion:y,signingService:T,priorSignature:o.priorSignature}).then(x=>({message:o.message,signature:x}))}async signString(o,{signingDate:d=new Date,signingRegion:y,signingService:T}={}){const S=await this.credentialProvider();this.validateResolvedCredentials(S);const x=y??await this.regionProvider(),{shortDate:h}=Wc(d),K=new this.sha256(await this.getSigningKey(S,x,h,T));return K.update(bl(o)),Rr(await K.digest())}async signRequest(o,{signingDate:d=new Date,signableHeaders:y,unsignableHeaders:T,signingRegion:S,signingService:x}={}){const h=await this.credentialProvider();this.validateResolvedCredentials(h);const K=S??await this.regionProvider(),O=zf(o),{longDate:ie,shortDate:Q}=Wc(d),U=Mh(Q,K,x??this.service);O.headers[Ym]=ie,h.sessionToken&&(O.headers[Cb]=h.sessionToken);const ye=await kh(O,this.sha256);!$b(Zh,O.headers)&&this.applyChecksum&&(O.headers[Zh]=ye);const Te=Rf(O,T,y),Pe=await this.getSignature(ie,U,this.getSigningKey(h,K,Q,x),this.createCanonicalRequest(O,Te,ye));return O.headers[Xm]=`${Ch} Credential=${h.accessKeyId}/${U}, SignedHeaders=${Lf(Te)}, Signature=${Pe}`,O}createCanonicalRequest(o,d,y){const T=Object.keys(d).sort();return`${o.method}
${this.getCanonicalPath(o)}
${Fb(o)}
${T.map(S=>`${S}:${d[S]}`).join(`
`)}

${T.join(";")}
${y}`}async createStringToSign(o,d,y){const T=new this.sha256;T.update(bl(y));const S=await T.digest();return`${Ch}
${o}
${d}
${Rr(S)}`}getCanonicalPath({path:o}){if(this.uriEscapePath){const d=[];for(const S of o.split("/"))(S==null?void 0:S.length)!==0&&S!=="."&&(S===".."?d.pop():d.push(S));const y=`${o!=null&&o.startsWith("/")?"/":""}${d.join("/")}${d.length>0&&(o!=null&&o.endsWith("/"))?"/":""}`;return encodeURIComponent(y).replace(/%2F/g,"/")}return o}async getSignature(o,d,y,T){const S=await this.createStringToSign(o,d,T),x=new this.sha256(await y);return x.update(bl(S)),Rr(await x.digest())}getSigningKey(o,d,y,T){return Lb(this.sha256,o,y,d,T||this.service)}validateResolvedCredentials(o){if(typeof o!="object"||typeof o.accessKeyId!="string"||typeof o.secretAccessKey!="string")throw new Error("Resolved credential object is not valid")}}const Wc=s=>{const o=Vb(s).replace(/[\-:]/g,"");return{longDate:o,shortDate:o.slice(0,8)}},Lf=s=>Object.keys(s).sort().join(";"),qb=s=>{let o;s.credentials&&(o=Dv(s.credentials,kv,Vm)),o||(s.credentialDefaultProvider?o=Hc(s.credentialDefaultProvider(Object.assign({},s,{parentClientConfig:s}))):o=async()=>{throw new Error("`credentials` is missing")});const{signingEscapePath:d=!0,systemClockOffset:y=s.systemClockOffset||0,sha256:T}=s;let S;return s.signer?S=Hc(s.signer):s.regionInfoProvider?S=()=>Hc(s.region)().then(async x=>[await s.regionInfoProvider(x,{useFipsEndpoint:await s.useFipsEndpoint(),useDualstackEndpoint:await s.useDualstackEndpoint()})||{},x]).then(([x,h])=>{const{signingRegion:K,signingService:O}=x;s.signingRegion=s.signingRegion||K||h,s.signingName=s.signingName||O||s.serviceId;const ie={...s,credentials:o,region:s.signingRegion,service:s.signingName,sha256:T,uriEscapePath:d},Q=s.signerConstructor||Bf;return new Q(ie)}):S=async x=>{x=Object.assign({},{name:"sigv4",signingName:s.signingName||s.defaultSigningName,signingRegion:await Hc(s.region)(),properties:{}},x);const h=x.signingRegion,K=x.signingName;s.signingRegion=s.signingRegion||h,s.signingName=s.signingName||K||s.serviceId;const O={...s,credentials:o,region:s.signingRegion,service:s.signingName,sha256:T,uriEscapePath:d},ie=s.signerConstructor||Bf;return new ie(O)},{...s,systemClockOffset:y,signingEscapePath:d,credentials:o,signer:S}},Gb=(s,o)=>J_(s,o).then(d=>o.utf8Encoder(d)),Ll=(s,o)=>Gb(s,o).then(d=>{if(d.length)try{return JSON.parse(d)}catch(y){throw(y==null?void 0:y.name)==="SyntaxError"&&Object.defineProperty(y,"$responseBodyText",{value:d}),y}return{}}),Hb=async(s,o)=>{const d=await Ll(s,o);return d.message=d.message??d.Message,d},Zb=(s,o)=>{const d=(S,x)=>Object.keys(S).find(h=>h.toLowerCase()===x.toLowerCase()),y=S=>{let x=S;return typeof x=="number"&&(x=x.toString()),x.indexOf(",")>=0&&(x=x.split(",")[0]),x.indexOf(":")>=0&&(x=x.split(":")[0]),x.indexOf("#")>=0&&(x=x.split("#")[1]),x},T=d(s.headers,"x-amzn-errortype");if(T!==void 0)return y(s.headers[T]);if(o.code!==void 0)return y(o.code);if(o.__type!==void 0)return y(o.__type)},Wb=async(s,o,d)=>({operation:cu(o).operation,region:await vs(s.region)()||(()=>{throw new Error("expected `region` to be configured for `aws.auth#sigv4`")})()});function Kb(s){return{schemeId:"aws.auth#sigv4",signingProperties:{name:"geo",region:s.region},propertiesExtractor:(o,d)=>({signingProperties:{config:o,context:d}})}}const Xb=s=>{const o=[];switch(s.operation){default:o.push(Kb(s))}return o},Yb=s=>({...qb(s)}),Jb=s=>({...s,useDualstackEndpoint:s.useDualstackEndpoint??!1,useFipsEndpoint:s.useFipsEndpoint??!1,defaultSigningName:"geo"}),pu={UseFIPS:{type:"builtInParams",name:"useFipsEndpoint"},Endpoint:{type:"builtInParams",name:"endpoint"},Region:{type:"builtInParams",name:"region"},UseDualStack:{type:"builtInParams",name:"useDualstackEndpoint"}},Qb="@aws-sdk/client-location",e1="AWS SDK for JavaScript Location Client for Node.js, Browser and React Native",t1="3.540.0",i1={build:"concurrently 'yarn:build:cjs' 'yarn:build:es' 'yarn:build:types'","build:cjs":"node ../../scripts/compilation/inline client-location","build:es":"tsc -p tsconfig.es.json","build:include:deps":"lerna run --scope $npm_package_name --include-dependencies build","build:types":"tsc -p tsconfig.types.json","build:types:downlevel":"downlevel-dts dist-types dist-types/ts3.4",clean:"rimraf ./dist-* && rimraf *.tsbuildinfo","extract:docs":"api-extractor run --local","generate:client":"node ../../scripts/generate-clients/single-service --solo location"},r1="./dist-cjs/index.js",n1="./dist-types/index.d.ts",s1="./dist-es/index.js",a1=!1,o1={"@aws-crypto/sha256-browser":"3.0.0","@aws-crypto/sha256-js":"3.0.0","@aws-sdk/client-sts":"3.540.0","@aws-sdk/core":"3.535.0","@aws-sdk/credential-provider-node":"3.540.0","@aws-sdk/middleware-host-header":"3.535.0","@aws-sdk/middleware-logger":"3.535.0","@aws-sdk/middleware-recursion-detection":"3.535.0","@aws-sdk/middleware-user-agent":"3.540.0","@aws-sdk/region-config-resolver":"3.535.0","@aws-sdk/types":"3.535.0","@aws-sdk/util-endpoints":"3.540.0","@aws-sdk/util-user-agent-browser":"3.535.0","@aws-sdk/util-user-agent-node":"3.535.0","@smithy/config-resolver":"^2.2.0","@smithy/core":"^1.4.0","@smithy/fetch-http-handler":"^2.5.0","@smithy/hash-node":"^2.2.0","@smithy/invalid-dependency":"^2.2.0","@smithy/middleware-content-length":"^2.2.0","@smithy/middleware-endpoint":"^2.5.0","@smithy/middleware-retry":"^2.2.0","@smithy/middleware-serde":"^2.3.0","@smithy/middleware-stack":"^2.2.0","@smithy/node-config-provider":"^2.3.0","@smithy/node-http-handler":"^2.5.0","@smithy/protocol-http":"^3.3.0","@smithy/smithy-client":"^2.5.0","@smithy/types":"^2.12.0","@smithy/url-parser":"^2.2.0","@smithy/util-base64":"^2.3.0","@smithy/util-body-length-browser":"^2.2.0","@smithy/util-body-length-node":"^2.3.0","@smithy/util-defaults-mode-browser":"^2.2.0","@smithy/util-defaults-mode-node":"^2.3.0","@smithy/util-endpoints":"^1.2.0","@smithy/util-middleware":"^2.2.0","@smithy/util-retry":"^2.2.0","@smithy/util-stream":"^2.2.0","@smithy/util-utf8":"^2.3.0",tslib:"^2.6.2"},l1={"@smithy/service-client-documentation-generator":"^2.2.0","@tsconfig/node14":"1.0.3","@types/node":"^14.14.31",concurrently:"7.0.0","downlevel-dts":"0.10.1",rimraf:"3.0.2",typescript:"~4.9.5"},c1={node:">=14.0.0"},u1={"<4.0":{"dist-types/*":["dist-types/ts3.4/*"]}},h1=["dist-*/**"],d1={name:"AWS SDK for JavaScript Team",url:"https://aws.amazon.com/javascript/"},p1="Apache-2.0",f1={"./dist-es/runtimeConfig":"./dist-es/runtimeConfig.browser"},m1="https://github.com/aws/aws-sdk-js-v3/tree/main/clients/client-location",g1={type:"git",url:"https://github.com/aws/aws-sdk-js-v3.git",directory:"clients/client-location"},y1={name:Qb,description:e1,version:t1,scripts:i1,main:r1,types:n1,module:s1,sideEffects:a1,dependencies:o1,devDependencies:l1,engines:c1,typesVersions:u1,files:h1,author:d1,license:p1,browser:f1,"react-native":{"./dist-es/runtimeConfig":"./dist-es/runtimeConfig.native"},homepage:m1,repository:g1};var eg={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Wh=function(s,o){return Wh=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,y){d.__proto__=y}||function(d,y){for(var T in y)y.hasOwnProperty(T)&&(d[T]=y[T])},Wh(s,o)};function _1(s,o){Wh(s,o);function d(){this.constructor=s}s.prototype=o===null?Object.create(o):(d.prototype=o.prototype,new d)}var Kh=function(){return Kh=Object.assign||function(o){for(var d,y=1,T=arguments.length;y<T;y++){d=arguments[y];for(var S in d)Object.prototype.hasOwnProperty.call(d,S)&&(o[S]=d[S])}return o},Kh.apply(this,arguments)};function x1(s,o){var d={};for(var y in s)Object.prototype.hasOwnProperty.call(s,y)&&o.indexOf(y)<0&&(d[y]=s[y]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var T=0,y=Object.getOwnPropertySymbols(s);T<y.length;T++)o.indexOf(y[T])<0&&Object.prototype.propertyIsEnumerable.call(s,y[T])&&(d[y[T]]=s[y[T]]);return d}function v1(s,o,d,y){var T=arguments.length,S=T<3?o:y===null?y=Object.getOwnPropertyDescriptor(o,d):y,x;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")S=Reflect.decorate(s,o,d,y);else for(var h=s.length-1;h>=0;h--)(x=s[h])&&(S=(T<3?x(S):T>3?x(o,d,S):x(o,d))||S);return T>3&&S&&Object.defineProperty(o,d,S),S}function b1(s,o){return function(d,y){o(d,y,s)}}function w1(s,o){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,o)}function S1(s,o,d,y){function T(S){return S instanceof d?S:new d(function(x){x(S)})}return new(d||(d=Promise))(function(S,x){function h(ie){try{O(y.next(ie))}catch(Q){x(Q)}}function K(ie){try{O(y.throw(ie))}catch(Q){x(Q)}}function O(ie){ie.done?S(ie.value):T(ie.value).then(h,K)}O((y=y.apply(s,o||[])).next())})}function T1(s,o){var d={label:0,sent:function(){if(S[0]&1)throw S[1];return S[1]},trys:[],ops:[]},y,T,S,x;return x={next:h(0),throw:h(1),return:h(2)},typeof Symbol=="function"&&(x[Symbol.iterator]=function(){return this}),x;function h(O){return function(ie){return K([O,ie])}}function K(O){if(y)throw new TypeError("Generator is already executing.");for(;d;)try{if(y=1,T&&(S=O[0]&2?T.return:O[0]?T.throw||((S=T.return)&&S.call(T),0):T.next)&&!(S=S.call(T,O[1])).done)return S;switch(T=0,S&&(O=[O[0]&2,S.value]),O[0]){case 0:case 1:S=O;break;case 4:return d.label++,{value:O[1],done:!1};case 5:d.label++,T=O[1],O=[0];continue;case 7:O=d.ops.pop(),d.trys.pop();continue;default:if(S=d.trys,!(S=S.length>0&&S[S.length-1])&&(O[0]===6||O[0]===2)){d=0;continue}if(O[0]===3&&(!S||O[1]>S[0]&&O[1]<S[3])){d.label=O[1];break}if(O[0]===6&&d.label<S[1]){d.label=S[1],S=O;break}if(S&&d.label<S[2]){d.label=S[2],d.ops.push(O);break}S[2]&&d.ops.pop(),d.trys.pop();continue}O=o.call(s,d)}catch(ie){O=[6,ie],T=0}finally{y=S=0}if(O[0]&5)throw O[1];return{value:O[0]?O[1]:void 0,done:!0}}}function A1(s,o,d,y){y===void 0&&(y=d),s[y]=o[d]}function E1(s,o){for(var d in s)d!=="default"&&!o.hasOwnProperty(d)&&(o[d]=s[d])}function Xh(s){var o=typeof Symbol=="function"&&Symbol.iterator,d=o&&s[o],y=0;if(d)return d.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&y>=s.length&&(s=void 0),{value:s&&s[y++],done:!s}}};throw new TypeError(o?"Object is not iterable.":"Symbol.iterator is not defined.")}function tg(s,o){var d=typeof Symbol=="function"&&s[Symbol.iterator];if(!d)return s;var y=d.call(s),T,S=[],x;try{for(;(o===void 0||o-- >0)&&!(T=y.next()).done;)S.push(T.value)}catch(h){x={error:h}}finally{try{T&&!T.done&&(d=y.return)&&d.call(y)}finally{if(x)throw x.error}}return S}function I1(){for(var s=[],o=0;o<arguments.length;o++)s=s.concat(tg(arguments[o]));return s}function C1(){for(var s=0,o=0,d=arguments.length;o<d;o++)s+=arguments[o].length;for(var y=Array(s),T=0,o=0;o<d;o++)for(var S=arguments[o],x=0,h=S.length;x<h;x++,T++)y[T]=S[x];return y}function Il(s){return this instanceof Il?(this.v=s,this):new Il(s)}function P1(s,o,d){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var y=d.apply(s,o||[]),T,S=[];return T={},x("next"),x("throw"),x("return"),T[Symbol.asyncIterator]=function(){return this},T;function x(U){y[U]&&(T[U]=function(ye){return new Promise(function(Te,Pe){S.push([U,ye,Te,Pe])>1||h(U,ye)})})}function h(U,ye){try{K(y[U](ye))}catch(Te){Q(S[0][3],Te)}}function K(U){U.value instanceof Il?Promise.resolve(U.value.v).then(O,ie):Q(S[0][2],U)}function O(U){h("next",U)}function ie(U){h("throw",U)}function Q(U,ye){U(ye),S.shift(),S.length&&h(S[0][0],S[0][1])}}function M1(s){var o,d;return o={},y("next"),y("throw",function(T){throw T}),y("return"),o[Symbol.iterator]=function(){return this},o;function y(T,S){o[T]=s[T]?function(x){return(d=!d)?{value:Il(s[T](x)),done:T==="return"}:S?S(x):x}:S}}function k1(s){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o=s[Symbol.asyncIterator],d;return o?o.call(s):(s=typeof Xh=="function"?Xh(s):s[Symbol.iterator](),d={},y("next"),y("throw"),y("return"),d[Symbol.asyncIterator]=function(){return this},d);function y(S){d[S]=s[S]&&function(x){return new Promise(function(h,K){x=s[S](x),T(h,K,x.done,x.value)})}}function T(S,x,h,K){Promise.resolve(K).then(function(O){S({value:O,done:h})},x)}}function D1(s,o){return Object.defineProperty?Object.defineProperty(s,"raw",{value:o}):s.raw=o,s}function R1(s){if(s&&s.__esModule)return s;var o={};if(s!=null)for(var d in s)Object.hasOwnProperty.call(s,d)&&(o[d]=s[d]);return o.default=s,o}function z1(s){return s&&s.__esModule?s:{default:s}}function B1(s,o){if(!o.has(s))throw new TypeError("attempted to get private field on non-instance");return o.get(s)}function L1(s,o,d){if(!o.has(s))throw new TypeError("attempted to set private field on non-instance");return o.set(s,d),d}const F1=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return Kh},__asyncDelegator:M1,__asyncGenerator:P1,__asyncValues:k1,__await:Il,__awaiter:S1,__classPrivateFieldGet:B1,__classPrivateFieldSet:L1,__createBinding:A1,__decorate:v1,__exportStar:E1,__extends:_1,__generator:T1,__importDefault:z1,__importStar:R1,__makeTemplateObject:D1,__metadata:w1,__param:b1,__read:tg,__rest:x1,__spread:I1,__spreadArrays:C1,__values:Xh},Symbol.toStringTag,{value:"Module"})),O1=ea(F1);var dl={},pl={},fl={},Ff;function $1(){if(Ff)return fl;Ff=1,Object.defineProperty(fl,"__esModule",{value:!0}),fl.isEmptyData=void 0;function s(o){return typeof o=="string"?o.length===0:o.byteLength===0}return fl.isEmptyData=s,fl}var Dh={},Of;function ig(){return Of||(Of=1,function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.EMPTY_DATA_SHA_256=s.SHA_256_HMAC_ALGO=s.SHA_256_HASH=void 0,s.SHA_256_HASH={name:"SHA-256"},s.SHA_256_HMAC_ALGO={name:"HMAC",hash:s.SHA_256_HASH},s.EMPTY_DATA_SHA_256=new Uint8Array([227,176,196,66,152,252,28,20,154,251,244,200,153,111,185,36,39,174,65,228,100,155,147,76,164,149,153,27,120,82,184,85])}(Dh)),Dh}var $f;function rg(){if($f)return pl;$f=1,Object.defineProperty(pl,"__esModule",{value:!0}),pl.Sha256=void 0;var s=$1(),o=ig(),d=wm,y=dd,T=function(){function h(K){this.secret=K,this.reset()}return h.prototype.update=function(K){var O=this;(0,s.isEmptyData)(K)||(this.operation=this.operation.then(function(ie){return ie.onerror=function(){O.operation=Promise.reject(new Error("Error encountered updating hash"))},ie.process(x(K)),ie}),this.operation.catch(function(){}))},h.prototype.digest=function(){return this.operation.then(function(K){return new Promise(function(O,ie){K.onerror=function(){ie(new Error("Error encountered finalizing hash"))},K.oncomplete=function(){K.result&&O(new Uint8Array(K.result)),ie(new Error("Error encountered finalizing hash"))},K.finish()})})},h.prototype.reset=function(){this.secret?(this.operation=S(this.secret).then(function(K){return(0,y.locateWindow)().msCrypto.subtle.sign(o.SHA_256_HMAC_ALGO,K)}),this.operation.catch(function(){})):this.operation=Promise.resolve((0,y.locateWindow)().msCrypto.subtle.digest("SHA-256"))},h}();pl.Sha256=T;function S(h){return new Promise(function(K,O){var ie=(0,y.locateWindow)().msCrypto.subtle.importKey("raw",x(h),o.SHA_256_HMAC_ALGO,!1,["sign"]);ie.oncomplete=function(){ie.result&&K(ie.result),O(new Error("ImportKey completed without importing key."))},ie.onerror=function(){O(new Error("ImportKey failed to import key."))}})}function x(h){return typeof h=="string"?(0,d.fromUtf8)(h):ArrayBuffer.isView(h)?new Uint8Array(h.buffer,h.byteOffset,h.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(h)}return pl}var ml={},Nf;function ng(){if(Nf)return ml;Nf=1,Object.defineProperty(ml,"__esModule",{value:!0}),ml.Sha256=void 0;var s=Bl(),o=ig(),d=dd,y=function(){function T(S){this.toHash=new Uint8Array(0),this.secret=S,this.reset()}return T.prototype.update=function(S){if(!(0,s.isEmptyData)(S)){var x=(0,s.convertToBuffer)(S),h=new Uint8Array(this.toHash.byteLength+x.byteLength);h.set(this.toHash,0),h.set(x,this.toHash.byteLength),this.toHash=h}},T.prototype.digest=function(){var S=this;return this.key?this.key.then(function(x){return(0,d.locateWindow)().crypto.subtle.sign(o.SHA_256_HMAC_ALGO,x,S.toHash).then(function(h){return new Uint8Array(h)})}):(0,s.isEmptyData)(this.toHash)?Promise.resolve(o.EMPTY_DATA_SHA_256):Promise.resolve().then(function(){return(0,d.locateWindow)().crypto.subtle.digest(o.SHA_256_HASH,S.toHash)}).then(function(x){return Promise.resolve(new Uint8Array(x))})},T.prototype.reset=function(){var S=this;this.toHash=new Uint8Array(0),this.secret&&this.secret!==void 0&&(this.key=new Promise(function(x,h){(0,d.locateWindow)().crypto.subtle.importKey("raw",(0,s.convertToBuffer)(S.secret),o.SHA_256_HMAC_ALGO,!1,["sign"]).then(x,h)}),this.key.catch(function(){}))},T}();return ml.Sha256=y,ml}var Rh={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Yh=function(s,o){return Yh=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,y){d.__proto__=y}||function(d,y){for(var T in y)y.hasOwnProperty(T)&&(d[T]=y[T])},Yh(s,o)};function N1(s,o){Yh(s,o);function d(){this.constructor=s}s.prototype=o===null?Object.create(o):(d.prototype=o.prototype,new d)}var Jh=function(){return Jh=Object.assign||function(o){for(var d,y=1,T=arguments.length;y<T;y++){d=arguments[y];for(var S in d)Object.prototype.hasOwnProperty.call(d,S)&&(o[S]=d[S])}return o},Jh.apply(this,arguments)};function U1(s,o){var d={};for(var y in s)Object.prototype.hasOwnProperty.call(s,y)&&o.indexOf(y)<0&&(d[y]=s[y]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var T=0,y=Object.getOwnPropertySymbols(s);T<y.length;T++)o.indexOf(y[T])<0&&Object.prototype.propertyIsEnumerable.call(s,y[T])&&(d[y[T]]=s[y[T]]);return d}function V1(s,o,d,y){var T=arguments.length,S=T<3?o:y===null?y=Object.getOwnPropertyDescriptor(o,d):y,x;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")S=Reflect.decorate(s,o,d,y);else for(var h=s.length-1;h>=0;h--)(x=s[h])&&(S=(T<3?x(S):T>3?x(o,d,S):x(o,d))||S);return T>3&&S&&Object.defineProperty(o,d,S),S}function j1(s,o){return function(d,y){o(d,y,s)}}function q1(s,o){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,o)}function G1(s,o,d,y){function T(S){return S instanceof d?S:new d(function(x){x(S)})}return new(d||(d=Promise))(function(S,x){function h(ie){try{O(y.next(ie))}catch(Q){x(Q)}}function K(ie){try{O(y.throw(ie))}catch(Q){x(Q)}}function O(ie){ie.done?S(ie.value):T(ie.value).then(h,K)}O((y=y.apply(s,o||[])).next())})}function H1(s,o){var d={label:0,sent:function(){if(S[0]&1)throw S[1];return S[1]},trys:[],ops:[]},y,T,S,x;return x={next:h(0),throw:h(1),return:h(2)},typeof Symbol=="function"&&(x[Symbol.iterator]=function(){return this}),x;function h(O){return function(ie){return K([O,ie])}}function K(O){if(y)throw new TypeError("Generator is already executing.");for(;d;)try{if(y=1,T&&(S=O[0]&2?T.return:O[0]?T.throw||((S=T.return)&&S.call(T),0):T.next)&&!(S=S.call(T,O[1])).done)return S;switch(T=0,S&&(O=[O[0]&2,S.value]),O[0]){case 0:case 1:S=O;break;case 4:return d.label++,{value:O[1],done:!1};case 5:d.label++,T=O[1],O=[0];continue;case 7:O=d.ops.pop(),d.trys.pop();continue;default:if(S=d.trys,!(S=S.length>0&&S[S.length-1])&&(O[0]===6||O[0]===2)){d=0;continue}if(O[0]===3&&(!S||O[1]>S[0]&&O[1]<S[3])){d.label=O[1];break}if(O[0]===6&&d.label<S[1]){d.label=S[1],S=O;break}if(S&&d.label<S[2]){d.label=S[2],d.ops.push(O);break}S[2]&&d.ops.pop(),d.trys.pop();continue}O=o.call(s,d)}catch(ie){O=[6,ie],T=0}finally{y=S=0}if(O[0]&5)throw O[1];return{value:O[0]?O[1]:void 0,done:!0}}}function Z1(s,o,d,y){y===void 0&&(y=d),s[y]=o[d]}function W1(s,o){for(var d in s)d!=="default"&&!o.hasOwnProperty(d)&&(o[d]=s[d])}function Qh(s){var o=typeof Symbol=="function"&&Symbol.iterator,d=o&&s[o],y=0;if(d)return d.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&y>=s.length&&(s=void 0),{value:s&&s[y++],done:!s}}};throw new TypeError(o?"Object is not iterable.":"Symbol.iterator is not defined.")}function sg(s,o){var d=typeof Symbol=="function"&&s[Symbol.iterator];if(!d)return s;var y=d.call(s),T,S=[],x;try{for(;(o===void 0||o-- >0)&&!(T=y.next()).done;)S.push(T.value)}catch(h){x={error:h}}finally{try{T&&!T.done&&(d=y.return)&&d.call(y)}finally{if(x)throw x.error}}return S}function K1(){for(var s=[],o=0;o<arguments.length;o++)s=s.concat(sg(arguments[o]));return s}function X1(){for(var s=0,o=0,d=arguments.length;o<d;o++)s+=arguments[o].length;for(var y=Array(s),T=0,o=0;o<d;o++)for(var S=arguments[o],x=0,h=S.length;x<h;x++,T++)y[T]=S[x];return y}function Cl(s){return this instanceof Cl?(this.v=s,this):new Cl(s)}function Y1(s,o,d){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var y=d.apply(s,o||[]),T,S=[];return T={},x("next"),x("throw"),x("return"),T[Symbol.asyncIterator]=function(){return this},T;function x(U){y[U]&&(T[U]=function(ye){return new Promise(function(Te,Pe){S.push([U,ye,Te,Pe])>1||h(U,ye)})})}function h(U,ye){try{K(y[U](ye))}catch(Te){Q(S[0][3],Te)}}function K(U){U.value instanceof Cl?Promise.resolve(U.value.v).then(O,ie):Q(S[0][2],U)}function O(U){h("next",U)}function ie(U){h("throw",U)}function Q(U,ye){U(ye),S.shift(),S.length&&h(S[0][0],S[0][1])}}function J1(s){var o,d;return o={},y("next"),y("throw",function(T){throw T}),y("return"),o[Symbol.iterator]=function(){return this},o;function y(T,S){o[T]=s[T]?function(x){return(d=!d)?{value:Cl(s[T](x)),done:T==="return"}:S?S(x):x}:S}}function Q1(s){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o=s[Symbol.asyncIterator],d;return o?o.call(s):(s=typeof Qh=="function"?Qh(s):s[Symbol.iterator](),d={},y("next"),y("throw"),y("return"),d[Symbol.asyncIterator]=function(){return this},d);function y(S){d[S]=s[S]&&function(x){return new Promise(function(h,K){x=s[S](x),T(h,K,x.done,x.value)})}}function T(S,x,h,K){Promise.resolve(K).then(function(O){S({value:O,done:h})},x)}}function ew(s,o){return Object.defineProperty?Object.defineProperty(s,"raw",{value:o}):s.raw=o,s}function tw(s){if(s&&s.__esModule)return s;var o={};if(s!=null)for(var d in s)Object.hasOwnProperty.call(s,d)&&(o[d]=s[d]);return o.default=s,o}function iw(s){return s&&s.__esModule?s:{default:s}}function rw(s,o){if(!o.has(s))throw new TypeError("attempted to get private field on non-instance");return o.get(s)}function nw(s,o,d){if(!o.has(s))throw new TypeError("attempted to set private field on non-instance");return o.set(s,d),d}const sw=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return Jh},__asyncDelegator:J1,__asyncGenerator:Y1,__asyncValues:Q1,__await:Cl,__awaiter:G1,__classPrivateFieldGet:rw,__classPrivateFieldSet:nw,__createBinding:Z1,__decorate:V1,__exportStar:W1,__extends:N1,__generator:H1,__importDefault:iw,__importStar:tw,__makeTemplateObject:ew,__metadata:q1,__param:j1,__read:sg,__rest:U1,__spread:K1,__spreadArrays:X1,__values:Qh},Symbol.toStringTag,{value:"Module"})),ag=ea(sw);var gl={},vr={},Uf;function og(){return Uf||(Uf=1,Object.defineProperty(vr,"__esModule",{value:!0}),vr.MAX_HASHABLE_LENGTH=vr.INIT=vr.KEY=vr.DIGEST_LENGTH=vr.BLOCK_SIZE=void 0,vr.BLOCK_SIZE=64,vr.DIGEST_LENGTH=32,vr.KEY=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),vr.INIT=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],vr.MAX_HASHABLE_LENGTH=Math.pow(2,53)-1),vr}var yl={},Vf;function aw(){if(Vf)return yl;Vf=1,Object.defineProperty(yl,"__esModule",{value:!0}),yl.RawSha256=void 0;var s=og(),o=function(){function d(){this.state=Int32Array.from(s.INIT),this.temp=new Int32Array(64),this.buffer=new Uint8Array(64),this.bufferLength=0,this.bytesHashed=0,this.finished=!1}return d.prototype.update=function(y){if(this.finished)throw new Error("Attempted to update an already finished hash.");var T=0,S=y.byteLength;if(this.bytesHashed+=S,this.bytesHashed*8>s.MAX_HASHABLE_LENGTH)throw new Error("Cannot hash more than 2^53 - 1 bits");for(;S>0;)this.buffer[this.bufferLength++]=y[T++],S--,this.bufferLength===s.BLOCK_SIZE&&(this.hashBuffer(),this.bufferLength=0)},d.prototype.digest=function(){if(!this.finished){var y=this.bytesHashed*8,T=new DataView(this.buffer.buffer,this.buffer.byteOffset,this.buffer.byteLength),S=this.bufferLength;if(T.setUint8(this.bufferLength++,128),S%s.BLOCK_SIZE>=s.BLOCK_SIZE-8){for(var x=this.bufferLength;x<s.BLOCK_SIZE;x++)T.setUint8(x,0);this.hashBuffer(),this.bufferLength=0}for(var x=this.bufferLength;x<s.BLOCK_SIZE-8;x++)T.setUint8(x,0);T.setUint32(s.BLOCK_SIZE-8,Math.floor(y/4294967296),!0),T.setUint32(s.BLOCK_SIZE-4,y),this.hashBuffer(),this.finished=!0}for(var h=new Uint8Array(s.DIGEST_LENGTH),x=0;x<8;x++)h[x*4]=this.state[x]>>>24&255,h[x*4+1]=this.state[x]>>>16&255,h[x*4+2]=this.state[x]>>>8&255,h[x*4+3]=this.state[x]>>>0&255;return h},d.prototype.hashBuffer=function(){for(var y=this,T=y.buffer,S=y.state,x=S[0],h=S[1],K=S[2],O=S[3],ie=S[4],Q=S[5],U=S[6],ye=S[7],Te=0;Te<s.BLOCK_SIZE;Te++){if(Te<16)this.temp[Te]=(T[Te*4]&255)<<24|(T[Te*4+1]&255)<<16|(T[Te*4+2]&255)<<8|T[Te*4+3]&255;else{var Pe=this.temp[Te-2],qe=(Pe>>>17|Pe<<15)^(Pe>>>19|Pe<<13)^Pe>>>10;Pe=this.temp[Te-15];var Ye=(Pe>>>7|Pe<<25)^(Pe>>>18|Pe<<14)^Pe>>>3;this.temp[Te]=(qe+this.temp[Te-7]|0)+(Ye+this.temp[Te-16]|0)}var _t=(((ie>>>6|ie<<26)^(ie>>>11|ie<<21)^(ie>>>25|ie<<7))+(ie&Q^~ie&U)|0)+(ye+(s.KEY[Te]+this.temp[Te]|0)|0)|0,gt=((x>>>2|x<<30)^(x>>>13|x<<19)^(x>>>22|x<<10))+(x&h^x&K^h&K)|0;ye=U,U=Q,Q=ie,ie=O+_t|0,O=K,K=h,h=x,x=_t+gt|0}S[0]+=x,S[1]+=h,S[2]+=K,S[3]+=O,S[4]+=ie,S[5]+=Q,S[6]+=U,S[7]+=ye},d}();return yl.RawSha256=o,yl}var jf;function ow(){if(jf)return gl;jf=1,Object.defineProperty(gl,"__esModule",{value:!0}),gl.Sha256=void 0;var s=ag,o=og(),d=aw(),y=Bl(),T=function(){function x(h){this.secret=h,this.hash=new d.RawSha256,this.reset()}return x.prototype.update=function(h){if(!((0,y.isEmptyData)(h)||this.error))try{this.hash.update((0,y.convertToBuffer)(h))}catch(K){this.error=K}},x.prototype.digestSync=function(){if(this.error)throw this.error;return this.outer?(this.outer.finished||this.outer.update(this.hash.digest()),this.outer.digest()):this.hash.digest()},x.prototype.digest=function(){return s.__awaiter(this,void 0,void 0,function(){return s.__generator(this,function(h){return[2,this.digestSync()]})})},x.prototype.reset=function(){if(this.hash=new d.RawSha256,this.secret){this.outer=new d.RawSha256;var h=S(this.secret),K=new Uint8Array(o.BLOCK_SIZE);K.set(h);for(var O=0;O<o.BLOCK_SIZE;O++)h[O]^=54,K[O]^=92;this.hash.update(h),this.outer.update(K);for(var O=0;O<h.byteLength;O++)h[O]=0}},x}();gl.Sha256=T;function S(x){var h=(0,y.convertToBuffer)(x);if(h.byteLength>o.BLOCK_SIZE){var K=new d.RawSha256;K.update(h),h=K.digest()}var O=new Uint8Array(o.BLOCK_SIZE);return O.set(h),O}return gl}var qf;function lw(){return qf||(qf=1,function(s){Object.defineProperty(s,"__esModule",{value:!0});var o=ag;o.__exportStar(ow(),s)}(Rh)),Rh}var zh={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var ed=function(s,o){return ed=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,y){d.__proto__=y}||function(d,y){for(var T in y)y.hasOwnProperty(T)&&(d[T]=y[T])},ed(s,o)};function cw(s,o){ed(s,o);function d(){this.constructor=s}s.prototype=o===null?Object.create(o):(d.prototype=o.prototype,new d)}var td=function(){return td=Object.assign||function(o){for(var d,y=1,T=arguments.length;y<T;y++){d=arguments[y];for(var S in d)Object.prototype.hasOwnProperty.call(d,S)&&(o[S]=d[S])}return o},td.apply(this,arguments)};function uw(s,o){var d={};for(var y in s)Object.prototype.hasOwnProperty.call(s,y)&&o.indexOf(y)<0&&(d[y]=s[y]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var T=0,y=Object.getOwnPropertySymbols(s);T<y.length;T++)o.indexOf(y[T])<0&&Object.prototype.propertyIsEnumerable.call(s,y[T])&&(d[y[T]]=s[y[T]]);return d}function hw(s,o,d,y){var T=arguments.length,S=T<3?o:y===null?y=Object.getOwnPropertyDescriptor(o,d):y,x;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")S=Reflect.decorate(s,o,d,y);else for(var h=s.length-1;h>=0;h--)(x=s[h])&&(S=(T<3?x(S):T>3?x(o,d,S):x(o,d))||S);return T>3&&S&&Object.defineProperty(o,d,S),S}function dw(s,o){return function(d,y){o(d,y,s)}}function pw(s,o){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,o)}function fw(s,o,d,y){function T(S){return S instanceof d?S:new d(function(x){x(S)})}return new(d||(d=Promise))(function(S,x){function h(ie){try{O(y.next(ie))}catch(Q){x(Q)}}function K(ie){try{O(y.throw(ie))}catch(Q){x(Q)}}function O(ie){ie.done?S(ie.value):T(ie.value).then(h,K)}O((y=y.apply(s,o||[])).next())})}function mw(s,o){var d={label:0,sent:function(){if(S[0]&1)throw S[1];return S[1]},trys:[],ops:[]},y,T,S,x;return x={next:h(0),throw:h(1),return:h(2)},typeof Symbol=="function"&&(x[Symbol.iterator]=function(){return this}),x;function h(O){return function(ie){return K([O,ie])}}function K(O){if(y)throw new TypeError("Generator is already executing.");for(;d;)try{if(y=1,T&&(S=O[0]&2?T.return:O[0]?T.throw||((S=T.return)&&S.call(T),0):T.next)&&!(S=S.call(T,O[1])).done)return S;switch(T=0,S&&(O=[O[0]&2,S.value]),O[0]){case 0:case 1:S=O;break;case 4:return d.label++,{value:O[1],done:!1};case 5:d.label++,T=O[1],O=[0];continue;case 7:O=d.ops.pop(),d.trys.pop();continue;default:if(S=d.trys,!(S=S.length>0&&S[S.length-1])&&(O[0]===6||O[0]===2)){d=0;continue}if(O[0]===3&&(!S||O[1]>S[0]&&O[1]<S[3])){d.label=O[1];break}if(O[0]===6&&d.label<S[1]){d.label=S[1],S=O;break}if(S&&d.label<S[2]){d.label=S[2],d.ops.push(O);break}S[2]&&d.ops.pop(),d.trys.pop();continue}O=o.call(s,d)}catch(ie){O=[6,ie],T=0}finally{y=S=0}if(O[0]&5)throw O[1];return{value:O[0]?O[1]:void 0,done:!0}}}function gw(s,o,d,y){y===void 0&&(y=d),s[y]=o[d]}function yw(s,o){for(var d in s)d!=="default"&&!o.hasOwnProperty(d)&&(o[d]=s[d])}function id(s){var o=typeof Symbol=="function"&&Symbol.iterator,d=o&&s[o],y=0;if(d)return d.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&y>=s.length&&(s=void 0),{value:s&&s[y++],done:!s}}};throw new TypeError(o?"Object is not iterable.":"Symbol.iterator is not defined.")}function lg(s,o){var d=typeof Symbol=="function"&&s[Symbol.iterator];if(!d)return s;var y=d.call(s),T,S=[],x;try{for(;(o===void 0||o-- >0)&&!(T=y.next()).done;)S.push(T.value)}catch(h){x={error:h}}finally{try{T&&!T.done&&(d=y.return)&&d.call(y)}finally{if(x)throw x.error}}return S}function _w(){for(var s=[],o=0;o<arguments.length;o++)s=s.concat(lg(arguments[o]));return s}function xw(){for(var s=0,o=0,d=arguments.length;o<d;o++)s+=arguments[o].length;for(var y=Array(s),T=0,o=0;o<d;o++)for(var S=arguments[o],x=0,h=S.length;x<h;x++,T++)y[T]=S[x];return y}function Pl(s){return this instanceof Pl?(this.v=s,this):new Pl(s)}function vw(s,o,d){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var y=d.apply(s,o||[]),T,S=[];return T={},x("next"),x("throw"),x("return"),T[Symbol.asyncIterator]=function(){return this},T;function x(U){y[U]&&(T[U]=function(ye){return new Promise(function(Te,Pe){S.push([U,ye,Te,Pe])>1||h(U,ye)})})}function h(U,ye){try{K(y[U](ye))}catch(Te){Q(S[0][3],Te)}}function K(U){U.value instanceof Pl?Promise.resolve(U.value.v).then(O,ie):Q(S[0][2],U)}function O(U){h("next",U)}function ie(U){h("throw",U)}function Q(U,ye){U(ye),S.shift(),S.length&&h(S[0][0],S[0][1])}}function bw(s){var o,d;return o={},y("next"),y("throw",function(T){throw T}),y("return"),o[Symbol.iterator]=function(){return this},o;function y(T,S){o[T]=s[T]?function(x){return(d=!d)?{value:Pl(s[T](x)),done:T==="return"}:S?S(x):x}:S}}function ww(s){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o=s[Symbol.asyncIterator],d;return o?o.call(s):(s=typeof id=="function"?id(s):s[Symbol.iterator](),d={},y("next"),y("throw"),y("return"),d[Symbol.asyncIterator]=function(){return this},d);function y(S){d[S]=s[S]&&function(x){return new Promise(function(h,K){x=s[S](x),T(h,K,x.done,x.value)})}}function T(S,x,h,K){Promise.resolve(K).then(function(O){S({value:O,done:h})},x)}}function Sw(s,o){return Object.defineProperty?Object.defineProperty(s,"raw",{value:o}):s.raw=o,s}function Tw(s){if(s&&s.__esModule)return s;var o={};if(s!=null)for(var d in s)Object.hasOwnProperty.call(s,d)&&(o[d]=s[d]);return o.default=s,o}function Aw(s){return s&&s.__esModule?s:{default:s}}function Ew(s,o){if(!o.has(s))throw new TypeError("attempted to get private field on non-instance");return o.get(s)}function Iw(s,o,d){if(!o.has(s))throw new TypeError("attempted to set private field on non-instance");return o.set(s,d),d}const Cw=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return td},__asyncDelegator:bw,__asyncGenerator:vw,__asyncValues:ww,__await:Pl,__awaiter:fw,__classPrivateFieldGet:Ew,__classPrivateFieldSet:Iw,__createBinding:gw,__decorate:hw,__exportStar:yw,__extends:cw,__generator:mw,__importDefault:Aw,__importStar:Tw,__makeTemplateObject:Sw,__metadata:pw,__param:dw,__read:lg,__rest:uw,__spread:_w,__spreadArrays:xw,__values:id},Symbol.toStringTag,{value:"Module"})),cg=ea(Cw);var jr={},Gf;function Pw(){if(Gf)return jr;Gf=1,Object.defineProperty(jr,"__esModule",{value:!0}),jr.supportsZeroByteGCM=jr.supportsSubtleCrypto=jr.supportsSecureRandom=jr.supportsWebCrypto=void 0;var s=cg,o=["decrypt","digest","encrypt","exportKey","generateKey","importKey","sign","verify"];function d(x){if(y(x)&&typeof x.crypto.subtle=="object"){var h=x.crypto.subtle;return T(h)}return!1}jr.supportsWebCrypto=d;function y(x){if(typeof x=="object"&&typeof x.crypto=="object"){var h=x.crypto.getRandomValues;return typeof h=="function"}return!1}jr.supportsSecureRandom=y;function T(x){return x&&o.every(function(h){return typeof x[h]=="function"})}jr.supportsSubtleCrypto=T;function S(x){return s.__awaiter(this,void 0,void 0,function(){var h,K;return s.__generator(this,function(O){switch(O.label){case 0:if(!T(x))return[2,!1];O.label=1;case 1:return O.trys.push([1,4,,5]),[4,x.generateKey({name:"AES-GCM",length:128},!1,["encrypt"])];case 2:return h=O.sent(),[4,x.encrypt({name:"AES-GCM",iv:new Uint8Array(Array(12)),additionalData:new Uint8Array(Array(16)),tagLength:128},h,new Uint8Array(0))];case 3:return K=O.sent(),[2,K.byteLength===16];case 4:return O.sent(),[2,!1];case 5:return[2]}})})}return jr.supportsZeroByteGCM=S,jr}var Hf;function Mw(){return Hf||(Hf=1,function(s){Object.defineProperty(s,"__esModule",{value:!0});var o=cg;o.__exportStar(Pw(),s)}(zh)),zh}var Bh={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var rd=function(s,o){return rd=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,y){d.__proto__=y}||function(d,y){for(var T in y)y.hasOwnProperty(T)&&(d[T]=y[T])},rd(s,o)};function kw(s,o){rd(s,o);function d(){this.constructor=s}s.prototype=o===null?Object.create(o):(d.prototype=o.prototype,new d)}var nd=function(){return nd=Object.assign||function(o){for(var d,y=1,T=arguments.length;y<T;y++){d=arguments[y];for(var S in d)Object.prototype.hasOwnProperty.call(d,S)&&(o[S]=d[S])}return o},nd.apply(this,arguments)};function Dw(s,o){var d={};for(var y in s)Object.prototype.hasOwnProperty.call(s,y)&&o.indexOf(y)<0&&(d[y]=s[y]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var T=0,y=Object.getOwnPropertySymbols(s);T<y.length;T++)o.indexOf(y[T])<0&&Object.prototype.propertyIsEnumerable.call(s,y[T])&&(d[y[T]]=s[y[T]]);return d}function Rw(s,o,d,y){var T=arguments.length,S=T<3?o:y===null?y=Object.getOwnPropertyDescriptor(o,d):y,x;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")S=Reflect.decorate(s,o,d,y);else for(var h=s.length-1;h>=0;h--)(x=s[h])&&(S=(T<3?x(S):T>3?x(o,d,S):x(o,d))||S);return T>3&&S&&Object.defineProperty(o,d,S),S}function zw(s,o){return function(d,y){o(d,y,s)}}function Bw(s,o){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(s,o)}function Lw(s,o,d,y){function T(S){return S instanceof d?S:new d(function(x){x(S)})}return new(d||(d=Promise))(function(S,x){function h(ie){try{O(y.next(ie))}catch(Q){x(Q)}}function K(ie){try{O(y.throw(ie))}catch(Q){x(Q)}}function O(ie){ie.done?S(ie.value):T(ie.value).then(h,K)}O((y=y.apply(s,o||[])).next())})}function Fw(s,o){var d={label:0,sent:function(){if(S[0]&1)throw S[1];return S[1]},trys:[],ops:[]},y,T,S,x;return x={next:h(0),throw:h(1),return:h(2)},typeof Symbol=="function"&&(x[Symbol.iterator]=function(){return this}),x;function h(O){return function(ie){return K([O,ie])}}function K(O){if(y)throw new TypeError("Generator is already executing.");for(;d;)try{if(y=1,T&&(S=O[0]&2?T.return:O[0]?T.throw||((S=T.return)&&S.call(T),0):T.next)&&!(S=S.call(T,O[1])).done)return S;switch(T=0,S&&(O=[O[0]&2,S.value]),O[0]){case 0:case 1:S=O;break;case 4:return d.label++,{value:O[1],done:!1};case 5:d.label++,T=O[1],O=[0];continue;case 7:O=d.ops.pop(),d.trys.pop();continue;default:if(S=d.trys,!(S=S.length>0&&S[S.length-1])&&(O[0]===6||O[0]===2)){d=0;continue}if(O[0]===3&&(!S||O[1]>S[0]&&O[1]<S[3])){d.label=O[1];break}if(O[0]===6&&d.label<S[1]){d.label=S[1],S=O;break}if(S&&d.label<S[2]){d.label=S[2],d.ops.push(O);break}S[2]&&d.ops.pop(),d.trys.pop();continue}O=o.call(s,d)}catch(ie){O=[6,ie],T=0}finally{y=S=0}if(O[0]&5)throw O[1];return{value:O[0]?O[1]:void 0,done:!0}}}function Ow(s,o,d,y){y===void 0&&(y=d),s[y]=o[d]}function $w(s,o){for(var d in s)d!=="default"&&!o.hasOwnProperty(d)&&(o[d]=s[d])}function sd(s){var o=typeof Symbol=="function"&&Symbol.iterator,d=o&&s[o],y=0;if(d)return d.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&y>=s.length&&(s=void 0),{value:s&&s[y++],done:!s}}};throw new TypeError(o?"Object is not iterable.":"Symbol.iterator is not defined.")}function ug(s,o){var d=typeof Symbol=="function"&&s[Symbol.iterator];if(!d)return s;var y=d.call(s),T,S=[],x;try{for(;(o===void 0||o-- >0)&&!(T=y.next()).done;)S.push(T.value)}catch(h){x={error:h}}finally{try{T&&!T.done&&(d=y.return)&&d.call(y)}finally{if(x)throw x.error}}return S}function Nw(){for(var s=[],o=0;o<arguments.length;o++)s=s.concat(ug(arguments[o]));return s}function Uw(){for(var s=0,o=0,d=arguments.length;o<d;o++)s+=arguments[o].length;for(var y=Array(s),T=0,o=0;o<d;o++)for(var S=arguments[o],x=0,h=S.length;x<h;x++,T++)y[T]=S[x];return y}function Ml(s){return this instanceof Ml?(this.v=s,this):new Ml(s)}function Vw(s,o,d){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var y=d.apply(s,o||[]),T,S=[];return T={},x("next"),x("throw"),x("return"),T[Symbol.asyncIterator]=function(){return this},T;function x(U){y[U]&&(T[U]=function(ye){return new Promise(function(Te,Pe){S.push([U,ye,Te,Pe])>1||h(U,ye)})})}function h(U,ye){try{K(y[U](ye))}catch(Te){Q(S[0][3],Te)}}function K(U){U.value instanceof Ml?Promise.resolve(U.value.v).then(O,ie):Q(S[0][2],U)}function O(U){h("next",U)}function ie(U){h("throw",U)}function Q(U,ye){U(ye),S.shift(),S.length&&h(S[0][0],S[0][1])}}function jw(s){var o,d;return o={},y("next"),y("throw",function(T){throw T}),y("return"),o[Symbol.iterator]=function(){return this},o;function y(T,S){o[T]=s[T]?function(x){return(d=!d)?{value:Ml(s[T](x)),done:T==="return"}:S?S(x):x}:S}}function qw(s){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o=s[Symbol.asyncIterator],d;return o?o.call(s):(s=typeof sd=="function"?sd(s):s[Symbol.iterator](),d={},y("next"),y("throw"),y("return"),d[Symbol.asyncIterator]=function(){return this},d);function y(S){d[S]=s[S]&&function(x){return new Promise(function(h,K){x=s[S](x),T(h,K,x.done,x.value)})}}function T(S,x,h,K){Promise.resolve(K).then(function(O){S({value:O,done:h})},x)}}function Gw(s,o){return Object.defineProperty?Object.defineProperty(s,"raw",{value:o}):s.raw=o,s}function Hw(s){if(s&&s.__esModule)return s;var o={};if(s!=null)for(var d in s)Object.hasOwnProperty.call(s,d)&&(o[d]=s[d]);return o.default=s,o}function Zw(s){return s&&s.__esModule?s:{default:s}}function Ww(s,o){if(!o.has(s))throw new TypeError("attempted to get private field on non-instance");return o.get(s)}function Kw(s,o,d){if(!o.has(s))throw new TypeError("attempted to set private field on non-instance");return o.set(s,d),d}const Xw=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return nd},__asyncDelegator:jw,__asyncGenerator:Vw,__asyncValues:qw,__await:Ml,__awaiter:Lw,__classPrivateFieldGet:Ww,__classPrivateFieldSet:Kw,__createBinding:Ow,__decorate:Rw,__exportStar:$w,__extends:kw,__generator:Fw,__importDefault:Zw,__importStar:Hw,__makeTemplateObject:Gw,__metadata:Bw,__param:zw,__read:ug,__rest:Dw,__spread:Nw,__spreadArrays:Uw,__values:sd},Symbol.toStringTag,{value:"Module"})),Yw=ea(Xw);var Lh={},Zf;function Jw(){return Zf||(Zf=1,Object.defineProperty(Lh,"__esModule",{value:!0})),Lh}var Fh={},Wf;function Qw(){return Wf||(Wf=1,Object.defineProperty(Fh,"__esModule",{value:!0})),Fh}var Oh={},Kf;function e2(){return Kf||(Kf=1,Object.defineProperty(Oh,"__esModule",{value:!0})),Oh}var $h={},Xf;function t2(){return Xf||(Xf=1,Object.defineProperty($h,"__esModule",{value:!0})),$h}var _l={},Yf;function i2(){if(Yf)return _l;Yf=1,Object.defineProperty(_l,"__esModule",{value:!0}),_l.isMsWindow=void 0;var s=["decrypt","digest","encrypt","exportKey","generateKey","importKey","sign","verify"];function o(y){return"MSInputMethodContext"in y&&"msCrypto"in y}function d(y){if(o(y)&&y.msCrypto.subtle!==void 0){var T=y.msCrypto,S=T.getRandomValues,x=T.subtle;return s.map(function(h){return x[h]}).concat(S).every(function(h){return typeof h=="function"})}return!1}return _l.isMsWindow=d,_l}var Jf;function r2(){return Jf||(Jf=1,function(s){Object.defineProperty(s,"__esModule",{value:!0});var o=Yw;o.__exportStar(Jw(),s),o.__exportStar(Qw(),s),o.__exportStar(e2(),s),o.__exportStar(t2(),s),o.__exportStar(i2(),s)}(Bh)),Bh}var Qf;function n2(){if(Qf)return dl;Qf=1,Object.defineProperty(dl,"__esModule",{value:!0}),dl.Sha256=void 0;var s=rg(),o=ng(),d=lw(),y=Mw(),T=r2(),S=dd,x=Bl(),h=function(){function K(O){(0,y.supportsWebCrypto)((0,S.locateWindow)())?this.hash=new o.Sha256(O):(0,T.isMsWindow)((0,S.locateWindow)())?this.hash=new s.Sha256(O):this.hash=new d.Sha256(O)}return K.prototype.update=function(O,ie){this.hash.update((0,x.convertToBuffer)(O))},K.prototype.digest=function(){return this.hash.digest()},K.prototype.reset=function(){this.hash.reset()},K}();return dl.Sha256=h,dl}(function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.WebCryptoSha256=s.Ie11Sha256=void 0;var o=O1;o.__exportStar(n2(),s);var d=rg();Object.defineProperty(s,"Ie11Sha256",{enumerable:!0,get:function(){return d.Sha256}});var y=ng();Object.defineProperty(s,"WebCryptoSha256",{enumerable:!0,get:function(){return y.Sha256}})})(eg);const s2=({serviceId:s,clientVersion:o})=>async()=>{var T,S,x,h,K;const d=typeof window<"u"&&((T=window==null?void 0:window.navigator)!=null&&T.userAgent)?Tm.parse(window.navigator.userAgent):void 0,y=[["aws-sdk-js",o],["ua","2.0"],[`os/${((S=d==null?void 0:d.os)==null?void 0:S.name)||"other"}`,(x=d==null?void 0:d.os)==null?void 0:x.version],["lang/js"],["md/browser",`${((h=d==null?void 0:d.browser)==null?void 0:h.name)??"unknown"}_${((K=d==null?void 0:d.browser)==null?void 0:K.version)??"unknown"}`]];return s&&y.push([`api/${s}`,o]),y},a2=s=>()=>Promise.reject(s),em=typeof TextEncoder=="function"?new TextEncoder:null,o2=s=>{if(typeof s=="string"){if(em)return em.encode(s).byteLength;let o=s.length;for(let d=o-1;d>=0;d--){const y=s.charCodeAt(d);y>127&&y<=2047?o++:y>2047&&y<=65535&&(o+=2),y>=56320&&y<=57343&&d--}return o}else{if(typeof s.byteLength=="number")return s.byteLength;if(typeof s.size=="number")return s.size}throw new Error(`Body Length computation failed for ${s}`)},hg="required",on="fn",ln="argv",Xa="ref",tm=!0,im="isSet",kl="booleanEquals",Ua="error",xl="endpoint",$n="tree",gd="PartitionResult",rm={[hg]:!1,type:"String"},nm={[hg]:!0,default:!1,type:"Boolean"},sm={[Xa]:"Endpoint"},dg={[on]:kl,[ln]:[{[Xa]:"UseFIPS"},!0]},pg={[on]:kl,[ln]:[{[Xa]:"UseDualStack"},!0]},an={},am={[on]:"getAttr",[ln]:[{[Xa]:gd},"supportsFIPS"]},om={[on]:kl,[ln]:[!0,{[on]:"getAttr",[ln]:[{[Xa]:gd},"supportsDualStack"]}]},lm=[dg],cm=[pg],um=[{[Xa]:"Region"}],l2={version:"1.0",parameters:{Region:rm,UseDualStack:nm,UseFIPS:nm,Endpoint:rm},rules:[{conditions:[{[on]:im,[ln]:[sm]}],rules:[{conditions:lm,error:"Invalid Configuration: FIPS and custom endpoint are not supported",type:Ua},{conditions:cm,error:"Invalid Configuration: Dualstack and custom endpoint are not supported",type:Ua},{endpoint:{url:sm,properties:an,headers:an},type:xl}],type:$n},{conditions:[{[on]:im,[ln]:um}],rules:[{conditions:[{[on]:"aws.partition",[ln]:um,assign:gd}],rules:[{conditions:[dg,pg],rules:[{conditions:[{[on]:kl,[ln]:[tm,am]},om],rules:[{endpoint:{url:"https://geo-fips.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:an,headers:an},type:xl}],type:$n},{error:"FIPS and DualStack are enabled, but this partition does not support one or both",type:Ua}],type:$n},{conditions:lm,rules:[{conditions:[{[on]:kl,[ln]:[am,tm]}],rules:[{endpoint:{url:"https://geo-fips.{Region}.{PartitionResult#dnsSuffix}",properties:an,headers:an},type:xl}],type:$n},{error:"FIPS is enabled but this partition does not support FIPS",type:Ua}],type:$n},{conditions:cm,rules:[{conditions:[om],rules:[{endpoint:{url:"https://geo.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:an,headers:an},type:xl}],type:$n},{error:"DualStack is enabled but this partition does not support DualStack",type:Ua}],type:$n},{endpoint:{url:"https://geo.{Region}.{PartitionResult#dnsSuffix}",properties:an,headers:an},type:xl}],type:$n}],type:$n},{error:"Invalid Configuration: Missing Region",type:Ua}]},c2=l2,u2=(s,o={})=>dx(c2,{endpointParams:s,logger:o.logger});tu.aws=Rm;const h2=s=>({apiVersion:"2020-11-19",base64Decoder:(s==null?void 0:s.base64Decoder)??ld,base64Encoder:(s==null?void 0:s.base64Encoder)??_m,disableHostPrefix:(s==null?void 0:s.disableHostPrefix)??!1,endpointProvider:(s==null?void 0:s.endpointProvider)??u2,extensions:(s==null?void 0:s.extensions)??[],httpAuthSchemeProvider:(s==null?void 0:s.httpAuthSchemeProvider)??Xb,httpAuthSchemes:(s==null?void 0:s.httpAuthSchemes)??[{schemeId:"aws.auth#sigv4",identityProvider:o=>o.getIdentityProvider("aws.auth#sigv4"),signer:new $v}],logger:(s==null?void 0:s.logger)??new xm,serviceId:(s==null?void 0:s.serviceId)??"Location",urlParser:(s==null?void 0:s.urlParser)??iu,utf8Decoder:(s==null?void 0:s.utf8Decoder)??Rl,utf8Encoder:(s==null?void 0:s.utf8Encoder)??cd}),d2=["in-region","cross-region","mobile","standard","legacy"],p2=({defaultsMode:s}={})=>B_(async()=>{const o=typeof s=="function"?await s():s;switch(o==null?void 0:o.toLowerCase()){case"auto":return Promise.resolve(f2()?"mobile":"standard");case"mobile":case"in-region":case"cross-region":case"standard":case"legacy":return Promise.resolve(o==null?void 0:o.toLocaleLowerCase());case void 0:return Promise.resolve("legacy");default:throw new Error(`Invalid parameter for "defaultsMode", expect ${d2.join(", ")}, got ${o}`)}}),f2=()=>{var d,y;const s=typeof window<"u"&&((d=window==null?void 0:window.navigator)!=null&&d.userAgent)?Tm.parse(window.navigator.userAgent):void 0,o=(y=s==null?void 0:s.platform)==null?void 0:y.type;return o==="tablet"||o==="mobile"},m2=s=>{const o=p2(s),d=()=>o().then(c0),y=h2(s);return{...y,...s,runtime:"browser",defaultsMode:o,bodyLengthChecker:(s==null?void 0:s.bodyLengthChecker)??o2,credentialDefaultProvider:(s==null?void 0:s.credentialDefaultProvider)??(T=>()=>Promise.reject(new Error("Credential is missing"))),defaultUserAgentProvider:(s==null?void 0:s.defaultUserAgentProvider)??s2({serviceId:y.serviceId,clientVersion:y1.version}),maxAttempts:(s==null?void 0:s.maxAttempts)??ru,region:(s==null?void 0:s.region)??a2("Region is missing"),requestHandler:od.create((s==null?void 0:s.requestHandler)??d),retryMode:(s==null?void 0:s.retryMode)??(async()=>(await d()).retryMode||Xx),sha256:(s==null?void 0:s.sha256)??eg.Sha256,streamCollector:(s==null?void 0:s.streamCollector)??q_,useDualstackEndpoint:(s==null?void 0:s.useDualstackEndpoint)??(()=>Promise.resolve(Tx)),useFipsEndpoint:(s==null?void 0:s.useFipsEndpoint)??(()=>Promise.resolve(Ax))}},g2=s=>{let o=async()=>{if(s.region===void 0)throw new Error("Region is missing from runtimeConfig");const d=s.region;return typeof d=="string"?d:d()};return{setRegion(d){o=d},region(){return o}}},y2=s=>({region:s.region()}),_2=s=>{const o=s.httpAuthSchemes;let d=s.httpAuthSchemeProvider,y=s.credentials;return{setHttpAuthScheme(T){const S=o.findIndex(x=>x.schemeId===T.schemeId);S===-1?o.push(T):o.splice(S,1,T)},httpAuthSchemes(){return o},setHttpAuthSchemeProvider(T){d=T},httpAuthSchemeProvider(){return d},setCredentials(T){y=T},credentials(){return y}}},x2=s=>({httpAuthSchemes:s.httpAuthSchemes(),httpAuthSchemeProvider:s.httpAuthSchemeProvider(),credentials:s.credentials()}),Kc=s=>s,v2=(s,o)=>{const d={...Kc(g2(s)),...Kc(f0(s)),...Kc(L_(s)),...Kc(_2(s))};return o.forEach(y=>y.configure(d)),{...s,...y2(d),...m0(d),...F_(d),...x2(d)}};class b2 extends W_{constructor(...[o]){const d=m2(o||{}),y=Jb(d),T=Ex(y),S=qx(T),x=_v(S),h=x,K=Z0(h),O=Yb(K),ie=v2(O,(o==null?void 0:o.extensions)||[]);super(ie),this.config=ie,this.middlewareStack.use(Tv(this.config)),this.middlewareStack.use(Lv(this.config)),this.middlewareStack.use(O0(this.config)),this.middlewareStack.use(U0(this.config)),this.middlewareStack.use(H0(this.config)),this.middlewareStack.use(Sx(this.config)),this.middlewareStack.use(Hx(this.config,{httpAuthSchemeParametersProvider:this.getDefaultHttpAuthSchemeParametersProvider(),identityProviderConfigProvider:this.getIdentityProviderConfigProvider()})),this.middlewareStack.use(Iv(this.config))}destroy(){super.destroy()}getDefaultHttpAuthSchemeParametersProvider(){return Wb}getIdentityProviderConfigProvider(){return async o=>new Cv({"aws.auth#sigv4":o.credentials})}}class hn extends hd{constructor(o){super(o),Object.setPrototypeOf(this,hn.prototype)}}class yd extends hn{constructor(o){super({name:"AccessDeniedException",$fault:"client",...o}),this.name="AccessDeniedException",this.$fault="client",Object.setPrototypeOf(this,yd.prototype),this.Message=o.Message}}class _d extends hn{constructor(o){super({name:"ConflictException",$fault:"client",...o}),this.name="ConflictException",this.$fault="client",Object.setPrototypeOf(this,_d.prototype),this.Message=o.Message}}class xd extends hn{constructor(o){super({name:"InternalServerException",$fault:"server",...o}),this.name="InternalServerException",this.$fault="server",this.$retryable={},Object.setPrototypeOf(this,xd.prototype),this.Message=o.Message}}class vd extends hn{constructor(o){super({name:"ServiceQuotaExceededException",$fault:"client",...o}),this.name="ServiceQuotaExceededException",this.$fault="client",Object.setPrototypeOf(this,vd.prototype),this.Message=o.Message}}class bd extends hn{constructor(o){super({name:"ThrottlingException",$fault:"client",...o}),this.name="ThrottlingException",this.$fault="client",this.$retryable={},Object.setPrototypeOf(this,bd.prototype),this.Message=o.Message}}class wd extends hn{constructor(o){super({name:"ValidationException",$fault:"client",...o}),this.name="ValidationException",this.$fault="client",Object.setPrototypeOf(this,wd.prototype),this.Message=o.Message,this.Reason=o.Reason,this.FieldList=o.FieldList}}class Sd extends hn{constructor(o){super({name:"ResourceNotFoundException",$fault:"client",...o}),this.name="ResourceNotFoundException",this.$fault="client",Object.setPrototypeOf(this,Sd.prototype),this.Message=o.Message}}const w2=s=>({...s,...s.DeparturePosition&&{DeparturePosition:Bt},...s.DestinationPosition&&{DestinationPosition:Bt},...s.WaypointPositions&&{WaypointPositions:Bt},...s.Key&&{Key:Bt}}),S2=s=>({...s,...s.LineString&&{LineString:Bt}}),T2=s=>({...s,...s.StartPosition&&{StartPosition:Bt},...s.EndPosition&&{EndPosition:Bt}}),A2=s=>({...s,...s.StartPosition&&{StartPosition:Bt},...s.EndPosition&&{EndPosition:Bt},...s.Geometry&&{Geometry:S2(s.Geometry)},...s.Steps&&{Steps:s.Steps.map(o=>T2(o))}}),E2=s=>({...s,...s.RouteBBox&&{RouteBBox:Bt}}),I2=s=>({...s,...s.Legs&&{Legs:s.Legs.map(o=>A2(o))},...s.Summary&&{Summary:E2(s.Summary)}}),C2=s=>({...s,...s.Key&&{Key:Bt}}),P2=s=>({...s,...s.Point&&{Point:Bt}}),fg=s=>({...s,...s.Geometry&&{Geometry:P2(s.Geometry)}}),M2=s=>({...s,...s.Place&&{Place:fg(s.Place)}}),k2=s=>({...s,...s.Text&&{Text:Bt},...s.BiasPosition&&{BiasPosition:Bt},...s.FilterBBox&&{FilterBBox:Bt},...s.Key&&{Key:Bt}}),D2=s=>({...s,...s.Text&&{Text:Bt},...s.BiasPosition&&{BiasPosition:Bt},...s.FilterBBox&&{FilterBBox:Bt}}),R2=s=>({...s,...s.Summary&&{Summary:D2(s.Summary)}}),z2=s=>({...s,...s.Text&&{Text:Bt},...s.BiasPosition&&{BiasPosition:Bt},...s.FilterBBox&&{FilterBBox:Bt},...s.Key&&{Key:Bt}}),B2=s=>({...s,...s.Place&&{Place:fg(s.Place)}}),L2=s=>({...s,...s.Text&&{Text:Bt},...s.BiasPosition&&{BiasPosition:Bt},...s.FilterBBox&&{FilterBBox:Bt},...s.ResultBBox&&{ResultBBox:Bt}}),F2=s=>({...s,...s.Summary&&{Summary:L2(s.Summary)},...s.Results&&{Results:s.Results.map(o=>B2(o))}}),O2=async(s,o)=>{const d=du(s,o),y={"content-type":"application/json"};d.bp("/routes/v0/calculators/{CalculatorName}/calculate/route"),d.p("CalculatorName",()=>s.CalculatorName,"{CalculatorName}",!1);const T=Vi({[gu]:[,s[mu]]});let S;S=JSON.stringify(Lt(s,{ArrivalTime:h=>h.toISOString().split(".")[0]+"Z",CarModeOptions:h=>ir(h),DepartNow:[],DeparturePosition:h=>Dl(h),DepartureTime:h=>h.toISOString().split(".")[0]+"Z",DestinationPosition:h=>Dl(h),DistanceUnit:[],IncludeLegGeometry:[],OptimizeFor:[],TravelMode:[],TruckModeOptions:h=>eS(h),WaypointPositions:h=>rS(h)}));let{hostname:x}=await o.endpoint();if(o.disableHostPrefix!==!0&&(x="routes."+x,!su(x)))throw new Error("ValidationError: prefixed hostname must be hostname compatible.");return d.hn(x),d.m("POST").h(y).q(T).b(S),d.build()},$2=async(s,o)=>{const d=du(s,o),y={};d.bp("/places/v0/indexes/{IndexName}/places/{PlaceId}"),d.p("IndexName",()=>s.IndexName,"{IndexName}",!1),d.p("PlaceId",()=>s.PlaceId,"{PlaceId}",!1);const T=Vi({[xS]:[,s[_S]],[gu]:[,s[mu]]});let S,{hostname:x}=await o.endpoint();if(o.disableHostPrefix!==!0&&(x="places."+x,!su(x)))throw new Error("ValidationError: prefixed hostname must be hostname compatible.");return d.hn(x),d.m("GET").h(y).q(T).b(S),d.build()},N2=async(s,o)=>{const d=du(s,o),y={"content-type":"application/json"};d.bp("/places/v0/indexes/{IndexName}/search/suggestions"),d.p("IndexName",()=>s.IndexName,"{IndexName}",!1);const T=Vi({[gu]:[,s[mu]]});let S;S=JSON.stringify(Lt(s,{BiasPosition:h=>Dl(h),FilterBBox:h=>mg(h),FilterCategories:h=>ir(h),FilterCountries:h=>ir(h),Language:[],MaxResults:[],Text:[]}));let{hostname:x}=await o.endpoint();if(o.disableHostPrefix!==!0&&(x="places."+x,!su(x)))throw new Error("ValidationError: prefixed hostname must be hostname compatible.");return d.hn(x),d.m("POST").h(y).q(T).b(S),d.build()},U2=async(s,o)=>{const d=du(s,o),y={"content-type":"application/json"};d.bp("/places/v0/indexes/{IndexName}/search/text"),d.p("IndexName",()=>s.IndexName,"{IndexName}",!1);const T=Vi({[gu]:[,s[mu]]});let S;S=JSON.stringify(Lt(s,{BiasPosition:h=>Dl(h),FilterBBox:h=>mg(h),FilterCategories:h=>ir(h),FilterCountries:h=>ir(h),Language:[],MaxResults:[],Text:[]}));let{hostname:x}=await o.endpoint();if(o.disableHostPrefix!==!0&&(x="places."+x,!su(x)))throw new Error("ValidationError: prefixed hostname must be hostname compatible.");return d.hn(x),d.m("POST").h(y).q(T).b(S),d.build()},V2=async(s,o)=>{if(s.statusCode!==200&&s.statusCode>=300)return fu(s,o);const d=Vi({$metadata:qr(s)}),y=au(ou(await Ll(s.body,o)),"body"),T=Lt(y,{Legs:S=>oS(S),Summary:S=>nS(S)});return Object.assign(d,T),d},j2=async(s,o)=>{if(s.statusCode!==200&&s.statusCode>=300)return fu(s,o);const d=Vi({$metadata:qr(s)}),y=au(ou(await Ll(s.body,o)),"body"),T=Lt(y,{Place:S=>gg(S)});return Object.assign(d,T),d},q2=async(s,o)=>{if(s.statusCode!==200&&s.statusCode>=300)return fu(s,o);const d=Vi({$metadata:qr(s)}),y=au(ou(await Ll(s.body,o)),"body"),T=Lt(y,{Results:ir,Summary:S=>dS(S)});return Object.assign(d,T),d},G2=async(s,o)=>{if(s.statusCode!==200&&s.statusCode>=300)return fu(s,o);const d=Vi({$metadata:qr(s)}),y=au(ou(await Ll(s.body,o)),"body"),T=Lt(y,{Results:S=>hS(S),Summary:S=>pS(S)});return Object.assign(d,T),d},fu=async(s,o)=>{const d={...s,body:await Hb(s.body,o)},y=Zb(s,d.body);switch(y){case"AccessDeniedException":case"com.amazonaws.location#AccessDeniedException":throw await Z2(d);case"ConflictException":case"com.amazonaws.location#ConflictException":throw await W2(d);case"InternalServerException":case"com.amazonaws.location#InternalServerException":throw await K2(d);case"ResourceNotFoundException":case"com.amazonaws.location#ResourceNotFoundException":throw await X2(d);case"ServiceQuotaExceededException":case"com.amazonaws.location#ServiceQuotaExceededException":throw await Y2(d);case"ThrottlingException":case"com.amazonaws.location#ThrottlingException":throw await J2(d);case"ValidationException":case"com.amazonaws.location#ValidationException":throw await Q2(d);default:const T=d.body;return H2({output:s,parsedBody:T,errorCode:y})}},H2=o0(hn),Z2=async(s,o)=>{const d=Vi({}),y=s.body,T=Lt(y,{Message:[,wt,"message"]});Object.assign(d,T);const S=new yd({$metadata:qr(s),...d});return Ts(S,s.body)},W2=async(s,o)=>{const d=Vi({}),y=s.body,T=Lt(y,{Message:[,wt,"message"]});Object.assign(d,T);const S=new _d({$metadata:qr(s),...d});return Ts(S,s.body)},K2=async(s,o)=>{const d=Vi({}),y=s.body,T=Lt(y,{Message:[,wt,"message"]});Object.assign(d,T);const S=new xd({$metadata:qr(s),...d});return Ts(S,s.body)},X2=async(s,o)=>{const d=Vi({}),y=s.body,T=Lt(y,{Message:[,wt,"message"]});Object.assign(d,T);const S=new Sd({$metadata:qr(s),...d});return Ts(S,s.body)},Y2=async(s,o)=>{const d=Vi({}),y=s.body,T=Lt(y,{Message:[,wt,"message"]});Object.assign(d,T);const S=new vd({$metadata:qr(s),...d});return Ts(S,s.body)},J2=async(s,o)=>{const d=Vi({}),y=s.body,T=Lt(y,{Message:[,wt,"message"]});Object.assign(d,T);const S=new bd({$metadata:qr(s),...d});return Ts(S,s.body)},Q2=async(s,o)=>{const d=Vi({}),y=s.body,T=Lt(y,{FieldList:[,x=>yS(x),"fieldList"],Message:[,wt,"message"],Reason:[,wt,"reason"]});Object.assign(d,T);const S=new wd({$metadata:qr(s),...d});return Ts(S,s.body)},mg=(s,o)=>s.filter(d=>d!=null).map(d=>Ha(d)),eS=(s,o)=>Lt(s,{AvoidFerries:[],AvoidTolls:[],Dimensions:d=>tS(d),Weight:d=>iS(d)}),Dl=(s,o)=>s.filter(d=>d!=null).map(d=>Ha(d)),tS=(s,o)=>Lt(s,{Height:Ha,Length:Ha,Unit:[],Width:Ha}),iS=(s,o)=>Lt(s,{Total:Ha,Unit:[]}),rS=(s,o)=>s.filter(d=>d!=null).map(d=>Dl(d)),nu=(s,o)=>(s||[]).filter(y=>y!=null).map(y=>cn(y)),nS=(s,o)=>Lt(s,{DataSource:wt,Distance:cn,DistanceUnit:wt,DurationSeconds:cn,RouteBBox:d=>nu(d)}),sS=(s,o)=>Lt(s,{Distance:cn,DurationSeconds:cn,EndPosition:d=>Ss(d),Geometry:d=>aS(d),StartPosition:d=>Ss(d),Steps:d=>mS(d)}),aS=(s,o)=>Lt(s,{LineString:d=>lS(d)}),oS=(s,o)=>(s||[]).filter(y=>y!=null).map(y=>sS(y)),lS=(s,o)=>(s||[]).filter(y=>y!=null).map(y=>Ss(y)),gg=(s,o)=>Lt(s,{AddressNumber:wt,Categories:ir,Country:wt,Geometry:d=>cS(d),Interpolated:e0,Label:wt,Municipality:wt,Neighborhood:wt,PostalCode:wt,Region:wt,Street:wt,SubMunicipality:wt,SubRegion:wt,SupplementalCategories:ir,TimeZone:ir,UnitNumber:wt,UnitType:wt}),cS=(s,o)=>Lt(s,{Point:d=>Ss(d)}),Ss=(s,o)=>(s||[]).filter(y=>y!=null).map(y=>cn(y)),uS=(s,o)=>Lt(s,{Distance:cn,Place:d=>gg(d),PlaceId:wt,Relevance:cn}),hS=(s,o)=>(s||[]).filter(y=>y!=null).map(y=>uS(y)),dS=(s,o)=>Lt(s,{BiasPosition:d=>Ss(d),DataSource:wt,FilterBBox:d=>nu(d),FilterCategories:ir,FilterCountries:ir,Language:wt,MaxResults:ud,Text:wt}),pS=(s,o)=>Lt(s,{BiasPosition:d=>Ss(d),DataSource:wt,FilterBBox:d=>nu(d),FilterCategories:ir,FilterCountries:ir,Language:wt,MaxResults:ud,ResultBBox:d=>nu(d),Text:wt}),fS=(s,o)=>Lt(s,{Distance:cn,DurationSeconds:cn,EndPosition:d=>Ss(d),GeometryOffset:ud,StartPosition:d=>Ss(d)}),mS=(s,o)=>(s||[]).filter(y=>y!=null).map(y=>fS(y)),gS=(s,o)=>Lt(s,{Message:[,wt,"message"],Name:[,wt,"name"]}),yS=(s,o)=>(s||[]).filter(y=>y!=null).map(y=>gS(y)),qr=s=>({httpStatusCode:s.statusCode,requestId:s.headers["x-amzn-requestid"]??s.headers["x-amzn-request-id"]??s.headers["x-amz-request-id"],extendedRequestId:s.headers["x-amz-id-2"],cfId:s.headers["x-amz-cf-id"]}),mu="Key",_S="Language",gu="key",xS="language";class vS extends zl.classBuilder().ep({...pu}).m(function(o,d,y,T){return[uu(y,this.serialize,this.deserialize),hu(y,o.getEndpointParameterInstructions())]}).s("LocationService","CalculateRoute",{}).n("LocationClient","CalculateRouteCommand").f(w2,I2).ser(O2).de(V2).build(){}class bS extends zl.classBuilder().ep({...pu}).m(function(o,d,y,T){return[uu(y,this.serialize,this.deserialize),hu(y,o.getEndpointParameterInstructions())]}).s("LocationService","GetPlace",{}).n("LocationClient","GetPlaceCommand").f(C2,M2).ser($2).de(j2).build(){}class wS extends zl.classBuilder().ep({...pu}).m(function(o,d,y,T){return[uu(y,this.serialize,this.deserialize),hu(y,o.getEndpointParameterInstructions())]}).s("LocationService","SearchPlaceIndexForSuggestions",{}).n("LocationClient","SearchPlaceIndexForSuggestionsCommand").f(k2,R2).ser(N2).de(q2).build(){}class SS extends zl.classBuilder().ep({...pu}).m(function(o,d,y,T){return[uu(y,this.serialize,this.deserialize),hu(y,o.getEndpointParameterInstructions())]}).s("LocationService","SearchPlaceIndexForText",{}).n("LocationClient","SearchPlaceIndexForTextCommand").f(z2,F2).ser(U2).de(G2).build(){}const yu="TaxiGo",TS="us-east-1";async function zS(){try{const o=dm().public.AWS_LOCATION_SERVICE_KEY,d=await B0(o);return new b2({region:TS,...d.getLocationClientConfig()})}catch{throw Error("Error en el servidor")}}const AS=[-100.3175,25.6856],BS=async(s,o)=>{const d={IndexName:yu,Text:s,FilterCountries:["MEX"],BiasPosition:AS},y=new wS(d);return await o.send(y)},LS=async(s,o)=>{try{const d={IndexName:yu,Text:s},y=new SS(d);return(await o.send(y)).Results[0].Place}catch(d){throw console.error("Error searching for place:",d),d}},FS=async(s,o)=>{try{const d={IndexName:yu,PlaceId:s},y=new bS(d);return await o.send(y)}catch(d){throw console.error("Error getting place:",d),d}},ES=async(s,o,d)=>{try{const y={CalculatorName:yu,DeparturePosition:s,DestinationPosition:o,IncludeLegGeometry:!0},T=new vS(y);return await d.send(T)}catch(y){throw console.error("Error calculating route:",y),y}},Va={DAY:{BASE:8.78,RATE_PER_KM:5.22,TIME_RATE:1.04},NIGHT:{BASE:10.53,RATE_PER_KM:6.27,TIME_RATE:1.25}},hm=(s,o,d,y,T)=>{const S=o+s*d,x=Math.ceil(T/45)*y;return S+x},IS=(s,o)=>{const d=hm(s,Va.DAY.BASE,Va.DAY.RATE_PER_KM,Va.DAY.TIME_RATE,o),y=hm(s,Va.NIGHT.BASE,Va.NIGHT.RATE_PER_KM,Va.NIGHT.TIME_RATE,o);return[d.toFixed(2),y.toFixed(2)]};function OS(s){const o=ja(!1),d=ja(0),y=ja(0),T=ja({day:0,night:0}),S=ja();return{loading:o,distance:d,duration:y,fareCost:T,routeString:S,calculateTaxiFare:async(h,K)=>{o.value=!0;try{const O=await ES(h,K,h_(s));d.value=O.Summary.Distance.toFixed(2),y.value=O.Summary.DurationSeconds.toFixed(2);const[ie,Q]=IS(d.value,y.value);T.value={day:ie,night:Q},S.value=O.Legs[0].Geometry.LineString}catch{throw Error("Error calculando su ruta")}finally{o.value=!1}}}}function $S(){return new Promise((s,o)=>{const d=new window.webkitSpeechRecognition;d.lang="es-ES",d.onresult=y=>{const T=y.results[0][0].transcript;s(T)},d.onerror=y=>{console.error("Error de reconocimiento:",y.error),o(y.error)},d.start()})}export{kS as _,OS as a,DS as b,$S as c,MS as d,LS as e,FS as g,zS as i,BS as s,RS as u};
